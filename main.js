!function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};t[s][0].call(u.exports,(function(e){return i(t[s][1][e]||e)}),u,u.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.pushNotificationMessage=n.Notification=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("react-dom");class s extends i.Component{constructor(e){super(e),this.state={notifications:{}}}push(e){const t=this.state.notifications,n=ts.pxtc.Util.guidGen();Object.keys(t).filter((n=>t[n].kind==e.kind)).forEach((e=>this.remove(e))),t[n]=e;const r=this;setTimeout((()=>{r.remove(n)}),3e3),this.setState({notifications:t})}remove(e){const t=this.state.notifications;t[e]&&(delete t[e],this.setState({notifications:t}))}render(){const{notifications:e}=this.state;return(0,r.jsx)("div",Object.assign({id:"msg","aria-live":"polite"},{children:Object.keys(e).map((t=>function(e,t){const{kind:n,text:i,hc:o}=t;let s="ignored info message";switch(n){case"err":s="red inverted segment";break;case"warn":s="orange inverted segment";break;case"info":s="teal inverted segment";break;case"compile":s="ignored info message"}return(0,r.jsx)("div",Object.assign({id:`${n}msg`,className:`ui ${o} ${s}`},{children:i}),`${e}`)}(t,e[t])))}))}}n.Notification=s;let a,l=!1;n.pushNotificationMessage=function(e){if(l)a&&a.push(e);else{l=!0;const t=document.body.appendChild(document.createElement("div"));(a=o.render(i.createElement(s,e),t)).push(e)}}},{react:366,"react-dom":309,"react/jsx-runtime":367}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Confetti=void 0;const r=e("react/jsx-runtime");n.Confetti=e=>{const{children:t}=e;return(0,r.jsxs)("div",Object.assign({className:"confetti-container"},{children:[t,Array(100).fill(0).map(((e,t)=>{const n={animationDelay:t%100*.1+"s",left:1*Math.floor(100*Math.random())+"%"};return(0,r.jsx)("div",{style:n,className:`confetti ${Math.random()>.5?"reverse":""} color-${Math.floor(9*Math.random())}`},t)}))]}))}},{"react/jsx-runtime":367}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Button=void 0;const r=e("react/jsx-runtime"),i=e("../util");n.Button=e=>{const{id:t,className:n,style:o,ariaLabel:s,ariaHidden:a,ariaDescribedBy:l,ariaControls:c,ariaExpanded:u,ariaHasPopup:d,ariaPosInSet:p,ariaSetSize:h,ariaSelected:f,role:g,onClick:m,onKeydown:v,onBlur:y,buttonRef:b,title:x,label:E,leftIcon:_,rightIcon:w,hardDisabled:S,href:T,target:k,tabIndex:C}=e;let{disabled:A}=e;A=A||S;const j=(0,i.classList)("common-button",n,A&&"disabled");return(0,r.jsx)("button",Object.assign({id:t,className:j,style:o,title:x,ref:b,onClick:A?void 0:e=>{m&&m(),T&&window.open(T,k||"_blank","noopener,noreferrer"),e.stopPropagation(),e.preventDefault()},onKeyDown:v||i.fireClickOnEnter,onBlur:y,role:g||"button",tabIndex:C||(A?-1:0),disabled:S,"aria-label":s,"aria-hidden":a,"aria-controls":c,"aria-expanded":u,"aria-haspopup":d,"aria-posinset":p,"aria-setsize":h,"aria-describedby":l,"aria-selected":f},{children:(0,r.jsxs)("span",Object.assign({className:"common-button-flex"},{children:[_&&(0,r.jsx)("i",{className:_,"aria-hidden":!0}),(0,r.jsx)("span",Object.assign({className:"common-button-label"},{children:E})),w&&(0,r.jsx)("i",{className:"right "+w,"aria-hidden":!0})]}))}))}},{"../util":41,"react/jsx-runtime":367}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Card=void 0;const r=e("react/jsx-runtime"),i=e("../util");n.Card=e=>{const{id:t,className:n,role:o,children:s,ariaDescribedBy:a,ariaLabelledBy:l,ariaHidden:c,ariaLabel:u,onClick:d,label:p,labelClass:h,tabIndex:f}=e;return(0,r.jsxs)("div",Object.assign({id:t,className:(0,i.classList)("common-card",n),role:o||(d?"button":void 0),"aria-describedby":a,"aria-labelledby":l,"aria-hidden":c,"aria-label":u,onClick:d,tabIndex:f,onKeyDown:i.fireClickOnEnter},{children:[(0,r.jsx)("div",Object.assign({className:"common-card-body"},{children:s})),p&&(0,r.jsx)("label",Object.assign({className:(0,i.classList)("common-card-label",h)},{children:p}))]}))}},{"../util":41,"react/jsx-runtime":367}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Checkbox=void 0;const r=e("react/jsx-runtime"),i=e("../util");n.Checkbox=e=>{const{id:t,className:n,ariaHidden:o,ariaLabel:s,role:a,isChecked:l,onChange:c,label:u}=e;return(0,r.jsxs)("div",Object.assign({className:(0,i.classList)("common-checkbox",n)},{children:[(0,r.jsx)("input",{id:t,tabIndex:0,type:"checkbox",checked:l,onChange:()=>{c(!l)},onKeyDown:i.fireClickOnEnter,role:a,"aria-hidden":o,"aria-label":s}),u&&(0,r.jsx)("label",Object.assign({htmlFor:t},{children:u}))]}))}},{"../util":41,"react/jsx-runtime":367}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DraggableGraph=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../util");function s(e,t,n,r,i,o){let s;switch(i){case"linear":s=i=>t+(i-e)*(r-t)/(n-e);break;case"curve":s=i=>t+(r-t)*Math.sin((i-e)/(n-e)*(Math.PI/2));break;case"logarithmic":s=i=>t+Math.log10(1+(i-e)/(n-e)*9)*(r-t)}const a=(n-e)/20,l=[`M ${e} ${t}`];let c=e,u=t,d=e,p=t;for(let t=1;t<21;t++){if(p=s(d=e+t*a),!o){l.push(`L ${d} ${p}`);continue}const n=Math.atan2(p-u,d-c),r=Math.sqrt((p-u)**2+(d-c)**2),i=c+Math.cos(n)*(r/4)+20*Math.cos(n+Math.PI/2),h=u+Math.sin(n)*(r/4)+20*Math.sin(n+Math.PI/2);l.push(`Q ${i} ${h} ${c+Math.cos(n)*(r/2)} ${u+Math.sin(n)*(r/2)}`);const f=c+Math.cos(n)*(3*r/4)-20*Math.cos(n+Math.PI/2),g=u+Math.sin(n)*(3*r/4)-20*Math.sin(n+Math.PI/2);l.push(`Q ${f} ${g} ${d} ${p}`),c=d,u=p}return l.join(" ")}n.DraggableGraph=e=>{const{interpolation:t,min:n,max:a,points:l,handleStartAnimationRef:c,onPointChange:u,id:d,className:p,ariaLabel:h,ariaHidden:f,ariaDescribedBy:g,role:m,aspectRatio:v,squiggly:y,valueUnits:b}=e,x=1/v*1e3,E=x-62.5,_=962.5/(l.length-1),w=E/(a-n),[S,T]=i.useState(-1),k=e=>(1-(e.y-25)/E)*(a-n)+n;let C;const A=(e,t)=>{C&&cancelAnimationFrame(C),C=requestAnimationFrame((()=>{j(e,t)}))},j=(e,t)=>{u(e,Math.max(Math.min(t,a),n))},I=[],O=e=>t=>{t&&(I[e]=t)};i.useEffect((()=>{I.forEach(((e,t)=>{e.onpointerdown=n=>{if(-1!==S)return;n.preventDefault();const r=(0,o.clientCoord)(n),i=(0,o.screenToSVGCoord)(e.ownerSVGElement,r);T(t),A(t,k(i))},e.onpointermove=n=>{if(S!==t)return;n.preventDefault();const r=(0,o.clientCoord)(n),i=(0,o.screenToSVGCoord)(e.ownerSVGElement,r);A(t,k(i))},e.onpointerleave=n=>{if(S!==t)return;T(-1);const r=(0,o.clientCoord)(n),i=(0,o.screenToSVGCoord)(e.ownerSVGElement,r);A(t,k(i))},e.onpointerup=n=>{if(S!==t)return;T(-1);const r=(0,o.clientCoord)(n),i=(0,o.screenToSVGCoord)(e.ownerSVGElement,r);A(t,k(i))}}))}),[S,u]);const N=e=>Math.min(Math.max(l[e],n),a);return(0,r.jsx)("div",Object.assign({id:d,className:(0,o.classList)("common-draggable-graph",p),"aria-label":h,"aria-hidden":f,"aria-describedby":g,role:m},{children:(0,r.jsxs)("svg",Object.assign({className:"draggable-graph-svg",viewBox:`0 0 1000 ${x}`,xmlns:"http://www.w3.org/2000/svg"},{children:[(0,r.jsx)("defs",{children:(0,r.jsxs)("filter",Object.assign({id:"dropshadow"},{children:[(0,r.jsx)("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"3"}),(0,r.jsx)("feOffset",{dx:"0",dy:"0"}),(0,r.jsx)("feComponentTransfer",{children:(0,r.jsx)("feFuncA",{type:"linear",slope:"0.5"})}),(0,r.jsxs)("feMerge",{children:[(0,r.jsx)("feMergeNode",{}),(0,r.jsx)("feMergeNode",{in:"SourceGraphic"})]})]}))}),l.map(((e,n)=>{const i=n<l.length-1,o=Math.max(_*n-12.5,25),c=25+Math.max(w*(a-N(n))-12.5,12.5),u=i&&N(n+1)>N(n)||!i&&N(n-1)>N(n);return(0,r.jsxs)("g",Object.assign({className:"draggable-graph-column"},{children:[i&&(0,r.jsx)("path",{className:"draggable-graph-path",stroke:"black",fill:"none",strokeWidth:"2px",d:s(o,c,Math.max(_*(n+1),0),25+Math.max(w*(a-N(n+1))-12.5,12.5),t,y)}),(0,r.jsx)("circle",{className:"draggable-graph-point",cx:o+12.5,cy:c,r:25,fill:"white",filter:"url(#dropshadow)"}),(0,r.jsx)("text",Object.assign({className:"common-draggable-graph-text",x:i?o+50:o-25,y:u?c+50:Math.max(c-25,25),textAnchor:i?"start":"end",fontSize:25},{children:Math.round(N(n))+(b||"")})),(0,r.jsx)("rect",{className:"draggable-graph-surface",ref:O(n),x:o-_/6,y:0,width:_/3,height:x,fill:"white",opacity:0})]}),n)})),(0,r.jsx)("rect",Object.assign({x:"-2",y:"0",width:"1",height:"100%",fill:"grey"},{children:(0,r.jsx)("animate",{ref:e=>{e&&c&&c((t=>{t<=0&&(t=1),e.setAttribute("dur",t+"ms"),e.beginElement()}))},attributeName:"x",from:"2%",to:"98%",dur:"1000ms",begin:"indefinite"})}))]}))}))}},{"../util":41,react:366,"react/jsx-runtime":367}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Dropdown=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../util"),s=e("./Button"),a=e("./FocusList");n.Dropdown=e=>{const{id:t,className:n,ariaHidden:l,ariaLabel:c,role:u,items:d,tabIndex:p,selectedId:h,onItemSelected:f}=e,[g,m]=i.useState(!1);let v;const y=(0,o.classList)("common-dropdown",n),b=d.find((e=>e.id===h))||d[0];return(0,r.jsxs)("div",Object.assign({className:y,ref:e=>{e&&(v=e)},onBlur:e=>{v&&g&&!v.contains(e.relatedTarget)&&m(!1)}},{children:[(0,r.jsx)(s.Button,Object.assign({},b,{id:t,tabIndex:p,rightIcon:g?"fas fa-chevron-up":"fas fa-chevron-down",role:u,className:(0,o.classList)("common-dropdown-button",g&&"expanded",b.className),onClick:()=>{m(!g)},onKeydown:e=>{const t=d.indexOf(b);"ArrowDown"===e.key?t<d.length-1&&(f(d[t+1].id),e.preventDefault(),e.stopPropagation()):"ArrowUp"===e.key?t>0&&(f(d[t-1].id),e.preventDefault(),e.stopPropagation()):"Enter"===e.key&&(m(!0),e.preventDefault(),e.stopPropagation())},ariaHasPopup:"listbox",ariaExpanded:g,ariaLabel:c,ariaHidden:l})),g&&(0,r.jsx)(a.FocusList,Object.assign({role:"listbox",className:"common-menu-dropdown-pane common-dropdown-shadow",childTabStopId:h,"aria-labelledby":t,useUpAndDownArrowKeys:!0,onItemReceivedFocus:e=>{e.id&&d.some((t=>t.id===e.id))&&f(e.id)}},{children:(0,r.jsx)("ul",Object.assign({role:"presentation"},{children:d.map((e=>(0,r.jsx)("li",Object.assign({role:"presentation"},{children:(0,r.jsx)(s.Button,Object.assign({},e,{className:(0,o.classList)("common-dropdown-item",e.className),onClick:()=>{m(!1),f(e.id)},ariaSelected:e.id===h,role:"option"}))}),e.id)))}))}))]}))}},{"../util":41,"./Button":3,"./FocusList":9,react:366,"react/jsx-runtime":367}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EditorToggle=void 0;const r=e("react/jsx-runtime"),i=e("../util"),o=e("./Button"),s=e("./FocusList"),a=e("./MenuDropdown");n.EditorToggle=e=>{const{id:t,className:n,ariaHidden:o,ariaLabel:s,role:d,items:p,selected:h}=e,f=p.some((e=>u(e))),g=e=>{};return(0,r.jsxs)("div",Object.assign({className:"common-editor-toggle-outer"},{children:[(0,r.jsx)(c,Object.assign({},e)),(0,r.jsxs)("div",Object.assign({id:t,className:(0,i.classList)("common-editor-toggle",f&&"has-dropdown",n),role:d||"tablist","aria-hidden":!0,"aria-label":s},{children:[p.map(((e,t)=>{const n=h===t;return(0,r.jsxs)("div",Object.assign({className:(0,i.classList)("common-editor-toggle-item",n&&"selected",u(e)&&"common-editor-toggle-item-dropdown")},{children:[(0,r.jsx)(l,{item:e,isSelected:n,onKeydown:g}),u(e)&&(0,r.jsx)(a.MenuDropdown,{id:"toggle-dropdown",className:"toggle-dropdown",icon:"fas fa-chevron-down",title:lf("More options"),tabIndex:-1,ariaHidden:!0,items:e.items.map((e=>({title:e.title,label:e.label,onClick:e.onClick,leftIcon:e.icon})))})]}),t)})),(0,r.jsx)("div",{className:"common-editor-toggle-handle","aria-hidden":!0})]}))]}))};const l=e=>{const{item:t,isSelected:n,onKeydown:i}=e,{label:s,title:a,onClick:l,icon:c,focusable:u}=t;return(0,r.jsx)(o.Button,{className:c?void 0:"no-icon",role:u?"tab":void 0,tabIndex:-1,onKeydown:i,label:s,title:a,onClick:l,leftIcon:c,ariaHidden:!0})},c=e=>{const{items:t,id:n,selected:i,ariaHidden:a}=e,l=t.reduce(((e,t,n)=>{const r=[...e];return r.push(Object.assign({},t)),i===n&&(r[r.length-1].selected=!0),u(t)&&r.push(...t.items.filter((e=>e.focusable))),r}),[]);return(0,r.jsx)(s.FocusList,Object.assign({id:n,role:"tablist",className:"common-toggle-accessibility",childTabStopId:n+"-selected"},{children:l.map(((e,t)=>(0,r.jsx)(o.Button,{className:e.selected?"selected":void 0,id:e.selected?n+"-selected":void 0,role:"tab",title:e.title,label:e.label,onClick:e.onClick,ariaSelected:e.selected,ariaHidden:a},t)))}))};function u(e){var t;return!!(null===(t=e.items)||void 0===t?void 0:t.length)}},{"../util":41,"./Button":3,"./FocusList":9,"./MenuDropdown":15,"react/jsx-runtime":367}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FocusList=void 0;const r=e("react/jsx-runtime");n.FocusList=e=>{const{id:t,className:n,role:i,ariaHidden:o,ariaLabel:s,childTabStopId:a,children:l,onItemReceivedFocus:c,useUpAndDownArrowKeys:u}=e;let d,p;return(0,r.jsx)("div",Object.assign({id:t,className:n,role:i,tabIndex:a?void 0:0,onKeyDown:e=>{if(!(null==d?void 0:d.length))return;const t=document.activeElement,n=d.indexOf(t),r=e=>{e.focus(),c&&c(e)};-1===n&&t!==p||("Enter"===e.key||" "===e.key?(e.preventDefault(),e.stopPropagation(),t.click?t.click():t.dispatchEvent(new Event("click"))):e.key===(u?"ArrowDown":"ArrowRight")?(n===d.length-1||t===p?r(d[0]):r(d[n+1]),e.preventDefault(),e.stopPropagation()):e.key===(u?"ArrowUp":"ArrowLeft")?(r(0===n||t===p?d[d.length-1]:d[Math.max(n-1,0)]),e.preventDefault(),e.stopPropagation()):"Home"===e.key?(r(d[0]),e.preventDefault(),e.stopPropagation()):"End"===e.key&&(r(d[d.length-1]),e.preventDefault(),e.stopPropagation()))},ref:e=>{if(!e||p)return;p=e;const t=e.querySelectorAll('[tabindex]:not([tabindex="-1"]),[data-isfocusable]');d=[];for(const e of t.values())d.push(e),e.setAttribute("tabindex","-1"),e.setAttribute("data-isfocusable","true");if(a){const e=p.querySelector("#"+a);e&&e.setAttribute("tabindex","0")}},"aria-hidden":o,"aria-label":s},{children:l}))}},{"react/jsx-runtime":367}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FocusTrap=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../util");n.FocusTrap=e=>{const{children:t,id:n,className:s,onEscape:a,arrowKeyNavigation:l,dontStealFocus:c,includeOutsideTabOrder:u}=e;let d;const[p,h]=i.useState(!1),f=()=>(0,o.nodeListToArray)(u?d.querySelectorAll("[tabindex]"):d.querySelectorAll('[tabindex]:not([tabindex="-1"])'));return(0,r.jsx)("div",Object.assign({id:n,className:(0,o.classList)("common-focus-trap",s),ref:e=>{e&&(d=e,c||p||e.contains(document.activeElement)||!f().length||(d.focus(),h(!0)))},onKeyDown:e=>{if(!d)return;const t=(t,n)=>{const r=f();if(!r.length)return;const i=r.indexOf(e.target);t?n?r[r.length-1].focus():i===r.length-1?r[0].focus():r[i+1].focus():n?r[0].focus():0===i?r[r.length-1].focus():r[Math.max(i-1,0)].focus(),e.preventDefault(),e.stopPropagation()};"Escape"===e.key?(a(),e.preventDefault(),e.stopPropagation()):"Tab"===e.key?e.shiftKey?t(!1,!1):t(!0,!1):l&&("ArrowDown"===e.key?t(!0,!1):"ArrowUp"===e.key?t(!1,!1):"Home"===e.key?t(!1,!0):"End"===e.key&&t(!0,!0))},tabIndex:-1},{children:t}))}},{"../util":41,react:366,"react/jsx-runtime":367}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Input=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../util"),s=e("./Button");n.Input=e=>{const{id:t,className:n,inputClassName:a,groupClassName:l,role:c,ariaHidden:u,ariaLabel:d,initialValue:p,label:h,title:f,placeholder:g,icon:m,iconTitle:v,disabled:y,type:b,readOnly:x,autoComplete:E,selectOnClick:_,onChange:w,onEnterKey:S,onIconClick:T,onBlur:k,handleInputRef:C,preserveValueOnBlur:A}=e,[j,I]=i.useState(void 0);return(0,r.jsxs)("div",Object.assign({className:(0,o.classList)("common-input-wrapper",y&&"disabled",n)},{children:[h&&(0,r.jsx)("label",Object.assign({className:"common-input-label",htmlFor:t},{children:h})),(0,r.jsxs)("div",Object.assign({className:(0,o.classList)("common-input-group",l)},{children:[(0,r.jsx)("input",{id:t,className:(0,o.classList)("common-input",m&&"has-icon",a),title:f,role:c||"textbox",tabIndex:y?-1:0,"aria-label":d,"aria-hidden":u,type:b||"text",placeholder:g,value:void 0!==j?j:p||"",readOnly:!!x,onClick:e=>{_&&e.target.select()},onChange:e=>{const t=e.target.value;x||j===t||I(t),w&&w(t)},onKeyDown:t=>{const n="number"==typeof t.which?t.which:t.keyCode;(13===n||e.treatSpaceAsEnter&&32===n)&&S&&(t.preventDefault(),S(j))},onBlur:()=>{k&&k(j),A||I(void 0)},autoComplete:E?"":"off",autoCorrect:E?"":"off",autoCapitalize:E?"":"off",spellCheck:E,disabled:y,ref:C}),m&&(T?(0,r.jsx)(s.Button,{leftIcon:m,title:v,disabled:y,onClick:()=>{T&&T(j)}}):(0,r.jsx)("i",{className:m,"aria-hidden":!0}))]}))]}))}},{"../util":41,"./Button":3,react:366,"react/jsx-runtime":367}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LazyImage=void 0;const r=e("react/jsx-runtime");let i;n.LazyImage=e=>{const{id:t,className:n,role:o,src:s,alt:a,title:l,ariaLabel:c,ariaHidden:u,ariaDescribedBy:d}=e;let p;return function(){if(i)return;i=new IntersectionObserver((e=>{e.forEach((e=>{if(e.intersectionRatio>0){i.unobserve(e.target);const t=e.target.getAttribute("data-src");e.target.src=t;const n=e.target;n.src=t,n.onload=()=>{n.parentElement.classList.add("loaded"),n.parentElement.classList.remove("error")},n.onerror=()=>{n.parentElement.classList.add("error"),n.parentElement.classList.remove("loaded")}}}))}),{rootMargin:"50px 0px",threshold:.01})}(),(0,r.jsxs)("div",Object.assign({className:"common-lazy-image-wrapper"},{children:[(0,r.jsx)("img",{id:t,ref:e=>{e&&(p&&i.unobserve(p),p=e,i.observe(e))},className:n,"data-src":s,alt:a,title:l,role:o,"aria-label":c,"aria-hidden":u,"aria-describedby":d}),(0,r.jsx)("div",{className:"common-spinner"}),(0,r.jsx)("i",{className:"fas fa-image","aria-hidden":!0})]}))}},{"react/jsx-runtime":367}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Link=void 0;const r=e("react/jsx-runtime"),i=e("../util");n.Link=e=>{const{id:t,className:n,ariaLabel:o,href:s,target:a,children:l,tabIndex:c}=e,u=(0,i.classList)("common-link",n);return(0,r.jsx)("a",Object.assign({id:t,className:u,"aria-label":o,href:s,target:a,rel:"_blank"===a?"noopener noreferrer":"",tabIndex:null!=c?c:0},{children:l}))}},{"../util":41,"react/jsx-runtime":367}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.List=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../util");n.List=e=>{const{id:t,className:n,ariaHidden:s,ariaLabel:a,role:l}=e;return(0,r.jsx)("div",Object.assign({id:t,"aria-hidden":s,"aria-label":a,role:l,className:(0,o.classList)("common-list",n)},{children:i.Children.map(e.children,((e,t)=>(0,r.jsx)("div",Object.assign({className:"common-list-item"},{children:e}),t)))}))}},{"../util":41,react:366,"react/jsx-runtime":367}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MenuDropdown=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../util"),s=e("./Button"),a=e("./FocusTrap");n.MenuDropdown=e=>{const{id:t,className:n,ariaHidden:l,ariaLabel:c,role:u,items:d,label:p,title:h,icon:f,tabIndex:g}=e,[m,v]=i.useState(!1);let y,b;const x=(0,o.classList)("common-menu-dropdown",n),E=t+"-menu";return(0,r.jsxs)("div",Object.assign({className:x,ref:e=>{e&&(y=e)},onBlur:e=>{y&&m&&!y.contains(e.relatedTarget)&&v(!1)}},{children:[(0,r.jsx)(s.Button,{id:t,label:p,tabIndex:g,buttonRef:e=>{e&&(b=e)},title:h,leftIcon:f,role:u||"menuitem",className:(0,o.classList)("menu-button",m&&"expanded"),onClick:()=>{v(!m)},ariaHasPopup:"true",ariaExpanded:m,ariaControls:m?E:void 0,ariaLabel:c,ariaHidden:l}),m&&(0,r.jsx)("div",Object.assign({role:"menu",className:"common-menu-dropdown-pane",tabIndex:0,id:E,"aria-labelledby":t},{children:(0,r.jsx)(a.FocusTrap,Object.assign({arrowKeyNavigation:!0,onEscape:()=>{v(!1),b&&b.focus()}},{children:(0,r.jsx)("ul",Object.assign({role:"presentation"},{children:d.map(((e,t)=>(0,r.jsx)("li",Object.assign({role:"presentation"},{children:(0,r.jsx)(s.Button,Object.assign({},e,{className:(0,o.classList)("common-menu-dropdown-item",e.className),onClick:()=>{v(!1),e.onClick()},role:"menuitem",ariaPosInSet:t+1,ariaSetSize:d.length}))}),t)))}))}))}))]}))}},{"../util":41,"./Button":3,"./FocusTrap":10,react:366,"react/jsx-runtime":367}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Modal=void 0;const r=e("react/jsx-runtime"),i=e("react-dom"),o=e("../util"),s=e("./Button"),a=e("./FocusTrap");n.Modal=e=>{const{children:t,id:n,className:l,ariaLabel:c,ariaHidden:u,ariaDescribedBy:d,role:p,title:h,leftIcon:f,helpUrl:g,actions:m,onClose:v,parentElement:y,fullscreen:b,hideDismissButton:x}=e,E=e=>{v&&v()},_=(0,o.classList)("common-modal-container",b&&"fullscreen",l);return i.createPortal((0,r.jsx)(a.FocusTrap,Object.assign({className:_,onEscape:E},{children:(0,r.jsxs)("div",Object.assign({id:n,className:"common-modal",role:p||"dialog","aria-hidden":u,"aria-label":c,"aria-describedby":d,"aria-labelledby":"modal-title"},{children:[(0,r.jsxs)("div",Object.assign({className:"common-modal-header"},{children:[b&&!x&&(0,r.jsx)("div",Object.assign({className:"common-modal-back"},{children:(0,r.jsx)(s.Button,{className:"menu-button",onClick:E,title:lf("Go Back"),label:lf("Go Back"),leftIcon:"fas fa-arrow-left"})})),(0,r.jsxs)("div",Object.assign({id:"modal-title",className:"common-modal-title"},{children:[f&&(0,r.jsx)("i",{className:f,"aria-hidden":!0}),h]})),b&&g&&(0,r.jsx)("div",Object.assign({className:"common-modal-help"},{children:(0,r.jsx)(s.Button,{className:"menu-button",title:lf("Help on {0} dialog",h),href:e.helpUrl,onClick:()=>{},rightIcon:"fas fa-question"})})),!b&&!x&&(0,r.jsx)("div",Object.assign({className:"common-modal-close"},{children:(0,r.jsx)(s.Button,{className:"menu-button inverted",onClick:E,title:lf("Close"),rightIcon:"fas fa-times-circle"})}))]})),(0,r.jsx)("div",Object.assign({className:"common-modal-body"},{children:t})),(null==m?void 0:m.length)&&(0,r.jsx)("div",Object.assign({className:"common-modal-footer"},{children:m.map(((e,t)=>{var n;return(0,r.jsx)(s.Button,{className:null!==(n=e.className)&&void 0!==n?n:"primary inverted",disabled:e.disabled,onClick:e.onClick,href:e.url,label:e.label,title:e.label,rightIcon:(e.xicon?"xicon ":"")+e.icon,leftIcon:e.leftIcon},t)}))}))]}))})),y||document.getElementById("root")||document.body)}},{"../util":41,"./Button":3,"./FocusTrap":10,"react-dom":309,"react/jsx-runtime":367}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.RadioButtonGroup=void 0;const r=e("react/jsx-runtime"),i=e("../util"),o=e("./FocusList");n.RadioButtonGroup=e=>{const{id:t,className:n,ariaHidden:s,ariaLabel:a,role:l,choices:c,selectedId:u,onChoiceSelected:d}=e;return(0,r.jsx)(o.FocusList,Object.assign({id:t,className:(0,i.classList)("common-radio-group",n),ariaHidden:s,ariaLabel:a,role:l||"radiogroup",childTabStopId:u},{children:c.map((e=>(0,r.jsxs)("div",Object.assign({className:(0,i.classList)("common-radio-choice",e.className,u===e.id&&"selected"),onClick:()=>(e=>{d(e)})(e.id)},{children:[(0,r.jsx)("input",{type:"radio",id:e.id,value:e.id,name:t+"-input",checked:u===e.id,tabIndex:0,"aria-label":e.label?void 0:e.title,"aria-labelledby":e.label?e.id+"-label":void 0}),e.label&&(0,r.jsx)("span",Object.assign({id:e.id+"-label"},{children:e.label})),e.icon&&(0,r.jsx)("i",{className:e.icon,"aria-hidden":!0})]}),e.id)))}))}},{"../util":41,"./FocusList":9,"react/jsx-runtime":367}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TeachingBubble=void 0;const r=e("react/jsx-runtime"),i=e("react-dom"),o=e("./Button"),s=e("../animations/Confetti"),a=e("../util"),l=e("./FocusTrap"),c=e("react");n.TeachingBubble=e=>{const{id:t,className:n,ariaLabel:u,ariaHidden:d,ariaDescribedBy:p,role:h,targetContent:f,onClose:g,onNext:m,onBack:v,onFinish:y,stepNumber:b,totalSteps:x,parentElement:E,activeTarget:_}=e,w={above:!1,below:!1,left:!1,right:!1};(0,c.useEffect)((()=>(T(),S(),window.addEventListener("resize",T),()=>{window.removeEventListener("resize",T)})),[b]);const S=()=>{document.querySelector(".teaching-bubble-steps").style.visibility=b>x||1===x?"hidden":"visible"},T=()=>{const e=document.getElementById(t),n=document.querySelector(".teaching-bubble-arrow");n.style.border="none";const r=document.querySelector(".teaching-bubble-arrow-outline");r.style.border="none";const i=e.getBoundingClientRect(),o=document.querySelector(f.targetQuery),s=o.getBoundingClientRect(),a=k(s,o);C(a),A(a,e,i,n,r)},k=(e,t)=>{let n=e.top,r=e.left,i=e.width,o=e.height;if(f.sansQuery){const t=document.querySelector(f.sansQuery).getBoundingClientRect(),s={top:n,bottom:n+o,left:r,right:r+i,width:i,height:o};I(s,t)&&(2===f.sansLocation?(r=e.left+t.width,i=e.width-t.width):1===f.sansLocation&&(o=e.height-t.height,s.bottom>window.innerHeight&&(o-=s.bottom-window.innerHeight)))}if(4!==f.location){const e=parseFloat(window.getComputedStyle(t).paddingTop),s=parseFloat(window.getComputedStyle(t).paddingRight),a=parseFloat(window.getComputedStyle(t).paddingBottom),l=parseFloat(window.getComputedStyle(t).paddingLeft);e<10&&(n-=10+e,o+=10-e),a<10&&(o+=10-a),l<10&&(r-=10+l,i+=10-l),s<10&&(i+=10-s)}return{top:n,bottom:n+o,left:r,right:r+i,width:i,height:o}},C=e=>{const t=document.querySelector(".teaching-bubble-cutout");t.style.top=`${e.top}px`,t.style.height=`${e.height}px`,t.style.left=`${e.left}px`,t.style.width=`${e.width}px`,_&&(t.style.pointerEvents="none")},A=(e,t,n,r,i)=>{i.style.opacity="1",r.style.opacity="1",w.above=!1,w.below=!1,w.left=!1,w.right=!1;const o="10px solid transparent",s="12.5px solid transparent",a=()=>{const t=e.top-n.height-10,a=e.left-(n.width-e.width)/2;if(w.above=!0,!d(t,a))return;const l=t+n.height,c=e.left+(e.width-10)/2;r.style.borderLeft=o,r.style.borderRight=o,r.style.borderTop="10px solid",N(r,l,c),i.style.borderLeft=s,i.style.borderRight=s,i.style.borderTop="12.5px solid",N(i,l,c-2.5)},l=()=>{const t=e.bottom+10,a=e.left-(n.width-e.width)/2;if(w.below=!0,!d(t,a))return;const l=t-10,c=e.left+(e.width-10)/2;r.style.borderLeft=o,r.style.borderRight=o,r.style.borderBottom="10px solid",N(r,l,c),i.style.borderLeft=s,i.style.borderRight=s,i.style.borderBottom="12.5px solid",N(i,l-2.5,c-2.5)},c=()=>{const t=e.top-(n.height-e.height)/2,a=e.left-n.width-10;if(w.left=!0,!d(t,a))return;const l=t+(n.height-10)/2,c=e.left-10;r.style.borderLeft="10px solid",r.style.borderTop=o,r.style.borderBottom=o,N(r,l,c),i.style.borderLeft="12.5px solid",i.style.borderTop=s,i.style.borderBottom=s,N(i,l-2.5,c)},u=()=>{const t=e.top-(n.height-e.height)/2,a=e.right+10;if(w.right=!0,!d(t,a))return;const l=t+(n.height-10)/2,c=e.right;r.style.borderRight="10px solid",r.style.borderTop=o,r.style.borderBottom=o,N(r,l,c),i.style.borderRight="12.5px solid",i.style.borderTop=s,i.style.borderBottom=s,N(i,l-2.5,c-2.5)},d=(r,i)=>{const[o,s]=j(e,n,r,i);return o&&s?(N(t,o,s),!0):(p(),!1)},p=()=>{w.above?w.below?w.left?w.right?O(t,n):u():c():l():a()};switch(f.location){case 0:a();break;case 1:l();break;case 2:c();break;case 3:u();break;default:(()=>{const t=(e.height-n.height)/2+e.top,o=(e.width-n.width)/2+e.left;d(t,o),N(r,t+n.height/2,o+n.width/2),N(i,t+n.height/2,o+n.width/2),i.style.opacity="0",r.style.opacity="0"})()}},j=(e,t,n,r)=>{n<10&&(n=10),r<10&&(r=10);const i=r+t.width,o=n+t.height;return i<window.innerWidth-10&&o<window.innerHeight-10?[n,r]:(i>window.innerWidth&&(r-=i-window.innerWidth+10),o>window.innerHeight&&(n-=o-window.innerHeight+10),I(e,t,n,r)?[null,null]:[n,r])},I=(e,t,n,r)=>{const i=(null!=r?r:t.left)<e.left+e.width,o=(null!=r?r:t.left)+t.width>e.left,s=(null!=n?n:t.top)<e.top+e.height,a=(null!=n?n:t.top)+t.height>e.top;return i&&o&&s&&a},O=(e,t)=>{N(e,(window.innerHeight-t.height)/2,(window.innerWidth-t.width)/2)},N=(e,t,n)=>{t<10&&(t=10),n<10&&(n=10),e.style.top=t+"px",e.style.left=n+"px"},R=b>1,P=b<x+1,D=x>1,M=lf("Close"),L=lf("Back"),B=lf("Next"),F=D?lf("Finish"):lf("Got it"),U=(0,a.classList)("teaching-bubble-container",n);return i.createPortal((0,r.jsxs)(l.FocusTrap,Object.assign({className:U,onEscape:g},{children:[b===x+1&&(0,r.jsx)(s.Confetti,{}),(0,r.jsx)("div",{className:"teaching-bubble-cutout"}),(0,r.jsx)("div",{className:"teaching-bubble-arrow"}),(0,r.jsx)("div",{className:"teaching-bubble-arrow-outline"}),(0,r.jsxs)("div",Object.assign({id:t,className:"teaching-bubble",role:h||"dialog","aria-hidden":d,"aria-label":u,"aria-describedby":p,"aria-labelledby":"teaching-bubble-title"},{children:[(0,r.jsx)(o.Button,{className:"teaching-bubble-close",onClick:g,title:M,ariaLabel:M,rightIcon:"fas fa-times-circle"}),(0,r.jsxs)("div",Object.assign({className:"teaching-bubble-content"},{children:[(0,r.jsx)("strong",Object.assign({"aria-live":"polite"},{children:f.title})),(0,r.jsx)("p",Object.assign({"aria-live":"polite"},{children:f.description})),(0,r.jsxs)("div",Object.assign({className:"teaching-bubble-footer "+(D?"":"no-steps")},{children:[D&&(0,r.jsxs)("div",Object.assign({className:"teaching-bubble-steps","aria-live":"polite"},{children:[b," of ",x]})),(0,r.jsxs)("div",Object.assign({className:"teaching-bubble-navigation"},{children:[R&&(0,r.jsx)(o.Button,{className:"primary",onClick:v,title:L,ariaLabel:L,label:L}),P&&(0,r.jsx)(o.Button,{className:"primary inverted",onClick:m,title:B,ariaLabel:B,label:B}),!P&&(0,r.jsx)(o.Button,{className:"primary inverted",onClick:y,title:F,ariaLabel:F,label:F})]}))]}))]}))]}))]})),E||document.getElementById("root")||document.body)}},{"../animations/Confetti":2,"../util":41,"./Button":3,"./FocusTrap":10,react:366,"react-dom":309,"react/jsx-runtime":367}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Textarea=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../util");n.Textarea=e=>{const{id:t,className:n,role:s,ariaHidden:a,ariaLabel:l,initialValue:c,label:u,title:d,placeholder:p,autoComplete:h,cols:f,rows:g,disabled:m,minLength:v,readOnly:y,resize:b,wrap:x,onChange:E,onEnterKey:_}=e,[w,S]=i.useState(c||"");return i.useEffect((()=>{S(c)}),[c]),(0,r.jsxs)("div",Object.assign({className:(0,o.classList)("common-textarea-wrapper",m&&"disabled",b&&`resize-${b}`,n)},{children:[u&&(0,r.jsx)("label",Object.assign({className:"common-textarea-label"},{children:u})),(0,r.jsx)("div",Object.assign({className:"common-textarea-group"},{children:(0,r.jsx)("textarea",{id:t,className:"common-textarea",title:d,role:s||"textbox",tabIndex:m?-1:0,"aria-label":l,"aria-hidden":a,placeholder:p,value:w||"",cols:f,rows:g,minLength:v,wrap:x,readOnly:!!y,onChange:e=>{const t=e.target.value;y||w===t||S(t),E&&E(t)},onKeyDown:e=>{const t="number"==typeof e.which?e.which:e.keyCode;13!==t&&32!==t||_&&(e.preventDefault(),_(w))},autoComplete:h?"":"off",autoCorrect:h?"":"off",autoCapitalize:h?"":"off",spellCheck:h,disabled:m})}))]}))}},{"../util":41,react:366,"react/jsx-runtime":367}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DeleteConfirmationModal=void 0;const r=e("react/jsx-runtime"),i=e("../controls/Modal");n.DeleteConfirmationModal=e=>{const t=[{label:lf("Cancel"),onClick:e.onCancelClick},{label:lf("Remove"),className:"red",onClick:()=>{e.onDeleteClick(e.ns)}}];return(0,r.jsx)(i.Modal,Object.assign({title:lf("Removing extension"),actions:t,onClose:e.onCancelClick},{children:lf("Are you sure you want to remove this extension? Doing so will remove any of its blocks that you used in your code and other extensions that use it.")}))}},{"../controls/Modal":16,"react/jsx-runtime":367}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ExtensionCard=void 0;const r=e("react/jsx-runtime"),i=e("../controls/Button"),o=e("../controls/Card"),s=e("../controls/LazyImage"),a=e("../util");n.ExtensionCard=e=>{const{title:t,description:n,imageUrl:l,learnMoreUrl:c,label:u,onClick:d,extension:p,loading:h,showDisclaimer:f}=e,g=pxt.Util.guidGen();return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(o.Card,Object.assign({className:(0,a.classList)("common-extension-card",h&&"loading"),onClick:()=>{d&&d(p)},ariaLabelledBy:g+"-title",ariaDescribedBy:g+"-description",tabIndex:d&&0,label:u},{children:[(0,r.jsx)("div",Object.assign({className:"common-extension-card-contents"},{children:!h&&(0,r.jsxs)(r.Fragment,{children:[l&&(0,r.jsx)(s.LazyImage,{src:l,alt:t}),(0,r.jsx)("div",Object.assign({className:"common-extension-card-title",id:g+"-title"},{children:t})),(0,r.jsx)("div",Object.assign({className:"common-extension-card-description"},{children:(0,r.jsx)("div",Object.assign({id:g+"-description"},{children:n}))})),(f||c)&&(0,r.jsxs)("div",Object.assign({className:"common-extension-card-extra-content"},{children:[f&&lf("User-provided extension, not endorsed by Microsoft."),c&&(0,r.jsx)(i.Button,{className:"link-button",label:lf("Learn More"),title:lf("Learn More"),onClick:()=>{},href:c})]}))]})})),(0,r.jsx)("div",{className:"common-spinner"})]}))})}},{"../controls/Button":3,"../controls/Card":4,"../controls/LazyImage":12,"../util":41,"react/jsx-runtime":367}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ImportModal=void 0;const r=e("react/jsx-runtime"),i=e("../controls/Modal");n.ImportModal=e=>{const t=[{label:lf("Cancel"),onClick:e.onCancelClick},{label:lf("Import"),onClick:()=>{e.onImportClick(document.getElementById("url-input").value)}}];return(0,r.jsxs)(i.Modal,Object.assign({title:lf("Import extension"),actions:t,className:"import-extension-modal"},{children:[lf("Enter Github project URL"),(0,r.jsx)("input",{id:"url-input"})]}))}},{"../controls/Modal":16,"react/jsx-runtime":367}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ColorPickerField=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../controls/Button"),s=e("../controls/Input");n.ColorPickerField=e=>{const{index:t,color:n,onColorChanged:a,onMoveColor:l}=e,[c,u]=i.useState(void 0);return(0,r.jsxs)("div",Object.assign({className:"common-color-picker-field"},{children:[(0,r.jsx)("div",Object.assign({className:"common-color-index"},{children:t})),(0,r.jsxs)("div",Object.assign({className:"common-color-inputs"},{children:[(0,r.jsx)("input",{className:"color-input",type:"color",value:c||n,onBlur:()=>{c&&a(c),u(void 0)},onChange:e=>{u(e.target.value.toUpperCase())}}),(0,r.jsx)(s.Input,{initialValue:c||n.toUpperCase(),onChange:e=>{"#"!=(null==(e=e.trim())?void 0:e[0])&&(e="#"+e),e.length>7&&(e=e.substring(0,7)),/#[0-9a-fA-F]{6}/.test(e)&&a(e.toUpperCase())}})]})),(0,r.jsx)(o.Button,{className:"circle-button",title:lf("Move color up"),leftIcon:"fas fa-arrow-up",onClick:()=>l(!0),disabled:1===t}),(0,r.jsx)(o.Button,{className:"circle-button",title:lf("Move color down"),leftIcon:"fas fa-arrow-down",onClick:()=>l(!1),disabled:15===t})]}))}},{"../controls/Button":3,"../controls/Input":11,react:366,"react/jsx-runtime":367}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PaletteEditor=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("./ColorPickerField");n.PaletteEditor=e=>{const{palette:t,onPaletteChanged:n}=e,[s,a]=(0,i.useState)(t);return(0,i.useEffect)((()=>{n(s)}),[s]),(0,i.useEffect)((()=>{a(t)}),[t]),(0,r.jsx)("div",Object.assign({className:"common-palette-editor"},{children:s.colors.slice(1).map(((e,t)=>(0,r.jsx)(o.ColorPickerField,{index:t+1,color:e,onColorChanged:e=>((e,t)=>{const n=s;a(Object.assign(Object.assign({},n),{colors:n.colors.map(((n,r)=>e===r?t:n))}))})(t+1,e),onMoveColor:e=>((e,t)=>{const n=s,r=Object.assign(Object.assign({},n),{colors:n.colors.slice()});t?e>1&&(r.colors[e-1]=n.colors[e],r.colors[e]=n.colors[e-1]):e<r.colors.length-1&&(r.colors[e+1]=n.colors[e],r.colors[e]=n.colors[e+1]),a(r)})(t+1,e)},t+1)))}))}},{"./ColorPickerField":23,react:366,"react/jsx-runtime":367}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PalettePicker=void 0;const r=e("react/jsx-runtime"),i=e("../controls/Dropdown"),o=e("./PaletteSwatch");n.PalettePicker=e=>{const{palettes:t,selectedId:n,onPaletteSelected:s}=e;return(0,r.jsx)(i.Dropdown,{id:"common-palette-picker",selectedId:n,onItemSelected:e=>{s(t.find((t=>t.id===e)))},items:t.map((e=>({id:e.id,title:e.name,label:(0,r.jsx)(o.PaletteSwatch,{palette:e})})))})}},{"../controls/Dropdown":7,"./PaletteSwatch":26,"react/jsx-runtime":367}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PaletteSwatch=void 0;const r=e("react/jsx-runtime");n.PaletteSwatch=e=>{const{palette:t}=e;return(0,r.jsxs)("div",Object.assign({className:"common-palette-swatch"},{children:[(0,r.jsx)("div",Object.assign({className:"common-palette-swatch-name"},{children:t.name})),(0,r.jsx)("div",Object.assign({className:"common-palette-color-list"},{children:t.colors.slice(1).map(((e,t)=>(0,r.jsx)(i,{color:e},t)))}))]}))};const i=e=>(0,r.jsx)("div",{className:"common-palette-color",style:{backgroundColor:e.color}})},{"react/jsx-runtime":367}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AllPalettes=n.Arcade=n.Adventure=n.Sweet=n.SteamPunk=n.StillLife=n.DIY=n.Poke=n.Grayscale=n.Matte=n.Pastel=n.Adafruit=void 0,n.Adafruit={id:"Adafruit",name:lf("Adafruit"),colors:["#000000","#FFFFFF","#FF0000","#FF007D","#FF7a00","#e5FF00","#2D9F00","#00FF72","#0034FF","#17ABFF","#C600FF","#636363","#7400DB","#00EFFF","#DF2929","#000000"]},n.Pastel={id:"Pastel",name:lf("Pastel"),colors:["#000000","#fff7e4","#f98284","#feaae4","#ffc384","#fff7a0","#87a889","#b0eb93","#b0a9e4","#accce4","#b3e3da","#d9c8bf","#6c5671","#ffe6c6","#dea38b","#28282e"]},n.Matte={id:"Matte",name:lf("Matte"),colors:["#000000","#FFF1E8","#FF004D","#FF77A8","#FFA300","#FFEC27","#008751","#00E436","#29ADFF","#C2C3C7","#7E2553","#83769C","#5F574F","#FFCCAA","#AB5236","#1D2B53"]},n.Grayscale={id:"Grayscale",name:lf("Grayscale"),colors:["#000000","#FFFFFF","#EDEDED","#DBDBDB","#C8C8C8","#B6B6B6","#A4A4A4","#929292","#808080","#6D6D6D","#5B5B5B","#494949","#373737","#242424","#121212","#000000"]},n.Poke={id:"Poke",name:lf("Poke"),colors:["#000000","#ffffff","#d45362","#e8958b","#cc8945","#f5dc8c","#417d53","#5dd48f","#5162c2","#6cadeb","#b56edd","#8f3f29","#612431","#c0fac2","#24325e","#1b1221"]},n.DIY={id:"DIY",name:lf("DIY"),colors:["#000000","#f8f8f8","#f80000","#FF93C4","#f8a830","#f8f858","#089050","#70d038","#2868c0","#10c0c8","#c868e8","#c0c0c0","#787878","#f8d898","#c04800","#000000"]},n.StillLife={id:"StillLife",name:lf("Still Life"),colors:["#000000","#a8e4d4","#d13b27","#e07f8a","#cc8218","#b3e868","#5d853a","#68c127","#286fb8","#9b8bff","#3f2811","#513155","#122615","#c7b581","#7a2222","#000000"]},n.SteamPunk={id:"SteamPunk",name:lf("Steam Punk"),colors:["#000000","#c0d1cc","#603b3a","#170e19","#775c4f","#77744f","#4f7754","#a19f7c","#4f5277","#65738c","#3a604a","#213b25","#433a60","#7c94a1","#3b2137","#2f213b"]},n.Sweet={id:"Sweet",name:lf("Sweet"),colors:["#000000","#f4f4f4","#b13e53","#a7f070","#ef7d57","#ffcd75","#257179","#38b764","#29366f","#3b5dc9","#41a6f6","#566c86","#333c57","#94b0c2","#5d275d","#1a1c2c"]},n.Adventure={id:"Adventure",name:lf("Adventure"),colors:["#000000","#f5edba","#9d303b","#d26471","#e4943a","#c0c741","#647d34","#34859d","#17434b","#7ec4c1","#584563","#8c8fae","#3e2137","#d79b7d","#9a6348","#1f0e1c"]},n.Arcade={id:"Arcade",name:lf("Arcade"),colors:["#000000","#FFFFFF","#FF2121","#FF93C4","#FF8135","#FFF609","#249CA3","#78DC52","#003FAD","#87F2FF","#8E2EC4","#A4839F","#5C406c","#E5CDC4","#91463d","#000000"]},n.AllPalettes=[n.Arcade,n.Matte,n.Pastel,n.Sweet,n.Poke,n.Adventure,n.DIY,n.Adafruit,n.StillLife,n.SteamPunk,n.Grayscale]},{}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Badge=void 0;const r=e("react/jsx-runtime"),i=e("../util");n.Badge=e=>{const{badge:t,disabled:n,isNew:o,onClick:s}=e,a=s&&(()=>{s(t)}),l=n&&t.lockedImage||t.image,c=n?pxt.U.lf("Locked '{0}' badge",t.title):t.title;return(0,r.jsxs)("div",Object.assign({className:"profile-badge "+(s?"clickable":""),role:s?"button":void 0,tabIndex:s?0:void 0,title:lf("{0} Badge",t.title),onClick:a,onKeyDown:i.fireClickOnEnter},{children:[o&&(0,r.jsx)("div",Object.assign({className:"profile-badge-notification"},{children:pxt.U.lf("New!")})),(0,r.jsx)("img",{src:l,alt:c})]}))}},{"../util":41,"react/jsx-runtime":367}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.badgeDescription=n.BadgeInfo=void 0;const r=e("react/jsx-runtime"),i=e("../util"),o=e("./Badge");n.BadgeInfo=e=>{const{badge:t}=e,i=new Date(t.timestamp);return(0,r.jsxs)("div",Object.assign({className:"profile-badge-info"},{children:[(0,r.jsx)("div",Object.assign({className:"profile-badge-info-image"},{children:(0,r.jsx)(o.Badge,{badge:t,disabled:!t.timestamp})})),(0,r.jsxs)("div",Object.assign({className:"profile-badge-info-item",id:"profile-badge-info-"+t.id},{children:[(0,r.jsx)("div",Object.assign({className:"profile-badge-info-header"},{children:lf("Awarded For:")})),(0,r.jsx)("div",Object.assign({className:"profile-badge-info-text"},{children:(0,n.badgeDescription)(t)}))]})),t.timestamp?(0,r.jsxs)("div",Object.assign({className:"profile-badge-info-item"},{children:[(0,r.jsx)("div",Object.assign({className:"profile-badge-info-header"},{children:lf("Awarded On:")})),(0,r.jsx)("div",Object.assign({className:"profile-badge-info-text"},{children:i.toLocaleDateString(pxt.U.userLanguage())}))]})):void 0]}))};function s(e){var t;if(-1!==e.indexOf("/api/md/")){const n=e.split("/api/md/")[1].split("/").slice(1).join("/");return(null===(t=pxt.webConfig)||void 0===t?void 0:t.skillmapUrl)+"#docs:"+n}{const t=e.split("#");if(2==t.length)return pxt.webConfig.skillmapUrl+"#github:https://github.com/"+t[0]+"/"+t[1]}return pxt.BrowserUtils.isLocalHostDev()?"http://localhost:3000#local:"+e:e}n.badgeDescription=e=>{switch(e.type){case"skillmap-completion":return(0,r.jsx)("span",{children:(0,i.jsxLF)(lf("Completing {0}"),(0,r.jsx)("a",Object.assign({tabIndex:0,"aria-labelledby":"profile-badge-info-"+e.id,target:"_blank",rel:"noopener noreferrer",href:s(e.sourceURL)},{children:pxt.U.rlf(e.title)})))})}}},{"../util":41,"./Badge":28,"react/jsx-runtime":367}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BadgeList=void 0;const r=e("react/jsx-runtime"),i=e("./Badge");n.BadgeList=e=>{const{onBadgeClick:t,availableBadges:n,userState:o}=e,s=n.slice();let a={};for(const e of o.badges){a[e.id]=!0;const t=s.findIndex((t=>t.id===e.id));t>-1?s[t]=Object.assign(Object.assign({},s[t]),{timestamp:s[t].timestamp||e.timestamp}):s.push(e)}const l=[];for(let e=0;e<Math.max(s.length+10,20);e++)l.push((0,r.jsx)("div",{className:"placeholder-badge"},e));return(0,r.jsxs)("div",Object.assign({className:"profile-badge-list"},{children:[(0,r.jsxs)("div",Object.assign({className:"profile-badge-header",id:"profile-badge-header"},{children:[(0,r.jsx)("span",Object.assign({className:"profile-badge-title"},{children:lf("Badges")})),(0,r.jsx)("span",Object.assign({className:"profile-badge-subtitle"},{children:lf("Click each badge to see details")}))]})),(0,r.jsx)("div",Object.assign({className:"profile-badges-scroller"},{children:(0,r.jsxs)("div",Object.assign({className:"profile-badges",role:"list","aria-labelledby":"profile-badge-header"},{children:[(0,r.jsx)("div",Object.assign({className:"profile-badges-background-container","aria-hidden":"true"},{children:(0,r.jsx)("div",Object.assign({className:"profile-badges-background"},{children:l}))})),s.map((e=>(0,r.jsxs)("div",Object.assign({className:"profile-badge-and-title",role:"listitem"},{children:[(0,r.jsx)(i.Badge,{onClick:t,badge:e,disabled:!a[e.id]}),(0,r.jsx)("div",Object.assign({className:"profile-badge-name"},{children:e.title}))]}),e.id)))]}))}))]}))}},{"./Badge":28,"react/jsx-runtime":367}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Profile=void 0;const r=e("react/jsx-runtime"),i=e("./BadgeList"),o=e("./UserPane"),s=e("./BadgeInfo");n.Profile=e=>{var t,n,a;const{user:l,signOut:c,deleteProfile:u,onClickedEmail:d,notification:p,checkedEmail:h,showModalAsync:f}=e,g=(null==l?void 0:l.profile)||{idp:{}},m=(null===(t=null==l?void 0:l.preferences)||void 0===t?void 0:t.badges)||{badges:[]},v=(null===(a=null===(n=pxt.appTarget)||void 0===n?void 0:n.cloud)||void 0===a?void 0:a.showBadges)||!1;return(0,r.jsxs)("div",Object.assign({className:"user-profile"},{children:[(0,r.jsx)(o.UserPane,{profile:g,onSignOutClick:c,onDeleteProfileClick:u,notification:p,emailChecked:h,onEmailCheckClick:d}),v&&(0,r.jsx)(i.BadgeList,{availableBadges:pxt.appTarget.defaultBadges||[],userState:m,onBadgeClick:e=>{f({header:lf("{0} Badge",e.title),size:"tiny",hasCloseIcon:!0,onClose:()=>{const e=document.body.querySelector(".common-modal-container.fullscreen [tabindex]");e&&e.focus()},jsx:(0,r.jsx)(s.BadgeInfo,{badge:e})})}})]}))}},{"./BadgeInfo":29,"./BadgeList":30,"./UserPane":34,"react/jsx-runtime":367}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SignInModal=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../controls/Checkbox"),s=e("../controls/Button"),a=e("../controls/Link"),l=e("../controls/Modal");n.SignInModal=e=>{var t,n;const{onSignIn:c,onClose:u,appMessage:d,dialogMessages:p,hideDismissButton:h}=e,{signInMessage:f,signUpMessage:g}=p||{signInMessage:lf("Sign in to save your progress and access your work anytime, anywhere."),signUpMessage:lf("Join now to save your progress and access your work anytime, anywhere.")},m=null!==(t=e.resolvePath)&&void 0!==t?t:e=>e,[v,y]=i.useState(!1),[b,x]=i.useState(null!==(n=e.mode)&&void 0!==n?n:"signin"),E=i.useMemo((()=>"signin"===b?lf("Sign in"):lf("Sign up")),[b]),_=i.useMemo((()=>"signin"===b?f:g),[b,f,g]),w=i.useMemo((()=>"signin"===b?(0,r.jsxs)("div",Object.assign({className:"switch"},{children:[(0,r.jsx)("span",{children:lf("Don't have an account?")}),(0,r.jsx)(s.Button,{className:"link-button",onClick:()=>x("signup"),title:lf("Sign up"),label:lf("Sign up")})]})):(0,r.jsxs)("div",Object.assign({className:"switch"},{children:[(0,r.jsx)("span",{children:lf("Have an account?")}),(0,r.jsx)(s.Button,{className:"link-button",onClick:()=>x("signin"),title:lf("Sign in"),label:lf("Sign in")})]}))),[b]);return(0,r.jsx)(l.Modal,Object.assign({title:E,onClose:u,hideDismissButton:h},{children:(0,r.jsxs)("div",Object.assign({className:"signin-form"},{children:[(0,r.jsxs)("div",Object.assign({className:"signin-header"},{children:[d||void 0," ",_]})),(0,r.jsx)("div",Object.assign({className:"signin-body"},{children:(0,r.jsxs)("div",Object.assign({className:"providers"},{children:[pxt.auth.identityProviders().map(((e,t)=>{const n="signin"===b?lf("Continue with {0}",e.name):lf("Sign up with {0}",e.name);return(0,r.jsx)(s.Button,{className:"teal inverted provider",onClick:()=>c(e,v),title:n,ariaLabel:n,label:(0,r.jsxs)("div",Object.assign({className:"label"},{children:[(0,r.jsx)("div",{children:(0,r.jsx)("img",{className:"logo",src:m(e.icon)})}),(0,r.jsx)("div",Object.assign({className:"title"},{children:n}))]}))},t)})),(0,r.jsx)("div",Object.assign({className:"rememberme"},{children:(0,r.jsx)(o.Checkbox,{id:"rememberme",label:lf("Remember me"),isChecked:v,onChange:y})}))]}))})),(0,r.jsxs)("div",Object.assign({className:"signin-footer"},{children:[w,(0,r.jsx)("div",Object.assign({className:"learn"},{children:(0,r.jsx)(a.Link,Object.assign({href:"/identity/sign-in",target:"_blank"},{children:lf("Learn more")}))}))]}))]}))}))}},{"../controls/Button":3,"../controls/Checkbox":5,"../controls/Link":13,"../controls/Modal":16,react:366,"react/jsx-runtime":367}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UserNotification=void 0;const r=e("react/jsx-runtime");n.UserNotification=e=>{const{message:t,icon:n,actionText:i,link:o,xicon:s,title:a}=e.notification;return(0,r.jsxs)("div",Object.assign({className:"profile-notification"},{children:[(0,r.jsx)("div",Object.assign({className:"profile-notification-icon"},{children:(0,r.jsx)("i",{className:`${s?"xicon":"ui large circular icon "} ${n}`})})),(0,r.jsx)("div",Object.assign({className:"profile-notification-title"},{children:a})),(0,r.jsx)("div",Object.assign({className:"profile-notification-message"},{children:t})),(0,r.jsxs)("button",Object.assign({className:"ui icon button profile-notification-button",onClick:()=>{window.open(o,"_blank")},role:"link"},{children:[(0,r.jsx)("i",{className:"icon external alternate"}),i]}))]}))}},{"react/jsx-runtime":367}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UserPane=void 0;const r=e("react/jsx-runtime"),i=e("../util"),o=e("./UserNotification"),s=e("../controls/Checkbox"),a=e("../controls/Button");n.UserPane=e=>{const{profile:t,onSignOutClick:n,onDeleteProfileClick:l,onEmailCheckClick:c,notification:u,emailChecked:d}=e,{username:p,displayName:h,picture:f,pictureUrl:g}=t.idp,m=null!=g?g:null==f?void 0:f.dataUrl,v=(0,r.jsxs)(r.Fragment,{children:[d===i.CheckboxStatus.Waiting?(0,r.jsx)("div",{className:"common-spinner"}):void 0,lf("I would like to receive the MakeCode newsletter. "),(0,r.jsx)("a",Object.assign({href:"https://makecode.com/privacy",target:"_blank",rel:"noopener noreferrer",tabIndex:0},{children:lf("View Privacy Statement")}))]});return(0,r.jsxs)("div",Object.assign({className:"profile-user-pane"},{children:[(0,r.jsx)("div",Object.assign({className:"profile-portrait"},{children:m?(0,r.jsx)("div",{children:(0,r.jsx)("img",{src:m,alt:pxt.U.lf("Profile Picture"),referrerPolicy:"no-referrer"})}):(0,r.jsx)("div",Object.assign({className:"profile-initials-portrait"},{children:pxt.auth.userInitials(t)}))})),(0,r.jsxs)("div",Object.assign({className:"profile-user-details"},{children:[(0,r.jsx)("div",Object.assign({className:"profile-display-name"},{children:h})),p&&(0,r.jsx)("div",Object.assign({className:"profile-username"},{children:p}))]})),u&&(0,r.jsx)(o.UserNotification,{notification:u}),(0,r.jsx)("div",{className:"profile-spacer"}),(0,r.jsx)("div",Object.assign({className:"profile-email"},{children:(0,r.jsx)(s.Checkbox,{id:"profile-email-checkbox",className:d===i.CheckboxStatus.Waiting?"loading":"",isChecked:d===i.CheckboxStatus.Selected,onChange:c,label:v})})),(0,r.jsxs)("div",Object.assign({className:"profile-actions"},{children:[(0,r.jsx)(a.Button,{className:"link-button",title:lf("Delete Profile"),label:lf("Delete Profile"),onClick:l}),(0,r.jsx)(a.Button,{className:"sign-out",leftIcon:"fas fa-sign-out-alt",title:lf("Sign Out"),label:lf("Sign Out"),onClick:n})]}))]}))}},{"../controls/Button":3,"../controls/Checkbox":5,"../util":41,"./UserNotification":33,"react/jsx-runtime":367}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.addGameToKioskAsync=void 0;n.addGameToKioskAsync=async(e,t)=>{const n=await fetch("https://makecode.com/api/kiosk/updatecode",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({kioskCode:e,shareId:t})});if(!n.ok)throw new Error(n.statusText)}},{}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MultiplayerConfirmation=void 0;const r=e("react/jsx-runtime"),i=e("../controls/Modal");n.MultiplayerConfirmation=e=>{const{onCancelClicked:t,onConfirmClicked:n}=e,o=[{label:lf("Cancel"),onClick:t},{label:lf("Share and Host"),onClick:n,className:"primary"}];return(0,r.jsx)(i.Modal,Object.assign({title:lf("Host a multiplayer game"),actions:o,onClose:t},{children:lf("This will share the code of your game publicly. Is that okay?")}))}},{"../controls/Modal":16,"react/jsx-runtime":367}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Share=void 0;const r=e("react/jsx-runtime"),i=e("./ShareInfo");n.Share=e=>{const{projectName:t,screenshotUri:n,isLoggedIn:o,simRecorder:s,publishAsync:a,hasProjectBeenPersistentShared:l,anonymousShareByDefault:c,setAnonymousSharePreference:u,isMultiplayerGame:d,kind:p,onClose:h}=e;return(0,r.jsx)("div",Object.assign({className:"project-share"},{children:(0,r.jsx)(i.ShareInfo,{projectName:t,isLoggedIn:o,screenshotUri:n,simRecorder:s,publishAsync:a,isMultiplayerGame:d,kind:p,hasProjectBeenPersistentShared:l,anonymousShareByDefault:c,setAnonymousSharePreference:u,onClose:h})}))}},{"./ShareInfo":38,"react/jsx-runtime":367}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ShareInfo=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../controls/Button"),s=e("../controls/EditorToggle"),a=e("../controls/Input"),l=e("../controls/Textarea"),c=e("../controls/Modal"),u=e("./ThumbnailRecorder"),d=e("./SocialButton"),p=e("../controls/Checkbox"),h=e("./MultiplayerConfirmation"),f=e("./Kiosk"),g=e("../Notification"),m=e("../util");n.ShareInfo=e=>{var t,n,v,y,b,x,E;const{projectName:_,description:w,screenshotUri:S,isLoggedIn:T,simRecorder:k,publishAsync:C,hasProjectBeenPersistentShared:A,anonymousShareByDefault:j,setAnonymousSharePreference:I,isMultiplayerGame:O,kind:N,onClose:R}=e,[P,D]=i.useState(_),[M,L]=i.useState(S),[B,F]=i.useState("share"),[U,H]=i.useState(),[G,q]=i.useState("none"),[V,z]=i.useState(!1),[W,K]=i.useState(!1),[$,Y]=i.useState(!1),[X,J]=i.useState(!1),[Q,Z]=i.useState(!T||j),[ee,te]=i.useState(!1),ne=!!k,re="publish"!==B;let ie,oe,se;i.useEffect((()=>{L(S)}),[S]),i.useEffect((()=>{T?pxt.tickEvent("share.open.loggedIn",{state:B,anonymous:null==Q?void 0:Q.toString(),persistent:null==A?void 0:A.toString()}):pxt.tickEvent("share.open",{state:B})}),[B,Q,A]);const ae=()=>{F("share")},le=[{name:"code",label:lf("Code"),title:lf("Code"),focusable:!0,onClick:()=>q("code")},{name:"editor",label:lf("Editor"),title:lf("Editor"),focusable:!0,onClick:()=>q("editor")},{name:"simulator",label:lf("Simulator"),title:lf("Simulator"),focusable:!0,onClick:()=>q("simulator")}],ce="share"===B||"publishing"===B,ue=ce?lf("Project Title"):lf("Project Link");return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",Object.assign({className:"project-share-info"},{children:[ne&&"gifrecord"!==B&&(0,r.jsxs)("div",Object.assign({className:"project-share-thumbnail"},{children:[M?(0,r.jsx)("img",{src:M}):(0,r.jsx)("div",Object.assign({className:"project-thumbnail-placeholder"},{children:(0,r.jsx)("div",{className:"common-spinner"})})),"publish"!==B&&(0,r.jsx)(o.Button,{className:"link-button",title:lf("Update project thumbnail"),label:lf("Update project thumbnail"),onClick:()=>F("gifrecord")})]})),(0,r.jsxs)("div",Object.assign({className:"project-share-content"},{children:[(ce||"publish"===B)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",Object.assign({className:"project-share-title project-share-label",id:"share-input-title"},{children:ue})),re&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.Input,{ariaDescribedBy:"share-input-title",className:"name-input",initialValue:P,placeholder:lf("Name your project"),onChange:D}),T&&A&&(0,r.jsx)(p.Checkbox,{id:"persistent-share-checkbox",label:lf("Update existing share link for this project"),isChecked:!Q,onChange:e=>{pxt.tickEvent("share.persistentCheckbox",{checked:e.toString()}),Z(!e),I&&I(!e)}})]}),ce&&(0,r.jsxs)(r.Fragment,{children:[(null==U?void 0:U.error)&&(0,r.jsx)("div",Object.assign({className:"project-share-error"},{children:413===U.error.statusCode&&(null===(v=null===(n=null===(t=pxt.appTarget)||void 0===t?void 0:t.cloud)||void 0===n?void 0:n.cloudProviders)||void 0===v?void 0:v.github)?lf("Oops! Your project is too big. You can create a GitHub repository to share it."):lf("Oops! There was an error. Please ensure you are connected to the Internet and try again.")})),(0,r.jsxs)("div",Object.assign({className:"project-share-publish-actions"},{children:["share"===B&&(0,r.jsxs)(r.Fragment,{children:[(null===(b=null===(y=pxt.appTarget)||void 0===y?void 0:y.appTheme)||void 0===b?void 0:b.multiplayer)&&(O||"multiplayer"===N)&&(0,r.jsx)(o.Button,{className:(0,m.classList)("primary share-host-button","share"===N&&"primary inverted text-only","multiplayer"===N&&"share-publish-button"),title:lf("Host a multiplayer game"),label:lf("Host a multiplayer game"),leftIcon:"xicon multiplayer",onClick:async()=>{te(!0),pxt.tickEvent("share.hostMultiplayer")}}),"share"===N&&(0,r.jsx)(o.Button,{className:"primary share-publish-button",title:lf("Share Project"),label:lf("Share Project"),onClick:async()=>{F("publishing");let e=await C(P,M,Q);H(e),(null==e?void 0:e.error)?F("share"):F("publish")}}),"vscode"===N&&(0,r.jsx)(o.Button,{className:"primary share-publish-button",title:lf("Open in VS Code"),label:lf("Open in VS Code"),onClick:async()=>{F("publishing");let e=await C(P,M,Q);H(e),(null==e?void 0:e.error)?F("share"):(F("publish"),pxt.tickEvent("share.openInVscode"),window.open("https://insiders.vscode.dev/makecode/"+e.url.split("/").pop(),"_blank"))}})]}),"publishing"===B&&(0,r.jsx)(o.Button,{className:"primary share-publish-button",title:lf("Publishing..."),label:(0,r.jsx)("div",{className:"common-spinner"}),onClick:()=>{}})]}))]}),"publish"===B&&(0,r.jsxs)("div",Object.assign({className:"project-share-data"},{children:[(0,r.jsxs)("div",Object.assign({className:"common-input-attached-button"},{children:[(0,r.jsx)(a.Input,{ariaDescribedBy:"share-input-title",handleInputRef:e=>{e&&(oe=e)},initialValue:U.url,readOnly:!0,onChange:D}),(0,r.jsx)(o.Button,{className:W?"green":"primary",title:lf("Copy link"),label:W?lf("Copied!"):lf("Copy"),leftIcon:"fas fa-link",onClick:()=>{pxt.BrowserUtils.isIpcRenderer()?K(pxt.BrowserUtils.legacyCopyText(oe)):(navigator.clipboard.writeText(U.url),K(!0))},onBlur:()=>{K(!1)}})]})),(0,r.jsxs)("div",Object.assign({className:"project-share-actions"},{children:[(0,r.jsxs)("div",Object.assign({className:"project-share-social"},{children:[(0,r.jsx)(o.Button,{className:"square-button gray embed mobile-portrait-hidden",title:lf("Show embed code"),leftIcon:"fas fa-code",onClick:()=>{"none"===G?(pxt.tickEvent("share.embed"),z(!1),J(!1),q("code")):q("none")}}),(0,r.jsx)(d.SocialButton,{className:"square-button facebook",url:null==U?void 0:U.url,type:"facebook",heading:lf("Share on Facebook")}),(0,r.jsx)(d.SocialButton,{className:"square-button twitter",url:null==U?void 0:U.url,type:"twitter",heading:lf("Share on Twitter")}),(0,r.jsx)(d.SocialButton,{className:"square-button google-classroom",url:null==U?void 0:U.url,type:"google-classroom",heading:lf("Share on Google Classroom")}),(0,r.jsx)(d.SocialButton,{className:"square-button microsoft-teams",url:null==U?void 0:U.url,type:"microsoft-teams",heading:lf("Share on Microsoft Teams")}),(0,r.jsx)(d.SocialButton,{className:"square-button whatsapp",url:null==U?void 0:U.url,type:"whatsapp",heading:lf("Share on WhatsApp")}),(null===(E=null===(x=pxt.appTarget)||void 0===x?void 0:x.appTheme)||void 0===E?void 0:E.shareToKiosk)&&(0,r.jsx)(o.Button,{className:"square-button gray mobile-portrait-hidden",title:lf("Share to MakeCode Arcade Kiosk"),leftIcon:"xicon kiosk",onClick:()=>{X?J(!1):(pxt.tickEvent("share.kiosk"),q("none"),z(!1),J(!0))}}),navigator.share&&(0,r.jsx)(o.Button,{className:"square-button device-share",title:lf("Show device share options"),ariaLabel:lf("Show device share options"),leftIcon:"icon share",onClick:async()=>{var e;pxt.tickEvent("share.device");const t={title:document.title,url:U.url,text:lf("Check out my new MakeCode project!")};if(null===(e=null===navigator||void 0===navigator?void 0:navigator.canShare)||void 0===e?void 0:e.call(navigator,t))return navigator.share(t)}})]})),(0,r.jsx)(o.Button,{className:"menu-button project-qrcode",buttonRef:e=>{e&&(ie=e)},title:lf("Show QR Code"),label:(0,r.jsx)("img",{className:"qrcode-image",src:null==U?void 0:U.qr}),onClick:()=>{pxt.tickEvent("share.qrtoggle"),V?z(!1):(q("none"),z(!0),J(!1))}})]}))]})),"none"!==G&&(0,r.jsxs)("div",Object.assign({className:"project-embed"},{children:[(0,r.jsx)(s.EditorToggle,{id:"project-embed-toggle",className:"slim tablet-compact",items:le,selected:le.findIndex((e=>e.name===G))}),(0,r.jsx)(l.Textarea,{readOnly:!0,rows:5,initialValue:null==U?void 0:U.embed[G]})]})),X&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",Object.assign({className:"project-share-label"},{children:[lf("Enter Kiosk Code"),(0,r.jsx)(o.Button,{className:"link-button kiosk",title:lf("Learn more about Kiosk"),leftIcon:"far fa-question-circle",onClick:()=>{window.open("https://arcade.makecode.com/hardware/kiosk","_blank")}})]})),(0,r.jsxs)("div",Object.assign({className:"common-input-attached-button"},{children:[(0,r.jsx)(a.Input,{handleInputRef:e=>{e&&(se=e)},ariaDescribedBy:"share-input-title",preserveValueOnBlur:!0,placeholder:"A12B3C"}),(0,r.jsx)(o.Button,{className:$?"green":"primary",title:lf("Submit Kiosk Code"),label:$?lf("Submitted!"):lf("Submit"),onClick:async()=>{var e;pxt.tickEvent("share.kiosk.submitClicked");const t=pxt.Cloud.parseScriptId(U.url);if(null==se?void 0:se.value){let n=null===(e=/^[a-zA-Z0-9]{6}$/.exec(se.value))||void 0===e?void 0:e[0];if(n){n=n.toUpperCase(),Y(!0);try{await(0,f.addGameToKioskAsync)(n,t),pxt.tickEvent("share.kiosk.submitSuccessful"),(0,g.pushNotificationMessage)({kind:"info",text:lf("Game submitted to kiosk {0} successfully!",n),hc:!1})}catch(e){pxt.tickEvent("share.kiosk.submitServerError"),"Not Found"===e.message?(0,g.pushNotificationMessage)({kind:"err",text:lf("Kiosk Code not found"),hc:!1}):(0,g.pushNotificationMessage)({kind:"err",text:lf("Something went wrong submitting game to kiosk {0}",n),hc:!1})}}else(0,g.pushNotificationMessage)({kind:"err",text:lf("Invalid format for Kiosk Code"),hc:!1})}else(0,g.pushNotificationMessage)({kind:"err",text:lf("Input a six-character kiosk Code"),hc:!1})},onBlur:()=>{Y(!1)}})]}))]})]}),"gifrecord"===B&&(0,r.jsx)(u.ThumbnailRecorder,{initialUri:M,onApply:e=>{L(e),ae()},onCancel:ae,simRecorder:k})]})),V&&(0,r.jsx)(c.Modal,Object.assign({title:lf("QR Code"),onClose:()=>{z(!1),ie&&ie.focus()}},{children:(0,r.jsx)("div",Object.assign({className:"qrcode-modal-body"},{children:(0,r.jsx)("img",{className:"qrcode-image",src:null==U?void 0:U.qr})}))})),ee&&(0,r.jsx)(h.MultiplayerConfirmation,{onCancelClicked:async()=>{te(!1),pxt.tickEvent("share.hostMultiplayerCancel")},onConfirmClicked:async()=>{F("publishing"),te(!1);const e=await C(P,M,Q),t=pxt.Cloud.parseScriptId(e.url);if(!t)return void pxt.tickEvent("share.hostMultiplayerError");const n=pxt.multiplayer.makeHostLink(t,!1);pxt.tickEvent("share.hostMultiplayerShared",{shareId:t}),window.open(n,"_blank"),H(e),(null==e?void 0:e.error)?F("share"):F("publish"),"multiplayer"===N&&R()}})]}))})}},{"../Notification":1,"../controls/Button":3,"../controls/Checkbox":5,"../controls/EditorToggle":8,"../controls/Input":11,"../controls/Modal":16,"../controls/Textarea":19,"../util":41,"./Kiosk":35,"./MultiplayerConfirmation":36,"./SocialButton":39,"./ThumbnailRecorder":40,react:366,"react/jsx-runtime":367}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SocialButton=void 0;const r=e("react/jsx-runtime"),i=e("../controls/Button"),o=e("../util");n.SocialButton=e=>{const{className:t,url:n,type:s,heading:a}=e,l=(0,o.classList)(t,"social-button","type"),c=()=>{const e=pxt.appTarget.appTheme.socialOptions;let t="";switch(pxt.tickEvent(`share.social.${s}`),s){case"facebook":t=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(n)}`;break;case"twitter":{let r=lf("Check out what I made!");e.twitterHandle&&e.orgTwitterHandle?r=lf("Check out what I made with @{0} and @{1}!",e.twitterHandle,e.orgTwitterHandle):e.twitterHandle?r=lf("Check out what I made with @{0}!",e.twitterHandle):e.orgTwitterHandle&&(r=lf("Check out what I made with @{0}!",e.orgTwitterHandle)),t=`https://twitter.com/intent/tweet?url=${encodeURIComponent(n)}&text=${encodeURIComponent(r)}`+(e.hashtags?`&hashtags=${encodeURIComponent(e.hashtags)}`:"")+(e.related?`&related=${encodeURIComponent(e.related)}`:"");break}case"discourse":t=`${e.discourse||"https://forum.makecode.com/"}new-topic?title=${encodeURIComponent(n)}`,e.discourseCategory&&(t+=`&category=${encodeURIComponent(e.discourseCategory)}`);break;case"google-classroom":t=`https://classroom.google.com/share?url=${encodeURIComponent(n)}`;break;case"microsoft-teams":t=`https://teams.microsoft.com/share?href=${encodeURIComponent(n)}`;break;case"whatsapp":t=`https://api.whatsapp.com/send?text=${encodeURIComponent(n)}`}pxt.BrowserUtils.popupWindow(t,a,600,600)};switch(s){case"facebook":case"twitter":case"discourse":case"whatsapp":return(0,r.jsx)(i.Button,{className:l,ariaLabel:s,title:a,leftIcon:`icon ${s}`,onClick:c});case"google-classroom":case"microsoft-teams":return(0,r.jsx)(i.Button,{className:l,ariaLabel:s,title:a,label:(0,r.jsx)("img",{src:`/static/logo/social-buttons/${s}.png`,alt:a||pxt.U.rlf(s)}),onClick:c})}}},{"../controls/Button":3,"../util":41,"react/jsx-runtime":367}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ThumbnailRecorder=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../controls/Button"),s=e("../util");n.ThumbnailRecorder=e=>{const{initialUri:t,onApply:n,onCancel:a,simRecorder:l}=e,[c,u]=i.useState(void 0),[d,p]=i.useState(void 0),[h,f]=i.useState(void 0),[g,m]=i.useState("default");let v;i.useEffect((()=>{if(h)return h.addStateChangeListener(m),h.addThumbnailListener(u),h.addErrorListener(p),()=>{h.removeStateChangeListener(m),h.removeThumbnailListener(u),h.removeErrorListener(p)}}),[h]);const y=pxt.appTarget.appTheme,b=lf("Screenshot ({0})",y.simScreenshotKey),x=lf("Record ({0})",y.simGifKey),E=lf("Stop recording ({0})",y.simGifKey),_=lf("Rendering...");let w;switch(g){case"default":w=x;break;case"recording":w=E;break;case"rendering":w=_}const S=c?lf("New Thumbnail"):lf("Current Thumbnail"),T=(0,s.classList)("gif-recorder-content",c&&"has-uri");return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",Object.assign({className:T},{children:[(0,r.jsxs)("div",Object.assign({className:"gif-recorder-sim"},{children:[(0,r.jsx)("div",Object.assign({className:"gif-recorder-sim-embed",ref:e=>{e&&(v=e)}},{children:i.createElement(l,{onSimRecorderInit:e=>{f(e)}})})),(0,r.jsx)("div",Object.assign({className:"gif-recorder"},{children:(0,r.jsxs)("div",Object.assign({className:"gif-recorder-actions"},{children:["default"===g&&(0,r.jsx)(o.Button,{className:"teal inverted",title:b,label:b,leftIcon:"fas fa-camera",onClick:async()=>{p(void 0),h&&h.screenshotAsync()}}),(0,r.jsx)(o.Button,{className:"teal inverted",disabled:"rendering"===g,title:w,label:w,leftIcon:"fas fa-"+("recording"===g?"square":"circle"),onClick:async()=>{if(p(void 0),h)if("recording"===h.state)h.stopRecordingAsync();else if("default"===h.state&&(h.startRecordingAsync(),v)){const e=v.querySelector("iframe");e&&e.focus()}}}),(0,r.jsx)("div",{className:"spacer mobile-only"}),(0,r.jsx)(o.Button,{className:"mobile-only",title:lf("Cancel"),label:lf("Cancel"),onClick:a})]}))}))]})),(0,r.jsxs)("div",Object.assign({className:"thumbnail-controls"},{children:[(0,r.jsx)("div",Object.assign({className:"thumbnail-preview"},{children:(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",Object.assign({className:"thumbnail-header"},{children:[(0,r.jsx)("span",Object.assign({className:"project-share-label"},{children:S})),(0,r.jsx)(o.Button,{className:"link-button mobile-only",title:lf("Try again?"),label:lf("Try again?"),onClick:()=>u(void 0)})]})),(0,r.jsxs)("div",Object.assign({className:"project-share-thumbnail"},{children:["default"!==g&&(0,r.jsxs)("div",Object.assign({className:"project-thumbnail-placeholder"},{children:[(0,r.jsx)("div",{className:"common-spinner"}),(0,r.jsx)("div",Object.assign({className:"project-thumbnail-label"},{children:"recording"===g?lf("Recording..."):lf("Rendering GIF...")}))]})),"default"===g&&(c||t?(0,r.jsx)("img",{src:c||t}):(0,r.jsx)("div",{className:"thumbnail-placeholder"}))]}))]})})),(0,r.jsxs)("div",Object.assign({className:"thumbnail-actions"},{children:[(0,r.jsx)(o.Button,{title:lf("Cancel"),label:lf("Cancel"),onClick:a}),c&&"default"===g&&(0,r.jsx)(o.Button,{className:"primary",title:lf("Apply"),label:lf("Apply"),onClick:e=>{n(c)}})]}))]}))]}))})}},{"../controls/Button":3,"../util":41,react:366,"react/jsx-runtime":367}],41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.screenToSVGCoord=n.clientCoord=n.CheckboxStatus=n.nodeListToArray=n.classList=n.fireClickOnEnter=n.jsxLF=void 0;const r=e("react/jsx-runtime");var i;n.jsxLF=function(e,...t){const n=[];e.replace(/\{\d\}/g,(e=>(n.push(parseInt(e.substr(1,1))),e)));const i=[];let o,s=0;for(const a of n)o=e.split(`{${a}}`),pxt.U.assert(2===o.length),i.push((0,r.jsx)("span",{children:o[0]},s++)),i.push((0,r.jsx)("span",{children:t[a]},s++)),e=o[1];return i.push((0,r.jsx)("span",{children:e},s++)),i},n.fireClickOnEnter=function(e){const t="number"==typeof e.which?e.which:e.keyCode;13!==t&&32!==t||(e.preventDefault(),e.currentTarget.click())},n.classList=function(...e){return e.filter((e=>"string"==typeof e)).reduce(((e,t)=>e.concat(t.split(" "))),[]).map((e=>e.trim())).filter((e=>!!e)).join(" ")},n.nodeListToArray=function(e){const t=[];for(const n of e)t.push(n);return t},(i=n.CheckboxStatus||(n.CheckboxStatus={}))[i.Selected=0]="Selected",i[i.Unselected=1]="Unselected",i[i.Waiting=2]="Waiting",n.clientCoord=function(e){if(e.touches){const t=e;return t.touches.length?t.touches[0]:t.changedTouches[0]}return e},n.screenToSVGCoord=function(e,t){const n=e.createSVGPoint();return n.x=t.clientX,n.y=t.clientY,n.matrixTransform(e.getScreenCTM().inverse())}},{"react/jsx-runtime":367}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HomeAccessibilityMenu=n.EditorAccessibilityMenu=void 0;const r=e("react/jsx-runtime"),i=e("./auth"),o=e("./data"),s=e("./sui");class a extends o.Component{constructor(e){super(e),this.state={},this.openJavaScript=this.openJavaScript.bind(this),this.openPython=this.openPython.bind(this),this.showLanguagePicker=this.showLanguagePicker.bind(this),this.toggleHighContrast=this.toggleHighContrast.bind(this),this.goHome=this.goHome.bind(this)}openJavaScript(){pxt.tickEvent("accmenu.editor.openJS",void 0,{interactiveConsent:!0}),this.props.parent.openJavaScript()}openPython(){pxt.tickEvent("accmenu.editor.openPY",void 0,{interactiveConsent:!0}),this.props.parent.openPython()}showLanguagePicker(){pxt.tickEvent("accmenu.editor.importdialog",void 0,{interactiveConsent:!0}),this.props.parent.showLanguagePicker()}toggleHighContrast(){pxt.tickEvent("accmenu.editor.togglecontrast",void 0,{interactiveConsent:!0}),this.props.parent.toggleHighContrast()}goHome(){pxt.tickEvent("accmenu.editor.home",void 0,{interactiveConsent:!0}),this.props.parent.showExitAndSaveDialog()}UNSAFE_componentWillReceiveProps(e){const t={};null!=e.highContrast&&(t.highContrast=e.highContrast),Object.keys(t).length>0&&this.setState(t)}shouldComponentUpdate(e,t,n){return this.state.highContrast!=t.highContrast}renderCore(){let e=this.getData(i.HIGHCONTRAST);const t=pxt.appTarget.appTheme,n=!pxt.shell.isControllerMode();return(0,r.jsxs)("div",Object.assign({className:"ui accessibleMenu borderless fixed menu",role:"menubar"},{children:[(0,r.jsx)(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon js",text:lf("Skip to JavaScript editor"),onClick:this.openJavaScript}),t.python?(0,r.jsx)(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon python",text:lf("Skip to Python editor"),onClick:this.openPython}):void 0,t.selectLanguage?(0,r.jsx)(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon globe",text:lf("Select Language"),onClick:this.showLanguagePicker}):void 0,t.highContrast?(0,r.jsx)(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",text:e?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}):void 0,n?(0,r.jsx)(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"home",text:lf("Go Home"),onClick:this.goHome}):void 0]}))}}n.EditorAccessibilityMenu=a;class l extends o.Component{constructor(e){super(e),this.state={},this.newProject=this.newProject.bind(this),this.importProjectDialog=this.importProjectDialog.bind(this),this.showLanguagePicker=this.showLanguagePicker.bind(this),this.toggleHighContrast=this.toggleHighContrast.bind(this)}newProject(){pxt.tickEvent("accmenu.home.new",void 0,{interactiveConsent:!0}),this.props.parent.newProject()}importProjectDialog(){pxt.tickEvent("accmenu.home.importdialog",void 0,{interactiveConsent:!0}),this.props.parent.importProjectDialog()}showLanguagePicker(){pxt.tickEvent("accmenu.home.langpicker"),this.props.parent.showLanguagePicker()}toggleHighContrast(){pxt.tickEvent("accmenu.home.togglecontrast",void 0,{interactiveConsent:!0}),this.props.parent.toggleHighContrast()}UNSAFE_componentWillReceiveProps(e){const t={};null!=e.highContrast&&(t.highContrast=e.highContrast),Object.keys(t).length>0&&this.setState(t)}shouldComponentUpdate(e,t,n){return this.state.highContrast!=t.highContrast}renderCore(){const{highContrast:e}=this.state,t=pxt.appTarget.appTheme;return(0,r.jsxs)("div",Object.assign({className:"ui accessibleMenu borderless fixed menu",role:"menubar"},{children:[(0,r.jsx)(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"add circle",text:lf("New Project"),onClick:this.newProject}),(0,r.jsx)(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"upload",text:lf("Import Project"),onClick:this.importProjectDialog}),t.selectLanguage?(0,r.jsx)(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon globe",text:lf("Select Language"),onClick:this.showLanguagePicker}):void 0,t.highContrast?(0,r.jsx)(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",text:e?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}):void 0]}))}}n.HomeAccessibilityMenu=l},{"./auth":48,"./data":136,"./sui":200,"react/jsx-runtime":367}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AccessibleBlocksInfo=void 0;const r=e("react/jsx-runtime"),i=e("./data"),o=e("./sui");class s extends i.Component{constructor(e){super(e),this.state={shown:!1},this.handleOnClose=this.handleOnClose.bind(this)}handleOnClose(){this.setState({shown:!0})}render(){return this.state.shown?(0,r.jsx)("div",{}):(0,r.jsxs)(o.Modal,Object.assign({isOpen:!this.state.shown,onClose:this.handleOnClose,closeIcon:!0,dimmer:!0,header:lf("Move, edit, and insert blocks using your keyboard")},{children:[(0,r.jsxs)("div",Object.assign({className:"ui equal width grid"},{children:[(0,r.jsxs)("div",Object.assign({className:"column"},{children:[(0,r.jsx)("h3",{children:lf("Navigate")}),(0,r.jsx)("span",Object.assign({className:"ui small"},{children:lf("Use the WASD keys to move between blocks. Hold shift to move on the workspace.")}))]})),(0,r.jsxs)("div",Object.assign({className:"column"},{children:[(0,r.jsx)("h3",{children:lf("Modify")}),(0,r.jsx)("span",Object.assign({className:"ui small"},{children:lf("Press Enter to 'mark' a block, then X to disconnect, I to reconnect.")}))]})),(0,r.jsxs)("div",Object.assign({className:"column"},{children:[(0,r.jsx)("h3",{children:lf("Insert")}),(0,r.jsx)("span",Object.assign({className:"ui small"},{children:lf("Use T to open the toolbox. Inside the toolbox, use WASD to navigate, and Enter to insert.")}))]}))]})),(0,r.jsx)("div",Object.assign({className:"ui grid"},{children:(0,r.jsx)("strong",{children:(0,r.jsx)("a",Object.assign({href:"https://developers.google.com/blockly/guides/configure/web/keyboard-nav"},{children:lf("See the official Blockly Documentation for additional detail")}))})}))]}))}}n.AccessibleBlocksInfo=s},{"./data":136,"./sui":200,"react/jsx-runtime":367}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ksVersion=n.ProjectView=n.getBlocksEditor=n.getEditorAsync=n.hasEditor=void 0;const r=e("react/jsx-runtime"),i=e("react-dom"),o=e("./workspace"),s=e("./cloudsync"),a=e("./data"),l=e("./package"),c=e("./core"),u=e("./sui"),d=e("./simulator"),p=e("./compiler"),h=e("./cmds"),f=e("./appcache"),g=e("./screenshot"),m=e("./hidbridge"),v=e("./share"),y=e("./lang"),b=e("./accessibility"),x=e("./tutorial"),E=e("./sidebarTutorial"),_=e("./editortoolbar"),w=e("./dialogs"),S=e("./identity"),T=e("./container"),k=e("./scriptsearch"),C=e("./extensionsBrowser"),A=e("./projects"),j=e("./scriptmanager"),I=e("./extensions"),O=e("./sounds"),N=e("./make"),R=e("./blocksSnippets"),P=e("./monacoSnippets"),D=e("./greenscreen"),M=e("./accessibleblocks"),L=e("./socketbridge"),B=e("./webusb"),F=e("./auth"),U=e("./cloud"),H=e("./user"),G=e("./headerbar"),q=e("./sidepanel"),V=e("./qr"),z=e("./monaco"),W=e("./pxtjson"),K=e("./serial"),$=e("./blocks"),Y=e("./gitjson"),X=e("./components/assetEditor/editor"),J=e("./draganddrop"),Q=e("./notification"),Z=e("./electron"),ee=e("./blocklyFieldView");var te=pxt.Cloud,ne=pxt.Util;const re=e("./hinttooltip"),ie=e("./mergeProjects"),oe=e("./components/onboarding/Tour"),se=e("./onboarding");let ae,le,ce;function ue(){return ae?Promise.resolve(ae):(ce||(ce=[]),new Promise((e=>{ce.push(e)})))}pxsim.util.injectPolyphils(),n.hasEditor=function(){return!!ae},n.getEditorAsync=ue,n.getBlocksEditor=function(){return ae?ae.blocksEditor:null};class de extends F.Component{constructor(e){var t,n;super(e),this.allEditors=[],this.screenshotHandlers=[],this.highContrastSubscriber={subscriptions:[],onDataChanged:()=>{this.onHighContrastChanged()}},this.cloudStatusSubscriber={subscriptions:[],onDataChanged:e=>this.onCloudStatusChanged(e)},this.handleSetPresenceIcon=(e,t,n)=>{if((e|=0)<1||e>4)return;const r=document.getElementById("root"),i=`--multiplayer-presence-icon-${e}`;if(t&&n){const e=pxt.convertUint8BufferToPngUri(t,n);if(!e)return;const o=`url("${e}")`;r.style.setProperty(i,o)}else r.style.removeProperty(i)},this.autoRunSimulatorDebounced=pxtc.Util.debounce((()=>{ne.now()-this.lastChangeTime<1e3?pxt.debug("sim: skip auto, debounced"):this.state.active?this.blocksEditor&&this.blocksEditor.isDropdownDivVisible()?pxt.debug("sim: skip blocks auto, field editor is open"):this.editor!==this.serialEditor?this.state.debugging||this.state.tracing?pxt.debug("sim: don't restart when debugging or tracing"):this.state.collapseEditorTools?pxt.debug("sim: don't restart when simulator collapsed"):!pxt.BrowserUtils.isSkillmapEditor()||this.state.header?this.runSimulator({debug:!!this.state.debugging,background:!0}):pxt.debug("sim: don't restart when no project is open"):pxt.debug("sim: don't restart when entering console view"):pxt.debug("sim: skip blocks auto, !active")}),1e3,!0),this._slowTypeCheck=0,this.typecheckDebouncer=new pxtc.Util.AdaptiveDebouncer((()=>{if(this.editor.isIncomplete())return;const e=ne.now();this.saveFileAsync();const t=this.editor.snapshotState();p.typecheckAsync().then((n=>{const r=ne.now();if(!pxt.options.light&&r-e>1e4&&this._slowTypeCheck++>1&&(pxt.tickEvent("light.typecheck"),pxt.options.light=!0),pxt.tickEvent("typecheck.complete",{editor:this.getPreferredEditor()}),this.editor.setDiagnostics(this.editorFile,t),a.invalidate("open-pkg-meta:"+l.mainEditorPkg().getPkgId()),this.state.autoRun){const e=l.mainEditorPkg().outputPkg.files["output.txt"];e&&!e.numDiagnosticsOverride&&this.state.autoRun&&this.autoRunSimulatorDebounced()}this.maybeShowPackageErrors()}))})),this.markdownChangeHandler=ne.debounce((()=>{this.state.currFile&&/\.md$/i.test(this.state.currFile.name)&&this.setSideMarkdown(this.editor.getCurrentSource())}),3e3,!1),this.editorChangeHandler=ne.debounce((()=>{this.editor.isIncomplete()||(this.saveFileAsync(),this.typecheck(),this.isTutorial()&&pxt.appTarget.appTheme.tutorialCodeValidation&&this.editor.validateTutorialCode(this.state.tutorialOptions)),this.markdownChangeHandler()}),500,!1),this.hexFileImporters=[{id:"default",canImport:e=>e.meta.cloudId=="ks/"+pxt.appTarget.id||e.meta.cloudId==pxt.CLOUD_ID+pxt.appTarget.id||ne.startsWith(e.meta.cloudId,pxt.CLOUD_ID+pxt.appTarget.id),importAsync:(e,t)=>{let n={target:pxt.appTarget.id,targetVersion:t.meta.targetVersions?t.meta.targetVersions.target:void 0,editor:t.meta.editor,name:t.meta.name,meta:{},pubId:"",pubCurrent:!1};const r=JSON.parse(t.source);return o.installAsync(n,r).then((e=>this.loadHeaderAsync(e,null)))}}],this.resourceImporters=[new K.ResourceImporter],this.pushScreenshotHandler=e=>{this.screenshotHandlers.push(e)},this.popScreenshotHandler=()=>{this.screenshotHandlers.pop()},this.checkWebUSBVariant=!0,this._deploying=!1,this.closeOnEscape=e=>{c.keyCodeFromEvent(e)===c.ESC_KEY&&(e.preventDefault(),this.toggleSimulatorFullscreen())},this.hintManager=new re.HintManager,this.handleScriptManagerDialogClose=()=>{this.home.forceUpdate(),o.syncAsync()},this.handleHomeRef=e=>{this.home=e},this.handleScriptSearchRef=e=>{this.scriptSearch=e},this.handleExtensionRef=e=>{this.extensions=e},this.handleScriptManagerDialogRef=e=>{this.scriptManagerDialog=e},this.handleImportDialogRef=e=>{this.importDialog=e},this.handleExitAndSaveDialogRef=e=>{this.exitAndSaveDialog=e},this.handleNewProjectDialogRef=e=>{this.newProjectDialog=e},this.handleShareEditorRef=e=>{this.shareEditor=e},this.handleLanguagePickerRef=e=>{this.languagePicker=e},this.handleChooseHwDialogRef=e=>{this.chooseHwDialog=e},this.handleLoginDialogRef=e=>{this.loginDialog=e},this.handleProfileDialogRef=e=>{this.profileDialog=e},document.title=pxt.appTarget.title||pxt.appTarget.name,this.reload=!1,this.settings=JSON.parse(pxt.storage.getLocal("editorSettings")||"{}");const r=this.shouldShowHomeScreen();(/hc=(\w+)/.test(window.location.href)||(null===(n=null===(t=window.matchMedia)||void 0===t?void 0:t.call(window,"(forced-colors: active)"))||void 0===n?void 0:n.matches))&&c.setHighContrast(!0);const i=pxt.appTarget.simulator;this.state={showFiles:!1,home:r,active:"visible"==document.visibilityState||pxt.BrowserUtils.isElectron()||pxt.appTarget.appTheme.dontSuspendOnVisibility,collapseEditorTools:i.headless,simState:pxt.editor.SimState.Stopped,autoRun:this.autoRunOnStart(),isMultiplayerGame:!1,onboarding:void 0},this.settings.editorFontSize||(this.settings.editorFontSize=/mobile/i.test(navigator.userAgent)?15:19),this.settings.fileHistory||(this.settings.fileHistory=[]),r&&this.homeLoaded(),this.hidePackageDialog=this.hidePackageDialog.bind(this),this.hwDebug=this.hwDebug.bind(this),this.hideLightbox=this.hideLightbox.bind(this),this.hideOnboarding=this.hideOnboarding.bind(this),this.openSimSerial=this.openSimSerial.bind(this),this.openDeviceSerial=this.openDeviceSerial.bind(this),this.openSerial=this.openSerial.bind(this),this.toggleGreenScreen=this.toggleGreenScreen.bind(this),this.toggleSimulatorFullscreen=this.toggleSimulatorFullscreen.bind(this),this.toggleSimulatorCollapse=this.toggleSimulatorCollapse.bind(this),this.showKeymap=this.showKeymap.bind(this),this.toggleKeymap=this.toggleKeymap.bind(this),this.showMiniSim=this.showMiniSim.bind(this),this.setTutorialStep=this.setTutorialStep.bind(this),this.completeTutorialAsync=this.completeTutorialAsync.bind(this),this.exitTutorial=this.exitTutorial.bind(this),this.setEditorOffset=this.setEditorOffset.bind(this),this.resetTutorialTemplateCode=this.resetTutorialTemplateCode.bind(this),this.initSimulatorMessageHandlers(),pxt.BrowserUtils.useOldTutorialLayout&&this.hintManager.addHint(de.tutorialCardId,this.tutorialCardHintCallback.bind(this))}autoRunOnStart(){return pxt.appTarget.simulator&&((pxt.options.light?!!pxt.appTarget.simulator.autoRunLight:!!pxt.appTarget.simulator.autoRun)||this.firstRun&&!!pxt.appTarget.simulator.emptyRunCode)}initSimulatorMessageHandlers(){window.addEventListener("message",(e=>{var t,n;let r=e.data;if(r&&this.state.header)if("addextensions"===r.type){const e=r.extensions;this.addOrUpdateGithubExtensions(e)}else if("screenshot"===r.type){const e=r;if(!e.data)return;const t=this.screenshotHandlers[this.screenshotHandlers.length-1];if(t)t(e);else{const t=pxt.BrowserUtils.imageDataToPNG(e.data);pxt.appTarget.compile.saveAsPNG&&this.encodeProjectAsPNGAsync(t,!1),g.saveAsync(this.state.header,t).then((()=>{pxt.debug("screenshot saved")}))}}else if("recorder"===r.type){const e=r,t=this.screenshotHandlers[this.screenshotHandlers.length-1];t&&t({event:e.action})}else if("thumbnail"===r.type)this.shareEditor&&this.shareEditor.setThumbnailFrames(r.frames);else if("multiplayer"===r.type){const e=r;if("Icon"===e.content&&e.iconType===pxsim.multiplayer.IconType.Player){const{palette:t,icon:n,slot:r}=e;this.handleSetPresenceIcon(r,t,null==n?void 0:n.data)}}else if("toplevelcodefinished"===r.type&&(null===(n=null===(t=pxt.appTarget)||void 0===t?void 0:t.appTheme)||void 0===n?void 0:n.multiplayer)){const e={type:"multiplayer",content:"Connection",slot:1,connected:!0};d.driver.postMessage(e)}}),!1)}async addOrUpdateGithubExtensions(e){pxt.tickEvent("package.addextensions");const t=l.mainEditorPkg(),n=await pxt.packagesConfigAsync(),i=null==e?void 0:e.map((e=>pxt.github.parseRepoId(e))).filter((e=>!!e)).filter((e=>pxt.github.repoStatus(e,n)!==pxt.github.GitRepoStatus.Banned));if(!t||!(null==i?void 0:i.length))return;const o=i.filter((e=>pxt.github.repoStatus(e,n)!==pxt.github.GitRepoStatus.Approved));if(!o.length||await c.confirmAsync({header:lf("Add extensions?"),jsx:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{children:lf("Add or update these user-provided extensions to your project?")}),(0,r.jsx)("ul",{children:o.map((e=>(0,r.jsx)("li",{children:(0,r.jsx)("a",Object.assign({href:`/pkg/${e.fullName}`},{children:e.fullName}))},e.fullName)))}),(0,r.jsx)("hr",{}),(0,r.jsx)("p",{children:lf("User-provided extension are not endorsed by Microsoft.")})]})})){pxt.debug(`adding extensions ${e}`);try{c.showLoading("addextensions",lf("adding extensions..."));for(const e of i){pxt.debug(`adding ${e.fullName}`);const{config:n,version:r}=await pxt.github.downloadLatestPackageAsync(e);await t.setDependencyAsync(n.name,r)}this.reloadHeaderAsync()}catch(e){c.handleNetworkError(e)}finally{c.hideLoading("addextensions")}}}shouldShowHomeScreen(){const e=fe(),t=pxt.shell.isSandboxMode()||pxt.shell.isReadOnly(),n=pxt.appTarget.appTheme.allowParentController||pxt.shell.isControllerMode()||/^#editor/.test(window.location.hash);return!t&&!n&&!me(e)}async updateVisibilityAsync(){var e;if(pxt.BrowserUtils.isElectron()||pxt.appTarget.appTheme.dontSuspendOnVisibility)return;const t=pxt.BrowserUtils.isDocumentVisible();if(pxt.debug(`page visibility: ${t}`),this.setState({active:t}),a.invalidate("pkg-git-pull-status"),a.invalidate("pkg-git-pr"),a.invalidate("pkg-git-pages"),t||(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||(this._deploying?pxt.debug("visibility: disconnect cancelled because deploy in progress"):h.disconnectAsync()),!t&&this.state.autoRun)d.driver.state==pxsim.SimulatorState.Running&&(this.suspendSimulator(),this.setState({resumeOnVisibility:!0})),this.saveFileAsync();else if(t){a.invalidate("header:*");let e=this.state.header?this.state.header.id:"";const t=!this.state.home&&e;!t&&o.isHeadersSessionOutdated()||o.isHeaderSessionOutdated(this.state.header)?(pxt.debug("workspace: changed, reloading..."),await o.syncAsync(),t&&await this.loadHeaderAsync(o.getHeader(e),this.state.editorState)):this.state.resumeOnVisibility?(this.setState({resumeOnVisibility:!1}),this.runSimulator(),h.maybeReconnectAsync(!1,!0)):this.state.home||h.maybeReconnectAsync(!1,!0)}this.editor&&this.editor.onPageVisibilityChanged(t)}saveSettings(){if(this.reload)return;let e=this.editorFile;e&&e.epkg.getTopHeader()&&this.editor.hasHistory()&&this.pushFileHistory(e.epkg.getTopHeader().id,e.getName(),this.editor.getViewState()),pxt.storage.setLocal("editorSettings",JSON.stringify(this.settings))}pushFileHistory(e,t,n){const r=this.settings;let i={id:e,name:t,pos:n};for(r.fileHistory=r.fileHistory.filter((e=>e.id!=i.id||e.name!=i.name));r.fileHistory.length>100;)r.fileHistory.pop();r.fileHistory.unshift(i)}popFileHistory(){this.settings.fileHistory.shift()}openProjectInLegacyEditor(e){if(!this.editorFile||!this.editorFile.epkg||!this.editorFile.epkg.getTopHeader())return Promise.resolve();const t=this.editorFile.epkg.getTopHeader();return pxt.tickEvent("update.openLegacyEditor",{version:t.targetVersion}),o.copyProjectToLegacyEditor(t,e).then((n=>{this.pushFileHistory(n.id,this.editorFile.getName(),this.editor.getViewState()),pxt.storage.setLocal("editorSettings",JSON.stringify(this.settings));const r=pxt.appTarget.appTheme;if(r&&r.editorVersionPaths&&r.editorVersionPaths[e]){const t=r.editorVersionPaths[e];window.location.href=pxt.Util.pathJoin(window.location.origin,t+"#editor")}else window.location.href=pxt.Util.pathJoin(window.location.origin,"v"+t.targetVersion+"#editor")})).catch((e=>{c.warningNotification(lf("Importing to older editor version only supported in web browsers"))}))}async componentDidUpdate(e,t){this.saveSettings(),this.editor.domUpdate(),d.setState(this.state.header?this.state.header.editor:"",this.state.tutorialOptions&&!!this.state.tutorialOptions.tutorial),this.state.fullscreen||this.editor.resize();let n=Promise.resolve();this.editor&&this.editor.isReady&&(n=n.then((()=>this.updateEditorFileAsync()))),this.editor&&(n=n.then((()=>{this.editor.updateBreakpoints(),this.editor.updateToolbox()})))}fireResize(){if(document.createEvent){let e=document.createEvent("Event");e.initEvent("resize",!0,!0),window.dispatchEvent(e)}else document.fireEvent("onresize")}updateEditorLogo(e,t){if(pxt.appTarget.appTheme.hideMenuBar){const n=document.getElementById("editorlogo");if(n)return n.style.left=`${e}px`,n.style.display="block",n.style.background=t||"",n.offsetHeight}return 0}saveFileAsync(){return!this.editorFile||this.loadingExample?Promise.resolve():this.saveTypeScriptAsync().then((()=>this.saveCurrentSourceAsync()))}saveProjectAsync(){return this.saveFileAsync().then((()=>l.mainEditorPkg().buildAssetsAsync())).then((()=>this.state.header&&o.saveAsync(this.state.header)))}saveCurrentSourceAsync(){let e=this.editor.getCurrentSource();return e!=this.editorFile.content&&d.setDirty(),this.editor.isIncomplete()?Promise.resolve():this.editorFile.setContentAsync(e)}isEmbedSimActive(){return this.state.embedSimView}isBlocksActive(){return!this.state.embedSimView&&this.editor==this.blocksEditor&&this.editorFile&&this.editorFile.name==pxt.MAIN_BLOCKS}isJavaScriptActive(){return!this.state.embedSimView&&this.editor==this.textEditor&&this.editorFile&&this.editorFile.name==pxt.MAIN_TS}isPythonActive(){return!this.state.embedSimView&&this.editor==this.textEditor&&this.editorFile&&this.editorFile.name==pxt.MAIN_PY}isAssetsActive(){return!this.state.embedSimView&&this.editor==this.assetEditor&&this.editorFile&&this.editorFile.name==pxt.ASSETS_FILE}isAnyEditeableJavaScriptOrPackageActive(){return this.editor==this.textEditor&&this.editorFile&&!this.editorFile.isReadonly()&&/(\.ts|pxt.json)$/.test(this.editorFile.name)}openPython(e=!0){if(!this.updatingEditorFile){if(this.setState({tracing:!1}),this.isPythonActive())return this.state.embedSimView&&this.setState({embedSimView:!1}),void(e&&this.textEditor.editor.focus());if(this.textEditor&&(this.textEditor.giveFocusOnLoading=e),this.isBlocksActive())this.blocksEditor.openPython();else if(this.isJavaScriptActive())this.openPythonAsync();else{const e=l.mainEditorPkg().files[pxt.MAIN_PY];e?this.setFile(e):this.updateFileAsync(pxt.MAIN_PY,"# ...",!1)}}}openJavaScript(e=!0){if(!this.updatingEditorFile){if(this.isJavaScriptActive())return this.state.embedSimView&&this.setState({embedSimView:!1}),void(e&&this.textEditor.editor.focus());if(this.textEditor&&(this.textEditor.giveFocusOnLoading=e),this.isBlocksActive())this.blocksEditor.openTypeScript();else if(this.isPythonActive())this.openTypeScriptAsync();else{const e=l.mainEditorPkg().files;let t=e[pxt.MAIN_TS];t||(t=e[Object.keys(e).find((e=>/\.ts$/.test(e)))]),this.setFile(t)}pxt.shell.setEditorLanguagePref("js")}}openBlocks(){if(this.updatingEditorFile)return;if(this.isBlocksActive())return void(this.state.embedSimView&&this.setState({embedSimView:!1}));const e=l.mainEditorPkg().files[pxt.MAIN_BLOCKS];if(this.isJavaScriptActive()||this.shouldTryDecompile&&!this.state.embedSimView)this.textEditor.openBlocks();else if(this.isAnyEditeableJavaScriptOrPackageActive()||!e.content)this.saveFileAsync().then((()=>this.textEditor.openBlocks()));else{const t=this.state.header;t&&t.editor!==pxt.BLOCKS_PROJECT_NAME?this.textEditor.openBlocks():this.setFile(e)}this.shouldTryDecompile=!1}async openBlocksAsync(){if(this.updatingEditorFile)return;if(this.isBlocksActive())return void(this.state.embedSimView&&this.setState({embedSimView:!1}));const e=l.mainEditorPkg();e.files[pxt.MAIN_BLOCKS]||e.setContentAsync(pxt.MAIN_BLOCKS,"");const t=e.files[pxt.MAIN_BLOCKS];if(this.isJavaScriptActive()||this.shouldTryDecompile&&!this.state.embedSimView)await this.textEditor.openBlocksAsync();else if(this.isAnyEditeableJavaScriptOrPackageActive()||!t.content)await this.saveFileAsync(),await this.textEditor.openBlocksAsync();else{const e=this.state.header;e&&e.editor!==pxt.BLOCKS_PROJECT_NAME?await this.textEditor.openBlocksAsync():this.setFile(t)}this.shouldTryDecompile=!1}openAssets(){const e=l.mainEditorPkg();e&&(e.lookupFile("this/"+pxt.ASSETS_FILE)||e.setFile(pxt.ASSETS_FILE,"\n",!0),this.saveFileAsync().then((()=>this.setFile(l.mainEditorPkg().lookupFile(`this/${pxt.ASSETS_FILE}`)))))}openSettings(){this.setFile(l.mainEditorPkg().lookupFile("this/pxt.json"))}openSimSerial(){this.openSerial(!0)}openDeviceSerial(){this.openSerial(!1)}openSerial(e){if(!pxt.appTarget.serial||!pxt.appTarget.serial.useEditor)return;if(this.editor==this.serialEditor&&this.serialEditor.isSim==e)return;const t=l.mainEditorPkg();if(!t)return;t.lookupFile("this/"+pxt.SERIAL_EDITOR_FILE)||t.setFile(pxt.SERIAL_EDITOR_FILE,"serial\n",!0),this.serialEditor.setSim(e);let n="serial."+(e?"simulator":"device")+"EditorOpened";pxt.tickEvent(n),this.setFile(t.lookupFile("this/"+pxt.SERIAL_EDITOR_FILE))}openPreviousEditor(){this.preserveUndoStack=!0;const e=this.state.header.id,t=this.settings.fileHistory[0];this.editorFile&&t.id==e&&t.name==this.editorFile.getName()&&this.popFileHistory();const n=this.settings.fileHistory.find((t=>t.id==e));if(n){const e=l.mainEditorPkg().lookupFile(n.name);if(e)return void this.setSideFile(e)}const r=!!l.mainEditorPkg().files[pxt.MAIN_BLOCKS];"monacoEditor"!=this.prevEditorId&&r?this.openBlocks():this.openJavaScript(!1)}openTypeScriptAsync(){return this.saveTypeScriptAsync(!0)}openPythonAsync(){const e=l.mainEditorPkg().files[pxt.MAIN_PY];if(e){const t=l.mainEditorPkg().files[pxt.MAIN_TS].content;return this.textEditor.convertPythonToTypeScriptAsync().then((n=>n==t?(pxt.debug("ts -> py shortcut"),this.setFile(e),Promise.resolve()):this.convertTypeScriptToPythonAsync()))}return this.convertTypeScriptToPythonAsync()}convertTypeScriptToPythonAsync(){this.editor.snapshotState();const e=this.isBlocksActive()?"blocks":"ts",t=this.editorFile.content,n=l.mainEditorPkg();let r;const i=n.getCachedTranspile(e,t,"py"),o=(r=i?this.saveVirtualFileAsync(pxt.PYTHON_PROJECT_NAME,i,!0):this.saveTypeScriptAsync(!1).then((()=>p.pyDecompileAsync(pxt.MAIN_TS))).then((r=>{if(r&&r.success){const i=r.outfiles[pxt.MAIN_PY];return n.cacheTranspile(e,t,"py",i),this.saveVirtualFileAsync(pxt.PYTHON_PROJECT_NAME,i,!0)}{const e=new Error("Failed to convert to Python.");return pxt.reportException(e),Promise.reject(e)}})).then((()=>(pxt.shell.setEditorLanguagePref("py"),Promise.resolve())))).then((()=>{}),(e=>c.confirmAsync({header:lf("Oops, there is a problem converting your code."),body:lf("We are unable to convert your code to Python."),agreeLbl:lf("Done"),agreeClass:"cancel",agreeIcon:"cancel",hasCloseIcon:!0}).then((()=>{}))));return c.showLoadingAsync("switchtopython",lf("switching to Python..."),r),o}openSimView(){this.state.embedSimView?this.startStopSimulator():(this.setState({embedSimView:!0}),this.startSimulator())}shouldPreserveUndoStack(){return this.preserveUndoStack}typecheckNow(){this.saveFileAsync(),this.typecheck()}showPackageErrorsOnNextTypecheck(){this.setState({suppressPackageWarning:!1})}maybeShowPackageErrors(e=!1){if(pxt.perf.measureStart("maybeShowPackageErrors"),this.state.currFile){const e=this.state.currFile;if(!pxt.editor.isBlocks(e)&&e.name!==pxt.MAIN_TS)return!1}if(!this.state.suppressPackageWarning||e){this.setState({suppressPackageWarning:!0});const t=p.getPackagesWithErrors();if(t.length){const n=this.state.header,r=pxt.semver.parse(pxt.appTarget.versions.target),i=pxt.semver.parse(n.targetVersion);let s;return o.isBrowserWorkspace()&&r.major!==i.major&&(s=()=>{this.openProjectInLegacyEditor(i.major)}),w.showPackageErrorDialogAsync(t,p.updatePackagesAsync,s).then((t=>{t?this.reloadHeaderAsync():e||this.openHome()})),pxt.perf.measureEnd("maybeShowPackageErrors"),!0}}return pxt.perf.measureEnd("maybeShowPackageErrors"),!1}typecheck(){this.typecheckDebouncer.trigger()}initEditors(){this.textEditor=new z.Editor(this),this.pxtJsonEditor=new W.Editor(this),this.serialEditor=new K.Editor(this),this.blocksEditor=new $.Editor(this),this.gitjsonEditor=new Y.Editor(this),this.assetEditor=new X.AssetEditor(this);let e=()=>{this.editorFile&&(this.editorFile.inSyncWithEditor&&pxt.tickEvent("activity.edit",{editor:this.editor.getId().replace(/Editor$/,"")},{interactiveConsent:!0}),this.editorFile.markDirty()),this.lastChangeTime=ne.now(),this.state.simState!=pxt.editor.SimState.Stopped&&pxt.appTarget.simulator&&pxt.appTarget.simulator.stopOnChange&&this.stopSimulator(),this.editor.isIncomplete()||(this.editor==this.textEditor&&this.typecheckDebouncer.poke(),this.editorChangeHandler())};this.allEditors=[this.pxtJsonEditor,this.gitjsonEditor,this.blocksEditor,this.serialEditor,this.assetEditor,this.textEditor],this.allEditors.forEach((t=>t.changeCallback=e)),this.editor=this.allEditors[this.allEditors.length-1]}UNSAFE_componentWillMount(){this.initEditors(),this.initDragAndDrop()}componentDidMount(){this.allEditors.forEach((e=>e.prepare())),d.init(document.getElementById("boardview"),{orphanException:e=>{var t;null===(t=this.editor)||void 0===t||t.onExceptionDetected(e)},highlightStatement:(e,t)=>{if(this.state.debugging&&!d.driver.areBreakpointsSet()&&t&&!t.exceptionMessage){let e;if(this.isAnyEditeableJavaScriptOrPackageActive()||this.isPythonActive()?e=this.textEditor.getBreakpoints():this.isBlocksActive()&&(e=this.blocksEditor.getBreakpoints()),e=e||[],d.driver.setBreakpoints(e),-1===e.indexOf(t.breakpointId))return this.state.debugFirstRun?(this.dbgStepInto(),this.setState({debugFirstRun:!1})):this.dbgPauseResume(),!0}return!!this.editor&&this.editor.highlightStatement(e,t)},restartSimulator:()=>this.restartSimulator(),onStateChanged:e=>{const t=()=>this.allEditors.forEach((e=>e.simStateChanged()));switch(e){case pxsim.SimulatorState.Paused:case pxsim.SimulatorState.Unloaded:case pxsim.SimulatorState.Suspended:case pxsim.SimulatorState.Pending:case pxsim.SimulatorState.Stopped:this.setState({simState:pxt.editor.SimState.Stopped},t);break;case pxsim.SimulatorState.Running:this.setState({simState:pxt.editor.SimState.Running},t)}},onSimulatorReady:()=>{},setState:(e,t)=>{l.mainEditorPkg().setSimState(e,t)},editor:this.state.header?this.state.header.editor:""}),this.forceUpdate(),this.loadBlocklyAsync(),a.subscribe(this.highContrastSubscriber,F.HIGHCONTRAST),a.subscribe(this.cloudStatusSubscriber,`${U.HEADER_CLOUDSTATE}:*`)}componentWillUnmount(){a.unsubscribe(this.highContrastSubscriber),a.unsubscribe(this.cloudStatusSubscriber)}componentDidCatch(e,t){this.handleCriticalError(e,t)}handleCriticalError(e,t){try{c.killLoadingQueue(),pxsim.U.remove(document.getElementById("loading")),this.setState({hasError:!0}),pxt.tickEvent("pxt.criticalerror",{error:e||"",info:t||""});const n=pxt.storage.getLocal("lastcriticalerror")&&Date.parse(pxt.storage.getLocal("lastcriticalerror"));(!n||isNaN(n)||Date.now()-n>6e4)&&(pxt.storage.setLocal("lastcriticalerror",(new Date).toISOString()),setTimeout((()=>{this.reloadEditor()}),2e3))}catch(e){}}pickEditorFor(e){return this.allEditors.filter((t=>t.acceptsFile(e)))[0]}updateEditorFileAsync(e=null){if(!this.state.active||this.updatingEditorFile||this.state.currFile==this.editorFile&&!e)return void(this.state.editorPosition&&this.editorFile==this.state.editorPosition.file&&(this.editor.setViewState(this.state.editorPosition),this.setState({editorPosition:void 0})));let t=!1;return this.updatingEditorFile=!0,c.showLoadingAsync("updateeditorfile",lf("loading editor..."),Promise.resolve()).then((()=>(t=this.state.simState!=pxt.editor.SimState.Stopped,this.state.currFile.virtual||this.state.debugging||(this.stopSimulator(),(t||this.state.autoRun)&&(d.setPending(),this.setState({simState:pxt.editor.SimState.Pending}))),this.saveSettings(),this.openingTypeScript?Promise.resolve():this.saveFileAsync()))).then((()=>{this.editorFile=this.state.currFile;let t=this.editor;return this.prevEditorId=t.getId(),this.editor=e||this.pickEditorFor(this.editorFile),this.allEditors.forEach((e=>e.setVisible(e==this.editor))),t?t.unloadFileAsync():Promise.resolve()})).then((()=>{let e=this.getData(F.HIGHCONTRAST);return this.editor.loadFileAsync(this.editorFile,e)})).then((()=>{if(this.saveFileAsync(),this.editor!=this.textEditor&&this.editor!=this.blocksEditor||this.typecheck(),this.state.editorPosition)this.editor.setViewState(this.state.editorPosition),this.setState({editorPosition:void 0});else{const e=this.settings.fileHistory.find((e=>e.id==this.state.header.id&&e.name==this.editorFile.getName()));e&&this.editor.setViewState(e.pos)}T.SideDocs.notify({type:"fileloaded",name:this.editorFile.getName(),locale:pxt.Util.localeInfo()}),this.state.showBlocks&&this.editor==this.textEditor&&this.textEditor.openBlocks()})).finally((()=>{this.updatingEditorFile=!1,this.preserveUndoStack=!1,this.isJavaScriptActive()&&(this.openingTypeScript=!1),this.forceUpdate()})).then((()=>{this.state.currFile.virtual||!t||this.state.autoRun?this.typecheck():this.startSimulator()}))}setFile(e,t){if(!e)return;e.name===pxt.MAIN_TS&&(this.shouldTryDecompile=!0);const n=this.state.header;let r=!1;n&&"this"===(e.epkg&&e.epkg.getPkgId())&&(this.isBlocksFile(e.name)?(n.editor=pxt.BLOCKS_PROJECT_NAME,n.pubCurrent=!1,r=!0):this.isTypescriptFile(e.name)?(n.editor=pxt.JAVASCRIPT_PROJECT_NAME,n.pubCurrent=!1,r=!0):this.isPythonFile(e.name)&&(n.editor=pxt.PYTHON_PROJECT_NAME,n.pubCurrent=!1,r=!0),r&&l.mainPkg.setPreferredEditor(n.editor));const i={currFile:e,showBlocks:!1,embedSimView:!1,autoRun:this.autoRunOnStart()};void 0!==t&&(i.editorPosition={lineNumber:t,column:1,file:e}),this.setState(i)}setSideFile(e,t){e.name!=this.state.currFile.name&&pxt.editor.isBlocks(e)?(pxt.tickEvent("sidebar.showBlocks"),this.openBlocks()):((this.isTextEditor()||this.isPxtJsonEditor())&&(this.textEditor.giveFocusOnLoading=!1),this.setFile(e,t))}navigateToError(e){if(!e)return;let t=e.fileName;/^(pxt_modules|built)\//.test(t)||(t="this/"+t);let n=l.mainEditorPkg().lookupFile(t);n&&this.setSideFile(n,e.line+1)}removeFile(e,t=!1){const n=()=>{l.mainEditorPkg().removeFileAsync(e.name).then((()=>l.mainEditorPkg().saveFilesAsync())).then((()=>this.reloadHeaderAsync()))};t?n():c.confirmAsync({header:lf("Remove {0}",e.name),body:lf("You are about to remove a file from your project. You can't undo this. Are you sure?"),agreeClass:"red",agreeIcon:"trash",agreeLbl:lf("Remove it")}).then((e=>{e&&n()}))}updateFileAsync(e,t,n){const r=l.mainEditorPkg();return r.setContentAsync(e,t).then((()=>{n&&this.setFile(r.lookupFile("this/"+e))})).then((()=>this.reloadHeaderAsync()))}isSideDocExpanded(){const e=this.refs.sidedoc;return!!e&&!e.isCollapsed()}setSideMarkdown(e){let t=this.refs.sidedoc;t&&t.setMarkdown(e)}setSideDoc(e,t=!0){let n=this.refs.sidedoc;n&&(e?n.setPath(e,t):n.collapse())}setSideDocCollapsed(e=!0){let t=this.refs.sidedoc;t&&(e&&this.isSideDocExpanded()?t.collapse():e||this.isSideDocExpanded()||t.expand())}setTutorialInstructionsExpanded(e){const t=this.state.tutorialOptions;t.tutorialStepExpanded=e,t.autoexpandStep=e,this.setState({tutorialOptions:t},(()=>{this.editor==this.blocksEditor?this.blocksEditor.hideFlyout():this.editor==this.textEditor&&this.textEditor.hideFlyout(),this.setEditorOffset()}))}setTutorialStep(e){var t;this.typecheckNow(),this.stopPokeUserActivity();let n=this.refs[de.tutorialCardId];if(this.isTutorial()&&e>-1){let r=this.state.tutorialOptions;r.tutorialStep=e,r.tutorialStepExpanded=!1,this.setState({tutorialOptions:r},(()=>{this.postTutorialProgress(),o.saveAsync(this.state.header)})),r.tutorialStepInfo[e].showHint&&n&&this.showTutorialHint(),r.tutorialStepInfo[e].tutorialCompleted&&pxt.commands.onTutorialCompleted&&pxt.commands.onTutorialCompleted(),this.editor.closeFlyout(),this.textEditor.giveFocusOnLoading&&this.isTextEditor()&&(null===(t=this.textEditor.editor)||void 0===t||t.focus()),pxt.appTarget.appTheme.tutorialCodeValidation&&this.editor.validateTutorialCode(this.state.tutorialOptions)}}setTutorialCodeStatus(e,t){const n=this.state.tutorialOptions,r=n.tutorialStepInfo[n.tutorialStep];n.metadata.tutorialCodeValidation&&(r.listOfValidationRules=t),this.setState({tutorialOptions:n})}postTutorialProgress(){var e,t,n,r,i,o,s,a,l,c,u;const d=(null===(e=this.state.tutorialOptions)||void 0===e?void 0:e.tutorialStep)||(null===(n=null===(t=this.state.header)||void 0===t?void 0:t.tutorialCompleted)||void 0===n?void 0:n.steps)||0,p=(null===(i=null===(r=this.state.tutorialOptions)||void 0===r?void 0:r.tutorialStepInfo)||void 0===i?void 0:i.length)||(null===(s=null===(o=this.state.header)||void 0===o?void 0:o.tutorialCompleted)||void 0===s?void 0:s.steps)||0,h=(null===(a=this.state.tutorialOptions)||void 0===a?void 0:a.tutorial)||(null===(l=this.state.header)||void 0===l?void 0:l.tutorialCompleted.id);pxt.editor.postHostMessageAsync({type:"pxthost",action:"tutorialevent",tutorialEvent:"progress",currentStep:d,totalSteps:p,tutorialId:h,projectHeaderId:null===(c=this.state.header)||void 0===c?void 0:c.id,isCompleted:!!(null===(u=this.state.header)||void 0===u?void 0:u.tutorialCompleted)})}postTutorialLoaded(){var e,t;const n=(null===(e=this.state.tutorialOptions)||void 0===e?void 0:e.tutorial)||(null===(t=this.state.header)||void 0===t?void 0:t.tutorialCompleted.id);pxt.editor.postHostMessageAsync({type:"pxthost",action:"tutorialevent",tutorialEvent:"loaded",tutorialId:n,projectHeaderId:this.state.header.id})}postTutorialCompleted(){var e,t;const n=(null===(e=this.state.tutorialOptions)||void 0===e?void 0:e.tutorial)||(null===(t=this.state.header)||void 0===t?void 0:t.tutorialCompleted.id);pxt.editor.postHostMessageAsync({type:"pxthost",action:"tutorialevent",tutorialEvent:"completed",tutorialId:n,projectHeaderId:this.state.header.id})}postTutorialExit(){var e,t;const n=(null===(e=this.state.tutorialOptions)||void 0===e?void 0:e.tutorial)||(null===(t=this.state.header)||void 0===t?void 0:t.tutorialCompleted.id);pxt.editor.postHostMessageAsync({type:"pxthost",action:"tutorialevent",tutorialEvent:"exit",tutorialId:n,projectHeaderId:this.state.header.id})}handleMessage(e){switch(e.type){case"opendoc":window.open(e.url,"_blank"),this.setState({sideDocsCollapsed:!0,sideDocsLoadUrl:""});break;case"tutorial":switch(e.subtype){case"loaded":let t=e;t.toolboxSubset&&Object.keys(t.toolboxSubset).length>0&&(this.setState({editorState:{filters:{blocks:t.toolboxSubset,defaultState:pxt.editor.FilterState.Hidden}}}),this.editor.filterToolbox(t.showCategories));let n=this.state.tutorialOptions;n.tutorialReady=!0,n.tutorialStepInfo=t.stepInfo,this.setState({tutorialOptions:n},(()=>o.saveAsync(this.state.header))),n.tutorialStepInfo[0].showHint&&this.showTutorialHint(),c.hideLoading("tutorial");break;case"error":let r=e;pxt.reportException(r.message),c.errorNotification(lf("We're having trouble loading this tutorial, please try again later.")),this.setState({tutorialOptions:void 0});let i=l.mainEditorPkg().header;i.isDeleted=!0,i.tutorial=void 0,o.forceSaveAsync(i,{}).then((()=>{this.openHome()})).finally((()=>c.hideLoading("tutorial")))}}}reloadHeaderAsync(){return this.loadHeaderAsync(this.state.header,this.state.editorState)}tryCheckTargetVersionAsync(e){const t=e||"0.0.0";if(pxt.semver.majorCmp(t,pxt.appTarget.versions.target)<0&&pxt.tickEvent("patch.load.legacy",{targetVersion:t}),pxt.semver.majorCmp(t,pxt.appTarget.versions.target)>0){pxt.tickEvent("patch.load.future",{targetVersion:t});const e=[];return pxt.appTarget&&pxt.appTarget.appTheme&&pxt.appTarget.appTheme.homeUrl&&e.push({label:lf("Get latest"),icon:"external alternate",url:pxt.appTarget.appTheme.homeUrl}),c.dialogAsync({header:lf("Oops, this project is too new!"),body:lf("This project was created in a newer version of this editor. Please try again in that editor."),disagreeLbl:lf("Ok"),buttons:e}).then((()=>this.openHome()))}}async loadHeaderAsync(e,t,n=!0){if(!e)return Promise.resolve();this.shareEditor&&this.shareEditor.setThumbnailFrames(void 0),this.setState({isMultiplayerGame:!1});const r=this.tryCheckTargetVersionAsync(e.targetVersion);if(r)return r.then((()=>this.openHome()));if(o.isHeadersSessionOutdated()&&(pxt.log("multi-tab sync before load"),await o.syncAsync()),n){const t=15e3,n=ne.nowSeconds();let r=!1;await Promise.race([pxt.U.delay(t).then((()=>{r=!0})),U.syncAsync({hdrs:[e],direction:"down"}).then((t=>{if(t.length){const i=ne.nowSeconds()-n;r?(pxt.tickEvent("identity.syncOnProjectOpen.timedout",{elapsedSec:i}),t.some((t=>t.id===e.id))&&U.forceReloadForCloudSync()):(pxt.tickEvent("identity.syncOnProjectOpen.syncSuccess",{elapsedSec:i}),e=o.getHeader(e.id))}}))])}e&&(o.acquireHeaderSession(e),await this.internalLoadHeaderAsync(e,t))}internalLoadHeaderAsync(e,t){var n;pxt.debug(`loading ${e.id} (pxt v${e.targetVersion})`),this.stopSimulator(!0),pxt.appTarget.simulator&&pxt.appTarget.simulator.aspectRatio&&d.driver.preload(pxt.appTarget.simulator.aspectRatio),this.clearSerial(),this.firstRun=!0,this.allEditors.forEach((e=>e.clearCaches())),this.setState({autoRun:this.autoRunOnStart(),tracing:void 0});const r=this.state.editorState;return r&&t&&(void 0===t.filters&&(t.filters=r.filters),void 0===t.hasCategories&&(t.hasCategories=r.hasCategories),void 0===t.searchBar&&(t.searchBar=r.searchBar)),this.hasCloudSync()&&(e.cloudUserId=null===(n=this.getUserProfile())||void 0===n?void 0:n.id),p.newProjectAsync().then((()=>e.backupRef?o.restoreFromBackupAsync(e):Promise.resolve())).then((()=>l.loadPkgAsync(e.id))).then((()=>(this.state&&this.state.header==e||this.showPackageErrorsOnNextTypecheck(),d.setDirty(),p.newProjectAsync()))).then((()=>p.applyUpgradesAsync())).then((()=>this.loadTutorialJresCodeAsync())).then((()=>this.loadTutorialCustomTsAsync())).then((()=>this.loadTutorialTemplateCodeAsync())).then((()=>this.loadTutorialBlockConfigsAsync())).then((()=>{var n,r,i,s,a;const u=l.getEditorPkg(l.mainPkg);l.mainPkg.config.preferredEditor&&(e.editor=l.mainPkg.config.preferredEditor);let d=u.getMainFile();const p=e.editor!=pxt.BLOCKS_PROJECT_NAME&&this.settings.fileHistory.filter((t=>t.id==e.id))[0];if(p){const e=u.lookupFile(p.name);e?d=e:"ts"===l.getExtensionOfFileName(p.name)?d=u.lookupFile("this/"+d.getFileNameWithExtension("ts"))||d:"py"===l.getExtensionOfFileName(p.name)&&(d=u.lookupFile("this/"+d.getFileNameWithExtension("py"))||d)}const h=l.mainPkg.config.name;e.name=h||lf("Untitled"),!p&&e.editor&&d.getVirtualFileName(e.editor)&&(d=u.lookupFile("this/"+d.getVirtualFileName(e.editor))||d),pxt.editor.isBlocks(d)&&!d.content&&(d.content||(d=u.lookupFile("this/"+d.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME))||d));const f=null===(r=null===(n=e.tutorial)||void 0===n?void 0:n.metadata)||void 0===r?void 0:r.preferredEditor;if(f){let e="this/"+_e(f);(d=u.lookupFile(e))||(d=u.setFile(e,"\n"),l.mainPkg.config.files.push(e),l.mainPkg.saveConfig())}d.name===pxt.MAIN_TS&&(this.shouldTryDecompile=!0),this.setState({home:!1,showFiles:!!e.githubId,editorState:t,tutorialOptions:e.tutorial,header:e,projectName:e.name,currFile:d,sideDocsLoadUrl:"",debugging:!1,isMultiplayerGame:!1}),l.getEditorPkg(l.mainPkg).onupdate=()=>{this.loadHeaderAsync(e,this.state.editorState)},l.mainPkg.getCompileOptionsAsync().catch((e=>{if(e instanceof pxt.cpp.PkgConflictError){const t=e,n=e=>({label:lf("Remove {0}",e.id),class:"pink",icon:"trash",onclick:()=>{c.showLoading("removedep",lf("Removing {0}...",e.id)),l.mainEditorPkg().removeDepAsync(e.id).then((()=>this.reloadHeaderAsync())).finally((()=>c.hideLoading("removedep")))}});c.dialogAsync({hideCancel:!0,buttons:[n(t.pkg1),n(t.pkg0)],header:lf("Extensions cannot be used together"),body:lf("Extensions '{0}' and '{1}' cannot be used together, because they use incompatible settings ({2}).",t.pkg1.id,t.pkg0.id,t.settingName)})}}));const g=this.pickEditorFor(d),m=null===(s=null===(i=null==l?void 0:l.mainPkg)||void 0===i?void 0:i.config)||void 0===s?void 0:s.documentation;if(m)this.setSideDoc(m,g==this.blocksEditor);else{const t=u.lookupFile("this/README.md"),n=null===(a=null==t?void 0:t.content)||void 0===a?void 0:a.trim();e.githubId||!n||/#{2,}\s+@autoOpen\s+false\s*/i.test(n)||this.setSideMarkdown(t.content)}return o.saveAsync(e)})).then((()=>this.loadTutorialFiltersAsync())).finally((()=>{pxt.BrowserUtils.changeHash("#editor",!0),document.getElementById("root").focus(),h.maybeReconnectAsync(!1,!0),this.editorLoaded()}))}loadTutorialFiltersAsync(){const e=l.mainEditorPkg().header;if(!e||!e.tutorial||!e.tutorial.tutorialMd)return Promise.resolve();pxt.perf.measureStart("loadTutorial loadBlockly");const t=e.tutorial,n=/notutorialinfocache=1/i.test(window.location.href);return"string"==typeof t.tutorialCode&&(t.tutorialCode=[t.tutorialCode]),this.loadBlocklyAsync().then((()=>x.getUsedBlocksAsync(t.tutorialCode,t.tutorial,t.language,n))).then((n=>{let r={};(null==n?void 0:n.usedBlocks)&&Object.keys(n.usedBlocks).length>0&&(r.filters={blocks:n.usedBlocks,defaultState:pxt.editor.FilterState.Hidden},r.hasCategories=!(e.tutorial.metadata&&e.tutorial.metadata.flyoutOnly)),this.setState({editorState:r}),this.editor.filterToolbox(!0),t.tutorialStepInfo[e.tutorial.tutorialStep].showHint&&this.showTutorialHint()})).catch((e=>{pxt.tickEvent("tutorial.faileddecompile",{tutorial:t.tutorial}),this.setState({editorState:{filters:void 0}}),c.warningNotification(lf("Could not filter tutorial blocks, displaying full toolbox."))})).finally((()=>{pxt.perf.measureEnd("loadTutorial loadBlockly")}))}async loadTutorialBlockConfigsAsync(){var e,t,n,r,i;const o=async e=>{e.blocks=[];const t=[];try{const n=(await p.decompileBlocksSnippetAsync(e.md,void 0,{snippetMode:!0,generateSourceMap:!1})).outfiles[pxt.MAIN_BLOCKS];pxt.debug(`decompiled ${e.md} to ${n}`),(()=>{const e=Blockly.Xml.textToDom(n),r=Array.from(e.children);for(const e of r)"block"===e.nodeName&&t.push(e)})(),(()=>{for(const e of t){const n=Array.from(e.children);for(const r of n)if("next"===r.nodeName){for(const e of Array.from(r.children))t.push(e);e.removeChild(r)}}})()}catch(t){console.error(`Failed to resolve blockconfig for tutorial: ${s.tutorial.tutorialName}, ${t.message}. md:${e.md}`)}for(const n of t)try{const t={},r=n.getAttribute("type");switch(r){case"typescript_statement":throw new Error("Block config decompiled to gray block: "+Blockly.Xml.domToText(n));case"variables_set":case"variables_change":{const e=Array.from(n.children).find((e=>"value"===e.tagName)),r=Array.from(e.children).find((e=>"block"===e.tagName));t.blockId=r.getAttribute("type");break}default:t.blockId=r}t.xml=Blockly.Xml.domToText(n).replace(/^<xml[^>]*>\n*/i,"").replace(/\n*<\/xml>\n*$/i,""),e.blocks.push(t)}catch(e){console.error(`Failed to resolve blockconfig for tutorial: ${s.tutorial.tutorialName}. ${e.message}`)}},s=l.mainEditorPkg().header;if(!s||!s.tutorial||!s.tutorial.tutorialStepInfo)return;if(null===(t=null===(e=s.tutorial.globalBlockConfig)||void 0===e?void 0:e.blocks)||void 0===t?void 0:t.length)return;const a=s.tutorial.tutorialStepInfo;for(const e of a)if(null===(r=null===(n=e.localBlockConfig)||void 0===n?void 0:n.blocks)||void 0===r?void 0:r.length)return;const c=[];(null===(i=s.tutorial.globalBlockConfig)||void 0===i?void 0:i.md)&&c.push(o(s.tutorial.globalBlockConfig)),a.map((e=>e.localBlockConfig)).filter((e=>null==e?void 0:e.md)).forEach((e=>c.push(o(e)))),await Promise.all(c)}async loadTutorialTemplateCodeAsync(){var e;const t=l.mainEditorPkg().header;if(!t||!t.tutorial||!t.tutorial.templateCode||t.tutorial.templateLoaded)return;const n=t.tutorial.templateCode;t.tutorial.templateLoaded=!0;let r=await o.getTextAsync(t.id);const i=null===(e=t.tutorial.metadata)||void 0===e?void 0:e.preferredEditor;i&&_e(i)===pxt.ASSETS_FILE&&(r[pxt.MAIN_TS]=n);const s=function(e){switch(e.toLowerCase()){case"javascript":case"js":case pxt.JAVASCRIPT_PROJECT_NAME:return pxt.JAVASCRIPT_PROJECT_NAME;case"python":case"py":case pxt.PYTHON_PROJECT_NAME:return pxt.PYTHON_PROJECT_NAME;case"blocks":case pxt.BLOCKS_PROJECT_NAME:default:return pxt.BLOCKS_PROJECT_NAME}}(i||t.editor);if(s===pxt.JAVASCRIPT_PROJECT_NAME)r[pxt.MAIN_TS]=n;else if(s===pxt.PYTHON_PROJECT_NAME){const e=await p.decompilePythonSnippetAsync(n);e&&(r[pxt.MAIN_PY]=e)}else{const e=(await p.decompileBlocksSnippetAsync(n)).outfiles[pxt.MAIN_BLOCKS];e&&(r[pxt.MAIN_BLOCKS]=e)}let a=r;if(t.tutorial.mergeHeaderId){const e=o.getHeader(t.tutorial.mergeHeaderId);if(e){const n=await o.getTextAsync(e.id);a=(0,ie.mergeProjectCode)(n,r,!!t.tutorial.mergeCarryoverCode)}}let c,u,d=!1;for(const e of Object.keys(a))void 0!==a[e]&&(l.mainEditorPkg().setFile(e,a[e]),l.mainPkg.config.files.indexOf(e)<0&&(d=!0,l.mainPkg.config.files.push(e)));d&&l.mainPkg.saveConfig(),await o.saveAsync(t);try{c=a[pxt.TILEMAP_JRES]?JSON.parse(a[pxt.TILEMAP_JRES]):null,u=a[pxt.IMAGES_JRES]?JSON.parse(a[pxt.IMAGES_JRES]):null}catch(e){return Promise.reject(e)}const h=pxt.react.getTilemapProject();c&&h.loadTilemapJRes(pxt.inflateJRes(c),!0),u&&h.loadAssetsJRes(pxt.inflateJRes(u)),await l.mainEditorPkg().buildAssetsAsync(),await l.mainEditorPkg().saveFilesAsync()}loadTutorialJresCodeAsync(){var e,t;const n=l.mainEditorPkg().header;if(!n||!n.tutorial||!n.tutorial.jres&&!n.tutorial.assetFiles)return Promise.resolve();const r=n.tutorial.jres||(null===(e=n.tutorial.assetFiles)||void 0===e?void 0:e[pxt.TILEMAP_JRES]),i=null===(t=n.tutorial.assetFiles)||void 0===t?void 0:t[pxt.IMAGES_JRES];let o,s;delete n.tutorial.jres,delete n.tutorial.assetFiles;try{o=r?JSON.parse(r):null,s=i?JSON.parse(i):null}catch(e){return Promise.reject(e)}const a=pxt.react.getTilemapProject();return o&&a.loadTilemapJRes(pxt.inflateJRes(o),!0),s&&a.loadAssetsJRes(pxt.inflateJRes(s)),l.mainEditorPkg().buildAssetsAsync()}async loadTutorialCustomTsAsync(){const e=l.mainEditorPkg(),t=e.header;if(!t||!t.tutorial||!t.tutorial.customTs)return Promise.resolve();const n=t.tutorial.customTs;return await e.setContentAsync(pxt.TUTORIAL_CUSTOM_TS,n),await e.saveFilesAsync(),Promise.resolve()}async resetTutorialTemplateCode(e){var t;const n=l.mainEditorPkg(),r=n.header;if(null===(t=null==r?void 0:r.tutorial)||void 0===t?void 0:t.templateCode){if(e){let e=await o.getTextAsync(r.id);const t=(0,ie.appendTemporaryAssets)(e[pxt.MAIN_BLOCKS],e[pxt.IMAGES_JRES]);l.mainEditorPkg().setFile(pxt.IMAGES_JRES,t),await n.saveFilesAsync()}r.tutorial.templateLoaded=!1,delete r.tutorial.mergeHeaderId,await this.reloadHeaderAsync()}}removeProject(){l.mainEditorPkg().header&&c.confirmDelete(l.mainEditorPkg().header.name,(()=>{let e=l.mainEditorPkg().header;return e.isDeleted=!0,o.forceSaveAsync(e,{}).then((()=>this.openHome()))}))}isHexFile(e){return/\.(hex|uf2)$/i.test(e)}isBlocksFile(e){return/\.blocks$/i.test(e)}isTypescriptFile(e){return/\.ts$/i.test(e)}isPythonFile(e){return/\.py$/i.test(e)}isProjectFile(e){return/\.(pxt|mkcd|mkcd-\w+)$/i.test(e)}isPNGFile(e){return pxt.appTarget.compile.saveAsPNG&&/\.png$/i.test(e)}isAssetFile(e){let t=pxt.appTarget.runtime?pxt.appTarget.runtime.assetExtensions:null;if(t){let n=e.replace(/.*\./,"").toLowerCase();return t.indexOf(n)>=0}return!1}isZipFile(e){return/\.zip$/i.test(e)}importProjectCoreAsync(e,t){return(e[0]=="{".charCodeAt(0)?Promise.resolve(pxt.U.uint8ArrayToString(e)):pxt.lzmaDecompressAsync(e)).then((e=>{let n=JSON.parse(e);if(n.target&&n.target==pxt.appTarget.id)n.xml.forEach((e=>{let t=pxt.Util.htmlUnescape(e.replace(/^"|"$/g,""));pxt.blocks.loadBlocksXml(this.blocksEditor.editor,t)}));else{let e=n;this.importHex(e,t)}})).catch((e=>{c.warningNotification(lf("Sorry, we could not import this project or block snippet.")),this.openHome()}))}importHexFile(e,t){e&&pxt.cpp.unpackSourceFromHexFileAsync(e).then((e=>this.importHex(e,t))).catch((e=>{pxt.reportException(e),c.warningNotification(lf("Sorry, we could not recognize this file."))}))}importBlocksFiles(e,t){e&&ts.pxtc.Util.fileReadAsTextAsync(e).then((t=>{this.newProject({filesOverride:{[pxt.MAIN_BLOCKS]:t,[pxt.MAIN_TS]:"  "},name:e.name.replace(/\.blocks$/i,"")||lf("Untitled")})}))}importTypescriptFile(e,t){e&&ts.pxtc.Util.fileReadAsTextAsync(e).then((t=>{this.newProject({filesOverride:{[pxt.MAIN_BLOCKS]:"",[pxt.MAIN_TS]:t||"  "},name:e.name.replace(/\.ts$/i,"")||lf("Untitled")})}))}importProjectFile(e,t){e&&ts.pxtc.Util.fileReadAsBufferAsync(e).then((e=>this.importProjectCoreAsync(e,t)))}importPNGFile(e,t){e&&ts.pxtc.Util.fileReadAsBufferAsync(e).then((e=>pxt.Util.decodeBlobAsync("data:image/png;base64,"+btoa(pxt.Util.uint8ArrayToString(e))))).then((e=>this.importProjectCoreAsync(e,t)))}async importZipFileAsync(e,t){if(!e)return;pxt.tickEvent("import.zip"),await j.loadZipAsync();const n=new zip.ZipReader(new zip.BlobReader(e)),i=(await n.getEntries()).filter((e=>this.isProjectFile(e.filename)));let s={done:0};if(0===i.length)return void c.warningNotification(lf("No projects available to import found inside zip file."));if(!await c.confirmAsync({header:lf("Import zip file?"),body:lf("Do you want to import all projects in this zip file? This will import {0} projects.",i.length),agreeLbl:lf("Okay"),hasCloseIcon:!0}))return;let a=!1;c.dialogAsync({header:lf("Extracting files..."),jsxd:()=>(0,r.jsx)(w.ProgressBar,{percentage:s.done/i.length*100}),onClose:()=>a=!0});for(const t of i){try{const e=await t.getData(new zip.Uint8ArrayWriter),n=JSON.parse(await pxt.lzmaDecompressAsync(e));let r={target:pxt.appTarget.id,targetVersion:n.meta.targetVersions?n.meta.targetVersions.target:void 0,editor:n.meta.editor,name:n.meta.name,meta:{},pubId:"",pubCurrent:!1};const i=JSON.parse(n.source);await o.installAsync(r,i)}catch(e){}if(a)break;s.done++,c.forceUpdate()}c.hideDialog()}importPNGBuffer(e){pxt.Util.decodeBlobAsync("data:image/png;base64,"+btoa(pxt.Util.uint8ArrayToString(new Uint8Array(e)))).then((e=>this.importProjectCoreAsync(e)))}importAssetFile(e){ts.pxtc.Util.fileReadAsBufferAsync(e).then((t=>{let n=e.name.replace(/.*[\/\\]/,"");return l.mainEditorPkg().saveAssetAsync(n,t)}))}importHex(e,t){if(!e||!e.meta){if(!e||!e[pxt.CONFIG_NAME])return c.warningNotification(lf("Sorry, we could not recognize this file.")),void(t&&t.openHomeIfFailed&&this.openHome());e=s.reconstructMeta(e)}if("object"==typeof e.source&&(e.source=JSON.stringify(e.source)),this.hexFileImporters.some((t=>"default"==t.id&&t.canImport(e)))){const n=this.tryCheckTargetVersionAsync(e.meta.targetVersions&&e.meta.targetVersions.target);if(n)return void n.then((()=>{t&&t.openHomeIfFailed&&this.newProject()}))}if(t&&t.extension){if(pxt.tickEvent("import.extension"),ts.pxtc.Util.jsonTryParse(e.source)){const t=e.meta.name,n=`${e.meta.name}.json`,r=l.mainEditorPkg();r&&(pxt.debug(`adding ${n} to package`),r.setContentAsync(n,e.source).then((()=>r.updateConfigAsync((e=>{e.dependencies||(e.dependencies={}),e.dependencies[t]=`pkg:${n}`})))).then((()=>this.reloadHeaderAsync())))}return}const n=this.hexFileImporters.filter((t=>t.canImport(e)))[0];n?(pxt.tickEvent("import",{id:n.id}),c.hideDialog(),c.showLoading("importhex",lf("loading project...")),pxt.editor.initEditorExtensionsAsync().then((()=>n.importAsync(this,e).then((()=>c.hideLoading("importhex")),(e=>{pxt.reportException(e,{importer:n.id}),c.hideLoading("importhex"),c.errorNotification(lf("Oops, something went wrong when importing your project")),t&&t.openHomeIfFailed&&this.openHome()}))))):(c.warningNotification(lf("Sorry, we could not import this project.")),pxt.tickEvent("warning.importfailed"),t&&t.openHomeIfFailed&&this.openHome())}importProjectAsync(e,t){let n=e.header;return n||(n={target:pxt.appTarget.id,targetVersion:void 0,editor:pxt.BLOCKS_PROJECT_NAME,name:lf("Untitled"),meta:{},pubId:"",pubCurrent:!1}),o.installAsync(n,e.text).then((e=>this.loadHeaderAsync(e,t)))}importTutorialAsync(e){try{const{options:t,editor:n}=pxt.tutorial.getTutorialOptions(e,"untitled","untitled","",!1),r=pxt.gallery.parsePackagesFromMarkdown(e);return this.hintManager.clearViewedHints(),this.createProjectAsync({name:"untitled",tutorial:t,preferredEditor:n,dependencies:r})}catch(e){return ne.userError(lf("Could not import tutorial")),Promise.reject(e)}}async importSkillmapProjectAsync(e){const t=new pxt.skillmap.IndexedDBWorkspace;await t.initAsync();const n=await t.getProjectAsync(e);if(n&&!n.deleted)return n.header.tutorial&&(n.header.tutorialCompleted={id:n.header.tutorial.tutorial,steps:n.header.tutorial.tutorialStepInfo.length},delete n.header.tutorial),this.importProjectAsync(n);const r=o.getHeader(e);if(!r)return void ne.userError(lf("Unable to import skillmap project"));const i=await o.duplicateAsync(r);i.tutorial&&(i.tutorialCompleted={id:i.tutorial.tutorial,steps:i.tutorial.tutorialStepInfo.length},delete i.tutorial),i.isSkillmapProject=!1,await o.saveAsync(i),a.invalidate("headers:"),await this.loadHeaderAsync(i)}openProjectByHeaderIdAsync(e){const t=o.getHeader(e);return this.loadHeaderAsync(t)}initDragAndDrop(){J.setupDragAndDrop(document.body,(e=>e.size<1e6&&this.isHexFile(e.name)||this.isBlocksFile(e.name)||this.isZipFile(e.name)),(e=>{e&&(pxt.tickEvent("dragandrop.open"),this.importFile(e[0]))}),(e=>{this.isPNGFile(e)&&pxt.Util.httpRequestCoreAsync({url:e,method:"GET",responseArrayBuffer:!0}).then((t=>this.importUri(e,t.buffer))).catch((e=>c.handleNetworkError(e)))}))}importUri(e,t){this.isPNGFile(e)&&this.importPNGBuffer(t)}importFile(e,t){if(e&&!pxt.shell.isReadOnly())if(this.isHexFile(e.name))this.importHexFile(e,t);else if(this.isBlocksFile(e.name))this.importBlocksFiles(e,t);else if(this.isTypescriptFile(e.name))this.importTypescriptFile(e,t);else if(this.isProjectFile(e.name))this.importProjectFile(e,t);else if(this.isAssetFile(e.name))this.importAssetFile(e);else if(this.isPNGFile(e.name))this.importPNGFile(e,t);else if(this.isZipFile(e.name))this.importZipFileAsync(e,t);else{const t=this.resourceImporters.filter((t=>t.canImport(e)))[0];t?t.importAsync(this,e):c.warningNotification(lf("Oops, don't know how to load this file!"))}}importProjectFromFileAsync(e,t){return pxt.lzmaDecompressAsync(e).then((e=>{let n=JSON.parse(e);return this.importHex(n,t)})).catch((()=>this.newProject()))}syncPreferredEditor(){const e=this.getPreferredEditor();e&&l.mainPkg.setPreferredEditor(e)}exportProjectToFileAsync(){return this.syncPreferredEditor(),l.mainPkg.compressToFileAsync()}exportAsync(){return pxt.debug("exporting project"),this.exportProjectToFileAsync().then((e=>ts.pxtc.encodeBase64(ne.uint8ArrayToString(e))))}downloadScreenshotAsync(){return pxt.appTarget.compile.saveAsPNG?this.saveProjectAsPNGAsync(!1):this.requestScreenshotAsync().then((e=>pxt.BrowserUtils.browserDownloadDataUri(e,l.genFileName(".png"))))}requestScreenshotAsync(){return this.requestScreenshotPromise?this.requestScreenshotPromise:(this.setState({screenshoting:!0}),d.driver.postMessage({type:"screenshot"}),ne.promiseTimeout(1e3,this.requestScreenshotPromise=new Promise(((e,t)=>{this.pushScreenshotHandler((t=>e(pxt.BrowserUtils.imageDataToPNG(t.data,3))))}))).catch((e=>{pxt.tickEvent("screenshot.timeout")})).finally((()=>{this.popScreenshotHandler(),this.requestScreenshotPromise=void 0,this.setState({screenshoting:!1})})))}encodeProjectAsPNGAsync(e,t){return this.exportProjectToFileAsync().then((t=>g.encodeBlobAsync(this.state.header.name,e,t))).then((e=>{const n=l.genFileName(".png");return pxt.BrowserUtils.browserDownloadDataUri(e,n),t?c.dialogAsync({header:lf("Project Saved!"),disagreeLbl:lf("Got it!"),disagreeClass:"green",hasCloseIcon:!1,jsx:(0,r.jsx)("div",Object.assign({className:"ui items"},{children:(0,r.jsxs)("div",Object.assign({className:"item"},{children:[(0,r.jsx)("div",Object.assign({className:"ui small image"},{children:(0,r.jsx)("a",Object.assign({download:n,className:"ui link",href:e},{children:(0,r.jsx)("img",{src:e,alt:lf("Project cartridge"),title:lf("Click to download again")})}))})),(0,r.jsx)("div",Object.assign({className:"content"},{children:(0,r.jsx)("div",Object.assign({className:"description"},{children:(0,r.jsxs)("p",{children:[lf("Your project is saved in this image."),(0,r.jsx)("br",{}),lf("Import or drag it into the editor to reload it.")]})}))}))]}))}))}):Promise.resolve()}))}saveProjectAsPNGAsync(e){return this.requestScreenshotAsync().then((t=>this.encodeProjectAsPNGAsync(t,e)))}saveProjectToFileAsync(){const e=l.mainPkg;return xe()?(pxt.BrowserUtils.browserDownloadText(e.readFile(pxt.MAIN_BLOCKS),l.genFileName(".blocks"),{contentType:"application/xml"}),Promise.resolve()):Ee()?this.saveTutorialTemplateAsync():pxt.commands.saveProjectAsync?(c.infoNotification(lf("Saving...")),this.syncPreferredEditor(),e.saveToJsonAsync().then((e=>pxt.commands.saveProjectAsync(e)))):pxt.appTarget.compile.saveAsPNG?this.saveProjectAsPNGAsync(!0):this.exportProjectToFileAsync().then((e=>{const t=l.genFileName(".mkcd");pxt.BrowserUtils.browserDownloadUInt8Array(e,t,{contentType:"application/octet-stream"})}))}openHome(){!pxt.shell.isControllerMode()&&!pxt.appTarget.appTheme.lockedEditor&&this.unloadProjectAsync(!0)}homeLoaded(){pxt.tickEvent("app.home")}editorLoaded(){pxt.tickEvent("app.editor")}unloadProjectAsync(e){return this.stopSimulator(!0),this.showKeymap(!1),h.disconnectAsync(),this.editor&&this.editor.unloadFileAsync(),this.extensions.unload(),this.editorFile=void 0,e&&pxt.BrowserUtils.changeHash("",!0),this.setStateAsync({home:void 0!==e?e:this.state.home,tracing:void 0,fullscreen:void 0,tutorialOptions:void 0,editorState:void 0,debugging:void 0,header:void 0,currFile:void 0,fileState:void 0}).then((()=>(this.allEditors.forEach((e=>e.setVisible(!1))),e&&(this.homeLoaded(),this.showPackageErrorsOnNextTypecheck()),o.syncAsync()))).then((()=>{}))}reloadEditor(){try{window.removeEventListener("hashchange",be),le&&(pxt.BrowserUtils.isIFrame()&&("pub"===le.cmd||"sandbox"===le.cmd)||"tutorial"==le.cmd)?location.hash=`#${le.cmd}:${le.arg}`:this.state&&this.state.home?location.hash="#reload":this.state&&this.state.header&&!this.state.header.isDeleted&&(location.hash="#editor"),location.reload()}catch(e){pxt.reportException(e),location.reload()}}getPreferredEditor(){if(this.editor==this.blocksEditor)return pxt.BLOCKS_PROJECT_NAME;if(this.editor==this.textEditor)switch(this.textEditor.fileType){case"python":return pxt.PYTHON_PROJECT_NAME;default:return pxt.JAVASCRIPT_PROJECT_NAME}}openExtension(e,t){pxt.tickEvent("app.openextension",{extension:e}),this.extensions.showExtensionAsync(e,t)}handleExtensionRequest(e){this.extensions.handleExtensionRequest(e)}newEmptyProject(e,t,n){this.newProject({filesOverride:{[pxt.MAIN_BLOCKS]:'<xml xmlns="http://www.w3.org/1999/xhtml"></xml>'},name:e,documentation:t,preferredEditor:n,filters:{}})}newProject(e={}){return pxt.tickEvent("app.newproject"),c.showLoading("newproject",lf("creating new project...")),this.createProjectAsync(e).then((()=>this.autoChooseBoardAsync())).then((()=>ne.delay(500))).finally((()=>c.hideLoading("newproject")))}async createProjectAsync(e){var t,n,r;pxt.perf.measureStart("createProjectAsync"),this.setSideDoc(void 0),e.prj||(e.prj=pxt.appTarget.blocksprj);let i=pxt.U.clone(e.prj.config);i.name=e.name||lf("Untitled"),i.documentation=e.documentation;let s=ne.clone(e.prj.files);if(e.filesOverride&&(ne.jsonCopyFrom(s,e.filesOverride),Object.keys(e.filesOverride).forEach((e=>{-1===i.files.indexOf(e)&&i.files.push(e)}))),e.dependencies&&ne.jsonMergeFrom(i.dependencies,e.dependencies),e.extensionUnderTest){const t=o.getHeader(e.extensionUnderTest);t&&(i.dependencies[t.name]=`workspace:${t.id}`)}if(e.tsOnly&&(e.languageRestriction="no-blocks"),e.preferredEditor&&(i.preferredEditor=e.preferredEditor),e.simTheme||(null===(t=e.tutorial)||void 0===t?void 0:t.simTheme)){const t=e.simTheme||(null===(n=e.tutorial)||void 0===n?void 0:n.simTheme);t.theme&&(i.theme=t.theme),t.palette&&(i.palette=t.palette)}if(e.languageRestriction){let t=/\.(blocks)$/;"javascript-only"===e.languageRestriction?(t=/\.(py|blocks)$/,i.preferredEditor=pxt.JAVASCRIPT_PROJECT_NAME):"python-only"===e.languageRestriction&&(i.preferredEditor=pxt.PYTHON_PROJECT_NAME),i.languageRestriction=e.languageRestriction,i.files=i.files.filter((e=>!t.test(e))),delete s[pxt.MAIN_BLOCKS]}i.preferredEditor==pxt.PYTHON_PROJECT_NAME&&i.files.indexOf(pxt.MAIN_PY)<0&&(i.files.push(pxt.MAIN_PY),s[pxt.MAIN_PY]||(s[pxt.MAIN_PY]="\n")),e.tutorial&&e.tutorial.metadata&&(e.tutorial.metadata.codeStart&&(s[pxt.TUTORIAL_CODE_START]=`control._onCodeStart('${pxt.U.htmlEscape(e.tutorial.metadata.codeStart)}')`,i.files.splice(i.files.indexOf(pxt.MAIN_TS),0,pxt.TUTORIAL_CODE_START)),e.tutorial.metadata.codeStop&&(s[pxt.TUTORIAL_CODE_STOP]=`control._onCodeStop('${pxt.U.htmlEscape(e.tutorial.metadata.codeStop)}')`,i.files.push(pxt.TUTORIAL_CODE_STOP))),s[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(i),await pxt.github.cacheProjectDependenciesAsync(i);const a=await o.installAsync({name:i.name,meta:{},editor:e.preferredEditor||e.prj.id,pubId:"",pubCurrent:!1,target:pxt.appTarget.id,targetVersion:pxt.appTarget.versions.target,cloudUserId:null===(r=this.getUserProfile())||void 0===r?void 0:r.id,temporary:e.temporary,tutorial:e.tutorial,extensionUnderTest:e.extensionUnderTest,isSkillmapProject:e.skillmapProject},s);await this.loadHeaderAsync(a,{filters:e.filters}),pxt.perf.measureEnd("createProjectAsync")}autoChooseBoardAsync(e){return pxt.appTarget.appTheme.chooseBoardOnNewProject&&pxt.appTarget.simulator&&pxt.appTarget.simulator.dynamicBoardDefinition?this.showBoardDialogAsync(e,!1):Promise.resolve()}importExampleAsync(e){const{name:t,path:n,loadBlocks:r,prj:i,preferredEditor:o}=e;return c.showLoading("changingcode",lf("loading...")),this.loadingExample=!0,this.loadActivityFromMarkdownAsync(n,t.toLowerCase(),o).then((e=>{const{filename:t,md:n,features:s,autoChooseBoard:a}=e||{},l=!i&&a,c=!!n&&pxt.gallery.parseExampleMarkdown(t,n);if(!c)throw new Error(lf("Example not found or invalid format"));const u=c;return i&&(u.prj=i),r&&o==pxt.BLOCKS_PROJECT_NAME?this.createProjectAsync(u).then((()=>this.loadBlocklyAsync().then(p.getBlocksAsync).then((e=>p.decompileAsync(pxt.MAIN_TS,e))).then((e=>{pxt.debug(`example decompilation: ${e.success}`),e.success&&this.overrideBlocksFile(e.outfiles[pxt.MAIN_BLOCKS])})).then((()=>l&&this.autoChooseBoardAsync(s))))):(r||(u.languageRestriction="no-blocks"),u.preferredEditor=o,this.createProjectAsync(u).then((()=>o==pxt.PYTHON_PROJECT_NAME&&"python"!==c.snippetType?p.getApisInfoAsync().then((()=>p.pyDecompileAsync(pxt.MAIN_TS))).then((e=>{pxt.debug(`example decompilation: ${e.success}`),e.success&&this.overrideTypescriptFile(e.outfiles[pxt.MAIN_PY])})).then((()=>l&&this.autoChooseBoardAsync(s))):Promise.resolve())))})).catch((e=>(c.warningNotification(lf("Please check your internet connection and check the example is valid.")),pxt.reportException(e),Promise.reject(e)))).finally((()=>{this.loadingExample=!1,c.hideLoading("changingcode")}))}switchTypeScript(){const e=l.mainEditorPkg(),t=this.editorFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME),n=e.files[t];this.setFile(n)}saveBlocksToTypeScriptAsync(){return this.blocksEditor.saveToTypeScriptAsync()}saveVirtualFileAsync(e,t,n){t=t||"\n";const r=l.mainEditorPkg(),i=this.editorFile.getVirtualFileName(e);return ne.assert(i&&i!=this.editorFile.name),r.setContentAsync(i,t).then((()=>{if(n){let e=r.files[i];this.setFile(e)}}))}saveTypeScriptAsync(e=!1){const t=l.mainEditorPkg();if(!this.editor||!this.state.currFile||this.editorFile.epkg!=t||this.reload)return Promise.resolve();const n=this.editorFile.getExtension(),r=this.editorFile.content;let i=e?this.textEditor.loadMonacoAsync():Promise.resolve();return"py"==n&&(i=i.then((()=>this.saveCurrentSourceAsync()))),i=i.then((()=>{if(e){this.openingTypeScript=!0;const e=t.getCachedTranspile(n,r,"ts");return e?Promise.resolve(e):this.editor.saveToTypeScriptAsync(!0).then((e=>(void 0!==e&&t.cacheTranspile(n,r,"ts",e),e)))}return this.editor.saveToTypeScriptAsync()})).then((t=>void 0===t&&e?c.confirmAsync({header:lf("Oops, there is a problem converting your code."),body:lf("We are unable to convert your code to JavaScript."),agreeLbl:lf("Done"),agreeClass:"cancel",agreeIcon:"cancel",hasCloseIcon:!0}).then((e=>{this.isPythonActive()&&pxt.shell.setEditorLanguagePref("py")})):void 0===t||this.editorFile&&this.editorFile.name==this.editorFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME)?Promise.resolve():this.editorFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME)?this.saveVirtualFileAsync(pxt.JAVASCRIPT_PROJECT_NAME,t,e):Promise.resolve())),e?c.showLoadingAsync("switchtojs",lf("switching to JavaScript..."),i,0):i}resetWorkspace(){return this.reload=!0,window.location.hash="#reload",o.resetAsync().then((()=>this.reloadEditor()),(()=>this.reloadEditor()))}pairAsync(){return h.pairAsync()}saveAndCompile(){if(this.state.header)return this.setState({isSaving:!0}),(this.state.projectName!==lf("Untitled")?Promise.resolve(!0):this.showRenameProjectDialogAsync()).then((e=>e?this.saveProjectNameAsync().then((()=>this.saveFileAsync())).then((()=>{!pxt.appTarget.compile.hasHex||pxt.appTarget.compile.useMkcd||pxt.appTarget.compile.saveAsPNG||xe()||Ee()?this.saveProjectToFileAsync().finally((()=>{this.setState({isSaving:!1})})):this.compile(!0)})):(this.setState({isSaving:!1}),Promise.resolve())))}checkForHwVariant(){if(pxt.hwVariant||!pxt.hasHwVariants())return!1;const e=pxt.getHwVariants();if(0==e.length)return!1;return pxt.usb.isEnabled&&pxt.appTarget.appTheme&&pxt.appTarget.appTheme.checkForHwVariantWebUSB&&this.checkWebUSBVariant?(pxt.packetio.initAsync(!0).then((t=>{if(t.familyID)for(let n of e){let e=pxt.U.clone(pxt.appTarget.compile);if(n.compileServiceVariant){let t=pxt.appTarget.variants[n.compileServiceVariant];t.compile&&pxt.U.jsonCopyFrom(e,t.compile)}if(parseInt(e.uf2Family)===t.familyID)return pxt.setHwVariant(n.name),pxt.tickEvent("projects.choosehwvariant",{hwid:pxt.hwVariant,card:"HID-"+pxt.hwVariant}),void this.reloadHeaderAsync().then((()=>this.compile()))}this.checkWebUSBVariant=!1,this.checkForHwVariant()}),(()=>h.pairAsync().then((()=>{this.checkForHwVariant()}),(e=>{this.checkWebUSBVariant=!1,this.checkForHwVariant()})))).then((()=>{pxt.perf.recordMilestone("HID bridge init finished")})),!0):(this.showChooseHwDialog(),!0)}beforeCompile(){}async compile(e=!1){if(pxt.tickEvent("compile",{editor:this.getPreferredEditor()}),pxt.debug("compiling..."),this.checkForHwVariant())return;if(pxt.appTarget.compile.saveAsPNG&&pxt.hasHwVariants()&&!pxt.hwVariant)return void this.saveAndCompile();let t;if(this.beforeCompile(),pxt.appTarget.compile.useModulator||!pxt.BrowserUtils.isBrowserDownloadInSameWindow()||pxt.BrowserUtils.isBrowserDownloadWithinUserContext()||(t=window.open("")),this.state.compiling)return void pxt.tickEvent("compile.double");let n=this.state.simState!=pxt.editor.SimState.Stopped;n&&this.state.simState==pxt.editor.SimState.Pending&&pxt.appTarget.simulator.emptyRunCode&&!this.isBlocksEditor()&&(n=!1);try{this.setState({compiling:!0,cancelledDownload:!1}),this.clearSerial(),this.editor.beforeCompile(),n&&this.stopSimulator();let r=this.editor.snapshotState();this.syncPreferredEditor();try{const i=await p.compileAsync({native:!0,forceEmit:!0});if(!(this.editor.setDiagnostics(this.editorFile,r),i.usedParts&&-1!==i.usedParts.indexOf("multiplayer")?this.setState({isMultiplayerGame:!0}):this.setState({isMultiplayerGame:!1}),e||await h.showUnsupportedHardwareMessageAsync(i)))return void this.setState({cancelledDownload:!0});let o=pxt.outputName();if(!i.outfiles[o]){pxt.tickEvent("compile.noemit");const t=i.diagnostics.find((e=>9043===e.code))||1==i.diagnostics.length?i.diagnostics[0]:void 0;if(9283===(null==t?void 0:t.code)&&pxt.commands.showProgramTooLargeErrorAsync){pxt.tickEvent("compile.programTooLargeDialog");const t=await pxt.commands.showProgramTooLargeErrorAsync(pxt.appTarget.multiVariants,c.confirmAsync);if(null==t?void 0:t.recompile){pxt.tickEvent("compile.programTooLargeDialog.recompile");const n=pxt.appTarget.multiVariants;this.setState({compiling:!1,isSaving:!1});try{return pxt.appTarget.multiVariants=t.useVariants,void await this.compile(e)}finally{pxt.appTarget.multiVariants=n}}else pxt.tickEvent("compile.programTooLargeDialog.cancelled")}return void(t?c.warningNotification(t.messageText):c.warningNotification(lf("Compilation failed, please check your code for errors.")))}i.saveOnly=e,i.userContextWindow=t,i.downloadFileBaseName=l.genFileName(""),i.confirmAsync=c.confirmAsync;let s=this.state.header;if(s&&(i.headerId=s.id),pxt.commands.patchCompileResultAsync&&await pxt.commands.patchCompileResultAsync(i),e)return void await pxt.commands.saveOnlyAsync(i);i.success||this.maybeShowPackageErrors(!0)||c.confirmAsync({header:lf("Compilation failed"),body:lf("Ooops, looks like there are errors in your program."),hideAgree:!0,disagreeLbl:lf("Close")}),n&&(this.runSimulator(),n=!1);let a=Date.now();pxt.tickEvent("deploy.start");try{this._deploying=!0,await pxt.commands.deployAsync(i,{reportError:e=>{pxt.tickEvent("deploy.reporterror"),c.errorNotification(e)},showNotification:e=>c.infoNotification(e)});let e=Date.now()-a;pxt.tickEvent("deploy.finished",{elapsedMs:e})}catch(e){if(e.notifyUser)c.warningNotification(e.message);else{const e=pxt.appTarget.appTheme.useUploadMessage?lf("Upload failed, please try again."):lf("Download failed, please try again.");c.warningNotification(e)}let n=Date.now()-a;if(pxt.tickEvent("deploy.exception",{notifyUser:e.notifyUser,elapsedMs:n}),pxt.reportException(e),t)try{t.close()}catch(e){}}finally{this._deploying=!1,pxt.BrowserUtils.isDocumentVisible()||(pxt.debug("visibility: updated after deploy"),await this.updateVisibilityAsync())}}catch(e){if(pxt.reportException(e),c.errorNotification(lf("Compilation failed, please contact support.")),t)try{t.close()}catch(e){}}finally{this.setState({compiling:!1,isSaving:!1}),n&&this.runSimulator()}}catch(e){this.setState({compiling:!1,isSaving:!1}),pxt.reportException(e),c.errorNotification(lf("Compilation failed, please try again."))}}overrideTypescriptFile(e){this.textEditor&&this.textEditor.overrideFile(e)}overrideBlocksFile(e){this.blocksEditor&&this.blocksEditor.overrideFile(e)}async setLanguageRestrictionAsync(e){if(this.state.header){const t=l.mainEditorPkg(),n=t.files["pxt.json"],r=pxt.Package.parseAndValidConfig(null==n?void 0:n.content);if(r){let i;switch(r.languageRestriction=e,await n.setContentAsync(JSON.stringify(r,null,4)),e){case"blocks-only":case"no-javascript":case"":i=[];break;case"javascript-only":i=[pxt.MAIN_BLOCKS,pxt.MAIN_PY];break;case"python-only":case"no-blocks":i=[pxt.MAIN_BLOCKS];break;case"no-python":i=[pxt.MAIN_PY]}for(const e of i)await t.removeFileAsync(e);switch(e){case"blocks-only":case"no-javascript":case"":case"no-python":if(this.editorFile.name!==pxt.MAIN_BLOCKS)return void this.openBlocksAsync();break;case"javascript-only":case"no-blocks":if(this.editorFile.name!==pxt.MAIN_TS)return void await this.openTypeScriptAsync();break;case"python-only":if(this.editorFile.name!==pxt.MAIN_PY)return void await this.openPythonAsync()}await this.reloadHeaderAsync()}}}startStopSimulator(e){switch(this.state.simState){case pxt.editor.SimState.Starting:case pxt.editor.SimState.Pending:break;case pxt.editor.SimState.Running:this.stopSimulator(!1,e);break;default:this.maybeShowPackageErrors(!0),this.startSimulator(e),e&&e.clickTrigger&&d.driver.focus()}}toggleTrace(e){const t=!!this.state.tracing;t?(this.editor.clearHighlightedStatements(),d.setTraceInterval(0)):d.setTraceInterval(e||d.SLOW_TRACE_INTERVAL),this.setState({tracing:!t},(()=>{this.state.debugging?this.onDebuggingStart():this.restartSimulator()}))}setTrace(e,t){!!this.state.tracing!=e?this.toggleTrace(t):this.state.tracing&&(d.setTraceInterval(t||d.SLOW_TRACE_INTERVAL),this.startSimulator())}proxySimulatorMessage(e){d.proxy({type:"custom",content:e})}toggleSimulatorCollapse(){const e=this.state;pxt.tickEvent("simulator.toggleCollapse",{view:"computer",collapsedTo:""+!e.collapseEditorTools},{interactiveConsent:!0}),e.simState==pxt.editor.SimState.Stopped&&e.collapseEditorTools&&this.startStopSimulator(),e.collapseEditorTools?this.expandSimulator():this.collapseSimulator()}expandSimulator(){pxt.appTarget.simulator.headless?d.unhide():this.startSimulator(),this.setState({collapseEditorTools:!1}),this.fireResize()}collapseSimulator(){d.hide((()=>{this.setState({collapseEditorTools:!0}),this.fireResize()}))}setSimulatorFullScreen(e){this.state.collapseEditorTools&&this.expandSimulator(),e?document.removeEventListener("keydown",this.closeOnEscape):(document.addEventListener("keydown",this.closeOnEscape),d.driver.focus()),this.closeFlyout(),this.setState({fullscreen:e})}toggleSimulatorFullscreen(){this.setSimulatorFullScreen(!this.state.fullscreen)}closeFlyout(){this.editor.closeFlyout()}toggleMute(){this.setMute(!this.state.mute)}setMute(e){d.mute(e),this.setState({mute:e})}openInstructions(){const e=this.state.simState!=pxt.editor.SimState.Stopped;e&&this.stopSimulator(),N.makeAsync().finally((()=>{e&&this.startSimulator()}))}printCode(){if(!this.state.header)return;const e=l.mainEditorPkg().getAllFiles(),t=pxt.webConfig.docsUrl||"/--docs",n=ae.isBlocksActive()?"blocks":ae.isPythonActive()?"python":"typescript";window.localStorage.printjob=JSON.stringify(e);const i=`${t}#print:job:${n}:${pxt.Util.localeInfo()}`;c.dialogAsync({header:lf("Print Code"),hasCloseIcon:!0,size:"large",jsx:(0,r.jsx)("div",Object.assign({className:"ui container"},{children:(0,r.jsx)("div",Object.assign({id:"printcontainer",style:{position:"relative",height:0,paddingBottom:"40%",overflow:"hidden"}},{children:(0,r.jsx)("iframe",{frameBorder:"0","aria-label":lf("Print preview"),sandbox:"allow-popups allow-forms allow-scripts allow-same-origin allow-modals",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},src:i})}))}))}).then((e=>{}))}clearSerial(){var e,t;this.serialEditor.clear(),null===(e=this.simulatorSerialIndicator())||void 0===e||e.clear(),null===(t=this.deviceSerialIndicator())||void 0===t||t.clear(),this.setState({simSerialActive:!1,deviceSerialActive:!1})}simulatorSerialIndicator(){return this.refs.simIndicator}deviceSerialIndicator(){return this.refs.devIndicator}shouldStartSimulator(){switch(this.state.simState){case pxt.editor.SimState.Starting:case pxt.editor.SimState.Running:return!1}return!!pxt.shell.isControllerMode()||!this.state.home}isSimulatorRunning(){return this.state.simState==pxt.editor.SimState.Running}restartSimulator(){const e=this.state.tracing||this.state.debugging;this.state.simState==pxt.editor.SimState.Stopped||this.debugOptionsChanged()?this.startSimulator():(d.driver.stopSound(),d.driver.restart()),d.driver.focus(),e||this.blocksEditor.clearBreakpoints()}startSimulator(e){pxt.tickEvent("simulator.start");const t=!this.debugOptionsChanged(),n=e&&e.clickTrigger;return pxt.debug(`start sim (autorun ${this.state.autoRun})`),!this.shouldStartSimulator()&&t?(pxt.log("Ignoring call to start simulator, either already running or we shouldn't start."),Promise.resolve()):this.saveFileAsync().then((()=>this.runSimulator({debug:this.state.debugging,clickTrigger:n})))}debugOptionsChanged(){const{debugging:e,tracing:t}=this.state;return!!e!=d.driver.isDebug()||!!t!=d.driver.isTracing()}stopSimulator(e,t){pxt.perf.measureStart("stopSimulator"),pxt.tickEvent("simulator.stop");const n=t&&t.clickTrigger;pxt.debug(`sim: stop (autorun ${this.state.autoRun})`),this.runToken&&(this.runToken.cancel(),this.runToken=null),d.stop(e);const r=this.state.autoRun&&!n;this.setState({simState:pxt.editor.SimState.Stopped,autoRun:r}),pxt.perf.measureEnd("stopSimulator")}suspendSimulator(){pxt.tickEvent("simulator.suspend"),this.runToken&&(this.runToken.cancel(),this.runToken=null),d.suspend()}showMiniSim(e){this.setState({showMiniSim:e})}onHighContrastChanged(){this.clearSerial(),this.stopSimulator(),this.startSimulator();const e=this.getData(F.HIGHCONTRAST),t=document.body.classList.contains("high-contrast");e?t||document.body.classList.add("high-contrast"):t&&document.body.classList.remove("high-contrast")}onCloudStatusChanged(e){const t=this.getData(e),n=null==t?void 0:t.cloudStatus();if(n){const e={type:"pxteditor",action:"projectcloudstatus",headerId:t.headerId,status:n.value};pxt.editor.postHostMessageAsync(e)}}runSimulator(e={}){const t=this.firstRun&&e.background&&pxt.appTarget.simulator&&!!pxt.appTarget.simulator.emptyRunCode&&!this.isBlocksEditor();this.firstRun&&pxt.BrowserUtils.isSafari()&&this.setMute(!0),pxt.debug(`sim: start run (autorun ${this.state.autoRun}, first ${this.firstRun})`),this.firstRun=!1,this.runToken&&this.runToken.cancel();let n=new pxt.Util.CancellationToken;return this.runToken=n,n.startOperation(),(()=>{const r=this.editor?this.editor.getId().replace(/Editor$/,""):"unknown";if(e.background){if(pxt.tickEvent("activity.autorun",{editor:r}),pxt.storage.getLocal("noAutoRun"))return Promise.resolve()}else pxt.tickEvent(e.debug?"debug":"run",{editor:r});e.background||this.editor.beforeCompile(),this.state.tracing&&this.state.debugging&&(e.trace=!0),e.debug&&(e.debugExtensionCode=pxt.appTarget.appTheme.debugExtensionCode&&!this.isBlocksActive()),this.syncPreferredEditor(),d.stop(!1,!0);const i=this.autoRunOnStart()&&this.isBlocksEditor()&&(this.state.autoRun||!!e.clickTrigger),o=this.editor.snapshotState();return this.setStateAsync({simState:pxt.editor.SimState.Starting,autoRun:i}).then((()=>t?Promise.resolve(p.emptyCompileResult()):p.compileAsync(e))).then((t=>{var r,i;if(n.isCancelled())pxt.debug("sim: cancelled");else if(this.clearSerial(),this.editor.setDiagnostics(this.editorFile,o),t.usedParts&&-1!==t.usedParts.indexOf("multiplayer")?this.setState({isMultiplayerGame:!0}):this.setState({isMultiplayerGame:!1}),t.outfiles[pxtc.BINARY_JS]){if(!n.isCancelled()){pxt.debug("sim: run");const o=a.getData(F.HIGHCONTRAST);(null===(i=(r=pxt.react).isFieldEditorViewVisible)||void 0===i?void 0:i.call(r))||d.run(l.mainPkg,e.debug,t,{mute:this.state.mute,highContrast:o,light:pxt.options.light,clickTrigger:e.clickTrigger,storedState:l.mainEditorPkg().getSimState(),autoRun:this.state.autoRun},e.trace),this.blocksEditor.setBreakpointsMap(t.breakpoints,t.procCallLocations),this.textEditor.setBreakpointsMap(t.breakpoints,t.procCallLocations),n.isCancelled()?(pxt.debug("sim: cancelled 2"),d.stop(),this.setState({simState:pxt.editor.SimState.Stopped})):this.setState({showParts:d.driver.hasParts()})}}else e.background||(c.warningNotification(lf("Oops, we could not run this project. Please check your code for errors.")),d.stop(),this.setState({simState:pxt.editor.SimState.Stopped}))})).finally((()=>{n.isCancelled()||n.resolveCancel(),n=null}))})()}openNewTab(e,t){if(!e||pxt.BrowserUtils.isElectron()||pxt.BrowserUtils.isIOS())return;let n=window.location.href.replace(/#.*$/,"");t&&(n=n+(n.indexOf("?")>-1?"&":"?")+"nestededitorsim=1&lockededitor=1"),n+="#header:"+e.id;const r=window.open(n,pxt.appTarget.id+e.id);r&&(pxt.log("dependent editor window registered"),d.driver.registerDependentEditor(r))}createGitHubRepositoryAsync(){const{projectName:e,header:t}=this.state;return s.githubProvider(!0).createRepositoryAsync(e,t).then((e=>e&&this.reloadHeaderAsync()))}simDebug(){pxt.tickEvent("menu.debug.sim"),this.stopSimulator(),this.runSimulator({debug:!0})}hwDebug(){pxt.tickEvent("menu.debug.hw");let e=Promise.resolve();return this.state.simState==pxt.editor.SimState.Running&&d.driver.isDebug()||(e=this.runSimulator({debug:!0})),e.then((()=>(d.driver.setHwDebugger({postMessage:e=>{pxt.HWDBG.handleMessage(e)}}),pxt.HWDBG.postMessage=e=>d.driver.handleHwDebuggerMsg(e),Promise.all([p.compileAsync({debug:!0,native:!0}),pxt.packetio.initAsync()]).then((e=>pxt.HWDBG.startDebugAsync(e[0],e[1]))))))}toggleDebugging(){const e=!this.state.debugging;this.setState({debugging:e,debugFirstRun:e},(()=>{this.setSimulatorFullScreen(!1),this.onDebuggingStart()}))}onDebuggingStart(){this.renderCore(),this.editor&&(this.editor.updateBreakpoints(),this.editor.updateToolbox()),this.restartSimulator()}dbgPauseResume(){d.dbgPauseResume()}dbgStepOver(){d.dbgStepOver()}dbgStepInto(){d.dbgStepInto()}dbgInsertBreakpoint(){this.editor.insertBreakpoint()}editText(){this.editor!=this.textEditor&&(this.updateEditorFileAsync(this.textEditor).then((()=>{this.textEditor.editor.focus()})),this.forceUpdate())}hasCloudSync(){return this.isLoggedIn()}showScriptManager(){this.scriptManagerDialog.show()}importProjectDialog(){this.importDialog.show()}renderPythonAsync(e){return p.decompilePythonSnippetAsync(e.ts).then((e=>({python:e})))}blocksScreenshotAsync(e,t){return pxt.blocks.layout.screenshotEnabled()&&this.blocksEditor&&this.blocksEditor.isReady&&this.blocksEditor.editor?pxt.blocks.layout.screenshotAsync(this.blocksEditor.editor,e,t):Promise.resolve(void 0)}renderBlocksAsync(e){return p.getBlocksAsync().then((t=>p.decompileBlocksSnippetAsync(e.ts,t,e))).then((t=>{const n=pxt.blocks.render(t.outfiles[pxt.MAIN_BLOCKS],{snippetMode:e.snippetMode||!1,layout:void 0!==e.layout?e.layout:pxt.blocks.BlockLayout.Align,splitSvg:!1}),r=n.getAttribute("viewBox").split(/\s+/).map((e=>parseInt(e)));return{svg:n,xml:pxt.blocks.layout.blocklyToSvgAsync(n,r[0],r[1],r[2],r[3])}}))}launchFullEditor(){ne.assert(pxt.shell.isSandboxMode());let e=pxt.appTarget.appTheme.embedUrl;/\/$/.test(e)||(e+="/");const t=l.mainPkg,n=l.getEditorPkg(t);pxt.shell.isReadOnly()?(n.header.pubId,e+=`#pub:${n.header.pubId}`,window.open(e,"_blank")):this.exportAsync().then((t=>{pxt.tickEvent("sandbox.openfulleditor"),e+=`#project:${t}`,window.open(e,"_blank")}))}async anonymousPublishHeaderByIdAsync(e,t){const n=o.getHeader(e),r=await o.getTextAsync(e),i=JSON.stringify(r,null,2)+"\n";if(t&&r[pxt.CONFIG_NAME])try{const e=JSON.parse(r[pxt.CONFIG_NAME]);e.name=t,r[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(e)}catch(e){pxt.debug("Could not update config")}const s={name:t||n.name,target:n.target,targetVersion:n.targetVersion,description:lf("Made with  in {0}.",pxt.appTarget.title||pxt.appTarget.name),editor:n.editor,text:r,meta:{versions:pxt.appTarget.versions,blocksHeight:0,blocksWidth:0}};pxt.debug(`publishing script; ${i.length} bytes`);const a=await te.privatePostAsync("scripts",s,!0);return this.getShareUrl(a.shortid||a.id,!1)}async publishAsync(e,t,n){pxt.tickEvent("menu.embed.publish",void 0,{interactiveConsent:!0}),e&&this.state.projectName!=e&&await this.updateHeaderNameAsync(e);const r=F.hasIdentity()&&this.isLoggedIn();try{const e=r&&!n,i=await this.publishCurrentHeaderAsync(e,t);return await this.getShareUrl(i,e)}catch(e){return pxt.tickEvent("menu.embed.error",{code:e.statusCode}),{url:"",embed:{},error:e}}}async getShareUrl(e,t){const n=pxt.appTarget.appTheme;let r={url:"",embed:{}},i=(t?n.homeUrl:n.shareUrl)||"https://makecode.com/";/\/$/.test(i)||(i+="/");let o=n.embedUrl;/\/$/.test(o)||(o+="/");const s=pxt.webConfig.verprefix||"";r.url=`${i}${e}`,r.embed.code=pxt.docs.codeEmbedUrl(`${o}${s}`,e),r.embed.editor=pxt.docs.embedUrl(`${o}${s}`,"pub",e),r.embed.url=`${o}${s}#pub:${e}`;let a="81.97%",l=`${s}---run`;pxt.webConfig.runUrl&&(l=pxt.webConfig.isStatic?pxt.webConfig.runUrl:pxt.webConfig.runUrl.replace(pxt.webConfig.relprefix,"/---")),pxt.appTarget.simulator&&(a=(100/pxt.appTarget.simulator.aspectRatio).toPrecision(4)+"%");const c=o+l.replace(/^\//,"");return r.embed.simulator=pxt.docs.runUrl(c,a,e),n.qrCode&&(r.qr=await V.renderAsync(`${i}${e}`)),r}async publishCurrentHeaderAsync(e,t){pxt.tickEvent("publish"),this.setState({publishing:!0});const n=l.mainPkg,r=l.getEditorPkg(n);try{await this.saveProjectNameAsync(),await this.saveFileAsync();const i=await n.filesToBePublishedAsync(!0);if(r.header.pubCurrent&&!t)return r.header.pubId;const s={description:n.config.description},a=this.blocksEditor.contentSize();return a&&(s.blocksHeight=a.height,s.blocksWidth=a.width),e?(await o.persistentPublishAsync(r.header,i,s,t)).pubId:(await o.anonymousPublishAsync(r.header,i,s,t)).id}finally{this.setState({publishing:!1})}}hasHeaderBeenPersistentShared(){var e;return!!(null===(e=this.state.header)||void 0===e?void 0:e.pubPermalink)}getSharePreferenceForHeader(){var e;return null===(e=this.state.header)||void 0===e?void 0:e.anonymousSharePreference}async saveSharePreferenceForHeaderAsync(e){this.state.header&&(this.state.header.anonymousSharePreference=e,await o.saveAsync(this.state.header))}async saveLocalProjectsToCloudAsync(e){return U.saveLocalProjectsToCloudAsync(e)}async requestProjectCloudStatus(e){await U.requestProjectCloudStatus(e)}convertCloudProjectsToLocal(e){return U.convertCloudToLocal(e)}updateHeaderName(e){this.setState({projectName:e}),this.debouncedSaveProjectName||(this.debouncedSaveProjectName=ne.debounce((()=>{this.saveProjectNameAsync()}),pxt.options.light?2e3:500,!1)),this.debouncedSaveProjectName()}saveProjectNameAsync(){if(!this.state.projectName||!this.state.header)return Promise.resolve();try{return this.updateHeaderNameAsync(this.state.projectName)}catch(e){return pxt.reportException(e),Promise.resolve()}}updateHeaderNameAsync(e){if(l.mainPkg.config.name==e)return Promise.resolve();l.mainPkg.config.name=e,pxt.debug("saving project name to "+e);let t=l.mainEditorPkg().lookupFile("this/"+pxt.CONFIG_NAME),n=JSON.parse(t.content);return n.name=e,t.setContentAsync(pxt.Package.stringifyConfig(n)).then((()=>{this.state.header&&this.setState({projectName:e})}))}isTextEditor(){return this.editor==this.textEditor}isPxtJsonEditor(){return this.editor==this.pxtJsonEditor}isBlocksEditor(){return this.editor==this.blocksEditor}loadBlocklyAsync(){return this.blocksEditor.loadBlocklyAsync()}createModalClasses(e){const t=[e,-1!=this.rootClasses.indexOf("flyoutOnly")?"flyoutOnly":"",-1!=this.rootClasses.indexOf("inverted-theme")?"inverted-theme":"",-1!=this.rootClasses.indexOf("hideIteration")?"hideIteration":""];return u.cx(t)}showReportAbuse(){const e=this.state.tutorialOptions&&this.state.tutorialOptions.tutorialReportId||this.state.header&&this.state.header.pubCurrent&&this.state.header.pubId;w.showReportAbuseAsync(e)}showAboutDialog(){w.showAboutDialogAsync(this)}showLoginDialog(e){this.loginDialog.show(e)}showProfileDialog(e){this.profileDialog.show(e)}showShareDialog(e,t){this.shareEditor.show(e,t)}showLanguagePicker(){this.languagePicker.show()}showImportUrlDialog(){w.showImportUrlDialogAsync().then((e=>{e&&(pxt.github.isGithubId(e)?ve(e):ye(e))}),(e=>{c.errorNotification(lf("Sorry, the project url looks invalid."))}))}showImportGithubDialog(){w.showImportGithubDialogAsync().then((e=>{"NEW"===e?w.showCreateGithubRepoDialogAsync().then((e=>{e&&ve(e)})):e&&ve(e)}),(e=>{c.errorNotification(lf("Sorry, that repository looks invalid."))}))}showImportFileDialog(e){w.showImportFileDialogAsync(e).then((t=>{t&&(pxt.tickEvent("app.open.file"),this.importFile(t,e))}))}showResetDialog(){w.showResetDialogAsync().then((e=>e?(w.clearDontShowDownloadDialogFlag(),B.clearUserPrefersDownloadFlag(),this.resetWorkspace()):Promise.resolve()))}showExitAndSaveDialog(){var e,t;this.setState({debugging:!1}),this.isTutorial()?(pxt.tickEvent("tutorial.exit.home",{tutorial:null===(t=null===(e=this.state.header)||void 0===e?void 0:e.tutorial)||void 0===t?void 0:t.tutorial}),this.exitTutorialAsync().finally((()=>this.openHome()))):this.state.projectName!==lf("Untitled")?this.openHome():this.exitAndSaveDialog.show()}askForProjectCreationOptionsAsync(){return this.newProjectDialog.promptUserAsync()}hidePackageDialog(){this.setState(Object.assign(Object.assign({},this.state),{extensionsVisible:!1}))}showPackageDialog(){this.setState(Object.assign(Object.assign({},this.state),{extensionsVisible:!0}))}showBoardDialogAsync(e,t){return this.scriptSearch.showBoardsAsync(e,t)}showModalDialogAsync(e){return c.dialogAsync({header:e.header,body:e.body,hasCloseIcon:!0,buttons:e.buttons})}showExperimentsDialog(){this.scriptSearch.showExperiments()}showChooseHwDialog(e){this.chooseHwDialog&&this.chooseHwDialog.show(e)}showRenameProjectDialogAsync(){if(!this.state.header||this.state.header.githubId)return Promise.resolve(!1);const e={header:lf("Rename your project"),agreeLbl:lf("Save"),agreeClass:"green",placeholder:lf("Enter your project name here")};return c.promptAsync(e).then((e=>null===e?Promise.resolve(!1):new Promise(((t,n)=>{this.setState({projectName:e},(()=>t()))})).then((()=>this.saveProjectNameAsync())).then((()=>!0))))}loadActivityFromMarkdownAsync(e,t,n){const r=o.getHeader(e.split(":")[0]),i=!r&&pxt.Cloud.parseScriptId(e),s=!r&&!i&&pxt.github.parseRepoId(e);let a,l,u,d,p=!0,h={},f=!1;if(/^\//.test(e))a=t||e.split("/").reverse()[0].replace("-"," "),l=pxt.Cloud.markdownAsync(e).then((e=>(p=!0,g(e))));else if(i)pxt.tickEvent("tutorial.shared",{tutorial:i}),l=o.downloadFilesByIdAsync(i).then((e=>{const t=pxt.Package.parseAndValidConfig(e["pxt.json"]);return pxt.Util.jsonMergeFrom(h,t.dependencies),a=t.name||lf("Untitled"),p=!1,u=i,g(e["README.md"])}));else if(s&&s.owner&&s.project)pxt.tickEvent("tutorial.github"),pxt.log(`loading tutorial from ${s.fullName}`),l=pxt.packagesConfigAsync().then((e=>{switch(pxt.github.repoStatus(s,e)){case pxt.github.GitRepoStatus.Banned:throw lf("This GitHub repository has been banned.");case pxt.github.GitRepoStatus.Approved:u=void 0;break;default:u="https://github.com/"+s.slug}return(s.tag?Promise.resolve(s.tag):pxt.github.latestVersionAsync(s.slug,e,!0)).then((t=>{if(t)return s.tag=t,pxt.log(`tutorial ${s.fullName} tag: ${t}`),pxt.github.downloadPackageAsync(`${s.slug}#${s.tag}`,e);pxt.log(`tutorial github tag not found at ${s.fullName}`)}))})).then((t=>{let n=Promise.resolve();return t.files[pxt.TUTORIAL_INFO_FILE]&&n.then((()=>pxt.tutorial.parseCachedTutorialInfo(t.files[pxt.TUTORIAL_INFO_FILE],e))),n.then((()=>t&&m(s,t.files)))}));else if(r){pxt.tickEvent("tutorial.header"),f=!0;const t=pxt.github.parseRepoId(r.githubId),n=e.split(":")[1]||"README";l=o.getTextAsync(r.id).then((e=>m(t,e,n)))}else l=Promise.resolve(void 0);return l.then((e=>({reportId:u,filename:a,autoChooseBoard:p,dependencies:h,features:d,temporary:f,md:e}))).catch((e=>{c.handleNetworkError(e),c.errorNotification(lf("Oops, we could not load this activity.")),this.openHome()}));function g(e){return e?(n==pxt.JAVASCRIPT_PROJECT_NAME?e=e.replace(/^```(blocks|block|spy)\b/gm,"```typescript"):n==pxt.PYTHON_PROJECT_NAME&&(e=e.replace(/^```(blocks|block|typescript)\b/gm,"```spy")),pxt.Util.jsonMergeFrom(h,pxt.gallery.parsePackagesFromMarkdown(e)),d=pxt.gallery.parseFeaturesFromMarkdown(e),e):e}function m(e,t,n){const r=pxt.Package.parseAndValidConfig(t["pxt.json"]);return r.files.find((e=>/\.ts$/.test(e)))?(h={})[e.project]=pxt.github.toGithubDependencyPath(e.slug,e.tag):pxt.Util.jsonMergeFrom(h,r.dependencies),a=r.name||lf("Untitled"),p=!1,g(pxt.tutorial.resolveLocalizedMarkdown(e,t,n))}}startTutorialAsync(e,t,n,r,i,o){var s,a,u,d,p,h;return(null===(a=null===(s=this.state.header)||void 0===s?void 0:s.tutorial)||void 0===a?void 0:a.tutorial)&&(pxt.tickEvent("recipe.exit",{tutorial:null===(d=null===(u=this.state.header)||void 0===u?void 0:u.tutorial)||void 0===d?void 0:d.tutorial,goto:e}),pxt.tickEvent("tutorial.finish",{tutorial:null===(h=null===(p=this.state.header)||void 0===p?void 0:p.tutorial)||void 0===h?void 0:h.tutorial})),c.hideDialog(),c.showLoading("tutorial",lf("starting tutorial...")),O.initTutorial(),n=n&&!!this.state.header,this.loadActivityFromMarkdownAsync(e,t,r).then((t=>{const{filename:s,dependencies:a,temporary:c,reportId:u,autoChooseBoard:d,features:p,md:h}=t||{};if(!h)throw new Error(lf("Tutorial {0} not found",e));const{options:f,editor:g}=pxt.tutorial.getTutorialOptions(h,e,s,u,!!n);this.hintManager.clearViewedHints(),f.mergeCarryoverCode=o,f.mergeHeaderId=i;const m=r||g;if(n){const e=l.mainEditorPkg().header;return e.tutorial=f,e.tutorialCompleted=void 0,this.loadHeaderAsync(e)}return this.createProjectAsync({name:s,tutorial:f,preferredEditor:m,dependencies:a,temporary:c,skillmapProject:pxt.BrowserUtils.isSkillmapEditor()}).then((()=>d?this.autoChooseBoardAsync(p):Promise.resolve())).then((()=>this.postTutorialProgress()))})).catch((t=>{pxt.reportException(t,{tutorialId:e}),c.warningNotification(lf("Please check your internet connection and check the tutorial is valid.")),this.openHome()})).finally((()=>c.hideLoading("tutorial")))}async startActivity(e){const{activity:t,path:n,editor:r,title:i,focus:o,importOptions:s,previousProjectHeaderId:a,carryoverPreviousCode:l}=e;switch(this.textEditor.giveFocusOnLoading=o,t){case"tutorial":pxt.tickEvent("tutorial.start",{tutorial:n,editor:r}),await this.startTutorialAsync(n,i,!1,r,e.previousProjectHeaderId,e.carryoverPreviousCode);break;case"recipe":pxt.tickEvent("recipe.start",{recipe:n,editor:r}),await this.startTutorialAsync(n,i,!0,r);break;case"example":pxt.tickEvent("example.start",{example:n,editor:r}),await this.importExampleAsync(Object.assign({name:i,path:n,preferredEditor:r},s))}}completeTutorialAsync(){var e,t,n,r;pxt.tickEvent("tutorial.finish",{tutorial:null===(t=null===(e=this.state.header)||void 0===e?void 0:e.tutorial)||void 0===t?void 0:t.tutorial}),pxt.tickEvent("tutorial.complete",{tutorial:null===(r=null===(n=this.state.header)||void 0===n?void 0:n.tutorial)||void 0===r?void 0:r.tutorial}),c.showLoading("leavingtutorial",lf("leaving tutorial...")),this.postTutorialCompleted();const i=this.state.header.tutorial;return i&&!this.state.header.isSkillmapProject&&(this.state.tutorialOptions&&this.state.tutorialOptions.tutorialRecipe?this.state.header.tutorialCompleted=void 0:this.state.header.tutorialCompleted={id:i.tutorial,steps:i.tutorialStepInfo.length},this.state.header.tutorial=void 0),pxt.BrowserUtils.isIE()?(this.exitTutorial(),Promise.resolve()):pxt.BrowserUtils.isSkillmapEditor()?this.exitTutorialAsync().finally((()=>{c.hideLoading("leavingtutorial")})):this.exitTutorialAsync().then((()=>{let e=l.mainEditorPkg().header;return this.loadHeaderAsync(e)})).finally((()=>{c.hideLoading("leavingtutorial"),this.state.collapseEditorTools&&this.expandSimulator(),this.postTutorialProgress()})).then((()=>{pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.appTheme.shareFinishedTutorials&&(pxt.tickEvent("tutorial.share",void 0,{interactiveConsent:!1}),this.showShareDialog(lf("Well done! Would you like to share your project?")))}))}exitTutorial(e){var t,n;pxt.tickEvent("tutorial.exit",{tutorial:null===(n=null===(t=this.state.header)||void 0===t?void 0:t.tutorial)||void 0===n?void 0:n.tutorial}),c.showLoading("leavingtutorial",lf("leaving tutorial...")),this.postTutorialExit(),this.exitTutorialAsync(e).finally((()=>{c.hideLoading("leavingtutorial"),this.openHome()}))}async exitTutorialAsync(e){let t=l.mainEditorPkg().header;t.isDeleted=e;let n=l.mainEditorPkg().getAllFiles();try{await o.saveAsync(t,n),await ne.delay(500)}catch(e){}finally{c.resetFocus(),await this.setStateAsync({tutorialOptions:void 0,tracing:void 0,editorState:void 0}),this.state.header&&await o.saveAsync(this.state.header)}}showTutorialHint(e){let t=this.refs[de.tutorialCardId];t&&t.showHint(!0,e)}isTutorial(){return null!=this.state.tutorialOptions}onTutorialLoaded(){pxt.tickEvent("tutorial.editorLoaded"),this.postTutorialLoaded()}setEditorOffset(){var e,t,n;if(this.isTutorial())if(pxt.BrowserUtils.useOldTutorialLayout()){const r=document.getElementById("tutorialcard");if(r){let i=0;(!1===(null===(e=this.state.editorState)||void 0===e?void 0:e.hasCategories)||(null===(n=null===(t=this.state.tutorialOptions)||void 0===t?void 0:t.metadata)||void 0===n?void 0:n.flyoutOnly))&&(i=document.getElementById("headers").offsetHeight);const o=r.offsetHeight+i;this.setState({editorOffset:`${o}px`})}}else{const e=null===document||void 0===document?void 0:document.getElementById("tutorialWrapper");e&&(pxt.BrowserUtils.isTabletSize()||pxt.appTarget.appTheme.tutorialSimSidebarLayout)?this.setState({editorOffset:e.offsetHeight+"px"}):this.setState({editorOffset:void 0})}}saveTutorialTemplateAsync(){return l.mainEditorPkg().buildAssetsAsync().then((()=>l.mainPkg.saveToJsonAsync())).then((e=>{pxt.BrowserUtils.browserDownloadText(e.source,l.genFileName(".assets.mkcd"))}))}pokeUserActivity(){this.state.tutorialOptions&&this.state.tutorialOptions.tutorial&&this.hintManager.pokeUserActivity(de.tutorialCardId,this.state.tutorialOptions.tutorialStep,this.state.tutorialOptions.tutorialHintCounter)}stopPokeUserActivity(){this.hintManager.stopPokeUserActivity()}clearUserPoke(){this.setState({pokeUserComponent:null})}setHintSeen(e){this.hintManager.viewedHint(e)}tutorialCardHintCallback(){let e=this.state.tutorialOptions;e.tutorialHintCounter=e.tutorialHintCounter+1,this.setState({pokeUserComponent:de.tutorialCardId,tutorialOptions:e}),setTimeout((()=>this.clearUserPoke()),1e4)}toggleHighContrast(){c.toggleHighContrast(),pxt.tickEvent("app.highcontrast",{on:c.getHighContrastOnce()?1:0}),this.isSimulatorRunning()&&this.startSimulator()}setHighContrast(e){return c.setHighContrast(e)}toggleGreenScreen(){const e=!this.state.greenScreen;pxt.tickEvent("app.greenscreen",{on:e?1:0}),this.setState({greenScreen:e})}toggleAccessibleBlocks(){this.setAccessibleBlocks(!this.state.accessibleBlocks)}setAccessibleBlocks(e){pxt.tickEvent("app.accessibleblocks",{on:e?1:0}),this.blocksEditor.enableAccessibleBlocks(e),this.setState({accessibleBlocks:e})}setBannerVisible(e){this.setState({bannerVisible:e})}hideLightbox(){this.setState({lightbox:!1})}showLightbox(){this.setState({lightbox:!0})}hideOnboarding(){this.setState({onboarding:void 0})}async showOnboarding(){var e,t;const n=await(0,se.parseTourStepsAsync)(null===(t=null===(e=pxt.appTarget.appTheme)||void 0===e?void 0:e.tours)||void 0===t?void 0:t.editor);this.setState({onboarding:n})}showKeymap(e){this.setState({keymap:e})}toggleKeymap(){this.state.keymap?this.showKeymap(!1):this.showKeymap(!0)}renderCore(){var e,t,n;!function(e){if(ae=e,ce){for(;ce.length;)ce.shift()(e);ce=void 0}}(this);const i=pxt.appTarget.appTheme,o=pxt.appTarget.simulator,s=pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&!pxt.shell.isControllerMode(),a=pxt.shell.isSandboxMode(),c=!this.editor.isVisible||this.getPreferredEditor()===pxt.BLOCKS_PROJECT_NAME,d=!(a||i.hideSideDocs),p=this.state.tutorialOptions,f=!!p&&!!p.tutorial,g=pxt.appTarget.appTheme.sidebarTutorial,m=f&&!pxt.BrowserUtils.useOldTutorialLayout(),w=f&&p.tutorialStepExpanded,O=pxt.appTarget.appTheme.tutorialSimSidebarLayout&&!pxt.BrowserUtils.isTabletSize(),N=this.state.debugging,R=this.state.home&&!a,P=!!this.state.header&&!R,{lightbox:L,greenScreen:B,accessibleBlocks:U}=this.state,V=f&&(null===(e=p.metadata)||void 0===e?void 0:e.hideIteration),z=!1===(null===(t=this.state.editorState)||void 0===t?void 0:t.hasCategories)||f&&(null===(n=p.metadata)||void 0===n?void 0:n.flyoutOnly),{hideEditorToolbar:W,transparentEditorToolbar:K}=i,$=i.hideMenuBar||V||m&&pxt.appTarget.appTheme.embeddedTutorial,Y=o&&o.headless,X=i.selectLanguage,J=P&&!W&&this.editor.hasEditorToolbar(),Z=pxt.appTarget.serial&&!!pxt.appTarget.serial.useEditor,ee=d&&this.state.sideDocsLoadUrl&&!this.state.sideDocsCollapsed,te=J&&!R&&!a&&!i.simCollapseInMenu&&(!Y||N)&&!m,ne=this.state.hideEditorFloats||this.state.collapseEditorTools,re=!!i.logoWide,ie=!a&&pxt.hasHwVariants(),se=(w||m)&&this.state.editorOffset?{top:this.state.editorOffset}:void 0,le=i.invertedMenu&&i.invertedMonaco,ue=i.multiplayer,pe=this.state.isMultiplayerGame,he=this.state.collapseEditorTools?lf("Show the simulator"):lf("Hide the simulator"),fe=h.isNativeHost()||pxt.BrowserUtils.isElectron(),ge=this.getData(F.HIGHCONTRAST);let me=["ui",L?"dimmable dimmed":"dimmable",ne?"hideEditorFloats":"",this.state.collapseEditorTools?"collapsedEditorTools":"",K?"transparentEditorTools":"",le?"inverted-theme":"",this.state.fullscreen?"fullscreensim":"",this.state.showMiniSim?"miniSim":"",ge?"hc":"",ee?"sideDocs":"",pxt.shell.layoutTypeClass(),R?"inHome":"",f&&!m?"tutorial":"",w&&!m?"tutorialExpanded":"",m?"tabTutorial":"",g?"sidebarTutorial":"",N?"debugger":"",pxt.options.light?"light":"",pxt.BrowserUtils.isTouchEnabled()?"has-touch":"",$?"hideMenuBar":"",!J||K?"hideEditorToolbar":"",this.state.bannerVisible&&!R?"notificationBannerVisible":"",this.state.debugging?"debugging":"",a&&this.isEmbedSimActive()?"simView":"",fe?"app":"",B?"greenscreen":"",re?"logo-wide":"",Y?"headless":"",z?"flyoutOnly":"",V?"hideIteration":"",this.editor!=this.blocksEditor?"editorlang-text":"",this.editor==this.textEditor&&this.state.errorListState,"full-abs",pxt.appTarget.appTheme.embeddedTutorial?"tutorial-embed":""];this.rootClasses=me;const ve=u.cx(me);if(this.state.hasError)return(0,r.jsx)("div",Object.assign({id:"root",className:"ui middle aligned center aligned grid",style:{height:"100%",alignItems:"center"}},{children:(0,r.jsxs)("div",Object.assign({className:"ui raised segment inverted purple"},{children:[(0,r.jsx)("h2",{children:lf("Oops")}),lf("We detected a problem and we will reload the editor in a few seconds..")]}))}));const ye=pxt.Util.isUserLanguageRtl(),be=(this.state.collapseEditorTools||ye)&&!(this.state.collapseEditorTools&&ye),xe=!(a||f||this.isAssetsActive()||c||l.mainPkg&&l.mainPkg.config&&l.mainPkg.config.preferredEditor==pxt.BLOCKS_PROJECT_NAME),Ee=pxt.auth.hasIdentity();return(0,r.jsxs)("div",Object.assign({id:"root",className:ve},{children:[this.state.extensionsVisible&&(0,r.jsx)(C.ExtensionsBrowser,{hideExtensions:this.hidePackageDialog,importExtensionCallback:()=>this.showImportFileDialog({extension:!0}),header:this.state.header,reloadHeaderAsync:()=>this.reloadHeaderAsync()}),B?(0,r.jsx)(D.WebCam,{close:this.toggleGreenScreen}):void 0,U&&(0,r.jsx)(M.AccessibleBlocksInfo,{}),$||R?void 0:(0,r.jsxs)("header",Object.assign({className:"menubar",role:"banner"},{children:[P?(0,r.jsx)(b.EditorAccessibilityMenu,{parent:this,highContrast:ge}):void 0,(0,r.jsx)(Q.NotificationBanner,{parent:this}),(0,r.jsx)(G.HeaderBar,{parent:this})]})),g&&z&&f&&(0,r.jsx)(E.SidebarTutorialCard,{ref:de.tutorialCardId,parent:this,pokeUser:this.state.pokeUserComponent==de.tutorialCardId}),f&&!m&&(0,r.jsxs)("div",Object.assign({id:"maineditor",className:a?"sandbox":"",role:"main"},{children:[!(g&&z)&&f&&(0,r.jsx)(x.TutorialCard,{ref:de.tutorialCardId,parent:this,pokeUser:this.state.pokeUserComponent==de.tutorialCardId}),z&&(0,r.jsx)(x.WorkspaceHeader,{parent:this})]})),(0,r.jsx)(q.Sidepanel,{parent:this,inHome:R,showKeymap:this.state.keymap&&o.keymap,showSerialButtons:Z,showFileList:xe,showFullscreenButton:!Y,showHostMultiplayerGameButton:ue&&pe,collapseEditorTools:this.state.collapseEditorTools,simSerialActive:this.state.simSerialActive,devSerialActive:this.state.deviceSerialActive,showMiniSim:this.showMiniSim,openSerial:this.openSerial,handleHardwareDebugClick:this.hwDebug,handleFullscreenButtonClick:this.toggleSimulatorFullscreen,tutorialOptions:m?p:void 0,tutorialSimSidebar:O,onTutorialStepChange:this.setTutorialStep,onTutorialComplete:this.completeTutorialAsync,setEditorOffset:this.setEditorOffset}),(0,r.jsxs)("div",Object.assign({id:"maineditor",className:(a?"sandbox":"")+(N?"debugging":""),role:"main","aria-hidden":R},{children:[te&&(0,r.jsx)(u.Button,{id:"computertogglesim",className:"computer only collapse-button large",icon:"inverted chevron "+(be?"right":"left"),title:he,onClick:this.toggleSimulatorCollapse}),this.allEditors.map((e=>e.displayOuter(se)))]})),R?(0,r.jsx)("div",Object.assign({id:"homescreen",className:"full-abs"},{children:(0,r.jsxs)("div",Object.assign({className:"ui home projectsdialog"},{children:[(0,r.jsxs)("header",Object.assign({className:"menubar",role:"banner"},{children:[(0,r.jsx)(b.HomeAccessibilityMenu,{parent:this,highContrast:ge}),(0,r.jsx)(G.HeaderBar,{parent:this})]})),(0,r.jsx)(A.Projects,{parent:this,ref:this.handleHomeRef})]}))})):void 0,J&&(0,r.jsx)(_.EditorToolbar,{ref:"editortools",parent:this}),d?(0,r.jsx)(T.SideDocs,{ref:"sidedoc",parent:this,sideDocsCollapsed:this.state.sideDocsCollapsed,docsUrl:this.state.sideDocsLoadUrl}):void 0,a?void 0:(0,r.jsx)(k.ScriptSearch,{parent:this,ref:this.handleScriptSearchRef}),a?void 0:(0,r.jsx)(I.Extensions,{parent:this,ref:this.handleExtensionRef}),R?(0,r.jsx)(A.ImportDialog,{parent:this,ref:this.handleImportDialogRef}):void 0,Ee?(0,r.jsx)(S.LoginDialog,{parent:this,ref:this.handleLoginDialogRef}):void 0,Ee?(0,r.jsx)(H.ProfileDialog,{parent:this,ref:this.handleProfileDialogRef}):void 0,R&&i.scriptManager?(0,r.jsx)(j.ScriptManagerDialog,{parent:this,ref:this.handleScriptManagerDialogRef,onClose:this.handleScriptManagerDialogClose}):void 0,a?void 0:(0,r.jsx)(A.ExitAndSaveDialog,{parent:this,ref:this.handleExitAndSaveDialogRef}),a?void 0:(0,r.jsx)(A.NewProjectDialog,{parent:this,ref:this.handleNewProjectDialogRef}),ie?(0,r.jsx)(A.ChooseHwDialog,{parent:this,ref:this.handleChooseHwDialogRef}):void 0,a||!s?void 0:(0,r.jsx)(v.ShareEditor,{parent:this,ref:this.handleShareEditorRef,loading:this.state.publishing}),X?(0,r.jsx)(y.LanguagePicker,{parent:this,ref:this.handleLanguagePickerRef}):void 0,a?(0,r.jsx)(T.SandboxFooter,{parent:this}):void 0,$?(0,r.jsx)("div",Object.assign({id:"editorlogo"},{children:(0,r.jsx)("a",{className:"poweredbylogo"})})):void 0,L?(0,r.jsx)(u.Dimmer,{isOpen:!0,active:L,portalClassName:"tutorial",className:"ui modal",shouldFocusAfterRender:!1,closable:!0,onClose:this.hideLightbox}):void 0,this.state.onboarding&&(0,r.jsx)(oe.Tour,{tourSteps:this.state.onboarding,onClose:this.hideOnboarding})]}))}}function pe(){return ae}n.ProjectView=de,de.tutorialCardId="tutorialcard";let he={workspace:o,require:e,core:c,getEditor:pe,monaco:z,blocks:$,compiler:p,pkg:l,getsrc:function(){pxt.log(ae.editor.getCurrentSource())},sim:d,apiAsync:c.apiAsync,assembleCurrent:function(){p.compileAsync({native:!0}).then((()=>p.assembleAsync(pe().editorFile.content))).then((e=>{let t=e.words;pxt.debug("["+t.map((e=>"0x"+e.toString(16))).join(",")+"]")}))},log:function(e){console.log(e)},cloudsync:s};function fe(){let e=/^#(\w+)(:([:\.\/\-\+\=\w]+))?/.exec(window.location.hash);return e?{cmd:e[1],arg:e[3]||""}:{cmd:"",arg:""}}function ge(e,t){if(!e)return!1;let n=ae;if(!n)return!1;switch(me(e)&&n.setState({home:!1}),e.cmd){case"doc":pxt.tickEvent("hash.doc"),n.setSideDoc(e.arg,n.editor===n.blocksEditor);break;case"follow":return pxt.tickEvent("hash.follow"),n.newEmptyProject(void 0,e.arg),!0;case"newproject":return pxt.tickEvent("hash.newproject"),n.newProject(),pxt.BrowserUtils.changeHash(""),!0;case"newjavascript":return pxt.tickEvent("hash.newjavascript"),n.newProject({preferredEditor:pxt.JAVASCRIPT_PROJECT_NAME}),pxt.BrowserUtils.changeHash(""),!0;case"newpython":return pxt.tickEvent("hash.newpython"),n.newProject({preferredEditor:pxt.PYTHON_PROJECT_NAME}),pxt.BrowserUtils.changeHash(""),!0;case"testproject":{pxt.tickEvent("hash.testproject");const t=e.arg,r=o.getHeader(t);if(r){const e=o.getHeaders().filter((e=>e.extensionUnderTest==r.id))[0];e?n.loadHeaderAsync(e):n.newProject({prj:pxt.appTarget.blocksprj,name:lf("test {0}",r.name),extensionUnderTest:t})}return pxt.BrowserUtils.changeHash(""),!0}case"gettingstarted":return pxt.tickEvent("hash.gettingstarted"),n.newProject(),pxt.BrowserUtils.changeHash(""),!0;case"tutorial":case"example":case"recipe":{pxt.tickEvent("hash."+e.cmd),le=e;let t,r=e.arg;return/^([jt]s|py|blocks?):/i.test(r)&&(t=/^py:/i.test(r)?pxt.PYTHON_PROJECT_NAME:/^[jt]s:/i.test(r)?pxt.JAVASCRIPT_PROJECT_NAME:pxt.BLOCKS_PROJECT_NAME,r=r.substr(r.indexOf(":")+1)),n.startActivity({activity:e.cmd,path:r,editor:t,focus:!1}),pxt.BrowserUtils.changeHash("editor"),!0}case"home":return pxt.tickEvent("hash.home"),n.openHome(),pxt.BrowserUtils.changeHash(""),!0;case"sandbox":case"pub":case"edit":return pxt.tickEvent("hash."+e.cmd),pxt.BrowserUtils.changeHash(""),/^(github:|https:\/\/github\.com\/)/.test(e.arg)?ve(e.arg):ye(e.arg),!0;case"header":return pxt.tickEvent("hash."+e.cmd),pxt.BrowserUtils.changeHash(""),n.loadHeaderAsync(o.getHeader(e.arg)),!0;case"sandboxproject":case"project":pxt.tickEvent("hash."+e.cmd);const r=ne.stringToUint8Array(atob(e.arg));return pxt.BrowserUtils.changeHash(""),c.showLoading("loadingproject",lf("loading project...")),n.importProjectFromFileAsync(r).finally((()=>c.hideLoading("loadingproject"))),!0;case"reload":return t&&pxt.BrowserUtils.changeHash(""),!1;case"skillmapimport":const i=e.arg;return c.showLoading("skillmapimport",lf("loading project...")),n.importSkillmapProjectAsync(i).finally((()=>{pxt.BrowserUtils.changeHash(""),c.hideLoading("skillmapimport")})),!0;case"github":{const t=pxt.github.parseRepoId(e.arg),[n,r]=e.arg.split(":",2);pxt.BrowserUtils.changeHash("");const i=s.githubProvider();if(!i)return!1;if("create-repository"===n){const e=o.getHeader(r);if(e)return!!i.hasToken()&&(ae.loadHeaderAsync(e).then((()=>i.createRepositoryAsync(e.name,e))).then((e=>e&&ae.reloadHeaderAsync())),!0)}else{if("import"===n)return w.showImportGithubDialogAsync(),!0;if(t)return ve(e.arg,!0),!0}break}}return!1}function me(e){if(!e)return!1;switch(e.cmd){case"follow":case"newproject":case"newjavascript":case"testproject":case"tutorial":case"example":case"recipe":case"projects":case"sandbox":case"pub":case"edit":case"sandboxproject":case"project":case"header":return!0;case"github":default:return!1}}async function ve(e,t){if(!pxt.appTarget.appTheme.githubEditor||pxt.BrowserUtils.isPxtElectron())return c.warningNotification(lf("Importing GitHub projects not currently supported")),void ae.openHome();c.showLoading("loadingheader",lf("importing GitHub project..."));try{const n=await pxt.packagesConfigAsync(),r=pxt.github.parseRepoId(e),i=await pxt.github.repoAsync(r.slug,n);e=pxt.github.normalizeRepoId(e,null==i?void 0:i.defaultBranch);let a=o.getHeaders().find((t=>t.githubId&&pxt.github.normalizeRepoId(t.githubId)==e));if(!a){if(t&&!(await s.githubProvider(!0).routedLoginAsync(e)).accessToken)return void ae.openHome();a=await o.importGithubAsync(e)}a?await ae.loadHeaderAsync(a,null):ae.openHome()}catch(e){c.handleNetworkError(e),ae.openHome()}finally{c.hideLoading("loadingheader")}}function ye(e){c.showLoading("loadingheader",lf("loading project...")),o.installByIdAsync(e).then((e=>ae.loadHeaderAsync(e,null))).catch((e=>{ae.openHome(),c.handleNetworkError(e)})).finally((()=>c.hideLoading("loadingheader")))}window.E=he;const be=e=>{ge(fe(),!1)};function xe(){try{return/saveblocks=1/.test(window.location.href)&&!!l.mainPkg.readFile(pxt.MAIN_BLOCKS)}catch(e){return!1}}function Ee(){try{return/save(?:as)?template=1/i.test(window.location.href)}catch(e){return!1}}function _e(e){var t;const n=null===(t=l.getEditorPkg(l.mainPkg))||void 0===t?void 0:t.getMainFile();switch(e.toLowerCase()){case"javascript":case"js":case pxt.JAVASCRIPT_PROJECT_NAME:return n.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME);case"python":case"py":case pxt.PYTHON_PROJECT_NAME:return n.getVirtualFileName(pxt.PYTHON_PROJECT_NAME);case"assets":case"asset":return pxt.ASSETS_FILE;case"blocks":case pxt.BLOCKS_PROJECT_NAME:default:return n.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME)}}document.addEventListener("DOMContentLoaded",(async()=>{var t;pxt.perf.recordMilestone("DOM loaded"),pxt.setupWebConfig(window.pxtConfig);const n=pxt.webConfig,p=ne.parseQueryString(window.location.href.toLowerCase());if("1"==p.dbg&&(pxt.debug=console.debug),pxt.options.light="1"==p.light||pxt.BrowserUtils.isARM()||pxt.BrowserUtils.isIE(),pxt.options.light&&pxsim.U.addClass(document.body,"light"),p.wsport?(pxt.options.wsPort=parseInt(p.wsport)||3233,pxt.BrowserUtils.changeHash(window.location.hash.replace(`wsport=${p.wsport}`,""))):pxt.options.wsPort=3233,"1"==p.consoleticks||"verbose"==p.consoleticks?pxt.analytics.consoleTicks=pxt.analytics.ConsoleTickOptions.Verbose:"2"!=p.consoleticks&&"short"!=p.consoleticks||(pxt.analytics.consoleTicks=pxt.analytics.ConsoleTickOptions.Short),pxt.perf.measureStart("setAppTarget"),l.setupAppTarget(window.pxtTargetBundle),f.init((()=>ae.reloadEditor())),pxt.setBundledApiInfo(window.pxtTargetBundle.apiInfo),pxt.perf.measureEnd("setAppTarget"),function(){pxt.analytics.enable(pxt.Util.userLanguage()),pxt.editor.enableControllerAnalytics();const e={};if("undefined"!=typeof window){const t=window.screen;e["screen.width"]=t.width,e["screen.height"]=t.height,e["screen.availwidth"]=t.availWidth,e["screen.availheight"]=t.availHeight,e["screen.innerWidth"]=window.innerWidth,e["screen.innerHeight"]=window.innerHeight,e["screen.devicepixelratio"]=pxt.BrowserUtils.devicePixelRatio();const n=document.firstElementChild;n&&(e["screen.clientWidth"]=n.clientWidth,e["screen.clientHeight"]=n.clientHeight)}pxt.tickEvent("editor.loaded",e)}(),!pxt.BrowserUtils.isBrowserSupported()&&!/skipbrowsercheck=1/i.exec(window.location.href))return pxt.tickEvent("unsupported"),window.location.href="/browsers",void c.showLoading("browsernotsupported",lf("Sorry, this browser is not supported."));if(pxt.BrowserUtils.isWinRT())return pxt.tickEvent("redirected.winrt"),window.location.href="/v4",void c.showLoading("micro:bit-winrt-reload",lf("Redirecting to MakeCode micro:bit v4"));const g=ne.parseQueryString(window.location.href);g.authcallback&&await F.loginCallbackAsync(g),await F.initAsync();const v=g.autologin;if(v&&await F.loginAsync(v,!0),U.init(),s.loginCheck(),function(){const e=ne.parseQueryString((location.hash||"#").slice(1).replace(/%local_token/,"local_token"));e.local_token&&(pxt.storage.setLocal("local_token",e.local_token),location.hash=location.hash.replace(/(%23)?[\#\&\?]*local_token.*/,"")),te.localToken=pxt.storage.getLocal("local_token")||""}(),le=fe(),ee.init(),pxt.react.getTilemapProject=()=>{const e=l.mainEditorPkg();return e.tilemapProject||(e.tilemapProject=new pxt.TilemapProject,e.tilemapProject.loadPackage(l.mainPkg)),e.tilemapProject},pxt.hexloader.showLoading=e=>c.showLoading("hexcloudcompiler",e),pxt.hexloader.hideLoading=()=>c.hideLoading("hexcloudcompiler"),pxt.docs.requireMarked=()=>e("marked"),null===(t=pxt.appTarget.cloud)||void 0===t?void 0:t.apiRoot)te.apiRoot=pxt.appTarget.cloud.apiRoot;else{const e=/^(https:\/\/[^/]+)/.exec(window.location.href);e&&(te.apiRoot=e[1]+"/api/")}g.hw&&(pxt.setHwVariant(g.hw),pxt.tickEvent("projects.choosehwvariant",{hwid:pxt.hwVariant,card:"QUERY-"+pxt.hwVariant})),pxt.setCompileSwitches(g.compiler||g.compile);const b=pxt.shell.isSandboxMode()||pxt.shell.isReadOnly(),x=pxt.shell.isControllerMode();let E=pxt.appTarget.appTheme;g.ws?o.setupWorkspace(g.ws):(E.allowParentController||x)&&pxt.BrowserUtils.isIFrame()?o.setupWorkspace("iframe"):b?o.setupWorkspace("mem"):pxt.BrowserUtils.isIpcRenderer()?o.setupWorkspace("idb"):pxt.BrowserUtils.isPxtElectron()?o.setupWorkspace("fs"):o.setupWorkspace("browser"),"iframe"===o.getWorkspaceType()&&pxt.auth.enableAuth(!1),Promise.resolve().then((async()=>{const e=window.location.href;let t=!1;const r=a.getData(F.LANGUAGE);let i;if(F.initialUserPreferencesAsync().then((e=>{const t=pxt.BrowserUtils.getCookieLang();t&&e&&e.language&&e.language!=t&&(pxt.BrowserUtils.setCookieLang(e.language),c.infoNotification(lf("Reload the page to apply your new language preference.")),pxt.tickEvent("identity.preferences.askingUserToReloadToApplyLang"))})),/[&?]translate=1/.test(e)&&!pxt.BrowserUtils.isIE())console.log("translation mode"),t=!0,pxt.Util.enableLiveLocalizationUpdates(),i=ts.pxtc.Util.TRANSLATION_LOCALE;else{const e=/(live)?(force)?lang=([a-z]{2,}(-[A-Z]+)?)/i.exec(window.location.href);e&&window.location.hash.indexOf(e[0])>=0&&pxt.BrowserUtils.changeHash(window.location.hash.replace(e[0],""));const n=!!(null==e?void 0:e[1]),o=!!(null==e?void 0:e[2]),s=null==e?void 0:e[3],a=pxt.BrowserUtils.getCookieLang();i=s||r||a||E.defaultLocale||navigator.userLanguage||navigator.language;const l=/staticlang=1/i.test(window.location.href),c=pxt.appTarget.appTheme.defaultLocale,u=null==i?void 0:i.toLocaleLowerCase(),d=pxt.BrowserUtils.isLocalHostDev()&&(!u||(c?c.toLocaleLowerCase()===u:"en"===u||"en-us"===u)),p=pxt.BrowserUtils.isPxtElectron()||d;(l||p||E.disableLiveTranslations)&&!n||pxt.Util.enableLiveLocalizationUpdates(),t=o}const o=pxt.appTarget.id,s=n.commitCdnUrl,l=pxt.appTarget.versions.pxtCrowdinBranch,u=pxt.appTarget.versions.targetCrowdinBranch;return ne.updateLocalizationAsync({targetId:o,baseUrl:s,code:i,pxtBranch:l,targetBranch:u,force:t}).then((()=>{pxt.Util.isLocaleEnabled(i)?(pxt.BrowserUtils.setCookieLang(i),y.setInitialLang(i)):pxt.tickEvent("unavailablelocale",{lang:i,force:t?"true":"false"}),pxt.tickEvent("locale",{lang:pxt.Util.userLanguage(),live:pxt.Util.liveLocalizationEnabled()?"true":"false"}),ne.downloadTranslationsAsync(o,s,i,l,u,pxt.Util.liveLocalizationEnabled(),ne.TranslationsKind.Sim).then((e=>e&&d.setTranslations(e)))}))})).then((()=>(pxt.BrowserUtils.initTheme(),((E=pxt.editor.experiments.syncTheme()).allowParentController||E.allowPackageExtensions||E.allowSimulatorTelemetry||pxt.shell.isControllerMode())&&pxt.editor.bindEditorMessages(ue),o.initAsync().then((async e=>(await U.syncAsync(),e)))))).then((e=>(i.render((0,r.jsx)(de,{}),u.appElement),e&&ae.setState({editorState:e}),function(){if(!pxt.appTarget.appTheme||!pxt.appTarget.appTheme.extendEditor)return Promise.resolve();pxt.debug("loading editor extensions...");const e={blocklyToolbox:R.getToolboxDefinition(),monacoToolbox:P.getToolboxDefinition(),projectView:ae};return pxt.BrowserUtils.loadScriptAsync("editor.js").then((()=>pxt.editor.initExtensionsAsync(e))).then((e=>{e.hexFileImporters&&e.hexFileImporters.forEach((e=>{pxt.debug(`\tadded hex importer ${e.id}`),ae.hexFileImporters.push(e)})),e.resourceImporters&&e.resourceImporters.forEach((e=>{pxt.debug(`\tadded resource importer ${e.id}`),ae.resourceImporters.push(e)})),e.beforeCompile&&(ae.beforeCompile=e.beforeCompile),e.toolboxOptions&&(e.toolboxOptions.blocklyToolbox&&R.overrideToolbox(e.toolboxOptions.blocklyToolbox),e.toolboxOptions.monacoToolbox&&P.overrideToolbox(e.toolboxOptions.monacoToolbox)),h.setExtensionResult(e)}))}()))).then((()=>h.initAsync())).then((()=>{pxt.debug("packetio: hook events"),pxt.packetio.configureEvents((()=>a.invalidate("packetio:*")),((e,t)=>{try{const t=ne.fromUTF8(ne.uint8ArrayToString(e));window.postMessage({type:"serial",id:"n/a",data:t},"*")}catch(t){console.debug("invalid utf8 serial data",{buf:e,e:t})}}),((e,t)=>{var n;const r=null===(n=pxt.appTarget.simulator)||void 0===n?void 0:n.messageSimulators;(null==r?void 0:r[e])&&window.postMessage({type:"messagepacket",broadcast:!1,channel:e,data:t,sender:"packetio"},"*")})),window.addEventListener("message",(e=>{var t,n;const r=e.data;"messagepacket"===r.type&&"packetio"!==r.sender&&(null===(n=null===(t=pxt.appTarget.simulator)||void 0===t?void 0:t.messageSimulators)||void 0===n?void 0:n[r.channel])&&pxt.packetio.sendCustomEventAsync(r.channel,r.data).then((()=>{}),(e=>{c.errorNotification(lf("{0}: {1}",r.channel,e.message))}))}),!1),function(){if(!(pxt.appTarget.serial&&pxt.BrowserUtils.isLocalHost()&&te.localToken||pxt.usb.isEnabled))return;if(m.shouldUse()||pxt.usb.isEnabled)return;pxt.debug("initializing serial pipe");let e=new WebSocket(`ws://localhost:${pxt.options.wsPort}/${te.localToken}/serial`),t={};e.onopen=e=>{pxt.debug("serial: socket opened")},e.onclose=e=>{pxt.debug("serial: socket closed")},e.onerror=e=>{pxt.debug("serial: error")},e.onmessage=e=>{try{let n=JSON.parse(e.data);n&&"serial"==n.type&&pxt.Util.bufferSerial(t,n.data,n.id)}catch(t){pxt.debug("unknown message: "+e.data)}}}(),window.addEventListener("hashchange",be),L.tryInit(),Z.initElectron(ae)})).then((()=>{const e=ae.shouldShowHomeScreen();if(e||ae.setState({home:!1}),le.cmd&&ge(le,!0))return Promise.resolve();if(pxt.shell.isNoProject())return pxt.editor.postHostMessageAsync({action:"newproject",options:{preferredEditor:"blocks"}}),Promise.resolve();if(e)return Promise.resolve();const t=ae.settings.fileHistory.filter((e=>!!o.getHeader(e.id)))[0];let n=o.getHeaders()[0];return t&&(n=o.getHeader(t.id)),n?ae.loadHeaderAsync(n,ae.state.editorState):(ae.newProject(),Promise.resolve())})).catch((e=>{throw ae.handleCriticalError(e,"Failure in DOM loaded handler"),e})).then((()=>(pxsim.U.remove(document.getElementById("loading")),o.loadedAsync()))),document.addEventListener("visibilitychange",(async e=>{ae&&await ae.updateVisibilityAsync()})),window.addEventListener("unload",(e=>{ae&&ae.saveSettings(),h.disconnectAsync()})),window.addEventListener("resize",(e=>{ae&&ae.editor&&(ae.editor.resize(e),pxt.BrowserUtils.isIOS()&&setTimeout((()=>{ae.editor.resize(e)}),1e3),(!ae.isTutorial()||pxt.appTarget.appTheme.tutorialSimSidebarLayout||pxt.BrowserUtils.useOldTutorialLayout())&&(pxt.BrowserUtils.isTabletSize()?ae.showMiniSim(!0):ae.showMiniSim(!1)),ae.isTutorial()&&!pxt.BrowserUtils.useOldTutorialLayout()&&ae.setEditorOffset())}),!1);const _=window.ipcRenderer;_&&_.on("responseFromApp",((e,t)=>{try{d.driver.postMessage(JSON.parse(t))}catch(e){}})),window.addEventListener("message",(e=>{let t=e.data;if(t)if("parent"!=e.data.__proxy)if("tutorial"!=t.type&&"opendoc"!=t.type)if("sidedocready"===t.type&&pxt.BrowserUtils.isLocalHost()&&te.localToken)T.SideDocs.notify({type:"localtoken",localToken:te.localToken});else if("importfile"!=t.type);else{const e=t;ae&&ae.importFile(new File(e.parts,e.filename))}else ae&&ae.editor&&ae.handleMessage(t);else{pxt.debug("received parent proxy message"+e.data),delete e.data.__proxy;const t=window.ipcRenderer;t?t.sendToHost("sendToApp",e.data):window.parent&&window!=window.parent&&window.parent.postMessage(e.data,"*")}}),!1),pxt.appTarget.appTheme.lockedEditor&&window.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1)}))},{"./accessibility":42,"./accessibleblocks":43,"./appcache":45,"./auth":48,"./blocklyFieldView":49,"./blocks":50,"./blocksSnippets":51,"./cloud":54,"./cloudsync":55,"./cmds":56,"./compiler":58,"./components/assetEditor/editor":97,"./components/onboarding/Tour":117,"./container":132,"./core":133,"./data":136,"./dialogs":143,"./draganddrop":144,"./editortoolbar":145,"./electron":146,"./extensions":149,"./extensionsBrowser":150,"./gitjson":155,"./greenscreen":156,"./headerbar":157,"./hidbridge":158,"./hinttooltip":159,"./identity":161,"./lang":165,"./make":166,"./mergeProjects":169,"./monaco":170,"./monacoSnippets":175,"./notification":177,"./onboarding":178,"./package":179,"./projects":180,"./pxtjson":181,"./qr":182,"./screenshot":183,"./scriptmanager":184,"./scriptsearch":185,"./serial":186,"./share":188,"./sidebarTutorial":189,"./sidepanel":190,"./simulator":192,"./socketbridge":197,"./sounds":198,"./sui":200,"./tutorial":203,"./user":205,"./webusb":207,"./workspace":208,marked:273,"react-dom":309,"react/jsx-runtime":367}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.init=void 0;const r=e("./core"),i=e("./cmds");n.init=function(e){"serviceWorker"in navigator&&!pxt.webConfig.isStatic&&!pxt.BrowserUtils.isLocalHost(!0)&&window.addEventListener("load",(function(){const t=pxt.webConfig.relprefix.replace("---","").replace(/^\//,"");navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("message",(n=>{const o=n.data;"serviceworker"===(null==o?void 0:o.type)&&"activated"===o.state&&o.ref===t&&(pxt.appTarget.appTheme&&pxt.appTarget.appTheme.noReloadOnUpdate||(r.infoNotification(lf("Update download complete. Reloading... ")),setTimeout((()=>{pxt.tickEvent("appcache.updated"),e()}),3e3))),o&&i.handleServiceWorkerMessageAsync(o)})),navigator.serviceWorker.register(pxt.webConfig.serviceworkerjs).then((function(e){pxt.debug("ServiceWorker registration successful with scope: "+e.scope)}),(function(e){pxt.debug("ServiceWorker registration failed: "+e)}))}))}},{"./cmds":56,"./core":133}],46:[function(e,t,n){"use strict";function r(e,t=new pxt.ImageConverter){var n;switch(e.type){case"image":case"tile":return e.previewURI=t.convert("data:image/x-mkcd-f,"+e.jresData),e;case"tilemap":let r=e.data.tilemap;return e.previewURI=pxtblockly.tilemapToImageURI(e.data,Math.max(r.width,r.height),!1),e;case"animation":return(null===(n=e.frames)||void 0===n?void 0:n.length)<=0?null:(e.framePreviewURIs=e.frames.map((e=>t.convert("data:image/x-mkcd-f,"+pxt.sprite.base64EncodeBitmap(e)))),e.previewURI=e.framePreviewURIs[0],e);case"song":return e.previewURI=pxtblockly.songToDataURI(e.song,32,32,!1,1),e}}function i(e){return function(t,n){const r=-1===e.indexOf(t.meta.package)?0:1,i=-1===e.indexOf(n.meta.package)?0:1;return r===i?function(e,t){return e.internalID-t.internalID}(t,n):r-i}}Object.defineProperty(n,"__esModule",{value:!0}),n.assetToGalleryItem=n.getAssets=n.getNewInternalID=n.lookupAsset=n.createTile=n.createProjectImage=n.createNewImageAsset=n.isNameTaken=void 0,n.isNameTaken=function(e){return pxt.react.getTilemapProject().isNameTaken("image",e)},n.createNewImageAsset=function(e,t,n,r){const i=pxt.react.getTilemapProject();switch(e){case"tile":return i.createNewTile(new pxt.sprite.Bitmap(t,n).data(),null,r);case"image":return i.createNewImage(t,n)}return null},n.createProjectImage=function(e){return pxt.react.getTilemapProject().createNewProjectImage(e)},n.createTile=function(e,t,n){return pxt.react.getTilemapProject().createNewTile(e,t,n)},n.lookupAsset=function(e,t){return pxt.react.getTilemapProject().lookupAsset(e,t)},n.getNewInternalID=function(){return pxt.react.getTilemapProject().getNewInternalId()},n.getAssets=function(e=!1,t="image",n=[]){const o=pxt.react.getTilemapProject(),s=new pxt.ImageConverter,a=e=>r(e,s),l=e?o.getGalleryAssets.bind(o):o.getAssets.bind(o),c=function(){var e;const t=null===(e=pxt.appTarget.blocksprj)||void 0===e?void 0:e.config;if(t)return Object.keys(t.dependencies);return[]}(),u=l("image").map(a).sort(i(c)),d=l("tile").map(a).filter((e=>!e.id.match(/^myTiles.transparency(8|16|32)$/gi))).sort(i(c)),p=l("tilemap").map(a).sort(i(c)),h=l("animation").map(a).sort(i(c)),f=l("song").map(a).sort(i(c));for(const e of n)switch(e.type){case"image":u.push(a(e));break;case"tile":d.push(a(e));break;case"animation":h.push(a(e));break;case"tilemap":p.push(a(e));break;case"song":f.push(a(e))}let g=[];switch(t){case"image":g=u.concat(d).concat(h).concat(p).concat(f);break;case"tile":g=d.concat(u).concat(h).concat(p).concat(f);break;case"animation":g=h.concat(u).concat(d).concat(p).concat(f);break;case"tilemap":g=p.concat(d).concat(u).concat(h).concat(f);break;case"song":g=f.concat(u).concat(d).concat(h).concat(p)}return pxt.tickEvent(e?"assets.gallery":"assets.update",{count:g.length}),g},n.assetToGalleryItem=r},{}],47:[function(e,t,n){"use strict";let r;function i(){return r||(r=function(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{return new window.AudioContext}catch(e){}}()),r}Object.defineProperty(n,"__esModule",{value:!0}),n.loadAsync=n.play=void 0,n.play=function(e,t=1){if(!e)return;const n=i();if(!n)return;const r=n.createBufferSource();r.buffer=e;const o=n.createGain();o.gain.value=t,r.connect(o),o.connect(n.destination),r.start(0)},n.loadAsync=function(e){const t=i();return new Promise(((n,r)=>{t.decodeAudioData(e,(e=>n(e)),(()=>{n(void 0)}))}))}},{}],48:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.apiAsync=n.setEmailPrefAsync=n.setImmersiveReaderPrefAsync=n.setLangaugePrefAsync=n.setHighContrastPrefAsync=n.patchUserPreferencesAsync=n.deleteProfileAsync=n.logoutAsync=n.loginCallbackAsync=n.loginAsync=n.initialUserPreferencesAsync=n.authCheckAsync=n.userPreferences=n.userProfile=n.loggedIn=n.hasIdentity=n.initAsync=n.Component=n.HAS_USED_CLOUD=n.READER=n.LANGUAGE=n.HIGHCONTRAST=n.USER_PREFERENCES=n.LOGGED_IN=n.USER_PROFILE=void 0;const r=e("./core"),i=e("./data"),o=e("./cloud"),s=e("./workspace"),a="auth",l="profile",c="logged-in";n.USER_PROFILE="auth:profile",n.LOGGED_IN="auth:logged-in";const u="user-pref",d="preferences",p="high-contrast",h="language",f="reader";n.USER_PREFERENCES="user-pref:preferences",n.HIGHCONTRAST="user-pref:high-contrast",n.LANGUAGE="user-pref:language",n.READER="user-pref:reader",n.HAS_USED_CLOUD="has-used-cloud";class g extends i.Component{getUserProfile(){return this.getData(n.USER_PROFILE)}getUserPreferences(){return this.getData(n.USER_PREFERENCES)}isLoggedIn(){return this.getData(n.LOGGED_IN)}}n.Component=g;class m extends pxt.auth.AuthClient{async onSignedIn(){const e=await pxt.auth.getUserStateAsync();r.infoNotification(lf("Signed in: {0}",pxt.auth.userName(e.profile))),s.getWorkspaceType()&&await o.syncAsync(),pxt.storage.setLocal(n.HAS_USED_CLOUD,"true")}onSignedOut(){return r.infoNotification(lf("Signed out")),Promise.resolve()}onSignInFailed(){return r.errorNotification(lf("Sign in failed. Something went wrong.")),Promise.resolve()}async onUserProfileChanged(){const e=await pxt.auth.getUserStateAsync();pxt.auth.generateUserProfilePicDataUrl(null==e?void 0:e.profile),i.invalidate("auth:*")}onUserPreferencesChanged(e){for(const t of e)switch(t.path.join("/")){case"language":i.invalidate(n.LANGUAGE);break;case"highContrast":i.invalidate(n.HIGHCONTRAST);break;case"reader":i.invalidate(n.READER)}return Promise.resolve()}async onProfileDeleted(e){try{await o.convertCloudToLocal(e)}catch(e){pxt.tickEvent("auth.profile.cloudToLocalFailed")}}async onStateLoaded(){const e=await pxt.auth.getUserStateAsync();pxt.auth.generateUserProfilePicDataUrl(e.profile),i.invalidate("auth:*"),i.invalidate("user-pref:*")}async onApiError(e){r.handleNetworkError(e)}async onStateCleared(){i.invalidate("auth:*")}static authApiHandler(e){const t=i.stripProtocol(e),n=pxt.auth.cachedUserState,r=pxt.auth.cachedHasAuthToken;switch(t){case l:return r?Object.assign({},null==n?void 0:n.profile):null;case c:return r&&null!=(null==n?void 0:n.profile)}return null}static userPreferencesHandler(e){const t=pxt.auth.client(),r=pxt.auth.cachedUserState;if(t&&r)return r.preferences||t.initialUserPreferencesAsync().then((()=>{})),m.internalUserPreferencesHandler(e);switch(e){case n.HIGHCONTRAST:return/^true$/i.test(pxt.storage.getLocal(n.HIGHCONTRAST));case n.LANGUAGE:return pxt.storage.getLocal(n.LANGUAGE);case n.READER:return pxt.storage.getLocal(n.READER)}return null}static internalUserPreferencesHandler(e){var t,n,r,o,s,a;const l=pxt.auth.client(),c=pxt.auth.cachedUserState;if(l&&c){switch(i.stripProtocol(e)){case d:return Object.assign({},c.preferences);case p:return null!==(n=null===(t=c.preferences)||void 0===t?void 0:t.highContrast)&&void 0!==n?n:pxt.auth.DEFAULT_USER_PREFERENCES().highContrast;case h:return null!==(o=null===(r=c.preferences)||void 0===r?void 0:r.language)&&void 0!==o?o:pxt.auth.DEFAULT_USER_PREFERENCES().language;case f:return null!==(a=null===(s=c.preferences)||void 0===s?void 0:s.reader)&&void 0!==a?a:pxt.auth.DEFAULT_USER_PREFERENCES().reader}return c.preferences}return null}}let v;async function y(){if(pxt.auth.hasIdentity())return v||(v=new Promise((async(e,t)=>{const n=new m;await n.initAsync(),await n.authCheckAsync(),await n.initialUserPreferencesAsync(),e(n)})))}async function b(e,t={}){const n=await y();return await(null==n?void 0:n.patchUserPreferencesAsync(e,t))}n.initAsync=async function(){i.mountVirtualApi(u,{getSync:m.userPreferencesHandler}),i.mountVirtualApi(a,{getSync:m.authApiHandler});const e=await y();await(null==e?void 0:e.authCheckAsync())},n.hasIdentity=function(){return pxt.auth.hasIdentity()},n.loggedIn=function(){return i.getData(n.LOGGED_IN)},n.userProfile=function(){return i.getData(n.USER_PROFILE)},n.userPreferences=function(){return i.getData(n.USER_PREFERENCES)},n.authCheckAsync=async function(){const e=await y();return await(null==e?void 0:e.authCheckAsync())},n.initialUserPreferencesAsync=async function(){const e=await y();return await(null==e?void 0:e.initialUserPreferencesAsync())},n.loginAsync=async function(e,t,n){const r=await y();await(null==r?void 0:r.loginAsync(e,t,n))},n.loginCallbackAsync=async function(e){await pxt.auth.loginCallbackAsync(e)},n.logoutAsync=async function(){const e=await y();await(null==e?void 0:e.logoutAsync("#"))},n.deleteProfileAsync=async function(){const e=await y();await(null==e?void 0:e.deleteProfileAsync())},n.patchUserPreferencesAsync=b,n.setHighContrastPrefAsync=async function(e){const t=await y();t?await t.patchUserPreferencesAsync({op:"replace",path:["highContrast"],value:e}):(pxt.storage.setLocal(n.HIGHCONTRAST,e.toString()),i.invalidate(n.HIGHCONTRAST))},n.setLangaugePrefAsync=async function(e){const t=await y();t?await t.patchUserPreferencesAsync({op:"replace",path:["language"],value:e},{immediate:!0}):(pxt.storage.setLocal(n.LANGUAGE,e),i.invalidate(n.LANGUAGE))},n.setImmersiveReaderPrefAsync=async function(e){const t=await y();t?await t.patchUserPreferencesAsync({op:"replace",path:["reader"],value:e}):(pxt.storage.setLocal(n.READER,e),i.invalidate(n.READER))},n.setEmailPrefAsync=async function(e){return await b({op:"replace",path:["email"],value:e},{immediate:!0})},n.apiAsync=async function(e,t,n){const r=await y();return await(null==r?void 0:r.apiAsync(e,t,n))}},{"./cloud":54,"./core":133,"./data":136,"./workspace":208}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.dismissIfVisible=n.init=n.setContainerClass=n.setEditorBounds=n.FieldEditorView=void 0;const r=e("react/jsx-runtime"),i=e("react-dom"),o=e("./components/ImageFieldEditor"),s=e("./components/soundEffectEditor/SoundEffectEditor");let a,l;class c{constructor(e,t,n){this.contentDiv=e,this.inContainer=t,this.useFlex=n,this.resizeContentCore=()=>{if(this.inContainer)return void(this.componentRef&&this.visible&&this.componentRef.onResize&&this.componentRef.onResize());this.resizeFrameRef=void 0;const e=this.editorBounds;let t=25,n=25;e.width-2*t<500&&(t=0,n=0),e.height-2*n<610&&(n=(n=Math.min(e.height-610,0)/2)<0?0:n,t=0),t=null!=e.horizontalPadding?e.horizontalPadding:t,n=null!=e.horizontalPadding?e.verticalPadding:n,this.contentBounds={left:e.left+t,top:e.top+n,width:e.width-2*t,height:e.height-2*n},this.contentDiv.style.left=this.contentBounds.left+"px",this.contentDiv.style.top=this.contentBounds.top+"px",this.contentDiv.style.width=this.contentBounds.width+"px",this.contentDiv.style.height=this.contentBounds.height+"px",this.overlayDiv.style.left=e.left+"px",this.overlayDiv.style.top=e.top+"px",this.overlayDiv.style.width=e.width+"px",this.overlayDiv.style.height=e.height+"px",this.componentRef&&this.visible&&this.componentRef.onResize&&this.componentRef.onResize()},this.handleOutsideClick=e=>{this.contentBounds&&(function(e,t,n){return!(e<n.left||e>n.left+n.width||t<n.top||t>n.top+n.height)}(e.clientX,e.clientY,this.contentBounds)||(e.stopPropagation(),this.hide()))}}isVisible(){return this.visible}injectElement(e){i.render(e,this.contentDiv)}setRef(e){this.componentRef=e,e&&this.persistentData&&(e.restorePersistentData(this.persistentData),this.persistentData=void 0)}show(){!this.visible&&this.contentDiv&&(this.visible=!0,this.resize(this.editorBounds),this.contentDiv.style.display=this.useFlex?"flex":"block",this.inContainer||(this.overlayDiv=document.createElement("div"),pxt.BrowserUtils.addClass(this.overlayDiv,"blocks-editor-field-overlay"),this.contentDiv.parentElement.appendChild(this.overlayDiv),this.overlayDiv.addEventListener("mousedown",this.handleOutsideClick),document.addEventListener("mousedown",this.handleOutsideClick)))}hide(){var e,t;this.visible&&this.contentDiv&&(null!==(t=null===(e=this.componentRef)||void 0===e?void 0:e.shouldPreventHide)&&void 0!==t&&t.call(e)||(this.visible=!1,this.resizeFrameRef&&cancelAnimationFrame(this.resizeFrameRef),this.clearContents(),this.contentDiv.style.display="none",this.inContainer||(this.overlayDiv.parentElement.removeChild(this.overlayDiv),document.removeEventListener("mousedown",this.handleOutsideClick)),this.hideCallback&&this.hideCallback()))}onHide(e){this.hideCallback=e}getResult(){return this.componentRef?this.componentRef.getValue():void 0}resize(e){this.editorBounds=e,this.visible&&(this.resizeFrameRef&&cancelAnimationFrame(this.resizeFrameRef),this.resizeFrameRef=requestAnimationFrame(this.resizeContentCore))}dispose(){this.contentDiv&&(this.hide(),this.contentDiv=null)}getPersistentData(){return this.componentRef.getPersistentData()}restorePersistentData(e){this.componentRef?this.componentRef.restorePersistentData(e):this.persistentData=e}setContainerClass(e){this.contentDiv&&this.contentDiv.classList.contains(this.containerClass)&&this.contentDiv.classList.remove(this.containerClass),this.containerClass=e,this.updateContainerClass()}clearContents(){for(i.unmountComponentAtNode(this.contentDiv);this.contentDiv.firstChild;)this.contentDiv.removeChild(this.contentDiv.firstChild)}updateContainerClass(){this.contentDiv&&this.containerClass&&(this.contentDiv.classList.contains(this.containerClass)||this.contentDiv.classList.add(this.containerClass))}}function u(){l&&l.dispose(),l=void 0}n.FieldEditorView=c,n.setEditorBounds=function(e){l&&l.resize(e),a=e},n.setContainerClass=function(e){l&&l.setContainerClass(e)},n.init=function(){pxt.react.getFieldEditorView=function(e,t,n,i){l&&l.dispose();const d=e=>{e&&l&&(l.setRef(e),e.init(t,u,n))};switch(l=new c(i||document.getElementById("blocks-editor-field-div"),!!i,null==n?void 0:n.useFlex),e){case"image-editor":l.injectElement((0,r.jsx)(o.ImageFieldEditor,{ref:d,singleFrame:!0}));break;case"animation-editor":l.injectElement((0,r.jsx)(o.ImageFieldEditor,{ref:d,singleFrame:!1}));break;case"tilemap-editor":l.injectElement((0,r.jsx)(o.ImageFieldEditor,{ref:d,singleFrame:!0}));break;case"soundeffect-editor":l.injectElement((0,r.jsx)(s.SoundEffectEditor,{onClose:()=>{n.onClose&&n.onClose(),u()},onSoundChange:n.onSoundChange,initialSound:n.initialSound,useMixerSynthesizer:n.useMixerSynthesizer}));break;case"music-editor":l.injectElement((0,r.jsx)(o.ImageFieldEditor,{ref:d,singleFrame:!0,isMusicEditor:!0}))}return a&&l.resize(a),l};let e=new pxt.TilemapProject;pxt.react.getTilemapProject=()=>e,pxt.react.isFieldEditorViewVisible=()=>!(!l||!l.isVisible())},n.dismissIfVisible=u},{"./components/ImageFieldEditor":83,"./components/soundEffectEditor/SoundEffectEditor":120,"react-dom":309,"react/jsx-runtime":367}],50:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Editor=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("react-dom"),s=e("./package"),a=e("./core"),l=e("./toolboxeditor"),c=e("./compiler"),u=e("./toolbox"),d=e("./blocksSnippets"),p=e("./workspace"),h=e("./simulator"),f=e("./dialogs"),g=e("./blocklyFieldView"),m=e("./createFunction"),v=e("./snippetBuilder");var y=pxt.Util;const b=e("./debuggerToolbox"),x=e("./errorList"),E=e("./extensionManager");class _ extends l.ToolboxEditor{constructor(e){super(e),this.isFirstBlocklyLoad=!0,this.functionsDialog=null,this.showCategories=!0,this.errorChangesListeners={},this.handleKeyDown=e=>{var t;(null===(t=this.parent.state)||void 0===t?void 0:t.accessibleBlocks)&&84===("number"==typeof e.which?e.which:e.keyCode)&&(this.focusToolbox(),e.stopPropagation())},this.markIncomplete=!1,this.handleToolboxRef=e=>{this.toolbox=e},this.handleDebuggerToolboxRef=e=>{this.debuggerToolbox=e},this.flyoutBlockXmlCache={},this.flyoutXmlList=[],this.flyouts={},this.listenToBlockErrorChanges=this.listenToBlockErrorChanges.bind(this),this.onErrorListResize=this.onErrorListResize.bind(this)}setBreakpointsMap(e,t){if(!e||!this.compilationResult)return;const n={};for(const t of e){const e=pxt.blocks.findBlockIdByLine(this.compilationResult.sourceMap,{start:t.line,length:t.endLine-t.line});n[e]||(n[e]=[]),n[e].push(t)}this.breakpointsByBlock={};for(const e of Object.keys(n)){let t=n[e][n[e].length-1];const r=this.editor.getBlockById(e);if(r){switch(r.type){case"pxt_controls_for":case"controls_for":case"controls_simple_for":t=n[e][2]}this.breakpointsByBlock[e]=t.id}else this.breakpointsByBlock[e]=t.id}}setBreakpointsFromBlocks(){this.breakpointsSet=this.getBreakpoints(),h.driver.setBreakpoints(this.breakpointsSet)}getBreakpoints(){const e=[],t=this.breakpointsByBlock;return t&&this.editor&&this.editor.getAllBlocks(!1).forEach((n=>{t[n.id]&&n.isBreakpointSet()&&e.push(this.breakpointsByBlock[n.id])})),e}addBreakpointFromEvent(e){this.breakpointsSet.push(this.breakpointsByBlock[e]),h.driver.setBreakpoints(this.breakpointsSet)}removeBreakpointFromEvent(e){let t=this.breakpointsByBlock[e];this.breakpointsSet.filter((e=>e!=t)),h.driver.setBreakpoints(this.breakpointsSet)}clearBreakpoints(){h.driver.setBreakpoints([])}setVisible(e){super.setVisible(e),this.isVisible=e;let t="#blocksEditor .blocklyToolboxDiv, #blocksEditor .blocklyWidgetDiv, #blocksEditor .blocklyToolboxDiv";this.isVisible?(pxt.Util.toArray(document.querySelectorAll(t)).forEach((e=>e.style.display="")),this.parent.fireResize()):(pxt.Util.toArray(document.querySelectorAll(t)).forEach((e=>e.style.display="none")),this.editor&&Blockly.hideChaff(),this.toolbox&&this.toolbox.clearExpandedItem())}saveToTypeScriptAsync(e=!1){if(!this.typeScriptSaveable)return Promise.resolve(void 0);this.clearHighlightedStatements();try{return pxt.blocks.compileAsync(this.editor,this.blockInfo,{emitTilemapLiterals:e}).then((t=>{this.compilationResult=t,pxt.tickEvent("activity.blocks.compile");let n=Promise.resolve();return e&&this.parent&&(function(e){w(e,(e=>e.clearTemporaryAssetData()))}(this.editor),n=this.parent.saveCurrentSourceAsync().then((()=>function(e){w(e,(e=>e.disposeOfTemporaryAsset()))}(this.editor)))),n.then((()=>this.compilationResult.source))}))}catch(e){return pxt.reportException(e),a.errorNotification(lf("Sorry, we were not able to convert this program.")),Promise.resolve(void 0)}}domUpdate(){if(this.delayLoadXml){if(this.loadingXml)return;pxt.debug("loading blockly"),pxt.perf.measureStart("domUpdate loadBlockly"),this.loadingXml=!0;const e=document.createElement("div");e.className="ui active dimmer";const t=document.createElement("div");t.className="ui text loader",t.appendChild(document.createTextNode(lf("Loading blocks..."))),e.appendChild(t);let n=document.getElementById("blocksEditor");n.appendChild(e),c.clearCaches(),this.loadingXmlPromise=this.loadBlocklyAsync().then((()=>c.getBlocksAsync())).then((e=>{this.blockInfo=e,pxt.blocks.initialize(this.blockInfo),this.nsMap=this.partitionBlocks(),this.refreshToolbox(),pxt.debug("loading block workspace");let t=this.delayLoadXml;this.delayLoadXml=void 0,this.loadBlockly(t),this.resize(),Blockly.svgResize(this.editor),this.isFirstBlocklyLoad=!1})).finally((()=>{try{n.removeChild(e)}catch(e){}this.loadingXml=!1,this.loadingXmlPromise=null,pxt.perf.measureEnd("domUpdate loadBlockly"),this.parent.isTutorial()&&this.parent.onTutorialLoaded()}))}}onPageVisibilityChanged(e){e&&this.highlightStatement(this.highlightedStatement)}isDropdownDivVisible(){return"undefined"!=typeof Blockly&&Blockly.DropDownDiv&&Blockly.DropDownDiv.isVisible()}beforeCompile(){"undefined"!=typeof Blockly&&(Blockly.DropDownDiv.hide(),Blockly.WidgetDiv.hide())}getTemporaryAssets(){return this.editor?pxtblockly.getTemporaryAssets(this.editor,"image").concat(pxtblockly.getTemporaryAssets(this.editor,"animation")).concat(pxtblockly.getTemporaryAssets(this.editor,"song")):[]}updateTemporaryAsset(e){this.editor.getBlockById(e.meta.temporaryInfo.blockId).getField(e.meta.temporaryInfo.fieldName).updateAsset(e)}saveBlockly(){return this.delayLoadXml?this.delayLoadXml:this.serializeBlocks()}serializeBlocks(e){let t=pxt.blocks.saveWorkspaceXml(this.editor,!e&&this.parent.state&&this.parent.state.header&&!!this.parent.state.header.githubId);return e&&(t=t.replace(/(x|y|id)="[^"]*"/g,"")),pxt.debug(t),t}loadBlockly(e){if(this.serializeBlocks()==e)return this.typeScriptSaveable=!0,pxt.debug("blocks already loaded..."),!1;this.typeScriptSaveable=!1,pxt.blocks.clearWithoutEvents(this.editor);try{const t=e||`<block type="${ts.pxtc.ON_START_TYPE}"></block>`,n=Blockly.Xml.textToDom(t);this.cleanXmlForWorkspace(n),pxt.blocks.domToWorkspaceNoEvents(n,this.editor),pxtblockly.upgradeTilemapsInWorkspace(this.editor,pxt.react.getTilemapProject()),this.initLayout(),this.editor.clearUndo(),this.reportDeprecatedBlocks(),this.updateGrayBlocks(),this.typeScriptSaveable=!0}catch(e){return pxt.log(e),pxt.blocks.clearWithoutEvents(this.editor),this.switchToTypeScript(),this.changeCallback(),!1}return this.changeCallback(),!0}cleanXmlForWorkspace(e){e.querySelectorAll("block[deletable], shadow[deletable]").forEach((e=>{e.removeAttribute("deletable")}))}initLayout(){let e,t,n=!1,r=!this.editor.getToolbox()&&this.editor.getFlyout();this.editor.getTopComments(!1).forEach((r=>{const i=r.getBoundingRectangle(),o=Math.sqrt(i.left*i.left+i.top*i.top);(void 0===e||o<e)&&(t=i,e=o),n=n||10==i.left&&10==i.top}));let i=[];this.editor.getTopBlocks(!1).forEach((r=>{const o=r.getBoundingRectangle(),s=Math.sqrt(o.left*o.left+o.top*o.top);(void 0===e||s<e)&&(t=o,e=s);const a=!!i.find((e=>e.left===o.left&&e.top===o.top));n=n||a,i.push(o)})),n&&!r?pxt.blocks.layout.flow(this.editor,{useViewWidth:!0}):(t&&(this.editor.getTopComments(!1).forEach((e=>e.moveBy(-t.left,-t.top))),this.editor.getTopBlocks(!1).forEach((e=>e.moveBy(-t.left,-t.top)))),this.editor.scrollX=10,this.editor.scrollY=10,this.editor.resizeContents())}initPrompts(){Blockly.alert=function(e,t){return a.confirmAsync({hideCancel:!0,header:lf("Alert"),agreeLbl:lf("Ok"),agreeClass:"positive",agreeIcon:"checkmark",body:e,size:"tiny"}).then((()=>{t&&t()}))},Blockly.confirm=function(e,t){return a.confirmAsync({header:lf("Confirm"),body:e,agreeLbl:lf("Yes"),agreeClass:"positive",agreeIcon:"checkmark",disagreeLbl:lf("No"),disagreeClass:"cancel",disagreeIcon:"cancel",size:"tiny"}).then((e=>{t(1==e)}))},Blockly.prompt=function(e,t,n,r){return a.promptAsync(Object.assign({header:e,initialValue:t,agreeLbl:lf("Ok"),hasCloseIcon:!0,size:"tiny"},r)).then((e=>{n(e)}))},pxt.Util.isTranslationMode()&&(pxt.blocks.promptTranslateBlock=f.promptTranslateBlock)}initBlocklyToolbox(){let e=this;const t=Blockly.Toolbox.prototype.position;Blockly.Toolbox.prototype.position=function(){t.call(this),e.resizeToolbox()};const n=this;Blockly.WorkspaceSvg.prototype.refreshToolboxSelection=function(){let e=this.isFlyout?this.targetWorkspace:this;e&&!e.currentGesture_&&e.toolbox_&&e.toolbox_.flyout_&&n.toolbox.refreshSelection()};const r=Blockly.hideChaff;Blockly.hideChaff=function(e){r(e),e||n.hideFlyout()}}initWorkspaceSounds(){const e=this,t=Blockly.WorkspaceAudio.prototype.play;Blockly.WorkspaceAudio.prototype.play=function(n,r){e&&e.parent.state.mute&&(r=0),t.call(this,n,r)}}initAccessibleBlocks(){var e;(null===(e=pxt.appTarget.appTheme)||void 0===e?void 0:e.accessibleBlocks)&&!this.navigationController&&(this.navigationController=new NavigationController,this.navigationController.init(),this.navigationController.addWorkspace(this.editor),Navigation.prototype.focusToolbox=e=>{this.toolbox&&(this.focusToolbox(),this.navigationController.navigation.resetFlyout(e,!1),this.navigationController.navigation.setState(e,"toolbox"))})}enableAccessibleBlocks(e){e?this.navigationController.enable(this.editor):this.navigationController.disable(this.editor)}initWorkspaceSearch(){pxt.appTarget.appTheme.workspaceSearch&&!this.workspaceSearch&&(this.workspaceSearch=new pxt.blocks.PxtWorkspaceSearch(this.editor),this.workspaceSearch.init())}reportDeprecatedBlocks(){const e={};let t=!1;this.blockInfo.blocks.forEach((t=>{t.attributes.deprecated&&(e[t.attributes.blockId]=0)})),this.editor.getAllBlocks(!1).forEach((n=>{e[n.type]>=0&&(e[n.type]++,t=!0)}));for(const t in e)0!==e[t]&&pxt.tickEvent("blocks.usingDeprecated",{block:t,count:e[t]})}contentSize(){return this.editor?pxt.blocks.blocksMetrics(this.editor):void 0}isIncomplete(){const e=this.editor&&this.editor.currentGesture_&&this.editor.currentGesture_.isDraggingBlock_;return e&&(this.markIncomplete=!0),e}prepare(){this.isReady=!0}prepareBlockly(e){pxt.perf.measureStart("prepareBlockly");let t=document.getElementById("blocksEditor");if(!t)return;pxsim.U.clear(t),this.editor=Blockly.inject(t,this.getBlocklyOptions(e)),this.editor.options.hasCategories;let n=Blockly.Colours;y.jsonMergeFrom(n,pxt.appTarget.appTheme.blocklyColors||{}),Blockly.Colours=n;let r=!1;this.editor.addChangeListener((e=>{if(Blockly.Events.disableOrphans(e),(-1===[Blockly.Events.UI,Blockly.Events.SELECTED,Blockly.Events.CLICK,Blockly.Events.VIEWPORT_CHANGE,Blockly.Events.BUBBLE_OPEN].indexOf(e.type)||this.markIncomplete)&&(this.changeCallback(),this.markIncomplete=!1),e.type==Blockly.Events.CREATE){let t=e.xml.getAttribute("type");"variables_set"==t&&this.clearFlyoutCaches(),t!==pxtc.TS_STATEMENT_TYPE&&t!==pxtc.TS_OUTPUT_TYPE||this.updateGrayBlocks(),pxt.tickEvent("blocks.create",{block:t},{interactiveConsent:!0}),"SHADOW"==e.xml.tagName&&this.cleanUpShadowBlocks(),this.parent.state.tutorialOptions&&this.parent.state.tutorialOptions.metadata&&this.parent.state.tutorialOptions.metadata.flyoutOnly||this.parent.setState({hideEditorFloats:!1}),p.fireEvent({type:"create",editor:"blocks",blockId:t})}else if(e.type==Blockly.Events.VAR_CREATE||e.type==Blockly.Events.VAR_RENAME||e.type==Blockly.Events.VAR_DELETE)this.clearFlyoutCaches();else if(e.type==Blockly.Events.UI)if("category"==e.element){let t=!!e.newValue;t&&pxt.setInteractiveConsent(!0),this.parent.setState({hideEditorFloats:t})}else"breakpointSet"==e.element?this.setBreakpointsFromBlocks():"melody-editor"==e.element&&(e.newValue?(r=this.parent.state.simState!=pxt.editor.SimState.Stopped,this.parent.stopSimulator()):r&&this.parent.startSimulator());null!=this.parent.state.tutorialOptions&&this.parent.pokeUserActivity()})),this.shouldShowCategories()&&this.renderToolbox(),this.hideFlyout(),this.initPrompts(),this.initBlocklyToolbox(),this.initWorkspaceSounds(),this.initAccessibleBlocks(),this.initWorkspaceSearch(),this.setupIntersectionObserver(),this.resize(),pxt.perf.measureEnd("prepareBlockly")}setupIntersectionObserver(){if(!("IntersectionObserver"in window)||this.intersectionObserver)return;this.intersectionObserver=new IntersectionObserver((e=>{e.forEach((e=>{e.intersectionRatio>0&&(this.intersectionObserver.unobserve(e.target),this.editor.refreshTheme())}))}));const e=document.getElementById("blocksEditor");this.intersectionObserver.observe(e)}resize(e){this.getBlocksAreaDiv()&&this.getBlocksEditorDiv()&&this.editor&&(Blockly.svgResize(this.editor),this.resizeToolbox(),this.resizeFieldEditorView())}resizeToolbox(){if(!this.getBlocksEditorDiv())return;const e=this.getBlocklyToolboxDiv();e&&(this.parent.isBlocksActive()&&this.parent.updateEditorLogo(e.offsetWidth),this.getBlocklyOptions(this.showCategories).horizontalLayout||(e.style.height="100%"))}resizeFieldEditorView(){if(!window)return;const e=this.getBlocksEditorDiv(),t=null==e?void 0:e.getBoundingClientRect();t&&this.parent.isTutorial()&&t.width>pxt.BREAKPOINT_TABLET?g.setEditorBounds({top:t.top,left:t.left,width:t.width,height:t.height}):g.setEditorBounds({top:0,left:0,width:window.innerWidth,height:window.innerHeight})}hasUndo(){return!!this.editor&&(0!=this.editor.undoStack_.length||0==this.editor.undoStack_.length&&0==this.editor.redoStack_.length)}undo(){this.editor&&(this.editor.undo(!1),Blockly.hideChaff(),this.parent.forceUpdate())}hasRedo(){return!!this.editor&&0!=this.editor.redoStack_.length}redo(){this.editor&&(this.editor.undo(!0),Blockly.hideChaff(),this.parent.forceUpdate())}zoomIn(){this.editor&&this.editor.zoomCenter(.8)}zoomOut(){this.editor&&this.editor.zoomCenter(-.8)}setScale(e){this.editor&&e!=this.editor.scale&&this.editor.setScale(e)}closeFlyout(){this.editor&&this.hideFlyout()}getId(){return"blocksArea"}display(){let e=this.parent.state.editorState&&!1===this.parent.state.editorState.hasCategories,t=pxt.appTarget.appTheme.blocksErrorList;return(0,r.jsxs)("div",Object.assign({className:"blocksAndErrorList"},{children:[(0,r.jsxs)("div",Object.assign({className:"blocksEditorOuter"},{children:[(0,r.jsx)("div",{id:"blocksEditor"}),(0,r.jsx)(u.ToolboxTrashIcon,{flyoutOnly:e})]})),t&&(0,r.jsx)(x.ErrorList,{isInBlocksEditor:!0,listenToBlockErrorChanges:this.listenToBlockErrorChanges,onSizeChange:this.onErrorListResize})]}))}onErrorListResize(){this.parent.fireResize()}listenToBlockErrorChanges(e,t){this.errorChangesListeners[e]=t}onBlockErrorChanges(e){for(let t of pxt.U.values(this.errorChangesListeners))t(e)}async validateTutorialCode(e){const{tutorialStep:t}=e,n=this.editor.getAllBlocks(!1),r=await pxt.tutorial.validate(e,n,this.blockInfo);this.parent.setTutorialCodeStatus(t,r)}getBlocksAreaDiv(){return document.getElementById("blocksArea")}getBlocksEditorDiv(){return this.getBlocksAreaDiv()?document.getElementById("blocksEditor"):void 0}getBlocklyToolboxDiv(){const e=this.getBlocksAreaDiv();return e?e.getElementsByClassName("blocklyToolboxDiv")[0]:void 0}moveFocusToFlyout(){}focusToolbox(){this.toolbox&&this.toolbox.focus()}renderToolbox(e){if(pxt.shell.isReadOnly())return;const t=this.getBlocklyToolboxDiv(),n=(0,r.jsxs)("div",Object.assign({className:"blocklyToolbox"},{children:[(0,r.jsx)(u.Toolbox,{ref:this.handleToolboxRef,editorname:"blocks",parent:this}),(0,r.jsx)("div",{id:"debuggerToolbox"})]}));y.assert(!!t),o.render(n,t),e||this.toolbox.showLoading()}updateToolbox(){var e;const t=document.getElementById("debuggerToolbox");if(!t)return;pxt.perf.measureStart("updateToolbox");const n=!!this.parent.state.debugging;let i=n?(0,r.jsx)(b.DebuggerToolbox,{ref:this.handleDebuggerToolboxRef,parent:this.parent,apis:this.blockInfo.apis.byQName}):(0,r.jsx)("div",{});n?(this.toolbox.hide(),null===(e=Blockly.selected)||void 0===e||e.unselect()):(this.debuggerToolbox=null,this.toolbox.show()),o.render(i,t),pxt.perf.measureEnd("updateToolbox")}showPackageDialog(){pxt.tickEvent("blocks.addpackage"),this.editor.getToolbox()&&this.editor.getToolbox().clearSelection(),this.parent.showPackageDialog()}showVariablesFlyout(){this.showFlyoutInternal_(Blockly.Variables.flyoutCategory(this.editor),"variables")}showFunctionsFlyout(){this.showFlyoutInternal_(Blockly.Functions.flyoutCategory(this.editor),"functions")}getViewState(){return{}}setViewState(e){}getCurrentSource(){return this.editor&&!this.delayLoadXml?this.saveBlockly():this.currSource}acceptsFile(e){return"blocks"==e.getExtension()}overrideFile(e){this.delayLoadXml?(this.delayLoadXml=e,this.currSource=e):this.loadBlockly(e)}insertBreakpoint(){if(!this.editor)return;const e=this.editor.newBlock(pxtc.TS_DEBUGGER_TYPE),t=this.editor.getMetrics();e.moveBy(t.viewWidth/2,t.viewHeight/3),e.initSvg(),e.render()}loadBlocklyAsync(){return this._loadBlocklyPromise||(pxt.perf.measureStart("loadBlockly"),this._loadBlocklyPromise=pxt.BrowserUtils.loadBlocklyAsync().then((()=>{Blockly.Functions.editFunctionExternalHandler=(e,t)=>{y.delay(10).then((()=>{if(!this.functionsDialog){const e=document.body.appendChild(document.createElement("div"));this.functionsDialog=o.render(i.createElement(m.CreateFunctionDialog,{parent:this.parent}),e)}this.functionsDialog.show(e,t,this.editor)}))},pxt.blocks.openHelpUrl=e=>{var t;pxt.tickEvent("blocks.help",{url:e},{interactiveConsent:!0});const n=/^\/pkg\/([^#]+)#(.+)$/.exec(e);if(n){const t=s.mainPkg.deps[n[1]];if(t&&"github"==t.verProtocol())return e=`/pkg/${t.verArgument().replace(/#.*$/,"")}#${n[2]}`,void window.open(e,n[1])}if(/^github:/.test(e)){e=e.replace(/^github:\/?/,"")+(/\.md$/i.test(e)?"":".md");const n=s.getEditorPkg(s.mainPkg).lookupFile(e),r=null===(t=null==n?void 0:n.content)||void 0===t?void 0:t.trim();r&&(this.parent.setSideMarkdown(r),this.parent.setSideDocCollapsed(!1))}else/^\//.test(e)?this.parent.setSideDoc(e):window.open(e,"docs")},this.prepareBlockly()})).then((()=>pxt.editor.initEditorExtensionsAsync())).then((()=>pxt.perf.measureEnd("loadBlockly")))),this._loadBlocklyPromise}loadFileAsync(e){return y.assert(!this.delayLoadXml),(this.loadingXmlPromise||Promise.resolve()).then((()=>this.loadBlocklyAsync())).then((()=>{pxt.blocks.cleanBlocks(),this.toolbox&&this.toolbox.showLoading(),this.blockInfo=void 0,this.currSource=e.content,this.typeScriptSaveable=!1,this.setDiagnostics(e),this.delayLoadXml=e.content,this.parent.shouldPreserveUndoStack()||pxt.blocks.clearWithoutEvents(this.editor),this.closeFlyout(),this.filterToolbox(),this.parent.state.editorState&&null!=this.parent.state.editorState.hasCategories?this.showCategories=this.parent.state.editorState.hasCategories:this.showCategories=!0,this.currFile=e;let t=document.getElementById("blocklySearchInputField");t&&t.value&&(t.value=""),this.extensions=!!pxt.appTarget.appTheme.allowPackageExtensions&&s.allEditorPkgs().map((e=>e.getKsPkg())).filter((e=>{var t;return!!(null===(t=null==e?void 0:e.config)||void 0===t?void 0:t.extension)}))||[]}))}unloadFileAsync(){return this.delayLoadXml=void 0,this.toolbox&&this.toolbox.clearSearch(),Promise.resolve()}switchToTypeScript(){pxt.tickEvent("blocks.switchjavascript"),this.parent.closeFlyout(),this.parent.switchTypeScript()}setDiagnostics(e){if(y.assert(null!=this.editor),!this.compilationResult||this.delayLoadXml||this.loadingXml)return;this.editor.getAllBlocks(!1).filter((e=>e.isEnabled())).forEach((e=>{e.setWarningText(null),e.setHighlightWarning(!1)}));let t=e&&e.epkg&&e.epkg.files[e.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME)];if(!t||!t.diagnostics)return;let n=t.diagnostics.filter((e=>e.category==ts.pxtc.DiagnosticCategory.Error)),r=this.compilationResult.sourceMap;n.filter((e=>e.category==ts.pxtc.DiagnosticCategory.Error)).forEach((e=>{let t=pxt.blocks.findBlockIdByLine(r,{start:e.line,length:0});if(t){let n=this.editor.getBlockById(t);if(n){let t=ts.pxtc.flattenDiagnosticMessageText(e.messageText,"\n");n.setWarningText(t),n.setHighlightWarning(!0)}}})),this.compilationResult.diagnostics.forEach((e=>{if(e.blockId){let t=this.editor.getBlockById(e.blockId);t&&(t.setWarningText(e.message),t.setHighlightWarning(!0))}})),this.onBlockErrorChanges(this.compilationResult.diagnostics),this.setBreakpointsFromBlocks()}highlightStatement(e,t){if(!this.compilationResult||this.delayLoadXml||this.loadingXml)return!1;if(this.updateDebuggerVariables(t),this.highlightedStatement=e,!e)return this.editor.highlightBlock(null),!1;{let n=pxt.blocks.findBlockIdByLine(this.compilationResult.sourceMap,{start:e.line,length:e.endLine-e.line});if(n){const e=this.editor.getBlockById(n).getRootBlock();if(n=(null==e?void 0:e.isCollapsed())?e.id:n,this.editor.highlightBlock(n),t){const e=this.editor.getBlockById(n);e.setWarningText(t?t.exceptionMessage:void 0);const r=e.getRelativeToSurfaceXY(),i=e.getHeightWidth(),o=this.editor.scale,s=this.editor.getMetrics(),a=4,l=4;(r.x*o<s.viewLeft+a||(r.x+i.width)*o>s.viewLeft+s.viewWidth-a||r.y*o<s.viewTop+l||(r.y+i.height)*o>s.viewTop+s.viewHeight-l)&&this.editor.centerOnBlock(n)}return!0}}return!1}updateDebuggerVariables(e){if(this.parent.state.debugging&&this.debuggerToolbox){const t=Blockly.Variables.allUsedVarModels(this.editor).map((e=>pxtc.escapeIdentifier(e.name)));this.debuggerToolbox.setBreakpoint(e,t)}}clearHighlightedStatements(){this.editor.highlightBlock(null),this.debuggerToolbox&&this.debuggerToolbox.setBreakpoint(null)}openTypeScript(){pxt.tickEvent("blocks.showjavascript"),this.parent.closeFlyout(),this.parent.openTypeScriptAsync()}openPython(){pxt.tickEvent("blocks.showpython"),this.parent.closeFlyout(),this.parent.openPythonAsync()}cleanUpShadowBlocks(){this.editor.getTopBlocks(!1).filter((e=>e.isShadow())).forEach((e=>e.dispose(!1)))}getBlocklyOptions(e){let t=this.getDefaultOptions();y.jsonMergeFrom(t,pxt.appTarget.appTheme.blocklyOptions||{});const n=null!=e?e:null!=t.hasCategories?t.hasCategories:this.showCategories;t.hasCategories=n,t.renderer="pxt",n||(this.showCategories=!1);const r=n?document.getElementById("blocklyToolboxDefinitionCategory"):document.getElementById("blocklyToolboxDefinitionFlyout");return t.toolbox=null!=t.toolbox?t.toolbox:t.readOnly?void 0:r,t}getDefaultOptions(){if(this.blocklyOptionsCache)return this.blocklyOptionsCache;const e=pxt.shell.isReadOnly(),t=pxt.appTarget.appTheme,n={media:pxt.webConfig.commitCdnUrl+"blockly/media/",sounds:!0,trashcan:!1,collapse:!!t.blocksCollapsing,comments:!0,disable:!1,readOnly:e,toolboxOptions:{colour:t.coloredToolbox,inverted:t.invertedToolbox},move:{scrollbars:!0,wheel:!0},zoom:{controls:!1,maxScale:2.5,minScale:.2,scaleSpeed:1.5,startScale:pxt.BrowserUtils.isMobile()?.7:.9,pinch:!0},rtl:y.isUserLanguageRtl()};return this.blocklyOptionsCache=n,n}refreshToolbox(){if(!this.blockInfo)return;if(pxt.perf.measureStart("refreshToolbox"),pxt.shell.isReadOnly())return;if(null!=this.parent.state.tutorialOptions&&!this.parent.state.tutorialOptions.tutorialReady)return;this.clearCaches();const e=this.parent.state.editorState&&!1===this.parent.state.editorState.hasCategories,t=this.shouldShowCategories(!e);if(this.editor.getToolbox()&&t||this.editor.flyout_&&!t)t?this.toolbox.setState({loading:!1,categories:this.getAllCategories(),showSearchBox:this.shouldShowSearch()}):this.showFlyoutOnlyToolbox();else{t||o.unmountComponentAtNode(this.getBlocklyToolboxDiv());const e=()=>{this.delayLoadXml=this.getCurrentSource(),this.editor=void 0,this.prepareBlockly(t),this.domUpdate(),this.editor.scrollCenter(),t&&this.renderToolbox(!0)};this.loadingXmlPromise?this.loadingXmlPromise.then(e):e()}pxt.perf.measureEnd("refreshToolbox")}filterToolbox(e){this.showCategories=e,this.refreshToolbox()}async openExtension(e){const t=this.extensions.filter((t=>t.config.name===e))[0];if(!(null==t?void 0:t.config.extension))return;pxt.tickEvent("blocks.extensions.open",{extension:e});const{name:n,url:r,trusted:i}=await(0,E.resolveExtensionUrl)(t);if(!i)return a.errorNotification(lf("Sorry, this extension is not allowed.")),void pxt.tickEvent("blocks.extensions.untrusted",{extension:e});pxt.tickEvent("blocks.extensions.trusted",{extension:e}),this.parent.openExtension(n,r)}partitionBlocks(){const e={};this.topBlocks=[];const t=this;function n(e,n){t.subcategoryMap[e]||(t.subcategoryMap[e]={}),t.subcategoryMap[e][n]=!0}return pxt.blocks.injectBlocks(this.blockInfo).forEach((t=>{let r=(t.attributes.blockNamespace||t.namespace).split(".")[0];e[r]||(e[r]=[]),e[r].push(t);const i=t.attributes.subcategory;t.attributes.advanced?n(r,lf("more")):i&&n(r,i),t.attributes.topblock&&this.topBlocks.push(t)})),e}hideFlyout(){this.editor.getToolbox()&&this.editor.getFlyout().hide(),this.toolbox&&this.toolbox.clear()}clearCaches(){super.clearCaches(),this.clearFlyoutCaches(),d.clearBuiltinBlockCache()}clearFlyoutCaches(){this.flyoutBlockXmlCache={}}shouldShowSearch(){return!this.parent.state.editorState||null==this.parent.state.editorState.searchBar||this.parent.state.editorState.searchBar}shouldShowCategories(e){return this.parent.state.editorState&&null!=this.parent.state.editorState.hasCategories?this.parent.state.editorState.hasCategories:this.getBlocklyOptions(e).hasCategories}getBuiltinCategory(e){return d.getBuiltinCategory(e)}isBuiltIn(e){return d.isBuiltin(e)}getNamespaceAttrs(e){const t=d.getBuiltinCategory(e);return t?(t.attributes.color=pxt.toolbox.getNamespaceColor(t.nameid),t.attributes):this.blockInfo?super.getNamespaceAttrs(e):void 0}getNamespaces(){const e=Object.keys(this.nsMap).filter((e=>!d.isBuiltin(e)&&!!this.getNamespaceAttrs(e)));function t(e){return d.getBuiltinCategory(e).removed}let n=pxt.appTarget.runtime||{};return n.loopsBlocks&&!t("loops")&&e.push("loops"),n.logicBlocks&&!t("logic")&&e.push("logic"),n.variablesBlocks&&!t("variables")&&e.push("variables"),n.mathBlocks&&!t("Math")&&e.push("Math"),n.functionBlocks&&!t("functions")&&e.push("functions"),n.listsBlocks&&!t("arrays")&&e.push("arrays"),n.textBlocks&&!t("text")&&e.push("text"),pxt.appTarget.cloud&&pxt.appTarget.cloud.packages&&e.push("addpackage"),e.concat(super.getNamespaces())}getBlocksForCategory(e,t){return d.isBuiltin(e)?this.getBuiltInBlocks(e,t).concat(this.getExtraBlocks(e,t)):this.getNonBuiltInBlocks(e,t).concat(this.getExtraBlocks(e,t))}filterBlocks(e,t){return t?t.filter((t=>!t.attributes.blockHidden&&!(t.attributes.deprecated&&!this.parent.isTutorial())&&(!e&&!t.attributes.subcategory&&!t.attributes.advanced||e&&(t.attributes.advanced&&e==lf("more")||t.attributes.subcategory&&e==t.attributes.subcategory)))):[]}getBuiltInBlocks(e,t){let n=d.getBuiltinCategory(e),r=n.blocks||[];return!n.custom&&this.nsMap[e]&&(r=this.filterBlocks(t,r.concat(this.nsMap[e]))),r}getNonBuiltInBlocks(e,t){return this.filterBlocks(t,this.nsMap[e])||[]}getExtraBlocks(e,t){if(t)return[];let n=[];const r=pxt.appTarget.runtime.onStartNamespace||"loops";e==r&&n.push({name:ts.pxtc.ON_START_TYPE,attributes:{blockId:ts.pxtc.ON_START_TYPE,weight:pxt.appTarget.runtime.onStartWeight||10,group:pxt.appTarget.runtime.onStartGroup||void 0},blockXml:'<block type="pxt-on-start"></block>'});const i=d.getPauseUntil();return i&&e==i.attributes.blockNamespace&&n.push(i),t||this.extensions.forEach((t=>{const r=t.config,i=r.name,o=r.extension.namespace||i;e==o&&n.push({name:`EXT${i}_BUTTON`,type:"button",attributes:{blockId:`EXT${i}_BUTTON`,label:r.extension.label?y.rlf(r.extension.label):y.lf("Editor"),weight:101,group:r.extension.group},callback:()=>{this.openExtension(i)}})})),pxt.appTarget.appTheme.snippetBuilder&&(0,v.initializeSnippetExtensions)(e,n,this.editor,this.parent),n}showFlyout(e){var t,n,r;const{nameid:i,subns:o}=e;if("search"==i)return void this.showSearchFlyout();if("topblocks"==i)return void this.showTopBlocksFlyout();const s=null===(t=this.parent.state.tutorialOptions)||void 0===t?void 0:t.tutorialStep,a=void 0!==s?this.parent.state.tutorialOptions.tutorialStepInfo[s]:void 0,l=!((null===(r=null===(n=null==a?void 0:a.localBlockConfig)||void 0===n?void 0:n.blocks)||void 0===r?void 0:r.length)>0||pxt.Util.isTranslationMode());this.flyoutXmlList=[];const c=i+o+(a?"tutorialexpanded":"");if(l&&this.flyoutBlockXmlCache[c])return pxt.debug("showing flyout with blocks from flyout blocks xml cache"),this.flyoutXmlList=this.flyoutBlockXmlCache[c],void this.showFlyoutInternal_(this.flyoutXmlList,c);this.abstractShowFlyout(e)&&(l&&(this.flyoutBlockXmlCache[c]=this.flyoutXmlList),this.showFlyoutInternal_(this.flyoutXmlList,c))}showFlyoutHeadingLabel(e,t,n,r,i){const o=t||y.capitalize(n||e),s=`blocklyTreeIcon${r?e.toLowerCase():"Default"}`.replace(/\s/g,"");let a=pxt.blocks.createFlyoutHeadingLabel(o,i,r,s);this.flyoutXmlList.push(a)}showFlyoutGroupLabel(e,t,n,r){let i=pxt.blocks.createFlyoutGroupLabel(pxt.Util.rlf(`{id:group}${e}`),t,n,r?`GROUP_HELP_${e}`:void 0);r&&this.editor.registerButtonCallback(`GROUP_HELP_${e}`,(()=>{this.helpButtonCallback(e)})),this.flyoutXmlList.push(i)}helpButtonCallback(e){pxt.debug(`${e} help icon clicked.`),p.fireEvent({type:"ui",editor:"blocks",action:"groupHelpClicked",data:{group:e}})}showFlyoutBlocks(e,t,n){this.parent.state.editorState&&this.parent.state.editorState.filters,n.sort(((e,t)=>(null!=t.attributes.weight?t.attributes.weight:50)-(null!=e.attributes.weight?e.attributes.weight:50))).forEach((e=>{let t;(t="button"==e.type?this.getButtonXml(e):this.getBlockXml(e))&&(this.flyoutXmlList=this.flyoutXmlList.concat(t))}))}showSearchFlyout(){if(this.flyoutXmlList=[],this.toolbox.getSearchBlocks().forEach((e=>{const t=this.getBlockXml(e,!0);t&&(this.flyoutXmlList=this.flyoutXmlList.concat(t))})),0==this.flyoutXmlList.length){let e=Blockly.utils.xml.createElement("label");e.setAttribute("text",lf("No search results...")),this.flyoutXmlList.push(e)}this.showFlyoutInternal_(this.flyoutXmlList,"search"),this.toolbox.setSearch()}showTopBlocksFlyout(){this.flyoutXmlList=[];const e=this.getTopBlocks();if(0==e.length){let e=Blockly.utils.xml.createElement("label");e.setAttribute("text",lf("No basic blocks...")),this.flyoutXmlList.push(e)}else this.showFlyoutHeadingLabel("topblocks",lf("{id:category}Basic"),null,pxt.toolbox.getNamespaceIcon("topblocks"),pxt.toolbox.getNamespaceColor("topblocks")),e.forEach((e=>{const t=this.getBlockXml(e,!0);t&&(this.flyoutXmlList=this.flyoutXmlList.concat(t))}));this.showFlyoutInternal_(this.flyoutXmlList)}blocksToString(e){let t=null;return e.map((e=>e?e.outerHTML?e.outerHTML:(t||(t=new XMLSerializer),t.serializeToString(e)):"\x3c!-- invalid block here! --\x3e")).reduce(((e,t)=>e+t),"")}hashBlocks(e){return pxt.Util.codalHash16(this.blocksToString(e))}swapFlyout(e,t){e.setVisible(!1),this.editor.getToolbox().setFlyout(t),t.setVisible(!0);const n=t.getWorkspace(),r=t.targetWorkspace;n.oldScale_!==r.getScale()&&t.reflow()}showFlyoutInternal_(e,t="default"){var n;if(this.parent.state.editorState&&!1===this.parent.state.editorState.hasCategories||!this.editor.getToolbox())this.editor.flyout_&&(this.editor.flyout_.show(e),this.editor.flyout_.scrollToStart());else{const r=this.editor.getFlyout(),i=t in this.flyouts,o=i?this.flyouts[t].blocksHash:0,s=this.hashBlocks(e),a=o===s&&!!o,l=()=>{const e=this.editor.getToolbox().getWorkspace(),t=r.svgGroup_;return Blockly.Functions.createFlyout(e,t)};let c;i?c=this.flyouts[t].flyout:(c=l(),this.flyouts[t]={flyout:c,blocksHash:0}),this.flyouts[t].blocksHash=s,this.swapFlyout(r,c),a||c.show(e),c.scrollToStart(),(null===(n=this.parent.state)||void 0===n?void 0:n.accessibleBlocks)&&c.svgGroup_.focus()}}showFlyoutOnlyToolbox(){const e=this.getAllCategories();let t=[];e.forEach((e=>{const n=e.blocks;t=t.concat(n),e.subcategories&&e.subcategories.forEach((e=>{const n=e.blocks;t=t.concat(n)}))}));let n=document.createElement("div");o.render((0,r.jsx)(u.ToolboxStyle,{categories:e}),n),document.getElementById("editorcontent").appendChild(n);let i=[];t.forEach((e=>{const t=this.getBlockXml(e);t&&(i=i.concat(t))})),this.showFlyoutInternal_(i),this.parent.forceUpdate()}updateGrayBlocks(){if(this.editor){const e=pxt.shell.isPyLangPref();this.editor.getAllBlocks(!1).forEach((t=>{t.type!==pxtc.TS_STATEMENT_TYPE&&t.type!==pxtc.TS_OUTPUT_TYPE||t.setPythonEnabled(e)}))}}getBlockXml(e,t,n){var r,i,o,s;const a=this;let l;if(!e.attributes.blockBuiltin){if(e.builtinBlock){if("function_return"===e.attributes.blockId)return[pxt.blocks.mkReturnStatementBlock()];const n=d.allBuiltinBlocks()[e.attributes.blockId];if(n&&n.blockXml&&e.builtinField&&2==e.builtinField.length){const t=e.builtinField[0],r=e.builtinField[1],i=new RegExp(`<field name="${t}">(.*)</field>`,"i");n.blockXml=n.blockXml.replace(i,(()=>`<field name="${t}">${r}</field>`))}return n?this.getBlockXml(n,t):void 0}if(e.blockXml)l=Blockly.Xml.textToDom(e.blockXml);else{let t=pxt.blocks.blockSymbol(e.attributes.blockId);if(t){if(!function(e){if(e.attributes.debug&&!pxt.options.debug)return!1;if(!n&&e.attributes.blockHidden)return!1;if(e.attributes.deprecated&&!a.parent.isTutorial())return!1;let t=(e.attributes.blockNamespace||e.namespace).split(".")[0];return a.shouldShowBlock(e.attributes.blockId,t,n)}(t))return;let d=pxt.blocks.compileInfo(t);function c(t){const n=t.blocks.find((t=>t.blockId===e.attributes.blockId));if(n){const e=Blockly.Xml.textToDom(n.xml);return e.setAttribute("gap",`${pxt.appTarget.appTheme&&pxt.appTarget.appTheme.defaultBlockGap&&pxt.appTarget.appTheme.defaultBlockGap.toString()||8}`),e}}const p=null===(r=this.parent.state.tutorialOptions)||void 0===r?void 0:r.tutorialStep,h=void 0!==p?this.parent.state.tutorialOptions.tutorialStepInfo[p]:void 0;if((null===(i=null==h?void 0:h.localBlockConfig)||void 0===i?void 0:i.blocks)&&(l=c(h.localBlockConfig)),!l&&(null===(s=null===(o=this.parent.state.tutorialOptions)||void 0===o?void 0:o.globalBlockConfig)||void 0===s?void 0:s.blocks)&&(l=c(this.parent.state.tutorialOptions.globalBlockConfig)),!l)if(l=pxt.blocks.createToolboxBlock(this.blockInfo,t,d),t.attributes.optionalVariableArgs&&t.attributes.toolboxVariableArgs){const e=d.handlerArgs;t.attributes.toolboxVariableArgs.split(";").map((e=>parseInt(e))).filter((t=>t<=e.length&&t>=0)).forEach((t=>{const n=document.createElement("mutation");n.setAttribute("numargs",t.toString());for(let r=0;r<t;r++)n.setAttribute("arg"+r,e[r].name);l.appendChild(n)}))}else if(d.handlerArgs.length&&!t.attributes.optionalVariableArgs)d.handlerArgs.forEach((e=>{const t=Blockly.Xml.textToDom(`\n                                <value name="HANDLER_${e.name}">\n                                <shadow type="variables_get_reporter">\n                                <field name="VAR" variabletype="">${e.name}</field>\n                                </shadow>\n                                </value>`);l.appendChild(t)}));else{if(t.attributes.mutateDefaults){const e=t.attributes.mutateDefaults.split(";"),n=[];return e.forEach((e=>{const r=l.cloneNode(!0);pxt.blocks.mutateToolboxBlock(r,t.attributes.mutate,e),n.push(r)})),n}if(null!=t.attributes.blockSetVariable&&t.retType&&!n){const e=t.attributes.blockSetVariable;let n,r=n=!e||pxt.blocks.isReservedWord(e)?y.htmlEscape(t.retType.toLowerCase()):y.htmlEscape(e),i=2;for(;u(r,this.editor);)r=n+i++;n=r;const o=Blockly.Xml.textToDom(`\n                            <block type="variables_set" gap="${y.htmlEscape((t.attributes.blockGap||8)+"")}">\n                            <field name="VAR" variabletype="">${n}</field>\n                            </block>`);{let e=document.createElement("value");e.setAttribute("name","VALUE"),e.appendChild(l),e.appendChild(pxt.blocks.mkFieldBlock("math_number","NUM","0",!0)),o.appendChild(e)}l=o}}}else pxt.log("Couldn't find block for: "+e.attributes.blockId),pxt.log(e)}return l&&(t&&l.setAttribute("gap",`${pxt.appTarget.appTheme&&pxt.appTarget.appTheme.defaultBlockGap&&pxt.appTarget.appTheme.defaultBlockGap.toString()||8}`),pxt.Util.toArray(l.querySelectorAll("shadow")).filter((e=>!e.innerHTML)).forEach(((n,r)=>{let i=n.getAttribute("type");if(i===e.type)return;const o=d.allBuiltinBlocks()[i];let s=this.getBlockXml(o||{name:i,type:i,attributes:{blockId:i}},t,!0);s&&s.length>0&&s[0]&&(n.innerHTML=s[0].innerHTML)}))),[l]}function u(e,t){const n=t.getVariable(e),r=n&&t.getVariableUsesById(n.getId());return r&&r.some((e=>"variables_set"==e.type||"variables_change"==e.type))}pxt.log("ignoring built in block: "+e.attributes.blockId)}getButtonXml(e){return this.editor.registerButtonCallback(e.attributes.blockId,(t=>{e.callback()})),[pxt.blocks.createFlyoutButton(e.attributes.blockId,e.attributes.label)]}updateBreakpoints(){if(!this.editor)return;const e=!!this.parent.state.debugging;this.editor.getAllBlocks(!1).forEach((t=>{t.previousConnection&&t.enableBreakpoint(e)})),this.editor.setDebugModeOption(e)}}function w(e,t){const n=e.getAllBlocks(!1);for(const e of n)for(const n of e.inputList)for(const e of n.fieldRow)(e instanceof pxtblockly.FieldSpriteEditor||e instanceof pxtblockly.FieldAnimationEditor)&&t(e)}n.Editor=_},{"./blocklyFieldView":49,"./blocksSnippets":51,"./compiler":58,"./core":133,"./createFunction":135,"./debuggerToolbox":141,"./dialogs":143,"./errorList":147,"./extensionManager":148,"./package":179,"./simulator":192,"./snippetBuilder":193,"./toolbox":201,"./toolboxeditor":202,"./workspace":208,react:366,"react-dom":309,"react/jsx-runtime":367}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getToolboxDefinition=n.overrideToolbox=n.overrideCategory=n.clearBuiltinBlockCache=n.allBuiltinBlocks=n.isBuiltin=n.getBuiltinCategory=n.getPauseUntil=void 0;let r,i,o=null;function s(){return o||((o={}).loops={name:lf("{id:category}Loops"),nameid:"loops",blocks:[{name:"controls_repeat_ext",attributes:{blockId:"controls_repeat_ext",weight:49},blockXml:'<block type="controls_repeat_ext">\n                    <value name="TIMES">\n                        <shadow type="math_whole_number">\n                            <field name="NUM">4</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"device_while",attributes:{blockId:"device_while",weight:48},blockXml:'<block type="device_while">\n                    <value name="COND">\n                        <shadow type="logic_boolean">\n                            <field name="BOOL">FALSE</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"pxt_controls_for",attributes:{blockId:"pxt_controls_for",weight:47},blockXml:`<block type="pxt_controls_for">\n                    <value name="VAR">\n                        <shadow type="variables_get_reporter">\n                            <field name="VAR">${lf("{id:var}index")}</field>\n                        </shadow>\n                    </value>\n                    <value name="TO">\n                        <shadow type="math_whole_number">\n                            <field name="NUM">4</field>\n                        </shadow>\n                    </value>\n                </block>`},{name:"pxt_controls_for_of",attributes:{blockId:"pxt_controls_for_of",weight:46},blockXml:`<block type="pxt_controls_for_of">\n                    <value name="VAR">\n                        <shadow type="variables_get_reporter">\n                            <field name="VAR">${lf("{id:var}value")}</field>\n                        </shadow>\n                    </value>\n                    <value name="LIST">\n                        <shadow type="variables_get">\n                            <field name="VAR">list</field>\n                        </shadow>\n                    </value>\n                </block>`}],attributes:{callingConvention:0,icon:"loops",weight:50.09,paramDefl:{}}},pxt.appTarget.runtime&&pxt.appTarget.runtime.breakBlock&&o.loops.blocks.push({name:"pxt_break",attributes:{blockId:"break_keyword",weight:30},blockXml:'<block type="break_keyword"></block>'}),pxt.appTarget.runtime&&pxt.appTarget.runtime.continueBlock&&o.loops.blocks.push({name:"pxt_continue",attributes:{blockId:"continue_keyword",weight:29},blockXml:'<block type="continue_keyword"></block>'}),o.logic={name:lf("{id:category}Logic"),nameid:"logic",groups:[lf("Conditionals"),lf("Comparison"),lf("Boolean"),"other"],blocks:[{name:"controls_if",attributes:{blockId:"controls_if",group:lf("Conditionals"),weight:49},blockXml:'<block type="controls_if" gap="8">\n                    <value name="IF0">\n                        <shadow type="logic_boolean">\n                            <field name="BOOL">TRUE</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"controls_if_else",attributes:{blockId:"controls_if",group:lf("Conditionals"),weight:48},blockXml:'<block type="controls_if" gap="8">\n                    <mutation else="1"></mutation>\n                    <value name="IF0">\n                        <shadow type="logic_boolean">\n                            <field name="BOOL">TRUE</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_compare_eq",attributes:{blockId:"logic_compare",group:lf("Comparison"),weight:47},blockXml:'<block type="logic_compare" gap="8">\n                    <value name="A">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                    <value name="B">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_compare_lt",attributes:{blockId:"logic_compare",group:lf("Comparison"),weight:46},blockXml:'<block type="logic_compare">\n                    <field name="OP">LT</field>\n                    <value name="A">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                    <value name="B">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_compare_strings",attributes:{blockId:"logic_compare",group:lf("Comparison"),weight:45},blockXml:'<block type="logic_compare" gap="8">\n                    <value name="A">\n                        <shadow type="text">\n                            <field name="TEXT"></field>\n                        </shadow>\n                    </value>\n                    <value name="B">\n                        <shadow type="text">\n                            <field name="TEXT"></field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_operation_and",attributes:{blockId:"logic_operation",group:lf("Boolean"),weight:44},blockXml:'<block type="logic_operation" gap="8">\n                    <field name="OP">AND</field>\n                </block>'},{name:"logic_operation_or",attributes:{blockId:"logic_operation",group:lf("Boolean"),weight:43},blockXml:'<block type="logic_operation" gap="8">\n                    <field name="OP">OR</field>\n                </block>'},{name:"logic_negate",attributes:{blockId:"logic_negate",group:lf("Boolean"),weight:42},blockXml:'<block type="logic_negate"></block>'},{name:"logic_boolean_true",attributes:{blockId:"logic_boolean",group:lf("Boolean"),weight:41},blockXml:'<block type="logic_boolean" gap="8">\n                    <field name="BOOL">TRUE</field>\n                </block>'},{name:"logic_boolean_false",attributes:{blockId:"logic_boolean",group:lf("Boolean"),weight:40},blockXml:'<block type="logic_boolean">\n                    <field name="BOOL">FALSE</field>\n                </block>'}],attributes:{callingConvention:0,weight:50.08,icon:"logic",paramDefl:{}}},o.variables={name:lf("{id:category}Variables"),nameid:"variables",blocks:void 0,custom:!0,customClick:e=>(e.showVariablesFlyout(),!1),attributes:{weight:50.07,icon:"variables",callingConvention:0,paramDefl:{}}},o.Math={name:lf("{id:category}Math"),nameid:"Math",blocks:[{name:"math_arithmetic_ADD",attributes:{blockId:"math_arithmetic",weight:90},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">ADD</field>\n                    </block>'},{name:"math_arithmetic_MINUS",attributes:{blockId:"math_arithmetic",weight:89},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">MINUS</field>\n                    </block>'},{name:"math_arithmetic_TIMES",attributes:{blockId:"math_arithmetic",weight:88},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">MULTIPLY</field>\n                    </block>'},{name:"math_arithmetic_DIVIDE",attributes:{blockId:"math_arithmetic",weight:87},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">DIVIDE</field>\n                    </block>'},{name:"math_number",attributes:{blockId:"math_number",weight:86},blockXml:'<block type="math_number" gap="8">\n                        <field name="NUM">0</field>\n                    </block>'},{name:"math_modulo",attributes:{blockId:"math_modulo",weight:85},blockXml:'<block type="math_modulo">\n                        <value name="DIVIDEND">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="DIVISOR">\n                            <shadow type="math_number">\n                                <field name="NUM">1</field>\n                            </shadow>\n                        </value>\n                    </block>'},{name:"math_op2_min",attributes:{blockId:"math_op2",weight:84},blockXml:'<block type="math_op2" gap="8">\n                        <value name="x">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="y">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="op">min</field>\n                    </block>'},{name:"math_op2_max",attributes:{blockId:"math_op2",weight:83},blockXml:'<block type="math_op2" gap="8">\n                        <value name="x">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="y">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="op">max</field>\n                    </block>'},{name:"math_op3",attributes:{blockId:"math_op3",weight:82},blockXml:'<block type="math_op3">\n                        <value name="x">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                    </block>'},{name:"math_js_op",attributes:{blockId:"math_js_op",weight:81},blockXml:'<block type="math_js_op">\n                        <field name="OP">sqrt</field>\n                        <value name="ARG0">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                    </block>'},{name:"math_js_round",attributes:{blockId:"math_js_round",weight:80},blockXml:'<block type="math_js_round">\n                        <field name="OP">round</field>\n                        <value name="ARG0">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                    </block>'}],attributes:{callingConvention:0,weight:50.06,icon:"math",paramDefl:{}}},o.functions={name:lf("{id:category}Functions"),nameid:"functions",blocks:[],custom:!0,customClick:e=>(e.showFunctionsFlyout(),!1),attributes:{advanced:!0,weight:50.08,callingConvention:0,icon:"functions",paramDefl:{}}},o.arrays={name:lf("{id:category}Arrays"),nameid:"arrays",blocks:[{name:"lists_create_with",attributes:{blockId:"lists_create_with",group:"Create",weight:90},blockXml:`<block type="variables_set" gap="8">\n                        <field name="VAR" variabletype="">${lf("{id:var}list")}</field>\n                        <value name="VALUE">\n                            <block type="lists_create_with">\n                                <mutation items="2"></mutation>\n                                <value name="ADD0">\n                                    <shadow type="math_number">\n                                        <field name="NUM">0</field>\n                                    </shadow>\n                                </value>\n                                <value name="ADD1">\n                                    <shadow type="math_number">\n                                        <field name="NUM">1</field>\n                                    </shadow>\n                                </value>\n                            </block>\n                        </value>\n                    </block>`},{name:"lists_create_with",attributes:{blockId:"lists_create_with",group:"Create",weight:89},blockXml:`<block type="variables_set">\n                        <field name="VAR" variabletype="">${lf("{id:var}text list")}</field>\n                        <value name="VALUE">\n                            <block type="lists_create_with">\n                                <mutation items="3"></mutation>\n                                <value name="ADD0">\n                                    <shadow type="text">\n                                        <field name="TEXT">${lf("a")}</field>\n                                    </shadow>\n                                </value>\n                                <value name="ADD1">\n                                    <shadow type="text">\n                                        <field name="TEXT">${lf("b")}</field>\n                                    </shadow>\n                                </value>\n                                <value name="ADD2">\n                                    <shadow type="text">\n                                        <field name="TEXT">${lf("c")}</field>\n                                    </shadow>\n                                </value>\n                            </block>\n                        </value>\n                    </block>`},{name:"lists_create_with",attributes:{blockId:"lists_create_with",group:"Create",weight:5},blockXml:'<block type="lists_create_with">\n                        <mutation items="0"></mutation>\n                    </block>'},{name:"lists_index_get",attributes:{blockId:"lists_index_get",group:"Read",weight:87},blockXml:`<block type="lists_index_get">\n                        <value name="LIST">\n                            <block type="variables_get">\n                                <field name="VAR">${lf("{id:var}list")}</field>\n                            </block>\n                        </value>\n                        <value name="INDEX">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                    </block>`},{name:"lists_index_set",attributes:{blockId:"lists_index_set",group:"Modify",weight:86},blockXml:`<block type="lists_index_set">\n                        <value name="INDEX">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="LIST">\n                            <block type="variables_get">\n                                <field name="VAR">${lf("{id:var}list")}</field>\n                            </block>\n                        </value>\n                    </block>`},{name:"lists_length",attributes:{blockId:"lists_length",group:"Read",weight:88},blockXml:`<block type="lists_length">\n                        <value name="VALUE">\n                            <block type="variables_get">\n                                <field name="VAR">${lf("{id:var}list")}</field>\n                            </block>\n                        </value>\n                    </block>`}],attributes:{advanced:!0,weight:50.07,icon:"arrays",groups:["Create","Read","Modify","Operations"],callingConvention:0,paramDefl:{}}},o.text={name:lf("{id:category}Text"),nameid:"text",blocks:[{name:"text",attributes:{blockId:"text",weight:90},blockXml:'<block type="text"></block>'},{name:"text_length",attributes:{blockId:"text_length",weight:89},blockXml:`<block type="text_length">\n                        <value name="VALUE">\n                            <shadow type="text">\n                                <field name="TEXT">${lf("Hello")}</field>\n                            </shadow>\n                        </value>\n                    </block>`},{name:"text_join",attributes:{blockId:"text_join",weight:88},blockXml:`<block type="text_join">\n                        <mutation items="2"></mutation>\n                        <value name="ADD0">\n                            <shadow type="text">\n                                <field name="TEXT">${lf("Hello")}</field>\n                            </shadow>\n                        </value>\n                        <value name="ADD1">\n                            <shadow type="text">\n                                <field name="TEXT">${lf("World")}</field>\n                            </shadow>\n                        </value>\n                    </block>`}],attributes:{advanced:!0,weight:50.06,icon:"text",callingConvention:0,paramDefl:{}}},o.addpackage={name:pxt.toolbox.addPackageTitle(),nameid:"addpackage",blocks:[],custom:!0,customClick:e=>(e.closeFlyout(),e.showPackageDialog(),!0),attributes:{advanced:!1,weight:-1,icon:"addpackage",callingConvention:0,paramDefl:{}}}),o}function a(){if(r)return r;const e=pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock;return e&&(r={name:pxtc.PAUSE_UNTIL_TYPE,attributes:{blockId:pxtc.PAUSE_UNTIL_TYPE,blockNamespace:e.category||"loops",weight:null==e.weight?0:e.weight},blockXml:Blockly.Xml.domToText(pxt.blocks.mkPredicateBlock(pxtc.PAUSE_UNTIL_TYPE))}),r}function l(e){return s()[e]}function c(e,t){const n=l(e);if(t&&n&&(0===Object.keys(t).length&&(n.removed=!0),t.name&&(n.name=t.name),t.icon&&(n.attributes.icon=t.icon),void 0!==t.weight&&(n.attributes.weight=t.weight),void 0!==t.advanced&&(n.attributes.advanced=t.advanced),null!=t.groups&&(n.groups=t.groups),t.blocks)){let e=100;n.blocks=t.blocks.map(((t,n)=>(t.weight?e=t.weight:e--,function(e,t){return{name:e.name,snippet:e.snippet,snippetName:e.snippetName,snippetOnly:e.snippetOnly,pySnippet:e.pySnippet,pySnippetName:e.pySnippetName,attributes:{blockId:e.blockId,weight:t||e.weight,advanced:e.advanced,jsDoc:e.jsDoc,group:e.group},retType:e.retType,blockXml:e.blockXml}}(t,e))))}}function u(e){return{name:e.name,icon:e.attributes.icon,color:e.attributes.color,weight:e.attributes.weight,advanced:e.attributes.advanced,blocks:e.blocks?e.blocks.map((e=>function(e){return{name:e.name,snippet:e.snippet,snippetName:e.snippetName,pySnippet:e.pySnippet,pySnippetName:e.pySnippetName,snippetOnly:e.snippetOnly,retType:e.retType,weight:e.attributes.weight,advanced:e.attributes.advanced,jsDoc:e.attributes.jsDoc,group:e.attributes.group,blockXml:e.blockXml,blockId:e.attributes.blockId}}(e))):[]}}n.getPauseUntil=a,n.getBuiltinCategory=l,n.isBuiltin=function(e){return!!s()[e]},n.allBuiltinBlocks=function(){i||(i={},[l("loops"),l("logic"),l("Math"),l("text"),l("arrays")].forEach((e=>{e.blocks.forEach((e=>{e.attributes.blockId&&!i[e.attributes.blockId]&&(i[e.attributes.blockId]=e)}))}))),i[ts.pxtc.ON_START_TYPE]={name:ts.pxtc.ON_START_TYPE,attributes:{blockId:ts.pxtc.ON_START_TYPE,weight:pxt.appTarget.runtime.onStartWeight||10,group:pxt.appTarget.runtime.onStartGroup||void 0},blockXml:'<block type="pxt-on-start"></block>'};const e=a();return e&&(i[pxtc.PAUSE_UNTIL_TYPE]=e),i},n.clearBuiltinBlockCache=function(){i=void 0},n.overrideCategory=c,n.overrideToolbox=function(e){c("loops",e.loops),c("logic",e.logic),c("variables",e.variables),c("Math",e.maths),c("text",e.text),c("arrays",e.arrays),c("functions",e.functions)},n.getToolboxDefinition=function(){return{loops:u(l("loops")),logic:u(l("logic")),variables:u(l("variables")),maths:u(l("Math")),text:u(l("text")),arrays:u(l("arrays")),functions:u(l("functions"))}}},{}],52:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.provider=n.copyProjectToLegacyEditor=void 0;const r=e("./db"),i=e("./workspace");let o,s;async function a(e){const t=o.getAsync(e.id),n=s.getAsync(e.id);let[r,i]=await Promise.all([t,n]);if(r&&i)return{header:r,text:i.files,version:i._rev}}function l(e,t,n){return c(o,s,e,t,n)}function c(e,t,n,r,i){let o="";return(i?t.setAsync({id:n.id,files:i,_rev:r}).then((e=>{o=e})):Promise.resolve()).then((()=>e.setAsync(n))).then((e=>(n._rev=e,o)))}n.copyProjectToLegacyEditor=function(e,t){const n=pxt.appTarget.appTheme.browserDbPrefixes&&pxt.appTarget.appTheme.browserDbPrefixes[t],i=new r.Table(n?`${n}-header`:"header"),o=new r.Table(n?`${n}-text`:"text"),s=pxt.Util.clone(e);return delete s._id,delete s._rev,s.id=pxt.Util.guidGen(),a(e).then((e=>c(i,o,s,void 0,e.text))).then((e=>s))},n.provider={getAsync:a,setAsync:l,deleteAsync:function(e,t){return o.deleteAsync(e).then((()=>s.deleteAsync({id:e.id,_rev:e._rev})))},listAsync:async function(){return await function(){const e=pxt.semver.parse(pxt.appTarget.versions.target).major,t=pxt.appTarget.appTheme.browserDbPrefixes&&pxt.appTarget.appTheme.browserDbPrefixes[e];return t?(o=new r.Table(`${t}-header`),s=new r.Table(`${t}-text`),o.getAllAsync().then((t=>{if(t.length)return Promise.resolve();const n=e-1,i=n<0?"":pxt.appTarget.appTheme.browserDbPrefixes&&pxt.appTarget.appTheme.browserDbPrefixes[n];let o=new r.Table("header"),s=new r.Table("text");return i&&(o=new r.Table(`${i}-header`),s=new r.Table(`${i}-text`)),o.getAllAsync().then((e=>pxt.Util.promiseMapAll(e,(e=>(e=>s.getAsync(e.id).then((t=>(delete e._id,delete e._rev,l(e,void 0,t.files)))))(e))))).then((()=>{}))}))):(o=new r.Table("header"),s=new r.Table("text"),Promise.resolve())}(),await async function(){const e=new pxt.skillmap.IndexedDBWorkspace;await e.initAsync();const t=await e.getAllProjectsAsync();for(const n of t)n.header.isSkillmapProject=!0,await i.installAsync(n.header,n.text,!0),await e.deleteProjectAsync(n.header.id)}(),o.getAllAsync()},resetAsync:function(){return Promise.resolve()},loadedAsync:function(){var e,t;return null===(t=(e=pxt.commands).workspaceLoadedAsync)||void 0===t?void 0:t.call(e)}}},{"./db":137,"./workspace":208}],53:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Carousel=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("./sui"),s=e("./data"),a=e("./util"),l=300;var c,u;(u=c||(c={}))[u.None=0]="None",u[u.X=1]="X",u[u.Y=2]="Y";class d extends s.Component{constructor(e){super(e),this.arrows=[],this.isDragging=!1,this.definitelyDragging=c.None,this.currentOffset=0,this.index=0,this.childrenElements=[],this.handleContainerRef=e=>{this.container=e},this.handleDragSurfaceRef=e=>{this.dragSurface=e},this.handleArrowRefs=e=>{this.arrows.push(e)},this.handleChildRefs=e=>{e&&this.childrenElements.push(e)},this.updateDimensions=()=>{if(this.container){let e=!1;if(this.containerWidth=this.container.getBoundingClientRect().width,this.getArrowWidth(),this.childrenElements.length){const t=this.childrenElements[0].getBoundingClientRect().width;t!==this.childWidth&&(this.childWidth=t,e=!0),this.actualPageLength=Math.floor(this.containerWidth/this.childWidth)}this.dragSurface.style.width=this.totalLength()+"px",this.updateArrows(),this.index>=this.maxIndex()&&(e=!0,this.index=this.maxIndex()),e&&this.setPosition(this.indexToOffset(this.index))}},this.state={},this.childrenElements=[],this.arrows=[],this.onLeftArrowClick=this.onLeftArrowClick.bind(this),this.onRightArrowClick=this.onRightArrowClick.bind(this)}UNSAFE_componentWillReceiveProps(e){null!=e.selectedIndex&&this.setIndex(e.selectedIndex)}renderCore(){const{rightDisabled:e,leftDisabled:t}=this.state,n=pxt.Util.isUserLanguageRtl();return(0,r.jsxs)("div",Object.assign({className:"ui carouselouter"},{children:[!t&&(0,r.jsx)("span",Object.assign({role:"button",className:"carouselarrow left aligned",tabIndex:0,title:lf("See previous"),"aria-label":lf("See previous"),onClick:this.onLeftArrowClick,onKeyDown:a.fireClickOnEnter,ref:this.handleArrowRefs},{children:(0,r.jsx)(o.Icon,{icon:"circle angle "+(n?"right":"left")})})),(0,r.jsx)("div",Object.assign({className:"carouselcontainer",ref:this.handleContainerRef},{children:(0,r.jsx)("div",Object.assign({className:"carouselbody",ref:this.handleDragSurfaceRef},{children:i.Children.map(this.props.children,((e,t)=>e?(0,r.jsx)("div",Object.assign({className:"carouselitem "+(this.props.selectedIndex==t?"selected":""),ref:this.handleChildRefs},{children:i.cloneElement(e,{tabIndex:this.isVisible(t)?0:-1})})):void 0))}))})),!e&&(0,r.jsx)("span",Object.assign({role:"button",className:"carouselarrow right aligned",tabIndex:0,title:lf("See more"),"aria-label":lf("See more"),onClick:this.onRightArrowClick,onKeyDown:a.fireClickOnEnter,ref:this.handleArrowRefs},{children:(0,r.jsx)(o.Icon,{icon:"circle angle "+(pxt.Util.isUserLanguageRtl()?"left":"right")})}))]}))}onLeftArrowClick(){this.onArrowClick(!0)}onRightArrowClick(){this.onArrowClick(!1)}onArrowClick(e){const t=this.index,n=this.container.scrollLeft;this.setIndex(e?this.index-this.actualPageLength:this.index+this.actualPageLength);const{tickId:r}=this.props;if(r&&pxt.tickEvent("carousel.arrow.click",{tickId:r,index:this.index,left:e?-1:1},{interactiveConsent:!0}),e){const e=this.index+this.actualPageLength<t?this.index+this.actualPageLength:t-1;this.childrenElements[e]&&this.childrenElements[e].firstChild.focus()}else{const e=this.index>t+this.actualPageLength?this.index:t+this.actualPageLength;this.childrenElements[e]&&this.childrenElements[e].firstChild.focus()}this.container.scrollLeft=n}componentDidMount(){this.initDragSurface(),this.updateDimensions(),window.addEventListener("resize",this.updateDimensions)}componentWillUnmount(){window.removeEventListener("resize",this.updateDimensions)}componentDidUpdate(){this.updateDimensions()}initDragSurface(){let e=e=>{this.definitelyDragging=c.None,this.dragStart(h(e),f(e))},t=e=>{this.isDragging&&(this.dragEnd(),this.definitelyDragging&&(e.preventDefault(),e.stopPropagation()))},n=e=>{this.isDragging&&this.dragEnd()},r=e=>{if(this.isDragging){let t=h(e);if(!this.definitelyDragging){let n=f(e);Math.abs(t-this.dragStartX)>5?this.definitelyDragging=c.X:Math.abs(n-this.dragStartY)>5&&(this.definitelyDragging=c.Y)}this.definitelyDragging==c.X&&(e.stopPropagation(),e.preventDefault(),window.requestAnimationFrame((()=>{this.dragMove(t)})))}};this.dragSurface.addEventListener("click",(e=>{this.definitelyDragging&&(e.stopPropagation(),e.preventDefault())})),window.PointerEvent?(this.dragSurface.addEventListener("pointerdown",e),this.dragSurface.addEventListener("pointerup",t),this.dragSurface.addEventListener("pointerleave",n),this.dragSurface.addEventListener("pointermove",r)):(this.dragSurface.addEventListener("mousedown",e),this.dragSurface.addEventListener("mouseup",t),this.dragSurface.addEventListener("mouseleave",n),this.dragSurface.addEventListener("mousemove",r),pxt.BrowserUtils.isTouchEnabled()&&(this.dragSurface.addEventListener("touchstart",e),this.dragSurface.addEventListener("touchend",t),this.dragSurface.addEventListener("touchcancel",n),this.dragSurface.addEventListener("touchmove",r)))}dragStart(e,t){this.isDragging=!0,this.dragStartX=e,this.dragStartY=t,this.dragStartOffset=this.currentOffset,this.animationId&&(window.cancelAnimationFrame(this.animationId),this.animationId=0)}dragEnd(){this.isDragging=!1,this.calculateIndex()}dragMove(e){this.dragOffset=e-this.dragStartX;const t=pxt.Util.isUserLanguageRtl()?this.dragStartOffset+this.dragOffset:this.dragStartOffset-this.dragOffset;this.setPosition(t)}setPosition(e){this.dragSurface&&(e=Math.min(Math.max(e,-300),this.maxScrollOffset()),this.currentOffset=e,pxt.Util.isUserLanguageRtl()?this.dragSurface.style.marginRight=-e+"px":this.dragSurface.style.marginLeft=-e+"px")}calculateIndex(){if(this.dragSurface){const e=Math.round(Math.max(this.currentOffset,0)/this.childWidth);let t;t=this.currentOffset>this.dragStartOffset?e:e-1,this.setIndex(t,200)}}setIndex(e,t){const n=Math.max(Math.min(e,this.maxIndex()),0);t||(t=100*Math.abs(n-this.index)),this.index=n,this.updateArrows(),this.animation=new p(this.currentOffset,this.indexToOffset(this.index),t),this.animationId||(this.animationId=window.requestAnimationFrame(this.easeTowardsIndex.bind(this)))}isVisible(e){return e>=this.index&&e<this.index+(this.actualPageLength||4)}easeTowardsIndex(e){this.dragSurface&&(this.setPosition(this.animation.getPosition(e)),this.animation.isComplete?(this.animation=void 0,this.animationId=0):this.animationId=window.requestAnimationFrame(this.easeTowardsIndex.bind(this)))}indexToOffset(e){return e<=0?0:e===this.maxIndex()?this.totalLength()-this.containerWidth-l+2*this.arrowWidth:e*this.childWidth-this.childWidth*this.props.bleedPercent/100}totalLength(){return i.Children.count(this.props.children)*this.childWidth+l}getArrowWidth(){this.arrows.length&&(this.arrowWidth=0,this.arrows.forEach((e=>{e&&(this.arrowWidth=Math.max(e.getBoundingClientRect().width,this.arrowWidth))})))}maxScrollOffset(){return Math.max(this.totalLength()-this.actualPageLength*this.childWidth+l,0)}maxIndex(){return Math.max(this.childrenElements.length-this.actualPageLength,0)}updateArrows(){const{rightDisabled:e,leftDisabled:t}=this.state||{},n=this.index===this.maxIndex(),r=0===this.index;n===e&&r===t||this.setState({leftDisabled:r,rightDisabled:n})}}n.Carousel=d;class p{constructor(e,t,n){this.start=e,this.end=t,this.millis=n,this.isComplete=!1,this.slope=(t-e)/n}getPosition(e){if(this.isComplete)return this.end;if(void 0===this.startTime)return this.startTime=e,this.start;const t=e-this.startTime;return t>this.millis?(this.isComplete=!0,this.end):this.start+Math.floor(this.slope*t)}}function h(e){return"screenX"in e?e.screenX:e.changedTouches[0].screenX}function f(e){return"screenY"in e?e.screenY:e.changedTouches[0].screenY}},{"./data":136,"./sui":200,"./util":206,react:366,"react/jsx-runtime":367}],54:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.init=n.HEADER_CLOUDSTATE=n.requestProjectCloudStatus=n.saveLocalProjectsToCloudAsync=n.convertCloudToLocal=n.forceReloadForCloudSync=n.syncAsync=n.getCloudTempMetadata=n.CloudTempMetadata=n.shareAsync=n.excludeCloudMetadataFields=n.excludeLocalOnlyMetadataFields=void 0;const r=e("./core"),i=e("./auth"),o=e("./data"),s=e("./workspace"),a=e("./app");var l=pxt.Util;const c=["_rev","_id","cloudVersion","cloudCurrent","cloudLastSyncTime"],u=["cloudVersion","cloudCurrent","cloudLastSyncTime","cloudUserId"];function d(e,t){const n=Object.assign({},e);for(let e of t)delete n[e];return n}function p(e){return d(e,c)}function h(e){return d(e,u)}function f(e){return new Promise((async(t,n)=>{var r;const o=v(e.id);try{pxt.debug(`downloading from cloud: '${j(e)}`),o.syncInProgress();const s=await i.apiAsync(`/api/user/project/${e.id}`);if(s.success){const e=null===(r=i.userProfile())||void 0===r?void 0:r.id,n=s.resp,o={header:p(JSON.parse(n.header)),text:JSON.parse(n.text),version:n.version};o.header.cloudCurrent=!0,o.header.cloudVersion=o.version,o.header.cloudUserId=e,o.header.cloudLastSyncTime=l.nowSeconds(),pxt.tickEvent("identity.cloudApi.getProject.success"),t(o)}else pxt.tickEvent("identity.cloudApi.getProject.failed"),n(s.err)}catch(e){pxt.tickEvent("identity.cloudApi.getProject.failed"),n(e)}finally{o.syncFinished()}}))}n.excludeLocalOnlyMetadataFields=p,n.excludeCloudMetadataFields=h,n.shareAsync=function(e,t){return new Promise((async(n,r)=>{const o=v(e);try{o.syncInProgress();const e=await i.apiAsync("/api/user/project/share",t,"POST");e.success?n(e.resp):r(e.err)}finally{o.syncFinished()}}))};class g{constructor(e){this.headerId=e}get justSynced(){return this._justSynced}syncInProgress(){this._syncStartTime=l.nowSeconds(),o.invalidate(`${n.HEADER_CLOUDSTATE}:${this.headerId}`)}syncFinished(){this._syncStartTime=0,this._justSynced=!0,o.invalidate(`${n.HEADER_CLOUDSTATE}:${this.headerId}`),setTimeout((()=>{0===this._syncStartTime&&(this._justSynced=!1,o.invalidate(`${n.HEADER_CLOUDSTATE}:${this.headerId}`))}),1500)}cloudStatus(){const e=s.getHeader(this.headerId);if(e&&e.cloudUserId)return i.loggedIn()?this._syncStartTime>0?pxt.cloud.cloudStatus.syncing:e.cloudCurrent?this.justSynced?pxt.cloud.cloudStatus.justSynced:e.cloudLastSyncTime>0?pxt.cloud.cloudStatus.synced:void pxt.reportError("cloudsave",`Invalid project cloud state for project ${j(e)}: user: ${e.cloudUserId}, inProg: ${this._syncStartTime}, cloudCurr: ${e.cloudCurrent}, lastCloud: ${e.cloudLastSyncTime}`):pxt.cloud.cloudStatus.localEdits:pxt.cloud.cloudStatus.offline}}n.CloudTempMetadata=g;const m={};function v(e){return m[e]||(m[e]=new g(e)),m[e]}let y;async function b(e){return i.hasIdentity()&&i.loggedIn()?(e=null!=e?e:{},y||(y=async function(e){var t;try{const n=!e.hdrs;n&&(e.hdrs=w()),pxt.debug(`Synchronizing ${e.hdrs.length} local project(s) with the cloud...`);const r=w(e.hdrs),a=l.nowSeconds();pxt.tickEvent("identity.sync.start");const c=e=>a-e+" seconds ago",u=await async function(e){return new Promise((async(t,n)=>{var r;const o={};(null==e?void 0:e.length)&&(o.projectIds=e.map((e=>e.id)).join(","));const s=pxt.Util.stringifyQueryString("/api/user/project",o),a=await i.apiAsync(s);if(a.success){const e=l.nowSeconds(),n=null===(r=i.userProfile())||void 0===r?void 0:r.id,o=a.resp.map((t=>{const r=p(JSON.parse(t.header));return r.cloudUserId=n,r.cloudCurrent=!0,r.cloudLastSyncTime=e,r.cloudVersion=t.version,r}));pxt.tickEvent("identity.cloudApi.list.success",{count:o.length}),t(o)}else pxt.tickEvent("identity.cloudApi.list.failed"),n(a.err)}))}(n?void 0:e.hdrs),d=u.length-r.length;0!==d&&pxt.debug(`${Math.abs(d)} ${d>0?"more":"fewer"} projects found in the cloud.`);const h=u.length?Math.max(...u.map((e=>e.modificationTime))):a;pxt.debug(`Last cloud project change was ${c(h)}`);const f=l.toDictionary(u,(e=>e.id)),g={},m=x,v=async(e,t)=>{const n=await E(e,t);if(n)return g[n.id]=n,n};let y=[];const b=10;e.direction&&"up"!==e.direction||await l.promisePoolAsync(b,r,(async function(e){const t=j(e);try{if(!e.cloudCurrent)if(e.isDeleted){if("succeeded"!==(await m(e,null)).status)throw new Error(`Failed to save deleted ${t} to the cloud.`)}else{const n=f[e.id];if(n){const r=await m(e,e.cloudVersion);if("conflict"===r.status)await _(e,n);else if("succeeded"!==r.status)throw new Error(`Failed to save ${t} to the cloud.`)}else if("succeeded"!==(await m(e,null)).status)throw pxt.tickEvent("identity.sync.failed.localNewProjectSyncUpFailed"),new Error(`Failed to save new ${t} to the cloud.`)}}catch(e){y.push(e)}})),e.direction&&"down"!==e.direction||await l.promisePoolAsync(b,u,(async function(e){if(null==e?void 0:e.id)try{const t=j(e),n=s.getHeader(e.id);if(n){if(n.cloudVersion!==e.cloudVersion)if(n.cloudCurrent){if(!await v(n,e))throw new Error(`Failed to download cloud project ${t}`)}else await _(n,e)}else if(!e.isDeleted&&!await v(n,e))throw new Error(`Failed to import new cloud project ${t}`)}catch(e){y.push(e)}})),y.forEach((e=>pxt.debug(e))),y=[];const S=l.nowSeconds()-a;return pxt.tickEvent("identity.sync.finished",{elapsed:S,provider:pxt.auth.identityProviderId(null===(t=pxt.auth.cachedUserState)||void 0===t?void 0:t.profile)}),o.invalidate("headers:"),l.values(g)}catch(e){pxt.reportException(e),pxt.tickEvent("identity.sync.failed",{exception:e})}return[]}(e).then((e=>e)).finally((()=>{y=void 0}))),y):[]}async function x(e,t){const n=await s.getTextAsync(e.id);s.acquireHeaderSession(e);const r=await function(e,t,n){return new Promise((async(r,o)=>{var s;const a=v(e.id);try{pxt.debug(`uploading to cloud: ${j(e)}`);const c=null===(s=i.userProfile())||void 0===s?void 0:s.id;e.cloudUserId=c,e.cloudCurrent=!1,e.cloudVersion=t,a.syncInProgress();const u={id:e.id,header:JSON.stringify(p(e)),text:n?JSON.stringify(n):void 0,version:t},d=await i.apiAsync("/api/user/project",u);d.success?(e.cloudCurrent=!0,e.cloudVersion=d.resp,e.cloudLastSyncTime=l.nowSeconds(),pxt.tickEvent("identity.cloudApi.setProject.success"),r({header:e,status:"succeeded"})):409===d.statusCode?(pxt.tickEvent("identity.cloudApi.setProject.conflict"),r({header:e,status:"conflict"})):(pxt.tickEvent("identity.cloudApi.setProject.failed"),o(d.err))}finally{a.syncFinished()}}))}(e,t,n);return"succeeded"===r.status?(await s.saveAsync(e,null,!0),r.header=s.getHeader(e.id)):pxt.tickEvent("identity.toCloud.failed"),r}async function E(e,t){if(e){const n=Object.assign(Object.assign({},e),t);s.acquireHeaderSession(e);const r=await f(e);return await s.saveAsync(n,r.text,!0),s.getHeader(n.id)}if(t){const e=Object.assign({},t);s.acquireHeaderSession(t);const n=await f(t);return await s.importAsync(e,n.text,!0),s.getHeader(e.id)}pxt.tickEvent("identity.fromCloud.failed")}async function _(e,t){var n;pxt.debug(`cloud conflict detected for ${j(e)}`);const i=function(e){return e.name+lf(" - Copy")}(e);let o=await s.duplicateAsync(e,i);pxt.tickEvent("identity.sync.conflict.createdDuplicate");let l=!1;try{if(a.hasEditor()){const t=await a.getEditorAsync();t.state.home||(null===(n=t.state.header)||void 0===n?void 0:n.id)!==e.id||await t.loadHeaderAsync(o,t.state.editorState,!1)}}catch(e){pxt.reportException(e),pxt.tickEvent("identity.sync.conflict.reloadEditorFailed",{exception:e}),l=!0}try{e=await E(e,t)}catch(e){throw pxt.reportException(e),pxt.tickEvent("identity.sync.conflict.overwriteLocalFailed",{exception:e}),pxt.tickEvent("identity.sync.conflict.failed"),e}try{r.dialogAsync({header:lf("Project '{0}' had a conflict!",e.name),body:lf("Project '{0}' was edited in two places and the changes conflict. The changes on this computer have been saved to '{1}'. The changes made elsewhere remain in '{2}'.",e.name,o.name,e.name),disagreeLbl:lf("Got it!"),disagreeClass:"green",hasCloseIcon:!1})}catch(e){pxt.reportException(e),l=!0}l?pxt.tickEvent("identity.sync.conflict.failed"):pxt.tickEvent("identity.sync.conflict.success")}function w(e){var t;const n=null===(t=i.userProfile())||void 0===t?void 0:t.id;return(e||s.getHeaders(!0,!1)).filter((e=>e.cloudUserId&&e.cloudUserId===n))}n.getCloudTempMetadata=v,n.syncAsync=b,n.forceReloadForCloudSync=function(){r.infoNotification(lf("Cloud synchronization finished. Reloading... ")),setTimeout((()=>{pxt.debug("cloud forcing reload."),pxt.tickEvent("identity.sync.forcingReload"),location.reload()}),3e3)},n.convertCloudToLocal=async function(e){if(e){const t=s.getHeaders(!1,!1,e).filter((t=>t.cloudUserId&&t.cloudUserId===e)),n=[];t.forEach((e=>{e=h(e),n.push(s.forceSaveAsync(e,null,!0))})),await Promise.all(n)}},n.saveLocalProjectsToCloudAsync=async function(e){const t=s.getHeaders().filter((e=>null==e.cloudUserId)).filter((t=>e.includes(t.id)));if(t.length){const e={},n=[];for(const r of t){const t=await s.duplicateAsync(r,r.name);e[r.id]=t.id,n.push(t)}return await b({hdrs:n,direction:"up"}),e}},n.requestProjectCloudStatus=async function(e){for(const t of e){const e=v(t),n=e.cloudStatus(),r={type:"pxteditor",action:"projectcloudstatus",headerId:e.headerId,status:n.value};pxt.editor.postHostMessageAsync(r)}};let S={},T=0,k=0;const C={subscriptions:[],onDataChanged:e=>{const t=e.split("header:");l.assert(2===t.length,"onHeaderChangeSubscriber has invalid path subscription: "+e);const n=t[1];if("*"===n)w().forEach((e=>A(e)));else{const e=s.getHeader(n);e?A(e):pxt.debug("cannot find header with id: "+n)}}};async function A(e){var t;if(!i.hasIdentity())return;if(!i.loggedIn())return;if(e.cloudUserId!==(null===(t=i.userProfile())||void 0===t?void 0:t.id)||e.cloudCurrent)return;if(s.isHeaderSessionOutdated(e))return;S[e.id]=!0,clearTimeout(T);const n=async()=>{k=0,await async function(){try{await y}catch(e){y=void 0}const e=w().filter((e=>S[e.id]));S={},b({hdrs:e,direction:"up"})}()};k||(k=l.now()),15e3<l.now()-k?await n():T=setTimeout(n,3e3)}function j(e){return`'${e.name}' (${e.id.substr(0,5)}...)`}function I(e){return"*"==(e=o.stripProtocol(e))?s.getHeaders().map((e=>v(e.id))):v(e)}n.HEADER_CLOUDSTATE="header-cloudstate",n.init=function(){o.mountVirtualApi(n.HEADER_CLOUDSTATE,{getSync:I}),o.subscribe(C,"header:*")}},{"./app":44,"./auth":48,"./core":133,"./data":136,"./workspace":208}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.loginCheck=n.syncAsync=n.refreshToken=n.resetAsync=n.ensureGitHubTokenAsync=n.githubProvider=n.reconstructMeta=n.ProviderBase=n.setOauth=n.OAUTH_REMEMBER_STATE=n.OAUTH_HASH=n.OAUTH_REDIRECT=n.OAUTH_STATE=n.OAUTH_TYPE=void 0;const r=e("./core"),i=e("./data");var o=pxt.Util;const s=o.lf;let a,l;function c(e){const t=new Error(e);return t.isUserError=!0,t.isSyncError=!0,t}n.OAUTH_TYPE="oauthType",n.OAUTH_STATE="oauthState",n.OAUTH_REDIRECT="oauthRedirect",n.OAUTH_HASH="oauthHash",n.OAUTH_REMEMBER_STATE="oauthRememberState";const u="token",d="tokenExp",p="AutoLogin",h="cloudUser";function f(e,t,r,i){const o=ts.pxtc.Util.guidGen();return pxt.storage.setLocal(n.OAUTH_TYPE,e),pxt.storage.setLocal(n.OAUTH_STATE,o),pxt.storage.setLocal(n.OAUTH_REDIRECT,r||window.location.hash),pxt.storage.setLocal(n.OAUTH_HASH,i),t?pxt.storage.setLocal(n.OAUTH_REMEMBER_STATE,o):pxt.storage.removeLocal(n.OAUTH_REMEMBER_STATE),o}function g(){pxt.storage.removeLocal(n.OAUTH_TYPE),pxt.storage.removeLocal(n.OAUTH_STATE),pxt.storage.removeLocal(n.OAUTH_REDIRECT),pxt.storage.removeLocal(n.OAUTH_HASH),pxt.storage.removeLocal(n.OAUTH_REMEMBER_STATE)}n.setOauth=f;n.ProviderBase=class{constructor(e,t,n,r){this.name=e,this.friendlyName=t,this.icon=n,this.urlRoot=r,this._token=pxt.storage.getLocal(this.name+u)}syncError(e){throw c(e)}user(){return pxt.Util.jsonTryParse(pxt.storage.getLocal(this.name+h))}setUser(e){e?pxt.storage.setLocal(this.name+h,JSON.stringify(e)):pxt.storage.removeLocal(this.name+h),i.invalidate("sync:user"),i.invalidate("github:user")}token(){if(!this.hasTokenExpired())return this._token}reqAsync(e){const t=this.token();if(!t)throw this.pleaseLogin();return e.headers||(e.headers={}),e.headers.Authorization="Bearer "+t,/^https:\/\//.test(e.url)||(e.url=this.urlRoot+e.url),e.allowHttpErrors=!0,o.requestAsync(e)}getJsonAsync(e){return this.reqAsync({url:e}).then((t=>{if(t.statusCode<300)return t.json;throw this.syncError(s("Invalid {0} response {1} at {2}",this.friendlyName,t.statusCode,e))}))}fileSuffix(){return".mkcd-"+pxt.appTarget.id}createFileNameWithSuffix(e){return e.replace(/[~"#%&*:<>?/\\{|}]+/g,"_")+this.fileSuffix()}parseTime(e){return Math.round(new Date(e).getTime()/1e3)}pleaseLogin(){let e=s("Please log in to {0}",this.friendlyName);r.infoNotification(e);let t=c(e);return t.isLoginError=!0,t}loginCheck(){if(this.token())if(this.hasTokenExpired()){if(pxt.storage.getLocal(this.name+p))return void this.pleaseLogin();pxt.storage.setLocal(this.name+p,"yes"),this.loginAsync(void 0,!0).then((e=>e&&this.setNewToken(e.accessToken,e.rememberMe,e.expiresIn)))}else(e=this)!==l&&(l=e,b());var e}loginAsync(e,t){return o.userError("Not implemented"),Promise.resolve(void 0)}loginInner(){const e=this.name;r.showLoading(e+"login",s("Signing you in to {0}...",this.friendlyName));const t=f(e,!1),n=pxt.appTarget.cloud&&pxt.appTarget.cloud.cloudProviders&&pxt.appTarget.cloud.cloudProviders[this.name],i=window.location.protocol+"//"+window.location.host+"/oauth-redirect",o={client_id:n.client_id,response_type:"token",state:t,redirect_uri:i,scope:"",expires_in:86400};return n.redirect&&(o.redirect=n.redirect),o}loginCompleteInner(){const e=this.name;r.hideLoading(e+"login")}loginCallback(e,t){const n=this.name;pxt.storage.removeLocal(n+p),this.setNewToken(t.access_token,e,parseInt(t.expires_in)),this.setUser(void 0)}setNewToken(e,t,n){const r=this.name,i=r+u,o=r+d;if(this._token=e,!t)return pxt.debug("token storage non-opted in"),pxt.storage.removeLocal(i),void pxt.storage.removeLocal(o);if(e)if(pxt.storage.setLocal(i,e),n){let e=Math.round(Date.now()/1e3+.75*n);pxt.storage.setLocal(o,e+"")}else pxt.storage.removeLocal(o);else pxt.storage.removeLocal(i),pxt.storage.removeLocal(o);b()}hasTokenExpired(){const e=parseInt(pxt.storage.getLocal(this.name+d)||"0");return!(!e||e<o.nowSeconds())}logout(){pxt.storage.removeLocal(this.name+u),pxt.storage.removeLocal(this.name+d),pxt.storage.removeLocal(this.name+p),this._token=void 0,this.setUser(void 0),b()}},n.reconstructMeta=function(e){let t=JSON.parse(e[pxt.CONFIG_NAME]),n={meta:{cloudId:pxt.CLOUD_ID+pxt.appTarget.id,editor:pxt.BLOCKS_PROJECT_NAME,name:t.name},source:JSON.stringify(e)},r=JSON.parse(e[".cloudheader.json"]||"{}");return r&&(r.editor&&(n.meta.editor=r.editor),r.target&&(n.meta.cloudId=pxt.CLOUD_ID+r.target),r.targetVersion&&(n.meta.targetVersions={target:r.targetVersion})),n};const m=e("./githubprovider");function v(){if(!a){a={};const e=pxt.appTarget.cloud;if(e&&e.githubPackages){const e=new m.GithubProvider;a[e.name]=e}}return pxt.Util.values(a)}function y(e){const t=v().filter((e=>e.name==m.PROVIDER_NAME))[0];return!t&&e&&o.userError(s("GitHub not configured in this editor.")),t}function b(){i.invalidate("sync:status"),i.invalidate("sync:user"),i.invalidate("sync:loggedin"),i.invalidate("sync:provider"),i.invalidate("sync:providericon"),i.invalidate("github:user")}n.githubProvider=y,n.ensureGitHubTokenAsync=async function(){await y(!0).loginAsync(),pxt.github.token||o.userError(s("Please sign in to GitHub to perform this operation."))},n.resetAsync=function(){const e=y(),t=e&&e.hasToken();return l&&l.logout(),l=null,pxt.storage.removeLocal("cloudId"),g(),b(),t&&e.logout(),Promise.resolve()},n.refreshToken=function(){l&&l.loginAsync(void 0,!0)},n.syncAsync=function(){return function(){const e=y();return e?function(e){return e?e.user()?Promise.resolve():e.getUserInfoAsync().then((t=>t?(t.initials||(t.initials=o.initials(t.name)),e.setUser(t),null):Promise.resolve())):Promise.resolve()}(e):Promise.resolve()}().then((()=>{}))},n.loginCheck=function(){const e=v();if(e.length){{const t=o.parseQueryString(pxt.storage.getLocal(n.OAUTH_HASH)||"");if(t.access_token){const r=pxt.storage.getLocal(n.OAUTH_TYPE),i=e.filter((e=>e.name==r))[0];if(i){pxt.storage.removeLocal(n.OAUTH_HASH);const e=t.state===pxt.storage.getLocal(n.OAUTH_REMEMBER_STATE);i.loginCallback(e,t)}g()}}{const t=o.parseQueryString((location.hash||"#").slice(1).replace(/%23access_token/,"access_token"));if(t.access_token){const r=pxt.storage.getLocal(n.OAUTH_STATE),i=pxt.storage.getLocal(n.OAUTH_TYPE);if(r&&r==t.state){pxt.storage.removeLocal(n.OAUTH_STATE),pxt.storage.removeLocal(n.OAUTH_TYPE);const r=t.state===pxt.storage.getLocal(n.OAUTH_REMEMBER_STATE),o=e.filter((e=>e.name==i))[0];if(o){o.loginCallback(r,t);const e=pxt.storage.getLocal(n.OAUTH_REDIRECT)||"";location.hash=e}}g()}}for(const t of e)t.loginCheck()}},i.mountVirtualApi("sync",{getSync:function(e){const t=l;switch(i.stripProtocol(e)){case"user":return t&&t.user();case"loggedin":return!!t;case"status":return"";case"provider":return t&&t.name;case"providericon":return t?t.icon:"user"}return null}}),i.mountVirtualApi("github",{getSync:function(e){const t=y();switch(i.stripProtocol(e)){case"user":return t&&t.user()}return null}}),i.mountVirtualApi("ping",{getAsync:function(e){const t=i.stripProtocol(e);if(/\.ico$/.test(e)){const e=pxt.BrowserUtils.isEdge()?t:`${t}?v=${Math.random()}&origin=${encodeURIComponent(window.location.origin)}`,n=document.createElement("img");return new Promise(((t,r)=>{n.onload=()=>t(!0),n.onerror=()=>t(!1),n.src=e}))}return pxt.Util.requestAsync({url:t,method:"GET",allowHttpErrors:!0}).then((e=>200===e.statusCode||403==e.statusCode||400==e.statusCode)).catch((e=>!1))},expirationTime:e=>864e5,isOffline:()=>!pxt.Cloud.isOnline()})},{"./core":133,"./data":136,"./githubprovider":154}],56:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.showUnsupportedHardwareMessageAsync=n.handleServiceWorkerMessageAsync=n.disconnectAsync=n.showDisconnectAsync=n.pairAsync=n.maybeReconnectAsync=n.initAsync=n.setExtensionResult=n.hidDeployCoreAsync=n.nativeHostLongpressAsync=n.nativeHostBackAsync=n.isNativeHost=n.nativeHostPostMessageFunction=n.browserDownloadDeployCoreAsync=void 0;const r=e("./core"),i=e("./electron"),o=e("./package"),s=e("./hidbridge"),a=e("./webusb"),l=e("./data"),c=e("./dialogs");var u=pxt.Cloud;const d=e("./dialogs");function p(e){pxt.debug(`cmds: ${e}`)}let h;function f(e,t,n){return pxt.BrowserUtils.browserDownloadBinText(e,t,{contentType:n,onError:e=>r.errorNotification(lf("saving file failed..."))}),Promise.resolve()}function g(e){let t="";const n=pxt.outputName().replace(/[^.]*/,""),i=e.outfiles[pxt.outputName()],s=o.genFileName(n),a=pxt.BrowserUtils.isBrowserDownloadWithinUserContext();return a?t=pxt.BrowserUtils.toDownloadDataUri(pxt.isOutputText()?ts.pxtc.encodeBase64(i):i,pxt.appTarget.compile.hexMimeType):pxt.isOutputText()?(p("saving "+s),t=pxt.BrowserUtils.browserDownloadBinText(i,s,{contentType:pxt.appTarget.compile.hexMimeType,userContextWindow:e.userContextWindow,onError:e=>r.errorNotification(lf("saving file failed...")),maintainObjectURL:!0})):(p("saving "+s),t=pxt.BrowserUtils.browserDownloadBase64(i,s,{contentType:"application/x-uf2",userContextWindow:e.userContextWindow,onError:e=>r.errorNotification(lf("saving file failed...")),maintainObjectURL:!0})),e.success?!a&&pxt.BrowserUtils.isBrowserDownloadInSameWindow()||!e.saveOnly&&(0,d.isDontShowDownloadDialogFlagSet)()?Promise.resolve().then((()=>{var e;return null===(e=window.URL)||void 0===e?void 0:e.revokeObjectURL(t)})):pxt.commands.showUploadInstructionsAsync(s,t,r.confirmAsync,e.saveOnly).then((()=>{var e;return null===(e=window.URL)||void 0===e?void 0:e.revokeObjectURL(t)})):Promise.resolve()}function m(e,t,n,i){var o,s;const a=pxt.appTarget.appTheme.boardName||lf("device"),l=pxt.appTarget.appTheme.driveDisplayName||pxt.appTarget.compile.driveName||"???",c=pxt.BrowserUtils.isBrowserDownloadWithinUserContext(),u=!pxt.BrowserUtils.isIE()&&!pxt.BrowserUtils.isEdge(),d=pxt.appTarget.appTheme.usbDocs,p=pxt.BrowserUtils.hasSaveAs(),h=pxt.appTarget.compile.useUF2?".uf2":".hex",f=(pxt.usb.isEnabled&&(null===(s=null===(o=pxt.appTarget)||void 0===o?void 0:o.compile)||void 0===s||s.webUSB),!c&&!p&&pxt.commands.renderBrowserDownloadInstructions&&pxt.commands.renderBrowserDownloadInstructions(i)),g=c?lf("Click 'Download' to open the {0} app.",pxt.appTarget.appTheme.boardName):p?lf("Click 'Save As' and save the {0} file to the {1} drive to transfer the code into your {2}.",h,l,a):!f&&lf("Move the {0} file to the {1} drive to transfer the code into your {2}.",h,l,a),m=pxt.BrowserUtils.isBrowserDownloadWithinUserContext()?0:1e4;return n({header:c?lf("Download ready..."):lf("Download completed..."),body:g,jsx:f,hasCloseIcon:!0,hideAgree:!0,helpUrl:d,bigHelpButton:!0,className:"downloaddialog",buttons:[u&&{label:c?lf("Download"):lf("Download again"),className:c?"primary":"lightgrey",urlButton:!0,url:t,fileName:e},{label:lf("Done"),className:"primary",onclick:()=>{pxt.tickEvent("downloaddialog.done"),r.hideDialog()}}],timeout:m}).then((()=>{}))}function v(){const e=window.webkit;if(e&&e.messageHandlers&&e.messageHandlers.host&&e.messageHandlers.host.postMessage)return t=>e.messageHandlers.host.postMessage(t);const t=window.android;return t&&t.postMessage?e=>t.postMessage(JSON.stringify(e)):void 0}function y(){return!!v()}function b(e){p("native deploy"),r.infoNotification(lf("Flashing device..."));const t=e.outfiles[pxt.outputName()];return v()({name:e.downloadFileBaseName,download:t}),Promise.resolve()}function x(e){p("native save"),r.infoNotification(lf("Saving file..."));const t=e.outfiles[pxt.outputName()];return v()({name:e.downloadFileBaseName,save:t}),Promise.resolve()}function E(){p("native workspace loaded");const e=v();return e&&e({cmd:"workspaceloaded"}),Promise.resolve()}function _(e,t){if(pxt.tickEvent("hid.deploy"),p("hid deploy"),!e.success)return p("compilation failed, use browser deploy instead"),g(e);const n="hiddeploy";return D=!0,pxt.Util.promiseTimeout(12e4,pxt.packetio.initAsync(!1).then((t=>r.showLoadingAsync(n,lf("Downloading..."),t.reflashAsync(e).then((()=>t.reconnectAsync())),5e3))).finally((()=>r.hideLoading(n)))).catch((n=>{if("repairbootloader"===n.type)return(p("pair bootloader"),k()).then((()=>_(e)));if("timeout"===n.message)pxt.tickEvent("hid.flash.timeout"),p("flash timeout");else{if("devicenotfound"===n.type)return pxt.tickEvent("hid.flash.devicenotfound"),p("device not found"),pxt.commands.saveOnlyAsync(e);if(19==n.code||"devicelocked"===n.type)return pxt.tickEvent("hid.flash.devicelocked"),p("error: device locked"),pxt.commands.saveOnlyAsync(e);pxt.tickEvent("hid.flash.error"),p(`hid error ${n.message}`),pxt.reportException(n),t&&t.reportError(n.message)}return pxt.commands.saveOnlyAsync(e)})).finally((()=>{D=!1}))}function w(e){return p("local deploy"),r.infoNotification(lf("Uploading...")),pxt.Util.requestAsync({url:"/api/deploy",headers:{Authorization:u.localToken},method:"POST",data:e,allowHttpErrors:!0}).then((e=>{200!==e.statusCode?r.errorNotification(lf("There was a problem, please try again")):0===e.json.boardCount&&r.warningNotification(lf("Please connect your {0} to your computer and try again",pxt.appTarget.appTheme.boardName))}))}function S(){const e=h;e&&(e.mkPacketIOWrapper&&(p("extension mkPacketIOWrapper"),pxt.packetio.mkPacketIOWrapper=e.mkPacketIOWrapper),e.deployAsync&&(p("extension deploy core async"),pxt.commands.deployCoreAsync=e.deployAsync),e.saveOnlyAsync&&(p("extension save only async"),pxt.commands.saveOnlyAsync=e.saveOnlyAsync),e.saveProjectAsync&&(p("extension save project async"),pxt.commands.saveProjectAsync=e.saveProjectAsync),e.renderBrowserDownloadInstructions?(p("extension upload renderBrowserDownloadInstructions"),pxt.commands.renderBrowserDownloadInstructions=e.renderBrowserDownloadInstructions):pxt.commands.renderBrowserDownloadInstructions=c.renderBrowserDownloadInstructions,e.renderUsbPairDialog&&(p("extension renderUsbPairDialog"),pxt.commands.renderUsbPairDialog=e.renderUsbPairDialog),e.renderIncompatibleHardwareDialog?(p("extension renderIncompatibleHardwareDialog"),pxt.commands.renderIncompatibleHardwareDialog=e.renderIncompatibleHardwareDialog):pxt.commands.renderIncompatibleHardwareDialog=c.renderIncompatibleHardwareDialog,e.showUploadInstructionsAsync&&(p("extension upload instructions async"),pxt.commands.showUploadInstructionsAsync=e.showUploadInstructionsAsync),e.patchCompileResultAsync&&(p("extension build patch"),pxt.commands.patchCompileResultAsync=e.patchCompileResultAsync),e.blocklyPatch&&(p("extension blockly patch"),pxt.blocks.extensionBlocklyPatch=e.blocklyPatch),e.webUsbPairDialogAsync&&(p("extension webusb pair dialog"),pxt.commands.webUsbPairDialogAsync=e.webUsbPairDialogAsync),e.onTutorialCompleted&&(p("extension tutorial completed"),pxt.commands.onTutorialCompleted=e.onTutorialCompleted),e.showProgramTooLargeErrorAsync&&(p("extension showProgramTooLargeErrorAsync"),pxt.commands.showProgramTooLargeErrorAsync=e.showProgramTooLargeErrorAsync))}function T(e=!1,t=!1){return p("[CLIENT]: starting reconnect"),t&&pxt.packetio.isConnected()&&!M?Promise.resolve():N||(N=async function(){var e;if(P)return;return j?Promise.reject("Already waiting for packet lock"):await async function(){if(void 0!==R)return R;const e=new Promise((e=>{O=e,L({type:"serviceworkerclient",action:"packet-io-supported"})}));try{await pxt.U.promiseTimeout(1e3,e),R=!0}catch(e){p("[CLIENT]: old version of service worker, ignoring lock"),R=!1}return R}()&&(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)?new Promise(((e,t)=>{j=e,I=t,p("[CLIENT]: requesting lock "+A),L({type:"serviceworkerclient",action:"request-packet-io-lock",lock:A})})).finally((()=>{j=void 0,I=void 0})):void 0}().then((()=>pxt.packetio.initAsync())).then((t=>t?t.reconnectAsync().catch((t=>{if("devicenotfound"==t.type)return e&&k();throw t})):Promise.resolve())).finally((()=>{N=void 0})))}function k(e){return pxt.tickEvent("cmds.pair"),pxt.commands.webUsbPairDialogAsync(pxt.usb.pairAsync,r.confirmAsync,e).then((e=>{switch(e){case pxt.commands.WebUSBPairResult.Success:return T();case pxt.commands.WebUSBPairResult.Failed:return r.infoNotification("Oops, no device was paired.");case pxt.commands.WebUSBPairResult.UserRejected:return}}))}function C(){return p("[CLIENT]: starting disconnect"),M=!0,pxt.packetio.disconnectAsync().then((()=>{p("[CLIENT]: sending confirmed disconnect "+A),P=!1,L({type:"serviceworkerclient",action:"release-packet-io-lock",lock:A}),M=!1}))}n.browserDownloadDeployCoreAsync=g,n.nativeHostPostMessageFunction=v,n.isNativeHost=y,n.nativeHostBackAsync=function(){p("native back");const e=v();return e&&e({cmd:"backtap"}),Promise.resolve()},n.nativeHostLongpressAsync=function(){p("native longpress");const e=v();return e&&e({cmd:"backpress"}),Promise.resolve()},n.hidDeployCoreAsync=_,n.setExtensionResult=function(e){h=e,S()},n.initAsync=async function e(){var t,n,r,o,l,c,d,h,v,T,k,C,A,j;p("cmds init"),pxt.onAppTargetChanged=()=>{p("app target changed"),e()},await pxt.usb.checkAvailableAsync(),await pxt.packetio.disconnectAsync(),pxt.packetio.mkPacketIOWrapper=void 0,pxt.commands.renderDisconnectDialog=void 0,pxt.commands.deployCoreAsync=g,pxt.commands.browserDownloadAsync=f,pxt.commands.saveOnlyAsync=g,pxt.commands.webUsbPairDialogAsync=a.webUsbPairDialogAsync,pxt.commands.showUploadInstructionsAsync=m,pxt.packetio.mkPacketIOAsync=void 0,(null===(n=null===(t=pxt.appTarget)||void 0===t?void 0:t.compile)||void 0===n?void 0:n.useUF2)&&(p("hf2 wrapper"),pxt.packetio.mkPacketIOWrapper=pxt.HF2.mkHF2PacketIOWrapper),((null===(o=null===(r=pxt.appTarget)||void 0===r?void 0:r.compile)||void 0===o?void 0:o.isNative)||(null===(c=null===(l=pxt.appTarget)||void 0===l?void 0:l.compile)||void 0===c?void 0:c.hasHex))&&!pxt.BrowserUtils.isPxtElectron()&&(pxt.usb.isAvailable()&&(null===(h=null===(d=pxt.appTarget)||void 0===d?void 0:d.compile)||void 0===h?void 0:h.webUSB)?(p("enabled webusb"),pxt.usb.setEnabled(!0),pxt.packetio.mkPacketIOAsync=pxt.usb.mkWebUSBHIDPacketIOAsync):(null===(T=null===(v=pxt.appTarget)||void 0===v?void 0:v.compile)||void 0===T?void 0:T.disableHIDBridge)||(p("enabled hid bridge (webusb disabled)"),pxt.usb.setEnabled(!1),pxt.packetio.mkPacketIOAsync=s.mkHIDBridgePacketIOAsync));const I=/force(Hex)?(Browser)?Download/i.test(window.location.href),O=pxt.usb.isEnabled&&(null===(C=null===(k=pxt.appTarget)||void 0===k?void 0:k.compile)||void 0===C?void 0:C.webUSB);I||(null===(j=null===(A=pxt.appTarget)||void 0===A?void 0:A.serial)||void 0===j?void 0:j.noDeploy)?p("deploy: force browser download"):y()?(p("deploy: webkit deploy/save"),pxt.commands.deployCoreAsync=b,pxt.commands.saveOnlyAsync=x,pxt.commands.workspaceLoadedAsync=E):pxt.BrowserUtils.isPxtElectron()?(p("deploy: electron"),pxt.commands.deployCoreAsync=i.driveDeployAsync,pxt.commands.electronDeployAsync=i.driveDeployAsync):O?(p("deploy: webusb"),pxt.commands.deployCoreAsync=_,pxt.commands.renderDisconnectDialog=a.renderUnpairDialog):s.shouldUse()?(p("deploy: hid"),pxt.commands.deployCoreAsync=_):pxt.BrowserUtils.isLocalHost()&&u.localToken?(p("deploy: localhost"),pxt.commands.deployCoreAsync=w):p("deploy: browser only"),S()},n.maybeReconnectAsync=T,n.pairAsync=k,n.showDisconnectAsync=function(){if(pxt.commands.renderDisconnectDialog){const{header:e,jsx:t,helpUrl:n}=pxt.commands.renderDisconnectDialog();return r.dialogAsync({header:e,jsx:t,helpUrl:n,hasCloseIcon:!0})}return Promise.resolve()},n.disconnectAsync=C;const A=pxtc.Util.guidGen();let j,I,O,N,R,P=!1,D=!1,M=!1;function L(e){var t;(null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)&&navigator.serviceWorker.controller.postMessage(e)}n.handleServiceWorkerMessageAsync=async function(e){"packet-io-lock-disconnect"!==e.action||j||A!==e.lock?"packet-io-lock-granted"===e.action&&e.lock===A&&j?(e.granted?(p("[CLIENT]: received granted lock "+A),j(),P=!0):(p("[CLIENT]: received denied lock "+A),I()),j=void 0,I=void 0):"packet-io-supported"===e.action&&O?(O(),R=!0,O=void 0):"packet-io-status"===e.action&&L({type:"serviceworkerclient",action:"packet-io-status",hasLock:P,lock:A}):(p("[CLIENT]: received disconnect request "+A),D||pxt.packetio.isConnecting()?L({type:"serviceworkerclient",action:"packet-io-lock-disconnect",lock:A,didDisconnect:!1}):await C())},n.showUnsupportedHardwareMessageAsync=function(e){var t;if(!pxt.packetio.isConnected())return!0;const n=pxt.packetio.unsupportedParts(),i=pxtc.computeUsedParts(e);let o=[];for(const e of n)if(-1!==i.indexOf(e)){o.push(e);break}if(o.length){const e=pxt.commands.renderIncompatibleHardwareDialog(o);pxt.tickEvent("unsupportedhardwaredialog.shown");const n=null===(t=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===t?void 0:t.incompatibleHardwareHelpURL;let i=!0;return r.confirmAsync({header:lf("Incompatible Code"),jsx:e,hasCloseIcon:!0,hideAgree:!0,helpUrl:n,bigHelpButton:!0,className:"downloaddialog",buttons:[{label:lf("Download Anyway"),className:"primary",onclick:()=>{pxt.tickEvent("unsupportedhardwaredialog.downloadagain"),i=!1,r.hideDialog()}}]}).then((()=>(i&&pxt.tickEvent("unsupportedhardwaredialog.cancelled"),!i)))}return Promise.resolve(!0)},l.mountVirtualApi("packetio",{getSync:function(e){switch(l.stripProtocol(e)){case"active":return pxt.packetio.isActive();case"connected":return pxt.packetio.isConnected();case"connecting":return pxt.packetio.isConnecting();case"icon":return pxt.packetio.icon()}return!1}})},{"./core":133,"./data":136,"./dialogs":143,"./electron":146,"./hidbridge":158,"./package":179,"./webusb":207}],57:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CodeCardView=void 0;const r=e("react/jsx-runtime"),i=e("./sui"),o=e("./data"),s=e("./cloud"),a=e("./util");pxt.Util.repeatMap;class l extends o.Component{constructor(e){super(e),this.state={}}static setupIntersectionObserver(){this.observer||(this.observer=new IntersectionObserver((e=>{e.forEach((e=>{e.intersectionRatio>0&&(this.observer.unobserve(e.target),(e=>{const t=e.getAttribute("data-src");e.style.backgroundImage=`url(${t})`})(e.target))}))}),{rootMargin:"50px 0px",threshold:.01}))}componentDidMount(){const e=this.refs.lazyimage;if(e)if("IntersectionObserver"in window)l.setupIntersectionObserver(),l.observer.observe(e);else{const t=e.getAttribute("data-src");e.style.backgroundImage=`url(${t})`}}renderCore(){var e;const t=this.props;let n=t.color||"";const o=e=>e.replace(/`/g,""),l=t.url?/^[^:]+:\/\//.test(t.url)?t.url:"/"+t.url.replace(/^\.?\/?/,""):void 0,c=t.className,u=t.cardType,d=t.tutorialLength==t.tutorialStep+1,p=t&&t.description&&t.description.split("\n"),h=t.onClick?e=>{e.target&&"A"==e.target.tagName||(pxt.setInteractiveConsent(!0),t.onClick(e))}:void 0,f=t.imageUrl||(t.youTubeId?`https://img.youtube.com/vi/${t.youTubeId}/0.jpg`:void 0),g=t.projectId?this.getData(`header:${t.projectId}`):null,m=g?g.name:t.name,v=t.projectId?this.getData(`${s.HEADER_CLOUDSTATE}:${t.projectId}`):null,y=null==v?void 0:v.cloudStatus(),b=y?Math.min(g.cloudLastSyncTime,g.modificationTime):t.time,x=y&&("synced"===y.value||"justSynced"===y.value||"localEdits"===y.value),E=t.ariaLabel||t.title||t.shortName||m,_=t.style||"card",w=(0,r.jsxs)("div",Object.assign({className:`ui ${_} ${n} ${t.onClick?"link":""} ${c||""}`,role:t.role,"aria-selected":"option"===t.role?"true":void 0,"aria-label":E,title:t.title,onClick:h,tabIndex:t.onClick?t.tabIndex||0:null,onKeyDown:t.onClick?a.fireClickOnEnter:null},{children:[t.header?(0,r.jsx)("div",Object.assign({className:"ui content "+(t.responsive?" tall desktop only":"")},{children:t.header}),"header"):null,t.label||t.labelIcon||t.blocksXml||t.typeScript||f||"file"==u?(0,r.jsxs)("div",Object.assign({className:"ui image"},{children:[t.label||t.labelIcon?(0,r.jsx)("label",Object.assign({role:t.onLabelClicked?"button":void 0,onClick:t.onLabelClicked,className:`ui ${t.labelClass?t.labelClass:"orange right ribbon"} label`,"aria-label":`${E} ${t.onLabelClicked?"button":"label"}`},{children:t.labelIcon?(0,r.jsx)(i.Icon,{icon:t.labelIcon}):t.label})):void 0,t.typeScript?(0,r.jsx)("pre",{children:t.typeScript},"promots"):void 0,"file"!=t.cardType&&f?(0,r.jsx)("div",Object.assign({className:"ui imagewrapper","aria-hidden":!0,role:"presentation"},{children:(0,r.jsx)("div",{className:"ui cardimage","data-src":f,ref:"lazyimage","aria-hidden":!0,role:"presentation"})})):void 0,"file"!=t.cardType||f?void 0:(0,r.jsx)("div",{className:"ui fileimage"}),"file"==t.cardType&&f?(0,r.jsx)("div",{className:"ui fileimage","data-src":f,ref:"lazyimage"}):void 0]})):void 0,t.icon||t.iconContent?(0,r.jsx)("div",Object.assign({className:"ui imagewrapper","aria-hidden":!0,role:"presentation"},{children:(0,r.jsxs)("div",Object.assign({className:`ui button massive fluid ${t.iconColor} ${t.iconContent?"iconcontent":""}`,"aria-hidden":!0,role:"presentation"},{children:[t.icon?(0,r.jsx)(i.Icon,{icon:""+("icon "+t.icon)}):void 0,t.iconContent||void 0]}))})):void 0,t.shortName||m||p?(0,r.jsxs)("div",Object.assign({className:"content "+(this.props.tallCard?"tall":"")},{children:[t.shortName||m?(0,r.jsxs)("div",Object.assign({className:"header"},{children:[t.shortName||m,(0,r.jsx)("div",Object.assign({className:"tags"},{children:null===(e=t.tags)||void 0===e?void 0:e.join(" ")}))]})):null,p&&p.map(((e,n)=>(0,r.jsx)("div",Object.assign({className:"description tall "+(t.icon||t.iconContent||t.imageUrl?"":"long")},{children:o(e)}),`line${n}`)))]})):void 0,t.time?(0,r.jsxs)("div",Object.assign({className:"meta"},{children:[t.tutorialLength?(0,r.jsxs)("span",Object.assign({className:`ui tutorial-progress ${d?"green":"orange"} left floated label`},{children:[(0,r.jsx)("i",{className:(d?"trophy":"circle")+" icon"}),"",lf("{0}/{1}",(t.tutorialStep||0)+1,t.tutorialLength)]})):void 0,!y&&t.time&&(0,r.jsx)("span",Object.assign({className:"date"},{children:pxt.Util.timeSince(t.time)}),"date"),y&&x&&(0,r.jsxs)("span",Object.assign({className:"date "+(t.tutorialLength?"small-screen hide":"")},{children:[pxt.Util.timeSince(b),y.indicator]}),"date"),y&&!x&&(0,r.jsx)("span",Object.assign({className:"date"},{children:y.indicator}),"date"),y&&(0,r.jsx)("i",{className:"ui large right floated icon cloud"})]})):void 0,t.extracontent||t.learnMoreUrl||t.buyUrl||t.feedbackUrl?(0,r.jsxs)("div",Object.assign({className:"ui extra content mobile hide"},{children:[t.extracontent,t.buyUrl?(0,r.jsx)("a",Object.assign({className:"learnmore left floated",href:t.buyUrl,"aria-label":lf("Buy"),target:"_blank",rel:"noopener noreferrer"},{children:lf("Buy")})):void 0,t.learnMoreUrl?(0,r.jsx)("a",Object.assign({className:"learnmore right floated",href:t.learnMoreUrl,tabIndex:0,"aria-label":lf("Learn more"),target:"_blank",rel:"noopener noreferrer"},{children:lf("Learn more")})):void 0,t.feedbackUrl?(0,r.jsx)("a",Object.assign({className:"learnmore right floated",href:t.feedbackUrl,"aria-label":lf("Feedback"),target:"_blank",rel:"noopener noreferrer"},{children:lf("Feedback")})):void 0]})):void 0]}));return!t.onClick&&l?(0,r.jsx)("a",Object.assign({href:l},{children:w})):w}}n.CodeCardView=l},{"./cloud":54,"./data":136,"./sui":200,"./util":206,"react/jsx-runtime":367}],58:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.clearApiInfoDbAsync=n.getPackagesWithErrors=n.clearCaches=n.newProjectAsync=n.updatePackagesAsync=n.applyUpgradesAsync=n.getBlocksAsync=n.getApisInfoAsync=n.typecheckAsync=n.snippetAsync=n.formatAsync=n.projectSearchClear=n.projectSearchAsync=n.apiSearchAsync=n.refreshLanguageServiceApisInfo=n.workerOpAsync=n.decompilePySnippetstoXmlAsync=n.decompileSnippetstoXmlAsync=n.decompilePythonSnippetAsync=n.pyDecompileAsync=n.pySnippetToBlocksAsync=n.decompileBlocksSnippetAsync=n.decompileAsync=n.syntaxInfoAsync=n.completionsAsync=n.py2tsAsync=n.assembleAsync=n.compileAsync=n.emptyCompileResult=n.emptyProgram=void 0;const r=e("./package"),i=e("./core"),o=e("./workspace");var s=pxt.Util;function a(e,t,n){let i=r.mainEditorPkg();i.forEachFile((e=>e.diagnostics=[]));let o,a="";if(t.length>0&&i.files[pxt.MAIN_TS]&&i.files[pxt.MAIN_PY]&&n){const e=i.files[pxt.MAIN_TS].content,t=i.files[pxt.MAIN_PY].content;o=pxtc.BuildSourceMapHelpers(n,e,t).ts.locToLoc}for(let e of t){if(e.fileName){a+=`${e.category==ts.pxtc.DiagnosticCategory.Error?lf("error"):e.category==ts.pxtc.DiagnosticCategory.Warning?lf("warning"):lf("message")}: ${e.fileName}(${e.line+1},${e.column+1}): `;let t=i.filterFiles((t=>t.getTextFileName()==e.fileName))[0];if(t&&(t.diagnostics.push(e),o&&e.fileName===pxt.MAIN_TS)){let t=o(e);if(t){let n=Object.assign(Object.assign({},e),t);i.files[pxt.MAIN_PY].diagnostics.push(n)}}}a+=`${ts.pxtc.DiagnosticCategory[e.category].toLowerCase()} TS${e.code}: ${ts.pxtc.flattenDiagnosticMessageText(e.messageText,"\n")}\n`}a&&pxt.log(a),a||(a=s.lf("Everything seems fine!\n"));let l=i.outputPkg.setFile("output.txt",a);const u=t.filter((e=>e.category==ts.pxtc.DiagnosticCategory.Error));l.numDiagnosticsOverride=u.length,c(u),pxt.editor.shouldPostHostMessages()&&pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspacediagnostics",operation:e,output:a,diagnostics:t.map((e=>({code:e.code,category:ts.pxtc.DiagnosticCategory[e.category].toLowerCase(),fileName:e.fileName,start:e.start,length:e.length,line:e.line,column:e.column,endLine:e.endLine,endColumn:e.endColumn})))})}let l="";function c(e){if(e&&e.length){const t={};e.filter((e=>e.code)).forEach((e=>t[e.code]=(t[e.code]||0)+1));const n=JSON.stringify(e);if(n!==l){for(const e of Object.keys(t))pxt.tickEvent("diagnostics",{errorCode:e,count:t[e]});l=n}}else l=""}let u,d,p,h=new Promise((()=>{}));function f(e){return t=>t.isUserError?(i.errorNotification(t.message),r.mainEditorPkg().outputPkg.setFile("output.txt",t.message).numDiagnosticsOverride=1,e):Promise.reject(t)}function g(e){return E("assemble",{fileContent:e})}function m(e){return E("compile",{options:e})}function v(e,t,n){const i=r.mainPkg.getTargetOptions();return r.mainPkg.getCompileOptionsAsync(i).then((t=>(t.fileSystem[pxt.MAIN_TS]=e,t.fileSystem[pxt.MAIN_BLOCKS]="",t.snippetMode=n&&n.snippetMode||!1,t.generateSourceMap=null==n?void 0:n.generateSourceMap,-1===t.sourceFiles.indexOf(pxt.MAIN_TS)&&t.sourceFiles.push(pxt.MAIN_TS),-1===t.sourceFiles.indexOf(pxt.MAIN_BLOCKS)&&t.sourceFiles.push(pxt.MAIN_BLOCKS),t.ast=!0,y(t,pxt.MAIN_TS))))}function y(e,t){return E("decompile",{options:e,fileName:t})}function b(e,t){return E("pydecompile",{options:e,fileName:t})}function x(e){const t=r.mainPkg.getTargetOptions();return r.mainPkg.getCompileOptionsAsync(t).then((t=>(t.sourceTexts=e,t.snippetMode=!1,-1===t.sourceFiles.indexOf(pxt.MAIN_TS)&&t.sourceFiles.push(pxt.MAIN_TS),-1===t.sourceFiles.indexOf(pxt.MAIN_BLOCKS)&&t.sourceFiles.push(pxt.MAIN_BLOCKS),t.ast=!0,function(e){return E("decompileSnippets",{options:e})}(t))))}function E(e,t){const n=Date.now();return pxt.debug("worker op: "+e),pxt.worker.getWorker(pxt.webConfig.workerjs).opAsync(e,t).then((t=>(pxt.appTarget.compile.switches.time&&(pxt.log(`Worker perf: ${e} ${Date.now()-n}ms`),t.times&&console.log(t.times)),pxt.debug("worker op done: "+e),t)))}n.emptyProgram="(function (ectx) {\n'use strict';\nectx.runtime.setupPerfCounters([]);\nectx.setupDebugger(1)\nreturn function (s) {\n    // START\n    ectx.runtime.kill()\n    return ectx.leave(s, s.r0)\n}\n})\n",n.emptyCompileResult=function(){return{success:!0,diagnostics:[],times:{},breakpoints:[],outfiles:{"binary.js":n.emptyProgram.replace("// START",pxt.appTarget.simulator.emptyRunCode||"")}}},n.compileAsync=function(e={}){let t=r.mainPkg.getTargetOptions();return t.isNative=e.native,r.mainEditorPkg().buildAssetsAsync().then((()=>r.mainPkg.getCompileOptionsAsync(t))).then((t=>(e.debug&&(t.breakpoints=!0,t.justMyCode=!e.debugExtensionCode,t.testMode=!0),e.trace&&(t.breakpoints=!0,t.justMyCode=!0,t.trace=!0),t.computeUsedSymbols=!0,t.computeUsedParts=!0,e.forceEmit&&(t.forceEmit=!0),/test=1/i.test(window.location.href)&&(t.testMode=!0),t))).then(m).then((t=>{let n=r.mainEditorPkg().outputPkg;for(const e of Object.keys(n.files))e.endsWith(".asm")&&!t.outfiles[e]&&(t.outfiles[e]=n.files[e].content);if(e.jsMetaVersion&&t.outfiles[pxtc.BINARY_JS]){const n={simUrl:pxt.webConfig.simUrl.replace(/\/[^\-]*---simulator/,`/v${pxt.appTarget.versions.target}/---simulator`),cdnUrl:pxt.webConfig.cdnUrl,version:e.jsMetaVersion,target:pxt.appTarget.id,targetVersion:pxt.appTarget.versions.target},i=r.mainPkg.readGitJson();i&&(n.repo=pxt.github.parseRepoId(i.repo).fullName),t.outfiles[pxtc.BINARY_JS]=`// meta=${JSON.stringify(n)}\n${t.outfiles[pxtc.BINARY_JS]}`}return r.mainEditorPkg().outputPkg.setFiles(t.outfiles),a("compile",t.diagnostics),S().then((()=>{if(!t.usedSymbols||!d)return t;for(let e of Object.keys(t.usedSymbols))t.usedSymbols[e]=s.lookup(d.byQName,e);return t}))})).catch(f(h))},n.assembleAsync=function(e){return g(`.startaddr 536887040\n${e}`).then((t=>g(`.startaddr ${536887296-4*(t.words.length+1)}\n${e}`).then((e=>(s.assert(e.words.length==t.words.length),e)))))},n.py2tsAsync=function(e=!1){let t=r.mainPkg.getTargetOptions();return w().then((()=>r.mainPkg.getCompileOptionsAsync(t))).then((e=>(e.target.preferredEditor=pxt.PYTHON_PROJECT_NAME,E("py2ts",{options:e}))))},n.completionsAsync=function(e,t,n,r,i,o){return E("getCompletions",{fileName:e,fileContent:i,position:t,wordStartPos:n,wordEndPos:r,light:o,runtime:pxt.appTarget.runtime})},n.syntaxInfoAsync=function(e,t,n,r){return E("syntaxInfo",{fileName:t,fileContent:r,position:n,infoType:e})},n.decompileAsync=function(e,t,n,i){let o=r.mainPkg.getTargetOptions();return r.mainPkg.getCompileOptionsAsync(o).then((t=>(t.ast=!0,t.testMode=!0,t.alwaysDecompileOnStart=pxt.appTarget.runtime&&pxt.appTarget.runtime.onStartUnDeletable,y(t,e)))).then((e=>{if(e.success&&t&&n&&i){const r=pxt.blocks.layout.patchBlocksFromOldWorkspace(t,n,e.outfiles[i]);e.outfiles[i]=r}return r.mainEditorPkg().outputPkg.setFiles(e.outfiles),a("decompile",e.diagnostics),e}))},n.decompileBlocksSnippetAsync=v,n.pySnippetToBlocksAsync=function(e,t){let n=r.mainPkg.getTargetOptions();return w().then((()=>r.mainPkg.getCompileOptionsAsync(n))).then((t=>(t.fileSystem[pxt.MAIN_PY]=e,t.fileSystem[pxt.MAIN_BLOCKS]="",-1===t.sourceFiles.indexOf(pxt.MAIN_PY)&&t.sourceFiles.push(pxt.MAIN_PY),-1===t.sourceFiles.indexOf(pxt.MAIN_BLOCKS)&&t.sourceFiles.push(pxt.MAIN_BLOCKS),E("py2ts",{options:t})))).then((e=>v(e.outfiles[pxt.MAIN_TS])))},n.pyDecompileAsync=function(e){let t=r.mainPkg.getTargetOptions();return r.mainPkg.getCompileOptionsAsync(t).then((t=>(t.ast=!0,t.testMode=!0,t.alwaysDecompileOnStart=pxt.appTarget.runtime&&pxt.appTarget.runtime.onStartUnDeletable,b(t,e)))).then((e=>(r.mainEditorPkg().outputPkg.setFiles(e.outfiles),c(e.diagnostics.filter((e=>e.category==ts.pxtc.DiagnosticCategory.Error))),e)))},n.decompilePythonSnippetAsync=function(e){let t=r.mainPkg.getTargetOptions();return r.mainPkg.getCompileOptionsAsync(t).then((t=>(t.fileSystem[pxt.MAIN_TS]=e,t.fileSystem[pxt.MAIN_PY]="",-1===t.sourceFiles.indexOf(pxt.MAIN_TS)&&t.sourceFiles.push(pxt.MAIN_TS),-1===t.sourceFiles.indexOf(pxt.MAIN_PY)&&t.sourceFiles.push(pxt.MAIN_PY),t.ast=!0,b(t,pxt.MAIN_TS)))).then((e=>e.outfiles[pxt.MAIN_PY]))},n.decompileSnippetstoXmlAsync=x,n.decompilePySnippetstoXmlAsync=function(e){const t=/^\s*namespace\s+[^\s]+\s*{([\S\s]*)}\s*$/im,n=/^\s*export\s(let\s*[\S\s]*)\s*$/im,i=/^\s*export\s(function\s*[\S\s]*)\s*$/im,o=r.mainPkg.getTargetOptions();let s=[];return w().then((()=>r.mainPkg.getCompileOptionsAsync(o))).then((t=>{for(let n=0;n<e.length;n++){const r=`snippet_${n}`;t.fileSystem[r+".py"]=e[n],t.sourceFiles.push(r+".py"),s.push(r)}return t.fileSystem[pxt.MAIN_BLOCKS]="",-1===t.sourceFiles.indexOf(pxt.MAIN_BLOCKS)&&t.sourceFiles.push(pxt.MAIN_BLOCKS),E("py2ts",{options:t})})).then((e=>{const r=[];for(let o of s){let s=e.outfiles[o+".ts"].match(t);if(s&&s[1]){let e=s[1].split("\n").map((e=>{const t=e.match(n),r=t?t[1]:e,o=r.match(i);return o?o[1]:r}));r.push(e.join("\n"))}}return x(r)}))},n.workerOpAsync=E;let _=!1;function w(){return u||k()}function S(){return _||!d?E("apiInfo",{}).then((e=>{if(0!==Object.keys(e).length)return _=!1,ts.pxtc.localizeApisAsync(e,r.mainPkg)})).then((e=>{d=e})):Promise.resolve()}function T(){_=!0}function k(){const e=r.mainEditorPkg(),t=!u;let n=e.buildAssetsAsync().then((()=>r.mainPkg.getCompileOptionsAsync())).then((e=>(e.testMode=!0,E("setOptions",{options:e})))).then((()=>E("allDiags",{}))).then((e=>a("typecheck",e.diagnostics,e.sourceMap))).then((()=>(t&&T(),S()))).catch(f(null));return t&&(u=n),n}function C(){return w().then((()=>d))}function A(){if(!p){const e=r.mainPkg.resolveBannedCategories();return async function(e,t){if(!t)return null;const n="libs/"+pxt.appTarget.corepkg,i=t[n];if(!i)return null;const o=e.getAllFiles(),a=[pxt.MAIN_TS,pxt.TUTORIAL_CODE_START,pxt.TUTORIAL_CODE_STOP,pxt.TILEMAP_CODE,pxt.IMAGES_CODE];if(Object.keys(o).some((e=>-1===a.indexOf(e)&&-1===e.indexOf("/")&&pxt.Util.endsWith(e,".ts"))))return null;const l=pxt.appTarget.bundleddirs.map((e=>{const t=pxt.appTarget.bundledpkgs[e.substr(e.lastIndexOf("/")+1)];return t?{dirname:e,files:t,config:JSON.parse(t[pxt.CONFIG_NAME])}:null})).filter((e=>e&&e.config)),c=e.pkgAndDeps(),u=[],d=[{dirname:n,info:i}];for(const e of c){if("built"===e.id||e.isTopLevel())continue;let n=!1;for(const r of l)if(r.config.name===B(e)){d.push({dirname:r.dirname,info:t[r.dirname]}),n=!0;break}n||u.push(e)}if(u.length){let t;try{t=await F.createAsync()}catch(e){return console.log("Unable to open API info cache DB"),null}for(const e of u){const n=await t.getAsync(e);if(!n)return pxt.debug(`Could not find cached API info for ${B(e)}, waiting for full compile`),null;pxt.debug(`Fetched cached API info for ${B(e)}`),d.push({dirname:e.getPkgId(),info:n})}}const p={byQName:{}};for(const e of d){if(!e)continue;let{info:t,dirname:n}=e;const r=s.cloneApis(t.apis.byQName);for(const e of Object.keys(r))r[e].pkg=n,delete r[e].attributes._translatedLanguageCode,p.byQName[e]=r[e]}p.jres=r.mainPkg.getJRes()||{};for(const e of Object.keys(p.byQName)){let t=p.byQName[e],n=t.attributes.jres;if(n){"true"==n&&(n=e);let r=s.lookup(p.jres,n);r&&r.icon&&!t.attributes.iconURL&&(t.attributes.iconURL=r.icon),r&&r.data&&!t.attributes.jresURL&&(t.attributes.jresURL="data:"+r.mimeType+";base64,"+r.data)}}return p}(r.mainEditorPkg(),pxt.getBundledApiInfo()).then((t=>t?ts.pxtc.localizeApisAsync(t,r.mainPkg).then((t=>p=pxtc.getBlocksInfo(t,e))):C().then((e=>{const t=r.mainPkg.resolveBannedCategories();return p=pxtc.getBlocksInfo(e,t),async function(e,t){var n;const r=pxt.Package.corePackages().map((e=>e.name)),i=e.pkgAndDeps().filter((e=>"built"!==e.id&&!e.isTopLevel()&&-1===r.indexOf(e.getPkgId())));if(i.length){const r=Object.keys(t.byQName);let o;try{o=await F.createAsync()}catch(e){return void pxt.log("Unable to create DB to cache API info")}for(const e of i){const i=e.getPkgId(),s={sha:null,apis:{byQName:{}}};for(const e of r){const r=t.byQName[e];(r.pkg===i||(null===(n=r.pkgs)||void 0===n?void 0:n.find((e=>e===i))))&&(s.apis.byQName[e]=j(r))}await o.setAsync(e,s),pxt.debug(`Stored API info for ${B(e)}`)}}}(r.mainEditorPkg(),e)})).then((()=>p))))}return Promise.resolve(p)}function j(e){const t=s.clone(e);delete t.pkgs;const n=s.clone(t.attributes);delete n._translatedLanguageCode;let r=!1;return n._untranslatedBlock&&(n.block=n._untranslatedBlock,delete n._untranslatedBlock,r=!0),n._untranslatedJsDoc&&(n.jsDoc=n._untranslatedJsDoc,delete n._untranslatedJsDoc,r=!0),r&&ts.pxtc.updateBlockDef(n),t.attributes=n,t}function I(){const e=r.mainPkg,t=r.getEditorPkg(e),n=t.header.targetVersion,i=t.files[pxt.MAIN_BLOCKS]?t.files[pxt.MAIN_BLOCKS].content:`<block type="${ts.pxtc.ON_START_TYPE}"></block>`;let o,s={};return pxt.debug("Applying upgrades to blocks"),pxt.BrowserUtils.loadBlocklyAsync().then((()=>A())).then((e=>{o=new Blockly.Workspace;const t=pxt.blocks.importXml(n,i,e,!0),r=Blockly.Xml.textToDom(t);pxt.blocks.domToWorkspaceNoEvents(r,o),pxtblockly.upgradeTilemapsInWorkspace(o,pxt.react.getTilemapProject());const a=Blockly.Xml.workspaceToDom(o);return s[pxt.MAIN_BLOCKS]=Blockly.Xml.domToText(a),pxt.blocks.compileAsync(o,e)})).then((e=>(s[pxt.MAIN_TS]=e.source,t.buildAssetsAsync()))).then((()=>{const e=t.getAllFiles(),n=Object.keys(e).filter((e=>!/^main\.(blocks|ts|py)$/.test(e)));for(const t of n)s[t]=e[t];return N(s)})).then((()=>({success:!0,editor:pxt.BLOCKS_PROJECT_NAME,patchedFiles:s}))).catch((()=>(pxt.debug("Block upgrade failed, falling back to TS"),O())))}function O(){const e=r.mainPkg,t=r.getEditorPkg(e),n=t.header.targetVersion,i={};return pxt.Util.values(t.files).filter(R).forEach((e=>{const t=pxt.patching.patchJavaScript(n,e.content);t!=e.content&&(i[e.name]=t)})),pxt.debug("Applying upgrades to TypeScript"),N(i).then((()=>({success:!0,editor:pxt.JAVASCRIPT_PROJECT_NAME,patchedFiles:i}))).catch((e=>({success:!1,errorCodes:e.errorCodes})))}function N(e){const t=r.mainPkg;return r.mainEditorPkg().buildAssetsAsync().then((()=>t.getCompileOptionsAsync())).then((t=>(e&&Object.keys(e).forEach((n=>{e[n]&&(t.fileSystem[n]=e[n])})),m(t)))).then((e=>{if(!e.success){const t={};e.diagnostics&&e.diagnostics.forEach((e=>{const n="TS"+e.code;t[n]=(t[n]||0)+1}));const n=new Error("Compile failed on updated package");return n.errorCodes=t,Promise.reject(n)}return Promise.resolve()}))}function R(e){return pxt.Util.endsWith(e.getName(),".ts")}function P(){return D(),E("reset",{})}function D(){u=null,d=null,p=null}function M(){const e=r.mainPkg.resolveBannedCategories();if(e)return{bannedCategories:e}}function L(e){const t=JSON.stringify(e.getAllFiles())+pxt.appTarget.versions.pxt+"_"+pxt.appTarget.versions.target;return pxtc.U.sha256(t)}function B(e){const t=e.getKsPkg(),n=t._verspec;return pxt.github.isGithubId(n)?/^([^#]+)/.exec(n)[1]:t.config.name}n.refreshLanguageServiceApisInfo=T,n.apiSearchAsync=async function(e){return await w(),await S(),e.localizedApis=d,e.localizedStrings=pxt.Util.getLocalizedStrings(),E("apiSearch",{search:e,blocks:M()})},n.projectSearchAsync=function(e){return S().then((()=>E("projectSearch",{projectSearch:e})))},n.projectSearchClear=function(){return S().then((()=>E("projectSearchClear",{})))},n.formatAsync=function(e,t){return E("format",{format:{input:e,pos:t}})},n.snippetAsync=function(e,t){let n=Promise.resolve();return t&&(n=k().then((()=>{}))),n.then((()=>E("snippet",{snippet:{qName:e,python:t},runtime:pxt.appTarget.runtime}))).then((e=>e))},n.typecheckAsync=k,n.getApisInfoAsync=C,n.getBlocksAsync=A,n.applyUpgradesAsync=function(){const e=r.mainPkg,t=r.getEditorPkg(e),n=pxt.semver.parse(t.header.targetVersion||"0.0.0"),i=pxt.semver.parse(pxt.appTarget.versions.target);if(0===pxt.semver.cmp(n,i))return pxt.debug("Skipping project upgrade"),Promise.resolve({success:!0});const o=t.header.editor!==pxt.BLOCKS_PROJECT_NAME?O:I;let s=!1;return N().catch((()=>s=!0)).then(o).then((e=>e.success?(pxt.tickEvent("upgrade.success",{projectEditor:t.header.editor,upgradedEditor:e.editor,preUpgradeVersion:t.header.targetVersion||"unknown",projectNeverCompiled:""+s}),pxt.debug("Upgrade successful!"),function(e,t,n){return Object.keys(t).forEach((n=>e.setFile(n,t[n]))),e.header.targetVersion=pxt.appTarget.versions.target,e.header.editor=n,e.saveFilesAsync()}(t,e.patchedFiles,e.editor).then((()=>e))):(pxt.tickEvent("upgrade.failed",{projectEditor:t.header.editor,preUpgradeVersion:t.header.targetVersion||"unknown",errors:JSON.stringify(e.errorCodes),projectNeverCompiled:""+s}),pxt.debug("Upgrade failed; bailing out and leaving project as-is"),Promise.resolve(e))))},n.updatePackagesAsync=function(e,t){const n=r.mainEditorPkg();let i,a=0;return t&&t.startOperation(),o.getTextAsync(n.header.id).then((e=>o.makeBackupAsync(n.header,e))).then((e=>(i=e,n.header.backupRef=i.id,o.saveAsync(n.header)))).then((()=>s.promiseMapAllSeries(e,(r=>(t&&t.throwIfCancelled(),n.updateDepAsync(r.getPkgId()).then((()=>{++a,t&&!t.isCancelled()&&t.reportProgress(a,e.length)}))))))).then((()=>r.loadPkgAsync(n.header.id))).then((()=>P())).then((()=>N())).then((()=>(t&&t.throwIfCancelled(),delete n.header.backupRef,o.saveAsync(n.header)))).then((()=>!0)).catch((()=>o.restoreFromBackupAsync(n.header).then((()=>!1)))).finally((()=>{let e=Promise.resolve();return i&&(i.isDeleted=!0,e=o.forceSaveAsync(i)),e.finally((()=>{t&&t.resolveCancel()}))}))},n.newProjectAsync=P,n.clearCaches=D,n.getPackagesWithErrors=function(){const e={},t=r.mainEditorPkg();if(t){const n=pxt.Package.corePackages().map((e=>e.name));t.forEachFile((t=>{t.diagnostics&&t.diagnostics.length&&t.epkg&&-1===n.indexOf(t.epkg.getPkgId())&&!t.epkg.isTopLevel()&&t.diagnostics.some((e=>e.category===ts.pxtc.DiagnosticCategory.Error))&&(e[t.epkg.getPkgId()]=t.epkg)}))}return pxt.Util.values(e)};class F{constructor(e){this.db=e}static dbName(){return`__pxt_apis_${pxt.appTarget.id||""}`}static createAsync(){function e(){const e=new pxt.BrowserUtils.IDBWrapper(F.dbName(),2,((e,t)=>{t.result.createObjectStore(F.TABLE,{keyPath:F.KEYPATH})}),(()=>{pxt.BrowserUtils.IDBWrapper.deleteDatabaseAsync(F.dbName())}));return e.openAsync().then((()=>new F(e)))}return e().catch((t=>(console.log("db: failed to open api database, try delete entire store..."),pxt.BrowserUtils.IDBWrapper.deleteDatabaseAsync(F.dbName()).then((()=>e())))))}getAsync(e){const t=B(e),n=L(e);return this.db.getAsync(F.TABLE,t).then((e=>{if(e&&e.hash===n)return e.apis}))}setAsync(e,t){pxt.perf.measureStart("compiler db setAsync");const n={id:B(e),hash:L(e),apis:t};return this.db.setAsync(F.TABLE,n).then((()=>{pxt.perf.measureEnd("compiler db setAsync")}))}clearAsync(){return this.db.deleteAllAsync(F.TABLE).then((()=>console.debug("db: all clean"))).catch((e=>{console.error("db: failed to delete all")}))}}F.TABLE="files",F.KEYPATH="id",n.clearApiInfoDbAsync=function(){return F.createAsync().then((e=>e.clearAsync())).catch((e=>pxt.BrowserUtils.IDBWrapper.deleteDatabaseAsync(F.dbName()).then()))}},{"./core":133,"./package":179,"./workspace":208}],59:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FilterPanel=n.FilterPanelSubheading=n.FilterTag=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../util");class s extends i.Component{constructor(e){super(e),this.clickHandler=this.clickHandler.bind(this)}render(){return(0,r.jsxs)("div",Object.assign({className:"filter-tag"},{children:[(0,r.jsx)("div",Object.assign({className:"filter-tag-box",role:"checkbox",onClick:this.clickHandler,onKeyDown:o.fireClickOnEnter,"aria-checked":this.props.selected},{children:(0,r.jsx)("i",{className:"icon square outline "+(this.props.selected?"check":"")})})),(0,r.jsx)("div",Object.assign({className:"filter-tag-name",role:"button",onClick:this.clickHandler,onKeyDown:o.fireClickOnEnter},{children:pxtc.U.rlf(this.props.tag)}))]}))}clickHandler(){this.props.onClickHandler(this.props.tag)}}n.FilterTag=s;class a extends i.Component{render(){return(0,r.jsxs)("div",Object.assign({className:"filter-subheading-row"},{children:[(0,r.jsx)("div",Object.assign({className:"filter-subheading-title"},{children:`${this.props.subheading}:`})),this.props.buttonText&&(0,r.jsx)("div",Object.assign({className:"filter-subheading-button",role:"button",style:this.props.buttonStyle,onClick:this.props.buttonAction,onKeyDown:o.fireClickOnEnter},{children:this.props.buttonText}))]}))}}n.FilterPanelSubheading=a;class l extends i.Component{isTagSelected(e){return this.props.enabledTags.indexOf(e.toLowerCase())>=0}render(){const e=this.props.tagOptions;return(0,r.jsxs)("div",Object.assign({className:"filter-panel"},{children:[(0,r.jsx)("div",Object.assign({className:"filter-title"},{children:lf("Filter")})),(0,r.jsx)(a,{subheading:lf("Categories"),buttonText:lf("Clear"),buttonAction:this.props.clearTags,buttonStyle:this.props.enabledTags.length>0?{color:"white"}:{}}),(0,r.jsx)("div",Object.assign({className:"filter-tag-list"},{children:e.map((e=>(0,r.jsx)(s,{tag:e,selected:this.isTagSelected(e),onClickHandler:this.props.tagClickHandler},e)))}))]}))}}n.FilterPanel=l},{"../util":206,react:366,"react/jsx-runtime":367}],60:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Alert=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("react-redux"),s=e("./actions/dispatch");class a extends i.Component{constructor(e){super(e)}render(){const{title:e,text:t,options:n,dispatchHideAlert:i}=this.props;return(0,r.jsx)("div",Object.assign({className:"image-editor-alert-container",role:"region",onClick:i},{children:(0,r.jsxs)("div",Object.assign({className:"image-editor-alert",role:"dialog"},{children:[(0,r.jsxs)("div",Object.assign({className:"title"},{children:[(0,r.jsx)("span",{className:"ms-Icon ms-Icon--Warning"}),(0,r.jsx)("span",{children:e}),(0,r.jsx)("span",{className:"ms-Icon ms-Icon--Cancel",role:"button",onClick:i})]})),(0,r.jsx)("div",Object.assign({className:"text"},{children:t})),n&&(0,r.jsx)("div",Object.assign({className:"options"},{children:n.map(((e,t)=>(0,r.jsx)("div",Object.assign({className:"button",role:"button",onClick:e.onClick},{children:e.label}),t)))}))]}))}))}}const l={dispatchHideAlert:s.dispatchHideAlert};n.Alert=(0,o.connect)((function({editor:e},t){return e?t:{}}),l)(a)},{"./actions/dispatch":73,react:366,"react-redux":339,"react/jsx-runtime":367}],61:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BottomBar=n.BottomBarImpl=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("react-redux"),s=e("./actions/dispatch"),a=e("./Button"),l=e("./util"),c=e("../../assets"),u=e("./keyboardShortcuts"),d=e("../../../../react-common/components/util");class p extends i.Component{constructor(e){super(e),this.disableShortcutsOnFocus=()=>{this.setShortcutsEnabled(!1)},this.handleWidthChange=e=>{const t=e.target.value,n=parseInt(t),{aspectRatioLocked:r,imageDimensions:i}=this.props;!isNaN(n)&&r?this.setState({width:n+"",height:Math.floor(n*(i[1]/i[0]))+""}):this.setState({width:t})},this.handleHeightChange=e=>{const t=e.target.value,n=parseInt(t),{aspectRatioLocked:r,imageDimensions:i}=this.props;!isNaN(n)&&r?this.setState({height:n+"",width:Math.floor(n*(i[0]/i[1]))+""}):this.setState({height:t})},this.handleDimensionalBlur=()=>{const{imageDimensions:e,isTilemap:t,dispatchChangeImageDimensions:n}=this.props,r=parseInt(this.state.width),i=parseInt(this.state.height),o=t?255:512,s=isNaN(r)?e[0]:Math.min(Math.max(r,1),o),a=isNaN(i)?e[1]:Math.min(Math.max(i,1),o);s===e[0]&&a===e[1]||n([s,a]),this.setState({width:null,height:null}),this.setShortcutsEnabled(!0)},this.handleDimensionalKeydown=e=>{13===("number"==typeof e.which?e.which:e.keyCode)&&e.currentTarget.blur()},this.handleAssetNameChange=e=>{let t=null;const n=e.target.value||"",r=n.trim();pxt.validateAssetName(r)?(0,c.isNameTaken)(r)&&r!==this.props.assetName&&(t=lf("This name is already used elsewhere in your project")):t=lf("Names may only contain letters, numbers, '-', '_', and space"),this.setState({assetName:n,assetNameMessage:t})},this.handleAssetNameBlur=()=>{const{dispatchChangeAssetName:e,assetName:t}=this.props;if(this.state.assetName){let n=this.state.assetName.trim();n!==t&&pxt.validateAssetName(n)&&!(0,c.isNameTaken)(n)&&e(n)}this.setState({assetName:null,assetNameMessage:null}),this.setShortcutsEnabled(!0)},this.zoomIn=()=>{this.props.dispatchChangeZoom(1)},this.zoomOut=()=>{this.props.dispatchChangeZoom(-1)},this.state={}}render(){const{imageDimensions:e,cursorLocation:t,hasUndo:n,hasRedo:i,dispatchUndoImageEdit:o,dispatchRedoImageEdit:s,aspectRatioLocked:c,onionSkinEnabled:u,dispatchToggleAspectRatioLocked:p,dispatchToggleOnionSkinEnabled:h,resizeDisabled:f,singleFrame:g,onDoneClick:m,assetName:v,hideDoneButton:y}=this.props,{assetNameMessage:b}=this.state,x=null==this.state.width?e[0]:this.state.width,E=null==this.state.height?e[1]:this.state.height,_=null==this.state.assetName?v||"":this.state.assetName;return(0,r.jsxs)("div",Object.assign({className:"image-editor-bottombar"},{children:[!f&&(0,r.jsxs)("div",Object.assign({className:"image-editor-resize"},{children:[(0,r.jsx)("input",{className:"image-editor-input",title:lf("Image Width"),value:x,tabIndex:0,onChange:this.handleWidthChange,onFocus:this.disableShortcutsOnFocus,onBlur:this.handleDimensionalBlur,onKeyDown:this.handleDimensionalKeydown}),(0,r.jsx)(a.IconButton,{onClick:p,iconClass:c?"ms-Icon ms-Icon--Lock":"ms-Icon ms-Icon--Unlock",title:c?lf("Unlock Aspect Ratio"):lf("Lock Aspect Ratio"),toggle:!c,noTab:!0}),(0,r.jsx)("input",{className:"image-editor-input",title:lf("Image Height"),value:E,tabIndex:0,onChange:this.handleHeightChange,onFocus:this.disableShortcutsOnFocus,onBlur:this.handleDimensionalBlur,onKeyDown:this.handleDimensionalKeydown})]})),!g&&(0,r.jsx)("div",{className:"image-editor-seperator"}),!g&&(0,r.jsx)("div",{children:(0,r.jsx)(a.IconButton,{onClick:h,iconClass:"ms-Icon ms-Icon--MapLayers",title:u?lf("Hide Previous Frame"):lf("Show Previous Frame"),toggle:!u})}),!f&&(0,r.jsx)("div",{className:(0,d.classList)("image-editor-seperator",!t&&"transparent")}),(0,r.jsx)("div",Object.assign({className:"image-editor-coordinate-preview"},{children:t&&`${t[0]}, ${t[1]}`})),(0,r.jsxs)("div",Object.assign({className:"image-editor-change-name"},{children:[(0,r.jsx)("input",{className:"image-editor-input",title:lf("Asset Name"),value:_,placeholder:lf("Asset Name"),tabIndex:0,onChange:this.handleAssetNameChange,onFocus:this.disableShortcutsOnFocus,onBlur:this.handleAssetNameBlur,onKeyDown:this.handleDimensionalKeydown}),b&&(0,r.jsx)("div",Object.assign({className:"ui pointing below red basic label"},{children:b}))]})),(0,r.jsxs)("div",Object.assign({className:"image-editor-undo-redo"},{children:[(0,r.jsx)(a.IconButton,{title:lf("Undo"),iconClass:"ms-Icon ms-Icon--Undo",onClick:n?o:null,disabled:!n}),(0,r.jsx)(a.IconButton,{title:lf("Redo"),iconClass:"ms-Icon ms-Icon--Redo",onClick:i?s:null,disabled:!i})]})),(0,r.jsx)("div",{className:"image-editor-seperator"}),(0,r.jsxs)("div",Object.assign({className:"image-editor-zoom-controls"},{children:[(0,r.jsx)(a.IconButton,{onClick:this.zoomOut,iconClass:"ms-Icon ms-Icon--ZoomOut",title:lf("Zoom Out"),toggle:!0}),(0,r.jsx)(a.IconButton,{onClick:this.zoomIn,iconClass:"ms-Icon ms-Icon--ZoomIn",title:lf("Zoom In"),toggle:!0})]})),!y&&(0,r.jsx)("div",Object.assign({role:"button",className:"image-editor-confirm",title:lf("Done"),tabIndex:0,onClick:m,onKeyDown:l.fireClickOnlyOnEnter},{children:lf("Done")}))]}))}setShortcutsEnabled(e){e&&this.shortcutLock?((0,u.releaseShortcutLock)(this.shortcutLock),this.shortcutLock=void 0):e||this.shortcutLock||(this.shortcutLock=(0,u.obtainShortcutLock)())}}n.BottomBarImpl=p;const h={dispatchChangeImageDimensions:s.dispatchChangeImageDimensions,dispatchUndoImageEdit:s.dispatchUndoImageEdit,dispatchRedoImageEdit:s.dispatchRedoImageEdit,dispatchToggleAspectRatioLocked:s.dispatchToggleAspectRatioLocked,dispatchToggleOnionSkinEnabled:s.dispatchToggleOnionSkinEnabled,dispatchChangeZoom:s.dispatchChangeZoom,dispatchChangeAssetName:s.dispatchChangeAssetName};n.BottomBar=(0,o.connect)((function({store:{present:e,past:t,future:n},editor:r},i){var o,s,a;if(!e)return{};const l=r.isTilemap?e.tilemap.bitmap:e.frames[e.currentFrame].bitmap;return{imageDimensions:[l.width,l.height],aspectRatioLocked:e.aspectRatioLocked,onionSkinEnabled:r.onionSkinEnabled,cursorLocation:r.cursorLocation,resizeDisabled:"tile"===(null===(o=e.asset)||void 0===o?void 0:o.type),assetName:null===(a=null===(s=e.asset)||void 0===s?void 0:s.meta)||void 0===a?void 0:a.displayName,hasUndo:!!t.length,hasRedo:!!n.length,isTilemap:r.isTilemap}}),h)(p)},{"../../../../react-common/components/util":41,"../../assets":46,"./Button":62,"./actions/dispatch":73,"./keyboardShortcuts":75,"./util":82,react:366,"react-redux":339,"react/jsx-runtime":367}],62:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.IconButton=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("./util");class s extends i.Component{render(){const{title:e,iconClass:t,onClick:n,toggle:i,disabled:s,noTab:a}=this.props;return(0,r.jsx)("div",Object.assign({role:"button",className:`image-editor-button ${i?"toggle":""} ${s?"disabled":""}`,title:e,tabIndex:a||s?-1:0,onClick:n,onKeyDown:o.fireClickOnlyOnEnter},{children:(0,r.jsx)("span",{className:t})}))}}n.IconButton=s},{"./util":82,react:366,"react/jsx-runtime":367}],63:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CursorSizes=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("./actions/dispatch"),s=e("react-redux");class a extends i.Component{constructor(){super(...arguments),this.handlers=[]}render(){const{selected:e}=this.props;return(0,r.jsxs)("div",Object.assign({className:"cursor-buttons"},{children:[(0,r.jsx)("div",Object.assign({className:"cursor-button-outer "+(1===e?"selected":""),title:lf("Small Cursor (1px)"),role:"button",onClick:this.clickHandler(1)},{children:(0,r.jsx)("div",{className:"cursor-button small"})})),(0,r.jsx)("div",Object.assign({className:"cursor-button-outer "+(3===e?"selected":""),title:lf("Medium Cursor (3px)"),role:"button",onClick:this.clickHandler(3)},{children:(0,r.jsx)("div",{className:"cursor-button medium"})})),(0,r.jsx)("div",Object.assign({className:"cursor-button-outer "+(5===e?"selected":""),title:lf("Large Cursor (5px)"),role:"button",onClick:this.clickHandler(5)},{children:(0,r.jsx)("div",{className:"cursor-button large"})}))]}))}clickHandler(e){return this.handlers[e]||(this.handlers[e]=()=>{const{dispatchChangeCursorSize:t}=this.props;t(e)}),this.handlers[e]}}const l={dispatchChangeCursorSize:o.dispatchChangeCursorSize};n.CursorSizes=(0,s.connect)((function({editor:e},t){return e?{selected:e.cursorSize}:{}}),l)(a)},{"./actions/dispatch":73,react:366,"react-redux":339,"react/jsx-runtime":367}],64:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Dropdown=void 0;const r=e("react/jsx-runtime"),i=e("react");class o extends i.Component{constructor(e){super(e),this.handlers=[],this.handleDropdownClick=()=>{this.setState({open:!this.state.open})},this.state={open:!1}}componentDidUpdate(){this.handlers=[]}componentWillUnmount(){this.handlers=null}render(){const{options:e,selected:t}=this.props,{open:n}=this.state,i=e[t];return(0,r.jsxs)("div",Object.assign({className:"image-editor-dropdown-outer"},{children:[(0,r.jsxs)("button",Object.assign({className:"image-editor-dropdown","aria-haspopup":"listbox",onClick:this.handleDropdownClick,tabIndex:-1},{children:[(null==i?void 0:i.text)||"",(0,r.jsx)("span",{className:"image-editor-dropdown-chevron ms-Icon ms-Icon--ChevronDown"})]})),(0,r.jsx)("ul",Object.assign({tabIndex:-1,role:"listbox","aria-activedescendant":null==i?void 0:i.id,className:n&&e.length?"":"hidden"},{children:e.map(((e,n)=>(0,r.jsx)("li",Object.assign({role:"option","aria-selected":n===t,className:n===t?"selected":"",onClick:this.clickHandler(n)},{children:e.text}),e.id)))}))]}))}clickHandler(e){if(!this.handlers[e]){const{onChange:t,options:n}=this.props;this.handlers[e]=()=>{this.setState({open:!1}),t(n[e],e)}}return this.handlers[e]}}n.Dropdown=o},{react:366,"react/jsx-runtime":367}],65:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ImageCanvas=n.ImageCanvasImpl=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("react-redux"),s=e("./store/imageReducer"),a=e("./actions/dispatch"),l=e("./util"),c=e("./toolDefinitions"),u=e("../../assets"),d=e("./keyboardShortcuts"),p=e("./ImageEditor"),h=[s.TileDrawingMode.Wall];class f extends i.Component{constructor(){super(...arguments),this.cursor=c.ToolCursor.Crosshair,this.zoom=2.5,this.panX=0,this.panY=0,this.hasInteracted=!1,this.tileCache={},this.onKeyDown=e=>{var t,n,r,i,o,a;if((0,d.areShortcutsEnabled)()){if(this.hasInteracted=!0,this.shouldHandleCanvasShortcut()&&(null===(n=null===(t=this.editState)||void 0===t?void 0:t.floating)||void 0===n?void 0:n.image)){let t=!1;switch(e.key){case"ArrowLeft":this.editState.layerOffsetX=Math.max(this.editState.layerOffsetX-1,-this.editState.floating.image.width),t=!0;break;case"ArrowUp":this.editState.layerOffsetY=Math.max(this.editState.layerOffsetY-1,-this.editState.floating.image.height),t=!0;break;case"ArrowRight":this.editState.layerOffsetX=Math.min(this.editState.layerOffsetX+1,this.editState.width),t=!0;break;case"ArrowDown":this.editState.layerOffsetY=Math.min(this.editState.layerOffsetY+1,this.editState.height),t=!0}t&&(this.props.dispatchImageEdit(this.editState.toImageState()),e.preventDefault())}if(!e.repeat){switch(!e.ctrlKey&&!e.metaKey||"c"!==e.key&&"v"!==e.key||e.stopPropagation(),(e.ctrlKey||e.metaKey)&&"a"===e.key&&this.shouldHandleCanvasShortcut()&&(this.selectAll(),e.preventDefault()),"Escape"==e.key&&(null===(i=null===(r=this.editState)||void 0===r?void 0:r.floating)||void 0===i?void 0:i.image)&&this.shouldHandleCanvasShortcut()&&(this.cancelSelection(),e.preventDefault()),("Backspace"===e.key||"Delete"===e.key)&&(null===(a=null===(o=this.editState)||void 0===o?void 0:o.floating)||void 0===a?void 0:a.image)&&this.shouldHandleCanvasShortcut()&&(this.deleteSelection(),e.preventDefault()),this.lastTool=this.props.tool,e.keyCode){case 18:this.props.dispatchChangeImageTool(s.ImageEditorTool.ColorSelect),e.preventDefault();break;case 32:this.props.dispatchChangeImageTool(s.ImageEditorTool.Pan);break;default:this.lastTool=null}this.updateCursor(!1,!1)}}},this.onKeyUp=e=>{null!=this.lastTool&&(this.props.dispatchChangeImageTool(this.lastTool),this.lastTool=null,this.updateCursor(!1,!1))},this.onCopy=e=>{var t,n;if(this.props.tool===s.ImageEditorTool.Marquee&&(null===(n=null===(t=this.editState)||void 0===t?void 0:t.floating)||void 0===n?void 0:n.image))if(e.preventDefault(),this.props.isTilemap)e.clipboardData.setData("application/makecode-tilemap",JSON.stringify((0,l.createTilemapPatchFromFloatingLayer)(this.editState,this.props.tilemapState.tileset)));else{const t=pxt.sprite.bitmapToImageLiteral(this.editState.floating.image,"typescript");e.clipboardData.setData("application/makecode-image",t),e.clipboardData.setData("text/plain",t)}},this.onPaste=e=>{if(this.props.isTilemap){const t=e.clipboardData.getData("application/makecode-tilemap");let n;try{n=JSON.parse(t)}catch(e){}if(!(n&&n.map&&n.layers&&n.tiles))return;return e.preventDefault(),void this.applyTilemapPatch(n)}let t=e.clipboardData.getData("application/makecode-image");if(!t){const n=e.clipboardData.getData("text/plain"),r=/img(`|\(""")[\s\da-f.#tngrpoyw]+(`|"""\))/im.exec(n);r&&(t=r[0])}const n=t&&pxt.sprite.imageLiteralToBitmap(t);n&&n.width&&n.height&&(e.preventDefault(),this.props.tool!==s.ImageEditorTool.Marquee&&this.props.dispatchChangeImageTool(s.ImageEditorTool.Marquee),this.editState.mergeFloatingLayer(),this.editState.setFloatingLayer(n),this.props.dispatchImageEdit(this.editState.toImageState()))},this.preventContextMenu=e=>e.preventDefault()}render(){const e=this.getImageState(),t=!e||e.bitmap.height>e.bitmap.width,n=!this.props.isTilemap&&this.props.tool==s.ImageEditorTool.Marquee;return(0,r.jsx)("div",Object.assign({ref:"canvas-bounds",className:"image-editor-canvas "+(t?"portrait":"landscape"),onContextMenu:this.preventContextMenu,tabIndex:0},{children:(0,r.jsxs)("div",Object.assign({className:"paint-container"},{children:[!this.props.lightMode&&(0,r.jsx)("canvas",{ref:"paint-surface-bg",className:"paint-surface"}),(0,r.jsx)("canvas",{ref:"paint-surface",className:"paint-surface main"}),h.map(((e,t)=>(0,r.jsx)("canvas",{ref:`paint-surface-${e.toString()}`,className:"paint-surface overlay "+(this.props.overlayEnabled?"":"hide")},t))),(0,r.jsx)("div",{ref:"floating-layer-border",className:"image-editor-floating-layer"}),n&&(0,r.jsx)("div",{ref:"floating-layer-nw-corner",className:"image-editor-floating-layer-corner"}),n&&(0,r.jsx)("div",{ref:"floating-layer-ne-corner",className:"image-editor-floating-layer-corner"}),n&&(0,r.jsx)("div",{ref:"floating-layer-se-corner",className:"image-editor-floating-layer-corner"}),n&&(0,r.jsx)("div",{ref:"floating-layer-sw-corner",className:"image-editor-floating-layer-corner"})]}))}))}componentDidMount(){document.activeElement instanceof HTMLElement&&document.activeElement.blur(),this.tileCache={},this.cellWidth=this.props.isTilemap?this.props.tilemapState.tileset.tileWidth:1,this.canvas=this.refs["paint-surface"],this.background=this.refs["paint-surface-bg"],this.floatingLayer=this.refs["floating-layer-border"],this.canvasLayers=h.map((e=>this.refs[`paint-surface-${e.toString()}`])),(0,l.bindGestureEvents)(this.refs["canvas-bounds"],this);const e=this.refs["canvas-bounds"];e.addEventListener("wheel",(e=>{this.hasInteracted=!0,this.updateZoom(e.deltaY/30,e.clientX,e.clientY),e.preventDefault()})),e.addEventListener("mousemove",(e=>{e.button||(this.hasHover=!0),this.edit||this.updateCursorLocation(e)})),e.addEventListener("mouseout",(e=>{this.edit||this.updateCursorLocation(null)})),document.addEventListener("keydown",this.onKeyDown,!0),document.addEventListener("keyup",this.onKeyUp),document.addEventListener("copy",this.onCopy),document.addEventListener("paste",this.onPaste);const t=this.getImageState();this.editState=(0,c.getEditState)(t,this.props.isTilemap,this.props.drawingMode),this.redraw(),this.updateBackground()}componentDidUpdate(){if(!this.edit||!this.editState){const e=this.getImageState();this.editState=(0,c.getEditState)(e,this.props.isTilemap,this.props.drawingMode)}if(this.props.isTilemap||(this.tileCache={}),this.cellWidth=this.props.isTilemap?this.props.tilemapState.tileset.tileWidth:1,this.props.zoomDelta||0===this.props.zoomDelta)return 0===this.props.zoomDelta?this.hasInteracted||this.zoomToCanvas():(this.hasInteracted=!0,this.updateZoom(this.props.zoomDelta)),void this.props.dispatchChangeZoom(null);this.redraw(),this.updateBackground()}componentWillUnmount(){this.tileCache={},document.removeEventListener("keydown",this.onKeyDown,!0),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("copy",this.onCopy),document.removeEventListener("paste",this.onPaste)}onClick(e,t){var n,r;this.hasInteracted=!0,this.isPanning()||(document.activeElement instanceof HTMLElement&&document.activeElement!==this.refs["canvas-bounds"]&&document.activeElement.blur(),this.refs["canvas-bounds"].focus(),this.isColorSelect()?this.selectCanvasColor(e,t):(this.updateCursorLocation(e),this.inBounds(this.cursorLocation[0],this.cursorLocation[1])?(this.touchesResize(e.clientX,e.clientY)&&(this.isResizing=!0),this.startEdit(!!t),this.updateEdit(this.cursorLocation[0],this.cursorLocation[1]),this.commitEdit()):(null===(r=null===(n=this.editState)||void 0===n?void 0:n.floating)||void 0===r?void 0:r.image)&&(this.editState.mergeFloatingLayer(),this.props.dispatchImageEdit(this.editState.toImageState()))))}onDragStart(e,t){this.hasInteracted=!0,this.touchesResize(e.clientX,e.clientY)&&(this.isResizing=!0),this.isPanning()?(this.lastPanX=e.clientX,this.lastPanY=e.clientY,this.updateCursor(!0,!1)):this.isColorSelect()?this.selectCanvasColor(e,t):(this.updateCursorLocation(e),this.startEdit(!!t))}onDragMove(e){if(this.isPanning()&&null!=this.lastPanX&&null!=this.lastPanY)this.panX+=this.lastPanX-e.clientX,this.panY+=this.lastPanY-e.clientY,this.lastPanX=e.clientX,this.lastPanY=e.clientY,this.updateCursor(!0,!1);else{if(!this.edit)return;this.updateCursorLocation(e)&&this.updateEdit(this.cursorLocation[0],this.cursorLocation[1])}}onDragEnd(e){if(this.isPanning()&&null!=this.lastPanX&&null!=this.lastPanY)this.panX+=this.lastPanX-e.clientX,this.panY+=this.lastPanY-e.clientY,this.lastPanX=void 0,this.lastPanY=void 0,this.updateCursor(!1,!1);else if(this.isResizing){if(!this.edit)return;this.updateCursorLocation(e)&&this.updateEdit(this.cursorLocation[0],this.cursorLocation[1]),this.commitEdit(!1),this.updateCursor(!1,!1)}else{if(!this.edit)return;this.updateCursorLocation(e)&&this.updateEdit(this.cursorLocation[0],this.cursorLocation[1]),this.commitEdit()}this.isResizing=!1}updateCursorLocation(e){if(!e)return this.cursorLocation&&(this.cursorLocation=null,this.props.dispatchChangeCursorLocation(null),this.edit||this.redraw()),!1;if(this.canvas){const t=this.canvas.getBoundingClientRect(),n=Math.floor((e.clientX-t.left)/t.width*this.imageWidth),r=Math.floor((e.clientY-t.top)/t.height*this.imageHeight);return!(this.cursorLocation&&n===this.cursorLocation[0]&&r===this.cursorLocation[1]||(this.cursorLocation=[n,r,e.clientX,e.clientY],this.hasHover&&this.props.dispatchChangeCursorLocation(this.cursorLocation),this.edit||this.redraw(),this.updateCursor(!!this.edit,this.editState.inFloatingLayer(n,r)),0))}return this.cursorLocation=[0,0,e.clientX,e.clientY],!1}updateCursor(e,t){const{tool:n}=this.props,r=c.tools.find((e=>e.tool===n));r?t?e?this.updateCursorCore(r.downLayerCursor||r.hoverLayerCursor||r.downCursor||r.hoverCursor):this.updateCursorCore(r.hoverLayerCursor||r.hoverCursor):e?this.updateCursorCore(r.downCursor||r.hoverCursor):this.updateCursorCore(r.hoverCursor):this.updateCursorCore(c.ToolCursor.Default)}updateCursorCore(e){this.cursor=e||c.ToolCursor.Default,this.updateBackground()}startEdit(e){const{tool:t,toolWidth:n,selectedColor:r,backgroundColor:i,drawingMode:o}=this.props,[a,l]=this.cursorLocation;if(this.inBounds(a,l)||this.isResizing){let a=o==s.TileDrawingMode.Wall?2:e?i:r;this.edit=(0,c.getEdit)(t,this.editState,a,n),this.edit.originalImage=this.originalImage,this.edit.start(this.cursorLocation[0],this.cursorLocation[1],this.cursorLocation[2],this.cursorLocation[3],this.editState)}}updateEdit(e,t){this.edit&&(this.edit.inBounds(e,t)||this.isResizing)&&(this.edit.update(e,t),this.redraw())}commitEdit(e=!0){const{dispatchImageEdit:t}=this.props,n=this.getImageState();this.edit&&(this.editState=(0,c.getEditState)(n,this.props.isTilemap,this.props.drawingMode),this.edit.doEdit(this.editState),this.originalImage=e?void 0:this.edit.originalImage,this.edit=void 0,t(this.editState.toImageState()))}redraw(){const{prevFrame:e,onionSkinEnabled:t,selectedColor:n,toolWidth:r,drawingMode:i,tool:o}=this.props,a=this.getImageState(),l=i==s.TileDrawingMode.Wall?2:n;let u=!1;if(this.canvas){if(this.imageWidth=a.bitmap.width,this.imageHeight=a.bitmap.height,u=this.canvas.width!=a.bitmap.width*this.cellWidth||this.canvas.height!=a.bitmap.height*this.cellWidth,this.canvas.width=a.bitmap.width*this.cellWidth,this.canvas.height=a.bitmap.height*this.cellWidth,this.canvasLayers.forEach((e=>{e.width=this.canvas.width/this.cellWidth,e.height=this.canvas.height/this.cellWidth})),t&&e){const t=(0,c.getEditState)(e,this.props.isTilemap,i),n=this.canvas.getContext("2d");n.globalAlpha=.5,this.drawImage(t.image),t.floating&&t.floating.image&&this.drawImage(t.floating.image,t.layerOffsetX,t.layerOffsetY,!0),n.globalAlpha=1}if(this.edit){const n=this.editState.copy();n.setActiveLayer(i),this.edit.doEdit(n),this.drawImage(n.image,0,0,!(!t||!e)),this.drawOverlayLayers(n.overlayLayers),this.redrawFloatingLayer(n)}else if(this.drawImage(this.editState.image,0,0,!(!t||!e)),this.drawOverlayLayers(this.editState.overlayLayers),this.redrawFloatingLayer(this.editState),this.cursorLocation&&this.shouldDrawCursor()){const e=o===s.ImageEditorTool.Erase?0:l;this.drawCursor(this.cursorLocation[0]-(r>>1),this.cursorLocation[1]-(r>>1),r,e)}if(this.background&&(this.background.width!=this.canvas.width<<1||this.background.height!=this.canvas.height<<1)){this.background.width=this.canvas.width<<1,this.background.height=this.canvas.height<<1;const e=this.background.getContext("2d");e.imageSmoothingEnabled=!1,e.fillStyle="#aeaeae",e.fillRect(0,0,this.background.width,this.background.height),e.fillStyle="#dedede";const t=this.imageHeight<<1,n=this.imageWidth<<1;for(let r=0;r<n;r++)for(let n=0;n<t;n++)r+n&1&&e.fillRect(r*this.cellWidth,n*this.cellWidth,this.cellWidth,this.cellWidth)}}u&&this.zoomToCanvas()}drawImage(e,t=0,n=0,r=!1,i=!this.props.lightMode){this.props.isTilemap?this.drawTilemap(e,t,n,r,i):this.drawBitmap(e,t,n,r,i)}redrawFloatingLayer(e,t=!1){const n=this.refs["floating-layer-border"],r=this.refs["floating-layer-nw-corner"],i=this.refs["floating-layer-ne-corner"],o=this.refs["floating-layer-se-corner"],s=this.refs["floating-layer-sw-corner"],a=[r,i,o,s];if(e.floating&&e.floating.image){t||(this.drawImage(e.floating.image,e.layerOffsetX,e.layerOffsetY,!0),e.floating.overlayLayers&&this.drawOverlayLayers(e.floating.overlayLayers,e.layerOffsetX,e.layerOffsetY));const l=this.canvas.getBoundingClientRect(),c=Math.max(e.layerOffsetX,0),u=Math.max(e.layerOffsetY,0),d=Math.min(e.layerOffsetX+e.floating.image.width,e.width),p=Math.min(e.layerOffsetY+e.floating.image.height,e.height),h=l.width/e.width,f=l.height/e.height;n.style.display="",(d-c<1||p-u<1)&&(n.style.display="none");const g=-this.panX+h*c,m=-this.panY+f*u,v=h*(d-c),y=f*(p-u);if(n.style.left=g+"px",n.style.top=m+"px",n.style.width=v+"px",n.style.height=y+"px",n.style.borderLeft=e.layerOffsetX>=0?"":"none",n.style.borderTop=e.layerOffsetY>=0?"":"none",n.style.borderRight=e.layerOffsetX+e.floating.image.width<=e.width?"":"none",n.style.borderBottom=e.layerOffsetY+e.floating.image.height<=e.height?"":"none",null!=r){const e=16,t=3;this.props.isTilemap||(a.forEach((n=>{n.style.display="",n.style.width=e+"px",n.style.height=e+"px",n.style.border=t+"px solid black",n.style.position="absolute",n.style.backgroundColor="white"})),r.style.left=g-e+"px",r.style.top=m-e+"px",r.style.cursor="nw-resize",i.style.left=g+v+"px",i.style.top=m-e+"px",i.style.cursor="ne-resize",o.style.left=g+v+"px",o.style.top=m+y+"px",o.style.cursor="se-resize",s.style.left=g-e+"px",s.style.top=m+y+"px",s.style.cursor="sw-resize")}}else n.style.display="none",a.forEach((e=>{e&&(e.style.display="none")}))}drawOverlayLayers(e,t=0,n=0,r=!this.props.lightMode){e&&e.forEach(((e,i)=>{this.drawBitmap(e,t,n,!0,r,this.canvasLayers[i])}))}drawBitmap(e,t=0,n=0,r=!1,i=!this.props.lightMode,o=this.canvas){const{colors:s}=this.props,a=o.getContext("2d");a.imageSmoothingEnabled=!1;for(let i=0;i<e.width;i++)for(let o=0;o<e.height;o++){const l=e.get(i,o);l?(a.fillStyle=s[l],a.fillRect(i+t,o+n,1,1)):r||a.clearRect(i+t,o+n,1,1)}}generateTile(e,t){if(!t.tiles[e])return null;const n=document.createElement("canvas");return n.width=t.tileWidth,n.height=t.tileWidth,this.drawBitmap(pxt.sprite.Bitmap.fromData(t.tiles[e].bitmap),0,0,!1,!this.props.lightMode,n),this.tileCache[t.tiles[e].id]=n,n}drawTilemap(e,t=0,n=0,r=!1,i=!this.props.lightMode,o=this.canvas){const{tilemapState:{tileset:s}}=this.props,a=o.getContext("2d");let l,c;this.tileCacheRevision!==this.props.tilesetRevision&&(this.tileCache={},this.tileCacheRevision=this.props.tilesetRevision),a.imageSmoothingEnabled=!1,a.fillStyle=p.LIGHT_MODE_TRANSPARENT;for(let o=0;o<e.width;o++)for(let u=0;u<e.height;u++)if((l=e.get(o,u))&&l<s.tiles.length){if((c=this.tileCache[s.tiles[l].id])||(c=this.generateTile(l,s)),!c)continue;a.drawImage(c,(o+t)*this.cellWidth,(u+n)*this.cellWidth)}else r||(i?a.clearRect((o+t)*this.cellWidth,(u+n)*this.cellWidth,this.cellWidth,this.cellWidth):a.fillRect((o+t)*this.cellWidth,(u+n)*this.cellWidth,this.cellWidth,this.cellWidth))}drawCursor(e,t,n,r){const i=this.props.isTilemap&&this.props.drawingMode===s.TileDrawingMode.Wall,o=(i?this.canvasLayers[0]:this.canvas).getContext("2d");if(o.imageSmoothingEnabled=!1,r&&-1!==r)if(this.props.isTilemap&&!i){if(r>=this.props.tilemapState.tileset.tiles.length)return;let i=this.tileCache[this.props.tilemapState.tileset.tiles[r].id];if(i||(i=this.generateTile(r,this.props.tilemapState.tileset)),!i)return;for(let r=0;r<n;r++)for(let s=0;s<n;s++)o.drawImage(i,(e+r)*this.cellWidth,(t+s)*this.cellWidth)}else i?(o.fillStyle=this.props.colors[r],o.fillRect(e,t,1,1)):(o.fillStyle=this.props.colors[r],o.fillRect(e*this.cellWidth,t*this.cellWidth,n*this.cellWidth,n*this.cellWidth));else this.props.lightMode?(o.fillStyle=p.LIGHT_MODE_TRANSPARENT,o.fillRect(e*this.cellWidth,t*this.cellWidth,n*this.cellWidth,n*this.cellWidth)):o.clearRect(e*this.cellWidth,t*this.cellWidth,n*this.cellWidth,n*this.cellWidth)}updateBackground(){this.refs["canvas-bounds"].style.cursor=this.cursor,this.canvas.style.cursor=this.cursor,this.updateZoom(0)}updateZoom(e,t,n){const r=this.refs["canvas-bounds"];if(this.canvas&&r){const i=r.getBoundingClientRect();t=void 0===t?i.left+(i.width>>1):t,n=void 0===n?i.top+(i.height>>1):n;const{canvasX:o,canvasY:s}=this.clientToCanvas(t,n,i);this.zoom=Math.max(this.zoom+e,2.5);const a=this.getCanvasUnit(i);if(a){const{canvasX:e,canvasY:r}=this.clientToCanvas(t,n,i);if(isNaN(e)||isNaN(r)||isNaN(o)||isNaN(s))return;this.panX+=(o-e)*a,this.panY+=(s-r)*a}this.applyZoom()}}getCenteredPan(){let[e,t]=[0,0];const n=this.refs["canvas-bounds"].getBoundingClientRect(),r=this.canvas.getBoundingClientRect();return r.width<n.width&&(e=-((n.width>>1)-(r.width>>1))),r.height<n.height&&(t=-((n.height>>1)-(r.height>>1))),[e,t]}zoomToCanvas(){this.zoom=10;const e=this.refs["canvas-bounds"];this.applyZoom(),this.canvas&&e&&([this.panX,this.panY]=this.getCenteredPan()),this.applyZoom()}applyZoom(e){const t=this.refs["canvas-bounds"];if(this.canvas&&t){e=e||t.getBoundingClientRect();const n=this.getCanvasUnit(e);if(0===n){if(this.waitingToZoom)return;return this.waitingToZoom=!0,void requestAnimationFrame((()=>{this.waitingToZoom&&(this.waitingToZoom=!1,this.applyZoom())}))}this.waitingToZoom=!1;const r=n*this.imageWidth,i=n*this.imageHeight,o=this.imageWidth>1&&this.imageHeight>1?2*n:n>>1;this.hasInteracted||([this.panX,this.panY]=this.getCenteredPan()),this.panX=Math.max(Math.min(this.panX,r-o),-(e.width-o)),this.panY=Math.max(Math.min(this.panY,i-o),-(e.height-o)),this.canvas.style.position="fixed",this.canvas.style.width=`${r}px`,this.canvas.style.height=`${i}px`,this.canvas.style.left=-this.panX+"px",this.canvas.style.top=-this.panY+"px",this.canvas.style.clipPath=`polygon(${this.panX}px ${this.panY}px, ${this.panX+e.width}px ${this.panY}px, ${this.panX+e.width}px ${this.panY+e.height}px, ${this.panX}px ${this.panY+e.height}px)`,this.background&&this.cloneCanvasStyle(this.canvas,this.background),this.canvasLayers.forEach((e=>this.cloneCanvasStyle(this.canvas,e))),this.redrawFloatingLayer(this.editState,!0)}}selectCanvasColor(e,t){const n=this.refs["canvas-bounds"].getBoundingClientRect();let r,{canvasX:i,canvasY:o}=this.clientToCanvas(e.clientX,e.clientY,n);i=Math.floor(i),o=Math.floor(o),this.editState.inFloatingLayer(i,o)&&(r=this.editState.floating.image.get(i-this.editState.layerOffsetX,o-this.editState.layerOffsetY)),r||(r=this.editState.image.get(i,o)),t?this.props.dispatchChangeBackgroundColor(r):this.props.dispatchChangeSelectedColor(r)}selectAll(){this.props.tool!==s.ImageEditorTool.Marquee&&this.props.dispatchChangeImageTool(s.ImageEditorTool.Marquee),this.editState.mergeFloatingLayer(),this.editState.copyToLayer(0,0,this.imageWidth,this.imageHeight,!0),this.props.dispatchImageEdit(this.editState.toImageState())}cancelSelection(){this.editState.mergeFloatingLayer(),this.props.dispatchImageEdit(this.editState.toImageState())}deleteSelection(){this.editState.floating=null,this.props.dispatchImageEdit(this.editState.toImageState())}cloneCanvasStyle(e,t){t.style.position=e.style.position,t.style.width=e.style.width,t.style.height=e.style.height,t.style.left=e.style.left,t.style.top=e.style.top,t.style.clipPath=e.style.clipPath}clientToCanvas(e,t,n){const r=this.getCanvasUnit(n);return{canvasX:(e-n.left+this.panX)/r,canvasY:(t-n.top+this.panY)/r}}getCanvasUnit(e){const t=e.width/e.height,n=this.imageWidth/this.imageHeight,r=Math.pow(this.zoom/10,2);return t>n?r*(e.height/this.imageHeight):r*(e.width/this.imageWidth)}inBounds(e,t){return e>=0&&e<this.imageWidth&&t>=0&&t<this.imageHeight}isPanning(){return this.props.tool===s.ImageEditorTool.Pan}touchesResize(e,t){const n=document.querySelectorAll(":hover");for(let e=0;e<n.length;e++)if("image-editor-floating-layer-corner"==n[e].className)return!0;return!1}isColorSelect(){return this.props.tool===s.ImageEditorTool.ColorSelect}shouldHandleCanvasShortcut(){return!(this.props.suppressShortcuts||document.activeElement instanceof HTMLInputElement)}shouldDrawCursor(){if(!this.hasHover)return!1;switch(this.props.tool){case s.ImageEditorTool.Fill:case s.ImageEditorTool.Marquee:case s.ImageEditorTool.Pan:case s.ImageEditorTool.ColorSelect:return!1;default:return!0}}getImageState(){return this.props.isTilemap?this.props.tilemapState.tilemap:this.props.imageState}applyTilemapPatch(e){const{tilemapState:t,dispatchCreateNewTile:n,gallery:r,backgroundColor:i}=this.props,{tileset:o}=t,s=pxt.sprite.tilemapLiteralToTilemap(e.map);if(!s||!s.width||!s.height)return;const a=e.tiles.map((e=>pxt.sprite.getBitmapFromJResURL(`data:image/x-mkcd-f4;base64,${e}`))),l=e.layers.map((e=>pxt.sprite.getBitmapFromJResURL(`data:image/x-mkcd-f4;base64,${e}`))),c=[];let d=o.tiles.length;for(const e of a){const t=o.tiles.findIndex((t=>e.equals(pxt.sprite.Bitmap.fromData(t.bitmap))));if(t>=0)c.push(t);else{if(r){const t=r.find((t=>e.equals(pxt.sprite.Bitmap.fromData(t.bitmap))));if(t){n(null,o.tiles.length,i,t.qualifiedName),c.push(d),d++;continue}}n((0,u.createTile)(e.data()),o.tiles.length,i),c.push(d),d++}}this.editState.mergeFloatingLayer();const p=new pxt.sprite.Tilemap(s.width,s.height);for(let e=0;e<p.width;e++)for(let t=0;t<p.height;t++)p.set(e,t,c[s.get(e,t)]);this.editState.floating={image:p,overlayLayers:l},this.editState.layerOffsetX=0,this.editState.layerOffsetY=0,this.props.dispatchImageEdit(this.editState.toImageState())}}n.ImageCanvasImpl=f;const g={dispatchImageEdit:a.dispatchImageEdit,dispatchChangeCursorLocation:a.dispatchChangeCursorLocation,dispatchChangeZoom:a.dispatchChangeZoom,dispatchChangeImageTool:a.dispatchChangeImageTool,dispatchChangeSelectedColor:a.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:a.dispatchChangeBackgroundColor,dispatchCreateNewTile:a.dispatchCreateNewTile};n.ImageCanvas=(0,o.connect)((function({store:{present:e},editor:t},n){if(t.isTilemap){let n=e;return n?{selectedColor:t.selectedColor,tilemapState:n,tool:t.tool,toolWidth:t.cursorSize,zoomDelta:t.zoomDelta,onionSkinEnabled:!1,overlayEnabled:t.overlayEnabled,backgroundColor:t.backgroundColor,colors:n.colors,isTilemap:t.isTilemap,drawingMode:t.drawingMode,gallery:t.tileGallery,tilesetRevision:t.tilesetRevision}:{}}let r=e;return r?{selectedColor:t.selectedColor,colors:r.colors,imageState:r.frames[r.currentFrame],tool:t.tool,toolWidth:t.cursorSize,zoomDelta:t.zoomDelta,onionSkinEnabled:t.onionSkinEnabled,backgroundColor:t.backgroundColor,prevFrame:r.frames[r.currentFrame-1],isTilemap:t.isTilemap,tilesetRevision:t.tilesetRevision}:{}}),g)(f)},{"../../assets":46,"./ImageEditor":66,"./actions/dispatch":73,"./keyboardShortcuts":75,"./store/imageReducer":77,"./toolDefinitions":81,"./util":82,react:366,"react-redux":339,"react/jsx-runtime":367}],66:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ImageEditor=n.LIGHT_MODE_TRANSPARENT=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("react-redux"),s=e("./store/imageStore"),a=e("./SideBar"),l=e("./BottomBar"),c=e("./TopBar"),u=e("./ImageCanvas"),d=e("./Alert"),p=e("./Timeline"),h=e("./keyboardShortcuts"),f=e("./actions/dispatch"),g=e("./util"),m=e("../../assets"),v=e("../../../../react-common/components/util");n.LIGHT_MODE_TRANSPARENT="#dedede";class y extends i.Component{constructor(e){super(e),this.onStoreChange=()=>{this.props.onChange&&this.props.onChange(this.props.singleFrame?pxt.sprite.bitmapToImageLiteral(this.getCurrentFrame(),"typescript"):"");const e=this.getStore(),t=e.getState();if((0,h.setStore)(e),t.editor&&this.setState({alert:t.editor.alert}),!!t.editor.editingTile!=!!this.state.editingTile)if(t.editor.editingTile){const e=t.editor.editingTile.tilesetIndex;if(e){const n=t.store.present.tileset.tiles[e];this.setState({editingTile:!0,tileToEdit:n})}else{const e=t.store.present.tileset.tileWidth,n=(0,m.createNewImageAsset)("tile",e,e,lf("myTile"));this.setState({editingTile:!0,tileToEdit:n})}this.props.onTileEditorOpenClose&&this.props.onTileEditorOpenClose(!0)}else this.setState({editingTile:!1}),this.props.onTileEditorOpenClose&&this.props.onTileEditorOpenClose(!1)},this.onDoneClick=()=>{this.props.onDoneClicked&&this.props.onDoneClicked(this.getAsset())},this.onTileEditorFinished=e=>{const t=this.getStore().getState().editor.editingTile;e.isProjectTile=!0,this.dispatchOnStore((0,f.dispatchCloseTileEditor)(e,t.tilesetIndex))},this.state={editingTile:!1}}componentDidMount(){(0,h.addKeyListener)(),this.props.asset&&this.openAsset(this.props.asset),this.unsubscribeChangeListener=this.getStore().subscribe(this.onStoreChange),this.onResize()}componentWillUnmount(){this.props.nested||(0,h.removeKeyListener)(),this.unsubscribeChangeListener&&this.unsubscribeChangeListener()}render(){const{singleFrame:e,lightMode:t,hideDoneButton:n}=this.props,i=this.getStore(),{tileToEdit:h,editingTile:f,alert:g}=this.state,m="Animation"===i.getState().store.present.kind;return(0,r.jsxs)("div",Object.assign({className:"image-editor-outer"},{children:[(0,r.jsx)(o.Provider,Object.assign({store:i},{children:(0,r.jsxs)("div",Object.assign({className:(0,v.classList)("image-editor",f&&"editing-tile",n&&"hide-done-button")},{children:[(0,r.jsx)(c.TopBar,{singleFrame:e}),(0,r.jsxs)("div",Object.assign({className:"image-editor-content"},{children:[(0,r.jsx)(a.SideBar,{lightMode:t}),(0,r.jsx)(u.ImageCanvas,{suppressShortcuts:f,lightMode:t}),m&&!e?(0,r.jsx)(p.Timeline,{}):void 0]})),(0,r.jsx)(l.BottomBar,{singleFrame:e,onDoneClick:this.onDoneClick,hideDoneButton:!!n}),g&&g.title&&(0,r.jsx)(d.Alert,{title:g.title,text:g.text,options:g.options})]}))})),f&&(0,r.jsx)(y,{store:s.tileEditorStore,ref:"nested-image-editor",onDoneClicked:this.onTileEditorFinished,asset:h,singleFrame:!0,nested:!0})]}))}openAsset(e,t,n=!1){this.dispatchOnStore((0,f.dispatchOpenAsset)(e,n,t)),e.meta.displayName?this.dispatchOnStore((0,f.dispatchChangeAssetName)(e.meta.displayName)):n&&this.dispatchOnStore((0,f.dispatchChangeAssetName)(""))}openGalleryAsset(e){const t=this.getAsset(),n=this.getStore().getState().store.present.frames;switch(t.type){case"animation":switch(e.type){case"image":case"tile":this.setCurrentFrame(pxt.sprite.Bitmap.fromData(e.bitmap),1===n.length);break;case"animation":this.dispatchOnStore((0,f.dispatchSetFrames)(e.frames.map((e=>({bitmap:e})))))}break;case"image":case"tile":switch(e.type){case"image":case"tile":this.setCurrentFrame(pxt.sprite.Bitmap.fromData(e.bitmap),!0);break;case"animation":this.setCurrentFrame(pxt.sprite.Bitmap.fromData(e.frames[0]),!0)}}}onResize(){this.dispatchOnStore((0,f.dispatchChangeZoom)(0))}getCurrentFrame(){const e=this.getStore().getState().store.present,t=e.frames[e.currentFrame];return(0,g.imageStateToBitmap)(t)}getAsset(){switch(this.getStore().getState().store.present.asset.type){case"tile":return this.getTile();case"animation":return this.getAnimation();case"tilemap":return this.getTilemap();default:return this.getImage()}}getImage(){var e;const t=this.getStore().getState().store.present,n=this.getCurrentFrame().data(),r=t.asset?Object.assign({},t.asset.meta):{};return{id:null===(e=t.asset)||void 0===e?void 0:e.id,internalID:t.asset?t.asset.internalID:(0,m.getNewInternalID)(),type:"image",bitmap:n,jresData:pxt.sprite.base64EncodeBitmap(n),meta:r}}getTile(){var e;const t=this.getStore().getState().store.present,n=this.getCurrentFrame().data(),r=t.asset?Object.assign({},t.asset.meta):{};return{id:null===(e=t.asset)||void 0===e?void 0:e.id,internalID:t.asset?t.asset.internalID:(0,m.getNewInternalID)(),isProjectTile:!0,type:"tile",bitmap:n,jresData:pxt.sprite.base64EncodeBitmap(n),meta:r}}getAnimation(){var e;const t=this.getStore().getState().store.present,n=t.asset?Object.assign({},t.asset.meta):{};return{id:null===(e=t.asset)||void 0===e?void 0:e.id,internalID:t.asset?t.asset.internalID:(0,m.getNewInternalID)(),type:"animation",interval:t.interval,frames:t.frames.map((e=>(0,g.imageStateToBitmap)(e).data())),meta:n}}getTilemap(){var e;const t=this.getStore().getState(),n=t.store.present,{floating:r,overlayLayers:i,layerOffsetX:o,layerOffsetY:s}=n.tilemap,a=(0,g.applyBitmapData)(pxt.sprite.Bitmap.fromData(i[0]).copy().data(),r&&r.overlayLayers&&r.overlayLayers[0],o,s),l=new pxt.sprite.TilemapData((0,g.imageStateToTilemap)(n.tilemap),n.tileset,a);l.deletedTiles=t.editor.deletedTiles,l.editedTiles=t.editor.editedTiles;const c=n.asset?Object.assign({},n.asset.meta):{};return{id:null===(e=n.asset)||void 0===e?void 0:e.id,internalID:n.asset?n.asset.internalID:(0,m.getNewInternalID)(),type:"tilemap",data:l,meta:c}}getPersistentData(){const e=this.getStore().getState();return{editor:e.editor,past:e.store.past}}restorePersistentData(e){e&&this.dispatchOnStore((0,f.dispatchSetInitialState)(e.editor,e.past))}setCurrentFrame(e,t){if(!t){const t=this.getStore().getState().store.present.frames[0];if(e.width!==t.bitmap.width||e.height!==t.bitmap.height){const n=[Math.max(e.width,t.bitmap.width),Math.max(e.height,t.bitmap.height)];t.bitmap.width===n[0]&&t.bitmap.height===n[1]||this.dispatchOnStore((0,f.dispatchChangeImageDimensions)(n)),e=(e=e.copy()).resize(n[0],n[1])}}this.dispatchOnStore((0,f.dispatchImageEdit)({bitmap:e.data()}))}openInTileEditor(e){this.refs["nested-image-editor"].setCurrentFrame(e,!1)}disableResize(){this.dispatchOnStore((0,f.dispatchDisableResize)())}closeNestedEditor(){var e;this.state.editingTile&&(null===(e=this.refs["nested-image-editor"])||void 0===e||e.onDoneClick())}getJres(){if(this.props.singleFrame){const e=this.getCurrentFrame().data();return pxt.sprite.base64EncodeBitmap(e)}return""}loadJres(e){if(e)try{this.setCurrentFrame(pxt.sprite.getBitmapFromJResURL(e),!0)}catch(e){}}getStore(){return this.props.store||s.mainStore}dispatchOnStore(e){this.getStore().dispatch(e)}}n.ImageEditor=y},{"../../../../react-common/components/util":41,"../../assets":46,"./Alert":60,"./BottomBar":61,"./ImageCanvas":65,"./SideBar":68,"./Timeline":69,"./TopBar":72,"./actions/dispatch":73,"./keyboardShortcuts":75,"./store/imageStore":78,"./util":82,react:366,"react-redux":339,"react/jsx-runtime":367}],67:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Pivot=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("./util");class s extends i.Component{constructor(e){super(e),this.handlers=[],this.state={open:!1}}componentWillUnmount(){this.handlers=null}render(){const{options:e,selected:t}=this.props,n=e[t];return(0,r.jsx)("div",Object.assign({className:"image-editor-pivot-outer"},{children:e.map(((e,t)=>(0,r.jsx)("div",Object.assign({role:"tab",className:"image-editor-pivot-option "+(e===n?"selected":""),tabIndex:0,onClick:this.clickHandler(t),onKeyDown:o.fireClickOnlyOnEnter},{children:e.text}),e.id)))}))}clickHandler(e){if(!this.handlers[e]){const{onChange:t,options:n}=this.props;this.handlers[e]=()=>{this.setState({open:!1}),t(n[e],e)}}return this.handlers[e]}}n.Pivot=s},{"./util":82,react:366,"react/jsx-runtime":367}],68:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SideBar=n.SideBarImpl=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("react-redux"),s=e("./toolDefinitions"),a=e("./Button"),l=e("./actions/dispatch"),c=e("./sprite/Palette"),u=e("./tilemap/TilePalette"),d=e("./tilemap/Minimap");class p extends i.Component{constructor(){super(...arguments),this.handlers=[]}render(){const{selectedTool:e,isTilemap:t,lightMode:n}=this.props;return(0,r.jsxs)("div",Object.assign({className:"image-editor-sidebar "+(t?"tilemap":"")},{children:[t&&(0,r.jsx)("div",Object.assign({className:"image-editor-tilemap-minimap"},{children:(0,r.jsx)(d.Minimap,{lightMode:n})})),(0,r.jsx)("div",Object.assign({className:"image-editor-tool-buttons"},{children:s.tools.filter((e=>!e.hiddenTool)).map((t=>(0,r.jsx)(a.IconButton,{iconClass:t.iconClass,toggle:e!=t.tool,title:t.title,onClick:this.clickHandler(t.tool)},t.tool)))})),(0,r.jsx)("div",Object.assign({className:"image-editor-palette"},{children:t?(0,r.jsx)(u.TilePalette,{}):(0,r.jsx)(c.Palette,{})}))]}))}clickHandler(e){return this.handlers[e]||(this.handlers[e]=()=>this.props.dispatchChangeImageTool(e)),this.handlers[e]}}n.SideBarImpl=p;const h={dispatchChangeImageTool:l.dispatchChangeImageTool};n.SideBar=(0,o.connect)((function({editor:e},t){return e?{isTilemap:e.isTilemap,selectedTool:e.tool}:{}}),h)(p)},{"./Button":62,"./actions/dispatch":73,"./sprite/Palette":76,"./tilemap/Minimap":79,"./tilemap/TilePalette":80,"./toolDefinitions":81,react:366,"react-redux":339,"react/jsx-runtime":367}],69:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Timeline=n.TimelineImpl=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("react-redux"),s=e("./actions/dispatch"),a=e("./TimelineFrame"),l=e("./util");class c extends i.Component{constructor(e){super(e),this.handlers=[],this.scrollOffset=0,this.dragEnd=!1,this.duplicateFrame=()=>{const{currentFrame:e,dispatchDuplicateFrame:t}=this.props;t(e)},this.deleteFrame=()=>{const{currentFrame:e,dispatchDeleteFrame:t}=this.props;t(e)},this.newFrame=()=>{const{dispatchNewFrame:e}=this.props;this.dragEnd?this.dragEnd=!1:e()},this.state={}}render(){const{frames:e,colors:t,currentFrame:n,interval:i,previewAnimating:o}=this.props,{isMovingFrame:s,dropPreviewIndex:l}=this.state;let c,u=e.slice();return s&&(c=e[n],u.splice(n,1),u.splice(l,0,null)),(0,r.jsxs)("div",Object.assign({className:"image-editor-timeline "+(pxt.BrowserUtils.isEdge()?"edge":"")},{children:[(0,r.jsx)("div",Object.assign({className:"image-editor-timeline-preview"},{children:(0,r.jsx)(a.TimelineFrame,{frames:o?e:[e[n]],colors:t,interval:i,animating:!0})})),(0,r.jsx)("div",Object.assign({className:"image-editor-timeline-frames-outer"},{children:(0,r.jsxs)("div",Object.assign({className:"image-editor-timeline-frames",ref:"frame-scroller-ref"},{children:[u.map(((e,i)=>{const o=!s&&i===n;return e?(0,r.jsx)("div",Object.assign({className:"image-editor-timeline-frame "+(o?"active":""),role:"button",onClick:this.clickHandler(i)},{children:(0,r.jsx)(a.TimelineFrame,{frames:[e],colors:t,showActions:o,duplicateFrame:this.duplicateFrame,deleteFrame:this.deleteFrame})}),i):(0,r.jsx)("div",{className:"image-editor-timeline-frame drop-marker"},i)})),c&&(0,r.jsx)("div",Object.assign({ref:"floating-frame",className:"image-editor-timeline-frame dragging"},{children:(0,r.jsx)(a.TimelineFrame,{frames:[c],colors:t,duplicateFrame:this.duplicateFrame,deleteFrame:this.deleteFrame})})),(0,r.jsx)("div",Object.assign({className:"image-editor-timeline-frame collapsed",role:"button",onClick:this.newFrame},{children:(0,r.jsx)("span",{className:"ms-Icon ms-Icon--Add"})}))]}))}))]}))}componentDidMount(){let e;this.frameScroller=this.refs["frame-scroller-ref"];let t=!1;(0,l.bindGestureEvents)(this.frameScroller,{onClick:e=>{this.dragEnd=!1},onDragStart:n=>{e=n.clientY,pxt.BrowserUtils.addClass(this.frameScroller,"scrolling");const r=this.frameScroller.getBoundingClientRect(),i=n.clientY-r.top,o=this.frameScroller.firstElementChild.getBoundingClientRect().height,s=Math.floor(i/o);t=s!==this.props.currentFrame},onDragMove:n=>{if(t){this.scrollOffset-=e-n.clientY,e=n.clientY;try{const e=this.frameScroller.getBoundingClientRect(),t=this.frameScroller.parentElement.getBoundingClientRect();e.height>t.height?this.scrollOffset=Math.max(Math.min(this.scrollOffset,0),t.height-e.height-15):this.scrollOffset=0,this.frameScroller.parentElement.scrollTop=-this.scrollOffset}catch(e){}}else this.updateDragDrop(n)},onDragEnd:()=>{if(e=null,pxt.BrowserUtils.removeClass(this.frameScroller,"scrolling"),this.dragEnd=!0,this.state.isMovingFrame){const{dispatchMoveFrame:e,currentFrame:t}=this.props;e(t,this.state.dropPreviewIndex),this.setState({isMovingFrame:!1})}}}),this.frameScroller.addEventListener("wheel",(e=>{this.scrollOffset-=e.deltaY;try{const e=this.frameScroller.getBoundingClientRect(),t=this.frameScroller.parentElement.getBoundingClientRect();e.height>t.height?this.scrollOffset=Math.max(Math.min(this.scrollOffset,0),t.height-e.height-15):this.scrollOffset=0,this.frameScroller.parentElement.scrollTop=-this.scrollOffset}catch(e){}}))}clickHandler(e){return this.handlers[e]||(this.handlers[e]=()=>{const{currentFrame:t,dispatchChangeCurrentFrame:n}=this.props;this.dragEnd?this.dragEnd=!1:e!=t&&n(e)}),this.handlers[e]}updateDragDrop(e){const t=this.frameScroller.getBoundingClientRect(),n=e.clientY-t.top,r=this.frameScroller.firstElementChild.getBoundingClientRect().height,i=Math.floor(n/r);this.state.isMovingFrame?this.refs["floating-frame"]&&(this.refs["floating-frame"].style.top=n+"px",this.setState({dropPreviewIndex:i})):this.setState({isMovingFrame:!0,dropPreviewIndex:this.props.currentFrame})}}n.TimelineImpl=c;const u={dispatchDuplicateFrame:s.dispatchDuplicateFrame,dispatchDeleteFrame:s.dispatchDeleteFrame,dispatchChangeCurrentFrame:s.dispatchChangeCurrentFrame,dispatchNewFrame:s.dispatchNewFrame,dispatchMoveFrame:s.dispatchMoveFrame};n.Timeline=(0,o.connect)((function({store:{present:e},editor:t},n){let r=e;return r?{frames:r.frames,currentFrame:r.currentFrame,colors:r.colors,interval:r.interval,previewAnimating:t.previewAnimating}:{}}),u)(c)},{"./TimelineFrame":70,"./actions/dispatch":73,"./util":82,react:366,"react-redux":339,"react/jsx-runtime":367}],70:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TimelineFrame=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("./Button"),s=pxt.BrowserUtils.isEdge()?25:1;class a extends i.Component{constructor(e){super(e),this.state={index:0}}render(){const{frames:e,animating:t,showActions:n,duplicateFrame:i,deleteFrame:s}=this.props,a=e[t?Math.min(Math.max(0,this.state.index),e.length-1):0],l=a.bitmap.height>a.bitmap.width;return(0,r.jsxs)("div",Object.assign({className:"timeline-frame-outer "+(l?"portrait":"landscape")},{children:[(0,r.jsx)("div",{className:"timeline-frame-spacer"}),(0,r.jsx)("canvas",{ref:"preview-canvas"}),(0,r.jsx)("div",{className:"timeline-frame-spacer"}),n&&(0,r.jsxs)("div",Object.assign({className:"timeline-frame-actions"},{children:[(0,r.jsx)(o.IconButton,{iconClass:"ms-Icon ms-Icon--Copy",title:lf("Duplicate Current Frame"),onClick:i}),(0,r.jsx)(o.IconButton,{iconClass:"ms-Icon ms-Icon--Delete",title:lf("Delete Current Frame"),onClick:s})]}))]}))}componentDidMount(){this.canvas=this.refs["preview-canvas"],this.redraw(),this.updateAnimation()}componentDidUpdate(){this.redraw(),this.updateAnimation()}componentWillUnmount(){this.intervalId&&clearInterval(this.intervalId),this.intervalId=void 0}redraw(){if(!this.canvas)return;const{animating:e,frames:t}=this.props,n=t[e?Math.min(Math.max(0,this.state.index),t.length-1):0];this.canvas.height=n.bitmap.height*s,this.canvas.width=n.bitmap.width*s;const r=pxt.sprite.Bitmap.fromData(n.bitmap);if(this.drawBitmap(r),n.floating&&n.floating.bitmap){const e=pxt.sprite.Bitmap.fromData(n.floating.bitmap);this.drawBitmap(e,n.layerOffsetX,n.layerOffsetY,!0)}}updateAnimation(){const{animating:e,interval:t,frames:n}=this.props,r=e&&t>5&&n.length>1;r&&t!==this.intervalcurrent?(this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval((()=>this.setState({index:(this.state.index+1)%this.props.frames.length})),t),this.intervalcurrent=t):!r&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0,this.intervalcurrent=void 0)}drawBitmap(e,t=0,n=0,r=!1){const{colors:i}=this.props,o=this.canvas.getContext("2d");for(let a=0;a<e.width;a++)for(let l=0;l<e.height;l++){const c=e.get(a,l);c?(o.fillStyle=i[c],o.fillRect((a+t)*s,(l+n)*s,s,s)):r||o.clearRect((a+t)*s,(l+n)*s,s,s)}}}n.TimelineFrame=a},{"./Button":62,react:366,"react/jsx-runtime":367}],71:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Toggle=void 0;const r=e("react/jsx-runtime"),i=e("react");class o extends i.Component{constructor(e){super(e),this.checked=!1,this.handleToggleClick=e=>{this.checked=!this.checked,this.props.onChange&&this.props.onChange(e.target.checked)},this.checked=e.initialValue}render(){const{initialValue:e,label:t}=this.props;return(0,r.jsxs)("div",Object.assign({className:"image-editor-toggle-container"},{children:[t&&(0,r.jsx)("span",{children:t}),(0,r.jsxs)("label",Object.assign({className:"image-editor-toggle"},{children:[(0,r.jsx)("input",{type:"checkbox",onClick:this.handleToggleClick,defaultChecked:e,"aria-checked":this.checked}),(0,r.jsx)("span",{className:"image-editor-toggle-switch"})]}))]}))}}n.Toggle=o},{react:366,"react/jsx-runtime":367}],72:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TopBar=n.TopBarImpl=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("react-redux"),s=e("./actions/dispatch"),a=e("./Button"),l=e("./CursorSizes"),c=e("./Toggle"),u=e("./keyboardShortcuts");class d extends i.Component{constructor(e){super(e),this.togglePreviewAnimating=()=>this.props.dispatchChangePreviewAnimating(!this.props.previewAnimating),this.flipVertical=()=>(0,u.flip)(!0),this.flipHorizontal=()=>(0,u.flip)(!1),this.rotateClockwise=()=>(0,u.rotate)(!0),this.rotateCounterclockwise=()=>(0,u.rotate)(!1),this.handleIntervalChange=e=>{this.setState({interval:e.target.value})},this.handleIntervalBlur=()=>{const{dispatchChangeInterval:e}=this.props,t=parseInt(this.state.interval);isNaN(t)||e(Math.min(Math.max(t,50),1e6)),this.setState({interval:null})},this.state={}}render(){const{interval:e,previewAnimating:t,singleFrame:n,isTilemap:i,dispatchChangeOverlayEnabled:o}=this.props,s=null==this.state.interval?e:this.state.interval;return(0,r.jsxs)("div",Object.assign({className:"image-editor-topbar"},{children:[(0,r.jsx)("div",Object.assign({className:"cursor-group"},{children:(0,r.jsx)(l.CursorSizes,{})})),(0,r.jsx)("div",{className:"image-editor-seperator"}),(0,r.jsxs)("div",Object.assign({className:"image-transform-group"},{children:[(0,r.jsx)(a.IconButton,{iconClass:"xicon flipvertical",title:lf("Flip vertical"),onClick:this.flipVertical},"flipv"),(0,r.jsx)(a.IconButton,{iconClass:"xicon fliphorizontal",title:lf("Flip horizontal"),onClick:this.flipHorizontal},"fliph"),(0,r.jsx)(a.IconButton,{iconClass:"xicon rotateright",title:lf("Rotate clockwise"),onClick:this.rotateClockwise},"rotatec"),(0,r.jsx)(a.IconButton,{iconClass:"xicon rotateleft",title:lf("Rotate counterclockwise"),onClick:this.rotateCounterclockwise},"rotatecc")]})),(0,r.jsx)("div",{className:"spacer"}),!n&&(0,r.jsx)("div",{className:"image-editor-seperator"}),!n&&(0,r.jsxs)("div",Object.assign({className:"timeline-controls"},{children:[(0,r.jsx)(a.IconButton,{onClick:this.togglePreviewAnimating,iconClass:t?"ms-Icon ms-Icon--Stop":"ms-Icon ms-Icon--Play",title:t?lf("Stop Animation Preview"):lf("Play Animation Preview"),toggle:!0}),(0,r.jsx)("div",Object.assign({className:"image-editor-interval-label image-editor-label"},{children:(0,r.jsx)("span",{className:"ms-Icon ms-Icon--Clock"})})),(0,r.jsx)("div",Object.assign({className:"image-editor-interval"},{children:(0,r.jsx)("input",{className:"image-editor-input",title:lf("Interval Between Frames (ms)"),value:s,onChange:this.handleIntervalChange,onBlur:this.handleIntervalBlur})}))]})),i&&(0,r.jsx)(c.Toggle,{initialValue:!0,label:lf("Show walls"),onChange:o})]}))}}n.TopBarImpl=d;const p={dispatchChangeInterval:s.dispatchChangeInterval,dispatchChangePreviewAnimating:s.dispatchChangePreviewAnimating,dispatchChangeOverlayEnabled:s.dispatchChangeOverlayEnabled};n.TopBar=(0,o.connect)((function({store:{present:e},editor:t},n){return e?{interval:e.interval,previewAnimating:t.previewAnimating,isTilemap:t.isTilemap}:{}}),p)(d)},{"./Button":62,"./CursorSizes":63,"./Toggle":71,"./actions/dispatch":73,"./keyboardShortcuts":75,react:366,"react-redux":339,"react/jsx-runtime":367}],73:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.dispatchSetFrames=n.dispatchOpenAsset=n.dispatchChangeAssetName=n.dispatchDisableResize=n.dispatchDeleteTile=n.dispatchCloseTileEditor=n.dispatchOpenTileEditor=n.dispatchSetGalleryOpen=n.dispatchCreateNewTile=n.dispatchChangeDrawingMode=n.dispatchChangeTilePalettePage=n.dispatchChangeTilePaletteCategory=n.dispatchSetInitialState=n.dispatchChangeBackgroundColor=n.dispatchSwapBackgroundForeground=n.dispatchHideAlert=n.dispatchShowAlert=n.dispatchChangeZoom=n.dispatchChangeOverlayEnabled=n.dispatchToggleOnionSkinEnabled=n.dispatchChangePreviewAnimating=n.dispatchChangeInterval=n.dispatchMoveFrame=n.dispatchChangeCurrentFrame=n.dispatchDuplicateFrame=n.dispatchDeleteFrame=n.dispatchNewFrame=n.dispatchToggleAspectRatioLocked=n.dispatchRedoImageEdit=n.dispatchUndoImageEdit=n.dispatchImageEdit=n.dispatchChangeCursorLocation=n.dispatchChangeKeyModifiers=n.dispatchChangeImageDimensions=n.dispatchChangeSelectedColor=n.dispatchChangeCursorSize=n.dispatchChangeImageTool=void 0;const r=e("./types");n.dispatchChangeImageTool=e=>({type:r.CHANGE_IMAGE_TOOL,tool:e});n.dispatchChangeCursorSize=e=>({type:r.CHANGE_CURSOR_SIZE,cursorSize:e});n.dispatchChangeSelectedColor=e=>({type:r.CHANGE_SELECTED_COLOR,selectedColor:e});n.dispatchChangeImageDimensions=e=>({type:r.CHANGE_IMAGE_DIMENSIONS,imageDimensions:e});n.dispatchChangeKeyModifiers=e=>({type:r.CHANGE_KEY_MODIFIERS,keyModifiers:e});n.dispatchChangeCursorLocation=e=>({type:r.CHANGE_CURSOR_LOCATION,cursorLocation:e});n.dispatchImageEdit=e=>({type:r.IMAGE_EDIT,newState:e});n.dispatchUndoImageEdit=()=>({type:r.UNDO_IMAGE_EDIT});n.dispatchRedoImageEdit=()=>({type:r.REDO_IMAGE_EDIT});n.dispatchToggleAspectRatioLocked=()=>({type:r.TOGGLE_ASPECT_RATIO});n.dispatchNewFrame=e=>({type:r.NEW_FRAME,index:e});n.dispatchDeleteFrame=e=>({type:r.DELETE_FRAME,index:e});n.dispatchDuplicateFrame=e=>({type:r.DUPLICATE_FRAME,index:e});n.dispatchChangeCurrentFrame=e=>({type:r.CHANGE_CURRENT_FRAME,index:e});n.dispatchMoveFrame=(e,t)=>({type:r.MOVE_FRAME,oldIndex:e,newIndex:t});n.dispatchChangeInterval=e=>({type:r.CHANGE_INTERVAL,newInterval:e});n.dispatchChangePreviewAnimating=e=>({type:r.CHANGE_PREVIEW_ANIMATING,animating:e});n.dispatchToggleOnionSkinEnabled=()=>({type:r.TOGGLE_ONION_SKIN_ENABLED});n.dispatchChangeOverlayEnabled=e=>({type:r.CHANGE_OVERLAY_ENABLED,enabled:e});n.dispatchChangeZoom=e=>({type:r.CHANGE_CANVAS_ZOOM,zoom:e});n.dispatchShowAlert=(e,t,n)=>({type:r.SHOW_ALERT,title:e,text:t,options:n});n.dispatchHideAlert=()=>({type:r.HIDE_ALERT});n.dispatchSwapBackgroundForeground=()=>({type:r.SWAP_FOREGROUND_BACKGROUND});n.dispatchChangeBackgroundColor=e=>({type:r.CHANGE_BACKGROUND_COLOR,backgroundColor:e});n.dispatchSetInitialState=(e,t)=>({type:r.SET_INITIAL_STATE,state:e,past:t});n.dispatchChangeTilePaletteCategory=e=>({type:r.CHANGE_TILE_PALETTE_CATEGORY,category:e});n.dispatchChangeTilePalettePage=e=>({type:r.CHANGE_TILE_PALETTE_PAGE,page:e});n.dispatchChangeDrawingMode=e=>({type:r.CHANGE_DRAWING_MODE,drawingMode:e});n.dispatchCreateNewTile=(e,t,n,i)=>({type:r.CREATE_NEW_TILE,tile:e,foreground:t,background:n,qualifiedName:i});n.dispatchSetGalleryOpen=e=>({type:r.SET_GALLERY_OPEN,open:e});n.dispatchOpenTileEditor=(e,t)=>({type:r.OPEN_TILE_EDITOR,index:e,id:t});n.dispatchCloseTileEditor=(e,t)=>({type:r.CLOSE_TILE_EDITOR,result:e,index:t});n.dispatchDeleteTile=(e,t)=>({type:r.DELETE_TILE,id:t,index:e});n.dispatchDisableResize=()=>({type:r.DISABLE_RESIZE});n.dispatchChangeAssetName=e=>({type:r.CHANGE_ASSET_NAME,name:e});n.dispatchOpenAsset=(e,t,n)=>({type:r.OPEN_ASSET,asset:e,keepPast:t,gallery:n});n.dispatchSetFrames=e=>({type:r.SET_FRAMES,frames:e})},{"./types":74}],74:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.OPEN_ASSET=n.CHANGE_ASSET_NAME=n.DISABLE_RESIZE=n.DELETE_TILE=n.CLOSE_TILE_EDITOR=n.OPEN_TILE_EDITOR=n.CREATE_NEW_TILE=n.CHANGE_DRAWING_MODE=n.CHANGE_TILE_PALETTE_CATEGORY=n.CHANGE_TILE_PALETTE_PAGE=n.CHANGE_BACKGROUND_COLOR=n.SWAP_FOREGROUND_BACKGROUND=n.HIDE_ALERT=n.SHOW_ALERT=n.CHANGE_CANVAS_ZOOM=n.CHANGE_OVERLAY_ENABLED=n.TOGGLE_ONION_SKIN_ENABLED=n.CHANGE_PREVIEW_ANIMATING=n.CHANGE_INTERVAL=n.CHANGE_CURRENT_FRAME=n.MOVE_FRAME=n.DUPLICATE_FRAME=n.DELETE_FRAME=n.NEW_FRAME=n.SET_GALLERY_OPEN=n.TOGGLE_ASPECT_RATIO=n.REDO_IMAGE_EDIT=n.UNDO_IMAGE_EDIT=n.IMAGE_EDIT=n.CHANGE_CURSOR_LOCATION=n.CHANGE_KEY_MODIFIERS=n.CHANGE_IMAGE_DIMENSIONS=n.CHANGE_SELECTED_COLOR=n.CHANGE_CURSOR_SIZE=n.CHANGE_IMAGE_TOOL=n.SET_FRAMES=n.SET_INITIAL_STATE=void 0,n.SET_INITIAL_STATE="SET_INITIAL_STATE",n.SET_FRAMES="SET_FRAMES",n.CHANGE_IMAGE_TOOL="CHANGE_IMAGE_TOOL",n.CHANGE_CURSOR_SIZE="CHANGE_CURSOR_SIZE",n.CHANGE_SELECTED_COLOR="CHANGE_SELECTED_COLOR",n.CHANGE_IMAGE_DIMENSIONS="CHANGE_IMAGE_DIMENSIONS",n.CHANGE_KEY_MODIFIERS="CHANGE_KEY_MODIFIERS",n.CHANGE_CURSOR_LOCATION="CHANGE_CURSOR_LOCATION",n.IMAGE_EDIT="IMAGE_EDIT",n.UNDO_IMAGE_EDIT="UNDO_IMAGE_EDIT",n.REDO_IMAGE_EDIT="REDO_IMAGE_EDIT",n.TOGGLE_ASPECT_RATIO="TOGGLE_ASPECT_RATIO",n.SET_GALLERY_OPEN="SET_GALLERY_OPEN",n.NEW_FRAME="NEW_FRAME",n.DELETE_FRAME="DELETE_FRAME",n.DUPLICATE_FRAME="DUPLICATE_FRAME",n.MOVE_FRAME="MOVE_FRAME",n.CHANGE_CURRENT_FRAME="CHANGE_CURRENT_FRAME",n.CHANGE_INTERVAL="CHANGE_INTERVAL",n.CHANGE_PREVIEW_ANIMATING="CHANGE_PREVIEW_ANIMATING",n.TOGGLE_ONION_SKIN_ENABLED="TOGGLE_ONION_SKIN_ENABLED",n.CHANGE_OVERLAY_ENABLED="CHANGE_OVERLAY_ENABLED",n.CHANGE_CANVAS_ZOOM="CHANGE_CANVAS_ZOOM",n.SHOW_ALERT="SHOW_ALERT",n.HIDE_ALERT="HIDE_ALERT",n.SWAP_FOREGROUND_BACKGROUND="SWAP_FOREGROUND_BACKGROUND",n.CHANGE_BACKGROUND_COLOR="CHANGE_BACKGROUND_COLOR",n.CHANGE_TILE_PALETTE_PAGE="CHANGE_TILE_PALETTE_PAGE",n.CHANGE_TILE_PALETTE_CATEGORY="CHANGE_TILE_PALETTE_CATEGORY",n.CHANGE_DRAWING_MODE="CHANGE_DRAWING_MODE",n.CREATE_NEW_TILE="CREATE_NEW_TILE",n.OPEN_TILE_EDITOR="OPEN_TILE_EDITOR",n.CLOSE_TILE_EDITOR="CLOSE_TILE_EDITOR",n.DELETE_TILE="DELETE_TILE",n.DISABLE_RESIZE="DISABLE_RESIZE",n.CHANGE_ASSET_NAME="CHANGE_ASSET_NAME",n.OPEN_ASSET="OPEN_ASSET"},{}],75:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.replaceColor=n.outline=n.rotate=n.flip=n.setStore=n.areShortcutsEnabled=n.releaseShortcutLock=n.obtainShortcutLock=n.removeKeyListener=n.addKeyListener=void 0;const r=e("./store/imageReducer"),i=e("./actions/dispatch"),o=e("./store/imageStore"),s=e("./toolDefinitions");let a=o.mainStore,l=[];function c(){return!l.length}function u(e){const t=e.ctrlKey||e.metaKey;"Undo"===e.key||t&&"z"===e.key&&!e.shiftKey?(m((0,i.dispatchUndoImageEdit)()),e.preventDefault(),e.stopPropagation()):("Redo"===e.key||t&&"y"===e.key||t&&"Z"===e.key&&e.shiftKey)&&(m((0,i.dispatchRedoImageEdit)()),e.preventDefault(),e.stopPropagation())}function d(e){"Backspace"!==e.key&&"Delete"!==e.key||e.stopPropagation()}function p(e){if(!c())return;if(e.shiftKey&&/^(?:Digit[1-9])|(?:Key[A-F])$/.test(e.code))return void(0==e.code.indexOf("Digit")?x(parseInt(e.code.substring(5))):x(parseInt(e.code.substring(3),16)));switch(e.key){case"e":f(r.ImageEditorTool.Erase);break;case"h":f(r.ImageEditorTool.Pan);break;case"b":case"p":f(r.ImageEditorTool.Paint);break;case"g":f(r.ImageEditorTool.Fill);break;case"m":f(r.ImageEditorTool.Marquee);break;case"u":f(r.ImageEditorTool.Rect);break;case"l":f(r.ImageEditorTool.Line);break;case"c":f(r.ImageEditorTool.Circle);break;case"-":case"_":g(-1);break;case"=":case"+":g(1);break;case"x":m((0,i.dispatchSwapBackgroundForeground)());break;case"H":y(!1);break;case"V":y(!0);break;case"[":b(!1);break;case"]":b(!0);break;case">":v(!0);break;case"<":v(!1)}const t=a.getState().editor;if(e.shiftKey&&"KeyR"===e.code)E(t.backgroundColor,t.selectedColor);else if(!t.isTilemap&&/^Digit\d$/.test(e.code)){const t=+e.code.slice(-1)+(e.shiftKey?9:0);t>=0&&t<16&&function(e){m((0,i.dispatchChangeSelectedColor)(e))}(t)}}function h(){const e=a.getState();if(e.editor.isTilemap){const t=e.store.present;return[(0,s.getEditState)(t.tilemap,!0,e.editor.drawingMode),"tilemap"]}{const t=e.store.present;return[(0,s.getEditState)(t.frames[t.currentFrame],!1,e.editor.drawingMode),t.frames.length>1?"animation":"image"]}}function f(e){m((0,i.dispatchChangeImageTool)(e))}function g(e){m((0,i.dispatchChangeZoom)(e))}function m(e){a.dispatch(e)}function v(e){let t;const n=a.getState().editor.cursorSize;switch(n){case 1:t=e?3:1;break;case 3:t=e?5:1;break;case 5:t=e?5:3}n!==t&&m((0,i.dispatchChangeCursorSize)(t))}function y(e){const[t,n]=h(),r=(0,s.flipEdit)(t,e,"tilemap"===n);m((0,i.dispatchImageEdit)(r.toImageState()))}function b(e){const[t,n]=h(),r=(0,s.rotateEdit)(t,e,"tilemap"===n,"animation"===n);m((0,i.dispatchImageEdit)(r.toImageState()))}function x(e){const[t,n]=h();if("tilemap"===n)return;const r=(0,s.outlineEdit)(t,e);m((0,i.dispatchImageEdit)(r.toImageState()))}function E(e,t){const[n,r]=h(),o=(0,s.replaceColorEdit)(n,e,t);m((0,i.dispatchImageEdit)(o.toImageState()))}n.addKeyListener=function(){l=[],document.addEventListener("keydown",p),document.addEventListener("keydown",u,!0),document.addEventListener("keydown",d,!0)},n.removeKeyListener=function(){document.removeEventListener("keydown",p),document.removeEventListener("keydown",u,!0),document.removeEventListener("keydown",d,!0)},n.obtainShortcutLock=function(){let e=0;for(;!e;)e=Math.random()*Number.MAX_SAFE_INTEGER;return l.push(e),e},n.releaseShortcutLock=function(e){const t=l.indexOf(e);-1!==t&&l.splice(t,1)},n.areShortcutsEnabled=c,n.setStore=function(e){a=e||o.mainStore},n.flip=y,n.rotate=b,n.outline=x,n.replaceColor=E},{"./actions/dispatch":73,"./store/imageReducer":77,"./store/imageStore":78,"./toolDefinitions":81}],76:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Palette=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("react-redux"),s=e("../actions/dispatch");class a extends i.Component{constructor(){super(...arguments),this.handlers=[],this.preventContextMenu=e=>e.preventDefault()}render(){const{colors:e,selected:t,backgroundColor:n,dispatchSwapBackgroundForeground:i}=this.props;return(0,r.jsxs)("div",{children:[(0,r.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",className:"image-editor-colors",viewBox:"0 0 23 15",onClick:i},{children:[(0,r.jsx)("defs",{children:(0,r.jsxs)("pattern",Object.assign({id:"alpha-background",width:"6",height:"6",patternUnits:"userSpaceOnUse"},{children:[(0,r.jsx)("rect",{x:"0",y:"0",width:"6px",height:"6px",fill:"#aeaeae"}),(0,r.jsx)("rect",{x:"0",y:"0",width:"3px",height:"3px",fill:"#dedede"}),(0,r.jsx)("rect",{x:"3",y:"3",width:"3px",height:"3px",fill:"#dedede"})]}))}),(0,r.jsxs)("g",{children:[(0,r.jsx)("rect",Object.assign({fill:n?e[n]:"url(#alpha-background)",x:6,y:4,width:15,height:10,stroke:"#3c3c3c",strokeWidth:"0.5"},{children:(0,r.jsx)("title",{children:l(n,e[n])})})),(0,r.jsx)("rect",Object.assign({fill:t?e[t]:"url(#alpha-background)",x:2,y:1,width:15,height:10,stroke:"#3c3c3c",strokeWidth:"0.5"},{children:(0,r.jsx)("title",{children:l(t,e[t])})}))]})]})),(0,r.jsx)("div",Object.assign({className:"image-editor-color-buttons",onContextMenu:this.preventContextMenu},{children:this.props.colors.map(((e,t)=>(0,r.jsx)("div",{className:"image-editor-button "+(0===t?"checkerboard":""),role:"button",title:l(t,e),onMouseDown:this.clickHandler(t),style:0===t?null:{backgroundColor:e}},t)))}))]})}clickHandler(e){return this.handlers[e]||(this.handlers[e]=t=>{0===t.button?this.props.dispatchChangeSelectedColor(e):(this.props.dispatchChangeBackgroundColor(e),t.preventDefault(),t.stopPropagation())}),this.handlers[e]}}function l(e,t){const n=0===e?lf("transparency"):function(e){switch(null==e?void 0:e.toLowerCase()){case"#ffffff":return lf("white");case"#ff2121":return lf("red");case"#ff93c4":return lf("pink");case"#ff8135":return lf("orange");case"#fff609":return lf("yellow");case"#249ca3":return lf("teal");case"#78dc52":return lf("green");case"#003fad":return lf("blue");case"#87f2ff":return lf("light blue");case"#8e2ec4":return lf("purple");case"#a4839f":return lf("light purple");case"#5c406c":return lf("dark purple");case"#e5cdc4":return lf("tan");case"#91463d":return lf("brown");case"#000000":return lf("black");default:return}}(t);return n?lf("Color {0} ({1})",e,n):lf("Color {0}",e)}const c={dispatchChangeSelectedColor:s.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:s.dispatchChangeBackgroundColor,dispatchSwapBackgroundForeground:s.dispatchSwapBackgroundForeground};n.Palette=(0,o.connect)((function({store:{present:e},editor:t},n){let r=e;return r?{selected:t.selectedColor,backgroundColor:t.backgroundColor,colors:r.colors}:{}}),c)(a)},{"../actions/dispatch":73,react:366,"react-redux":339,"react/jsx-runtime":367}],77:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.setTelemetryFunction=n.TileDrawingMode=n.TileCategory=n.KeyModifiers=n.CursorSize=n.ImageEditorTool=void 0;const r=e("../../../assets"),i=e("../actions/types");var o,s,a,l;(l=o=n.ImageEditorTool||(n.ImageEditorTool={}))[l.Paint=0]="Paint",l[l.Fill=1]="Fill",l[l.Line=2]="Line",l[l.Erase=3]="Erase",l[l.Circle=4]="Circle",l[l.Rect=5]="Rect",l[l.ColorSelect=6]="ColorSelect",l[l.Marquee=7]="Marquee",l[l.Pan=8]="Pan",function(e){e[e.One=1]="One",e[e.Three=3]="Three",e[e.Five=5]="Five"}(n.CursorSize||(n.CursorSize={})),function(e){e[e.Alt=1]="Alt",e[e.Shift=2]="Shift"}(n.KeyModifiers||(n.KeyModifiers={})),function(e){e[e.Forest=0]="Forest",e[e.Aquatic=1]="Aquatic",e[e.Dungeon=2]="Dungeon",e[e.Misc=3]="Misc"}(s=n.TileCategory||(n.TileCategory={})),function(e){e.Default="default",e.Wall="wall"}(a=n.TileDrawingMode||(n.TileDrawingMode={}));const c={store:{present:{kind:"Animation",visible:!0,colors:["#000000","#ffffff","#ff2121","#ff93c4","#ff8135","#fff609","#249ca3","#78dc52","#003fad","#87f2ff","#8e2ec4","#a4839f","#5c406c","#e5cdc4","#91463d","#000000"],aspectRatioLocked:!1,currentFrame:0,frames:[f(16,16)],interval:200},past:[],future:[]},editor:{selectedColor:3,tool:o.Paint,cursorSize:1,backgroundColor:1,previewAnimating:!1,onionSkinEnabled:!1,overlayEnabled:!0,tilesetRevision:0,isTilemap:!1}},u=(e,t)=>{switch(t.type){case i.TOGGLE_ASPECT_RATIO:return m("toggle-aspect-ratio-lock"),Object.assign(Object.assign({},e),{aspectRatioLocked:!e.aspectRatioLocked});case i.CHANGE_CURRENT_FRAME:return m("change-frame"),Object.assign(Object.assign({},e),{currentFrame:t.index});case i.CHANGE_INTERVAL:return m("change-interval"),Object.assign(Object.assign({},e),{interval:t.newInterval});case i.CHANGE_IMAGE_DIMENSIONS:m("change-dimensions");const[n,r]=t.imageDimensions;return Object.assign(Object.assign({},e),{frames:e.frames.map(((e,t)=>Object.assign(Object.assign({},e),{bitmap:pxt.sprite.Bitmap.fromData(e.bitmap).resize(n,r).data()})))});case i.IMAGE_EDIT:return m("image-edit"),Object.assign(Object.assign({},e),{frames:e.frames.map(((n,r)=>r===e.currentFrame?t.newState:n))});case i.DELETE_FRAME:if(1===e.frames.length)return e;m("delete-frame");const o=e.frames.slice();o.splice(t.index,1);let s=e.currentFrame;return e.currentFrame>=t.index&&e.currentFrame>0&&s--,Object.assign(Object.assign({},e),{currentFrame:s,frames:o});case i.DUPLICATE_FRAME:m("duplicate-frame");const a=e.frames.slice();return a.splice(t.index,0,function(e){let t,n,r;return e.floating&&(e.floating.bitmap&&(n=pxt.sprite.Bitmap.fromData(e.floating.bitmap).copy().data()),e.floating.overlayLayers&&(r=e.floating.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy().data()))),t={bitmap:n,overlayLayers:r}),Object.assign(Object.assign({},e),{bitmap:pxt.sprite.Bitmap.fromData(e.bitmap).copy().data(),overlayLayers:e.overlayLayers&&e.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy().data())),floating:t})}(e.frames[t.index])),Object.assign(Object.assign({},e),{frames:a,currentFrame:t.index+1});case i.NEW_FRAME:return m("new-frame"),Object.assign(Object.assign({},e),{frames:[...e.frames,f(e.frames[0].bitmap.width,e.frames[0].bitmap.height)],currentFrame:e.frames.length});case i.MOVE_FRAME:if(t.newIndex<0||t.newIndex>=e.frames.length||t.newIndex<0||t.newIndex>=e.frames.length)return e;m("move-frame");const l=e.frames.slice(),c=l.splice(t.oldIndex,1)[0];return l.splice(t.newIndex,0,c),Object.assign(Object.assign({},e),{frames:l,currentFrame:t.oldIndex===e.currentFrame?t.newIndex:e.currentFrame});case i.SET_FRAMES:return m("set-frames"),Object.assign(Object.assign({},e),{frames:t.frames,currentFrame:0});default:return e}},d=(e,t,n)=>{let r;switch(t.type){case i.CHANGE_PREVIEW_ANIMATING:return m("preview-animate-"+(t.animating?"on":"off")),Object.assign(Object.assign({},e),{previewAnimating:t.animating});case i.CHANGE_CANVAS_ZOOM:return(t.zoom>0||t.zoom<0)&&m("zoom-"+(t.zoom>0?"in":"out")),Object.assign(Object.assign({},e),{zoomDelta:t.zoom});case i.CHANGE_IMAGE_TOOL:return m(`change-tool-${o[t.tool]}`),Object.assign(Object.assign({},e),{tool:t.tool});case i.CHANGE_CURSOR_SIZE:return m(`change-cursor-size-${t.cursorSize}`),Object.assign(Object.assign({},e),{cursorSize:t.cursorSize});case i.CHANGE_SELECTED_COLOR:return m(`foreground-color-${t.selectedColor}`),Object.assign(Object.assign({},e),{selectedColor:t.selectedColor,tool:e.tool===o.Erase?o.Paint:e.tool});case i.CHANGE_CURSOR_LOCATION:return Object.assign(Object.assign({},e),{cursorLocation:t.cursorLocation});case i.CHANGE_BACKGROUND_COLOR:return m(`background-color-${t.backgroundColor}`),Object.assign(Object.assign({},e),{backgroundColor:t.backgroundColor});case i.SWAP_FOREGROUND_BACKGROUND:return m("swap-foreground-background"),Object.assign(Object.assign({},e),{backgroundColor:e.selectedColor,selectedColor:e.backgroundColor});case i.TOGGLE_ONION_SKIN_ENABLED:return m("toggle-onion-skin"),Object.assign(Object.assign({},e),{onionSkinEnabled:!e.onionSkinEnabled});case i.CHANGE_TILE_PALETTE_CATEGORY:return m(`change-tile-category-${s[t.category]}`),Object.assign(Object.assign({},e),{tilemapPalette:Object.assign(Object.assign({},e.tilemapPalette),{category:t.category,page:0})});case i.CHANGE_TILE_PALETTE_PAGE:return m("change-tile-page"),Object.assign(Object.assign({},e),{tilemapPalette:Object.assign(Object.assign({},e.tilemapPalette),{page:t.page})});case i.CHANGE_DRAWING_MODE:return m("change-drawing-mode"),Object.assign(Object.assign({},e),{drawingMode:t.drawingMode||a.Default});case i.CHANGE_OVERLAY_ENABLED:return m("change-overlay-enabled"),Object.assign(Object.assign({},e),{overlayEnabled:t.enabled});case i.CREATE_NEW_TILE:return r=e.editedTiles,!t.tile||r&&-1!==r.indexOf(t.tile.id)||(r=(r||[]).concat([t.tile.id])),Object.assign(Object.assign({},e),{editedTiles:r,selectedColor:t.foreground,backgroundColor:t.background});case i.SET_GALLERY_OPEN:return m(`set-gallery-open-${t.open}`),Object.assign(Object.assign({},e),{tileGalleryOpen:t.open,tilemapPalette:Object.assign(Object.assign({},e.tilemapPalette),{page:0})});case i.DELETE_TILE:return Object.assign(Object.assign({},e),{deletedTiles:(e.deletedTiles||[]).concat([t.id]),selectedColor:t.index===e.selectedColor?0:e.selectedColor,backgroundColor:t.index===e.backgroundColor?0:e.backgroundColor,tilesetRevision:e.tilesetRevision+1});case i.OPEN_TILE_EDITOR:const l=t.index?"edit":"new";return m(`open-tile-editor-${l}`),Object.assign(Object.assign({},e),{editingTile:{type:l,tilesetIndex:t.index}});case i.CLOSE_TILE_EDITOR:return r=e.editedTiles,!t.result||r&&-1!==r.indexOf(t.result.id)||(r=(r||[]).concat([t.result.id])),Object.assign(Object.assign({},e),{editedTiles:r,selectedColor:t.index||n.present.tileset.tiles.length,editingTile:void 0,tilesetRevision:e.tilesetRevision+1});case i.SHOW_ALERT:return m("show-alert"),Object.assign(Object.assign({},e),{alert:{title:t.title,text:t.text,options:t.options}});case i.HIDE_ALERT:return m("hide-alert"),Object.assign(Object.assign({},e),{alert:null});case i.DISABLE_RESIZE:return Object.assign(Object.assign({},e),{resizeDisabled:!0})}return e},p=(e,t)=>{switch(t.type){case i.TOGGLE_ASPECT_RATIO:return m("toggle-aspect-ratio-lock"),Object.assign(Object.assign({},e),{aspectRatioLocked:!e.aspectRatioLocked});case i.CHANGE_IMAGE_DIMENSIONS:m("change-dimensions");const[n,o]=t.imageDimensions;return Object.assign(Object.assign({},e),{tilemap:Object.assign(Object.assign({},e.tilemap),{bitmap:b(e.tilemap.bitmap,n,o),overlayLayers:e.tilemap.overlayLayers&&e.tilemap.overlayLayers.map((e=>function(e,t,n){return pxt.sprite.Bitmap.fromData(e).resize(t,n).data()}(e,n,o)))})});case i.CREATE_NEW_TILE:const s=!t.qualifiedName;let a;return m(s?"new-tile":`used-tile-${t.qualifiedName}`),s?(a=t.tile).isProjectTile=!0:a=(0,r.lookupAsset)("tile",t.qualifiedName),Object.assign(Object.assign({},e),{tileset:Object.assign(Object.assign({},e.tileset),{tiles:e.tileset.tiles.concat([a])}),nextId:s?e.nextId+1:e.nextId});case i.CLOSE_TILE_EDITOR:return m("close-tile-editor"),t.result?t.index?Object.assign(Object.assign({},e),{tileset:h(e.tileset,t.index,t.result)}):Object.assign(Object.assign({},e),{tileset:Object.assign(Object.assign({},e.tileset),{tiles:e.tileset.tiles.concat([t.result])}),nextId:e.nextId+1}):e;case i.DELETE_TILE:m("delete-tile");const l=e.tileset.tiles.slice();return l.splice(t.index,1),Object.assign(Object.assign({},e),{tilemap:Object.assign(Object.assign({},e.tilemap),{bitmap:y(t.index,pxt.sprite.Tilemap.fromData(e.tilemap.bitmap)).data()}),tileset:Object.assign(Object.assign({},e.tileset),{tiles:l})});case i.IMAGE_EDIT:return m("image-edit"),Object.assign(Object.assign({},e),{tilemap:t.newState});default:return e}};function h(e,t,n){return Object.assign(Object.assign({},e),{tiles:e.tiles.map(((e,r)=>r===t?n:e))})}function f(e,t){return{bitmap:new pxt.sprite.Bitmap(e,t).data()}}let g;function m(e){g&&g(e)}function v(e,t){for(const n of e.tiles)if(!n.jresData&&!n.isProjectTile)for(const e of t)if(e.qualifiedName===n.id){n.bitmap=e.bitmap;break}return e}function y(e,t){const n=t.copy();for(let t=0;t<n.width;t++)for(let r=0;r<n.height;r++){const i=n.get(t,r);i===e?n.set(t,r,0):i>e&&n.set(t,r,i-1)}return n}function b(e,t,n){return pxt.sprite.Tilemap.fromData(e).resize(t,n).data()}function x(e,t){return"tilemap"===e.type?function(e,t){return{kind:"Tilemap",asset:e,colors:pxt.appTarget.runtime.palette.slice(),aspectRatioLocked:!1,tilemap:{bitmap:e.data.tilemap.data(),overlayLayers:[e.data.layers]},tileset:v(e.data.tileset,t),nextId:e.data.nextId}}(e,t):function(e){return{kind:"Animation",asset:e,visible:!0,colors:pxt.appTarget.runtime.palette.slice(),aspectRatioLocked:"tile"===e.type,currentFrame:0,frames:"animation"===e.type?e.frames.map((e=>({bitmap:e}))):[{bitmap:e.bitmap}],interval:"animation"===e.type?e.interval:100}}(e)}n.setTelemetryFunction=function(e){g=e},n.default=(e=c,t)=>{var n;switch(t.type){case i.OPEN_TILE_EDITOR:case i.CHANGE_PREVIEW_ANIMATING:case i.CHANGE_CANVAS_ZOOM:case i.CHANGE_IMAGE_TOOL:case i.CHANGE_CURSOR_SIZE:case i.CHANGE_SELECTED_COLOR:case i.CHANGE_CURSOR_LOCATION:case i.CHANGE_BACKGROUND_COLOR:case i.SWAP_FOREGROUND_BACKGROUND:case i.TOGGLE_ONION_SKIN_ENABLED:case i.CHANGE_OVERLAY_ENABLED:case i.CHANGE_TILE_PALETTE_PAGE:case i.CHANGE_TILE_PALETTE_CATEGORY:case i.CHANGE_DRAWING_MODE:case i.SET_GALLERY_OPEN:case i.SHOW_ALERT:case i.HIDE_ALERT:case i.DISABLE_RESIZE:return Object.assign(Object.assign({},e),{editor:d(e.editor,t,e.store)});case i.SET_INITIAL_STATE:const o=t.state;return Object.assign(Object.assign({},e),{editor:Object.assign(Object.assign({},c.editor),{selectedColor:o.selectedColor,backgroundColor:o.backgroundColor,tilemapPalette:o.tilemapPalette,tileGalleryOpen:o.tileGalleryOpen,tileGallery:o.tileGallery,isTilemap:o.isTilemap,referencedTiles:e.editor.referencedTiles}),store:Object.assign(Object.assign({},e.store),{past:t.past||e.store.past,future:t.past?[]:e.store.future})});case i.OPEN_ASSET:const l=t.asset,h=t.gallery||(t.keepPast?e.editor.tileGallery:[]);let f=-1;if("tilemap"===l.type){const e=t.asset.data;if(pxt.sprite.isEmptyTilemap(e)){const t=e.tileset.tiles||[],i=null===(n=h.find((e=>-1!==e.tags.indexOf("forest"))))||void 0===n?void 0:n.qualifiedName,o=(0,r.lookupAsset)("tile",i);o&&!t.find((e=>e.id===i))&&t.push(o),f=t.indexOf(o)}}return Object.assign(Object.assign({},e),{editor:"tilemap"===l.type?{selectedColor:f,backgroundColor:-1,isTilemap:!0,tilemapPalette:{category:s.Forest,page:0},drawingMode:a.Default,overlayEnabled:!0,tileGallery:h,tileGalleryOpen:!!h,referencedTiles:l.data.projectReferences,previewAnimating:!1,onionSkinEnabled:!1,tilesetRevision:0,tool:t.keepPast?e.editor.tool:c.editor.tool,cursorSize:t.keepPast?e.editor.cursorSize:c.editor.cursorSize,editedTiles:t.keepPast?e.editor.editedTiles:void 0,deletedTiles:t.keepPast?e.editor.deletedTiles:void 0}:{isTilemap:!1,tilesetRevision:0,selectedColor:t.keepPast?e.editor.selectedColor:c.editor.selectedColor,backgroundColor:t.keepPast?e.editor.backgroundColor:c.editor.backgroundColor,previewAnimating:t.keepPast?e.editor.previewAnimating:c.editor.previewAnimating,tool:t.keepPast?e.editor.tool:c.editor.tool,onionSkinEnabled:t.keepPast?e.editor.onionSkinEnabled:c.editor.onionSkinEnabled,cursorSize:t.keepPast?e.editor.cursorSize:c.editor.cursorSize,resizeDisabled:t.keepPast?e.editor.resizeDisabled:c.editor.resizeDisabled},store:Object.assign(Object.assign({},e.store),{past:t.keepPast?e.store.past:[],present:x(t.asset,h),future:[]})});case i.CHANGE_ASSET_NAME:return m("change-asset-name"),Object.assign(Object.assign({},e),{store:{past:[...e.store.past,e.store.present],present:Object.assign(Object.assign({},e.store.present),{asset:Object.assign(Object.assign({},e.store.present.asset),{meta:Object.assign(Object.assign({},e.store.present.asset.meta||{}),{displayName:t.name})})}),future:[]}});case i.UNDO_IMAGE_EDIT:return e.store.past.length?(m("undo"),Object.assign(Object.assign({},e),{store:Object.assign(Object.assign({},e.store),{past:e.store.past.slice(0,e.store.past.length-1),present:e.store.past[e.store.past.length-1],future:[...e.store.future,e.store.present]}),editor:Object.assign(Object.assign({},e.editor),{tilesetRevision:e.editor.tilesetRevision+1})})):e;case i.REDO_IMAGE_EDIT:return e.store.future.length?(m("redo"),Object.assign(Object.assign({},e),{store:Object.assign(Object.assign({},e.store),{past:[...e.store.past,e.store.present],present:e.store.future[e.store.future.length-1],future:e.store.future.slice(0,e.store.future.length-1)}),editor:Object.assign(Object.assign({},e.editor),{tilesetRevision:e.editor.tilesetRevision+1})})):e;default:return Object.assign(Object.assign({},e),{editor:d(e.editor,t,e.store),store:Object.assign(Object.assign({},e.store),{past:[...e.store.past,e.store.present],present:e.editor.isTilemap?p(e.store.present,t):u(e.store.present,t),future:[]})})}}},{"../../../assets":46,"../actions/types":74}],78:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.mainStore=n.tileEditorStore=void 0;const r=e("redux"),i=e("./imageReducer"),o=(0,r.createStore)(i.default);n.default=o,n.tileEditorStore=(0,r.createStore)(i.default),n.mainStore=o},{"./imageReducer":77,redux:384}],79:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Minimap=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("react-redux"),s=e("../ImageEditor"),a=pxt.BrowserUtils.isEdge()?25:1;class l extends i.Component{constructor(){super(...arguments),this.tileColors=[]}componentDidMount(){this.canvas=this.refs["minimap-canvas"],this.redrawCanvas()}componentDidUpdate(){this.redrawCanvas()}render(){return(0,r.jsx)("div",Object.assign({className:"minimap-outer"},{children:(0,r.jsx)("canvas",{ref:"minimap-canvas",className:"paint-surface"})}))}redrawCanvas(){const{tilemap:e,lightMode:t}=this.props;let{bitmap:n,floating:r,layerOffsetX:i,layerOffsetY:o}=e;const l=this.canvas.getContext("2d"),c=pxt.sprite.Tilemap.fromData(n),u=r&&r.bitmap?pxt.sprite.Tilemap.fromData(r.bitmap):null;this.canvas.width=c.width*a,this.canvas.height=c.height*a,this.tileColors=[];for(let e=0;e<c.width;e++)for(let n=0;n<c.height;n++){const r=u?u.get(e-i,n-o):null,d=c.get(e,n);r?(l.fillStyle=this.getColor(r),l.fillRect(e*a,n*a,a,a)):d?(l.fillStyle=this.getColor(d),l.fillRect(e*a,n*a,a,a)):t?(l.fillStyle=s.LIGHT_MODE_TRANSPARENT,l.fillRect(e*a,n*a,a,a)):l.clearRect(e*a,n*a,a,a)}}getColor(e){if(!this.tileColors[e]){const{tileset:t,colors:n}=this.props;if(e>=t.tiles.length)return"#ffffff";const r=pxt.sprite.Bitmap.fromData(t.tiles[e].bitmap);this.tileColors[e]=pxt.sprite.computeAverageColor(r,n)}return this.tileColors[e]}}n.Minimap=(0,o.connect)((function({store:{present:e},editor:t},n){let r=e;return r?{tilemap:r.tilemap,tileset:r.tileset,colors:r.colors}:{}}),{})(l)},{"../ImageEditor":66,react:366,"react-redux":339,"react/jsx-runtime":367}],80:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TilePalette=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("react-redux"),s=e("../store/imageReducer"),a=e("../actions/dispatch"),l=e("../TimelineFrame"),c=e("../Dropdown"),u=e("../Pivot"),d=e("../Button"),p=e("../../../assets"),h=pxt.BrowserUtils.isEdge()?25:1,f=[{id:"forest",text:lf("Forest"),tiles:[]},{id:"aquatic",text:lf("Aquatic"),tiles:[]},{id:"dungeon",text:lf("Dungeon"),tiles:[]},{id:"misc",text:lf("Miscellaneous"),tiles:[]}],g=[{id:"custom",text:lf("My Tiles")},{id:"gallery",text:lf("Gallery")}],m=new pxt.sprite.Bitmap(16,16);class v extends i.Component{constructor(e){super(e),this.dropdownHandler=(e,t)=>{this.props.dispatchChangeTilePaletteCategory(t)},this.pivotHandler=(e,t)=>{this.props.dispatchSetGalleryOpen(1===t)},this.pageHandler=e=>{this.props.dispatchChangeTilePalettePage(e)},this.tileCreateHandler=()=>{this.props.dispatchOpenTileEditor()},this.tileEditHandler=()=>{const{tileset:e,selected:t,dispatchOpenTileEditor:n}=this.props,r=e.tiles[t];(null==r?void 0:r.isProjectTile)&&0!==t&&n(t,r.id)},this.tileDuplicateHandler=()=>{var e;const{tileset:t,selected:n,backgroundColor:r,dispatchCreateNewTile:i}=this.props;if(!t.tiles[n]||!t.tiles[n].isProjectTile||0===n)return;const o=t.tiles[n];i((0,p.createTile)(o.bitmap,null,null===(e=o.meta)||void 0===e?void 0:e.displayName),t.tiles.length,r)},this.tileDeleteAlertHandler=()=>{const{tileset:e,selected:t,dispatchShowAlert:n,dispatchHideAlert:r,referencedTiles:i}=this.props,o=e.tiles[t];t&&o&&o.isProjectTile&&(i&&-1!==i.indexOf(o.id)?n(lf("Unable to delete"),lf("This tile is used in your game. Remove all blocks using the tile before deleting."),[{label:lf("Cancel"),onClick:r}]):n(lf("Are you sure?"),lf("Deleting this tile will remove it from all other tile maps in your game."),[{label:lf("Yes"),onClick:this.deleteTile},{label:lf("No"),onClick:r}]))},this.deleteTile=()=>{const e=this.props.tileset.tiles[this.props.selected];e&&this.props.dispatchDeleteTile(this.props.selected,e.id)},this.canvasClickHandler=e=>{this.handleCanvasClickCore(e.clientX,e.clientY,e.button>0)},this.canvasTouchHandler=e=>{this.handleCanvasClickCore(e.changedTouches[0].clientX,e.changedTouches[0].clientY,!1)},this.foregroundBackgroundClickHandler=()=>{this.props.drawingMode!=s.TileDrawingMode.Default?this.props.dispatchChangeDrawingMode(s.TileDrawingMode.Default):this.props.dispatchSwapBackgroundForeground()},this.wallClickHandler=()=>{this.props.drawingMode===s.TileDrawingMode.Wall?this.props.dispatchChangeDrawingMode(s.TileDrawingMode.Default):this.props.dispatchChangeDrawingMode(s.TileDrawingMode.Wall)},this.preventContextMenu=e=>e.preventDefault();const{gallery:t}=e;if(this.refreshGallery(e),t){const e={};for(const n of t){const t=n.tags.find((e=>pxt.Util.startsWith(e,"category-")));t&&(e[t]||(e[t]={id:t,text:pxt.Util.rlf(`{id:tilecategory}${t.substr(9)}`),tiles:[]}),e[t].tiles.push(n))}this.categories=f.concat(Object.keys(e).map((t=>e[t])))}else this.categories=[]}componentDidMount(){this.canvas=this.refs["tile-canvas-surface"],this.updateGalleryTiles(),this.redrawCanvas()}UNSAFE_componentWillReceiveProps(e){this.props.selected!=e.selected?this.jumpToPageContaining(e.selected):this.props.backgroundColor!=e.backgroundColor&&this.jumpToPageContaining(e.backgroundColor),this.refreshGallery(e)}componentDidUpdate(){this.updateGalleryTiles(),this.redrawCanvas()}render(){const{colors:e,selected:t,backgroundColor:n,tileset:i,category:o,page:a,drawingMode:p,galleryOpen:h}=this.props,f=i.tiles[t]?i.tiles[t].bitmap:m.data(),v=i.tiles[n]?i.tiles[n].bitmap:m.data();m.data(),this.updateGalleryTiles();let x=Math.ceil(this.categoryTiles.length/16);h||this.categoryTiles.length%16!=0||x++;const E=!h&&(1===x||a===x-1),_=h||!this.renderedTiles.some((e=>!b(e)&&e.index===t));return(0,r.jsxs)("div",Object.assign({className:"tile-palette"},{children:[(0,r.jsxs)("div",Object.assign({className:"tile-palette-fg-bg"},{children:[(0,r.jsx)("div",Object.assign({className:"tile-palette-swatch fg "+(p==s.TileDrawingMode.Default?"selected":""),onClick:this.foregroundBackgroundClickHandler,role:"button"},{children:(0,r.jsx)(l.TimelineFrame,{frames:[{bitmap:f}],colors:e})})),(0,r.jsxs)("div",Object.assign({className:"tile-palette-swatch bg",onClick:this.foregroundBackgroundClickHandler,role:"button"},{children:[(0,r.jsx)(l.TimelineFrame,{frames:[{bitmap:v}],colors:e}),(0,r.jsx)(d.IconButton,{iconClass:"ms-Icon ms-Icon--ReturnKey",title:lf("Swap the background and foreground colors."),toggle:!0})]})),(0,r.jsx)("div",Object.assign({className:"tile-palette-swatch wall "+(p==s.TileDrawingMode.Wall?"selected":""),onClick:this.wallClickHandler,title:lf("Draw walls"),role:"button"},{children:(0,r.jsx)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1000 1000",width:"1000",height:"1000"},{children:(0,r.jsx)("path",{d:"M 968.49289,108.05443 771.30518,3.7581533 183.65231,166.0694 l 2.58963,202.62638 -156.247366,54.4148 0.872799,492.65563 179.544267,81.08212 758.08125,-222.4989 z M 765.6275,42.836761 916.79721,122.02922 412.26526,262.35026 250.08966,187.43643 Z M 934.62189,739.077 234.56171,946.92199 233.81426,554.79578 422.38222,493.25053 423.42046,300.4059 934.62189,157.54989 Z M 204.96854,402.33519 361.49056,473.98651 222.88861,518.46222 75.008408,444.5191 Z"})}))}))]})),(0,r.jsx)(u.Pivot,{options:g,selected:h?1:0,onChange:this.pivotHandler}),(0,r.jsxs)("div",Object.assign({className:"tile-palette-controls-outer"},{children:[h&&(0,r.jsx)(c.Dropdown,{onChange:this.dropdownHandler,options:this.categories.filter((e=>!!e.tiles.length)),selected:o}),!h&&(0,r.jsxs)("div",Object.assign({className:"tile-palette-controls"},{children:[(0,r.jsx)(d.IconButton,{onClick:this.tileEditHandler,iconClass:"ms-Icon ms-Icon--SingleColumnEdit",title:lf("Edit the selected tile"),disabled:_,toggle:!_}),(0,r.jsx)(d.IconButton,{onClick:this.tileDuplicateHandler,iconClass:"ms-Icon ms-Icon--Copy",title:lf("Duplicate the selected tile"),disabled:_,toggle:!_}),(0,r.jsx)(d.IconButton,{onClick:this.tileDeleteAlertHandler,iconClass:"ms-Icon ms-Icon--Delete",title:lf("Delete the selected tile"),disabled:_,toggle:!_})]}))]})),(0,r.jsxs)("div",Object.assign({className:"tile-canvas-outer",onContextMenu:this.preventContextMenu},{children:[(0,r.jsxs)("div",Object.assign({className:"tile-canvas"},{children:[(0,r.jsx)("canvas",{ref:"tile-canvas-surface",className:"paint-surface",onMouseDown:this.canvasClickHandler,onTouchStart:this.canvasTouchHandler,role:"complementary"}),E&&(0,r.jsx)("div",Object.assign({ref:"create-tile-ref"},{children:(0,r.jsx)(d.IconButton,{onClick:this.tileCreateHandler,iconClass:"ms-Icon ms-Icon--Add",title:lf("Create a new tile"),toggle:!0})}))]})),(0,r.jsx)("div",Object.assign({className:"tile-canvas-controls"},{children:y(x,a,this.pageHandler)}))]}))]}))}updateGalleryTiles(){const{page:e,category:t,galleryOpen:n}=this.props;this.categoryTiles=n?this.categories[t].tiles:this.getCustomTiles().map((([e,t])=>({index:t,bitmap:e.bitmap})));const r=16*e;this.renderedTiles=this.categoryTiles.slice(r,r+16)}jumpToPageContaining(e){const{tileset:t,dispatchSetGalleryOpen:n,dispatchChangeTilePaletteCategory:r,dispatchChangeTilePalettePage:i}=this.props;if(!e||e<0||e>=t.tiles.length)return;const o=t.tiles[e];if(o.isProjectTile){const e=this.getCustomTiles().map((([e,t])=>e));if(!e)return;const t=Math.max(Math.floor(e.findIndex((e=>e.id==o.id))/16),0);n(!1),i(t)}else{const e=this.categories.find((e=>-1!==e.tiles.findIndex((e=>e.qualifiedName==o.id))));if(!e||!e.tiles)return;const t=Math.max(Math.floor(e.tiles.findIndex((e=>e.qualifiedName==o.id))/16),0);n(!0),r(this.categories.indexOf(e)),i(t)}}redrawCanvas(){const{tileset:e,page:t,selected:n}=this.props,r=4*t*4,i=e.tileWidth+1;this.canvas.width=(4*i+1)*h,this.canvas.height=(4*i+1)*h;const o=this.canvas.getContext("2d");for(let e=0;e<4;e++)for(let t=0;t<4;t++){const s=this.categoryTiles[r+4*e+t];s&&(b(s)||s.index!==n||(o.fillStyle="#ff0000",o.fillRect(t*i,e*i,i+1,i+1)),o.fillStyle="#333333",o.fillRect(t*i+1,e*i+1,i-1,i-1),this.drawBitmap(pxt.sprite.Bitmap.fromData(s.bitmap),1+t*i,1+e*i))}this.positionCreateTileButton()}drawBitmap(e,t=0,n=0,r=!0,i=h,o=this.canvas){const{colors:s}=this.props,a=o.getContext("2d");a.imageSmoothingEnabled=!1;for(let o=0;o<e.width;o++)for(let l=0;l<e.height;l++){const c=e.get(o,l);c?(a.fillStyle=s[c],a.fillRect((o+t)*i,(l+n)*i,i,i)):r||a.clearRect((o+t)*i,(l+n)*i,i,i)}}handleCanvasClickCore(e,t,n){const r=this.canvas.getBoundingClientRect(),i=(e-r.left)/(r.width/4)|0,o=(t-r.top)/(r.height/4)|0,a=this.renderedTiles[4*o+i];if(a){let e,t;if(b(a)?(e=this.getTileIndex(a),t=a.qualifiedName):e=a.index,e>=0)n?this.props.dispatchChangeBackgroundColor(e):this.props.dispatchChangeSelectedColor(e);else{const{selected:e,backgroundColor:r,tileset:i}=this.props,o=i.tiles.length||1;this.props.dispatchCreateNewTile(null,n?e:o,n?o:r,t)}this.props.dispatchChangeDrawingMode(s.TileDrawingMode.Default)}}refreshGallery(e){const{gallery:t,tileset:n}=e;t&&f.forEach((e=>{e.tiles=t.filter((t=>-1!==t.tags.indexOf(e.id)&&t.tileWidth===n.tileWidth))}))}positionCreateTileButton(){const e=this.refs["create-tile-ref"];if(e){const t=this.categoryTiles.length%4,n=Math.floor(this.categoryTiles.length/4)%4;e.style.position="absolute",e.style.left="calc("+t/4+" * (100% - 0.5rem) + 0.25rem)",e.style.top="calc("+n/4+" * (100% - 0.5rem) + 0.25rem)"}}getCustomTiles(){return this.props.tileset.tiles.map(((e,t)=>[e,t])).filter((([e])=>e.isProjectTile)).sort((([e],[t])=>{const n="myTiles.transparency"+this.props.tileset.tileWidth;return e.id==n?-1:t.id==n?1:e.internalID-t.internalID}))}getTileIndex(e){const{tileset:t}=this.props;for(let n=0;n<t.tiles.length;n++)if(t.tiles[n].id===e.qualifiedName)return n;return-1}}function y(e,t,n){const i=16+5*(e-1),o=[];for(let n=0;n<e;n++)o[n]=n===t;return(0,r.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${i} 10`,className:"tile-palette-pages "+(e<2?"disabled":"")},{children:[(0,r.jsx)("polygon",{className:"tile-palette-page-arrow",points:"1,5 4,3 4,7",onClick:t?()=>n(t-1):void 0}),o.map(((e,t)=>(0,r.jsx)("circle",{className:"tile-palette-page-dot",cx:8+5*t,cy:"5",r:e?2:1,onClick:e?void 0:()=>n(t)},t))),(0,r.jsx)("polygon",{className:"tile-palette-page-arrow",points:`${i-1},5 ${i-4},3 ${i-4},7`,onClick:t<e-1?()=>n(t+1):void 0})]}))}function b(e){return!!e.qualifiedName}const x={dispatchChangeSelectedColor:a.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:a.dispatchChangeBackgroundColor,dispatchSwapBackgroundForeground:a.dispatchSwapBackgroundForeground,dispatchChangeTilePalettePage:a.dispatchChangeTilePalettePage,dispatchChangeTilePaletteCategory:a.dispatchChangeTilePaletteCategory,dispatchChangeDrawingMode:a.dispatchChangeDrawingMode,dispatchCreateNewTile:a.dispatchCreateNewTile,dispatchSetGalleryOpen:a.dispatchSetGalleryOpen,dispatchOpenTileEditor:a.dispatchOpenTileEditor,dispatchDeleteTile:a.dispatchDeleteTile,dispatchShowAlert:a.dispatchShowAlert,dispatchHideAlert:a.dispatchHideAlert};n.TilePalette=(0,o.connect)((function({store:{present:e},editor:t},n){let r=e;return r?{selected:t.selectedColor,tileset:r.tileset,backgroundColor:t.backgroundColor,category:t.tilemapPalette.category,page:t.tilemapPalette.page,colors:r.colors,drawingMode:t.drawingMode,gallery:t.tileGallery,galleryOpen:t.tileGalleryOpen,referencedTiles:t.referencedTiles}:{}}),x)(v)},{"../../../assets":46,"../Button":62,"../Dropdown":64,"../Pivot":67,"../TimelineFrame":70,"../actions/dispatch":73,"../store/imageReducer":77,react:366,"react-redux":339,"react/jsx-runtime":367}],81:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.replaceColorEdit=n.outlineEdit=n.flipEdit=n.rotateEdit=n.MarqueeEdit=n.FillEdit=n.CircleEdit=n.LineEdit=n.OutlineEdit=n.RectangleEdit=n.PaintEdit=n.SelectionEdit=n.Edit=n.EditState=n.getEditState=n.getEdit=n.tools=n.ToolCursor=void 0;const r=e("./store/imageReducer");var i,o;(o=i=n.ToolCursor||(n.ToolCursor={})).None="none",o.Default="default",o.Pointer="pointer",o.Crosshair="crosshair",o.Grab="grab",o.Grabbing="grabbing",o.EyeDropper="var(--eyedropper)",n.tools=[{tool:r.ImageEditorTool.Paint,iconClass:"ms-Icon ms-Icon--Edit",title:lf("Paint Tool"),hoverCursor:i.Crosshair},{tool:r.ImageEditorTool.Erase,iconClass:"ms-Icon ms-Icon--EraseTool",title:lf("Erase Tool"),hoverCursor:i.Crosshair},{tool:r.ImageEditorTool.Rect,iconClass:"ms-Icon ms-Icon--RectangleShape",title:lf("Rectangle Tool"),hoverCursor:i.Crosshair},{tool:r.ImageEditorTool.Fill,iconClass:"ms-Icon ms-Icon--BucketColor",title:lf("Fill Tool"),hoverCursor:i.Crosshair},{tool:r.ImageEditorTool.Circle,iconClass:"ms-Icon ms-Icon--CircleRing",title:lf("Circle Tool"),hoverCursor:i.Crosshair},{tool:r.ImageEditorTool.Line,iconClass:"ms-Icon ms-Icon--Line",title:lf("Line Tool"),hoverCursor:i.Crosshair},{tool:r.ImageEditorTool.Marquee,iconClass:"ms-Icon ms-Icon--SelectAll",title:lf("Marquee Tool"),hoverCursor:i.Crosshair,hoverLayerCursor:i.Grab,downLayerCursor:i.Grabbing},{tool:r.ImageEditorTool.Pan,iconClass:"ms-Icon ms-Icon--HandsFree",title:lf("Canvas Pan Tool"),hoverCursor:i.Grab,downCursor:i.Grabbing},{tool:r.ImageEditorTool.ColorSelect,hiddenTool:!0,iconClass:"ms-Icon ms-Icon--Edit",title:lf("Color Select Tool"),hoverCursor:i.EyeDropper}],n.getEdit=function(e,t,n,i){switch(e){case r.ImageEditorTool.Paint:return new c(t.width,t.height,n,i);case r.ImageEditorTool.Rect:return new u(t.width,t.height,n,i);case r.ImageEditorTool.Fill:return new h(t.width,t.height,n,i);case r.ImageEditorTool.Line:return new d(t.width,t.height,n,i);case r.ImageEditorTool.Marquee:return new f(t.width,t.height,n,i);case r.ImageEditorTool.Circle:return new p(t.width,t.height,n,i);case r.ImageEditorTool.Erase:return new c(t.width,t.height,0,i);case r.ImageEditorTool.ColorSelect:default:return}},n.getEditState=function(e,t,n=r.TileDrawingMode.Default){const i=new s(t?pxt.sprite.Tilemap.fromData(e.bitmap).copy():pxt.sprite.Bitmap.fromData(e.bitmap).copy());let o,a,l;return e.overlayLayers&&(i.overlayLayers=e.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy()))),i.layerOffsetX=e.layerOffsetX,i.layerOffsetY=e.layerOffsetY,e.floating&&(e.floating.bitmap&&(a=t?pxt.sprite.Tilemap.fromData(e.floating.bitmap).copy():pxt.sprite.Bitmap.fromData(e.floating.bitmap).copy()),e.floating.overlayLayers&&(l=e.floating.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy()))),o={image:a,overlayLayers:l}),i.floating=o,i.setActiveLayer(n),i};class s{constructor(e){this.activeLayerIndex=-1,this.image=e,this.layerOffsetX=0,this.layerOffsetY=0}get width(){return this.image.width}get height(){return this.image.height}get activeLayer(){return this.activeLayerIndex<0?this.image:this.overlayLayers[this.activeLayerIndex]}setActiveLayer(e){switch(e){case r.TileDrawingMode.Wall:this.activeLayerIndex=0;break;default:this.activeLayerIndex=-1}}copy(){const e=new s;if(e.image=this.image.copy(),e.overlayLayers=this.overlayLayers&&this.overlayLayers.map((e=>e.copy())),this.floating){let t,n;this.floating.image&&(t=this.floating.image.copy()),this.floating.overlayLayers&&(n=this.floating.overlayLayers.map((e=>e.copy()))),e.floating={image:t,overlayLayers:n}}return e.layerOffsetX=this.layerOffsetX,e.layerOffsetY=this.layerOffsetY,e}equals(e){return!(!this.image.equals(e.image)||this.floating&&!e.floating||!this.floating&&e.floating)&&(!this.floating||!this.floating.image||this.floating.image.equals(e.floating.image)&&this.layerOffsetX===e.layerOffsetX&&this.layerOffsetY===e.layerOffsetY)}mergeFloatingLayer(){this.floating&&(this.floating.image||this.floating.overlayLayers)&&(this.floating.image&&(this.floating.image.x0=this.layerOffsetX,this.floating.image.y0=this.layerOffsetY,this.image.apply(this.floating.image,!0),this.floating.image=void 0),this.floating.overlayLayers&&(this.floating.overlayLayers.forEach(((e,t)=>{e.x0=this.layerOffsetX,e.y0=this.layerOffsetY,this.overlayLayers[t].apply(e,!0)})),this.floating.overlayLayers=void 0))}copyToLayer(e,t,n,r,i=!1){if(0===n||0===r)return;n<0&&(e+=n,n=-n),r<0&&(t+=r,r=-r);let o,s=this.image.copy(e,t,n,r);if(this.layerOffsetX=s.x0,this.layerOffsetY=s.y0,s.x0=void 0,s.y0=void 0,this.overlayLayers&&(o=this.overlayLayers.map((i=>i.copy(e,t,n,r)))),i)for(let i=0;i<n;i++)for(let n=0;n<r;n++)this.image.set(e+i,t+n,0),this.overlayLayers&&this.overlayLayers.forEach((r=>r.set(e+i,t+n,0)));this.floating={image:s,overlayLayers:o}}inFloatingLayer(e,t){return!(!this.floating||!this.floating.image)&&(e-=this.layerOffsetX,t-=this.layerOffsetY,e>=0&&e<this.floating.image.width&&t>=0&&t<this.floating.image.height)}setFloatingLayer(e,t,n){var r,i;n&&this.mergeFloatingLayer(),this.floating={image:e},this.layerOffsetX=null!==(r=null==t?void 0:t.layerOffsetX)&&void 0!==r?r:0,this.layerOffsetY=null!==(i=null==t?void 0:t.layerOffsetY)&&void 0!==i?i:0}toImageState(){return{bitmap:this.image.data(),layerOffsetX:this.layerOffsetX,layerOffsetY:this.layerOffsetY,floating:this.floating&&{bitmap:this.floating.image?this.floating.image.data():void 0,overlayLayers:this.floating.overlayLayers?this.floating.overlayLayers.map((e=>e.data())):void 0},overlayLayers:this.overlayLayers?this.overlayLayers.map((e=>e.data())):void 0}}}n.EditState=s;class a{constructor(e,t,n,r){this.canvasWidth=e,this.canvasHeight=t,this.color=n,this.toolWidth=r}doEdit(e){this.isStarted&&this.doEditCore(e)}inBounds(e,t){return e>=0&&e<this.canvasWidth&&t>=0&&t<this.canvasHeight}start(e,t,n,r,i){this.isStarted=!0,this.startCol=e,this.startRow=t,this.startX=n,this.startY=r}drawCursor(e,t,n){n(e,t)}}n.Edit=a;class l extends a{update(e,t){this.endCol=e,this.endRow=t,this.isDragged||e==this.startCol&&t==this.startRow||(this.isDragged=!0)}topLeft(){return{x:Math.min(this.startCol,this.endCol),y:Math.min(this.startRow,this.endRow)}}bottomRight(){return{x:Math.max(this.startCol,this.endCol),y:Math.max(this.startRow,this.endRow)}}}n.SelectionEdit=l;class c extends a{constructor(e,t,n,r){super(e,t,n,r),this.showPreview=!0,this.mask=new pxt.sprite.Bitmask(e,t)}update(e,t){this.interpolate(this.startCol,this.startRow,e,t),this.startCol=e,this.startRow=t}interpolate(e,t,n,r){const i=n-e,o=r-t,s=(e,t)=>this.mask.set(e,t);if(0===i){const n=o>=0?r:t;for(let i=o>=0?t:r;i<=n;i++)this.drawCore(e,i,s);return}const a=i>0?1:-1,l=o>0?1:-1,c=Math.abs(o/i);let u=0,d=t;for(let t=e;a>0?t<=n:t>=n;t+=a)for(this.drawCore(t,d,s),u+=c;u>=.5;)(l>0?d<=r:d>=r)&&this.drawCore(t,d,s),d+=l,u-=1}doEditCore(e){e.mergeFloatingLayer();for(let t=0;t<e.width;t++)for(let n=0;n<e.height;n++)this.mask.get(t,n)&&e.activeLayer.set(t,n,this.color)}drawCursor(e,t,n){this.drawCore(e,t,n)}drawCore(e,t,n){e-=Math.floor(this.toolWidth/2),t-=Math.floor(this.toolWidth/2);for(let r=0;r<this.toolWidth;r++)for(let i=0;i<this.toolWidth;i++){const o=e+r,s=t+i;o>=0&&o<this.canvasWidth&&s>=0&&s<this.canvasHeight&&n(e+r,t+i)}}}n.PaintEdit=c;n.RectangleEdit=class extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer();const t=this.topLeft(),n=this.bottomRight();for(let r=t.x;r<=n.x;r++)for(let i=t.y;i<=n.y;i++)e.activeLayer.set(r,i,this.color)}};class u extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer();let t=this.topLeft();t.x-=this.toolWidth>>1,t.y-=this.toolWidth>>1;let n=this.bottomRight();n.x+=this.toolWidth>>1,n.y+=this.toolWidth>>1;for(let r=0;r<this.toolWidth;r++)this.drawRectangle(e,{x:t.x+r,y:t.y+r},{x:n.x-r,y:n.y-r})}drawRectangle(e,t,n){if(!(t.x>n.x||t.y>n.y)){for(let r=t.x;r<=n.x;r++)e.activeLayer.set(r,t.y,this.color),e.activeLayer.set(r,n.y,this.color);for(let r=t.y;r<=n.y;r++)e.activeLayer.set(t.x,r,this.color),e.activeLayer.set(n.x,r,this.color)}}drawCursor(e,t,n){this.drawCore(e,t,n)}drawCore(e,t,n){e-=Math.floor(this.toolWidth/2),t-=Math.floor(this.toolWidth/2);for(let r=0;r<this.toolWidth;r++)for(let i=0;i<this.toolWidth;i++){const o=e+r,s=t+i;o>=0&&o<this.canvasWidth&&s>=0&&s<this.canvasHeight&&n(e+r,t+i)}}}n.OutlineEdit=u;class d extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer(),this.bresenham(this.startCol,this.startRow,this.endCol,this.endRow,e)}bresenham(e,t,n,r,i){const o=n-e,s=r-t,a=(e,t)=>i.activeLayer.set(e,t,this.color);if(0===o){const n=s>=0?r:t;for(let i=s>=0?t:r;i<=n;i++)this.drawCore(e,i,a);return}const l=o>0?1:-1,c=s>0?1:-1,u=Math.abs(s/o);let d=0,p=t;for(let t=e;l>0?t<=n:t>=n;t+=l)for(this.drawCore(t,p,a),d+=u;d>=.5;)(c>0?p<=r:p>=r)&&this.drawCore(t,p,a),p+=c,d-=1}drawCursor(e,t,n){this.drawCore(e,t,n)}drawCore(e,t,n){e-=Math.floor(this.toolWidth/2),t-=Math.floor(this.toolWidth/2);for(let r=0;r<this.toolWidth;r++)for(let i=0;i<this.toolWidth;i++)n(e+r,t+i)}}n.LineEdit=d;class p extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer();const t=this.topLeft(),n=this.bottomRight(),r=n.x-t.x,i=n.y-t.y,o=Math.floor(Math.hypot(r,i)),s=this.startCol,a=this.startRow;this.midpoint(s,a,o,e)}midpoint(e,t,n,r){let i=n-1,o=0,s=1,a=1,l=s-2*n;for(;i>=o;)r.activeLayer.set(e+i,t+o,this.color),r.activeLayer.set(e+i,t-o,this.color),r.activeLayer.set(e+o,t+i,this.color),r.activeLayer.set(e+o,t-i,this.color),r.activeLayer.set(e-o,t+i,this.color),r.activeLayer.set(e-o,t-i,this.color),r.activeLayer.set(e-i,t+o,this.color),r.activeLayer.set(e-i,t-o,this.color),l<=0&&(o++,l+=a,a+=2),l>0&&(i--,l+=(s+=2)-2*n)}}n.CircleEdit=p;class h extends a{constructor(){super(...arguments),this.showPreview=!0}start(e,t,n,r,i){this.isStarted=!0,this.col=e,this.row=t}update(e,t){this.col=e,this.row=t}doEditCore(e){const t=e.activeLayer!==e.image,n=(n,r)=>(t?e.activeLayer.get(n,r)+1<<8:0)+e.image.get(n,r),r=n(this.col,this.row);if(r===this.color)return;e.mergeFloatingLayer();const i=new pxt.sprite.Bitmask(e.width,e.height);i.set(this.col,this.row);const o=[{x:this.col,y:this.row}];for(;o.length;){const t=o.pop();n(t.x,t.y)===r&&(e.activeLayer.set(t.x,t.y,this.color),s(t.x+1,t.y),s(t.x-1,t.y),s(t.x,t.y+1),s(t.x,t.y-1))}function s(e,t){e>=0&&e<i.width&&t>=0&&t<i.height&&!i.get(e,t)&&(i.set(e,t),o.push({x:e,y:t}))}}}n.FillEdit=h;class f extends l{constructor(){super(...arguments),this.isMove=!1,this.isResize=!1,this.showPreview=!1}start(e,t,n,r,i){this.isStarted=!0,this.startCol=e,this.startRow=t;const o=document.elementFromPoint(n,r);if(i.floating&&i.floating.image)if(o&&"image-editor-floating-layer-corner"==o.className){this.isResize=!0,this.startOffsetX=i.layerOffsetX,this.startOffsetY=i.layerOffsetY;let e,t=0;const o=document.getElementsByClassName("image-editor-floating-layer-corner");for(let i=0;i<o.length;i++){let s=Math.sqrt(Math.pow(o[i].getBoundingClientRect().x-n,2)+Math.pow(o[i].getBoundingClientRect().y-r,2));s>t&&(t=s,e=o[i])}const s=document.getElementsByClassName("paint-surface");let a;for(let e=0;e<s.length;e++)s[e].className.includes("main")&&(a=s[e]);const l=a.getBoundingClientRect().left,c=a.getBoundingClientRect().top,u=a.getBoundingClientRect().width,d=a.getBoundingClientRect().height;this.anchorCol=(e.getBoundingClientRect().x-l)/u*this.canvasWidth,this.anchorRow=(e.getBoundingClientRect().y-c)/d*this.canvasHeight,this.originalImage||(this.originalImage=i.floating.image.copy())}else i.inFloatingLayer(e,t)&&(this.isMove=!0,this.startOffsetX=i.layerOffsetX,this.startOffsetY=i.layerOffsetY)}inBounds(e,t){return this.isMove||super.inBounds(e,t)}doEditCore(e){const t=this.topLeft(),n=this.bottomRight();if(this.isDragged)if(this.isMove)e.layerOffsetX=this.startOffsetX+this.endCol-this.startCol,e.layerOffsetY=this.startOffsetY+this.endRow-this.startRow;else if(this.isResize){const t=Math.round(Math.abs(this.anchorCol-this.endCol)),n=Math.round(Math.abs(this.anchorRow-this.endRow)),r=function(e,t,n){const r=new pxt.sprite.Bitmap(t,n,0,0);for(let i=0;i<t;i++)for(let o=0;o<n;o++){const s=Math.floor(i/t*e.width),a=Math.floor(o/n*e.height),l=e.get(s,a);r.set(i,o,l)}return r}(this.originalImage,t,n);e.setFloatingLayer(r,{layerOffsetX:Math.round(Math.min(this.anchorCol,this.endCol)),layerOffsetY:Math.round(Math.min(this.anchorRow,this.endRow))},!1)}else e.mergeFloatingLayer(),e.copyToLayer(t.x,t.y,n.x-t.x+1,n.y-t.y+1,!0);else this.isMove||e.mergeFloatingLayer()}}n.MarqueeEdit=f,n.rotateEdit=function(e,t,n,r){var i;const o=!!(null===(i=e.floating)||void 0===i?void 0:i.image),a=o?e.floating:e,l=n?new pxt.sprite.Tilemap(a.image.height,a.image.width):new pxt.sprite.Bitmap(a.image.height,a.image.width),c=a.overlayLayers?a.overlayLayers.map((e=>new pxt.sprite.Bitmap(e.height,e.width))):void 0;for(let e=0;e<a.image.width;e++)for(let t=0;t<a.image.height;t++)d(a.image,l,e,t),c&&c.forEach(((n,r)=>d(a.overlayLayers[r],n,e,t)));const u=l.width===l.height&&l.width===e.image.width&&e.image.width===e.image.height;if(!r&&!o||u){const e=new s(l);return e.overlayLayers=c,e}if(!o)for(let t=0;t<e.width;t++)for(let n=0;n<e.height;n++)e.image.set(t,n,0),e.overlayLayers&&e.overlayLayers.forEach((e=>null==e?void 0:e.set(t,n,0)));return(l.width===e.image.height&&l.height===e.image.width||l.width===e.image.width&&l.height===e.image.height)&&(e.layerOffsetX=(e.width>>1)-(l.width>>1),e.layerOffsetY=(e.height>>1)-(l.height>>1)),e.floating={image:l,overlayLayers:c},e;function d(e,n,r,i){t?n.set(i,r,e.get(r,e.height-i-1)):n.set(i,r,e.get(e.width-r-1,i))}},n.flipEdit=function(e,t,n){var r,i;const o=(null===(r=e.floating)||void 0===r?void 0:r.image)?e.floating:e,a=n?new pxt.sprite.Tilemap(o.image.width,o.image.height):new pxt.sprite.Bitmap(o.image.width,o.image.height),l=o.overlayLayers?o.overlayLayers.map((e=>new pxt.sprite.Bitmap(e.width,e.height))):void 0;for(let e=0;e<o.image.width;e++)for(let t=0;t<o.image.height;t++)c(o.image,a,e,t),l&&l.forEach(((n,r)=>c(o.overlayLayers[r],n,e,t)));if(null===(i=e.floating)||void 0===i?void 0:i.image)return e.floating={image:a,overlayLayers:l},e;{const e=new s(a);return e.overlayLayers=l,e}function c(e,n,r,i){t?n.set(r,i,e.get(r,e.height-i-1)):n.set(r,i,e.get(e.width-r-1,i))}},n.outlineEdit=function(e,t){var n,r;const i=(null===(n=e.floating)||void 0===n?void 0:n.image)?e.floating:e,o=e.copy(),s=(null===(r=null==e?void 0:e.floating)||void 0===r?void 0:r.image)?o.floating.image:o.image;for(let e=0;e<i.image.width;e++)for(let n=0;n<i.image.height;n++)0===i.image.get(e,n)&&(0===i.image.get(e-1,n)&&0===i.image.get(e,n-1)&&0===i.image.get(e+1,n)&&0===i.image.get(e,n+1)||s.set(e,n,t));return o},n.replaceColorEdit=function(e,t,n){var r,i;const o=(null===(r=e.floating)||void 0===r?void 0:r.image)?e.floating:e,s=e.copy(),a=(null===(i=null==e?void 0:e.floating)||void 0===i?void 0:i.image)?s.floating.image:s.image;for(let e=0;e<o.image.width;e++)for(let r=0;r<o.image.height;r++)o.image.get(e,r)===t&&a.set(e,r,n);return s}},{"./store/imageReducer":77}],82:[function(e,t,n){"use strict";function r(){return"undefined"!=typeof window&&!!window.PointerEvent}function i(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&navigator.maxTouchPoints>0)}var o;Object.defineProperty(n,"__esModule",{value:!0}),n.createTilemapPatchFromFloatingLayer=n.applyBitmapData=n.imageStateToTilemap=n.imageStateToBitmap=n.bindGestureEvents=n.GestureState=n.fireClickOnlyOnEnter=n.clientCoord=n.pointerEvents=n.Bitmask=n.MapTools=n.isBitmapSupported=n.isTouchEnabled=n.hasPointerEvents=n.DRAG_RADIUS=void 0,n.DRAG_RADIUS=3,n.hasPointerEvents=r,n.isTouchEnabled=i,n.isBitmapSupported=function(){return!!window.createImageBitmap},(o=n.MapTools||(n.MapTools={}))[o.Pan=0]="Pan",o[o.Stamp=1]="Stamp",o[o.Object=2]="Object",o[o.Erase=3]="Erase";function s(e){if(e.touches){const t=e;return t.touches.length?t.touches[0]:t.changedTouches[0]}return e}n.Bitmask=class{constructor(e,t){this.width=e,this.height=t,this.mask=new Uint8Array(Math.ceil(e*t/8))}set(e,t){const n=e+this.width*t,r=n>>3,i=7&n;this.mask[r]|=1<<i}get(e,t){const n=e+this.width*t,r=n>>3,i=7&n;return this.mask[r]>>i&1}},n.pointerEvents=r()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:i()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"},n.clientCoord=s,n.fireClickOnlyOnEnter=function(e){13===("number"==typeof e.which?e.which:e.keyCode)&&(e.preventDefault(),e.currentTarget.click())};class a{constructor(e,t,n){this.target=e,this.isRightClick=n,this.startX=t.clientX,this.startY=t.clientY,this.currentX=t.clientX,this.currentY=t.clientY}update(e){this.currentX=e.clientX,this.currentY=e.clientY,!this.isDrag&&this.distance()>n.DRAG_RADIUS?(this.isDrag=!0,this.target.onDragStart(e,this.isRightClick)):this.isDrag&&this.target.onDragMove(e)}end(e){e&&this.update(e),e=e||{clientX:this.currentX,clientY:this.currentY},this.isDrag?this.target.onDragEnd(e):this.target.onClick(e,this.isRightClick)}distance(){return Math.sqrt(Math.pow(this.currentX-this.startX,2)+Math.pow(this.currentY-this.startY,2))}}function l(e,t){for(let n=0;n<e.changedTouches.length;n++)if(e.changedTouches[n].identifier===t)return e.changedTouches[n]}function c(e){return e.button>0}n.GestureState=a,n.bindGestureEvents=function(e,t){r()?function(e,t){let n;e.addEventListener("pointerup",(e=>{n&&(n.end(s(e)),e.preventDefault()),n=void 0})),e.addEventListener("pointerdown",(e=>{n&&n.end(),n=new a(t,s(e),c(e)),e.preventDefault()})),e.addEventListener("pointermove",(e=>{n&&(n.update(s(e)),e.preventDefault())})),e.addEventListener("pointerleave",(e=>{n&&(n.end(s(e)),e.preventDefault()),n=void 0}))}(e,t):i()?function(e,t){let n,r;e.addEventListener("touchend",(e=>{if(n&&r){const t=l(e,r);t&&(n.end(t),n=void 0,e.preventDefault())}})),e.addEventListener("touchstart",(e=>{n&&n.end(),r=e.changedTouches[0].identifier,n=new a(t,e.changedTouches[0],c(e))})),e.addEventListener("touchmove",(e=>{if(n&&r){const t=l(e,r);t&&(n.update(t),e.preventDefault())}})),e.addEventListener("touchcancel",(e=>{if(n&&r){const t=l(e,r);t&&(n.end(t),n=void 0,e.preventDefault())}}))}(e,t):function(e,t){let n;e.addEventListener("mouseup",(e=>{n&&n.end(s(e)),n=void 0})),e.addEventListener("mousedown",(e=>{n&&n.end(),n=new a(t,s(e),c(e))})),e.addEventListener("mousemove",(e=>{n&&n.update(s(e))})),e.addEventListener("mouseleave",(e=>{n&&n.end(s(e)),n=void 0}))}(e,t)},n.imageStateToBitmap=function(e){const t=pxt.sprite.Bitmap.fromData(e.bitmap).copy();if(e.floating&&e.floating.bitmap){const n=pxt.sprite.Bitmap.fromData(e.floating.bitmap);n.x0=e.layerOffsetX||0,n.y0=e.layerOffsetY||0,t.apply(n,!0)}return t},n.imageStateToTilemap=function(e){const t=pxt.sprite.Tilemap.fromData(e.bitmap).copy();if(e.floating&&e.floating.bitmap){const n=pxt.sprite.Tilemap.fromData(e.floating.bitmap);n.x0=e.layerOffsetX||0,n.y0=e.layerOffsetY||0,t.apply(n,!0)}return t},n.applyBitmapData=function(e,t,n=0,r=0){if(!e||!t)return e;const i=pxt.sprite.Bitmap.fromData(e),o=pxt.sprite.Bitmap.fromData(t);return o.x0=n,o.y0=r,i.apply(o,!0),i.data()},n.createTilemapPatchFromFloatingLayer=function(e,t){if(!e.floating)return;const n=pxt.sprite.Tilemap.fromData(e.floating.image.data()),r=new pxt.sprite.Tilemap(n.width,n.height),i=e.floating.overlayLayers?e.floating.overlayLayers.map((e=>pxt.sprite.base64EncodeBitmap(e.data()))):[];let o=[];for(let e=0;e<n.width;e++)for(let i=0;i<n.height;i++){const s=t.tiles[n.get(e,i)],a=o.indexOf(s);-1===a?(r.set(e,i,o.length),o.push(s)):r.set(e,i,a)}return{map:pxt.sprite.hexEncodeTilemap(r),layers:i,tiles:o.map((e=>pxt.sprite.base64EncodeBitmap(e.bitmap)))}}},{}],83:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ImageFieldEditor=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("./assetEditor/assetCard"),s=e("../assets"),a=e("./ImageEditor/ImageEditor"),l=e("./ImageEditor/keyboardShortcuts"),c=e("./ImageEditor/store/imageReducer"),u=e("./FilterPanel"),d=e("../util"),p=e("../../../react-common/components/controls/EditorToggle"),h=e("./MusicFieldEditor"),f=e("../../../react-common/components/util");class g extends i.Component{constructor(e){super(e),this.tagClickHandler=e=>{let t=this.state.gallerySelectedTags;const n=e.toLowerCase(),r=t.indexOf(n);r<0?t.push(n):t.splice(r,1),this.setState({gallerySelectedTags:t})},this.clearFilterTags=()=>{this.setState({gallerySelectedTags:[]})},this.toggleFilter=()=>{this.setState({filterOpen:!this.state.filterOpen})},this.showEditor=()=>{this.setImageEditorShortcutsEnabled(!0),v("gallery-editor"),this.setState({currentView:"editor",tileGalleryVisible:!1})},this.showGallery=()=>{this.setImageEditorShortcutsEnabled(!1),v("gallery-builtin"),this.setState({currentView:"gallery",tileGalleryVisible:!1})},this.showMyAssets=()=>{this.setImageEditorShortcutsEnabled(!1),v("gallery-my-assets"),this.userAssets=(0,s.getAssets)(void 0,void 0,this.options.temporaryAssets),this.setState({currentView:"my-assets",tileGalleryVisible:!1})},this.toggleTileGallery=()=>{this.state.tileGalleryVisible?this.setState({tileGalleryVisible:!1}):this.setState({tileGalleryVisible:!0,currentView:"editor"})},this.onAssetSelected=e=>{var t,n;if(this.ref&&e.id!==(null===(t=this.asset)||void 0===t?void 0:t.id))if(this.state.editingTile)this.ref.openInTileEditor(pxt.sprite.Bitmap.fromData(e.bitmap));else if("gallery"===this.state.currentView)this.ref.openGalleryAsset(e);else{const t=pxt.react.getTilemapProject();"tilemap"===(null===(n=this.asset)||void 0===n?void 0:n.type)&&pxt.sprite.updateTilemapReferencesFromResult(t,this.asset),this.asset.meta.displayName?t.updateAsset(this.asset):e.meta.displayName||(e=Object.assign(Object.assign({},pxt.cloneAsset(e)),{id:this.asset.id,meta:this.asset.meta})),"tilemap"===e.type&&pxt.sprite.addMissingTilemapTilesAndReferences(t,e),this.ref.openAsset(e,void 0,!0)}v("gallery-selection"),this.setState({currentView:"editor",tileGalleryVisible:!1}),this.setImageEditorShortcutsEnabled(!0)},this.onTileEditorOpenClose=e=>{this.setState({editingTile:e})},this.onDoneClick=()=>{this.closeEditor&&this.closeEditor(),this.props.doneButtonCallback&&this.props.doneButtonCallback()},this.state={currentView:"editor",headerVisible:!0,filterOpen:!1,gallerySelectedTags:[],galleryFilter:""},(0,c.setTelemetryFunction)(v)}get asset(){var e;return null===(e=this.ref)||void 0===e?void 0:e.getAsset()}render(){var e,t;const{currentView:n,headerVisible:i,editingTile:o,hideMyAssets:s,filterOpen:l,hideCloseButton:c}=this.state,g="gallery"===this.state.currentView&&l;let v=i;const y=!this.props.isMusicEditor&&(!this.asset||o||"tilemap"!==this.asset.type),b=!s&&!o;this.asset&&!this.galleryAssets&&y&&this.updateGalleryAssets();const x=this.props.includeSpecialTagsInFilter?[]:["tile","dialog","background"];let E=[],_=[];switch(n){case"my-assets":_=this.filterAssetsByType(this.userAssets,o?"tile":null===(e=this.asset)||void 0===e?void 0:e.type),E=this.getAvailableTags(_,x);break;case"gallery":_=this.filterAssetsByType(this.galleryAssets,o?"tile":null===(t=this.asset)||void 0===t?void 0:t.type,!0,!0),E=this.getAvailableTags(_,x),_=this.filterAssetsByTag(_)}const w=[{label:lf("Editor"),title:lf("Editor"),focusable:!0,icon:"fas fa-paint-brush",onClick:this.showEditor,view:"editor"},{label:lf("Gallery"),title:lf("Gallery"),focusable:!0,icon:"fas fa-image",onClick:this.showGallery,view:"gallery"},{label:lf("My Assets"),title:lf("My Assets"),focusable:!0,icon:"fas fa-folder",onClick:this.showMyAssets,view:"my-assets"}];return y||b?y?b||w.splice(2,1):w.splice(1,1):v=!1,(0,r.jsxs)("div",Object.assign({className:(0,f.classList)("image-editor-wrapper",this.props.isMusicEditor&&"music-asset-editor")},{children:[v&&(0,r.jsxs)("div",Object.assign({className:"gallery-editor-header"},{children:[(0,r.jsx)("div",{className:"image-editor-header-left"}),(0,r.jsx)("div",Object.assign({className:"image-editor-header-center"},{children:(0,r.jsx)(p.EditorToggle,{id:"image-editor-toggle",className:"slim tablet-compact",items:w,selected:w.findIndex((e=>e.view===n))})})),(0,r.jsxs)("div",Object.assign({className:"image-editor-header-right"},{children:[(0,r.jsxs)("div",Object.assign({className:"gallery-filter-button "+("gallery"===this.state.currentView?"":"hidden"),role:"button",onClick:this.toggleFilter,onKeyDown:d.fireClickOnEnter},{children:[(0,r.jsx)("div",Object.assign({className:"gallery-filter-button-icon"},{children:(0,r.jsx)("i",{className:"icon filter"})})),(0,r.jsx)("div",Object.assign({className:"gallery-filter-button-label"},{children:lf("Filter")}))]})),!o&&!c&&(0,r.jsx)("div",Object.assign({className:"image-editor-close-button",role:"button",onClick:this.onDoneClick},{children:(0,r.jsx)("i",{className:"ui icon close"})}))]}))]})),(0,r.jsxs)("div",Object.assign({className:"image-editor-gallery-window"},{children:[(0,r.jsxs)("div",Object.assign({className:"image-editor-gallery-content"},{children:[this.props.isMusicEditor?(0,r.jsx)(h.MusicFieldEditor,{ref:"image-editor",onDoneClicked:this.onDoneClick,hideDoneButton:this.props.hideDoneButton}):(0,r.jsx)(a.ImageEditor,{ref:"image-editor",singleFrame:this.props.singleFrame,onDoneClicked:this.onDoneClick,onTileEditorOpenClose:this.onTileEditorOpenClose,lightMode:this.lightMode,hideDoneButton:this.props.hideDoneButton}),(0,r.jsx)(m,{items:_,hidden:"editor"===n,onAssetSelected:this.onAssetSelected})]})),(0,r.jsx)("div",Object.assign({className:"filter-panel-gutter "+(g?"":"hidden")},{children:(0,r.jsx)("div",Object.assign({className:"filter-panel-container"},{children:(0,r.jsx)(u.FilterPanel,{enabledTags:this.state.gallerySelectedTags,tagClickHandler:this.tagClickHandler,clearTags:this.clearFilterTags,tagOptions:E})}))}))]}))]}))}componentDidMount(){this.ref=this.refs["image-editor"],v("image-editor-shown")}componentWillUnmount(){v("image-editor-hidden"),this.galleryAssets=void 0,this.userAssets=void 0}init(e,t,n){switch(this.closeEditor=t,this.options=n,this.lightMode=n.lightMode,e.type){case"image":this.initSingleFrame(e,n);break;case"tile":n.disableResize=!0,this.initSingleFrame(e,n);break;case"animation":this.initAnimation(e,n);break;case"tilemap":this.initTilemap(e,n);break;case"song":this.ref.openAsset(e)}this.editID=e.id;let r=!1;n&&(this.blocksInfo=n.blocksInfo,n.filter&&(this.setState({galleryFilter:n.filter}),r=!0),null!=n.headerVisible&&(this.setState({headerVisible:n.headerVisible}),r=!0),null!=n.hideMyAssets&&(this.setState({hideMyAssets:n.hideMyAssets}),r=!0),null!=n.hideCloseButton&&(this.setState({hideCloseButton:n.hideCloseButton}),r=!0)),r||this.forceUpdate()}getValue(){return this.ref?this.ref.getAsset():null}getJres(){return this.ref?this.ref.getJres():""}getPersistentData(){return this.ref?this.ref.getPersistentData():null}restorePersistentData(e){this.ref&&(this.ref.restorePersistentData(e),this.options&&this.options.disableResize&&this.ref.disableResize())}onResize(){this.ref&&this.ref.onResize()}updateGalleryAssets(){this.galleryAssets=(0,s.getAssets)(!0,this.asset.type)}getAvailableTags(e,t){let n=[];return this.galleryAssets?(e.forEach((e=>{var r;null===(r=e.meta.tags)||void 0===r||r.forEach((e=>{const r=function(e){let t=0===e.indexOf("?")&&e.length>1?e.substring(1):e;return t.toLowerCase()}(e);t.indexOf(r)<0&&n.indexOf(r)<0&&n.push(r)}))})),n):[]}filterAssetsByTag(e){return this.state.gallerySelectedTags.length>0&&this.state.filterOpen&&(e=e.filter((e=>{var t;return!!(null===(t=e.meta.tags)||void 0===t?void 0:t.find((e=>this.state.gallerySelectedTags.indexOf(e)>=0)))}))),e}filterAssetsByType(e,t,n=!1,r){var i;if(void 0===t&&(t=null===(i=this.asset)||void 0===i?void 0:i.type),void 0===t)return e;if(this.asset&&!n&&(e=e.map((e=>e.type!==this.asset.type||e.id!==this.asset.id?e:(0,s.assetToGalleryItem)(this.getValue()))),this.state.editingTile)){const t=this.ref.getAsset();e=e.map((e=>{var n;return(null===(n=t.data.editedTiles)||void 0===n?void 0:n.indexOf(e.id))>=0?(0,s.assetToGalleryItem)(t.data.tileset.tiles.find((t=>t.id===e.id))):e}))}if(r){e.forEach((e=>{var t,n,r;!e.meta.tags&&this.options&&(e.meta.tags=(null===(r=null===(n=null===(t=this.blocksInfo)||void 0===t?void 0:t.apis.byQName[e.id])||void 0===n?void 0:n.attributes.tags)||void 0===r?void 0:r.split(" "))||[])}));const t=this.state.galleryFilter.split(" ").filter((e=>!!e)).map((e=>e.toLowerCase())),n=t.filter((e=>0!==e.indexOf("!"))),r=t.filter((e=>0===e.indexOf("!")&&e.length>1)).map((e=>e.substring(1)));e=e.filter((e=>function(e,t){const n=e.meta.tags?e.meta.tags:[];return t.every((e=>{const t=`?${e}`;return n.some((n=>n===e||n===t))}))}(e,n)&&function(e,t){const n=e.meta.tags?e.meta.tags:[];return t.every((e=>!n.some((t=>t===e))))}(e,r)))}if(n)switch(t){case"animation":return e.filter((e=>"animation"===e.type||"tile"===e.type||"image"===e.type));case"image":return e.filter((e=>"tile"===e.type||"image"===e.type));case"tile":return e.filter((e=>"tile"===e.type));case"tilemap":return e.filter((e=>"tilemap"===e.type));case"song":return e.filter((e=>"song"===e.type))}else switch(t){case"animation":return e.filter((e=>"animation"===e.type));case"image":return e.filter((e=>"image"===e.type));case"tile":return e.filter((e=>"tile"===e.type));case"tilemap":return e.filter((e=>"tilemap"===e.type));case"song":return e.filter((e=>"song"===e.type))}}initSingleFrame(e,t){this.ref.openAsset(e),t.disableResize&&this.ref.disableResize()}initAnimation(e,t){this.ref.openAsset(e),t.disableResize&&this.ref.disableResize()}initTilemap(e,t){let n;(null==t?void 0:t.blocksInfo)&&(this.blocksInfo=t.blocksInfo,n=pxt.sprite.filterItems(pxt.sprite.getGalleryItems(this.blocksInfo,"Image"),["tile"]).map((e=>({bitmap:pxt.sprite.getBitmap(this.blocksInfo,e.qName).data(),tags:e.tags,qualifiedName:e.qName,tileWidth:16})))),(null==t?void 0:t.galleryTiles)&&(n=t.galleryTiles.map((e=>({bitmap:e.bitmap,tags:e.tags,qualifiedName:e.qName,tileWidth:16})))),this.ref.openAsset(e,n)}loadJres(e){this.ref&&this.ref.loadJres(e)}setImageEditorShortcutsEnabled(e){e&&this.shortcutLock?((0,l.releaseShortcutLock)(this.shortcutLock),this.shortcutLock=void 0):e||this.shortcutLock||(this.shortcutLock=(0,l.obtainShortcutLock)())}}n.ImageFieldEditor=g;class m extends i.Component{constructor(){super(...arguments),this.clickHandler=e=>{this.props.onAssetSelected(e)}}render(){let{items:e,hidden:t}=this.props;return(0,r.jsx)("div",Object.assign({className:"image-editor-gallery "+(e&&!t?"visible":"")},{children:!t&&e&&e.map(((e,t)=>(0,r.jsx)(o.AssetCardView,{asset:e,selected:!1,onClick:this.clickHandler},t)))}))}}i.Component;function v(e){pxt.tickEvent("image.editor",{action:e})}},{"../../../react-common/components/controls/EditorToggle":8,"../../../react-common/components/util":41,"../assets":46,"../util":206,"./FilterPanel":59,"./ImageEditor/ImageEditor":66,"./ImageEditor/keyboardShortcuts":75,"./ImageEditor/store/imageReducer":77,"./MusicFieldEditor":84,"./assetEditor/assetCard":89,react:366,"react/jsx-runtime":367}],84:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MusicFieldEditor=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("./musicEditor/MusicEditor");class s extends i.Component{constructor(e){super(e),this.onSongChanged=e=>{this.mostRecentValue=e},this.onAssetNameChanged=e=>{this.setState({editingSong:Object.assign(Object.assign({},this.state.editingSong),{meta:Object.assign(Object.assign({},this.state.editingSong.meta),{displayName:e})})})},this.state={editRef:0}}render(){const{onDoneClicked:e}=this.props,{editingSong:t}=this.state;return(0,r.jsx)("div",Object.assign({className:"music-field-editor"},{children:t&&(0,r.jsx)(o.MusicEditor,{asset:t,onSongChanged:this.onSongChanged,onAssetNameChanged:this.onAssetNameChanged,editRef:this.state.editRef,onDoneClicked:e,hideDoneButton:this.props.hideDoneButton})}))}getAsset(){if(this.state.editingSong)return Object.assign(Object.assign({},this.state.editingSong),{song:this.mostRecentValue||this.state.editingSong.song})}openAsset(e){pxt.assets.music.inflateSong(e.song),this.setState({editingSong:e,editRef:this.state.editRef+1})}openGalleryAsset(e){}getJres(){return""}loadJres(e){}disableResize(){}onResize(){}getPersistentData(){}restorePersistentData(e){}}n.MusicFieldEditor=s},{"./musicEditor/MusicEditor":103,react:366,"react/jsx-runtime":367}],85:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SimRecorderImpl=void 0;const r=e("react/jsx-runtime"),i=e("../simulator"),o=e("react"),s=e("../screenshot"),a=e("../app");let l;n.SimRecorderImpl=e=>{const{onSimRecorderInit:t}=e,[n,c]=o.useState(void 0);let u;return o.useEffect((()=>{const e=i.driver.loanSimulator();c(e);const n=function(){if(l)return l;let e,t,n=[],r=[],o=[];const c=e=>{l.state=e;for(const t of n)t(e)},u=e=>{for(const t of o)t(e)},d=async()=>{if("recording"!==l.state)return;i.driver.stopRecording(),t&&clearTimeout(t),c("rendering");const n=await e.renderAsync();pxt.log(`gif: ${(null==n?void 0:n.length)||0} chars`);const o=pxt.appTarget.appTheme.simScreenshotMaxUriLength;if(n){if(o&&n.length>o)return pxt.tickEvent("gif.toobig",{size:n.length}),void u(lf("Oops! The GIF you recorded is too large. Try recording a shorter clip!"));pxt.tickEvent("gif.ok",{size:n.length})}c("default");for(const e of r)e(n,"gif");return n};return l={state:"default",addStateChangeListener:e=>{n.push(e)},addThumbnailListener:e=>{r.push(e)},addErrorListener:e=>{o.push(e)},removeStateChangeListener:e=>{n=n.filter((t=>t!==e))},removeThumbnailListener:e=>{r=r.filter((t=>t!==e))},removeErrorListener:e=>{o=o.filter((t=>t!==e))},startRecordingAsync:async()=>{if("default"!==l.state)return;if(e||(e=await s.loadGifEncoderAsync()),!e)return void u(lf("Unable to load GIF encoder. Are you offline?"));e.cancel(),e.start();const n=pxt.appTarget.appTheme.simGifWidth||160;i.driver.startRecording(n),c("recording"),t&&clearTimeout(t),t=setTimeout((()=>{"recording"===l.state&&d()}),1e4)},stopRecordingAsync:d,screenshotAsync:async()=>{const e=await(0,a.getEditorAsync)(),t=await e.requestScreenshotAsync();for(const e of r)e(t,"png");return t},gifAddFrame:(t,n)=>e.addFrame(t,n)}}(),r=e=>{"screenshot"===e.type?"recording"===n.state?n.gifAddFrame(e.data,e.delay)&&n.stopRecordingAsync():n.screenshotAsync():"start"===e.event?n.startRecordingAsync():"stop"===e.event&&n.stopRecordingAsync()};return(0,a.getEditorAsync)().then((e=>{e.pushScreenshotHandler(r),t(n)})),()=>{i.driver.unloanSimulator(),i.driver.stopRecording(),(0,a.getEditorAsync)().then((e=>{e.popScreenshotHandler()}))}}),[]),(0,r.jsx)("div",{id:"shareLoanedSimulator",ref:e=>{if(e&&(u=e,n&&u.firstChild!==n)){for(;u.firstChild;)u.firstChild.remove();u.appendChild(n)}}})}},{"../app":44,"../screenshot":183,"../simulator":192,react:366,"react/jsx-runtime":367}],86:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SimulatorPresenceBar=void 0;const r=e("react/jsx-runtime"),i=e("../../../react-common/components/controls/Button"),o=e("../simulator");function s(e){const{slot:t}=e;return(0,r.jsx)(i.Button,{className:`sim-presence-bar-player player-${t}`,title:lf("Player {0}",t),onClick:()=>{const e={type:"setactiveplayer",playerNumber:t},n={type:"multiplayer",content:"Connection",slot:t,connected:!0};o.driver.postMessage(e),o.driver.postMessage(n),o.driver.focus()}})}n.SimulatorPresenceBar=function(){return(0,r.jsxs)("div",Object.assign({className:"sim-presence-bar"},{children:[(0,r.jsx)(s,{slot:1}),(0,r.jsx)(s,{slot:2}),(0,r.jsx)(s,{slot:3}),(0,r.jsx)(s,{slot:4})]}))}},{"../../../react-common/components/controls/Button":3,"../simulator":192,"react/jsx-runtime":367}],87:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.dispatchUpdateGalleryAssets=n.dispatchUpdateUserAssets=n.dispatchChangeGalleryView=n.dispatchChangeSelectedAsset=void 0;const r=e("./types");n.dispatchChangeSelectedAsset=(e,t)=>({type:r.CHANGE_SELECTED_ASSET,assetType:e,assetId:t});n.dispatchChangeGalleryView=(e,t,n)=>({type:r.CHANGE_GALLERY_VIEW,view:e,assetType:t,assetId:n});n.dispatchUpdateUserAssets=()=>({type:r.UPDATE_USER_ASSETS});n.dispatchUpdateGalleryAssets=()=>({type:r.UPDATE_GALLERY_ASSETS})},{"./types":88}],88:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UPDATE_GALLERY_ASSETS=n.UPDATE_USER_ASSETS=n.CHANGE_GALLERY_VIEW=n.CHANGE_SELECTED_ASSET=void 0,n.CHANGE_SELECTED_ASSET="CHANGE_SELECTED_ASSET",n.CHANGE_GALLERY_VIEW="CHANGE_GALLERY_VIEW",n.UPDATE_USER_ASSETS="UPDATE_USER_ASSETS",n.UPDATE_GALLERY_ASSETS="UPDATE_GALLERY_ASSETS"},{}],89:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetCard=n.AssetCardView=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("react-redux"),s=e("./store/assetEditorReducerState"),a=e("./actions/dispatch"),l=e("./assetPreview");class c extends i.Component{constructor(){super(...arguments),this.clickHandler=()=>{const{type:e,id:t}=this.props.asset;this.props.dispatchChangeSelectedAsset(e,t)}}render(){const{asset:e,selected:t}=this.props;return(0,r.jsx)(u,{asset:e,selected:t,onClick:this.clickHandler})}}class u extends i.Component{constructor(){super(...arguments),this.clickHandler=()=>{this.props.onClick(this.props.asset)}}getDisplayIconForAsset(e){switch(e){case"tile":return"clone";case"animation":return"video";case"tilemap":return"map";case"song":return"music";case"image":default:return null}}render(){var e,t;const{asset:n,selected:i}=this.props,o=(0,s.isGalleryAsset)(n),a=this.getDisplayIconForAsset(n.type),c=a||!(null===(e=n.meta)||void 0===e?void 0:e.displayName);return(0,r.jsxs)("div",Object.assign({className:"asset-editor-card "+(i?"selected":""),onClick:this.clickHandler,role:"listitem"},{children:[(0,r.jsx)(l.AssetPreview,{asset:n}),c&&(0,r.jsxs)("div",Object.assign({className:"asset-editor-card-label"},{children:[a&&(0,r.jsx)("div",Object.assign({className:"asset-editor-card-icon"},{children:(0,r.jsx)("i",{className:`icon ${a}`})})),!(null===(t=n.meta)||void 0===t?void 0:t.displayName)&&!o&&(0,r.jsx)("div",Object.assign({className:"asset-editor-card-icon warning"},{children:(0,r.jsx)("i",{className:"icon exclamation triangle"})}))]}))]}))}}n.AssetCardView=u;const d={dispatchChangeSelectedAsset:a.dispatchChangeSelectedAsset};n.AssetCard=(0,o.connect)((function(e,t){return e?{selected:e.selectedAsset&&t.asset.id==e.selectedAsset.id}:{}}),d)(c)},{"./actions/dispatch":87,"./assetPreview":94,"./store/assetEditorReducerState":99,react:366,"react-redux":339,"react/jsx-runtime":367}],90:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetCardList=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("./assetCard");class s extends i.Component{constructor(){super(...arguments),this.hasUpdatedCards=!1,this.handleContainerRef=e=>{e&&(this.container=e,this.updateEmptyCards())},this.updateEmptyCards=pxtc.Util.throttle((()=>{if(!this.container)return;const e=this.container.firstElementChild;if(!e)return;this.emptyCards||(this.emptyCards=[]);const t=e.getBoundingClientRect(),n=this.container.getBoundingClientRect();if(!(t.width&&t.height&&n.width&&n.height))return;let r=t.width;if(e.nextElementSibling){const n=e.nextElementSibling.getBoundingClientRect();r=Math.max(r,n.left-t.left)}this.hasUpdatedCards=!0;const i=Math.floor(n.width/r),o=Math.floor(this.container.parentElement.getBoundingClientRect().height/r);let s,a,l=this.container.firstElementChild,c=0;for(;l;)l.classList.contains("empty-card")?s||(s=l):(c++,s&&this.container.insertBefore(l,s)),l=l.nextElementSibling;if((a=i*o>c?i*o-c:i-c%i)!==this.emptyCards.length)if(this.emptyCards.length>a)for(;this.emptyCards.length>a;)this.emptyCards.pop().remove();else for(let e=this.emptyCards.length;e<a;e++){const e=document.createElement("div");e.setAttribute("class","asset-editor-card empty-card"),this.container.appendChild(e),this.emptyCards.push(e)}}),100)}componentDidUpdate(){this.updateEmptyCards()}componentDidMount(){window.addEventListener("resize",this.updateEmptyCards);let e=()=>{this.hasUpdatedCards||(this.updateEmptyCards(),this.hasUpdatedCards||requestAnimationFrame(e))};requestAnimationFrame(e)}componentWillUnmount(){window.removeEventListener("resize",this.updateEmptyCards)}render(){const{assets:e}=this.props;return(0,r.jsxs)("div",Object.assign({ref:this.handleContainerRef},{children:[this.props.children,e.map((e=>(0,r.jsx)(o.AssetCard,{asset:e},e.id)))]}))}}n.AssetCardList=s},{"./assetCard":89,react:366,"react/jsx-runtime":367}],91:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetGallery=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../../package"),s=e("react-redux"),a=e("../../../../react-common/components/controls/List"),l=e("../../../../react-common/components/controls/Button"),c=e("../../../../react-common/components/controls/Modal"),u=e("./actions/dispatch"),d=e("./assetCardList"),p=e("./assetTopbar");class h extends i.Component{constructor(e){var t;super(e),this.showCreateModal=()=>{this.setState({showCreateModal:!0})},this.hideCreateModal=()=>{this.setState({showCreateModal:!1})},this.getCreateAssetHandler=e=>()=>{pxt.tickEvent("assets.create",{type:e.toString()});const t=pxt.react.getTilemapProject(),n=this.getEmptyAsset(e);this.hideCreateModal(),this.props.showAssetFieldView(n,(n=>{var r;t.pushUndo();const i=null===(r=n.meta)||void 0===r?void 0:r.displayName;switch(e){case"image":t.createNewProjectImage(n.bitmap,i);break;case"tile":t.createNewTile(n.bitmap,null,i);break;case"tilemap":t.createNewTilemapFromData(n.data,i);break;case"animation":t.createNewAnimationFromData(n.frames,n.interval,i);break;case"song":t.createNewSong(n.song,i)}o.mainEditorPkg().buildAssetsAsync().then((()=>this.props.dispatchUpdateUserAssets()))}))},this.state={showCreateModal:!1},this.assetCreateOptions=[{label:lf("Image"),icon:"picture",handler:this.getCreateAssetHandler("image")},{label:lf("Tile"),icon:"clone",handler:this.getCreateAssetHandler("tile")},{label:lf("Tilemap"),icon:"map",handler:this.getCreateAssetHandler("tilemap")},{label:lf("Animation"),icon:"video",handler:this.getCreateAssetHandler("animation")}],(null===(t=pxt.appTarget.appTheme)||void 0===t?void 0:t.songEditor)&&this.assetCreateOptions.push({label:lf("Song"),icon:"music",handler:this.getCreateAssetHandler("song")})}getEmptyAsset(e){const t=pxt.react.getTilemapProject(),n={type:e,id:"",internalID:0,meta:{displayName:pxt.getDefaultAssetDisplayName(e)}};switch(e){case"image":case"tile":n.bitmap=new pxt.sprite.Bitmap(16,16).data();break;case"tilemap":n.data=t.blankTilemap(16,16,16);case"animation":const e=n;e.frames=[new pxt.sprite.Bitmap(16,16).data()],e.interval=200;break;case"song":n.song=pxt.assets.music.getEmptySong(2)}return n}render(){var e;const{view:t,galleryAssets:n,userAssets:i,disableCreateButton:s}=this.props,{showCreateModal:u}=this.state,h=(null===(e=o.mainPkg)||void 0===e?void 0:e.config)&&o.mainPkg.getPreferredEditor()===pxt.BLOCKS_PROJECT_NAME;return(0,r.jsxs)("div",Object.assign({className:"asset-editor-gallery"},{children:[(0,r.jsx)(p.AssetTopbar,{}),(0,r.jsx)("div",Object.assign({className:"asset-editor-card-list "+(0!==t?"hidden":"")},{children:(0,r.jsx)(d.AssetCardList,Object.assign({assets:f(i,h)},{children:(0,r.jsx)(l.Button,{className:"create-new inverted",disabled:s,leftIcon:"icon huge add circle",title:lf("Create a new asset"),ariaLabel:lf("Create a new asset"),onClick:s?void 0:this.showCreateModal})}))})),(0,r.jsx)("div",Object.assign({className:"asset-editor-card-list "+(1!==t?"hidden":"")},{children:(0,r.jsx)(d.AssetCardList,{assets:n})})),u&&(0,r.jsxs)(c.Modal,Object.assign({className:"asset-editor-create-dialog",onClose:this.hideCreateModal,title:lf("Create New Asset"),parentElement:document.getElementById("root")},{children:[(0,r.jsx)("div",{children:lf("Choose your asset type from the options below:")}),(0,r.jsx)(a.List,Object.assign({className:"asset-editor-create-options"},{children:this.assetCreateOptions.map(((e,t)=>(0,r.jsx)(l.Button,{className:"asset-editor-create-button inverted",leftIcon:`icon ${e.icon}`,label:e.label,title:lf("Create a new {0} asset",e.label),ariaLabel:lf("Create a new {0} asset",e.label),onClick:e.handler},t)))}))]}))]}))}}function f(e,t){return t?e:e.filter((e=>!!e.meta.displayName))}const g={dispatchUpdateUserAssets:u.dispatchUpdateUserAssets};n.AssetGallery=(0,s.connect)((function(e,t){return e?Object.assign(Object.assign({},t),{view:e.view,userAssets:e.assets,galleryAssets:e.galleryAssets}):{}}),g)(h)},{"../../../../react-common/components/controls/Button":3,"../../../../react-common/components/controls/List":14,"../../../../react-common/components/controls/Modal":16,"../../package":179,"./actions/dispatch":87,"./assetCardList":90,"./assetTopbar":96,react:366,"react-redux":339,"react/jsx-runtime":367}],92:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetGalleryTab=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("react-redux"),s=e("./actions/dispatch");class a extends i.Component{constructor(){super(...arguments),this.handleClick=()=>{pxt.tickEvent("assets.gallerytab",{view:this.props.view.toString()}),this.props.dispatchChangeGalleryView(this.props.view)}}render(){const{title:e,selected:t}=this.props;return(0,r.jsx)("div",Object.assign({className:"asset-editor-gallery-tab "+(t?"selected":""),onClick:this.handleClick,role:"navigation"},{children:e}))}}const l={dispatchChangeGalleryView:s.dispatchChangeGalleryView};n.AssetGalleryTab=(0,o.connect)((function(e,t){return e?{selected:e.view==t.view}:{}}),l)(a)},{"./actions/dispatch":87,react:366,"react-redux":339,"react/jsx-runtime":367}],93:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetPalette=void 0;const r=e("react/jsx-runtime"),i=e("../../package"),o=e("react"),s=e("../../../../react-common/components/controls/Modal"),a=e("../../../../react-common/components/controls/Input"),l=e("../../../../react-common/components/controls/Button"),c=e("../../../../react-common/components/palette/PalettePicker"),u=e("../../../../react-common/components/palette/PaletteEditor"),d=e("../../../../react-common/components/palette/PaletteSwatch"),p=e("../../../../react-common/components/palette/Palettes");var h,f;(f=h||(h={}))[f.None=0]="None",f[f.New=1]="New",f[f.Rename=2]="Rename";n.AssetPalette=e=>{const{onClose:t}=e,[n,h]=(0,o.useState)(void 0),[f,g]=(0,o.useState)(void 0),[m,v]=(0,o.useState)(void 0),[y,b]=(0,o.useState)(!1),[x,E]=(0,o.useState)(0),[_,w]=(0,o.useState)(!1),[S,T]=(0,o.useState)(!0);(0,o.useEffect)((()=>{R()}),[]),(0,o.useEffect)((()=>{m&&!N(m.colors,f.colors)?T(!1):T(!0)}),[m]);const k=e=>{m&&(e.id!==m.id?v(e):N(m.colors,e.colors)||(P(e)?C(e):(h(Object.assign(Object.assign({},n),{palettes:Object.assign(Object.assign({},n.palettes),{[m.id]:e})})),v(e))))},C=e=>{const t={id:"custom"+n.nextPaletteID,name:lf("Custom"),colors:(null==e?void 0:e.colors)||m.colors,custom:!0};h(Object.assign(Object.assign({},n),{nextPaletteID:++n.nextPaletteID,palettes:Object.assign(Object.assign({},n.palettes),{[t.id]:t})})),v(t),E(1)},A=e=>{i.mainEditorPkg().setFile(pxt.PALETTES_FILE,JSON.stringify(n,void 0,4)),e&&(pxt.tickEvent("palette.modified",{id:m.id}),i.mainEditorPkg().updateConfigAsync((e=>e.palette=m.colors))),t(e)},j=()=>{E(0),w(!1)},I=e=>{0!==(e=e.trim()).length?(w(!1),h(Object.assign(Object.assign({},n),{palettes:Object.assign(Object.assign({},n.palettes),{[m.id]:Object.assign(Object.assign({},m),{name:e})})})),v(Object.assign(Object.assign({},m),{name:e}))):w(!0)},O=()=>{h(Object.assign(Object.assign({},n),{palettes:Object.assign(Object.assign({},n.palettes),{[m.id]:void 0})}));const e=D.findIndex((e=>e===m))+1;e<D.length?v(D[e]):v(p.Arcade),b(!1)},N=(e,t)=>{let n=!0;for(let r=0;r<e.length;r++)if(e[r].toLowerCase()!==t[r].toLowerCase()){n=!1;break}return n},R=()=>{const e=i.mainEditorPkg().lookupFile("this/"+pxt.PALETTES_FILE);let t;t=e?JSON.parse(e.content):{nextPaletteID:0,palettes:{}};const n=Object.values(null==t?void 0:t.palettes).concat(p.AllPalettes),r=i.mainPkg.config.palette||pxt.appTarget.runtime.palette;let o=!1;for(const e of n)if(N(r,e.colors)){o=!0,g(e),v(e);break}if(!o){const e={id:"custom"+t.nextPaletteID++,name:lf("Custom"),colors:r,custom:!0};t.palettes[e.id]=e,g(e),v(e)}h(t)},P=e=>p.AllPalettes.some((t=>t.id===e.id));if(!n)return(0,r.jsx)("div",{});const D=Object.values(n.palettes).filter((e=>void 0!==e)).reverse().concat(p.AllPalettes),M=[{label:lf("Reset"),onClick:()=>{f.custom&&!n.palettes[f.id]&&h(Object.assign(Object.assign({},n),{palettes:Object.assign(Object.assign({},n.palettes),{[f.id]:f})})),v(f)},leftIcon:"icon undo",className:"palette-transparent-button",disabled:S},{label:lf("Apply"),onClick:()=>A(!0),className:"green palette-apply-button",disabled:S}],L=[{label:lf("Done"),onClick:j,className:"teal palette-done-button",disabled:_}],B=[{label:lf("Delete"),onClick:O,leftIcon:"icon trash",className:"red"}],F=()=>{switch(x){case 0:return;case 1:return lf("Name Your Custom Palette");case 2:return lf("Rename Your Custom Palette")}};return(0,r.jsxs)("div",{children:[(0,r.jsxs)(s.Modal,Object.assign({title:lf("Color Palette"),onClose:()=>{A(!1)},actions:M,leftIcon:"fas fa-palette"},{children:[(0,r.jsxs)("div",Object.assign({className:"common-palette-picker"},{children:[(0,r.jsx)(c.PalettePicker,{palettes:D,selectedId:(null==m?void 0:m.id)||p.Arcade.id,onPaletteSelected:k}),(0,r.jsxs)("div",Object.assign({className:"palette-actions"},{children:[(0,r.jsx)(l.Button,{title:lf("New palette"),ariaLabel:lf("New palette"),className:"palette-new-button",leftIcon:"icon add",onClick:C}),(0,r.jsx)(l.Button,{title:lf("Rename palette"),ariaLabel:lf("Rename palette"),className:"palette-rename-button",leftIcon:"xicon rename",onClick:()=>E(2),disabled:!m.custom}),(0,r.jsx)(l.Button,{title:lf("Delete palette"),ariaLabel:lf("Delete palette"),className:"palette-delete-button",leftIcon:"icon trash",onClick:()=>b(!0),disabled:!m.custom})]}))]})),(0,r.jsx)(u.PaletteEditor,{palette:m||p.Arcade,onPaletteChanged:k})]})),F()&&(0,r.jsxs)(s.Modal,Object.assign({title:F(),onClose:()=>{1===x&&O(),j()},actions:L,className:"palette-name-modal"},{children:[(0,r.jsx)(a.Input,{className:"palette-name-input",initialValue:_?"":m.name,placeholder:lf("Palette Name"),onBlur:I,onEnterKey:I}),_&&(0,r.jsx)("p",Object.assign({className:"invalid-palette-name"},{children:lf("Name must not be empty")}))]})),y&&(0,r.jsxs)(s.Modal,Object.assign({title:lf("Delete Palette"),onClose:()=>b(!1),actions:B,className:"palette-delete-modal"},{children:[(0,r.jsx)("div",{children:lf("Are you sure you want to delete this palette?")}),(0,r.jsx)(d.PaletteSwatch,{palette:m})]}))]})}},{"../../../../react-common/components/controls/Button":3,"../../../../react-common/components/controls/Input":11,"../../../../react-common/components/controls/Modal":16,"../../../../react-common/components/palette/PaletteEditor":24,"../../../../react-common/components/palette/PalettePicker":25,"../../../../react-common/components/palette/PaletteSwatch":26,"../../../../react-common/components/palette/Palettes":27,"../../package":179,react:366,"react/jsx-runtime":367}],94:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetPreview=void 0;const r=e("react/jsx-runtime"),i=e("react");class o extends i.Component{constructor(){super(...arguments),this.onMouseEnter=()=>{this.restartAnimation()},this.onMouseLeave=()=>{this.endAnimation()},this.restartAnimation=()=>{var e;this.endAnimation();const t=this.props.asset;"animation"===t.type&&(null===(e=t.framePreviewURIs)||void 0===e?void 0:e.length)>1&&(this.currentFrame=0,this.animationIntervalRef=setInterval((()=>{this.ref&&(this.ref.src=t.framePreviewURIs[this.currentFrame]),this.currentFrame=(this.currentFrame+1)%t.framePreviewURIs.length}),Math.max(t.interval,100)))},this.handleRef=e=>{e&&(this.ref=e)}}render(){var e;const{asset:t}=this.props,n="animation"===t.type&&(null===(e=t.framePreviewURIs)||void 0===e?void 0:e.length)>1,i=t.meta.displayName||(t.meta.temporaryInfo?lf("Temporary Asset"):t.id);return(0,r.jsx)("div",Object.assign({className:"asset-editor-preview",title:i},{children:(0,r.jsx)("img",{src:t.previewURI,alt:lf("A preview of your asset (eg image, tile, animation)"),onMouseEnter:n?this.onMouseEnter:void 0,onMouseLeave:n?this.onMouseLeave:void 0,ref:n?this.handleRef:void 0,loading:"lazy"})}))}componentDidUpdate(){this.animationIntervalRef&&this.restartAnimation()}componentWillUnmount(){this.endAnimation()}endAnimation(){this.animationIntervalRef&&(clearInterval(this.animationIntervalRef),this.animationIntervalRef=void 0,this.ref.src=this.props.asset.previewURI)}}n.AssetPreview=o},{react:366,"react/jsx-runtime":367}],95:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetSidebar=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../../package"),s=e("../../simulator"),a=e("react-redux"),l=e("../../../../react-common/components/controls/Button"),c=e("../../../../react-common/components/controls/List"),u=e("../../../../react-common/components/controls/Modal"),d=e("./store/assetEditorReducerState"),p=e("./actions/dispatch"),h=e("./assetPreview"),f=e("./assetPalette"),g=e("../../app");class m extends i.Component{constructor(e){super(e),this.editAssetHandler=()=>{this.props.showAssetFieldView(this.props.asset,this.editAssetDoneHandler)},this.editAssetDoneHandler=e=>{var t;pxt.tickEvent("assets.edit",{type:e.type.toString()});const n=pxt.react.getTilemapProject();n.pushUndo(),!(null===(t=this.props.asset.meta)||void 0===t?void 0:t.displayName)&&e.meta.temporaryInfo&&((0,g.getBlocksEditor)().updateTemporaryAsset(e),o.mainEditorPkg().lookupFile(`this/${pxt.MAIN_BLOCKS}`).setContentAsync((0,g.getBlocksEditor)().getCurrentSource())),e.meta.displayName&&n.updateAsset(e),this.props.dispatchChangeGalleryView(0),this.updateAssets().then((()=>s.setDirty()))},this.duplicateAssetHandler=()=>{var e;const{isGalleryAsset:t}=this.props;pxt.tickEvent("assets.duplicate",{type:this.props.asset.type.toString(),gallery:t.toString()});const n=this.props.asset,r=(null===(e=n.meta)||void 0===e?void 0:e.displayName)||y(n,t)||pxt.getDefaultAssetDisplayName(n.type),i=pxt.react.getTilemapProject();i.pushUndo();const{type:o,id:s}=i.duplicateAsset(n,r);this.updateAssets().then((()=>{t&&this.props.dispatchChangeGalleryView(0,o,s)}))},this.copyAssetHandler=()=>{const{asset:e}=this.props;switch(pxt.tickEvent("assets.clipboard",{type:e.type.toString(),gallery:this.props.isGalleryAsset.toString()}),e.type){case"image":case"tile":try{const t=pxt.sprite.bitmapToImageLiteral(pxt.sprite.getBitmapFromJResURL(e.jresData),"typescript");this.copyTextAreaRef.value=t,this.copyTextAreaRef.focus(),this.copyTextAreaRef.select(),document.execCommand("copy")}catch(e){}}},this.copyTextAreaRefHandler=e=>{this.copyTextAreaRef=e},this.showDeleteModal=()=>{this.setState({showDeleteModal:!0})},this.hideDeleteModal=()=>{this.setState({showDeleteModal:!1})},this.showPaletteModal=()=>{this.setState({showPaletteModal:!0}),pxt.tickEvent("palette.open")},this.hidePaletteModal=e=>{this.setState({showPaletteModal:!1}),e&&this.props.updateProject()},this.deleteAssetHandler=()=>{pxt.tickEvent("assets.delete",{type:this.props.asset.type.toString()}),this.setState({showDeleteModal:!1});const e=pxt.react.getTilemapProject();e.pushUndo(),e.removeAsset(this.props.asset),this.props.dispatchChangeSelectedAsset(),this.updateAssets()},this.state={showDeleteModal:!1,showPaletteModal:!1,canEdit:!0,canCopy:!0,canDelete:!0}}UNSAFE_componentWillReceiveProps(e){if(e.asset&&this.props.asset!=e.asset){const{asset:t,isGalleryAsset:n}=e,r=pxt.react.getTilemapProject(),i=!n,s="tilemap"!=(null==t?void 0:t.type)&&"animation"!=(null==t?void 0:t.type),a=!n&&!r.isAssetUsed(t,o.mainEditorPkg().files);this.setState({canEdit:i,canCopy:s,canDelete:a})}}getAssetDetails(){const e=this.props.asset,t=[];if(e)switch(t.push({name:lf("Type"),value:v(e.type)}),e.type){case"image":case"tile":t.push({name:lf("Size"),value:`${e.bitmap.width} x ${e.bitmap.height}`});break;case"tilemap":t.push({name:lf("Size"),value:`${e.data.tilemap.width} x ${e.data.tilemap.height}`});break;case"animation":t.push({name:lf("Size"),value:`${e.frames[0].width} x ${e.frames[0].height}`})}return t}updateAssets(){return o.mainEditorPkg().buildAssetsAsync().then((()=>this.props.dispatchUpdateUserAssets()))}render(){var e;const{asset:t,isGalleryAsset:n}=this.props,{showDeleteModal:i,showPaletteModal:o,canEdit:s,canCopy:a,canDelete:d}=this.state,p=this.getAssetDetails(),g=(null===(e=null==t?void 0:t.meta)||void 0===e?void 0:e.displayName)||n,m=y(t,n),v=[{label:lf("Delete"),onClick:this.deleteAssetHandler,icon:"icon trash",className:"red"}];return(0,r.jsxs)("div",Object.assign({className:"asset-editor-sidebar"},{children:[(0,r.jsxs)(c.List,Object.assign({className:"asset-editor-sidebar-info"},{children:[(0,r.jsx)("div",{children:lf("Asset Preview")}),(0,r.jsx)("div",Object.assign({className:"asset-editor-sidebar-preview"},{children:t&&(0,r.jsx)(h.AssetPreview,{asset:t})})),g||!t?(0,r.jsx)("div",Object.assign({className:"asset-editor-sidebar-name"},{children:m})):(0,r.jsxs)("div",Object.assign({className:"asset-editor-sidebar-temp"},{children:[(0,r.jsx)("i",{className:"icon exclamation triangle"}),(0,r.jsx)("span",{children:lf("No asset name")})]})),p.map((e=>(0,r.jsx)("div",Object.assign({className:"asset-editor-sidebar-detail"},{children:`${e.name}: ${e.value}`}),e.name)))]})),(0,r.jsxs)(c.List,Object.assign({className:"asset-editor-sidebar-controls"},{children:[t&&s&&(0,r.jsx)(l.Button,{label:lf("Edit"),title:lf("Edit the selected asset"),ariaLabel:lf("Edit the selected asset"),leftIcon:"icon edit",className:"asset-editor-button",onClick:this.editAssetHandler}),t&&(0,r.jsx)(l.Button,{label:lf("Duplicate"),title:lf("Duplicate the selected asset"),ariaLabel:lf("Duplicate the selected asset"),leftIcon:"icon copy",className:"asset-editor-button",onClick:this.duplicateAssetHandler}),t&&a&&(0,r.jsx)(l.Button,{label:lf("Copy"),title:lf("Copy the selected asset to the clipboard"),ariaLabel:lf("Copy the selected asset to the clipboard"),leftIcon:"icon paste",className:"asset-editor-button",onClick:this.copyAssetHandler}),t&&d&&(0,r.jsx)(l.Button,{label:lf("Delete"),title:lf("Delete the selected asset"),ariaLabel:lf("Delete the selected asset"),className:"asset-editor-button",leftIcon:"icon trash",onClick:this.showDeleteModal}),(0,r.jsx)(l.Button,{className:"teal asset-palette-button",label:lf("Colors"),title:lf("Open the color palette"),ariaLabel:lf("Open the color palette"),leftIcon:"fas fa-palette",onClick:this.showPaletteModal})]})),(0,r.jsx)("textarea",{className:"asset-editor-sidebar-copy",ref:this.copyTextAreaRefHandler}),i&&(0,r.jsx)(u.Modal,Object.assign({className:"asset-editor-delete-dialog",onClose:this.hideDeleteModal,title:lf("Delete Asset"),actions:v,parentElement:document.getElementById("root")},{children:(0,r.jsx)("div",{children:lf("Are you sure you want to delete {0}? Deleted assets cannot be recovered.",m)})})),o&&(0,r.jsx)(f.AssetPalette,{onClose:this.hidePaletteModal})]}))}}function v(e){switch(e){case"image":return lf("Image");case"tile":return lf("Tile");case"animation":return lf("Animation");case"tilemap":return lf("Tilemap");case"song":return lf("Song")}}function y(e,t){var n;return e?(null===(n=null==e?void 0:e.meta)||void 0===n?void 0:n.displayName)?e.meta.displayName:t?e.id.split(".").pop():null:lf("No asset selected")}const b={dispatchChangeGalleryView:p.dispatchChangeGalleryView,dispatchChangeSelectedAsset:p.dispatchChangeSelectedAsset,dispatchUpdateUserAssets:p.dispatchUpdateUserAssets};n.AssetSidebar=(0,a.connect)((function(e,t){return e?{asset:e.selectedAsset,isGalleryAsset:(0,d.isGalleryAsset)(e.selectedAsset)}:{}}),b)(m)},{"../../../../react-common/components/controls/Button":3,"../../../../react-common/components/controls/List":14,"../../../../react-common/components/controls/Modal":16,"../../app":44,"../../package":179,"../../simulator":192,"./actions/dispatch":87,"./assetPalette":93,"./assetPreview":94,"./store/assetEditorReducerState":99,react:366,"react-redux":339,"react/jsx-runtime":367}],96:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetTopbar=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("./assetGalleryTab");class s extends i.Component{render(){return(0,r.jsxs)("div",Object.assign({className:"asset-editor-topbar"},{children:[(0,r.jsx)(o.AssetGalleryTab,{title:lf("My Assets"),view:0}),(0,r.jsx)(o.AssetGalleryTab,{title:lf("Gallery"),view:1})]}))}}n.AssetTopbar=s},{"./assetGalleryTab":92,react:366,"react/jsx-runtime":367}],97:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetEditor=void 0;const r=e("react/jsx-runtime"),i=e("../../package"),o=e("../../compiler"),s=e("../../blocklyFieldView"),a=e("react-redux"),l=e("./store/assetEditorStore"),c=e("./actions/dispatch"),u=e("../../srceditor"),d=e("./assetSidebar"),p=e("./assetGallery");class h extends u.Editor{constructor(){super(...arguments),this.showAssetFieldView=(e,t)=>{let n;switch(e.type){case"image":case"tile":n=pxt.react.getFieldEditorView("image-editor",e,{initWidth:16,initHeight:16,headerVisible:!0,hideMyAssets:!0,blocksInfo:this.blocksInfo});break;case"tilemap":const t=pxt.react.getTilemapProject();pxt.sprite.addMissingTilemapTilesAndReferences(t,e),n=pxt.react.getFieldEditorView("tilemap-editor",e,{initWidth:16,initHeight:16,headerVisible:!0,hideMyAssets:!0,blocksInfo:this.blocksInfo});break;case"animation":n=pxt.react.getFieldEditorView("animation-editor",e,{initWidth:16,initHeight:16,headerVisible:!0,hideMyAssets:!0,blocksInfo:this.blocksInfo});break;case"song":n=pxt.react.getFieldEditorView("music-editor",e,{})}this.parent.isTutorial()&&s.setContainerClass("asset-editor-tutorial"),n.onHide((()=>{this.parent.isTutorial()&&this.unbindTutorialEvents();const r=n.getResult();"tilemap"==e.type&&pxt.sprite.updateTilemapReferencesFromResult(pxt.react.getTilemapProject(),r),Promise.resolve(t(r)).then((()=>{var t;(null===(t=e.meta)||void 0===t?void 0:t.displayName)||this.parent.saveBlocksToTypeScriptAsync().then((e=>{e&&i.mainEditorPkg().setContentAsync(pxt.MAIN_TS,e)}))})),s.setContainerClass(null)})),this.parent.isTutorial()&&this.bindTutorialEvents(),n.show()}}getId(){return"assetEditor"}acceptsFile(e){return e.name===pxt.ASSETS_FILE}loadFileAsync(e,t){return super.loadFileAsync(e,t).then((()=>o.getBlocksAsync())).then((e=>{pxt.blocks.initializeAndInject(e),this.blocksInfo=e,this.updateGalleryAssets()})).then((()=>l.default.dispatch((0,c.dispatchUpdateUserAssets)()))).then((()=>{this.parent.forceUpdate(),this.parent.isTutorial()&&this.parent.onTutorialLoaded()}))}unloadFileAsync(){return s.dismissIfVisible(),i.mainEditorPkg().buildAssetsAsync()}undo(){pxt.react.getTilemapProject().undo(),l.default.dispatch((0,c.dispatchUpdateUserAssets)())}redo(){pxt.react.getTilemapProject().redo(),l.default.dispatch((0,c.dispatchUpdateUserAssets)())}resize(e){const t=this.getAssetEditorDiv();if(t&&this.parent.isTutorial()&&!pxt.BrowserUtils.isTabletSize()){const e=t.getBoundingClientRect(),n=document.getElementById("editortools");s.setEditorBounds({top:e.top,left:e.left,width:e.width,height:e.height+(n?n.getBoundingClientRect().height:0),horizontalPadding:0,verticalPadding:0})}else s.setEditorBounds({top:0,left:0,width:window.innerWidth,height:window.innerHeight})}display(){return(0,r.jsx)(a.Provider,Object.assign({store:l.default},{children:(0,r.jsxs)("div",Object.assign({className:"asset-editor-outer"},{children:[(0,r.jsx)(d.AssetSidebar,{showAssetFieldView:this.showAssetFieldView,updateProject:async()=>{await this.parent.reloadHeaderAsync(),this.parent.openAssets()}}),(0,r.jsx)(p.AssetGallery,{showAssetFieldView:this.showAssetFieldView,disableCreateButton:this.parent.isTutorial()})]}))}))}getAssetEditorDiv(){return document.getElementById("assetEditor")}getTutorialCardDiv(){return document.getElementById("tutorialcard")}getTutorialMenuDiv(){var e;return null===(e=document.getElementsByClassName("tutorial-menuitem"))||void 0===e?void 0:e[0]}handleTutorialClick(e){e.stopPropagation(),e.preventDefault()}bindTutorialEvents(){const e=this.getTutorialCardDiv();null==e||e.addEventListener("mousedown",this.handleTutorialClick);const t=this.getTutorialMenuDiv();null==t||t.addEventListener("mousedown",this.handleTutorialClick),pxt.BrowserUtils.addClass(document.getElementById("maineditor"),"image-editor-open")}unbindTutorialEvents(){const e=this.getTutorialCardDiv();null==e||e.removeEventListener("mousedown",this.handleTutorialClick);const t=this.getTutorialMenuDiv();null==t||t.removeEventListener("mousedown",this.handleTutorialClick),pxt.BrowserUtils.removeClass(document.getElementById("maineditor"),"image-editor-open")}updateGalleryAssets(){l.default.dispatch((0,c.dispatchUpdateGalleryAssets)())}}n.AssetEditor=h},{"../../blocklyFieldView":49,"../../compiler":58,"../../package":179,"../../srceditor":199,"./actions/dispatch":87,"./assetGallery":91,"./assetSidebar":95,"./store/assetEditorStore":100,"react-redux":339,"react/jsx-runtime":367}],98:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../actions/types"),i=e("../../../package"),o=e("../../../app"),s=e("../../../assets"),a={view:0,assets:[],galleryAssets:[]};function l(e,t,n){if(t&&n)return e.assets.find((e=>e.type==t&&e.id==n))||e.galleryAssets.find((e=>e.type==t&&e.id==n))}n.default=(e=a,t)=>{switch(t.type){case r.CHANGE_SELECTED_ASSET:return Object.assign(Object.assign({},e),{selectedAsset:l(e,t.assetType,t.assetId)});case r.CHANGE_GALLERY_VIEW:const n=t.assetId?l(e,t.assetType,t.assetId):e.selectedAsset;return Object.assign(Object.assign({},e),{view:t.view,selectedAsset:n});case r.UPDATE_USER_ASSETS:let a=(0,s.getAssets)(),c=new pxt.ImageConverter;return function(){var e,t;return(null===(t=null===(e=i.mainPkg)||void 0===e?void 0:e.config)||void 0===t?void 0:t.preferredEditor)===pxt.BLOCKS_PROJECT_NAME}()&&(a=a.concat((0,o.getBlocksEditor)().getTemporaryAssets().map((e=>(0,s.assetToGalleryItem)(e,c))))),Object.assign(Object.assign({},e),{selectedAsset:e.selectedAsset?a.find((t=>t.id==e.selectedAsset.id)):void 0,assets:a});case r.UPDATE_GALLERY_ASSETS:return Object.assign(Object.assign({},e),{galleryAssets:(0,s.getAssets)(!0)});default:return e}}},{"../../../app":44,"../../../assets":46,"../../../package":179,"../actions/types":88}],99:[function(e,t,n){"use strict";var r;Object.defineProperty(n,"__esModule",{value:!0}),n.isGalleryAsset=n.GalleryView=void 0,(r=n.GalleryView||(n.GalleryView={}))[r.User=0]="User",r[r.Gallery=1]="Gallery",n.isGalleryAsset=function(e){return null==e?void 0:e.id.startsWith("sprites.")}},{}],100:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("redux"),i=e("./assetEditorReducer"),o=(0,r.createStore)(i.default);n.default=o},{"./assetEditorReducer":98,redux:384}],101:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EditControls=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../../../../react-common/components/controls/Button"),s=e("../../../../react-common/components/controls/Input"),a=e("../../assets");n.EditControls=e=>{const{onAssetNameChanged:t,onDoneClicked:n,assetName:l,hideDoneButton:c}=e,[u,d]=i.useState(),[p,h]=i.useState(),f=e=>{let n=null;const r=e.trim();if(!r)return d(void 0),void h(void 0);pxt.validateAssetName(r)?(0,a.isNameTaken)(r)&&r!==l&&(n=lf("This name is already used elsewhere in your project")):n=lf("Names may only contain letters, numbers, '-', '_', and space"),n?(d(r),h(n)):(t(r),d(void 0),h(void 0))};return(0,r.jsxs)("div",Object.assign({className:"music-editor-edit-controls"},{children:[p&&(0,r.jsx)("div",Object.assign({className:"music-editor-name-error"},{children:p})),(0,r.jsx)(s.Input,{placeholder:lf("Asset Name"),initialValue:l||u,onBlur:f,onEnterKey:f}),!c&&(0,r.jsx)(o.Button,{className:"green",title:lf("Done"),label:lf("Done"),onClick:n})]}))}},{"../../../../react-common/components/controls/Button":3,"../../../../react-common/components/controls/Input":11,"../../assets":46,react:366,"react/jsx-runtime":367}],102:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GridHighlight=void 0;const r=e("react/jsx-runtime"),i=e("./svgConstants");n.GridHighlight=e=>{const{start:t,end:n,ticksPerBeat:o}=e,s=null!=t&&null!=n,a=Math.min(t,n),l=Math.max(t,n);return s?(0,r.jsxs)("g",{children:[(0,r.jsx)("rect",{fill:"#03adfc",x:(0,i.tickToX)(o,a),y:i.STAFF_HEADER_HEIGHT-i.STAFF_GRID_TICK_HEIGHT,width:(0,i.tickToX)(o,l)-(0,i.tickToX)(o,a),height:i.STAFF_GRID_TICK_HEIGHT}),(0,r.jsx)("rect",{fill:"#03adfc",x:(0,i.tickToX)(o,a),y:i.BASS_STAFF_TOP+i.STAFF_HEADER_HEIGHT-i.STAFF_GRID_TICK_HEIGHT,width:(0,i.tickToX)(o,l)-(0,i.tickToX)(o,a),height:i.STAFF_GRID_TICK_HEIGHT})]}):(0,r.jsx)("g",{})}},{"./svgConstants":115,"react/jsx-runtime":367}],103:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MusicEditor=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("./EditControls"),s=e("./keyboardNavigation"),a=e("./playback"),l=e("./PlaybackControls"),c=e("./ScrollableWorkspace"),u=e("./TrackSelector"),d=e("./utils");n.MusicEditor=e=>{const{asset:t,onSongChanged:n,savedUndoStack:p,onAssetNameChanged:h,editRef:f,onDoneClicked:g,hideDoneButton:m}=e,[v,y]=i.useState(0),[b,x]=i.useState("1/8"),[E,_]=i.useState(t.song),[w,S]=i.useState(!1),[T,k]=i.useState(!1),[C,A]=i.useState(p||[]),[j,I]=i.useState([]),[O,N]=i.useState(f),[R,P]=i.useState(),[D,M]=i.useState(),[L,B]=i.useState(!1),[F,U]=i.useState((0,d.doesSongUseBassClef)(t.song));i.useEffect((()=>()=>{(0,a.stopPlayback)()}),[]),i.useEffect((()=>{const e=e=>{R&&(e.preventDefault(),e.stopPropagation(),e.clipboardData.setData("application/makecode-song",JSON.stringify(R)))},t=e=>{if(R){e.preventDefault(),e.stopPropagation(),e.clipboardData.setData("application/makecode-song",JSON.stringify(R));const t=(0,d.applySelection)(R,T?v:void 0);V((0,d.deleteSelectedNotes)(t),!0)}},n=e=>{const t=e.clipboardData.getData("application/makecode-song");if(t){const e=JSON.parse(t);let n;n=R?{originalSong:(0,d.unselectAllNotes)((0,d.applySelection)(R,T?v:void 0)),pastedContent:e,startTick:R.startTick,endTick:R.startTick+(e.endTick-e.startTick),deltaTick:0,transpose:0}:{originalSong:E,pastedContent:e,startTick:0,endTick:e.endTick-e.startTick,deltaTick:0,transpose:0},V((0,d.applySelection)(n,T?v:void 0),!1),P(n)}};return document.addEventListener("copy",e),document.addEventListener("cut",t),document.addEventListener("paste",n),()=>{document.removeEventListener("copy",e),document.removeEventListener("cut",t),document.removeEventListener("paste",n)}}),[R,T,E]),O!==f&&(N(f),_(t.song));const H=i.useRef(),G=w?1:function(e,t){switch(e){case"1/4":return t;case"1/8":return t/2;case"1/16":return t/4;case"1/32":return t/8}}(b,E.ticksPerBeat),q=!!E.tracks[v].drums,V=(e,t)=>{var r;(0,a.isPlaying)()&&(0,a.updatePlaybackSongAsync)(e);let i=C.slice();t&&(i.push(pxt.assets.music.cloneSong((null==R?void 0:R.originalSong)||(null===(r=H.current)||void 0===r?void 0:r.original)||E)),A(i),I([])),_(e),n&&n(e),H.current&&(H.current.editing=e)},z=()=>{var e,t;let n;return P(void 0),"move"===(null===(e=null==H?void 0:H.current)||void 0===e?void 0:e.dragType)?n=(0,d.unselectAllNotes)(H.current.editing):(0,d.findSelectedRange)(E)&&(n=(0,d.unselectAllNotes)(E)),n&&(V(n,!0),"move"===(null===(t=null==H?void 0:H.current)||void 0===t?void 0:t.dragType)&&(H.current=void 0)),n},W=e=>{M(D?Object.assign(Object.assign({},D),{tick:e}):{tick:e,gridTicks:G,track:v,bassClef:!1,hideTracksActive:T,selection:R})};return(0,r.jsxs)("div",Object.assign({className:"music-editor"},{children:[(0,r.jsx)(u.TrackSelector,{song:E,selected:v,onTrackSelected:e=>{z(),B(!1);const t=E.tracks[e];t.drums?pxsim.music.playDrumAsync(t.drums[0]):pxsim.music.playNoteAsync((0,d.rowToNote)(t.instrument.octave,6,!1,!!t.drums).note,t.instrument,pxsim.music.tickToMs(E.beatsPerMinute,E.ticksPerBeat,E.ticksPerBeat/2)),y(e),D&&M(Object.assign(Object.assign({},D),{track:e})),w&&S(!1)},eraserActive:w,onEraserClick:()=>{z(),B(!1),S(!w)},hideTracksActive:T,onHideTracksClick:()=>{z(),B(!1),k(!T)},selectedResolution:b,onResolutionSelected:x}),(0,r.jsx)(c.ScrollableWorkspace,{song:E,selectedTrack:v,eraserActive:w,onWorkspaceClick:(e,t)=>{B(!1);const n=E.tracks[v],r=n.instrument,i=(0,d.findPreviousNoteEvent)(E,v,e.tick),o=(0,d.findPreviousNoteEvent)(E,v,e.exactTick);z(),W(e.tick);const s=t=>(0,d.isBassClefNote)(r.octave,t,q)===e.isBassClef&&(0,d.noteToRow)(r.octave,t,q)===e.row;let a,l;if((null==o?void 0:o.startTick)===e.exactTick&&o.notes.some(s)?(a=e.exactTick,l=o):(null==i?void 0:i.startTick)===e.tick&&i.notes.some(s)&&(a=e.tick,l=i),l){const n=(0,d.unselectAllNotes)(E);if(t&&!q){const t=l.notes.find(s),i=12*r.octave-20,o=12*r.octave+20,c=(0,d.removeNoteAtRowFromTrack)(n,v,e.row,e.isBassClef,a);let u;u="normal"===t.enharmonicSpelling&&t.note<o?"sharp":"sharp"===t.enharmonicSpelling&&t.note>i||t.note===o?"flat":"normal";const p=(0,d.rowToNote)(r.octave,e.row,e.isBassClef,q,u);V((0,d.addNoteToTrack)(c,v,p,l.startTick,l.endTick),!0),pxsim.music.playNoteAsync(p.note,r,pxsim.music.tickToMs(E.beatsPerMinute,E.ticksPerBeat,l.endTick-l.startTick))}else V((0,d.removeNoteAtRowFromTrack)(n,v,e.row,e.isBassClef,a),!0)}else{if(w){for(let t=0;t<E.tracks.length;t++){if(T&&t!==v)continue;const n=(0,d.findPreviousNoteEvent)(E,t,e.tick),r=(0,d.findPreviousNoteEvent)(E,t,e.exactTick);let i,o;(null==r?void 0:r.startTick)===e.exactTick&&r.notes.some(s)?(i=e.exactTick,o=r):(null==n?void 0:n.startTick)===e.tick&&n.notes.some(s)&&(i=e.tick,o=n),((null==o?void 0:o.startTick)===i||(null==o?void 0:o.endTick)>i)&&o.notes.some(s)&&V((0,d.removeNoteAtRowFromTrack)(E,t,e.row,e.isBassClef,o.startTick),!1)}return}{const t=(0,d.rowToNote)(r.octave,e.row,e.isBassClef,q),i=E.beatsPerMeasure*E.ticksPerBeat*E.measures;if(e.tick===i)return;const o=q?1:G;V((0,d.unselectAllNotes)((0,d.addNoteToTrack)(E,v,t,e.tick,e.tick+o)),!0),q?pxsim.music.playDrumAsync(n.drums[t.note]):pxsim.music.playNoteAsync(t.note,r,pxsim.music.tickToMs(E.beatsPerMinute,E.ticksPerBeat,G))}}},onWorkspaceDragStart:()=>{if(B(!1),H.current)return H.current.editing=E,H.current.original=E,void(H.current.selectionAtDragStart=R&&Object.assign({},R));H.current={editing:E,original:E,selectionAtDragStart:R&&Object.assign({},R)}},onWorkspaceDragEnd:()=>{if("move"===H.current.dragType){const e=H.current.dragEnd.tick-H.current.dragStart.tick,t=H.current.dragEnd.row-(H.current.dragEnd.isBassClef?12:0)-(H.current.dragStart.row-(H.current.dragStart.isBassClef?12:0));return P(Object.assign(Object.assign({},H.current.selectionAtDragStart),{deltaTick:H.current.selectionAtDragStart.deltaTick+e,transpose:H.current.selectionAtDragStart.transpose+t})),H.current.dragStart=void 0,H.current.dragEnd=void 0,void(H.current.selectionAtDragStart=void 0)}if("note-length"===H.current.dragType&&z(),pxt.assets.music.songEquals(H.current.editing,H.current.original)||V(H.current.editing,!0),"marquee"===H.current.dragType){const e=(0,d.findSelectedRange)(H.current.editing,G);P(e?{startTick:e.start,endTick:e.end,deltaTick:0,transpose:0,originalSong:H.current.editing}:void 0)}H.current=void 0},onWorkspaceDrag:(e,t)=>{if(W(t.tick),w){for(let e=0;e<E.tracks.length;e++){if(T&&e!==v)continue;const n=E.tracks[e].instrument,r=(0,d.findPreviousNoteEvent)(E,e,t.exactTick),i=e=>(0,d.isBassClefNote)(n.octave,e,q)===t.isBassClef&&(0,d.noteToRow)(n.octave,e,q)===t.row;((null==r?void 0:r.startTick)===t.exactTick||(null==r?void 0:r.endTick)>t.exactTick)&&r.notes.some(i)&&V((0,d.removeNoteAtRowFromTrack)(E,e,t.row,t.isBassClef,r.startTick),!1)}return}if(H.current.dragType=void 0,H.current.dragStart=e,H.current.dragEnd=t,H.current.original.tracks[v].drums)return void V((0,d.fillDrums)(H.current.original,v,e.row,e.tick,t.tick,G),!1);if(H.current.selectionAtDragStart){const n=(0,d.findNoteEventAtPosition)(H.current.original,e,T?v:void 0);if(null==n?void 0:n.selected){H.current.dragType="move";const n=t.tick-e.tick,r=t.row-(t.isBassClef?12:0)-(e.row-(e.isBassClef?12:0)),i=Object.assign(Object.assign({},H.current.selectionAtDragStart),{deltaTick:n+H.current.selectionAtDragStart.deltaTick,transpose:r+H.current.selectionAtDragStart.transpose}),o=(0,d.applySelection)(i,T?v:void 0);return V(o,!1),void P(i)}}const n=(0,d.findPreviousNoteEvent)(H.current.original,v,e.exactTick);if(!q&&n&&e.exactTick>=n.startTick&&e.exactTick<n.endTick){let r=!1;for(const t of n.notes)if((0,d.noteToRow)(E.tracks[v].instrument.octave,t,!1)===e.row){r=!0;break}if(r){if(t.tick<n.startTick+1)return;return P(void 0),H.current.dragType="note-length",void V((0,d.editNoteEventLength)(H.current.original,v,n.startTick,t.tick),!1)}}P({startTick:e.tick,endTick:t.tick,deltaTick:0,transpose:0,originalSong:H.current.editing}),V((0,d.selectNoteEventsInRange)(H.current.original,e.tick,t.tick,T?v:void 0),!1),H.current.dragType="marquee"},gridTicks:G,hideUnselectedTracks:T,showBassClef:F,selection:R,cursor:L?D:void 0,onKeydown:e=>{B(!0);let t=D;t||(t={tick:0,gridTicks:G,track:v,bassClef:!1,hideTracksActive:T,selection:R}),t.gridTicks=G,t.track=v,t.selection=R,t.hideTracksActive=T;const[n,r]=(0,s.handleKeyboardEvent)(E,t,e);pxt.assets.music.songEquals(n,E)||V(n,!r.selection),r.selection?P(r.selection):P(void 0),M(r)}}),(0,r.jsx)(l.PlaybackControls,{song:E,onTempoChange:e=>{z(),B(!1),V(Object.assign(Object.assign({},E),{beatsPerMinute:e}),!0)},onMeasuresChanged:e=>{z(),B(!1),V((0,d.changeSongLength)(E,e),!0)},onUndoClick:()=>{if(!C.length)return;I(j.concat([E]));const e=C.pop();A(C.slice()),V(e,!1)},onRedoClick:()=>{if(!j.length)return;A(C.concat([E]));const e=j.pop();I(j.slice()),V(e,!1)},showBassClef:F,onBassClefCheckboxClick:U,hasUndo:!!C.length,hasRedo:!!j.length}),(0,r.jsx)(o.EditControls,{assetName:t.meta.displayName,onAssetNameChanged:h,onDoneClicked:g,hideDoneButton:m})]}))}},{"./EditControls":101,"./PlaybackControls":106,"./ScrollableWorkspace":107,"./TrackSelector":110,"./keyboardNavigation":113,"./playback":114,"./utils":116,react:366,"react/jsx-runtime":367}],104:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Note=void 0;const r=e("react/jsx-runtime"),i=e("../../../../react-common/components/util"),o=e("./svgConstants"),s=e("./utils");n.Note=e=>{const{row:t,iconURI:n,length:a,opacity:l,enharmonicSpelling:c,isBassClef:u,selected:d,cursorHighlighted:p}=e;return(0,r.jsxs)("g",Object.assign({className:(0,i.classList)("music-staff-note",d&&"selected",p&&"cursor-highlighted"),transform:`translate(${-o.NOTE_ICON_WIDTH/2}, ${(0,o.rowY)(t,u)-o.NOTE_ICON_WIDTH/2})`},{children:[0===t&&(0,r.jsx)("line",{className:"music-staff-row",x1:-o.NOTE_ICON_WIDTH/2,y1:o.NOTE_ICON_WIDTH/2,x2:3*o.NOTE_ICON_WIDTH/2,y2:o.NOTE_ICON_WIDTH/2,opacity:l}),!!a&&(0,r.jsx)("rect",{x:o.NOTE_ICON_WIDTH/2,y:o.NOTE_ICON_WIDTH/2-o.NOTE_DURATION_HEIGHT/2,width:a,height:o.NOTE_DURATION_HEIGHT}),(0,r.jsx)("image",Object.assign({x:0,y:0,width:o.NOTE_ICON_WIDTH,height:o.NOTE_ICON_WIDTH,href:(0,s.resolveImageURL)(n),opacity:l},{children:(0,r.jsx)("animate",{attributeName:"y",values:"0;-7;-10;-7;0",dur:"0.25s",repeatCount:"1",begin:"indefinite"})})),c&&"normal"!==c&&(0,r.jsx)("text",Object.assign({x:o.NOTE_ICON_WIDTH,y:0,fontSize:o.NOTE_ICON_WIDTH/2},{children:"sharp"===c?"":""}))]}))}},{"../../../../react-common/components/util":41,"./svgConstants":115,"./utils":116,"react/jsx-runtime":367}],105:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.NoteGroup=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("./Note"),s=e("./playback"),a=e("./svgConstants"),l=e("./utils");n.NoteGroup=e=>{const{song:t,noteEvent:n,octave:c,iconURI:u,isDrumTrack:d,cursor:p}=e;let h;i.useEffect((()=>{let e=!1;const t=t=>{if(t>=n.startTick&&t<n.endTick){if(!e){e=!0,h.classList.add("music-note-playing");const t=h.querySelectorAll("animate");for(let e=0;e<t.length;e++)t.item(e).beginElement()}}else e&&(e=!1,h.classList.remove("music-note-playing"))},r=()=>{e&&(e=!1,h.classList.remove("music-note-playing"))};return(0,s.addTickListener)(t),(0,s.addPlaybackStateListener)(r),()=>{(0,s.removeTickListener)(t),(0,s.removePlaybackStateListener)(r),h.classList.remove("music-note-playing")}}),[n]);const f=(0,a.tickToX)(t.ticksPerBeat,n.startTick),g=d?0:(0,a.tickToX)(t.ticksPerBeat,n.endTick)-f,m=(null==p?void 0:p.tick)===n.startTick;return(0,r.jsx)("g",Object.assign({className:"music-staff-note-group",transform:`translate(${f}, 0)`,ref:e=>{e&&(h=e)}},{children:n.notes.map(((e,t)=>{const i=(0,l.isBassClefNote)(c,e,d),s=(0,l.noteToRow)(c,e,d);return(0,r.jsx)(o.Note,{isBassClef:i,row:s,enharmonicSpelling:e.enharmonicSpelling,iconURI:u,length:g,selected:n.selected,cursorHighlighted:m&&p.noteGroupIndex===t},t)}))}))}},{"./Note":104,"./playback":114,"./svgConstants":115,"./utils":116,react:366,"react/jsx-runtime":367}],106:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PlaybackControls=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../../../../react-common/components/controls/Button"),s=e("../../../../react-common/components/controls/Checkbox"),a=e("../../../../react-common/components/controls/Input"),l=e("../../../../react-common/components/util"),c=e("./playback");n.PlaybackControls=e=>{const{song:t,onTempoChange:n,onMeasuresChanged:u,onUndoClick:d,onRedoClick:p,hasUndo:h,hasRedo:f,showBassClef:g,onBassClefCheckboxClick:m}=e,[v,y]=i.useState("stop");i.useEffect((()=>{const e=e=>{y(e)};return(0,c.addPlaybackStateListener)(e),()=>(0,c.removePlaybackStateListener)(e)}),[]);const b=e=>{let t=parseFloat(e);Number.isNaN(t)||(t=Math.min(500,Math.max(20,Math.floor(t))),n(t))},x=e=>{let t=parseInt(e);isNaN(t)||t<1||t>50||u(t)};return(0,r.jsxs)("div",Object.assign({className:"music-playback-controls"},{children:[(0,r.jsxs)("div",Object.assign({className:"music-playback-buttons"},{children:[(0,r.jsx)(o.Button,{className:"square-button",title:lf("Stop"),leftIcon:"fas fa-stop",onClick:()=>{(0,c.stopPlayback)(),y("stop")}}),(0,r.jsx)(o.Button,{className:(0,l.classList)("square-button","play"===v&&"green"),title:lf("Play"),leftIcon:"fas fa-play",onClick:()=>{(0,c.startPlaybackAsync)(t,!1),y("play")}}),(0,r.jsx)(o.Button,{className:(0,l.classList)("square-button","loop"===v&&"green"),title:lf("Loop"),leftIcon:"fas fa-retweet",onClick:()=>{(0,c.isLooping)()||((0,c.isPlaying)()?(0,c.setLooping)(!0):(0,c.startPlaybackAsync)(t,!0),y("loop"))}})]})),(0,r.jsx)(a.Input,{id:"music-playback-tempo-input music-editor-label",label:lf("Tempo:"),initialValue:t.beatsPerMinute.toString(),onBlur:b,onEnterKey:b}),(0,r.jsx)("div",{className:"spacer"}),(0,r.jsx)(s.Checkbox,{className:"music-editor-label",id:"show-bass-clef",label:lf("Show bass clef"),isChecked:g,onChange:m}),(0,r.jsxs)("div",Object.assign({className:"music-undo-redo common-button-group"},{children:[(0,r.jsx)(o.Button,{className:"square-button purple",title:lf("Undo"),leftIcon:"xicon undo",disabled:!h,onClick:d}),(0,r.jsx)(o.Button,{className:"square-button purple",title:lf("Redo"),leftIcon:"xicon redo",disabled:!f,onClick:p})]})),(0,r.jsxs)("div",Object.assign({className:"music-playback-measures"},{children:[(0,r.jsx)("div",Object.assign({className:"music-editor-label"},{children:lf("Measures:")})),(0,r.jsx)(o.Button,{className:"menu-button",title:lf("Remove measure"),leftIcon:"fas fa-minus-circle",onClick:()=>{t.measures>1&&u(t.measures-1)}}),(0,r.jsx)(a.Input,{id:"music-playback-measures-input",initialValue:t.measures.toString(),onBlur:x,onEnterKey:x}),(0,r.jsx)(o.Button,{className:"menu-button",title:lf("Add measure"),leftIcon:"fas fa-plus-circle",onClick:()=>{t.measures<50&&u(t.measures+1)}})]}))]}))}},{"../../../../react-common/components/controls/Button":3,"../../../../react-common/components/controls/Checkbox":5,"../../../../react-common/components/controls/Input":11,"../../../../react-common/components/util":41,"./playback":114,react:366,"react/jsx-runtime":367}],107:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ScrollableWorkspace=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("./svgConstants"),s=e("./utils"),a=e("./Workspace");n.ScrollableWorkspace=e=>{const{cursor:t,song:n}=e,l=i.useRef(null);return i.useEffect((()=>{if(!t)return;const e=(0,o.tickToX)(n.ticksPerBeat,t.tick),r=l.current.querySelector("svg"),i=e=>{const t=r.createSVGPoint();return t.x=e,t.y=0,t.matrixTransform(r.getScreenCTM()).x},a=i(e),c=(0,s.findNoteEventAtTick)(n,t.track,t.tick),u=i(e+o.BEAT_WIDTH)-a;let d;d=c?i((0,o.tickToX)(n.ticksPerBeat,c.endTick+n.ticksPerBeat/2))-a:u;const p=l.current.getBoundingClientRect(),h=a-p.x,f=h+d;h<u?l.current.scrollLeft+=h-u:d<p.width&&f>p.width&&(l.current.scrollLeft+=f-p.width)}),[null==t?void 0:t.tick,n.ticksPerBeat]),(0,r.jsx)("div",Object.assign({ref:l,className:"music-scrollable-workspace"},{children:(0,r.jsx)("div",Object.assign({className:"music-scroller"},{children:(0,r.jsx)(a.Workspace,Object.assign({},e))}))}))}},{"./Workspace":111,"./svgConstants":115,"./utils":116,react:366,"react/jsx-runtime":367}],108:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Staff=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../../../../react-common/components/util"),s=e("./playback"),a=e("./svgConstants"),l=e("./utils");n.Staff=e=>{const{top:t,isBassClef:n,gridTicks:c,ticksPerBeat:u,beatsPerMeasure:d,beatsPerMinute:p,measures:h}=e;let f;i.useEffect((()=>{const e=pxsim.music.tickToMs(p,u,1),t=(0,a.tickToX)(u,2)-(0,a.tickToX)(u,1);let n,r,i=0,o=!1;const l=e=>{i=(0,a.tickToX)(u,e),r=Date.now(),o||(o=!0,f.style.display="unset",n=requestAnimationFrame(d))},c=()=>{o=!1,f.style.display="none",n&&cancelAnimationFrame(n)},d=()=>{const s=i+t*(Date.now()-r)/e;f.setAttribute("transform",`translate(${s}, 0)`),o&&(n=requestAnimationFrame(d))};return(0,s.addTickListener)(l),(0,s.addPlaybackStateListener)(c),()=>{(0,s.removeTickListener)(l),(0,s.removePlaybackStateListener)(c),n&&cancelAnimationFrame(n)}}),[u,p]);const g=(0,a.workspaceWidth)(h,d),m=[];for(let e=0;e<5;e++)m.push((0,r.jsx)("line",{className:"music-staff-row",x1:0,y1:(0,a.rowY)(2*e+2,!1),x2:g,y2:(0,a.rowY)(2*e+2,!1)},e));const v=[],y=c;for(let e=0;e<h*d*u;e+=y){const t=e%u==0,i=e%(d*u)==0,s=!t&&!i;v.push((0,r.jsxs)("g",{children:[i&&!n&&(0,r.jsx)("text",Object.assign({x:(0,a.tickToX)(u,e),y:a.STAFF_HEADER_HEIGHT-a.STAFF_HEADER_OFFSET,textAnchor:"middle",fontSize:a.STAFF_HEADER_FONT_SIZE},{children:Math.floor(e/(d*u))+1})),(0,r.jsx)("line",{className:"music-staff-column",x1:(0,a.tickToX)(u,e),y1:a.STAFF_HEADER_HEIGHT-a.STAFF_GRID_TICK_HEIGHT,x2:(0,a.tickToX)(u,e),y2:a.STAFF_HEADER_HEIGHT}),!s&&(0,r.jsx)("line",{className:(0,o.classList)("music-staff-column",t&&"beat-start",i&&"measure-start"),x1:(0,a.tickToX)(u,e),y1:n&&i?0:a.STAFF_HEADER_HEIGHT,x2:(0,a.tickToX)(u,e),y2:a.WORKSPACE_HEIGHT})]},e))}return(0,r.jsxs)("g",Object.assign({className:"music-staff",transform:`translate(0 ${t})`},{children:[(0,r.jsx)("rect",{className:"music-staff-background",x:0,y:a.STAFF_HEADER_HEIGHT,width:g,height:a.WORKSPACE_HEIGHT-a.STAFF_HEADER_HEIGHT}),(0,r.jsx)("image",{className:"music-staff-clef",href:(0,l.resolveImageURL)(n?"music-editor/bass-clef.svg":"music-editor/treble-clef.svg"),height:n?a.BASS_CLEF_HEIGHT:a.CLEF_HEIGHT,x:0,y:n?a.BASS_CLEF_TOP:a.STAFF_HEADER_HEIGHT}),(0,r.jsx)("rect",{fill:"#000",x:0,y:a.STAFF_HEADER_HEIGHT-a.STAFF_GRID_TICK_HEIGHT,width:g,height:a.STAFF_GRID_TICK_HEIGHT}),(0,r.jsx)("rect",{fill:"#dedede",x:a.CLEF_WIDTH,y:a.STAFF_HEADER_HEIGHT-a.STAFF_GRID_TICK_HEIGHT,width:g-a.CLEF_WIDTH-a.STAFF_END_WIDTH,height:a.STAFF_GRID_TICK_HEIGHT}),(0,r.jsx)("g",Object.assign({className:"music-staff-rows"},{children:m})),(0,r.jsx)("g",Object.assign({className:"music-staff-beats"},{children:v})),(0,r.jsxs)("g",Object.assign({className:"music-staff-end"},{children:[(0,r.jsx)("rect",{x:g-a.STAFF_END_WIDTH,y:a.STAFF_HEADER_HEIGHT,width:3,height:a.WORKSPACE_HEIGHT-a.STAFF_HEADER_HEIGHT}),(0,r.jsx)("rect",{x:g-12,y:a.STAFF_HEADER_HEIGHT,width:12,height:a.WORKSPACE_HEIGHT-a.STAFF_HEADER_HEIGHT})]})),(0,r.jsx)("g",Object.assign({className:"music-playback-head",ref:e=>{e&&(f=e)}},{children:(0,r.jsx)("line",{className:"music-playback-line",x1:0,y1:a.STAFF_HEADER_HEIGHT,x2:0,y2:a.WORKSPACE_HEIGHT})}))]}))}},{"../../../../react-common/components/util":41,"./playback":114,"./svgConstants":115,"./utils":116,react:366,"react/jsx-runtime":367}],109:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Track=void 0;const r=e("react/jsx-runtime"),i=e("./Note"),o=e("./NoteGroup"),s=e("./svgConstants");n.Track=e=>{const{song:t,track:n,cursorLocation:a,keyboardCursor:l}=e;let c;return a&&(c=(0,r.jsx)("g",Object.assign({transform:`translate(${(0,s.tickToX)(t.ticksPerBeat,a.tick)}, 0)`},{children:(0,r.jsx)(i.Note,{isBassClef:a.isBassClef,row:a.row,iconURI:n.iconURI,opacity:.5})}))),(0,r.jsxs)("g",Object.assign({className:"music-staff-track"},{children:[l&&(0,r.jsx)("g",{children:(0,r.jsx)("rect",{x:(0,s.tickToX)(t.ticksPerBeat,l.tick),y:l.bassClef?s.BASS_STAFF_TOP+s.STAFF_HEADER_HEIGHT:s.STAFF_HEADER_HEIGHT,width:5,height:s.WORKSPACE_HEIGHT-s.STAFF_HEADER_HEIGHT,fill:"purple"})}),n.notes.map((e=>(0,r.jsx)(o.NoteGroup,{noteEvent:e,octave:n.instrument.octave,song:t,iconURI:n.iconURI,isDrumTrack:!!n.drums,cursor:l},e.startTick))),c]}))}},{"./Note":104,"./NoteGroup":105,"./svgConstants":115,"react/jsx-runtime":367}],110:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TrackSelector=void 0;const r=e("react/jsx-runtime"),i=e("../../../../react-common/components/controls/Button"),o=e("../../../../react-common/components/controls/Checkbox"),s=e("../../../../react-common/components/controls/Dropdown"),a=e("../../../../react-common/components/controls/FocusList"),l=e("../../../../react-common/components/util"),c=e("./utils"),u={four:"1/4",eight:"1/8",sixteen:"1/16",thirtytwo:"1/32"};n.TrackSelector=e=>{const{song:t,selected:n,onTrackSelected:d,selectedResolution:p,onResolutionSelected:h,eraserActive:f,onEraserClick:g,hideTracksActive:m,onHideTracksClick:v}=e,y=[{title:lf("1/4 Note"),label:lf("1/4"),id:"four"},{title:lf("1/8 Note"),label:lf("1/8"),id:"eight"},{title:lf("1/16 Note"),label:lf("1/16"),id:"sixteen"},{title:lf("1/32 Note"),label:lf("1/32"),id:"thirtytwo"}];return(0,r.jsxs)("div",Object.assign({className:"music-track-selector"},{children:[(0,r.jsxs)(a.FocusList,Object.assign({role:"radiogroup",ariaLabel:lf("Track selection")},{children:[t.tracks.map(((e,o)=>(0,r.jsx)(i.Button,{role:"radio",ariaSelected:n===o&&!f,ariaPosInSet:o+1,ariaSetSize:t.tracks.length+1,title:e.name,className:(0,l.classList)("music-track-button square-button pixellated",n===o&&!f&&"selected"),label:(0,r.jsx)("img",{src:(0,c.resolveImageURL)(e.iconURI),alt:e.name}),onClick:()=>(e=>{d(e)})(o)},e.name))),(0,r.jsx)(i.Button,{className:(0,l.classList)("music-track-button square-button",f&&"selected"),title:f?lf("Turn off eraser tool"):lf("Turn on eraser tool"),leftIcon:"fas fa-eraser",ariaSelected:f,ariaPosInSet:t.tracks.length,ariaSetSize:t.tracks.length+1,onClick:g})]})),(0,r.jsx)(o.Checkbox,{className:"music-editor-label",id:"hide-tracks",label:lf("Only show selected instrument"),isChecked:m,onChange:v}),(0,r.jsxs)("div",Object.assign({className:"music-track-grid"},{children:[(0,r.jsx)("div",Object.assign({className:"music-editor-label"},{children:lf("Grid:")})),(0,r.jsx)(s.Dropdown,{id:"grid-resolution",ariaLabel:lf("Staff grid resolution"),items:y,selectedId:Object.keys(u).find((e=>u[e]===p)),onItemSelected:e=>{h(u[e])}})]}))]}))}},{"../../../../react-common/components/controls/Button":3,"../../../../react-common/components/controls/Checkbox":5,"../../../../react-common/components/controls/Dropdown":7,"../../../../react-common/components/controls/FocusList":9,"../../../../react-common/components/util":41,"./utils":116,"react/jsx-runtime":367}],111:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Workspace=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../../../../react-common/components/util"),s=e("./GridHighlight"),a=e("./Staff"),l=e("./svgConstants"),c=e("./Track"),u=e("./utils"),d=e("./WorkspaceSelection");function p(e,t,n,r){const i=(0,o.screenToSVGCoord)(t,(0,o.clientCoord)(e)),s=i.y>l.BASS_STAFF_TOP,a=(0,l.closestTick)(n.ticksPerBeat,i.x+l.BEAT_WIDTH/n.ticksPerBeat,r);return{isBassClef:s,row:(0,l.closestRow)(i.y),tick:a,exactTick:(0,l.closestTick)(n.ticksPerBeat,i.x,1)}}n.Workspace=e=>{const{song:t,onWorkspaceClick:n,gridTicks:h,selectedTrack:f,onWorkspaceDrag:g,onWorkspaceDragStart:m,onWorkspaceDragEnd:v,onKeydown:y,cursor:b,hideUnselectedTracks:x,eraserActive:E,showBassClef:_,selection:w}=e,[S,T]=i.useState(null),[k,C]=i.useState(null),[A,j]=i.useState(!1);let I;i.useEffect((()=>{I.onpointerdown=e=>{e.preventDefault(),I.focus();const n=p(e,I,t,h);n.tick>=0&&n.row>=0&&n.row<12&&C(n)},I.onpointermove=e=>{const n=p(e,I,t,h);if(S&&S.exactTick===n.exactTick&&S.row===n.row)return;const r=t.beatsPerMeasure*t.ticksPerBeat*t.measures;n.tick>=0&&n.row>=0&&n.row<12&&n.tick<=r?(k&&(A||(j(!0),m()),g(k,n)),n.tick<r?T(n):T(null)):T(null)},I.onpointerleave=e=>{T(null),A&&(v(),j(!1))},I.onpointerup=e=>{if(C(null),A)v(),j(!1);else{const r=p(e,I,t,h);r.tick>=0&&r.row>=0&&r.row<12&&n(r,e.ctrlKey)}}}),[S,k,A,g,v,m]);let O,N,R=A||E?void 0:S;const P=S&&(0,u.findNoteEventAtTick)(t,f,S.tick),D=k&&(0,u.findNoteEventAtTick)(t,f,k.tick);w?(O=w.startTick+w.deltaTick,N=w.endTick+w.deltaTick):!E&&D&&(null==S?void 0:S.tick)>=D.startTick?(O=D.startTick,N=D.endTick):!E&&A&&S&&k?(O=Math.min(S.tick,k.tick),N=Math.max(S.tick,k.tick)):P?(O=P.startTick,N=P.endTick):S&&(O=S.tick,N=S.tick+h),P&&R&&(R=Object.assign(Object.assign({},R),{tick:P.startTick}));const M=t.tracks.filter(((e,t)=>t!==f)),L=_?2*l.WORKSPACE_HEIGHT:l.WORKSPACE_HEIGHT,B=pxt.assets.music.getSongInfo(t);return(0,r.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",className:(0,o.classList)("music-workspace",E&&"erasing"),viewBox:`0 0 ${(0,l.workspaceWidth)(t.measures,t.beatsPerMeasure)+20} ${L}`,"aria-label":lf("Music Workspace"),tabIndex:0,onKeyDown:y,ref:e=>{e&&(I=e)}},{children:[(0,r.jsxs)("filter",Object.assign({id:"selection-outline"},{children:[(0,r.jsx)("feMorphology",{in:"SourceAlpha",result:"DILATED",operator:"dilate",radius:"4"}),(0,r.jsx)("feFlood",{floodColor:"yellow",floodOpacity:"1",result:"FLOODED"}),(0,r.jsx)("feComposite",{in:"FLOODED",in2:"DILATED",operator:"in",result:"OUTLINE"}),(0,r.jsxs)("feMerge",{children:[(0,r.jsx)("feMergeNode",{in:"OUTLINE"}),(0,r.jsx)("feMergeNode",{in:"SourceGraphic"})]})]})),(0,r.jsxs)("filter",Object.assign({id:"cursor-outline"},{children:[(0,r.jsx)("feMorphology",{in:"SourceAlpha",result:"DILATED",operator:"dilate",radius:"4"}),(0,r.jsx)("feFlood",{floodColor:"purple",floodOpacity:"1",result:"FLOODED"}),(0,r.jsx)("feComposite",{in:"FLOODED",in2:"DILATED",operator:"in",result:"OUTLINE"}),(0,r.jsxs)("feMerge",{children:[(0,r.jsx)("feMergeNode",{in:"OUTLINE"}),(0,r.jsx)("feMergeNode",{in:"SourceGraphic"})]})]})),(0,r.jsx)(a.Staff,Object.assign({},B,{top:0,gridTicks:h})),_&&(0,r.jsx)(a.Staff,Object.assign({},B,{top:l.BASS_STAFF_TOP,isBassClef:!0,gridTicks:h})),(0,r.jsx)(s.GridHighlight,Object.assign({},B,{start:O,end:N})),w&&(0,r.jsx)(d.WorkspaceSelection,Object.assign({},B,{range:w})),!x&&M.map(((e,n)=>(0,r.jsx)(c.Track,{track:e,song:t},n))),(0,r.jsx)(c.Track,{track:t.tracks[f],song:t,cursorLocation:R,keyboardCursor:b})]}))}},{"../../../../react-common/components/util":41,"./GridHighlight":102,"./Staff":108,"./Track":109,"./WorkspaceSelection":112,"./svgConstants":115,"./utils":116,react:366,"react/jsx-runtime":367}],112:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WorkspaceSelection=void 0;const r=e("react/jsx-runtime"),i=e("./svgConstants");n.WorkspaceSelection=e=>{const{range:t,ticksPerBeat:n}=e,o=(0,i.tickToX)(n,t.startTick+t.deltaTick),s=(0,i.tickToX)(n,t.endTick+t.deltaTick);return(0,r.jsxs)("g",{children:[(0,r.jsx)("rect",{className:"music-workspace-selection",fill:"#03adfc",opacity:.5,x:Math.min(o,s),y:i.STAFF_HEADER_HEIGHT,width:Math.max(o,s)-Math.min(o,s),height:i.WORKSPACE_HEIGHT-i.STAFF_HEADER_HEIGHT}),(0,r.jsx)("rect",{className:"music-workspace-selection",fill:"#03adfc",opacity:.5,x:Math.min(o,s),y:i.BASS_STAFF_TOP+i.STAFF_HEADER_HEIGHT,width:Math.max(o,s)-Math.min(o,s),height:i.WORKSPACE_HEIGHT-i.STAFF_HEADER_HEIGHT})]})}},{"./svgConstants":115,"react/jsx-runtime":367}],113:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.handleKeyboardEvent=void 0;const r=e("./playback"),i=e("./utils");n.handleKeyboardEvent=function(e,t,n){const o=n.ctrlKey||n.metaKey,s=n.shiftKey,a=n.altKey,l=t.selection?void 0:(0,i.findNoteEventAtTick)(e,t.track,t.tick);(null==l?void 0:l.startTick)===t.tick&&void 0===t.noteGroupIndex&&(t.noteGroupIndex=0);let c=e,u=Object.assign(Object.assign({},t),{selection:t.selection&&Object.assign({},t.selection)});const d=e.tracks[t.track].instrument,p=d.octave,h=e.ticksPerBeat*e.beatsPerMeasure,f=h*e.measures,g=!!t.selection,m=!!e.tracks[t.track].drums,v=e=>{u.selection&&(c=(0,i.applySelection)(u.selection,t.hideTracksActive?t.track:void 0),e&&(c=(0,i.unselectAllNotes)(c)),delete u.selection)},y=t=>{for(const n of t.notes)pxsim.music.playNoteAsync(n.note,d,pxsim.music.tickToMs(c.beatsPerMinute,e.ticksPerBeat,t.endTick-t.startTick))};switch(n.key){case"ArrowUp":case"Up":if(n.preventDefault(),s){u.bassClef=!1;break}if(u.selection){u.selection.transpose++,c=(0,i.applySelection)(u.selection);break}if(!l)break;if(a&&o)u.noteGroupIndex=l.notes.length-1;else if(a)u.noteGroupIndex=Math.min(t.noteGroupIndex+1,l.notes.length-1);else{let n=l.notes[t.noteGroupIndex],r=(0,i.isBassClefNote)(p,n,m);const s=(0,i.noteToRow)(p,n,m);let a=s;const h=o?12:1;for(;l.notes.some((e=>(0,i.isBassClefNote)(p,e,m)===r&&a===(0,i.noteToRow)(p,e,m)));)if((a+=h)>=12){if(!r)break;r=!1,a-=12}if(a>=12||a<0)break;const f=(0,i.rowToNote)(p,a,r,m,n.enharmonicSpelling);c=(0,i.removeNoteAtRowFromTrack)(c,t.track,s,(0,i.isBassClefNote)(p,n,m),l.startTick),c=(0,i.addNoteToTrack)(c,t.track,f,l.startTick,l.endTick);const g=(0,i.findNoteEventAtTick)(c,t.track,t.tick);u.noteGroupIndex=g.notes.findIndex((e=>e.note===f.note)),pxsim.music.playNoteAsync(f.note,d,pxsim.music.tickToMs(c.beatsPerMinute,e.ticksPerBeat,g.endTick-g.startTick))}break;case"ArrowDown":case"Down":if(n.preventDefault(),s){u.bassClef=!0;break}if(u.selection){u.selection.transpose--,c=(0,i.applySelection)(u.selection);break}if(!l)break;if(a&&o)u.noteGroupIndex=0;else if(a)u.noteGroupIndex=Math.max(t.noteGroupIndex-1,0);else{let n=l.notes[t.noteGroupIndex];const r=c.tracks[t.track];let s=(0,i.isBassClefNote)(p,n,!!r.drums);const a=(0,i.noteToRow)(p,n,!!r.drums);let h=a;const f=o?-12:-1;for(;l.notes.some((e=>(0,i.isBassClefNote)(p,e,!!r.drums)===s&&h===(0,i.noteToRow)(p,e,!!r.drums)));)if((h+=f)<0){if(s)break;s=!0,h+=12}if(h>=12||h<0)break;const g=(0,i.rowToNote)(p,h,s,!!r.drums,n.enharmonicSpelling);c=(0,i.removeNoteAtRowFromTrack)(c,t.track,a,(0,i.isBassClefNote)(p,n,!!r.drums),l.startTick),c=(0,i.addNoteToTrack)(c,t.track,g,l.startTick,l.endTick);const m=(0,i.findNoteEventAtTick)(c,t.track,t.tick);u.noteGroupIndex=m.notes.findIndex((e=>e.note===g.note)),pxsim.music.playNoteAsync(g.note,d,pxsim.music.tickToMs(c.beatsPerMinute,e.ticksPerBeat,m.endTick-m.startTick))}break;case"ArrowLeft":case"Left":if(n.preventDefault(),s&&g&&(u.selection.deltaTick||u.selection.transpose)&&v(!0),o){u.tick%h==0?u.tick=Math.max(u.tick-h,0):u.tick=Math.floor(u.tick/h)*h;const e=(0,i.findNoteEventAtTick)(c,t.track,u.tick);(null==e?void 0:e.startTick)===u.tick?(u.noteGroupIndex=0,y(e)):u.noteGroupIndex=void 0;break}const b=t.tick%t.gridTicks!=0?Math.floor(u.tick/t.gridTicks)*t.gridTicks:t.tick-t.gridTicks,x=(0,i.findPreviousNoteEvent)(c,t.track,t.tick-1);if((null==x?void 0:x.endTick)>b){u.tick=x.startTick,u.noteGroupIndex=0;break}u.tick=Math.max(b,0),u.noteGroupIndex=void 0;break;case"ArrowRight":case"Right":if(n.preventDefault(),s&&g&&(u.selection.deltaTick||u.selection.transpose)&&v(!0),o){u.tick%h==0?u.tick=Math.min(u.tick+h,f-h):(u.tick=Math.min(Math.ceil(u.tick/h)*h,f-h),u.tick>=f&&(u.tick-=h));const e=(0,i.findNoteEventAtTick)(c,t.track,u.tick);(null==e?void 0:e.startTick)===u.tick?(u.noteGroupIndex=0,y(e)):u.noteGroupIndex=void 0;break}const E=l?Math.ceil(l.endTick/t.gridTicks)*t.gridTicks:t.tick+t.gridTicks,_=(0,i.findNextNoteEvent)(c,t.track,t.tick);if((null==_?void 0:_.startTick)<=E){u.tick=_.startTick,u.noteGroupIndex=0;break}u.tick=Math.min(Math.ceil(E/t.gridTicks)*t.gridTicks,f-t.gridTicks),u.noteGroupIndex=void 0;break;case"End":if(n.preventDefault(),o){u.tick=f-t.gridTicks;const e=(0,i.findNoteEventAtTick)(c,t.track,u.tick);e?(u.tick=e.startTick,u.noteGroupIndex=0,y(e)):u.noteGroupIndex=void 0}break;case"Home":if(n.preventDefault(),o){u.tick=0;const e=(0,i.findNoteEventAtTick)(c,t.track,u.tick);e?(u.noteGroupIndex=0,y(e)):u.noteGroupIndex=void 0}break;case"Backspace":if(n.preventDefault(),t.selection)v(),c=(0,i.deleteSelectedNotes)(c);else if(void 0!==t.noteGroupIndex){if(o){c=(0,i.removeNoteEventFromTrack)(c,t.track,t.tick),u.noteGroupIndex=void 0;break}c=(0,i.removeNoteFromTrack)(c,t.track,l.notes[t.noteGroupIndex],l.startTick),1===l.notes.length?u.noteGroupIndex=void 0:u.noteGroupIndex=Math.min(u.noteGroupIndex,l.notes.length-2)}break;case"Enter":g&&v(!0);break;case"Spacebar":case" ":(0,r.isPlaying)()?(0,r.stopPlayback)():(0,r.startPlaybackAsync)(e,o);break;case"j":case"J":if(e.tracks[t.track].drums)break;if(l){n.preventDefault();const e=l.notes[u.noteGroupIndex],r=12*d.octave-20,o=12*d.octave+20,s=(0,i.noteToRow)(p,e,!1),a=l.startTick,h=(0,i.isBassClefNote)(p,e,!1);let f;c=(0,i.removeNoteAtRowFromTrack)(c,u.track,s,h,a),f="normal"===e.enharmonicSpelling&&e.note<o?"sharp":"sharp"===e.enharmonicSpelling&&e.note>r||e.note===o?"flat":"normal";const g=(0,i.rowToNote)(d.octave,s,h,!1,f);c=(0,i.addNoteToTrack)(c,u.track,g,l.startTick,l.endTick),pxsim.music.playNoteAsync(g.note,d,pxsim.music.tickToMs(c.beatsPerMinute,c.ticksPerBeat,t.gridTicks))}break;default:if(o&&"a"===n.key||"A"===n.key){n.preventDefault(),u.selection&&v(!0),u.selection={startTick:0,endTick:f,originalSong:c,transpose:0,deltaTick:0};break}if(/^[a-g]$/i.test(n.key)){if(o)break;let e;n.preventDefault(),v(!0),e=t.bassClef?(0,i.rowToNote)(p,3+"abcdefg".indexOf(n.key.toLowerCase()),!0,m):(0,i.rowToNote)(p,5+"abcdefg".indexOf(n.key.toLowerCase()),!1,m),l?-1===l.notes.indexOf(e)&&(c=(0,i.addNoteToTrack)(c,t.track,e,l.startTick,l.endTick),y((0,i.findNoteEventAtTick)(c,t.track,l.startTick))):(c=(0,i.addNoteToTrack)(c,t.track,e,t.tick,t.tick+t.gridTicks),u.noteGroupIndex=0,y((0,i.findNoteEventAtTick)(c,t.track,t.tick)));break}if(/^[1-9]$/.test(n.key)){n.preventDefault(),v(!0),l&&(c=(0,i.editNoteEventLength)(c,t.track,l.startTick,l.startTick+parseInt(n.key)*t.gridTicks),y((0,i.findNoteEventAtTick)(c,t.track,l.startTick)));break}}if(u.tick!==t.tick)if(s)u.selection?u.selection.endTick=u.tick:u.selection={originalSong:e,startTick:t.tick,endTick:u.tick,transpose:0,deltaTick:0},c=(0,i.applySelection)(u.selection,u.hideTracksActive?u.track:void 0);else if(u.selection){const e=(0,i.selectNoteEventsInRange)(u.selection.originalSong,u.selection.startTick,u.selection.endTick,u.hideTracksActive?u.track:void 0),n=(0,i.findSelectedRange)(e,u.gridTicks);n&&(u.selection.startTick=n.start,u.selection.endTick=n.end),u.selection.deltaTick+=u.tick-t.tick,c=(0,i.applySelection)(u.selection,u.hideTracksActive?u.track:void 0),u.selection.startTick+u.selection.deltaTick>0&&(u.tick=u.selection.startTick+u.selection.deltaTick)}return[c,u]}},{"./playback":114,"./utils":116}],114:[function(e,t,n){"use strict";let r;Object.defineProperty(n,"__esModule",{value:!0}),n.removePlaybackStateListener=n.addPlaybackStateListener=n.removeTickListener=n.addTickListener=n.stopPlayback=n.updatePlaybackSongAsync=n.setLooping=n.isLooping=n.isPlaying=n.startPlaybackAsync=void 0;let i=[],o=[];function s(){return!!r&&"stop"!==r.state()}n.startPlaybackAsync=async function(e,t){r||(r=new pxsim.music.Sequencer,await r.initAsync(),r.addEventListener("state-change",(()=>{for(const e of i)e(r.state())})),r.addEventListener("tick",(()=>{for(const e of o)e(r.currentTick())})),r.setVolume(100)),r.start(e,t)},n.isPlaying=s,n.isLooping=function(){return s()&&"loop"===r.state()},n.setLooping=function(e){r&&r.setLooping(e)},n.updatePlaybackSongAsync=async function(e){r&&r.updateSong(e)},n.stopPlayback=function(){r&&r.stop()},n.addTickListener=function(e){o.push(e)},n.removeTickListener=function(e){o=o.filter((t=>e!==t))},n.addPlaybackStateListener=function(e){i.push(e)},n.removePlaybackStateListener=function(e){i=i.filter((t=>e!==t))}},{}],115:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.rowY=n.closestRow=n.closestTick=n.beatToX=n.tickToX=n.workspaceWidth=n.BASS_CLEF_HEIGHT=n.BASS_CLEF_TOP=n.BASS_STAFF_HEADER_HEIGHT=n.BASS_STAFF_TOP=n.NOTE_DURATION_HEIGHT=n.NOTE_ICON_WIDTH=n.WORKSPACE_HEIGHT=n.STAFF_GRID_TICK_HEIGHT=n.STAFF_END_WIDTH=n.STAFF_HEADER_OFFSET=n.STAFF_HEADER_FONT_SIZE=n.STAFF_HEADER_HEIGHT=n.CLEF_HEIGHT=n.CLEF_WIDTH=n.STAFF_ROW_HEIGHT=n.BEAT_WIDTH=void 0,n.BEAT_WIDTH=150,n.STAFF_ROW_HEIGHT=50,n.CLEF_WIDTH=250,n.CLEF_HEIGHT=320,n.STAFF_HEADER_HEIGHT=n.STAFF_ROW_HEIGHT,n.STAFF_HEADER_FONT_SIZE=40,n.STAFF_HEADER_OFFSET=11,n.STAFF_END_WIDTH=25,n.STAFF_GRID_TICK_HEIGHT=7,n.WORKSPACE_HEIGHT=n.STAFF_HEADER_HEIGHT+7*n.STAFF_ROW_HEIGHT,n.NOTE_ICON_WIDTH=45,n.NOTE_DURATION_HEIGHT=n.NOTE_ICON_WIDTH/3,n.BASS_STAFF_TOP=n.WORKSPACE_HEIGHT,n.BASS_STAFF_HEADER_HEIGHT=n.STAFF_ROW_HEIGHT/2,n.BASS_CLEF_TOP=90,n.BASS_CLEF_HEIGHT=230,n.workspaceWidth=function(e,t){return n.CLEF_WIDTH+e*t*n.BEAT_WIDTH+n.STAFF_END_WIDTH},n.tickToX=function(e,t){return n.CLEF_WIDTH+n.BEAT_WIDTH/e*t},n.beatToX=function(e){return n.CLEF_WIDTH+n.BEAT_WIDTH*e},n.closestTick=function(e,t,r){const i=Math.floor((t-n.CLEF_WIDTH)*(e/n.BEAT_WIDTH));return Math.floor(i/r)*r},n.closestRow=function(e){const t=e>n.BASS_STAFF_TOP;return 12-Math.round((e-n.STAFF_HEADER_HEIGHT-(t?n.BASS_STAFF_TOP:0))/(n.STAFF_ROW_HEIGHT/2))},n.rowY=function(e,t){return t?n.BASS_STAFF_TOP+n.STAFF_HEADER_HEIGHT+(12-e%12)*n.STAFF_ROW_HEIGHT/2:n.STAFF_HEADER_HEIGHT+(12-e%12)*n.STAFF_ROW_HEIGHT/2}},{}],116:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.doesSongUseBassClef=n.applySelection=n.moveSelectedNotes=n.deleteSelectedNotes=n.unselectAllNotes=n.selectNoteEventsInRange=n.findSelectedRange=n.changeSongLength=n.findNoteEventAtPosition=n.findNextNoteEvent=n.findPreviousNoteEvent=n.findNoteEventAtTick=n.fillDrums=n.editNoteEventLength=n.removeNoteEventFromTrack=n.removeNoteAtRowFromTrack=n.removeNoteFromTrack=n.addNoteToTrack=n.isBassClefNote=n.noteToRow=n.resolveImageURL=n.rowToNote=void 0;const r=[0,2,4,5,7,9,11,12,14,16,17,19],i=[0,1,3,5,7,8,10,12,13,15,17,19];function o(e,t,n,o,s){if(o)return{note:t+(n?12:0),enharmonicSpelling:"normal"};let a;return a=n?i[t]+12*e-19:r[t]+12*e+1,s&&"normal"!==s?"sharp"===s?{note:a+1,enharmonicSpelling:s}:{note:a-1,enharmonicSpelling:s}:{note:a,enharmonicSpelling:"normal"}}function s(e,t,n){if(n)return t.note>=12?t.note-12:t.note;const o=a(e,t,!1),s=t.note-1-12*e+(o?20:0),l=o?i:r;for(let e=0;e<l.length;e++){if(l[e]===s)return"normal"===t.enharmonicSpelling?e:"sharp"===t.enharmonicSpelling?e-1:e+1;if(l[e]>s){if("sharp"===t.enharmonicSpelling)return e-1;if("flat"===t.enharmonicSpelling)return e}}return"sharp"===t.enharmonicSpelling&&s===l[l.length-1]+1?l.length-1:-1}function a(e,t,n){return n?t.note>=12:"flat"===t.enharmonicSpelling?t.note<12*e:"sharp"===t.enharmonicSpelling?t.note<=12*e+1:t.note<12*e+1}function l(e,t,n,r,i){return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,o)=>o!==t?e:Object.assign(Object.assign({},e),{notes:c(e.notes,n,r,i,e.instrument.octave,!!e.drums).filter((e=>(e.startTick<=r||e.startTick>=i)&&(e.endTick>=i||e.endTick<=r)))})))})}function c(e,t,n,r,i,o){const l={notes:[t],startTick:n,endTick:r};for(let r=0;r<e.length;r++){if(e[r].startTick>n)return e.slice(0,r).concat([l]).concat(e.slice(r));if(e[r].endTick>n)return e[r].notes.some((e=>e.note===t.note&&e.enharmonicSpelling===t.enharmonicSpelling))?e.slice():e.map(((e,n)=>n!==r?e:Object.assign(Object.assign({},e),{notes:e.notes.concat([t]).sort(((e,t)=>{const n=a(i,e,o);return n===a(i,t,o)?s(i,e,o)-s(i,t,o):n?-1:1}))})))}return e.slice().concat([l])}function u(e,t,n){const r=e.slice();for(let e=0;e<r.length;e++)if(r[e].startTick==n){r[e]=Object.assign(Object.assign({},r[e]),{notes:r[e].notes.filter((e=>e.note!==t.note))});break}return r.filter((e=>e.notes.length))}function d(e,t,n,r,i,o){const l=e.slice();for(let e=0;e<l.length;e++)if(l[e].startTick==i){l[e]=Object.assign(Object.assign({},l[e]),{notes:l[e].notes.filter((e=>a(r,e,o)!==n||s(r,e,o)!==t))});break}return l.filter((e=>e.notes.length))}function p(e,t,n){const r=e.slice();if(t>=n)return r;let i;for(let e=0;e<r.length;e++)r[e].startTick===t?(i=Object.assign(Object.assign({},r[e]),{endTick:n}),r[e]=i):i&&r[e].startTick<i.endTick&&(r[e]=void 0);return r.filter((e=>!!e))}function h(e,t,n){const r=e.tracks[t];for(const e of r.notes)if(e.startTick<=n&&e.endTick>n)return e}function f(e,t){let n=e.measures*e.beatsPerMeasure*e.ticksPerBeat+1,r=-1;for(const t of e.tracks)for(const e of t.notes)e.selected&&(n=Math.min(e.startTick,n),r=Math.max(e.endTick,r));if(-1!==r)return void 0!==t&&(n=Math.floor(n/t)*t,r=Math.ceil(r/t)*t),{start:n,end:r}}function g(e,t,n,r){return void 0!==r?Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,i)=>i!==r?e:m(e,Math.min(t,n),Math.max(t,n))))}):Object.assign(Object.assign({},e),{tracks:e.tracks.map((e=>m(e,Math.min(t,n),Math.max(t,n))))})}function m(e,t,n){return Object.assign(Object.assign({},e),{notes:e.notes.map((e=>Object.assign(Object.assign({},e),{notes:e.notes.slice(),selected:!(e.startTick>=n||e.endTick<=t)})))})}function v(e){return Object.assign(Object.assign({},e),{tracks:e.tracks.map((e=>Object.assign(Object.assign({},e),{notes:e.notes.map((e=>Object.assign(Object.assign({},e),{selected:!1})))})))})}function y(e,t,n,r){const i=f(e);if(!i)return e;const{start:o,end:s}=i,a=o+t,l=s+t,c=e.beatsPerMeasure*e.ticksPerBeat*e.measures;return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,i)=>void 0!==r&&r!=i?e:Object.assign(Object.assign({},e),{notes:e.notes.filter((e=>e.selected||e.endTick<=a||e.startTick>=l)).map((r=>r.selected?x(r,e.instrument.octave,t,n,!!e.drums):r)).map((e=>Object.assign(Object.assign({},e),{endTick:Math.min(e.endTick,c)}))).filter((e=>e.notes.length>0&&e.startTick>=0&&e.startTick<c)).sort(((e,t)=>e.startTick-t.startTick))})))})}function b(e,t){return e.pastedContent?function(e,t){const n=b(e.pastedContent,t),r=f(n,t),i=e.startTick+e.deltaTick,o=i+(r.end-r.start),s=v(e.originalSong),a=s.beatsPerMeasure*s.ticksPerBeat*s.measures;return Object.assign(Object.assign({},s),{tracks:s.tracks.map(((s,l)=>void 0!==t&&t!=l?s:Object.assign(Object.assign({},s),{notes:s.notes.filter((e=>e.endTick<=i||e.startTick>=o)).concat(n.tracks[l].notes.filter((e=>e.selected)).map((t=>Object.assign(Object.assign({},t),{startTick:t.startTick-r.start+e.startTick,endTick:t.endTick-r.start+e.startTick})))).map((t=>t.selected?x(t,s.instrument.octave,e.deltaTick,e.transpose,!!s.drums):t)).map((e=>Object.assign(Object.assign({},e),{endTick:Math.min(e.endTick,a)}))).filter((e=>e.notes.length>0&&e.startTick>=0&&e.startTick<a)).sort(((e,t)=>e.startTick-t.startTick))})))})}(e,t):y(g(e.originalSong,e.startTick,e.endTick,t),e.deltaTick,e.transpose,t)}function x(e,t,n,i,l){const c=Object.assign(Object.assign({},e),{startTick:e.startTick+n,endTick:e.endTick+n,notes:[]});if(l)c.notes=e.notes.slice();else for(const n of e.notes){let e=a(t,n,l),u=s(t,n,l);u+i>=r.length?e&&(u-=12,e=!1):u+i<0&&(e||(u+=12,e=!0));const d=u+i;d<0||d>=r.length||c.notes.push(o(t,d,e,l,n.enharmonicSpelling))}return c}n.rowToNote=o,n.resolveImageURL=function(e){return window.MonacoPaths&&window.MonacoPaths[e]||e},n.noteToRow=s,n.isBassClefNote=a,n.addNoteToTrack=l,n.removeNoteFromTrack=function(e,t,n,r){return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,i)=>i!==t?e:Object.assign(Object.assign({},e),{notes:u(e.notes,n,r)})))})},n.removeNoteAtRowFromTrack=function(e,t,n,r,i){return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,o)=>o!==t?e:Object.assign(Object.assign({},e),{notes:d(e.notes,n,r,e.instrument.octave,i,!!e.drums)})))})},n.removeNoteEventFromTrack=function(e,t,n){return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,r)=>r!==t?e:Object.assign(Object.assign({},e),{notes:e.notes.filter((e=>e.startTick!==n))})))})},n.editNoteEventLength=function(e,t,n,r){const i=e.beatsPerMeasure*e.ticksPerBeat*e.measures;return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,o)=>o!==t?e:Object.assign(Object.assign({},e),{notes:p(e.notes,n,Math.min(r,i))})))})},n.fillDrums=function(e,t,n,r,i,o){for(let s=r;s<i;s+=o)e=l(e,t,{note:n,enharmonicSpelling:"normal"},s,s+1);return e},n.findNoteEventAtTick=h,n.findPreviousNoteEvent=function(e,t,n){const r=e.tracks[t];let i;for(const e of r.notes){if(e.startTick>n)return i;i=e}return i},n.findNextNoteEvent=function(e,t,n){const r=e.tracks[t];for(const e of r.notes)if(e.startTick>n)return e},n.findNoteEventAtPosition=function(e,t,n){if(void 0!==n){const r=h(e,n,t.tick),i=e.tracks[n];return(null==r?void 0:r.notes.some((e=>s(i.instrument.octave,e,!!i.drums)===t.row)))?r:void 0}for(let n=0;n<e.tracks.length;n++){const r=h(e,n,t.tick),i=e.tracks[n];if(null==r?void 0:r.notes.some((e=>s(i.instrument.octave,e,!!i.drums)===t.row)))return r}},n.changeSongLength=function(e,t){const n=t*e.beatsPerMeasure*e.ticksPerBeat;return Object.assign(Object.assign({},e),{measures:t,tracks:e.tracks.map((e=>{const t=Object.assign(Object.assign({},e),{notes:e.notes.slice()});return t.notes=t.notes.filter((e=>e.startTick<n)),t.notes=t.notes.map((e=>Object.assign(Object.assign({},e),{endTick:Math.min(e.endTick,n)}))),t}))})},n.findSelectedRange=f,n.selectNoteEventsInRange=g,n.unselectAllNotes=v,n.deleteSelectedNotes=function(e){return Object.assign(Object.assign({},e),{tracks:e.tracks.map((e=>Object.assign(Object.assign({},e),{notes:e.notes.filter((e=>!e.selected))})))})},n.moveSelectedNotes=y,n.applySelection=b,n.doesSongUseBassClef=function(e){return e.tracks.some((e=>e.notes.some((t=>t.notes.some((t=>a(e.instrument.octave,t,!!e.drums)))))))}},{}],117:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Tour=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../../../../react-common/components/controls/TeachingBubble");n.Tour=e=>{const{onClose:t,tourSteps:n}=e,[s,a]=(0,i.useState)(0),l=(0,i.useRef)(Date.now()),c=(0,i.useRef)(Date.now());(0,i.useEffect)((()=>{c.current=Date.now()}),[s]);const u=()=>({title:n[s].title,stepDuration:((Date.now()-c.current)/1e3).toFixed(1)+"s",tourDuration:((Date.now()-l.current)/1e3).toFixed(1)+"s",step:s+1,totalSteps:n.length});return(0,r.jsx)(o.TeachingBubble,{id:"teachingBubble",targetContent:n[s],onNext:()=>{pxt.tickEvent("tour.next",u()),a(s+1)},onBack:()=>{pxt.tickEvent("tour.back",u()),a(s-1)},stepNumber:s+1,totalSteps:n.length-1,onClose:()=>{pxt.tickEvent("tour.exit",u()),t()},onFinish:()=>{pxt.tickEvent("tour.finish",u()),t()}})}},{"../../../../react-common/components/controls/TeachingBubble":18,react:366,"react/jsx-runtime":367}],118:[function(e,t,n){"use strict";var r=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.SearchInput=void 0;const i=e("react/jsx-runtime"),o=e("react");class s extends o.Component{constructor(e){super(e),this.updateInputValue=e=>{const{searchOnChange:t}=this.props,n=e.target.value;this.setState({inputValue:n}),t&&this.handleSearch(n)},this.state={inputValue:(null==e?void 0:e.defaultValue)||""},this.handleSearchKeyUpdate=this.handleSearchKeyUpdate.bind(this),this.handleClick=this.handleClick.bind(this)}handleSearchKeyUpdate(e){13==e.keyCode&&this.handleSearch(this.state.inputValue)}handleSearch(e){const{searchHandler:t}=this.props;t(e)}handleClick(){this.handleSearch(this.state.inputValue)}render(){const e=this.props,{ariaMessage:t,disabled:n,loading:o,placeholder:s,autoFocus:a,className:l,inputClassName:c,searchOnChange:u,searchHandler:d}=e,p=r(e,["ariaMessage","disabled","loading","placeholder","autoFocus","className","inputClassName","searchOnChange","searchHandler"]),{inputValue:h}=this.state;return(0,i.jsx)("div",Object.assign({className:`ui search ${l||""}`},p,{children:(0,i.jsxs)("div",Object.assign({className:`ui icon input ${c||""}`},{children:[(0,i.jsx)("div",Object.assign({"aria-live":"polite",className:"accessible-hidden",id:"searchInputBoxLabel"},{children:t})),(0,i.jsx)("input",{role:"search",autoFocus:a,ref:"searchInput","aria-labelledby":"searchInputBoxLabel",className:"prompt",type:"text",placeholder:s,onChange:this.updateInputValue,value:h,onKeyUp:this.handleSearchKeyUpdate,disabled:n,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}),(0,i.jsx)("i",{role:"button",onClick:this.handleClick,title:lf("Search"),style:{cursor:"pointer"},className:`search link icon ${n?"disabled":""} ${o?"loading":""}`})]}))}))}}n.SearchInput=s},{react:366,"react/jsx-runtime":367}],119:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SoundControls=void 0;const r=e("react/jsx-runtime"),i=e("../../../../react-common/components/controls/Dropdown"),o=e("../../../../react-common/components/controls/RadioButtonGroup"),s=e("../../../../react-common/components/controls/Input"),a=e("../../../../react-common/components/controls/DraggableGraph");function l(e){switch(e){case"sine":return pxt.U.lf("Sine");case"square":return pxt.U.lf("Square");case"triangle":return pxt.U.lf("Triangle");case"sawtooth":return pxt.U.lf("Sawtooth");case"noise":return pxt.U.lf("Noise")}}n.SoundControls=e=>{const{onSoundChange:t,sound:n,handleStartAnimationRef:c}=e,u=[{title:l("sine"),id:"sine",icon:"xicon sound-sine"},{title:l("square"),id:"square",icon:"xicon sound-square"},{title:l("sawtooth"),id:"sawtooth",icon:"xicon sound-saw"},{title:l("triangle"),id:"triangle",icon:"xicon sound-triangle"},{title:l("noise"),id:"noise",icon:"xicon sound-noise"}],d=[{label:pxt.U.lf("Linear"),leftIcon:"xicon sound-linear",title:pxt.U.lf("Linear"),id:"linear"},{label:pxt.U.lf("Curve"),leftIcon:"xicon sound-curve",title:pxt.U.lf("Curve"),id:"curve"},{label:pxt.U.lf("Logarithmic"),leftIcon:"xicon sound-logarithmic",title:pxt.U.lf("Logarithmic"),id:"logarithmic"}],p=[{label:pxt.U.lf("None"),leftIcon:"xicon sound-none",title:pxt.U.lf("None"),id:"none"},{label:pxt.U.lf("Vibrato"),leftIcon:"xicon sound-vibrato",title:pxt.U.lf("Vibrato"),id:"vibrato"},{label:pxt.U.lf("Tremolo"),leftIcon:"xicon sound-tremolo",title:pxt.U.lf("Tremolo"),id:"tremolo"},{label:pxt.U.lf("Warble"),leftIcon:"xicon sound-warble",title:pxt.U.lf("Warble"),id:"warble"}],h=e=>{const r=parseInt(e);isNaN(r)||t(Object.assign(Object.assign({},n),{duration:Math.max(Math.min(0|r,9999),1)}))};let f,g;return c&&c((e=>{f&&f(e),g&&g(e)})),(0,r.jsxs)("div",Object.assign({className:"sound-controls"},{children:[(0,r.jsxs)("div",Object.assign({className:"waveform-and-duration"},{children:[(0,r.jsxs)("div",Object.assign({className:"waveform-control-label"},{children:[(0,r.jsx)("span",Object.assign({className:"sound-label"},{children:pxt.U.lf("Waveform:")})),(0,r.jsx)("span",Object.assign({className:"sound-label waveform-name"},{children:l(n.wave)}))]})),(0,r.jsxs)("div",Object.assign({className:"waveform-and-duration-controls"},{children:[(0,r.jsx)(o.RadioButtonGroup,{className:"common-radio-buttons",id:"waveform-select",choices:u,selectedId:n.wave,onChoiceSelected:e=>{t(Object.assign(Object.assign({},n),{wave:e}))}}),(0,r.jsxs)("div",Object.assign({className:"duration-controls"},{children:[(0,r.jsx)("div",Object.assign({className:"sound-label"},{children:pxt.U.lf("Duration (ms)")})),(0,r.jsx)(s.Input,{initialValue:n.duration+"",className:"sound-duration-input",onEnterKey:h,treatSpaceAsEnter:!0,onBlur:h})]}))]}))]})),(0,r.jsxs)("div",Object.assign({className:"sound-graph-container"},{children:[(0,r.jsxs)("div",Object.assign({className:"frequency-graph"},{children:[(0,r.jsxs)("div",Object.assign({className:"sound-graph-header"},{children:[(0,r.jsx)("span",Object.assign({className:"sound-label"},{children:pxt.U.lf("Frequency")})),(0,r.jsxs)("div",Object.assign({className:"dropdown-and-label"},{children:[(0,r.jsx)("span",Object.assign({className:"sound-label"},{children:pxt.U.lf("Effect")})),(0,r.jsx)(i.Dropdown,{id:"effect-dropdown",className:"icon-preview",selectedId:n.effect,onItemSelected:e=>{t(Object.assign(Object.assign({},n),{effect:e}))},items:p})]})),(0,r.jsxs)("div",Object.assign({className:"dropdown-and-label"},{children:[(0,r.jsx)("span",Object.assign({className:"sound-label"},{children:pxt.U.lf("Interpolation")})),(0,r.jsx)(i.Dropdown,{id:"interpolation-dropdown",className:"icon-preview hang-left",selectedId:n.interpolation,onItemSelected:e=>{t(Object.assign(Object.assign({},n),{interpolation:e}))},items:d})]}))]})),(0,r.jsx)(a.DraggableGraph,{min:1,max:pxt.assets.MAX_FREQUENCY,aspectRatio:3,valueUnits:pxt.U.lf("Hz"),points:[n.startFrequency,n.endFrequency],interpolation:n.interpolation,onPointChange:(e,r)=>{t(0===e?Object.assign(Object.assign({},n),{startFrequency:r}):Object.assign(Object.assign({},n),{endFrequency:r}))},handleStartAnimationRef:e=>{f=e},squiggly:"vibrato"===n.effect||"warble"===n.effect})]})),(0,r.jsxs)("div",Object.assign({className:"volume-graph"},{children:[(0,r.jsx)("div",Object.assign({className:"sound-graph-header"},{children:(0,r.jsx)("span",Object.assign({className:"sound-label"},{children:pxt.U.lf("Volume")}))})),(0,r.jsx)(a.DraggableGraph,{min:0,max:pxt.assets.MAX_VOLUME,aspectRatio:5,points:[n.startVolume,n.endVolume],interpolation:"linear",onPointChange:(e,r)=>{t(0===e?Object.assign(Object.assign({},n),{startVolume:r}):Object.assign(Object.assign({},n),{endVolume:r}))},handleStartAnimationRef:e=>{g=e},squiggly:"tremolo"===n.effect})]}))]}))]}))}},{"../../../../react-common/components/controls/DraggableGraph":6,"../../../../react-common/components/controls/Dropdown":7,"../../../../react-common/components/controls/Input":11,"../../../../react-common/components/controls/RadioButtonGroup":17,"react/jsx-runtime":367}],120:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SoundEffectEditor=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../../../../react-common/components/controls/Button"),s=e("./SoundControls"),a=e("./SoundEffectHeader"),l=e("./SoundGallery"),c=e("./SoundPreview"),u=e("./soundUtil");function d(e){const t=Object.assign({},e);t.interpolation=p("linear","curve","logarithmic"),t.duration=f(t.duration+(Math.random()-.5)*t.duration,Math.min(100,t.duration),Math.max(2e3,t.duration)),"noise"===t.wave?h(20)&&(t.wave=p("sine","sawtooth","square","triangle"),t.effect=p("vibrato","tremolo","warble")):(t.wave=p("sine","sawtooth","square","triangle"),("none"!==t.effect||h(10))&&(t.effect=p("vibrato","tremolo","warble")));const n=t.endFrequency-t.startFrequency;let r=n+2*n*(Math.random()-.5);Math.sign(n)!==Math.sign(r)&&(r*=-1),r=f(r,-pxt.assets.MAX_FREQUENCY,pxt.assets.MAX_FREQUENCY),t.startFrequency=f(Math.random()*pxt.assets.MAX_FREQUENCY,Math.max(-r,1),f(5e3-r,1,pxt.assets.MAX_FREQUENCY)),t.endFrequency=f(t.startFrequency+r,1,pxt.assets.MAX_FREQUENCY);const i=t.endVolume-t.startVolume;let o=i+i*(Math.random()-.5);return o=f(o,-pxt.assets.MAX_VOLUME,pxt.assets.MAX_VOLUME),Math.sign(i)!==Math.sign(o)&&(o*=-1),t.startVolume=f(Math.random()*pxt.assets.MAX_VOLUME,Math.max(-o,0),f(pxt.assets.MAX_VOLUME-o,0,pxt.assets.MAX_VOLUME)),t.endVolume=f(t.startVolume+o,0,pxt.assets.MAX_VOLUME),t}function p(...e){return e[Math.floor(Math.random()*e.length)]}function h(e){return 100*Math.random()<e}function f(e,t,n){return Math.floor(Math.min(n,Math.max(t,e)))}n.SoundEffectEditor=e=>{const{onSoundChange:t,onClose:n,initialSound:p,useMixerSynthesizer:h}=e,[f,g]=i.useState("editor"),[m,v]=i.useState(p),[y,b]=i.useState(void 0),[x,E]=i.useState(null);let _,w,S;const T=()=>{x&&(x.cancelled=!0,_&&_(-1),w&&w(-1))};i.useEffect((()=>{const e=e=>{1!==e.key.length||e.metaKey||e.ctrlKey||/[0-9]/.test(e.key)||document.activeElement&&"INPUT"===document.activeElement.tagName&&"text"===document.activeElement.type||k()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}));const k=async(e=m)=>{T();let t={cancelled:!1};E(t),_&&_(e.duration),w&&w(e.duration);const n=()=>t.cancelled,r=(n,r)=>{S(n,r,e,t)};h?await pxsim.AudioContextManager.playInstructionsAsync(pxt.assets.soundToInstructionBuffer(e,20,1),n,r):await pxsim.codal.music.playSoundExpressionAsync((0,u.soundToCodalSound)(e).src,n,r),E(null)},C=(e,n=!0)=>{x&&T(),n&&b(void 0),t&&t(e),v(e)};return(0,r.jsxs)("div",Object.assign({className:"sound-effect-editor"},{children:[(0,r.jsx)(a.SoundEffectHeader,{selectedView:f,onViewSelected:e=>{g(e)},onClose:()=>{n&&n()}}),(0,r.jsxs)("div",Object.assign({className:"sound-effect-editor-content"},{children:[(0,r.jsx)(c.SoundPreview,{sound:m,handleStartAnimationRef:e=>{_=e},handleSynthListenerRef:e=>{S=e}}),(0,r.jsx)(o.Button,{className:"sound-effect-play-button",title:x?lf("Stop"):lf("Play"),onClick:()=>{x?T():k()},leftIcon:x?"fas fa-stop":"fas fa-play"}),(0,r.jsx)(s.SoundControls,{sound:m,onSoundChange:C,handleStartAnimationRef:e=>{w=e}}),(0,r.jsx)(o.Button,{className:"link-button generate-similar",leftIcon:"fas fa-sync",label:pxt.U.lf("Generate Similar Sound"),title:pxt.U.lf("Generate Similar Sound"),onClick:()=>{let e;y?e=d(y):(b(m),e=d(m)),C(e,!1),k(e)}}),(0,r.jsx)(l.SoundGallery,{sounds:(0,u.getGallerySounds)(h),onSoundSelected:e=>{C(e),g("editor")},visible:"gallery"===f,useMixerSynthesizer:h})]}))]}))}},{"../../../../react-common/components/controls/Button":3,"./SoundControls":119,"./SoundEffectHeader":121,"./SoundGallery":122,"./SoundPreview":123,"./soundUtil":124,react:366,"react/jsx-runtime":367}],121:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SoundEffectHeader=void 0;const r=e("react/jsx-runtime"),i=e("../../../../react-common/components/controls/Button"),o=e("../../../../react-common/components/controls/EditorToggle");n.SoundEffectHeader=e=>{const{selectedView:t,onClose:n,onViewSelected:s}=e,a=[{label:pxt.U.lf("Editor"),title:pxt.U.lf("Editor"),onClick:()=>s("editor"),focusable:!0},{label:pxt.U.lf("Gallery"),title:pxt.U.lf("Gallery"),onClick:()=>s("gallery"),focusable:!0}];return(0,r.jsxs)("div",Object.assign({className:"sound-effect-header"},{children:[(0,r.jsx)(o.EditorToggle,{id:"sound-effect-editor-toggle",items:a,selected:"editor"===t?0:1}),(0,r.jsx)(i.Button,{className:"menu-button",onClick:n,title:lf("Close"),rightIcon:"fas fa-times-circle"})]}))}},{"../../../../react-common/components/controls/Button":3,"../../../../react-common/components/controls/EditorToggle":8,"react/jsx-runtime":367}],122:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SoundGallery=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../../../../react-common/components/controls/Button"),s=e("../../../../react-common/components/util"),a=e("./soundUtil");n.SoundGallery=e=>{const{sounds:t,onSoundSelected:n,visible:i,useMixerSynthesizer:o}=e;return(0,r.jsx)("div",Object.assign({className:(0,s.classList)("sound-gallery",i&&"visible"),"aria-hidden":!i},{children:(0,r.jsx)("div",Object.assign({className:"sound-gallery-scroller"},{children:t.map(((e,t)=>(0,r.jsx)("div",Object.assign({className:"common-button",title:e.name,role:"button",tabIndex:0,onKeyDown:s.fireClickOnEnter,onClick:()=>n(e.sound)},{children:(0,r.jsx)(l,Object.assign({},e,{useMixerSynthesizer:o}))}),t)))}))}))};const l=e=>{const{sound:t,name:n,useMixerSynthesizer:s}=e,[l,c]=i.useState(null);return(0,r.jsxs)("div",Object.assign({className:"sound-gallery-item-label"},{children:[(0,r.jsx)("div",Object.assign({className:"sound-effect-name"},{children:n})),(0,r.jsx)("div",Object.assign({className:"sound-gallery-preview"},{children:(0,r.jsx)("svg",Object.assign({viewBox:"0 0 160 40",xmlns:"http://www.w3.org/2000/svg"},{children:(0,r.jsx)("path",{className:"sound-gallery-preview-wave",d:pxt.assets.renderSoundPath(t,160,40),stroke:"grey",strokeWidth:"2",fill:"none"})}))})),(0,r.jsx)(o.Button,{className:"sound-effect-play-button",title:l?lf("Stop Sound Preview"):lf("Preview Sound"),onClick:async()=>{if(l)return l.cancelled=!0,void c(null);c({cancelled:!1}),s?await pxsim.AudioContextManager.playInstructionsAsync(pxt.assets.soundToInstructionBuffer(t,20,1)):await pxsim.codal.music.playSoundExpressionAsync((0,a.soundToCodalSound)(t).src),c(null)},leftIcon:l?"fas fa-stop":"fas fa-play"})]}))}},{"../../../../react-common/components/controls/Button":3,"../../../../react-common/components/util":41,"./soundUtil":124,react:366,"react/jsx-runtime":367}],123:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SoundPreview=void 0;const r=e("react/jsx-runtime");n.SoundPreview=e=>{const{sound:t,handleStartAnimationRef:n,handleSynthListenerRef:i}=e;let o,s,a;const l=()=>{o&&s&&n((e=>{if(e<=0)return void(a=0);let n=t,r=n.startFrequency,l=n.startVolume,c=null;i(((e,t,i,o)=>{r=e,l=t*pxt.assets.MAX_VOLUME,n=i,c=o}));const u=()=>{if(!o)return;const e=Date.now()-a;if((null==c?void 0:c.cancelled)||e>n.duration)return o.setAttribute("opacity","0"),void s.setAttribute("opacity","1");o.setAttribute("opacity","1"),s.setAttribute("opacity","0"),o.setAttribute("d",pxt.assets.renderWaveSnapshot(r,l,n.wave,1e3,1e3/3.75,10)),requestAnimationFrame(u)};a=Date.now(),requestAnimationFrame(u)}))};let c;switch(t.interpolation){case"linear":c=e=>t.startFrequency+e*(t.endFrequency-t.startFrequency)/t.duration;break;case"curve":c=e=>t.startFrequency+(t.endFrequency-t.startFrequency)*Math.sin(e/t.duration*(Math.PI/2));break;case"logarithmic":c=e=>t.startFrequency+Math.log10(1+e/t.duration*9)*(t.endFrequency-t.startFrequency)}return(0,r.jsx)("div",Object.assign({className:"sound-preview"},{children:(0,r.jsxs)("svg",Object.assign({viewBox:"0 0 1000 "+1e3/3.75,xmlns:"http://www.w3.org/2000/svg"},{children:[(0,r.jsx)("path",{className:"sound-preview-baseline",d:`M 0 ${1e3/3.75/2} h 1000`,fill:"none",stroke:"grey",strokeWidth:"2px"}),(0,r.jsx)("path",{ref:e=>{e&&(s=e),l()},className:"sound-preview-static-wave",d:pxt.assets.renderSoundPath(t,1e3,1e3/3.75),fill:"none",stroke:"grey",strokeWidth:"4px",strokeLinejoin:"round"}),(0,r.jsx)("path",{ref:e=>{e&&(o=e),l()},className:"sound-preview-animated-wave",d:"",fill:"none",stroke:"#E63022",strokeWidth:"6px",strokeLinejoin:"round"}),(0,r.jsx)("rect",{x:"-2",y:"0",width:"1",height:"100%",fill:"grey"})]}))}))}},{"react/jsx-runtime":367}],124:[function(e,t,n){"use strict";function r(){return[{name:pxt.U.lf("Laser"),sound:{interpolation:"curve",effect:"none",wave:"square",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:1600,endFrequency:1,duration:300}},{name:pxt.U.lf("Radio"),sound:{interpolation:"linear",effect:"none",wave:"noise",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:500,endFrequency:499,duration:750}},{name:pxt.U.lf("Jump"),sound:{interpolation:"linear",effect:"warble",wave:"square",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:400,endFrequency:600,duration:100}},{name:pxt.U.lf("Water Drop"),sound:{interpolation:"linear",effect:"none",wave:"sine",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:200,endFrequency:600,duration:150}},{name:pxt.U.lf("Kick Drum"),sound:{interpolation:"curve",effect:"none",wave:"square",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:200,endFrequency:1,duration:100}},{name:pxt.U.lf("Tom"),sound:{interpolation:"curve",effect:"none",wave:"triangle",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:300,endFrequency:200,duration:75}},{name:pxt.U.lf("Snare"),sound:{interpolation:"logarithmic",effect:"warble",wave:"noise",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:523,endFrequency:1,duration:100}},{name:pxt.U.lf("Hi-Hat"),sound:{interpolation:"linear",effect:"none",wave:"noise",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:500,endFrequency:1,duration:10}},{name:pxt.U.lf("Cowbell"),sound:{interpolation:"linear",effect:"vibrato",wave:"sine",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:500,endFrequency:500,duration:50}},{name:pxt.U.lf("Triangle"),sound:{interpolation:"linear",effect:"none",wave:"noise",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:54,endFrequency:54,duration:500}}]}function i(){return[{name:pxt.U.lf("Laser"),sound:{interpolation:"curve",effect:"none",wave:"square",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:1600,endFrequency:1,duration:300}},{name:pxt.U.lf("Jump"),sound:{interpolation:"linear",effect:"none",wave:"square",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:400,endFrequency:600,duration:100}},{name:pxt.U.lf("Water Drop"),sound:{interpolation:"linear",effect:"none",wave:"sine",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:200,endFrequency:600,duration:150}},{name:pxt.U.lf("Kick Drum"),sound:{interpolation:"curve",effect:"none",wave:"square",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:200,endFrequency:1,duration:100}},{name:pxt.U.lf("Tom"),sound:{interpolation:"curve",effect:"none",wave:"triangle",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:300,endFrequency:200,duration:75}},{name:pxt.U.lf("Snare"),sound:{interpolation:"linear",effect:"warble",wave:"noise",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:3300,endFrequency:1400,duration:150}},{name:pxt.U.lf("Hi-Hat"),sound:{interpolation:"linear",effect:"none",wave:"noise",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:3900,endFrequency:3500,duration:10}}]}Object.defineProperty(n,"__esModule",{value:!0}),n.getMixerGallerySounds=n.getCODALGallerySounds=n.getGallerySounds=n.soundToCodalSound=void 0,n.soundToCodalSound=function(e){const t=new pxsim.codal.music.Sound;switch(t.frequency=e.startFrequency,t.volume=e.startVolume/pxt.assets.MAX_VOLUME*1023|0,t.endFrequency=e.endFrequency,t.endVolume=e.endVolume/pxt.assets.MAX_VOLUME*1023|0,e.wave){case"sine":t.wave=pxsim.codal.music.WaveShape.Sine;break;case"triangle":t.wave=pxsim.codal.music.WaveShape.Triangle;break;case"square":t.wave=pxsim.codal.music.WaveShape.Square;break;case"sawtooth":t.wave=pxsim.codal.music.WaveShape.Sawtooth;break;case"noise":t.wave=pxsim.codal.music.WaveShape.Noise}switch(e.interpolation){case"linear":t.shape=pxsim.codal.music.InterpolationEffect.Linear;break;case"curve":t.shape=pxsim.codal.music.InterpolationEffect.Curve;break;case"logarithmic":t.shape=pxsim.codal.music.InterpolationEffect.Logarithmic}switch(e.effect){case"vibrato":t.fx=pxsim.codal.music.Effect.Vibrato,t.fxnSteps=512,t.fxParam=2;break;case"tremolo":t.fx=pxsim.codal.music.Effect.Tremolo,t.fxnSteps=900,t.fxParam=3;break;case"warble":t.fx=pxsim.codal.music.Effect.Warble,t.fxnSteps=700,t.fxParam=2}return t.duration=Math.max(Math.min(0|e.duration,9999),1),t.steps=90,t},n.getGallerySounds=function(e){return e?i():r()},n.getCODALGallerySounds=r,n.getMixerGallerySounds=i},{}],125:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TutorialCallout=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../../sui");n.TutorialCallout=function(e){const{children:t,className:n,buttonIcon:s,buttonLabel:a}=e,[l,c]=i.useState(!1),u=i.useRef(null),d=e=>{var t;e.preventDefault(),e.stopPropagation(),null===(t=e.nativeEvent)||void 0===t||t.stopImmediatePropagation()},p=e=>{document.removeEventListener("click",h,!0),c(!1)},h=e=>{var t;(null===(t=null==u?void 0:u.current)||void 0===t?void 0:t.contains(e.target))||p()},f=lf("Click to show a hint!");return(0,r.jsxs)("div",Object.assign({ref:u,className:n},{children:[(0,r.jsx)(o.Button,{icon:s,text:a,className:"tutorial-callout-button",title:f,ariaLabel:f,disabled:!t,onClick:t?t=>{const{onClick:n}=e;n&&n(l),(e=>{d(e),l?document.removeEventListener("click",h,!0):document.addEventListener("click",h,!0),c(!l)})(t)}:void 0}),l&&(0,r.jsxs)("div",Object.assign({className:"tutorial-callout no-select",onClick:d},{children:[(0,r.jsx)(o.Button,{icon:"close",className:"tutorial-callout-close",onClick:p}),t]})),l&&(0,r.jsx)("div",{className:"tutorial-callout-mask",onClick:p})]}))}},{"../../sui":200,react:366,"react/jsx-runtime":367}],126:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TutorialContainer=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../../marked"),s=e("../../sui"),a=e("../../immersivereader"),l=e("./TutorialStepCounter"),c=e("./TutorialHint"),u=e("./TutorialResetCode"),d=e("../../../../react-common/components/util"),p=e("./TutorialValidationErrorMessage"),h=e("../tutorialValidators");n.TutorialContainer=function(e){const{parent:t,tutorialId:n,name:f,steps:g,hideIteration:m,hasTemplate:v,preferredEditor:y,tutorialOptions:b,onTutorialStepChange:x,onTutorialComplete:E,setParentHeight:_}=e,[w,S]=i.useState(e.currentStep||0),[T,k]=i.useState(0),[C,A]=i.useState(!1),[j,I]=i.useState(!1),[O,N]=i.useState(e.tutorialSimSidebar?"horizontal":"vertical"),[R,P]=i.useState([]),D=i.useRef(void 0),M=i.useRef(void 0),L=0!==w,B=w!==g.length-1,F=!B&&!pxt.appTarget.appTheme.lockedEditor&&!m,U=pxt.appTarget.appTheme.immersiveReader,H="horizontal"===O;i.useEffect((()=>{const t=new ResizeObserver((()=>{var t,n;pxt.BrowserUtils.isTabletSize()||e.tutorialSimSidebar?N("horizontal"):N("vertical"),I((null===(t=null==D?void 0:D.current)||void 0===t?void 0:t.scrollHeight)>(null===(n=null==D?void 0:D.current)||void 0===n?void 0:n.offsetHeight))}));return t.observe(document.body),()=>t.disconnect()}),[document.body]),i.useEffect((()=>{var e,t,n;if(H){let r=0;((null===(e=null==D?void 0:D.current)||void 0===e?void 0:e.children)?pxt.Util.toArray(null===(t=null==D?void 0:D.current)||void 0===t?void 0:t.children):[]).forEach((e=>r+=null==e?void 0:e.scrollHeight)),M&&(r-=(null===(n=M.current)||void 0===n?void 0:n.scrollHeight)||0);const i=Math.max(Math.min(194,Math.floor(.25*window.innerHeight)),80);r&&_(Math.min(Math.max(r+2,80),i))}else _()})),i.useEffect((()=>{S(e.currentStep)}),[e.currentStep]),i.useEffect((()=>{var e;const t=null==D?void 0:D.current;t.scrollTo(0,0),null===(e=t.querySelector(".tutorial-step-content"))||void 0===e||e.focus(),I(t.scrollHeight>t.offsetHeight),k(0),x(w),B&&A(!1)}),[w]),i.useEffect((()=>()=>o.MarkedContent.clearBlockSnippetCache()),[C]);const G=g[w];if(!g[w])return(0,r.jsx)("div",{});const q=G.showDialog,V=q?Math.min(w+1,g.length-1):w,z=g.findIndex((e=>!e.showDialog)),W=g[V].title,K=g[V].headerContentMd,$=g[V].hintContentMd,Y=async(t=!1)=>{var r,i,o,s;let a={};null===(i=null===(r=G.localValidationConfig)||void 0===r?void 0:r.validatorsMetadata)||void 0===i||i.forEach((e=>a[e.validatorType]=(0,h.GetValidator)(e))),null===(s=null===(o=b.globalValidationConfig)||void 0===o?void 0:o.validatorsMetadata)||void 0===s||s.forEach((e=>{a[e.validatorType]||(a[e.validatorType]=(0,h.GetValidator)(e))}));let l=[];for(let t of Object.values(a)){let n=await(null==t?void 0:t.execute({parent:e.parent,tutorialOptions:e.tutorialOptions}));n&&!n.isValid&&l.push(n)}if(P(l),0==l.length)X(t);else{let e=T+1;k(e),pxt.tickEvent("codevalidation.stopnext",{tutorial:n,step:w,errorCount:l.length,attemptsWithError:e})}},X=(t=!1)=>{var r;const i=Math.min(w+1,e.steps.length-1);pxt.tickEvent("tutorial.next",{tutorial:n,step:i,isModal:q?1:0,validationErrors:null!==(r=null==R?void 0:R.length)&&void 0!==r?r:0,attemptsWithError:T,isStepCounter:t?1:0},{interactiveConsent:!0}),R.length>0&&P([]),S(i)},J=B?()=>X():()=>A(!0);let Q=[{label:lf("Ok"),onclick:J,icon:"arrow circle right",className:"green"}];L&&Q.unshift({label:lf("Back"),onclick:()=>{const e=Math.max(w-1,0);pxt.tickEvent("tutorial.previous",{tutorial:n,step:e,isModal:q?1:0},{interactiveConsent:!0}),S(e)},icon:"arrow circle left",disabled:!L,labelPosition:"left"}),U&&Q.push({className:"immersive-reader-button",onclick:()=>{(0,a.launchImmersiveReader)(G.contentMd,b)},ariaLabel:lf("Launch Immersive Reader"),title:lf("Launch Immersive Reader")});const Z=lf("Finish the tutorial."),ee=lf("Go to the next step of the tutorial."),te=F?(0,r.jsx)(s.Button,{icon:"check circle",title:Z,ariaLabel:Z,text:lf("Done"),onClick:E}):(0,r.jsx)(s.Button,{icon:"arrow circle right",title:ee,ariaLabel:ee,disabled:!B,text:lf("Next"),onClick:()=>Y()}),ne=(0,r.jsx)(l.TutorialStepCounter,{tutorialId:n,currentStep:V,totalSteps:g.length,title:f,isHorizontal:H,setTutorialStep:e=>{e==w+1?Y(!0):S(e)},onDone:E}),re=!!$;return(0,r.jsxs)("div",Object.assign({className:"tutorial-container"},{children:[!H&&ne,(0,r.jsx)("div",Object.assign({className:(0,d.classList)("tutorial-content",re&&"has-hint"),ref:D,onScroll:()=>{const e=null==D?void 0:D.current;I(e&&e.scrollHeight-e.scrollTop-e.clientHeight>1)}},{children:(0,r.jsxs)("div",Object.assign({className:"tutorial-content-bkg"},{children:[!H&&(0,r.jsxs)("div",Object.assign({className:"tutorial-step-label"},{children:[f&&(0,r.jsx)("span",Object.assign({className:"tutorial-step-title"},{children:f})),(0,r.jsx)("span",Object.assign({className:"tutorial-step-number"},{children:lf("Step {0} of {1}",V+1,g.length)}))]})),U&&(0,r.jsx)(a.ImmersiveReaderButton,{ref:M,content:K,tutorialOptions:b}),W&&(0,r.jsx)("div",Object.assign({className:"tutorial-title"},{children:W})),(0,r.jsx)(o.MarkedContent,{className:"no-select tutorial-step-content",tabIndex:0,markdown:K,parent:t}),(0,r.jsxs)("div",Object.assign({className:"tutorial-controls"},{children:[re&&(0,r.jsx)(c.TutorialHint,{tutorialId:n,currentStep:V,markdown:$,parent:t}),H&&ne,!H&&te]}))]}))})),R.length>0&&(0,r.jsx)(p.TutorialValidationErrorMessage,{onContinueClicked:()=>{pxt.tickEvent("codevalidation.continueanyway",{tutorial:n,step:w,attemptsWithError:T}),X()},onReturnClicked:()=>{P([]),pxt.tickEvent("codevalidation.popupclose",{tutorial:n,step:w,attemptsWithError:T})},validationFailures:R,tutorialId:n,currentStep:w,attemptsWithError:T}),v&&w==z&&"asset"!==y&&!pxt.appTarget.appTheme.hideReplaceMyCode&&(0,r.jsx)(u.TutorialResetCode,{tutorialId:n,currentStep:V,resetTemplateCode:t.resetTutorialTemplateCode}),j&&(0,r.jsx)("div",{className:"tutorial-scroll-gradient"}),q&&!C&&(0,r.jsx)(s.Modal,Object.assign({isOpen:q,closeIcon:!1,header:G.title||f,buttons:Q,className:"hintdialog",onClose:J,dimmer:!0,longer:!0,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},{children:(0,r.jsx)(o.MarkedContent,{markdown:G.contentMd,parent:t})}))]}))}},{"../../../../react-common/components/util":41,"../../immersivereader":163,"../../marked":167,"../../sui":200,"../tutorialValidators":131,"./TutorialHint":127,"./TutorialResetCode":128,"./TutorialStepCounter":129,"./TutorialValidationErrorMessage":130,react:366,"react/jsx-runtime":367}],127:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TutorialHint=void 0;const r=e("react/jsx-runtime"),i=e("../../marked"),o=e("./TutorialCallout");n.TutorialHint=function(e){const{parent:t,markdown:n,tutorialId:s,currentStep:a}=e;return(0,r.jsx)(o.TutorialCallout,Object.assign({className:"tutorial-hint",buttonIcon:"lightbulb",onClick:e=>{e||pxt.tickEvent("tutorial.showhint",{tutorial:s,step:a})}},{children:n&&(0,r.jsx)(i.MarkedContent,{className:"hint-content",markdown:n,unboxSnippets:!0,parent:t})}))}},{"../../marked":167,"./TutorialCallout":125,"react/jsx-runtime":367}],128:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TutorialResetCode=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../../sui"),s=e("./TutorialCallout");n.TutorialResetCode=function(e){const{resetTemplateCode:t,tutorialId:n,currentStep:a}=e,[l,c]=i.useState(!1);return(0,r.jsxs)(s.TutorialCallout,Object.assign({buttonLabel:lf("Replace my code"),className:"tutorial-replace-code"},{children:[(0,r.jsx)("p",{children:lf("Did the code you're working with get off track? It happens.")}),(0,r.jsx)("p",{children:lf("Click below to replace your code with updated blocks.")}),(0,r.jsx)("p",{children:lf('This will delete all your current code blocks. Any custom images and tiles can still be found in the gallery under "My Assets".')}),(0,r.jsx)("div",Object.assign({className:"tutorial-replace-code-actions"},{children:(0,r.jsx)(o.Button,{className:"primary",text:lf("Replace my code"),disabled:l,onClick:async()=>{pxt.tickEvent("tutorial.resetcode",{tutorial:n,step:a}),c(!0);try{await t(!0)}finally{document.dispatchEvent(new Event("click")),c(!1)}}})}))]}))}},{"../../sui":200,"./TutorialCallout":125,react:366,"react/jsx-runtime":367}],129:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TutorialStepCounter=void 0;const r=e("react/jsx-runtime"),i=e("../../../../react-common/components/controls/Button");n.TutorialStepCounter=function(e){const{tutorialId:t,currentStep:n,totalSteps:o,title:s,setTutorialStep:a}=e,l=Math.max(0,Math.min(n-Math.floor(3.5),o-7)),c=[];for(let e=0;e<Math.min(7,o);e++)c.push(e+l);const u=e=>()=>{pxt.tickEvent("tutorial.step",{tutorial:t,step:e,prevStep:n},{interactiveConsent:!0}),a(e)},d=e=>lf("Go to step {0} of {1}",e+1,o),p=lf("Go to the previous step of the tutorial."),h=n==o-1,f=h?lf("Finish the tutorial."):lf("Go to the next step of the tutorial.");return(0,r.jsxs)("div",Object.assign({className:"tutorial-step-counter"},{children:[(0,r.jsxs)("div",Object.assign({className:"tutorial-step-label"},{children:[s&&(0,r.jsx)("span",Object.assign({className:"tutorial-step-title"},{children:s})),(0,r.jsx)("span",Object.assign({className:"tutorial-step-number"},{children:lf("Step {0} of {1}",n+1,o)}))]})),(0,r.jsxs)("div",Object.assign({className:"tutorial-step-bubbles"},{children:[(0,r.jsx)(i.Button,{disabled:0==n,className:e.isHorizontal?"ui button counter-previous-button":"square-button",leftIcon:"icon "+(e.isHorizontal?"arrow circle left":"left chevron"),onClick:()=>{const e=Math.max(n-1,0);pxt.tickEvent("tutorial.previous",{tutorial:t,step:e,isModal:0,isStepCounter:1},{interactiveConsent:!0}),a(e)},"aria-label":p,title:p}),c.map((e=>{const t=e===n;return(0,r.jsx)(i.Button,{className:"empty circle-button "+(t?"current":""),disabled:t,onClick:u(e),"aria-label":d(e),title:d(e),label:e===n?`${e+1}`:void 0},`step${e}`)})),(0,r.jsx)(i.Button,{className:e.isHorizontal?"ui button counter-next-button":"square-button",leftIcon:"icon "+(h?"check":e.isHorizontal?"arrow circle right":"right chevron"),onClick:h?e.onDone:()=>{const e=Math.min(n+1,o-1);a(e)},"aria-label":f,title:f,label:e.isHorizontal?h?lf("Done"):lf("Next"):""})]}))]}))}},{"../../../../react-common/components/controls/Button":3,"react/jsx-runtime":367}],130:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TutorialValidationErrorMessage=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("../../../../react-common/components/controls/Button");n.TutorialValidationErrorMessage=function(e){const[t,n]=i.useState(!1),s=!!e.validationFailures.find((e=>e.hint&&""!=e.hint)),a=s?(0,r.jsx)("div",Object.assign({className:"tutorial-validation-error-hint"},{children:e.validationFailures.map(((e,t)=>e.hint?(0,r.jsx)("div",{children:e.hint},t):null))})):void 0,l=lf("Show Hint"),c=lf("Continue Anyway"),u=lf("Close");return(0,r.jsxs)("div",Object.assign({className:"tutorial-validation-error-container"},{children:[(0,r.jsx)(o.Button,{className:"tutorial-validation-error-close",onClick:e.onReturnClicked,title:u,ariaLabel:u,rightIcon:"fas fa-times-circle"}),t?a:(0,r.jsxs)("div",Object.assign({className:"tutorial-validation-error-body"},{children:[(0,r.jsx)("img",{className:"tutorial-validation-error-emoji",src:"/static/validation/ladybeetle.svg",alt:lf("Ladybug"),height:"50%"}),(0,r.jsxs)("div",Object.assign({className:"tutorial-validation-error-inner"},{children:[(0,r.jsx)("strong",{children:lf("Is there a bug?")}),(0,r.jsx)("p",{children:lf("This code doesn't look the way we expected.")}),(0,r.jsxs)("div",Object.assign({className:"tutorial-validation-error-controls"},{children:[s&&(0,r.jsx)(o.Button,{className:"teal",leftIcon:"fas fa-lightbulb",onClick:()=>{t||(pxt.tickEvent("codevalidation.showhint",{tutorial:e.tutorialId,step:e.currentStep,attemptsWithError:e.attemptsWithError}),n(!0))},title:l,ariaLabel:l,label:l}),(0,r.jsx)(o.Button,{className:"teal inverted",leftIcon:"fas fa-arrow-circle-right",onClick:e.onContinueClicked,title:c,ariaLabel:c,label:c})]}))]}))]}))]}))}},{"../../../../react-common/components/controls/Button":3,react:366,"react/jsx-runtime":367}],131:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BlocksExistValidator=n.GetValidator=void 0;const r=e("react/jsx-runtime"),i=e("../marked"),o=e("../app"),s={isValid:!0,hint:null};n.GetValidator=function(e){switch(e.validatorType.toLowerCase()){case"blocksexistvalidator":return new a(e.properties);default:return console.error(`Unrecognized validator: ${e.validatorType}`),null}};class a extends class{constructor(e){var t;this.enabled="false"!=(null===(t=e.enabled)||void 0===t?void 0:t.toLowerCase())}execute(e){return this.enabled?this.executeInternal(e):Promise.resolve(s)}}{constructor(){super(...arguments),this.name="blocksexistvalidator"}async executeInternal(e){var t;let n=[],a=[];const{parent:l,tutorialOptions:c}=e,u=c.tutorialStepInfo?c.tutorialStepInfo[c.tutorialStep]:null;if(!u)return s;const d=null===(t=(0,o.getBlocksEditor)())||void 0===t?void 0:t.editor;if(!d)return s;const p=d.getAllBlocks(!1),h=new Map;null==p||p.forEach((e=>h.set(e.type,h.get(e.type)||e.isEnabled())));const f=await function(e,t){return pxt.BrowserUtils.tutorialInfoDbAsync().then((t=>t.getAsync(e.tutorial,e.tutorialCode).then((e=>(null==e?void 0:e.highlightBlocks)?Promise.resolve(e.highlightBlocks):Promise.resolve(void 0)))))}(c);if(!f)return s;const g=f[function(e){const{tutorialStepInfo:t,tutorialStep:n}=e,r=t[n].hintContentMd;let i="";return null!=r&&r.replace(/((?!.)\s)+/g,"\n").replace(/``` *(block|blocks)\s*\n([\s\S]*?)\n```/gim,(function(e,t,n){return i=`{\n${n}\n}`,""})),pxt.BrowserUtils.getTutorialCodeHash([i])}(c)],m=g?Object.keys(g):[];for(let e=0;e<m.length;e++){let t=m[e];const r=h.get(t);void 0===r?n.push(t):r||a.push(t)}let v,y=!0;n.length>0&&a.length>0?(y=!1,v=lf("Make sure you see blocks that look like this and that they're connected to the rest of your code.")):n.length>0?(y=!1,v=lf("Make sure you see blocks that look like this in your workspace.")):a.length>0&&(y=!1,v=lf("Make sure your blocks are connected to the rest of your code like this."));const b=(null==u?void 0:u.hintContentMd)?(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:lf("Looks like you're missing some blocks.")}),(0,r.jsx)("p",{children:v}),(0,r.jsx)(i.MarkedContent,{className:"no-select tutorial-validation-answer-key-hint",markdown:u.hintContentMd,parent:l})]}):"";return{isValid:y,hint:y?void 0:b}}}n.BlocksExistValidator=a},{"../app":44,"../marked":167,"react/jsx-runtime":367}],132:[function(e,t,n){"use strict";var r=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.SandboxFooter=n.SideDocs=n.EditorSelector=n.SettingsMenu=n.DocsMenu=void 0;const i=e("react/jsx-runtime"),o=e("./data"),s=e("./sui"),a=e("./core"),l=e("./auth"),c=e("./cloudsync"),u=e("./package"),d=e("./util");function p(e,t){pxt.tickEvent("docs",{path:t},{interactiveConsent:!0}),e.startActivity({activity:"tutorial",path:t})}function h(e,t){pxt.tickEvent("docs",{path:t},{interactiveConsent:!0}),e.setSideDoc(t)}function f(e){pxt.tickEvent("tour.start",{origin:"help-menu"}),e.showOnboarding()}function g(e,t,n=""){return t.map((t=>t.tutorial?(0,i.jsx)(b,{role:"menuitem",ariaLabel:pxt.Util.rlf(t.name),text:pxt.Util.rlf(t.name),className:"ui "+n,parent:e,path:t.path,onItemClick:p},"docsmenututorial"+t.path):/^\//.test(t.path)?(0,i.jsx)(b,{role:"menuitem",ariaLabel:pxt.Util.rlf(t.name),text:pxt.Util.rlf(t.name),className:"ui "+n,parent:e,path:t.path,onItemClick:h},"docsmenu"+t.path):(0,i.jsx)("a",Object.assign({role:"menuitem","aria-label":t.name,title:t.name,className:`ui item link ${n}`,href:t.path,target:"docs"},{children:pxt.Util.rlf(t.name)}),"docsmenulink"+t.path)))}function m(e,t,n=""){const r="/"+e.toLowerCase();return(0,i.jsx)(b,{role:"menuitem",ariaLabel:pxt.Util.rlf(e),text:pxt.Util.rlf(e),className:`ui ${n}`,parent:t,path:r,onItemClick:h},"docsmenu"+r)}function v(e,t=""){return(0,i.jsx)(b,{role:"menuitem",ariaLabel:lf("Tour"),text:lf("Tour"),className:`ui ${t}`,parent:e,path:"/tour",onItemClick:f},"docsmenu/tour")}class y extends o.PureComponent{renderCore(){var e;const t=this.props.parent,n=pxt.appTarget.appTheme;return(0,i.jsxs)(s.DropdownMenu,Object.assign({role:"menuitem",icon:"help circle large",className:"item mobile hide help-dropdown-menuitem",textClass:"landscape only",title:lf("Help")},{children:["Blocks"===this.props.editor&&(null===(e=n.tours)||void 0===e?void 0:e.editor)&&v(t),g(t,n.docMenu),m(this.props.editor,t)]}))}}n.DocsMenu=y;class b extends s.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}handleClick(){const{onItemClick:e,parent:t,path:n}=this.props;e(t,n)}renderCore(){const e=this.props,{onClick:t,onItemClick:n,parent:o,path:a}=e,l=r(e,["onClick","onItemClick","parent","path"]);return(0,i.jsx)(s.Item,Object.assign({},l,{onClick:this.handleClick}))}}class x extends o.Component{constructor(e){super(e),this.state={},this.openSettings=this.openSettings.bind(this),this.showPackageDialog=this.showPackageDialog.bind(this),this.showBoardDialog=this.showBoardDialog.bind(this),this.removeProject=this.removeProject.bind(this),this.saveProject=this.saveProject.bind(this),this.toggleCollapse=this.toggleCollapse.bind(this),this.showReportAbuse=this.showReportAbuse.bind(this),this.showLanguagePicker=this.showLanguagePicker.bind(this),this.toggleHighContrast=this.toggleHighContrast.bind(this),this.toggleGreenScreen=this.toggleGreenScreen.bind(this),this.toggleAccessibleBlocks=this.toggleAccessibleBlocks.bind(this),this.showResetDialog=this.showResetDialog.bind(this),this.showShareDialog=this.showShareDialog.bind(this),this.showExitAndSaveDialog=this.showExitAndSaveDialog.bind(this),this.pair=this.pair.bind(this),this.pairBluetooth=this.pairBluetooth.bind(this),this.showAboutDialog=this.showAboutDialog.bind(this),this.print=this.print.bind(this),this.signOutGithub=this.signOutGithub.bind(this),this.hide=this.hide.bind(this)}showExitAndSaveDialog(){pxt.tickEvent("menu.home",void 0,{interactiveConsent:!0}),this.props.parent.showExitAndSaveDialog()}showShareDialog(){pxt.tickEvent("menu.share",void 0,{interactiveConsent:!0}),this.props.parent.showShareDialog()}openSettings(){pxt.tickEvent("menu.settings",void 0,{interactiveConsent:!0}),this.props.parent.openSettings()}showPackageDialog(){pxt.tickEvent("menu.addpackage",void 0,{interactiveConsent:!0}),this.props.parent.showPackageDialog()}showBoardDialog(){pxt.tickEvent("menu.changeboard",void 0,{interactiveConsent:!0}),pxt.hasHwVariants()?this.props.parent.showChooseHwDialog():this.props.parent.showBoardDialogAsync(void 0,!0)}saveProject(){pxt.tickEvent("menu.saveproject",void 0,{interactiveConsent:!0}),this.props.parent.saveAndCompile()}removeProject(){pxt.tickEvent("menu.removeproject",void 0,{interactiveConsent:!0}),this.props.parent.removeProject()}toggleCollapse(){pxt.tickEvent("menu.toggleSim",void 0,{interactiveConsent:!0}),this.props.parent.toggleSimulatorCollapse()}showReportAbuse(){pxt.tickEvent("menu.reportabuse",void 0,{interactiveConsent:!0}),this.props.parent.showReportAbuse()}showLanguagePicker(){pxt.tickEvent("menu.langpicker",void 0,{interactiveConsent:!0}),this.props.parent.showLanguagePicker()}toggleHighContrast(){pxt.tickEvent("menu.togglecontrast",void 0,{interactiveConsent:!0}),this.props.parent.toggleHighContrast()}toggleGreenScreen(){pxt.tickEvent("menu.togglegreenscreen",void 0,{interactiveConsent:!0}),this.props.parent.toggleGreenScreen()}toggleAccessibleBlocks(){pxt.tickEvent("menu.toggleaccessibleblocks",void 0,{interactiveConsent:!0}),this.props.parent.toggleAccessibleBlocks()}showResetDialog(){pxt.tickEvent("menu.reset",void 0,{interactiveConsent:!0}),pxt.tickEvent("reset"),this.props.parent.showResetDialog()}pair(){pxt.tickEvent("menu.pair"),this.props.parent.pairAsync()}pairBluetooth(){pxt.tickEvent("menu.pair.bluetooth"),a.showLoading("webblepair",lf("Pairing Bluetooth device...")),pxt.webBluetooth.pairAsync().then((()=>a.hideLoading("webblepair")))}showAboutDialog(){pxt.tickEvent("menu.about"),this.props.parent.showAboutDialog()}print(){pxt.tickEvent("menu.print"),this.props.parent.printCode()}hide(){var e;null===(e=this.dropdown)||void 0===e||e.hide()}signOutGithub(){pxt.tickEvent("menu.github.signout"),this.hide();const e=c.githubProvider();e&&(e.logout(),this.props.parent.forceUpdate(),a.infoNotification(lf("Signed out from GitHub...")))}UNSAFE_componentWillReceiveProps(e){const t={};void 0!==e.greenScreen&&(t.greenScreen=e.greenScreen),void 0!==e.accessibleBlocks&&(t.accessibleBlocks=e.accessibleBlocks),void 0!==e.showShare&&(t.showShare=e.showShare),Object.keys(t).length>0&&this.setState(t)}shouldComponentUpdate(e,t,n){return this.state.greenScreen!=t.greenScreen||this.state.accessibleBlocks!=t.accessibleBlocks||this.state.showShare!=t.showShare}renderCore(){var e,t;const n=pxt.auth.hasIdentity(),r=this.getData(l.HIGHCONTRAST),{greenScreen:o,accessibleBlocks:a}=this.state,c=pxt.appTarget.appTheme,u=pxt.appTarget.cloud&&!!pxt.appTarget.cloud.packages,d=pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.cloud.importing,p=pxt.shell.isReadOnly(),h=pxt.shell.isControllerMode(),f=c.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac()),m=pxt.appTarget.appTheme.disableFileAccessinAndroid&&pxt.BrowserUtils.isAndroid(),v=!c.lockedEditor&&!h&&l.hasIdentity(),y=this.props.showShare&&(null===(e=pxt.appTarget.cloud)||void 0===e?void 0:e.sharing)&&!h,b=!(p||h||!c.saveInMenu||f||m),x=!p&&!h&&!!c.simCollapseInMenu,E=c.greenScreen||/greenscreen=1/i.test(window.location.href),_=c.print&&!pxt.BrowserUtils.isIE(),w=c.showProjectSettings,S=c.docMenu&&c.docMenu.filter((e=>!e.tutorial)),T=(null===(t=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===t?void 0:t.deviceIcon)||"usb",k=!n&&!p&&!h&&this.getData("github:user"),C=pxt.usb.isEnabled,A=c.selectLanguage||c.highContrast||E||k;return(0,i.jsxs)(s.DropdownMenu,Object.assign({role:"menuitem",icon:"setting large",title:lf("More..."),className:"item icon more-dropdown-menuitem",ref:e=>this.dropdown=e},{children:[v&&(0,i.jsx)(s.Item,{className:"mobile only inherit",role:"menuitem",icon:"home",title:lf("Home"),text:lf("Home"),ariaLabel:lf("Home screen"),onClick:this.showExitAndSaveDialog}),y&&(0,i.jsx)(s.Item,{className:"mobile only inherit",role:"menuitem",icon:"share alternate",title:lf("Publish your game to create a shareable link"),text:lf("Share"),ariaLabel:lf("Share Project"),onClick:this.showShareDialog}),(v||y)&&(0,i.jsx)("div",{className:"ui divider mobile only inherit"}),w?(0,i.jsx)(s.Item,{role:"menuitem",icon:"options",text:lf("Project Settings"),onClick:this.openSettings}):void 0,u?(0,i.jsx)(s.Item,{role:"menuitem",icon:"disk outline",text:lf("Extensions"),onClick:this.showPackageDialog}):void 0,C?(0,i.jsx)(s.Item,{role:"menuitem",icon:T,text:lf("Connect device"),onClick:this.pair}):void 0,pxt.webBluetooth.isAvailable()?(0,i.jsx)(s.Item,{role:"menuitem",icon:"bluetooth",text:lf("Pair Bluetooth"),onClick:this.pairBluetooth}):void 0,_?(0,i.jsx)(s.Item,{role:"menuitem",icon:"print",text:lf("Print..."),onClick:this.print}):void 0,b?(0,i.jsx)(s.Item,{role:"menuitem",icon:"save",text:lf("Save Project"),onClick:this.saveProject}):void 0,h?void 0:(0,i.jsx)(s.Item,{role:"menuitem",icon:"trash",text:lf("Delete Project"),onClick:this.removeProject}),x?(0,i.jsx)(s.Item,{role:"menuitem",icon:"toggle right",text:lf("Toggle the simulator"),onClick:this.toggleCollapse}):void 0,(0,i.jsx)("div",{className:"ui divider"}),c.selectLanguage?(0,i.jsx)(s.Item,{icon:"xicon globe",role:"menuitem",text:lf("Language"),onClick:this.showLanguagePicker}):void 0,c.highContrast?(0,i.jsx)(s.Item,{role:"menuitem",text:r?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}):void 0,c.accessibleBlocks?(0,i.jsx)(s.Item,{role:"menuitem",text:a?lf("Accessible Blocks Off"):lf("Accessible Blocks On"),onClick:this.toggleAccessibleBlocks}):void 0,E?(0,i.jsx)(s.Item,{role:"menuitem",text:o?lf("Green Screen Off"):lf("Green Screen On"),onClick:this.toggleGreenScreen}):void 0,S&&g(this.props.parent,S,"setting-docs-item mobile only inherit"),k?(0,i.jsx)("div",{className:"ui divider"}):void 0,k?(0,i.jsxs)("div",Object.assign({className:"ui item",title:lf("Unlink {0} from GitHub",k.name),role:"menuitem",onClick:this.signOutGithub},{children:[(0,i.jsx)("div",Object.assign({className:"avatar",role:"presentation"},{children:(0,i.jsx)("img",{className:"ui circular image",src:k.photo,alt:lf("User picture")})})),lf("Unlink GitHub")]})):void 0,A&&(0,i.jsx)("div",{className:"ui divider"}),d?(0,i.jsx)(s.Item,{role:"menuitem",icon:"warning circle",text:lf("Report Abuse..."),onClick:this.showReportAbuse}):void 0,h?void 0:(0,i.jsx)(s.Item,{role:"menuitem",icon:"sign out",text:lf("Reset"),onClick:this.showResetDialog}),(0,i.jsx)(s.Item,{role:"menuitem",text:lf("About..."),onClick:this.showAboutDialog}),c.feedbackUrl?(0,i.jsx)("a",Object.assign({className:"ui item",href:c.feedbackUrl,role:"menuitem",title:lf("Give Feedback"),target:"_blank",rel:"noopener noreferrer"},{children:lf("Give Feedback")})):void 0]}))}}n.SettingsMenu=x;class E extends o.Component{constructor(e){super(e)}renderCore(){const e=this.props.isActive();return(0,i.jsx)(s.Item,{className:`base-menuitem ${this.props.className} ${e?"selected":""}`,role:"option",textClass:"landscape only",text:this.props.text,icon:this.props.icon,active:e,onClick:this.props.onClick,title:this.props.title})}}class _ extends o.Component{constructor(e){super(e),this.onClick=()=>{pxt.tickEvent("menu.javascript",void 0,{interactiveConsent:!0}),this.props.parent.openJavaScript()},this.isActive=()=>this.props.parent.isJavaScriptActive()}renderCore(){return(0,i.jsx)(E,{className:"javascript-menuitem",icon:"xicon js",text:"JavaScript",title:lf("Convert code to JavaScript"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class w extends o.Component{constructor(e){super(e),this.onClick=()=>{pxt.tickEvent("menu.python",void 0,{interactiveConsent:!0}),this.props.parent.openPython()},this.isActive=()=>this.props.parent.isPythonActive()}renderCore(){return(0,i.jsx)(E,{className:"python-menuitem",icon:"xicon python",text:"Python",title:lf("Convert code to Python"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class S extends o.Component{constructor(e){super(e),this.onClick=()=>{pxt.tickEvent("menu.blocks",void 0,{interactiveConsent:!0}),this.props.parent.openBlocks()},this.isActive=()=>this.props.parent.isBlocksActive()}renderCore(){return(0,i.jsx)(E,{className:"blocks-menuitem",icon:"xicon blocks",text:lf("Blocks"),title:lf("Convert code to Blocks"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class T extends o.Component{constructor(e){super(e),this.onClick=()=>{pxt.tickEvent("menu.simView",void 0,{interactiveConsent:!0}),this.props.parent.openSimView()},this.isActive=()=>this.props.parent.isEmbedSimActive()}renderCore(){const e=this.isActive(),t=this.props.parent.state.simState==pxt.editor.SimState.Running,n=t?lf("Stop the simulator"):lf("Start the simulator");return(0,i.jsx)(E,{className:"sim-menuitem",icon:e&&t?"stop":"play",text:lf("Simulator"),title:e?n:lf("Show Simulator"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class k extends o.Component{constructor(e){super(e),this.onClick=()=>{pxt.tickEvent("menu.assets",void 0,{interactiveConsent:!0}),this.props.parent.openAssets()},this.isActive=()=>this.props.parent.isAssetsActive()}renderCore(){return(0,i.jsx)(E,{className:"assets-menuitem",icon:"picture",text:lf("Assets"),title:lf("View project assets"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class C extends o.Component{constructor(e){super(e)}renderCore(){const{python:e,sandbox:t,headless:n,languageRestriction:r,parent:o}=this.props,a=e&&(o.isJavaScriptActive()||o.isPythonActive()),l="javascript-only"===r,c="python-only"===r,d="blocks-only"===r,p="no-javascript"===r,h="no-python"===r,f="no-blocks"===r,g=o.isPythonActive()||pxt.shell.isPyLangPref(),m=e&&!l&&!d&&!h,v=!(c||l||f||!u.mainEditorPkg().files[pxt.MAIN_BLOCKS]),y=!p&&!c&&!d,b=t&&!n,x=m&&y&&v,E=pxt.appTarget.appTheme.assetEditor&&!t;let C,A;return x?C=g?(0,i.jsx)(w,{parent:o}):(0,i.jsx)(_,{parent:o}):m&&y?(C=(0,i.jsx)(_,{parent:o}),A=(0,i.jsx)(w,{parent:o})):m?C=(0,i.jsx)(w,{parent:o}):y&&(C=(0,i.jsx)(_,{parent:o})),(0,i.jsxs)("div",Object.assign({id:"editortoggle",className:"ui grid padded "+(c||l?"one-language":""),role:"listbox","aria-orientation":"horizontal"},{children:[b&&(0,i.jsx)(T,{parent:o}),v&&(0,i.jsx)(S,{parent:o}),C,A,x&&(0,i.jsxs)(s.DropdownMenu,Object.assign({id:"editordropdown",role:"menuitem",icon:"chevron down",rightIcon:!0,title:lf("Select code editor language"),className:"item button attached right "+(a?"active":"")},{children:[(0,i.jsx)(_,{parent:o}),(0,i.jsx)(w,{parent:o})]})),E&&(0,i.jsx)(k,{parent:o}),(0,i.jsx)("div",{className:"ui item toggle "+(a?"dropdown-attached":"")})]}))}}n.EditorSelector=C;class A extends o.Component{constructor(e){super(e),this.openingSideDoc=!1,this.state={},this.toggleVisibility=this.toggleVisibility.bind(this),this.popOut=this.popOut.bind(this)}rootDocsUrl(){return(pxt.webConfig.docsUrl||"/--docs")+"#"}static notify(e){let t=document.getElementById("sidedocsframe");t&&t.contentWindow&&t.contentWindow.postMessage(e,"*")}setPath(e,t){this.openingSideDoc=!0;let n=this.rootDocsUrl();const r=t?"blocks":"js",i=pxt.BrowserUtils.isPxtElectron()?"?pxtElectron=true":"";i&&n.endsWith("#")&&(n=n.substr(0,n.length-1)+i+"#");const o=`${n}doc:${e}:${r}:${pxt.Util.localeInfo()}`;this.setUrl(o)}setMarkdown(e){const t=`${this.rootDocsUrl()}md:${encodeURIComponent(e)}:blocks:${pxt.Util.localeInfo()}`;this.props.parent.setState({sideDocsLoadUrl:t})}setUrl(e){this.props.parent.setState({sideDocsLoadUrl:e,sideDocsCollapsed:!1})}expand(){this.props.parent.setState({sideDocsCollapsed:!1})}collapse(){this.props.parent.setState({sideDocsCollapsed:!0})}isCollapsed(){return!!this.state.sideDocsCollapsed}popOut(){A.notify({type:"popout"})}toggleVisibility(){const e=this.props.parent.state;this.props.parent.setState({sideDocsCollapsed:!e.sideDocsCollapsed}),document.getElementById("sidedocstoggle").focus()}componentDidUpdate(){this.props.parent.editor.resize();let e=document.getElementById("sidedocstoggle");this.openingSideDoc&&e&&(e.focus(),this.openingSideDoc=!1)}UNSAFE_componentWillReceiveProps(e){const t={};null!=e.sideDocsCollapsed&&(t.sideDocsCollapsed=e.sideDocsCollapsed),null!=e.docsUrl&&(t.docsUrl=e.docsUrl),Object.keys(t).length>0&&this.setState(t)}shouldComponentUpdate(e,t,n){return this.state.sideDocsCollapsed!=t.sideDocsCollapsed||this.state.docsUrl!=t.docsUrl}renderCore(){const{sideDocsCollapsed:e,docsUrl:t}=this.state,n=pxt.Util.isUserLanguageRtl(),r=(e||n)&&!(e&&n),o=!!pxt.appTarget.appTheme.lockedEditor;if(!t)return null;const a=e?this.rootDocsUrl():t;return(0,i.jsxs)("div",{children:[(0,i.jsx)("button",Object.assign({id:"sidedocstoggle",role:"button","aria-label":e?lf("Expand the side documentation"):lf("Collapse the side documentation"),className:"ui icon button large",onClick:this.toggleVisibility},{children:(0,i.jsx)(s.Icon,{icon:"icon inverted chevron "+(r?"left":"right")})})),(0,i.jsxs)("div",Object.assign({id:"sidedocs"},{children:[(0,i.jsx)("div",Object.assign({id:"sidedocsframe-wrapper"},{children:(0,i.jsx)("iframe",{id:"sidedocsframe",src:a,title:lf("Documentation"),"aria-atomic":"true","aria-live":"assertive",sandbox:"allow-scripts allow-same-origin allow-forms "+(o?"":"allow-popups")})})),!o&&(0,i.jsx)("div",Object.assign({className:"ui app hide",id:"sidedocsbar"},{children:(0,i.jsx)("a",Object.assign({className:"ui icon link",role:"button",tabIndex:0,"data-content":lf("Open documentation in new tab"),"aria-label":lf("Open documentation in new tab"),onClick:this.popOut,onKeyDown:d.fireClickOnEnter},{children:(0,i.jsx)(s.Icon,{icon:"external"})}))}))]}))]})}}n.SideDocs=A;class j extends o.PureComponent{constructor(e){super(e),this.state={},this.compile=this.compile.bind(this)}compile(){pxt.tickEvent("sandboxfooter.compile",void 0,{interactiveConsent:!0}),this.props.parent.compile()}renderCore(){const e=pxt.appTarget.appTheme,t=lf("Download your code to the {0}",e.boardName);return(0,i.jsxs)("div",Object.assign({className:"ui horizontal small divided link list sandboxfooter"},{children:[e.organizationUrl&&e.organization?(0,i.jsx)("a",Object.assign({className:"item",target:"_blank",rel:"noopener noreferrer",href:e.organizationUrl},{children:e.organization})):void 0,(0,i.jsx)("a",Object.assign({target:"_blank",className:"item",href:e.termsOfUseUrl,rel:"noopener noreferrer"},{children:lf("Terms of Use")})),(0,i.jsx)("a",Object.assign({target:"_blank",className:"item",href:e.privacyUrl,rel:"noopener noreferrer"},{children:lf("Privacy")})),(0,i.jsx)("span",Object.assign({className:"item"},{children:(0,i.jsxs)("a",Object.assign({role:"button",className:"ui thin portrait only",title:t,onClick:this.compile},{children:[(0,i.jsx)(s.Icon,{icon:`icon ${pxt.appTarget.appTheme.downloadIcon||"download"}`}),pxt.appTarget.appTheme.useUploadMessage?lf("Upload"):lf("Download")]}))}))]}))}}n.SandboxFooter=j},{"./auth":48,"./cloudsync":55,"./core":133,"./data":136,"./package":179,"./sui":200,"./util":206,"react/jsx-runtime":367}],133:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.apiAsync=n.handleNetworkError=n.findChild=n.navigateInWindow=n.keyCodeFromEvent=n.resetFocus=n.setLanguage=n.setHighContrast=n.toggleHighContrast=n.getHighContrastOnce=n.SPACE_KEY=n.ENTER_KEY=n.ESC_KEY=n.TAB_KEY=n.promptAsync=n.confirmDelete=n.confirmAsync=n.forceUpdate=n.hideDialog=n.dialogAsync=n.infoNotification=n.warningNotification=n.errorNotification=n.cancelAsyncLoading=n.showLoadingAsync=n.showLoading=n.killLoadingQueue=n.hideLoading=n.isLoading=void 0;const r=e("react"),i=e("react-dom"),o=e("./data"),s=e("./coretsx"),a=e("./auth"),l=e("../../react-common/components/Notification");var c=pxt.Cloud;let u,d=!1,p=[],h={};function f(e){if(pxt.debug("hideloading: "+e),pxt.perf.recordMilestone(`loading done #${e}`),null!=h[e]){const t=p.indexOf(e);t>-1&&p.splice(t,1),delete h[e]}else pxt.debug("Loading not in queue, disregard: "+e);p.length>0?m():d&&u&&u.hide()}function g(e,t){pxt.debug("showloading: "+e),h[e]||(pxt.perf.recordMilestone(`loading started #${e}`),function(){if(d)return;const e=document.getElementById("content").appendChild(document.createElement("div"));u=i.render(r.createElement(s.LoadingDimmer,{}),e),d=!0}(),u.show(lf("Please wait")),p.push(e),h[e]=t,m())}function m(){if(!p.length)return;const e=p[p.length-1],t=h[e];u.show(t)}n.isLoading=function(){return u&&u.isVisible()},n.hideLoading=f,n.killLoadingQueue=function(){p=[],h={},d&&u&&u.hide()},n.showLoading=g;let v={};function y(e){clearTimeout(v[e]),f(e)}function b(e,t){(0,l.pushNotificationMessage)({kind:e,text:t,hc:w()})}function x(e){pxt.log("warning: "+e),b("warn",e)}function E(e){return e.buttons||(e.buttons=[]),e.type||(e.type="dialog"),e.hasCloseIcon&&(e.hideCancel=!0),e.hideCancel||(e.buttons||(e.buttons=[]),e.buttons.push({label:e.disagreeLbl||lf("Cancel"),className:e.disagreeClass||"cancel",icon:e.disagreeIcon||"cancel"})),e.helpUrl&&(e.bigHelpButton?e.buttons.unshift({className:"dialog-help-large help",urlButton:!0,label:lf("Help"),title:lf("Help"),url:e.helpUrl}):e.buttons.unshift({className:"circular help",title:lf("Help"),icon:"help",url:e.helpUrl})),s.renderConfirmDialogAsync(e)}function _(e){e.type="confirm",e.buttons||(e.buttons=[]);let t=0;return e.hideAgree||e.buttons.push({label:e.agreeLbl||lf("Go ahead!"),className:e.agreeClass,icon:e.agreeIcon||"checkmark",approveButton:!0,onclick:()=>{t=1}}),e.deleteLbl&&e.buttons.push({label:e.deleteLbl,className:"delete red",icon:"trash",onclick:()=>{t=2}}),E(e).then((()=>t))}function w(){return o.getData(a.HIGHCONTRAST)||!1}async function S(e){await a.setHighContrastPrefAsync(e)}n.showLoadingAsync=function(e,t,n,r=700){return clearTimeout(v[e]),v[e]=setTimeout((function(){g(e,t)}),r),n.finally((()=>{y(e)}))},n.cancelAsyncLoading=y,n.errorNotification=function(e){pxt.tickEvent("notification.error",{message:e}),b("err",e)},n.warningNotification=x,n.infoNotification=function(e){pxt.debug(e),b("info",e)},n.dialogAsync=E,n.hideDialog=function(){s.hideDialog()},n.forceUpdate=function(){s.forceUpdate()},n.confirmAsync=_,n.confirmDelete=function(e,t,n){_({header:n?lf("Would you like to delete {0} projects?",e):lf("Would you like to delete '{0}'?",e),body:lf("It will be deleted for good. No undo."),agreeLbl:lf("Delete"),agreeClass:"red",agreeIcon:"trash"}).then((e=>{e&&t()}))},n.promptAsync=function(e){e.type="prompt",e.buttons||(e.buttons=[]);let t=e.initialValue||"",n=!1;return e.onInputChanged=e=>{t=e},e.hideAgree||e.buttons.push({label:e.agreeLbl||lf("Go ahead!"),className:e.agreeClass,icon:e.agreeIcon||"checkmark",approveButton:!0,onclick:()=>{n=!0}}),E(e).then((()=>n?t:null))},n.TAB_KEY=9,n.ESC_KEY=27,n.ENTER_KEY=13,n.SPACE_KEY=32,n.getHighContrastOnce=w,n.toggleHighContrast=function(){S(!w())},n.setHighContrast=S,n.setLanguage=async function(e){pxt.BrowserUtils.setCookieLang(e),await a.setLangaugePrefAsync(e)},n.resetFocus=function(){let e=document.getElementById("content");e.tabIndex=0,e.focus(),e.blur(),e.tabIndex=-1},n.keyCodeFromEvent=function(e){return"number"==typeof e.which?e.which:e.keyCode},n.navigateInWindow=function(e){window.location.href=e},n.findChild=function(e,t){let n=i.findDOMNode(e);return t?pxt.Util.toArray(n.querySelectorAll(t)):[n]},n.handleNetworkError=function(e,t){let n=parseInt(e.statusCode);if(e.isOffline||0===n)x(lf("Network request failed; you appear to be offline"));else if(!isNaN(n)&&200!==n){if(t&&-1!==t.indexOf(n))return e;x(lf("Network request failed"))}throw e},n.apiAsync=function(e,t){return(t?c.privatePostAsync(e,t):c.privateGetAsync(e)).then((t=>(console.log("*"),console.log("*******",e,"---\x3e"),console.log("*"),console.log(t),console.log("*"),t)),(e=>{console.log(e.message)}))}},{"../../react-common/components/Notification":1,"./auth":48,"./coretsx":134,"./data":136,react:366,"react-dom":309}],134:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LoadingDimmer=n.hideDialog=n.renderConfirmDialogAsync=n.forceUpdate=n.dialogIsShowing=n.CoreDialog=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("react-dom"),s=e("./sui"),a=e("./core");class l extends i.Component{constructor(e){super(e),this.state={inputValue:e.initialValue,inputError:void 0,confirmationGranted:!e.confirmationText&&!e.confirmationCheckbox&&void 0},this.hide=this.hide.bind(this),this.modalDidOpen=this.modalDidOpen.bind(this),this.handleInputChange=this.handleInputChange.bind(this),this.handleConfirmationTextChange=this.handleConfirmationTextChange.bind(this),this.handleConfirmationCheckboxChange=this.handleConfirmationCheckboxChange.bind(this)}hide(){this.close()}close(e){this.setState({visible:!1}),this.resolve(e),this.props.onClose&&this.props.onClose()}componentDidMount(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}modalDidOpen(e){const t=this.props,n=this.refs.promptInput;if(n){n.setSelectionRange(0,9999);const e=this;n.onkeydown=t=>{a.keyCodeFromEvent(t)===a.ENTER_KEY&&e.okButton&&n.value&&(e.okButton.onclick(),t.preventDefault())}}t.onLoaded&&t.onLoaded(e)}handleInputChange(e){const t=this.props;let n;t.onInputChanged&&t.onInputChanged(e.target.value),t.onInputValidation&&(n=t.onInputValidation(e.target.value)),this.setState({inputValue:e.target.value,inputError:n})}handleConfirmationTextChange(e){this.setState({confirmationText:e,confirmationGranted:this.state.confirmationText===this.props.confirmationText})}handleConfirmationCheckboxChange(e){this.setState({confirmationGranted:e})}render(){var e;const t=this.props,{inputValue:n,inputError:i}=this.state,o=void 0===t.size?"small":t.size,a=t.hasCloseIcon||!t.hideCancel,l=t.buttons?t.buttons.filter((e=>!!e)):[];l.forEach((e=>{const t=e.onclick;e.onclick=()=>{this.close(t?t():0)},e.className||(e.className="approve positive"),e.approveButton&&(this.okButton=e)})),"prompt"==t.type&&this.okButton&&(this.okButton.disabled=!n||!!i);const c=s.cx(["coredialog",t.className]),u=pxt.BrowserUtils.isMobile();return null===(e=t.buttons)||void 0===e||e.forEach((e=>{if(e.approveButton&&void 0!==this.state.confirmationGranted){const t=" disabled";this.state.confirmationGranted?e.className=e.className.replace(t,""):e.className+=e.className.indexOf(t)>=0?"":t}})),(0,r.jsxs)(s.Modal,Object.assign({isOpen:!0,ref:"modal",className:c,onClose:this.hide,size:o,defaultOpen:!0,buttons:l,dimmer:!0,closeIcon:t.hasCloseIcon,header:t.header,headerIcon:t.headerIcon,closeOnDimmerClick:a,closeOnDocumentClick:a,closeOnEscape:a,modalDidOpen:this.modalDidOpen},{children:["prompt"==t.type&&(0,r.jsxs)("div",Object.assign({className:"ui"},{children:[(0,r.jsx)("div",Object.assign({className:"ui fluid icon input"},{children:(0,r.jsx)("input",{autoFocus:!0,className:"ui input "+(i?"error":""),type:"text",ref:"promptInput",onChange:this.handleInputChange,value:n,placeholder:t.placeholder,"aria-label":t.placeholder})})),!!i&&(0,r.jsx)("div",Object.assign({className:"ui error message"},{children:i}))]})),t.jsx,!!t.jsxd&&t.jsxd(),!!t.body&&(0,r.jsx)("p",{children:t.body}),!!t.copyable&&(0,r.jsx)(s.Input,{copy:!0,readOnly:!0,value:t.copyable,selectOnClick:!0,autoComplete:!1}),!!t.confirmationText&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{children:["Type '",t.confirmationText,"' to confirm:"]}),(0,r.jsx)(s.Input,{ref:"confirmationInput",id:"confirmationInput",ariaLabel:lf("Type your name to confirm"),autoComplete:!1,value:this.state.confirmationText||"",onChange:this.handleConfirmationTextChange,selectOnMount:!u,autoFocus:!u})]}),!!t.confirmationCheckbox&&(0,r.jsx)(s.PlainCheckbox,{label:t.confirmationCheckbox,isChecked:this.state.confirmationGranted,onChange:this.handleConfirmationCheckboxChange})]}))}}let c;n.CoreDialog=l,n.dialogIsShowing=function(){return!!c},n.forceUpdate=function(){c&&c.forceUpdate()},n.renderConfirmDialogAsync=function(e){return pxt.Util.delay(10).then((()=>{const t=document.body.appendChild(document.createElement("div")),n=o.render(i.createElement(l,e),t);return c=n,n.promise.finally((()=>(o.unmountComponentAtNode(t),void setTimeout((()=>{t.parentElement.removeChild(t),n===c&&(c=void 0)})))))}))},n.hideDialog=function(){c&&(c.hide(),c=void 0)};class u extends i.Component{constructor(e){super(e),this.state={visible:!0}}hide(){this.setState({visible:!1,content:void 0})}show(e){this.setState({visible:!0,content:e})}isVisible(){return this.state.visible}render(){const{visible:e,content:t}=this.state;return e?(0,r.jsx)(s.Dimmer,Object.assign({isOpen:!0,active:e,closable:!1},{children:(0,r.jsx)(s.Loader,Object.assign({className:"large main msg no-select","aria-live":"assertive"},{children:t}))})):(0,r.jsx)("div",{})}}n.LoadingDimmer=u},{"./core":133,"./sui":200,react:366,"react-dom":309,"react/jsx-runtime":367}],135:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CreateFunctionDialog=void 0;const r=e("react/jsx-runtime"),i=e("./data"),o=e("./sui");class s extends i.Component{constructor(e){super(e),this.state={visible:!1,functionEditorWorkspace:null,functionCallback:null,initialMutation:null,functionBeingEdited:null},this.hide=this.hide.bind(this),this.modalDidOpen=this.modalDidOpen.bind(this),this.cancel=this.cancel.bind(this),this.confirm=this.confirm.bind(this)}hide(){pxt.BrowserUtils.removeClass(Blockly.WidgetDiv.DIV,"functioneditor");const{functionEditorWorkspace:e,mainWorkspace:t}=this.state;e.clear(),e.dispose(),t.refreshToolboxSelection(),this.setState({visible:!1,functionEditorWorkspace:null,functionCallback:null,initialMutation:null,functionBeingEdited:null})}show(e,t,n){pxt.tickEvent("createfunction.show",null,{interactiveConsent:!1}),this.setState({visible:!0,functionCallback:t,initialMutation:e,mainWorkspace:n})}modalDidOpen(e){const t=document.getElementById("functionEditorWorkspace");let{functionEditorWorkspace:n,initialMutation:r}=this.state;if(!t)return;pxt.BrowserUtils.addClass(Blockly.WidgetDiv.DIV,"functioneditor"),(n=Blockly.inject(t,{trashcan:!1,move:{scrollbars:!0},renderer:"pxt"})).showContextMenu_=()=>{},n.clear();const i=n.newBlock("function_declaration");i.domToMutation(r),i.initSvg(),i.render(!1),n.centerOnBlock(i.id),n.addChangeListener((()=>{const{functionBeingEdited:e}=this.state;e&&e.updateFunctionSignature()})),this.setState({functionEditorWorkspace:n,functionBeingEdited:i}),Blockly.svgResize(n)}cancel(){pxt.tickEvent("createfunction.cancel",void 0,{interactiveConsent:!0}),this.hide()}confirm(){Blockly.hideChaff();const{functionBeingEdited:e,mainWorkspace:t,functionCallback:n}=this.state,r=e.mutationToDom();Blockly.Functions.validateFunctionExternal(r,t)&&(n(r),this.hide())}addArgumentFactory(e){return()=>this.addArgument(e)}addArgument(e){const{functionBeingEdited:t}=this.state;switch(e){case"boolean":t.addBooleanExternal();break;case"string":t.addStringExternal();break;case"number":t.addNumberExternal();break;case"Array":t.addArrayExternal();break;default:t.addCustomExternal(e)}}renderCore(){const{visible:e}=this.state,t=[{label:lf("Done"),onclick:this.confirm,icon:"check",className:"approve positive"}],n=this.getArgumentTypes().slice(),i=this.props.parent.createModalClasses("createfunction");return(0,r.jsx)(o.Modal,Object.assign({isOpen:e,className:i,size:"large",closeOnEscape:!1,closeIcon:!0,closeOnDimmerClick:!1,closeOnDocumentClick:!1,dimmer:!0,buttons:t,header:lf("Edit Function"),modalDidOpen:this.modalDidOpen,onClose:this.hide},{children:(0,r.jsxs)("div",{children:[(0,r.jsx)("span",Object.assign({className:"ui text mobile only paramlabel"},{children:lf("Add a parameter")})),(0,r.jsxs)("div",Object.assign({className:"horizontal list"},{children:[(0,r.jsx)("span",Object.assign({className:"ui text mobile hide paramlabel"},{children:lf("Add a parameter")})),n.map((e=>(0,r.jsx)(o.Button,{role:"button",className:"icon",icon:e.icon,textClass:"mobile hide",text:e.label||e.typeName,ariaLabel:lf("Add {0} parameter",e.label||e.typeName),onClick:this.addArgumentFactory(e.typeName)},e.typeName)))]})),(0,r.jsx)("div",{id:"functionEditorWorkspace"})]})}))}getArgumentTypes(){if(!s.cachedFunctionTypes){const e=[{label:lf("Text"),typeName:"string",icon:pxt.blocks.defaultIconForArgType("string")},{label:lf("Boolean"),typeName:"boolean",icon:pxt.blocks.defaultIconForArgType("boolean")},{label:lf("Number"),typeName:"number",icon:pxt.blocks.defaultIconForArgType("number")},{label:lf("Array"),typeName:"Array",icon:pxt.blocks.defaultIconForArgType("Array")}];pxt.appTarget.runtime&&pxt.appTarget.runtime.functionsOptions&&pxt.appTarget.runtime.functionsOptions.extraFunctionEditorTypes&&Array.isArray(pxt.appTarget.runtime.functionsOptions.extraFunctionEditorTypes)&&pxt.appTarget.runtime.functionsOptions.extraFunctionEditorTypes.forEach((t=>{e.push(Object.assign(Object.assign({},t),{label:t.label&&pxt.Util.rlf(`{id:type}${t.label}`),defaultName:t.defaultName&&pxt.Util.rlf(`{id:var}${t.defaultName}`)}))})),e.forEach((e=>{e.icon||(e.icon=pxt.blocks.defaultIconForArgType())})),s.cachedFunctionTypes=e}return s.cachedFunctionTypes}}n.CreateFunctionDialog=s,s.cachedFunctionTypes=null},{"./data":136,"./sui":200,"react/jsx-runtime":367}],136:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PureComponent=n.Component=n.invalidateHeader=n.getDataWithStatus=n.getData=n.getAsync=n.invalidate=n.stripProtocol=n.mountVirtualApi=n.getCached=n.loadCache=n.clearCache=n.unsubscribe=n.subscribe=n.FetchStatus=void 0;const r=e("react"),i=e("./core");var o,s,a=pxt.Cloud,l=pxt.Util;(s=o=n.FetchStatus||(n.FetchStatus={}))[s.Pending=0]="Pending",s[s.Complete=1]="Complete",s[s.Error=2]="Error",s[s.Offline=3]="Offline";const c={};let u,d={};function p(e,t){let n=x(t),r=n.components;r.indexOf(e)<0&&(r.push(e),e.subscriptions.push(n))}function h(e){let t=e.subscriptions;0!=t.length&&(e.subscriptions=[],t.forEach((t=>{let n=t.components.indexOf(e);n>=0&&t.components.splice(n,1)})))}function f(e){return e.api.expirationTime?null==e.data||Date.now()-e.lastRefresh>e.api.expirationTime(e.path):!e.lastRefresh}function g(e){return!(!e.data||e.data instanceof Error)&&/^cloud:(me\/settings|ptr-pkg-)/.test(e.path)}function m(){JSON.parse(pxt.storage.getLocal("apiCache2")||"[]").forEach((e=>{x(e.path).data=e.data}))}function v(){let e=l.values(d).filter((e=>g(e))).map((e=>({path:e.path,data:e.data})));pxt.storage.setLocal("apiCache2",JSON.stringify(e))}function y(e){let t=/^([\w\-]+):/.exec(e);return t&&c[t[1]]||l.oops("bad data protocol: "+e),c[t[1]]}function b(e,t){if(e.queued)return;if(e.api.isOffline&&e.api.isOffline())return;e.queued=!0;let n=n=>{e.data=n,e.lastRefresh=pxt.Util.now(),e.queued=!1,function(e,t){g(e)&&v();let n=e.callbackOnce;n.length>0&&(e.callbackOnce=[],l.nextTick((()=>n.forEach((e=>e()))))),e.components.length>0&&e.components.forEach((e=>l.nextTick((()=>e.onDataChanged(t)))))}(e,t)};e.api.isSync?n(e.api.getSync(e.path)):e.api.getAsync(e.path).then(n)}function x(e){return d.hasOwnProperty(e)||(d[e]={path:e,data:null,lastRefresh:0,queued:!1,callbackOnce:[],components:[],api:y(e)}),d[e]}function E(e,t){return p(e,t),T(t)}function _(e,t){l.assert(!c[e]),l.assert(!!t.getSync||!!t.getAsync),l.assert(!!t.getSync!=!!t.getAsync),t.isSync=!!t.getSync,c[e]=t}function w(e){let t=/^([\w\-]+):(.*)/.exec(e);return t?t[2]:(l.oops("protocol missing in: "+e),e)}function S(e){const t=e.replace(/:\*$/,":");l.values(d).forEach((n=>{(function(e,t){if(e.path.slice(0,t.length)==t)return!0;if(e.path.endsWith(":*")){const[n]=e.path.split(":"),[r]=t.split(":");return n==r}return!1})(n,t)&&(n.lastRefresh=0,n.components.length>0&&b(x(n.path),e),n.api.onInvalidated&&n.api.onInvalidated(e))}))}function T(e){let t=x(e);if(t.api.isSync)return{data:t.api.getSync(t.path),status:o.Complete};let n={data:t.data,status:o.Complete};return(f(t)||t.data instanceof Error)&&(n.status=t.data instanceof Error?o.Error:o.Pending,t.api.isOffline&&t.api.isOffline()?n.status=o.Offline:b(t,e)),n}n.subscribe=p,n.unsubscribe=h,n.clearCache=function(){d={},v()},n.loadCache=m,n.getCached=E,n.mountVirtualApi=_,n.stripProtocol=w,n.invalidate=S,n.getAsync=function(e){let t=x(e);return t.api.isSync?Promise.resolve(t.api.getSync(t.path)):a.isOnline()&&f(t)?new Promise(((n,r)=>{t.callbackOnce.push((()=>{n(t.data)})),b(t,e)})):Promise.resolve(t.data)},n.getData=function(e){return T(e).data},n.getDataWithStatus=T,_("cloud",{getAsync:e=>a.privateGetAsync(w(e)).catch(i.handleNetworkError),expirationTime:e=>6e4,isOffline:()=>!a.isOnline()}),_("cloud-search",{getAsync:e=>a.privateGetAsync(w(e)).catch((e=>(i.handleNetworkError(e,[404]),{statusCode:404,headers:{},json:{}}))),expirationTime:e=>6e4,isOffline:()=>!a.isOnline()}),_("extension-search",{getAsync:e=>pxt.targetConfigAsync().then((t=>pxt.github.searchAsync(w(e),null==t?void 0:t.packages))).catch(i.handleNetworkError),expirationTime:e=>36e5,isOffline:()=>!a.isOnline()}),_("gallery",{getAsync:e=>pxt.gallery.loadGalleryAsync(w(decodeURIComponent(e))).catch((e=>Promise.resolve(e))),expirationTime:e=>36e5}),_("gh-search",{getAsync:e=>pxt.targetConfigAsync().then((t=>pxt.github.searchAsync(w(e),null==t?void 0:t.packages))).catch(i.handleNetworkError),expirationTime:e=>36e4,isOffline:()=>!a.isOnline()}),_("gh-commits",{getAsync:e=>{const t=w(e),[n,r]=t.split("#",2);return pxt.github.getCommitsAsync(n,r).catch((e=>(i.handleNetworkError(e),[])))},expirationTime:e=>6e4,isOffline:()=>!a.isOnline()}),_("target-config",{getAsync:e=>{u||(u=pxt.targetConfigAsync().then((e=>(e&&(pxt.storage.setLocal("targetconfig",JSON.stringify(e)),S("target-config"),S("gh-search")),e))).catch(i.handleNetworkError));const t=JSON.parse(pxt.storage.getLocal("targetconfig")||"null");return t?Promise.resolve(t):u},expirationTime:e=>864e5,isOffline:()=>!a.isOnline()}),n.invalidateHeader=function(e,t){t&&S(e+":"+t.id)};class k extends r.Component{constructor(e){super(e),this.subscriptions=[],this.renderCoreOk=!1,this.state={}}getData(e){return this.getDataWithStatus(e).data}getDataWithStatus(e){return this.renderCoreOk||l.oops("Override renderCore() not render()"),E(this,e)}onDataChanged(){this.forceUpdate()}componentWillUnmount(){h(this)}child(e){return i.findChild(this,e)}renderCore(){return null}render(){return h(this),this.renderCoreOk=!0,this.renderCore()}setStateAsync(e){return new Promise(((t,n)=>{this.setState(e,(()=>{t()}))}))}}n.Component=k;class C extends r.PureComponent{constructor(e){super(e),this.renderCoreOk=!1,this.state={}}child(e){return i.findChild(this,e)}renderCore(){return null}render(){return this.renderCoreOk=!0,this.renderCore()}}n.PureComponent=C,m()},{"./core":133,react:366}],137:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Table=n.destroyAsync=n.getDbAsync=void 0;const r=e("pouchdb").plugin(e("pouchdb-adapter-memory"));let i;function o(){return i||(i=Promise.resolve().then((()=>{const e=new r("pxt-"+pxt.storage.storageId(),{revs_limit:2});return pxt.log(`PouchDB adapter: ${e.adapter}`),e})))}n.getDbAsync=o,n.destroyAsync=function(){return i?i.then((e=>{e.destroy(),i=void 0})):Promise.resolve()};class s{constructor(e){this.name=e}getAsync(e){return o().then((t=>t.get(this.name+"--"+e))).then((t=>(t.id=e,t)))}getAllAsync(){return o().then((e=>e.allDocs({include_docs:!0,startkey:this.name+"--",endkey:this.name+"--"}))).then((e=>e.rows.map((e=>e.doc))))}deleteAsync(e){return o().then((t=>t.remove(e)))}forceSetAsync(e){return this.getAsync(e.id).then((t=>(e._rev=t._rev,this.setAsync(e))),(t=>this.setAsync(e)))}setAsync(e){return this.setAsyncNoRetry(e).then((e=>(pxt.BrowserUtils.scheduleStorageCleanup(),e))).catch((t=>{if(409!=t.status)return pxt.reportException(t),pxt.log("table: set failed, cleaning translation db"),pxt.BrowserUtils.clearTranslationDbAsync().then((()=>pxt.BrowserUtils.clearTutorialInfoDbAsync())).then((()=>this.setAsyncNoRetry(e))).catch((e=>{throw pxt.log("table: we are out of space..."),e}));pxt.debug("table: set conflict (409)")}))}setAsyncNoRetry(e){return e.id&&!e._id&&(e._id=this.name+"--"+e.id),o().then((t=>t.put(e))).then((e=>e.rev))}}n.Table=s;pxt.github.db=new class{constructor(){this.mem=new pxt.github.MemoryGithubDb,this.table=new s("github")}latestVersionAsync(e,t){return this.mem.latestVersionAsync(e,t)}loadConfigAsync(e,t){if("master"==t)return this.mem.loadConfigAsync(e,t);const n=`config-${e}-${t}`;return this.table.getAsync(n).then((e=>(pxt.debug(`github offline cache hit ${n}`),e.config)),(r=>(pxt.debug(`github offline cache miss ${n}`),this.mem.loadConfigAsync(e,t).then((e=>this.table.forceSetAsync({id:n,config:e}).then((()=>e),(t=>e)))))))}loadPackageAsync(e,t){if(t||(pxt.debug("dep: default to master"),t="master"),"master"==t)return this.mem.loadPackageAsync(e,t);const n=`pkg-${e}-${t}`;return this.table.getAsync(n).then((e=>(pxt.debug(`github offline cache hit ${n}`),e.package)),(r=>(pxt.debug(`github offline cache miss ${n}`),this.mem.loadPackageAsync(e,t).then((e=>this.table.forceSetAsync({id:n,package:e}).then((()=>e),(t=>e)))))))}}},{pouchdb:301,"pouchdb-adapter-memory":292}],138:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DebuggerCallStack=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("./debuggerTable");class s extends i.Component{constructor(e){super(e),this.handleRowClick=(e,t)=>{if(!this.props.openLocation)return;const[n,r]=t.props.refID.split("_").map((e=>parseInt(e))),i=this.props.stackframes[r];i&&i.breakpointId===n&&this.props.openLocation(i.breakpointId,r)}}render(){return(0,r.jsx)(o.DebuggerTable,Object.assign({header:lf("Call Stack")},{children:this.props.stackframes.map(((e,t)=>{if(!e.breakpointId)return null;const n=e.breakpointId+"_"+t;let i=e.funcInfo.fileName;return 0===i.indexOf("pxt_modules/")&&(i=i.slice(12)),(0,r.jsx)(o.DebuggerTableRow,{refID:n,onClick:this.handleRowClick,leftText:e.funcInfo.functionName,rightText:`${i}:${e.funcInfo.line}`,icon:t===this.props.activeFrame?"arrow right":void 0,rowClass:"callstack-row"},n)}))}))}}n.DebuggerCallStack=s},{"./debuggerTable":139,react:366,"react/jsx-runtime":367}],139:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DebuggerTableRow=n.DebuggerTable=void 0;const r=e("react/jsx-runtime"),i=e("react");class o extends i.Component{render(){return(0,r.jsxs)("div",Object.assign({className:"ui varExplorer"},{children:[(0,r.jsx)("div",Object.assign({className:"ui variableTableHeader"},{children:this.props.header})),this.props.placeholderText&&(0,r.jsx)("div",Object.assign({className:"ui variableTablePlaceholder"},{children:this.props.placeholderText})),(0,r.jsx)("div",Object.assign({className:"ui segment debugvariables collapsing basic striped table"},{children:this.props.children}))]}))}}n.DebuggerTable=o;class s extends i.Component{constructor(){super(...arguments),this.clickHandler=e=>{this.props.onClick&&this.props.onClick(e,this)},this.valueClickHandler=e=>{this.props.onValueClick&&this.props.onValueClick(e,this)}}render(){return(0,r.jsx)("div",Object.assign({role:"listitem",className:`item ${this.props.rowClass||""}`,onClick:this.props.onClick?this.clickHandler:void 0,"aria-describedby":this.props.describedBy},{children:(0,r.jsxs)("div",Object.assign({className:"variableAndValue"},{children:[(0,r.jsxs)("div",Object.assign({className:`variable varname ${this.props.leftClass||""}`,title:this.props.leftTitle,style:this.props.depth?{marginLeft:.75*this.props.depth+"em"}:void 0},{children:[(0,r.jsx)("i",{className:`ui icon small ${this.props.icon||"invisible"}`}),(0,r.jsx)("span",{children:this.props.leftText})]})),(0,r.jsx)("div",Object.assign({className:"variable detail",role:"button",style:{padding:.2},title:this.props.rightTitle,onClick:this.valueClickHandler},{children:(0,r.jsx)("span",Object.assign({className:`varval ${this.props.rightClass||""}`},{children:this.props.rightText}))}))]}))}))}}n.DebuggerTableRow=s},{react:366,"react/jsx-runtime":367}],140:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DebuggerToolbar=void 0;const r=e("react/jsx-runtime"),i=e("react-dom"),o=e("./sui"),s=e("./data"),a=e("./simulator");class l extends s.Component{constructor(e){super(e),this.state={},this.restartSimulator=this.restartSimulator.bind(this),this.dbgPauseResume=this.dbgPauseResume.bind(this),this.dbgStepOver=this.dbgStepOver.bind(this),this.dbgStepInto=this.dbgStepInto.bind(this),this.dbgStepOut=this.dbgStepOut.bind(this),this.exitDebugging=this.exitDebugging.bind(this),this.toggleTrace=this.toggleTrace.bind(this)}restartSimulator(){pxt.tickEvent("debugger.restart",void 0,{interactiveConsent:!0}),this.props.parent.restartSimulator()}exitDebugging(){pxt.tickEvent("debugger.exit",void 0,{interactiveConsent:!0}),this.props.parent.toggleDebugging()}dbgPauseResume(){pxt.tickEvent("debugger.pauseresume",void 0,{interactiveConsent:!0}),this.props.parent.dbgPauseResume()}dbgStepOver(){pxt.tickEvent("debugger.stepover",void 0,{interactiveConsent:!0}),this.props.parent.dbgStepOver()}dbgStepInto(){pxt.tickEvent("debugger.stepinto",void 0,{interactiveConsent:!0}),this.props.parent.dbgStepInto()}dbgStepOut(){pxt.tickEvent("debugger.stepout",void 0,{interactiveConsent:!0}),a.dbgStepOut()}toggleTrace(){pxt.tickEvent("simulator.trace",void 0,{interactiveConsent:!0}),this.props.parent.toggleTrace()}getMenuDom(){const e=i.findDOMNode(this);return e&&e.firstElementChild}renderCore(){const e=this.props.parent.state,t=e.simState,n=t==pxt.editor.SimState.Running,i=t==pxt.editor.SimState.Starting,s=e.debugging;if(!s)return(0,r.jsx)("div",{});const l=a.driver&&a.driver.state==pxsim.SimulatorState.Running,c=!this.props.parent.isBlocksActive();if(!(c||this.props.parent.isBlocksActive()||pxt.appTarget.appTheme.debugExtensionCode))return(0,r.jsx)("div",{});const u=l||i,d=u?"disabled":"",p=lf("Restart debugging"),h=n?lf("Pause execution"):lf("Continue execution"),f=lf("Step into"),g=lf("Step over"),m=lf("Step out"),v=this.props.parent.state.tracing,y=v?lf("Disable Slow-Mo"):lf("Slow-Mo");return s?c?(0,r.jsx)("div",Object.assign({className:"debugtoolbar",role:"complementary","aria-label":lf("Debugger toolbar")},{children:s?(0,r.jsxs)("div",Object.assign({className:"ui compact borderless menu icon"},{children:[(0,r.jsx)(o.Item,{className:`dbg-btn dbg-pause-resume ${d} ${l?"pause":"play"}`,icon:""+(l?"pause blue":"play green"),title:h,onClick:this.dbgPauseResume},"dbgpauseresume"),(0,r.jsx)(o.Item,{className:`dbg-btn dbg-step-over ${d}`,icon:"xicon stepover "+(l?"disabled":"blue"),title:g,onClick:this.dbgStepOver},"dbgstepover"),(0,r.jsx)(o.Item,{className:`dbg-btn dbg-step-into ${d}`,icon:"xicon stepinto "+(l?"disabled":""),title:f,onClick:this.dbgStepInto},"dbgstepinto"),(0,r.jsx)(o.Item,{className:`dbg-btn dbg-step-out ${d}`,icon:"xicon stepout "+(l?"disabled":""),title:m,onClick:this.dbgStepOut},"dbgstepout"),(0,r.jsx)(o.Item,{className:"dbg-btn dbg-restart right",icon:"refresh green",title:p,onClick:this.restartSimulator},"dbgrestart"),(0,r.jsx)(o.Item,{className:"dbg-btn dbg-trace "+(v?"tracing":""),icon:"xicon turtle",title:y,onClick:this.toggleTrace},"dbgslowmo")]})):void 0})):(0,r.jsx)("div",Object.assign({className:"debugtoolbar",role:"complementary","aria-label":lf("Debugger toolbar")},{children:(0,r.jsxs)("div",Object.assign({className:"ui compact borderless menu icon"},{children:[(0,r.jsx)(o.Item,{className:`dbg-btn dbg-step separator-after ${d}`,icon:"arrow right "+(u?"disabled":"blue"),title:f,onClick:this.dbgStepInto,text:"Step"},"dbgstep"),(0,r.jsx)(o.Item,{className:"dbg-btn dbg-pause-resume "+(l?"pause":"play"),icon:""+(l?"pause blue":"play green"),title:h,onClick:this.dbgPauseResume},"dbgpauseresume"),(0,r.jsx)(o.Item,{className:"dbg-btn dbg-restart",icon:"refresh green",title:p,onClick:this.restartSimulator},"dbgrestart"),(0,r.jsx)(o.Item,{className:"dbg-btn dbg-trace "+(v?"tracing":""),icon:"xicon turtle",title:y,onClick:this.toggleTrace},"dbgslowmo")]}))})):(0,r.jsx)("div",{className:"debugtoolbar",role:"complementary","aria-label":lf("Debugger toolbar")})}}n.DebuggerToolbar=l},{"./data":136,"./simulator":192,"./sui":200,"react-dom":309,"react/jsx-runtime":367}],141:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DebuggerToolbox=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("./debuggerCallStack"),s=e("./debuggerVariables"),a=e("./debuggerToolbar");class l extends i.Component{constructor(e){super(e),this.state={sequence:0,currentFrame:0}}setBreakpoint(e,t){this.setState({lastBreakpoint:e,currentFrame:0,sequence:this.state.sequence+1,varFilters:t||this.state.varFilters})}render(){return(0,r.jsxs)("div",{children:[(0,r.jsx)(a.DebuggerToolbar,{parent:this.props.parent}),(0,r.jsx)(s.DebuggerVariables,{apis:this.props.apis,breakpoint:this.state.lastBreakpoint,filters:this.state.varFilters,activeFrame:this.state.currentFrame,sequence:this.state.sequence}),this.props.showCallStack&&(0,r.jsx)(o.DebuggerCallStack,{openLocation:this.props.openLocation,activeFrame:this.state.currentFrame,stackframes:this.state.lastBreakpoint?this.state.lastBreakpoint.stackframes:[]})]})}}n.DebuggerToolbox=l},{"./debuggerCallStack":138,"./debuggerToolbar":140,"./debuggerVariables":142,react:366,"react/jsx-runtime":367}],142:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DebuggerVariables=void 0;const r=e("react/jsx-runtime"),i=e("./data"),o=e("./simulator"),s=e("./debuggerTable");class a extends i.Component{constructor(e){super(e),this.handleComponentClick=(e,t)=>{if(this.state.frozen)return;const n=this.getVariableById(t.props.refID);n&&(this.toggle(n),null!==this.state.preview&&this.setState({preview:null}))},this.handleValueClick=(e,t)=>{if(this.state.frozen)return;const n=t.props.refID,r=e.target.getBoundingClientRect();this.setState({preview:{id:n,top:r.top,left:r.left}})},this.handlePreviewRef=e=>{if(e){const t=this.state.preview;e.focus(),e.addEventListener("blur",(()=>{var e;(null===(e=this.state.preview)||void 0===e?void 0:e.id)===t.id&&this.setState({preview:null})}));const n=window.getSelection();n.removeAllRanges();const r=document.createRange();r.selectNodeContents(e),n.addRange(r)}},this.state={globalFrame:{title:lf("Globals"),variables:[]},stackFrames:[],nextID:0,preview:null}}clear(){this.setState({globalFrame:{title:this.state.globalFrame.title,variables:[]},stackFrames:[],preview:null})}update(e=!1){this.setState({frozen:e,preview:e?null:this.state.preview})}componentDidUpdate(e){this.props.breakpoint?this.props.sequence!=this.state.renderedSequence&&this.updateVariables(this.props.breakpoint,this.props.filters):this.state.frozen||this.update(!0)}renderCore(){const{globalFrame:e,stackFrames:t,frozen:n,preview:i}=this.state,{activeFrame:o,breakpoint:a}=this.props,l=lf("Variables");let c,u=e.variables;t&&t.length&&void 0!==o&&(u=t[o].variables.concat(u)),n?c=lf("Code is running..."):u.length||(null==a?void 0:a.exceptionMessage)||(c=lf("No variables to show"));const d=c?[]:this.renderVars(u);(null==a?void 0:a.exceptionMessage)&&!n&&d.unshift((0,r.jsx)(s.DebuggerTableRow,{leftText:lf("Exception:"),leftClass:"exception",rightText:h(a.exceptionMessage),rightTitle:a.exceptionMessage},"exception-message"));const f=this.getVariableById(null==i?void 0:i.id),g=f&&lf("Current value for '{0}'",f.name);return(0,r.jsxs)("div",{children:[(0,r.jsx)(s.DebuggerTable,Object.assign({header:l,placeholderText:c},{children:d})),i&&(0,r.jsx)("div",Object.assign({id:"debugger-preview",role:"tooltip",className:"debugger-preview",ref:this.handlePreviewRef,tabIndex:0,"aria-label":g,style:{top:`${i.top}px`,left:`${i.left}px`}},{children:p(f.value)}))]})}renderVars(e,t=0,n=[]){var i;const o=null===(i=this.state.preview)||void 0===i?void 0:i.id;return e.forEach((e=>{const i=p(e.value),a=function(e){let t=e.value;if(null==t)return"undefined";let n=typeof t;switch(n){case"string":case"number":case"boolean":return n;case"object":return t.type?t.type:t.preview?t.preview:t.text?t.text:"object";default:return"unknown"}}(e);n.push((0,r.jsx)(s.DebuggerTableRow,{describedBy:e.id===o?"debugger-preview":void 0,refID:e.id,icon:e.value&&e.value.hasFields?e.children?"down triangle":"right triangle":void 0,leftText:e.name+":",leftTitle:e.name,leftClass:void 0!==e.prevValue?"changed":void 0,rightText:h(i),rightTitle:f(a)?i:void 0,rightClass:a,onClick:this.handleComponentClick,onValueClick:this.handleValueClick,depth:t},e.id)),e.children&&this.renderVars(e.children,t+1,n)})),n}updateVariables(e,t){const{globals:n,environmentGlobals:r,stackframes:i}=e;if(!n&&!r)return void this.update(!0);let o=0;const s=c(this.state.globalFrame,n);let a;if(t&&(s.variables=s.variables.filter((e=>-1!==t.indexOf(e.name)))),r&&(s.variables=s.variables.concat(l(r))),d(s.variables),i){const e=this.state.stackFrames;(a=i.map(((t,n)=>{const r=t.breakpointId+"_"+n;for(const n of e)if(n.key===r)return c(n,t.locals,u(t.arguments));return c({key:r,title:t.funcInfo.functionName,variables:[]},t.locals,u(t.arguments))}))).forEach((e=>d(e.variables)))}function u(e){return e?null!=e.thisParam?[{name:"this",value:e.thisParam},...e.params]:e.params:[]}function d(e){e.forEach((e=>{e.id=o++,e.children&&d(e.children)}))}this.setState({globalFrame:s,stackFrames:a||[],nextID:o,renderedSequence:this.props.sequence,frozen:!1})}getVariableById(e){if(null===e)return null;for(const t of this.getFullVariableList())if(t.id===e)return t;return null}getFullVariableList(){let e=[];return t(this.state.globalFrame.variables),this.state.stackFrames&&this.state.stackFrames.forEach((e=>t(e.variables))),e;function t(n){n.forEach((n=>{e.push(n),n.children&&t(n.children)}))}}toggle(e){if(e.children)delete e.children,this.setState({globalFrame:this.state.globalFrame});else{if(!e.value||!e.value.id)return;let t=this.props.apis,n=new RegExp("^((.+.)?"+e.value.type+")."),r=Object.keys(t).filter((e=>n.test(e))),i=[];r.forEach((e=>{let n=t[e];!e.endsWith("@set")&&n&&n.attributes.callInDebugger&&i.push(e)})),o.driver.variablesAsync(e.value.id,i).then((t=>{if(t&&t.variables){let n=this.state.nextID;e.children=Object.keys(t.variables).map((e=>({name:e,value:t.variables[e],id:n++}))),this.setState({globalFrame:this.state.globalFrame,nextID:n})}}))}}}function l(e){return Object.keys(e).map((t=>({name:u(t),value:e[t]})))}function c(e,t,n){let r=l(t);return n&&(r=n.concat(r)),Object.assign(Object.assign({},e),{variables:d(e.variables,r)})}function u(e){return e.replace(/___\d+$/,"")}function d(e,t){return t.map((t=>{const n=function(e,t){for(let n=0;n<e.length;n++)if(e[n].name===t.name)return e[n]}(e,t);return n&&n.value&&!n.value.id&&n.value!==t.value?Object.assign(Object.assign({},t),{prevValue:n.value}):t}))}function p(e){let t="";switch(typeof e){case"undefined":t="undefined";break;case"number":case"boolean":t=e+"";break;case"string":t=JSON.stringify(e);break;case"object":if(null==e)t="null";else if(e.text)t=e.text;else{if(e.id&&e.preview)return e.preview;t=void 0!==e.id?"(object)":"(unknown)"}}return t}function h(e){let t=17,n=!1;return 0==e.indexOf('"')&&(t-=2,n=!0,e=e.substring(1,e.length-1)),e.length>t&&(e=e.substring(0,t)+"..."),n&&(e='"'+e+'"'),e}function f(e){switch(e){case"string":case"number":case"boolean":case"array":return!0;default:return!1}}n.DebuggerVariables=a},{"./data":136,"./debuggerTable":139,"./simulator":192,"react/jsx-runtime":367}],143:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isDontShowDownloadDialogFlagSet=n.clearDontShowDownloadDialogFlag=n.renderIncompatibleHardwareDialog=n.renderBrowserDownloadInstructions=n.promptTranslateBlock=n.showResetDialogAsync=n.showReportAbuseAsync=n.showImportFileDialogAsync=n.showImportGithubDialogAsync=n.showCreateGithubRepoDialogAsync=n.showGithubTokenError=n.showImportUrlDialogAsync=n.showPRDialogAsync=n.ProgressBar=n.showPackageErrorDialogAsync=n.showAboutDialogAsync=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("./sui"),s=e("./core"),a=e("./coretsx"),l=e("./cloudsync");var c=pxt.Cloud,u=pxt.Util;const d=e("./util"),p=e("./cmds");let h=!1;function f(e,t){let n,r,i;return"object"==typeof t.codalTarget&&"string"==typeof t.codalTarget.url?(n=t.codalTarget.branch?pxt.BrowserUtils.joinURLs(t.codalTarget.url,"releases/tag",t.codalTarget.branch):t.codalTarget.url,r=t.codalTarget.branch||"master",i=t.codalTarget.name||t.serviceId):(n=`https://github.com/${t.githubCorePackage}/releases/tag/${t.gittag}`,r=t.gittag,i=t.serviceId),g(lf("{0} runtime",i),r,n)}function g(e,t,n){return(0,r.jsxs)("p",{children:[lf("{0} version:",e)," ",(0,r.jsx)("a",Object.assign({href:encodeURI(n),title:`${lf("{0} version: {1}",e,t)}`,"aria-label":`${lf("{0} version{1}",e,t)}`,target:"_blank",rel:"noopener noreferrer"},{children:t}))]})}n.showAboutDialogAsync=function(e){var t;pxt.appTarget.compileService;const n=pxt.appTarget.appTheme.githubUrl,i=pxt.appTarget.appTheme,o=pxt.appTarget.versions,a=[];i.experiments&&a.push({label:lf("Experiments"),className:"secondary",onclick:()=>{s.hideDialog(),pxt.tickEvent("about.experiments",void 0,{interactiveConsent:!0}),e.showExperimentsDialog()}});const l=((null===(t=pxt.appTarget.multiVariants)||void 0===t?void 0:t.map((e=>{const t=pxt.U.clone(pxt.appTarget.compileService),n=pxt.appTarget.variants[e];return(null==n?void 0:n.compileService)&&pxt.U.jsonCopyFrom(t,n.compileService),{variantName:e,compileService:t}})))||[{variantName:"",compileService:pxt.appTarget.compileService}]).filter((e=>e.compileService&&e.compileService.githubCorePackage&&e.compileService.gittag&&e.compileService.serviceId));pxt.targetConfigAsync().then((e=>{var t;const c=pxt.BrowserUtils.isPxtElectron(),u=null===(t=null==e?void 0:e.electronManifest)||void 0===t?void 0:t.latest;return s.confirmAsync({header:lf("About"),hasCloseIcon:!0,agreeLbl:lf("Ok"),agreeClass:"positive",buttons:a,jsx:(0,r.jsxs)("div",{children:[c?pxt.Cloud.isOnline()&&u?pxt.semver.strcmp(pxt.appTarget.versions.target,u)<0?(0,r.jsx)("a",Object.assign({target:"_blank",rel:"noopener noreferrer",href:"/offline-app"},{children:lf("An update {0} for {1} is available",u,pxt.appTarget.title)})):(0,r.jsx)("p",{children:lf("{0} is up to date",pxt.appTarget.title)}):(0,r.jsx)("p",{children:lf("Please connect to internet to check for updates")}):void 0,n&&o&&g(pxt.appTarget.name,o.target,`${n}/releases/tag/v${o.target}`),o&&g("Microsoft MakeCode",o.pxt,`https://github.com/Microsoft/pxt/releases/tag/v${o.pxt}`),(null==l?void 0:l.length)?l.map((e=>(0,r.jsx)("div",{children:f(e.variantName,e.compileService)},e.variantName))):void 0,(0,r.jsx)("p",{children:(0,r.jsx)("br",{})}),(0,r.jsxs)("p",{children:[i.termsOfUseUrl?(0,r.jsx)("a",Object.assign({target:"_blank",className:"item",href:i.termsOfUseUrl,rel:"noopener noreferrer"},{children:lf("Terms of Use")})):void 0," ",i.privacyUrl?(0,r.jsx)("a",Object.assign({target:"_blank",className:"item",href:i.privacyUrl,rel:"noopener noreferrer"},{children:lf("Privacy")})):void 0]}),i.copyrightText?(0,r.jsxs)("p",{children:[" ",i.copyrightText," "]}):void 0]})})}))},n.showPackageErrorDialogAsync=function(e,t,n){let i=!1;const o=new u.CancellationToken;return pxt.tickEvent("update.extensionErrorsShown"),s.dialogAsync({header:lf("Extension Errors"),hasCloseIcon:!0,jsx:(0,r.jsx)("div",Object.assign({className:"wizard-wrapper"},{children:(0,r.jsx)(m,{openLegacyEditor:n,affectedPackages:e,updatePackages:t,onProjectOpen:()=>i=!0,token:o})}))}).then((()=>i?Promise.resolve():(s.showLoading("package-update-cancel",lf("Stopping update...")),o.cancelAsync()))).then((()=>(s.hideLoading("package-update-cancel"),i)))};class m extends i.Component{constructor(e){super(e),this.state={updating:!1,showProgressBar:!1,updateComplete:!1,packagesUpdated:0},this.startUpdate=this.startUpdate.bind(this),this.openProject=this.openProject.bind(this),this.openLegacyEditor=this.openLegacyEditor.bind(this)}startUpdate(){if(this.state.updating)return;pxt.tickEvent("update.startExtensionUpdate");const e=Date.now();this.setState({updating:!0}),setTimeout((()=>{this.props.token.isCancelled()||this.state.updating&&this.props.affectedPackages.length>1&&this.setState({showProgressBar:!0})}),3e3);const t=this.props.affectedPackages;this.props.token.onProgress((e=>{this.setState({packagesUpdated:e})})),this.props.updatePackages(t,this.props.token).then((t=>{this.props.token.isCancelled()||(pxt.tickEvent("update.endExtensionUpdate",{success:""+t,duration:Date.now()-e}),t?(this.setState({updating:!1,updateComplete:!0}),setTimeout((()=>{this.props.token.isCancelled()||this.openProject(!0)}),1500)):this.setState({updateError:!0,updating:!1}))}))}openProject(e=!1){e||pxt.tickEvent("update.ignoredExtensionErrors"),this.props.onProjectOpen(),a.hideDialog()}openLegacyEditor(){this.props.onProjectOpen(),this.props.openLegacyEditor()}buildActionList(){const e=[];return this.state.updateError||e.push({text:lf("Try to fix"),title:lf("Update all extensions in the project to their latest versions"),callback:this.startUpdate}),e.push({text:lf("Ignore errors and open"),title:lf("Ignore errors and open"),callback:this.openProject}),this.props.openLegacyEditor&&e.push({text:lf("Go to the old editor"),title:lf("Open this project in the editor where it was created"),callback:this.openLegacyEditor}),e}render(){const{affectedPackages:e}=this.props,{updating:t,updateComplete:n,packagesUpdated:i,updateError:o,showProgressBar:s}=this.state;if(t){const t=i===e.length?lf("Finishing up..."):lf("Updating extension {0} of {1}...",i+1,e.length);return(0,r.jsx)("div",{children:s?(0,r.jsx)(v,{percentage:i/e.length*100,label:t}):(0,r.jsx)("div",Object.assign({className:"ui centered inline inverted text loader"},{children:t}))})}if(n)return(0,r.jsx)("div",{children:(0,r.jsxs)("h2",Object.assign({className:"ui center aligned icon header"},{children:[(0,r.jsx)("i",{className:"green check circle outline icon"}),lf("Update complete")]}))});const a=o?lf("Looks like updating didn't fix the issue. How would you like to proceed?"):lf("Looks like there are some errors in the extensions added to this project. How would you like to proceed?");return(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{children:a}),(0,r.jsx)(y,{actions:this.buildActionList()})]})}}class v extends i.Component{render(){let{percentage:e,label:t,cornerRadius:n}=this.props;return n=null==n?3:Math.max(n,0),e=Math.max(Math.min(e,100),2),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",Object.assign({className:"progress-bar-container"},{children:(0,r.jsxs)("svg",Object.assign({className:"progress-bar",width:"100%",height:"100%"},{children:[(0,r.jsx)("rect",{className:"progress-bar-bg",width:"100%",height:"100%",rx:n,ry:n}),(0,r.jsx)("rect",{className:"progress-bar-content",width:e.toString()+"%",height:"100%",rx:n,ry:n})]}))})),t?(0,r.jsx)("p",Object.assign({className:"progress-bar-label"},{children:t})):void 0]})}}n.ProgressBar=v;class y extends o.StatelessUIElement{render(){return(0,r.jsx)("div",Object.assign({className:"ui relaxed list",role:"menu"},{children:this.props.actions.map((({text:e,title:t,callback:n},i)=>(0,r.jsxs)("div",Object.assign({className:"item wizard-action","aria-label":t,title:t,onClick:n,role:"menuitem"},{children:[(0,r.jsx)("span",Object.assign({className:"left floated"},{children:(0,r.jsx)("i",{className:"medium arrow right icon"})})),(0,r.jsx)(o.Link,{children:e})]}),i)))}))}}function b(e){return 401==e.statusCode?(s.errorNotification(lf("GitHub didn't accept token")),!0):404==e.statusCode&&(s.errorNotification(lf("Token has neither '{0}' nor '{1}' scope","repo","public_repo")),!0)}n.showPRDialogAsync=function e(t,n){return s.confirmAsync({header:lf("Commit conflict in {0}",t),agreeLbl:lf("Resolve conflict"),disagreeLbl:lf("I'm done!"),body:lf("The latest online version of {0} contains edits conflicting with yours. We have created a pull request (PR) that you can use to resolve the conflicts. Once you're done, sync to get all merged changes. In the meantime we have taken you to the latest online version of {0}.",t)}).then((r=>r?(pxt.tickEvent("app.commit.pr"),window.open(n,"_blank"),e(t,n)):Promise.resolve()))},n.showImportUrlDialogAsync=function(){let e;const t=pxt.appTarget.appTheme.shareUrl||"https://makecode.com/";return s.confirmAsync({header:lf("Open project URL"),hasCloseIcon:!0,onLoaded:t=>{(e=t.querySelector("input")).onkeydown=e=>{if("Enter"===e.key){const e=t.querySelector(".button.approve");null==e||e.click()}}},jsx:(0,r.jsxs)("div",Object.assign({className:"ui form"},{children:[(0,r.jsxs)("div",Object.assign({className:"ui icon violet message"},{children:[(0,r.jsx)("i",{className:"user icon","aria-hidden":!0}),(0,r.jsxs)("div",Object.assign({className:"content"},{children:[(0,r.jsx)("h3",Object.assign({className:"header"},{children:lf("User-provided content")})),(0,r.jsxs)("p",{children:[lf("The content below is provided by a user, and is not endorsed by Microsoft."),(0,r.jsx)("br",{}),lf("If you think it's not appropriate, please report abuse through Settings -> Report Abuse.")]})]}))]})),(0,r.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,r.jsx)("label",Object.assign({id:"selectUrlToOpenLabel"},{children:lf("Copy the URL of the project.")})),(0,r.jsx)("input",{type:"url",tabIndex:0,autoFocus:!0,"aria-labelledby":"selectUrlToOpenLabel",placeholder:lf("{0} or {1}...",t,"https://github.com/..."),className:"ui blue fluid"})]}))]}))}).then((t=>{if(t){pxt.tickEvent("app.open.url");const t=e.value;let n=pxt.github.normalizeRepoId(t);return n||(n=pxt.Cloud.parseScriptId(t)),n?Promise.resolve(n):Promise.reject(new Error(lf("Sorry, the project url looks invalid.")))}return Promise.resolve(void 0)}))},n.showGithubTokenError=b,n.showCreateGithubRepoDialogAsync=function(e){pxt.tickEvent("github.create.dialog"),e&&(e=(e=e.toLocaleLowerCase().replace(/\s+/g,"-")).replace(/[^\w\-]/g,""));let t=e||"",n="",i=!0;function l(){return t=="pxt-"+lf("Untitled").toLocaleLowerCase()||"pxt-untitled"==t?lf("Please pick a different name."):/^[\w\-]{1,64}$/.test(t)?void 0:lf("Repository names must be less than 64 characters and cannot include spaces or special characters.")}function c(e){e=e.trim(),t!=e&&(t=e,a.forceUpdate())}function u(e){n!=e&&(n=e,a.forceUpdate())}function d(e){const t=0==e.currentTarget.selectedIndex;i!=t&&(i=t,a.forceUpdate())}return s.confirmAsync({hasCloseIcon:!0,header:lf("Create GitHub repository"),jsxd:()=>{const e=l();return(0,r.jsxs)("div",Object.assign({className:"ui form"},{children:[(0,r.jsxs)("p",{children:[lf("Host your code on GitHub and work together with friends."),o.helpIconLink("/github",lf("Learn more about GitHub"))]}),(0,r.jsx)("div",Object.assign({className:"ui field"},{children:(0,r.jsx)(o.Input,{type:"url",autoFocus:!0,value:t,onChange:c,label:lf("Repository name"),id:"githubRepoNameInput",placeholder:"pxt-my-gadget...",class:"fluid",error:e})})),(0,r.jsx)("div",Object.assign({className:"ui field"},{children:(0,r.jsx)(o.Input,{type:"text",value:n,onChange:u,label:lf("Repository description"),id:"githubRepoDescriptionInput",placeholder:lf("MakeCode extension for my gadget"),class:"fluid"})})),(0,r.jsx)("div",Object.assign({className:"ui field"},{children:(0,r.jsxs)("select",Object.assign({className:"ui dropdown",onChange:d,"aria-label":lf("Repository visibility setting")},{children:[(0,r.jsx)("option",Object.assign({"aria-selected":i,value:"true"},{children:lf("Public repository, anyone can look at your code.")})),(0,r.jsx)("option",Object.assign({"aria-selected":!i,value:"false"},{children:lf("Private repository, your code is only visible to you.")}))]}))}))]}))}}).then((e=>{if(e){if(!l())return n=n||lf("A MakeCode project"),s.showLoading("creategithub",lf("creating {0} repository...",t)),pxt.github.createRepoAsync(t,n.trim(),!i).finally((()=>s.hideLoading("creategithub"))).then((e=>(pxt.tickEvent("github.create.ok"),pxt.github.normalizeRepoId("https://github.com/"+e.fullName,"master"))),(e=>(b(e)||(422==e.statusCode?s.errorNotification(lf("Repository '{0}' already exists.",t)):s.errorNotification(e.message),pxt.tickEvent("github.create.error",{statusCode:e.statusCode})),"")));s.errorNotification(lf("Invalid repository name.")),pxt.tickEvent("github.create.invalidname")}else pxt.tickEvent("github.create.cancel");return""}))},n.showImportGithubDialogAsync=function(){let e="",t=()=>{e="NEW",s.hideDialog()};return s.showLoading("githublist",lf("searching GitHub repositories...")),l.githubProvider(!0).routedLoginAsync("import").then((e=>e&&e.accessToken&&pxt.github.listUserReposAsync())).finally((()=>s.hideLoading("githublist"))).then((n=>{if(!n)return Promise.resolve(-1);const i=n.map((t=>({name:t.fullName,description:t.description,updatedAt:t.updatedAt,onClick:()=>{e=pxt.github.normalizeRepoId("https://github.com/"+t.fullName,t.defaultBranch),s.hideDialog()}})));return s.confirmAsync({header:lf("Clone or create your own GitHub repo"),hideAgree:!0,hasCloseIcon:!0,jsx:(0,r.jsxs)("div",Object.assign({className:"ui form"},{children:[(0,r.jsxs)("div",Object.assign({className:"ui relaxed divided list"},{children:[(0,r.jsxs)("div",Object.assign({className:"item"},{children:[(0,r.jsx)("i",{className:"large plus circle middle aligned icon"}),(0,r.jsxs)("div",Object.assign({className:"content"},{children:[(0,r.jsx)("a",Object.assign({onClick:t,role:"button",className:"header",tabIndex:0,onKeyDown:d.fireClickOnEnter,title:lf("Create new GitHub repository")},{children:(0,r.jsx)("b",{children:lf("Create new...")})})),(0,r.jsx)("div",Object.assign({className:"description"},{children:lf("Create a new GitHub repo in your account.")}))]}))]}),"create new"),i.map((e=>(0,r.jsxs)("div",Object.assign({className:"item"},{children:[(0,r.jsx)("i",{className:"large github middle aligned icon"}),(0,r.jsxs)("div",Object.assign({className:"content"},{children:[(0,r.jsx)("a",Object.assign({onClick:e.onClick,role:"button",className:"header",tabIndex:0,onKeyDown:d.fireClickOnEnter},{children:e.name})),(0,r.jsxs)("div",Object.assign({className:"description"},{children:[pxt.Util.timeSince(e.updatedAt),". ",e.description]}))]}))]}),e.name)))]})),(0,r.jsxs)("div",Object.assign({className:"ui icon green message"},{children:[(0,r.jsx)("i",{className:"info circle icon"}),(0,r.jsxs)("div",Object.assign({className:"content"},{children:[(0,r.jsx)("h3",Object.assign({className:"header"},{children:lf("Not finding what you're looking for?")})),(0,r.jsx)("p",{children:lf("Use the 'Import URL' option in the previous dialog to import repo by exact URL.")})]}))]}))]}))})})).then((()=>e))},n.showImportFileDialogAsync=function(e){let t,n=[pxt.appTarget.compile.saveAsPNG?".png":".mkcd"];return pxt.appTarget.compile.hasHex&&n.push(".hex"),pxt.appTarget.compile.useUF2&&n.push(".uf2"),s.confirmAsync({header:lf("Open {0} file",n.join(lf(" or "))),hasCloseIcon:!0,onLoaded:e=>{t=e.querySelectorAll("input")[0]},jsx:(0,r.jsxs)("div",Object.assign({className:"ui form"},{children:[(0,r.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,r.jsx)("label",Object.assign({id:"selectFileToOpenLabel"},{children:lf("Select a {0} file to open.",n.join(lf(" or ")))})),(0,r.jsx)("input",{type:"file",tabIndex:0,autoFocus:!0,"aria-labelledby":"selectFileToOpenLabel",className:"ui blue fluid"})]})),(0,r.jsx)("div",Object.assign({className:"ui secondary segment"},{children:lf("You can import files by dragging and dropping them anywhere in the editor!")}))]}))}).then((e=>{if(e)return t.files[0]}))},n.showReportAbuseAsync=function(e){if(pxt.github.parseRepoId(e))return pxt.tickEvent("reportabuse.github"),void s.confirmAsync({header:lf("Is this content inappropriate?"),hasCloseIcon:!0,agreeLbl:lf("Report"),disagreeLbl:lf("Cancel"),jsx:(0,r.jsxs)("div",Object.assign({className:"ui form"},{children:[(0,r.jsx)("div",Object.assign({className:"ui field"},{children:(0,r.jsx)("p",{children:lf("This content was written by an independent user and may be inappropriate or abusive. Help us block or filter that content by reporting it to Github.")})})),(0,r.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,r.jsx)("label",Object.assign({id:"githubContentUrlLabel"},{children:lf("Content URL")})),(0,r.jsx)(o.Input,{type:"url","aria-labelledby":"githubContentUrlLabel",readOnly:!0,lines:1,copy:!0,autoFocus:!pxt.BrowserUtils.isMobile(),selectOnClick:!0,value:e})]}))]}))}).then((e=>{e&&window.open("https://github.com/contact/report-content","_blank")}));let t,n;const i=pxt.appTarget.appTheme.shareUrl||"https://makecode.com/";s.confirmAsync({header:lf("Report Abuse"),hasCloseIcon:!0,onLoaded:r=>{t=r.querySelectorAll("input")[0],n=r.querySelectorAll("textarea")[0],e&&(t.value=i+e)},agreeLbl:lf("Submit"),jsx:(0,r.jsxs)("div",Object.assign({className:"ui form"},{children:[(0,r.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,r.jsx)("label",Object.assign({id:"abuseUrlLabel"},{children:lf("What is the URL of the offensive project?")})),(0,r.jsx)("input",{type:"url","aria-labelledby":"abuseUrlLabel",tabIndex:0,autoFocus:!0,placeholder:"Enter project URL here..."})]})),(0,r.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,r.jsx)("label",Object.assign({id:"abuseDescriptionLabel"},{children:lf("Why do you find it offensive?")})),(0,r.jsx)("textarea",{"aria-labelledby":"abuseDescriptionLabel"})]}))]}))}).then((e=>{if(e){pxt.tickEvent("app.reportabuse.send");const e=pxt.Cloud.parseScriptId(t.value);e?(s.infoNotification(lf("Sending abuse report...")),c.privatePostAsync(`${e}/abusereports`,{text:n.value}).then((e=>{s.infoNotification(lf("Report sent. Thank you!"))})).catch((e=>{404==e.statusCode?s.warningNotification(lf("Oops, we could not find this script.")):s.handleNetworkError(e)}))):s.errorNotification(lf("Sorry, the project url looks invalid."))}}))},n.showResetDialogAsync=function(){return s.confirmAsync({header:lf("Reset"),body:lf("You are about to clear all projects. Are you sure? This operation cannot be undone."),agreeLbl:lf("Reset"),agreeClass:"red",agreeIcon:"sign out",disagreeLbl:lf("Cancel")})},n.promptTranslateBlock=function(e,t){s.confirmAsync({header:lf("Translate this block"),hideAgree:!0,hasCloseIcon:!0,helpUrl:"/translate",jsx:(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{children:[lf("Update the block translation below."),lf("Do not translate variable names (%name, $name)."),lf("Once validated in Crowdin, translations may take 24h to be active.")]}),t.map((e=>(0,r.jsx)("div",Object.assign({className:"ui basic segment"},{children:e}),`ictr${e}`)))]})})},n.renderBrowserDownloadInstructions=function(e){var t,n,i,a;const l=pxt.appTarget.appTheme.boardName||lf("device"),c=pxt.appTarget.appTheme.driveDisplayName||pxt.appTarget.compile.driveName||"???",u=(null===(t=pxt.appTarget.compile)||void 0===t?void 0:t.useUF2)?".uf2":".hex",d=pxt.usb.isEnabled&&(null===(i=null===(n=pxt.appTarget)||void 0===n?void 0:n.compile)||void 0===i?void 0:i.webUSB),f=null===(a=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===a?void 0:a.dragFileImage,g=f?"two":"one";return(0,r.jsx)("div",Object.assign({className:"ui grid stackable upload"},{children:(0,r.jsxs)("div",Object.assign({className:"column sixteen wide instructions"},{children:[(0,r.jsx)("div",Object.assign({className:"ui grid"},{children:(0,r.jsx)("div",Object.assign({className:"row"},{children:(0,r.jsx)("div",Object.assign({className:"column"},{children:(0,r.jsxs)("div",Object.assign({className:`ui ${g} column grid padded`},{children:[(0,r.jsx)("div",Object.assign({className:"column"},{children:(0,r.jsx)("div",Object.assign({className:"ui"},{children:(0,r.jsxs)("div",Object.assign({className:"content"},{children:[(0,r.jsx)("div",Object.assign({className:"description"},{children:lf("Your code is being downloaded as a {1} file. You can drag this file to your {0} using your computer's file explorer.",l,u)})),d&&(0,r.jsxs)("div",Object.assign({className:"download-callout"},{children:[(0,r.jsx)("label",Object.assign({className:"ui purple ribbon label"},{children:lf("Want faster downloads?")})),(0,r.jsxs)("div",Object.assign({className:"ui two column grid content"},{children:[(0,r.jsxs)("div",Object.assign({className:"icon-align three wide column"},{children:[(0,r.jsx)("div",{}),(0,r.jsx)("i",{className:"icon big usb"}),(0,r.jsx)("div",{})]})),(0,r.jsxs)("div",Object.assign({className:"thirteen wide column"},{children:[lf("Download your code faster by pairing with web usb!"),(0,r.jsx)("a",Object.assign({className:"ui button purple",onClick:()=>{s.hideDialog(),(0,p.pairAsync)()}},{children:lf("Pair now")}))]}))]}))]}))]}))}))})),f&&(0,r.jsx)("div",Object.assign({className:"column"},{children:(0,r.jsx)("div",Object.assign({className:"ui"},{children:(0,r.jsx)("div",Object.assign({className:"image"},{children:(0,r.jsx)("img",{alt:lf("Comic moving {1} file to {0}",c,u),className:"ui medium rounded image",src:f})}))}))}))]}))}))}))})),(0,r.jsx)("div",{children:!e&&(0,r.jsx)(o.Checkbox,{inputLabel:lf("Don't show this again"),onChange:e=>{const t=""+e;pxt.tickEvent("downloaddialog.dontshowagain",{checked:t}),h=e}})})]}))}))},n.renderIncompatibleHardwareDialog=function(){var e,t;const n=pxt.appTarget.appTheme.boardName||lf("device"),i=lf("Oops! Looks like your project has code that won't run on the hardware you have connected. Would you like to download anyway?"),o=lf("Learn more about what's supported by your hardware"),s=null===(e=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===e?void 0:e.incompatibleHardwareHelpURL,a=null===(t=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===t?void 0:t.incompatibleHardwareImage,l=a?"two":"one";return(0,r.jsxs)("div",Object.assign({className:`ui ${l} column grid padded download-dialog`},{children:[(0,r.jsx)("div",Object.assign({className:"column"},{children:(0,r.jsx)("div",Object.assign({className:"ui"},{children:(0,r.jsx)("div",Object.assign({className:"content"},{children:(0,r.jsxs)("div",Object.assign({className:"description"},{children:[i,(0,r.jsx)("br",{}),s&&(0,r.jsx)("a",Object.assign({target:"_blank",rel:"noopener noreferrer",href:s},{children:o}))]}))}))}))})),a&&(0,r.jsx)("div",Object.assign({className:"column"},{children:(0,r.jsx)("div",Object.assign({className:"ui"},{children:(0,r.jsx)("div",Object.assign({className:"image download-dialog-image"},{children:(0,r.jsx)("img",{alt:lf("Image of {0}",n),className:"ui medium rounded image",src:a})}))}))}))]}))},n.clearDontShowDownloadDialogFlag=function(){h=!1},n.isDontShowDownloadDialogFlagSet=function(){return h}},{"./cloudsync":55,"./cmds":56,"./core":133,"./coretsx":134,"./sui":200,"./util":206,react:366,"react/jsx-runtime":367}],144:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.setupDragAndDrop=void 0,n.setupDragAndDrop=function(e,t,n,r){e.addEventListener("paste",(function(e){if(e.clipboardData){let r=pxt.Util.toArray(e.clipboardData.files).filter(t);if(r.length>0)e.stopPropagation(),e.preventDefault(),n(r);else if(e.clipboardData.items&&e.clipboardData.items.length>0){let t=e.clipboardData.items[0].getAsFile();t&&(e.stopPropagation(),e.preventDefault(),n([t]))}}})),e.addEventListener("dragover",(function(e){let t=e.dataTransfer.types,n=!1;for(let e=0;e<t.length;++e)"Files"!=t[e]&&"text/uri-list"!=t[e]||(n=!0);return!n||(e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="copy",!1)}),!1),e.addEventListener("drop",(function(e){let t=pxt.Util.toArray(e.dataTransfer.files);if(t.length>0)e.stopPropagation(),e.preventDefault(),n(t);else if(e.dataTransfer.types.indexOf("text/uri-list")>-1){const t=e.dataTransfer.getData("text/uri-list");t&&(e.stopPropagation(),e.preventDefault(),r(t))}return!1}),!1),e.addEventListener("dragend",(function(e){return!1}),!1)}},{}],145:[function(e,t,n){"use strict";var r=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.SmallEditorToolbar=n.ZoomSlider=n.EditorToolbar=void 0;const i=e("react/jsx-runtime"),o=e("react"),s=e("./data"),a=e("./sui"),l=e("./githubbutton"),c=e("./cmds"),u=e("./identity"),d=e("./webusb");var p,h;(h=p||(p={}))[h.Computer=0]="Computer",h[h.Tablet=1]="Tablet",h[h.Mobile=2]="Mobile";class f extends s.Component{constructor(e){super(e),this.onHwItemClick=()=>{pxt.hasHwVariants()?this.props.parent.showChooseHwDialog(!0):this.props.parent.showBoardDialogAsync(void 0,!0)},this.onDownloadButtonClick=async()=>{var e,t,n;pxt.tickEvent("editortools.downloadbutton",{collapsed:this.getCollapsedState()},{interactiveConsent:!0}),(null===(e=pxt.appTarget.appTheme)||void 0===e?void 0:e.preferWebUSBDownload)&&(null===(n=null===(t=pxt.appTarget)||void 0===t?void 0:t.compile)||void 0===n?void 0:n.webUSB)&&pxt.usb.isEnabled&&!(0,d.userPrefersDownloadFlagSet)()&&!pxt.packetio.isConnected()&&!pxt.packetio.isConnecting()&&await c.pairAsync(!0),this.compile()},this.onHwDownloadClick=()=>{pxt.tickEvent("editortools.download",{collapsed:this.getCollapsedState()},{interactiveConsent:!0}),pxt.tickEvent("editortools.downloadasfile",{collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.compile(!0)},this.onPairClick=()=>{pxt.tickEvent("editortools.pair",void 0,{interactiveConsent:!0}),this.props.parent.pairAsync()},this.onDisconnectClick=()=>{c.showDisconnectAsync()},this.onHelpClick=()=>{var e;pxt.tickEvent("editortools.downloadhelp"),window.open(null===(e=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===e?void 0:e.downloadMenuHelpURL)},this.saveProjectName=this.saveProjectName.bind(this),this.compile=this.compile.bind(this),this.saveFile=this.saveFile.bind(this),this.undo=this.undo.bind(this),this.redo=this.redo.bind(this),this.zoomIn=this.zoomIn.bind(this),this.zoomOut=this.zoomOut.bind(this),this.startStopSimulator=this.startStopSimulator.bind(this),this.toggleDebugging=this.toggleDebugging.bind(this),this.toggleCollapsed=this.toggleCollapsed.bind(this),this.cloudButtonClick=this.cloudButtonClick.bind(this)}saveProjectName(e,t){pxt.tickEvent("editortools.projectrename",{view:t},{interactiveConsent:!0}),this.props.parent.updateHeaderName(e)}compile(e){this.setState({compileState:"compiling"}),pxt.tickEvent("editortools.download",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.compile()}saveFile(e){pxt.tickEvent("editortools.save",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.saveAndCompile()}undo(e){pxt.tickEvent("editortools.undo",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.undo()}redo(e){pxt.tickEvent("editortools.redo",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.redo()}zoomIn(e){pxt.tickEvent("editortools.zoomIn",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.zoomIn(),this.props.parent.forceUpdate()}zoomOut(e){pxt.tickEvent("editortools.zoomOut",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.zoomOut(),this.props.parent.forceUpdate()}startStopSimulator(e){pxt.tickEvent("editortools.startStopSimulator",{view:e,collapsed:this.getCollapsedState(),headless:this.getHeadlessState()},{interactiveConsent:!0}),this.props.parent.startStopSimulator({clickTrigger:!0})}toggleDebugging(e){pxt.tickEvent("editortools.debug",{view:e,collapsed:this.getCollapsedState(),headless:this.getHeadlessState()},{interactiveConsent:!0}),this.props.parent.toggleDebugging()}toggleCollapsed(){pxt.tickEvent("editortools.portraitToggleCollapse",{collapsed:this.getCollapsedState(),headless:this.getHeadlessState()},{interactiveConsent:!0}),this.props.parent.toggleSimulatorCollapse()}cloudButtonClick(e){pxt.tickEvent("editortools.cloud",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0})}componentDidUpdate(){var e,t;this.props.parent.state.compiling?(null===(e=this.state)||void 0===e?void 0:e.compileState)||this.setState({compileState:"compiling"}):"compiling"===(null===(t=this.state)||void 0===t?void 0:t.compileState)&&(this.props.parent.state.cancelledDownload?this.setState({compileState:null}):(this.setState({compileState:"success"}),this.compileTimeout&&clearTimeout(this.compileTimeout),this.compileTimeout=setTimeout((()=>{var e;"success"===(null===(e=this.state)||void 0===e?void 0:e.compileState)&&this.setState({compileState:null})}),2e3)))}componentWillUnmount(){this.compileTimeout&&clearTimeout(this.compileTimeout)}getCollapsedState(){return""+this.props.parent.state.collapseEditorTools}getHeadlessState(){return pxt.appTarget.simulator.headless?"true":"false"}getSaveInput(e,t,n,r){let o="";this.props.parent.state.isSaving?o="loading disabled":this.props.parent.state.compiling&&(o="disabled");let s=[];return s.push((0,i.jsx)("label",Object.assign({htmlFor:t,className:"accessible-hidden phone hide"},{children:lf("Type a name for your project")}),"label")),s.push((0,i.jsx)(v,{id:t,view:this.getViewString(0),type:"text","aria-labelledby":t,placeholder:lf("Pick a name..."),value:n||"",onChangeValue:this.saveProjectName,disabled:r,readOnly:r},"input")),e&&s.push((0,i.jsx)(m,{icon:"save",className:`right attached editortools-btn save-editortools-btn ${o}`,title:lf("Save"),ariaLabel:lf("Save the project"),onButtonClick:this.saveFile,view:this.getViewString(0)},"save0")),s}getZoomControl(e){return[(0,i.jsx)(m,{icon:"minus circle",className:"editortools-btn zoomout-editortools-btn",title:lf("Zoom Out"),onButtonClick:this.zoomOut,view:this.getViewString(e)},"minus"),(0,i.jsx)(m,{icon:"plus circle",className:"editortools-btn zoomin-editortools-btn",title:lf("Zoom In"),onButtonClick:this.zoomIn,view:this.getViewString(e)},"plus")]}getUndoRedo(e){const t=this.props.parent.editor.hasUndo(),n=this.props.parent.editor.hasRedo();return[(0,i.jsx)(m,{icon:"xicon undo",className:"editortools-btn undo-editortools-btn "+(t?"":"disabled"),title:lf("Undo"),ariaLabel:lf("{0}, {1}",lf("Undo"),t?"":lf("Disabled")),onButtonClick:this.undo,view:this.getViewString(e)},"undo"),(0,i.jsx)(m,{icon:"xicon redo",className:"editortools-btn redo-editortools-btn "+(n?"":"disabled"),title:lf("Redo"),ariaLabel:lf("{0}, {1}",lf("Redo"),n?"":lf("Disabled")),onButtonClick:this.redo,view:this.getViewString(e)},"redo")]}getViewString(e){return e.toString().toLowerCase()}getCompileButton(e){var t,n,r,o,s;const l=pxt.appTarget.appTheme,{compiling:c,isSaving:u}=this.props.parent.state,{compileState:d}=this.state,p=lf("Download your code to the {0}",l.boardName);let h;h="success"===d?l.useUploadMessage?lf("Uploaded!"):lf("Downloaded!"):l.useUploadMessage?lf("Upload"):lf("Download");const f=pxt.appTarget.simulator&&!!pxt.appTarget.simulator.dynamicBoardDefinition,g=pxt.usb.isEnabled&&(null===(n=null===(t=pxt.appTarget)||void 0===t?void 0:t.compile)||void 0===n?void 0:n.webUSB),v=!!this.getData("packetio:connected"),y=!!this.getData("packetio:connecting"),b=this.getData("packetio:icon"),x=v&&(null===(r=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===r?void 0:r.deviceSuccessIcon)||"xicon file-download-check",E=!!y&&"ping "+b||"success"===d&&x||!!v&&b||l.downloadIcon||"xicon file-download";let _="left attached ",w="",S=!1;switch(u?_+="disabled ":c&&(_+="loading disabled "),v?_+="connected ":y&&(_+="connecting "),e){case 2:_+="download-button-full ",S=!0;break;case 1:_+="download-button-full  ",w="",S=!0;break;case 0:default:_+="large fluid ",w="large"}let T=[];T.push((0,i.jsx)(m,{icon:E,className:`primary download-button ${_}`,text:2!=e?h:void 0,title:p,onButtonClick:this.onDownloadButtonClick,view:"computer"},"downloadbutton"));const k=pxt.hwName||pxt.appTarget.appTheme.boardNickname||lf("device"),C=pxt.hwName||v&&lf("Connected to {0}",k)||y&&lf("Connecting...")||(f?lf("Click to select hardware"):g?lf("Click for one-click downloads."):void 0),A=2==e?lf("Hardware"):lf("Choose hardware"),j=2==e?pxt.hwName||lf("Download"):lf("Download as file"),I=null===(o=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===o?void 0:o.downloadMenuHelpURL,O=(null===(s=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===s?void 0:s.deviceIcon)||"usb";return T.push((0,i.jsxs)(a.DropdownMenu,Object.assign({role:"menuitem",icon:`ellipsis horizontal ${w}`,title:lf("Download options"),className:`${w} right attached editortools-btn hw-button button`,dataTooltip:C,displayAbove:!0,displayRight:S},{children:[g&&!v&&(0,i.jsx)(a.Item,{role:"menuitem",icon:O,text:lf("Connect device"),tabIndex:-1,onClick:this.onPairClick}),g&&(y||v)&&(0,i.jsx)(a.Item,{role:"menuitem",icon:O,text:lf("Disconnect"),tabIndex:-1,onClick:this.onDisconnectClick}),f&&(0,i.jsx)(a.Item,{role:"menuitem",icon:"microchip",text:A,tabIndex:-1,onClick:this.onHwItemClick}),(0,i.jsx)(a.Item,{role:"menuitem",icon:"xicon file-download",text:j,tabIndex:-1,onClick:this.onHwDownloadClick}),I&&(0,i.jsx)(a.Item,{role:"menuitem",icon:"help circle",text:lf("Help"),tabIndex:-1,onClick:this.onHelpClick})]}),"downloadmenu")),T}renderCore(){var e;const{tutorialOptions:t,projectName:n,compiling:r,isSaving:o,simState:s,debugging:a,editorState:c}=this.props.parent.state,d=null!==(e=this.getData(`header:${this.props.parent.state.header.id}`))&&void 0!==e?e:this.props.parent.state.header,p=pxt.appTarget.appTheme,h=pxt.shell.isControllerMode(),f=pxt.shell.isReadOnly(),g=!!t&&t.tutorial,v=pxt.appTarget.simulator.headless,y=c&&!1===c.hasCategories,b=p.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac()),x=pxt.appTarget.appTheme.disableFileAccessinAndroid&&pxt.BrowserUtils.isAndroid(),E=!(!d||!pxt.github.parseRepoId(d.githubId)),_=!(f||h||p.saveInMenu||g||a||b||x||E),w=!(g||f||h||p.hideProjectRename||a),S=pxt.appTarget.compile,T=S.hasHex||S.saveAsPNG||S.useUF2,k=lf("Download your code to the {0}",p.boardName),C=!!r,A=s==pxt.editor.SimState.Running,j=s==pxt.editor.SimState.Starting,I=!f&&!a&&!y,O=!y,N=!!pxt.appTarget.cloud&&!!pxt.appTarget.cloud.githubPackages&&p.githubEditor&&!pxt.BrowserUtils.isPxtElectron()&&!f&&!h&&!a&&!g,R=pxt.appTarget.appTheme.downloadIcon||"download",P=(()=>{switch(s){case pxt.editor.SimState.Stopped:return lf("Start");case pxt.editor.SimState.Pending:case pxt.editor.SimState.Starting:return lf("Starting");default:return lf("Stop")}})();let D="",M="";return o?(D="disabled",M="loading disabled"):C&&(D="loading disabled",M="disabled"),(0,i.jsxs)("div",Object.assign({id:"editortools",className:"ui",role:"region","aria-label":lf("Editor toolbar")},{children:[(0,i.jsxs)("div",Object.assign({id:"downloadArea",role:"menu",className:"ui column items"},{children:[v&&(0,i.jsx)("div",Object.assign({className:"ui item"},{children:(0,i.jsx)("div",Object.assign({className:"ui icon large buttons"},{children:T&&(0,i.jsx)(m,{icon:R,className:`primary large download-button mobile tablet hide ${D}`,title:k,onButtonClick:this.compile,view:"computer"})}))})),!v&&(0,i.jsx)("div",Object.assign({className:"ui item portrait hide"},{children:T&&this.getCompileButton(0)})),!v&&(0,i.jsx)("div",Object.assign({className:"ui portrait only"},{children:T&&this.getCompileButton(2)}))]})),(w||N||u.CloudSaveStatus.wouldRender(d.id))&&(0,i.jsx)("div",Object.assign({id:"projectNameArea",role:"menu",className:"ui column items"},{children:(0,i.jsxs)("div",Object.assign({className:`ui right ${_?"labeled":""} input projectname-input projectname-computer`},{children:[w&&this.getSaveInput(_,"fileNameInput2",n,!1),N&&(0,i.jsx)(l.GithubButton,{parent:this.props.parent},"githubbtn0"),(0,i.jsx)(u.CloudSaveStatus,{headerId:d.id})]}))})),(0,i.jsxs)("div",Object.assign({id:"editorToolbarArea",role:"menu",className:"ui column items"},{children:[I&&(0,i.jsx)("div",Object.assign({className:"ui icon buttons"},{children:this.getUndoRedo(0)})),O&&(0,i.jsx)("div",Object.assign({className:"ui icon buttons mobile hide"},{children:this.getZoomControl(0)})),p.bigRunButton&&(0,i.jsx)("div",Object.assign({className:"big-play-button-wrapper"},{children:(0,i.jsx)(m,{className:"big-play-button play-button "+(A?"stop":"play"),disabled:j,icon:A?"stop":"play",title:P,onButtonClick:this.startStopSimulator,view:"computer"},"runmenubtn")}))]}))]}))}}n.EditorToolbar=f;class g extends s.Component{constructor(e){super(e),this.zoomMin=this.props.zoomMin?this.props.zoomMin:0,this.zoomMax=this.props.zoomMax?this.props.zoomMax:5,this.state={zoomValue:Math.floor((this.zoomMax+1-this.zoomMin)/2)+this.zoomMin},this.handleWheelZoom=this.handleWheelZoom.bind(this),this.zoomUpdate=this.zoomUpdate.bind(this),this.zoomOut=this.zoomOut.bind(this),this.zoomIn=this.zoomIn.bind(this)}componentDidMount(){window.addEventListener("wheel",this.handleWheelZoom)}componentWillUnmount(){window.removeEventListener("wheel",this.handleWheelZoom)}handleWheelZoom(e){e.ctrlKey&&(e.deltaY<0?this.increaseZoomState():this.decreaseZoomState())}decreaseZoomState(){this.state.zoomValue>this.zoomMin&&this.setState({zoomValue:this.state.zoomValue-1})}increaseZoomState(){this.state.zoomValue<this.zoomMax&&this.setState({zoomValue:this.state.zoomValue+1})}zoomOut(){this.state.zoomValue>this.zoomMin&&(this.decreaseZoomState(),this.props.parent.editor.zoomOut(),this.props.parent.forceUpdate())}zoomIn(){this.state.zoomValue<this.zoomMax&&(this.increaseZoomState(),this.props.parent.editor.zoomIn(),this.props.parent.forceUpdate())}zoomUpdate(e){const t=parseInt(e.target.value);if(this.state.zoomValue<t)for(let e=0;e<t-this.state.zoomValue;e++)this.props.parent.editor.zoomIn();else if(t<this.state.zoomValue)for(let e=0;e<this.state.zoomValue-t;e++)this.props.parent.editor.zoomOut();this.setState({zoomValue:t}),this.props.parent.forceUpdate()}renderCore(){return(0,i.jsxs)("div",Object.assign({className:"zoom"},{children:[(0,i.jsx)(m,{icon:"minus circle",className:"editortools-btn zoomout-editortools-btn borderless",title:lf("Zoom Out"),onButtonClick:this.zoomOut,view:this.props.view},"minus"),(0,i.jsx)("div",Object.assign({id:"zoomSlider"},{children:(0,i.jsx)("input",{className:"zoomSliderBar",type:"range",min:this.zoomMin,max:this.zoomMax,step:"1",value:this.state.zoomValue.toString(),onChange:this.zoomUpdate,"aria-valuemax":this.zoomMax,"aria-valuemin":this.zoomMin,"aria-valuenow":this.state.zoomValue})})),(0,i.jsx)(m,{icon:"plus circle",className:"editortools-btn zoomin-editortools-btn borderless",title:lf("Zoom In"),onButtonClick:this.zoomIn,view:this.props.view},"plus")]}))}}n.ZoomSlider=g;n.SmallEditorToolbar=class extends f{constructor(e){super(e)}renderCore(){return(0,i.jsxs)("div",Object.assign({id:"headerToolbar",className:"smallEditorToolbar"},{children:[(0,i.jsx)(g,{parent:this.props.parent,view:super.getViewString(0),zoomMin:0,zoomMax:5}),(0,i.jsx)("div",Object.assign({className:"ui icon undo-redo-buttons"},{children:super.getUndoRedo(0)}))]}))}};class m extends a.StatelessUIElement{constructor(e){super(e),this.state={},this.handleClick=this.handleClick.bind(this)}handleClick(){const{onButtonClick:e,view:t}=this.props;e(t)}renderCore(){const e=this.props,{onClick:t,onButtonClick:n,role:o}=e,s=r(e,["onClick","onButtonClick","role"]);return(0,i.jsx)(a.Button,Object.assign({role:o||"menuitem"},s,{onClick:this.handleClick}))}}class v extends o.Component{constructor(e){super(e),this.onChange=e=>{this.setState({editValue:e.target.value});const{onChangeValue:t,view:n}=this.props;t(e.target.value,n)},this.onBlur=e=>{if(!this.state.editValue)return;const{onChangeValue:t,view:n}=this.props;t(e.target.value,n),this.setState({editValue:void 0})},this.onKeyDown=e=>{"Enter"!==e.key||e.metaKey||e.shiftKey||(e.target.blur(),e.stopPropagation())},this.state={editValue:void 0}}render(){const e=this.props,{onChange:t,onChangeValue:n,view:o}=e,s=r(e,["onChange","onChangeValue","view"]),{editValue:a}=this.state;return(0,i.jsx)("input",Object.assign({onChange:this.onChange,onBlur:this.onBlur,onKeyDown:this.onKeyDown,className:"mobile hide ui",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1},s,{value:void 0!==a?a:this.props.value}))}}},{"./cmds":56,"./data":136,"./githubbutton":153,"./identity":161,"./sui":200,"./webusb":207,react:366,"react/jsx-runtime":367}],146:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.openDevTools=n.driveDeployAsync=n.initElectron=void 0;const r=e("./cmds"),i=e("./core"),o=window.pxtElectron;n.initElectron=function(e){if(!pxt.BrowserUtils.isPxtElectron())return;o.onTelemetry((e=>{pxt.tickEvent(e.event,e.data)})),o.onUpdateInstalled((()=>{i.infoNotification(lf("An update will take effect after the app restarts"))})),o.onDriveDeployResult((e=>{if(s)if(e)pxt.tickEvent("electron.drivedeploy.success"),s.resolve();else{pxt.tickEvent("electron.drivedeploy.failure");const e=new Error("electron drive deploy failed");s.reject(e)}else pxt.tickEvent("electron.drivedeploy.unknowndeployoperation")}));const t=new Promise((e=>{o.onCriticalUpdateFailed((()=>{pxt.tickEvent("electron.criticalupdate.failed"),e()}))}));o.onUpdateStatus((n=>{switch(pxt.debug(`Electron app update status: ${n}`),pxt.tickEvent(`electron.updatestatus.${n}`),"updating-critical"!==n&&"banned-without-update"!==n||e.stopSimulator(),n){case"update-available":case"ok":return;case"updating-critical":i.confirmAsync({header:lf("Critical update required"),body:lf("A critical update is installing. Please do not quit the app. It will automatically restart when the update has completed."),hideAgree:!0,disagreeLbl:lf("Ok"),disagreeClass:"green",size:"large"}).then((()=>{i.showLoading("pxt-electron-update",lf("Installing update..."))})),t.then((()=>{i.hideLoading("pxt-electron-update"),i.hideDialog(),i.confirmAsync({header:lf("Critical update failed"),body:lf("There was an error installing the critical update. Please ensure you are connected to the Internet and try again later."),hideAgree:!0,disagreeLbl:lf("Quit"),disagreeClass:"red",size:"large"}).then((e=>{o.sendQuit()}))}));break;case"banned-without-update":i.confirmAsync({header:lf("Critical update required"),body:lf("We have disabled this app for security reasons. Please ensure you are connected to the Internet and try again later. An update will be automatically installed as soon as it is available."),hideAgree:!0,disagreeLbl:lf("Quit"),disagreeClass:"red",size:"large"}).then((e=>{o.sendQuit()}));default:return}})),o.sendUpdateStatusCheck()};let s=null;n.driveDeployAsync=function(e){return pxt.BrowserUtils.isPxtElectron()?(s||(s=pxt.Util.defer(),o.sendDriveDeploy(e)),s.promise.catch((t=>(pxt.tickEvent("electron.drivedeploy.browserdownloadinstead"),r.browserDownloadDeployCoreAsync(e)))).finally((()=>{s=null}))):r.browserDownloadDeployCoreAsync(e)},n.openDevTools=function(){o&&o.sendOpenDevTools()}},{"./cmds":56,"./core":133}],147:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ErrorList=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("./sui"),s=e("./util");class a extends i.Component{constructor(e){super(e),this.state={isCollapsed:!0,errors:[],exception:null,blockErrors:[]},this.onCollapseClick=this.onCollapseClick.bind(this),this.onErrorsChanged=this.onErrorsChanged.bind(this),this.onBlockErrorsChanged=this.onBlockErrorsChanged.bind(this),this.onExceptionDetected=this.onExceptionDetected.bind(this),this.onErrorMessageClick=this.onErrorMessageClick.bind(this),this.onDisplayStateChange=this.onDisplayStateChange.bind(this),this.getCompilerErrors=this.getCompilerErrors.bind(this),this.generateStackTraces=this.generateStackTraces.bind(this),this.listBlockErrors=this.listBlockErrors.bind(this),e.isInBlocksEditor?e.listenToBlockErrorChanges("errorList",this.onBlockErrorsChanged):(e.listenToErrorChanges("errorList",this.onErrorsChanged),e.listenToExceptionChanges("errorList",this.onExceptionDetected))}render(){const{isCollapsed:e,errors:t,exception:n,blockErrors:i}=this.state,a=!!(null==t?void 0:t.length)||!!n||!!(null==i?void 0:i.length),l=(lf("Collapse Error List"),e?void 0:this.props.isInBlocksEditor?this.listBlockErrors(i):n?this.generateStackTraces(n):this.getCompilerErrors(t)),c=this.props.isInBlocksEditor?i.length:n?1:t.length;return(0,r.jsxs)("div",Object.assign({className:`errorList ${e?"errorListSummary":""} ${this.props.isInBlocksEditor?"errorListBlocks":""}`,hidden:!a},{children:[(0,r.jsxs)("div",Object.assign({className:"errorListHeader",role:"button","aria-label":lf("{0} error list",e?lf("Expand"):lf("Collapse")),onClick:this.onCollapseClick,onKeyDown:s.fireClickOnEnter,tabIndex:0},{children:[(0,r.jsx)("h4",{children:lf("Problems")}),(0,r.jsx)("div",Object.assign({className:"ui red circular label countBubble"},{children:c})),(0,r.jsx)("div",Object.assign({className:"toggleButton"},{children:(0,r.jsx)(o.Icon,{icon:"chevron "+(e?"up":"down")})}))]})),!e&&(0,r.jsxs)("div",Object.assign({className:"errorListInner"},{children:[n&&(0,r.jsxs)("div",Object.assign({className:"debuggerSuggestion",role:"button",onClick:this.props.startDebugger,onKeyDown:s.fireClickOnEnter,tabIndex:0},{children:[lf("Debug this project"),(0,r.jsx)(o.Icon,{className:"debug-icon",icon:"icon bug"})]})),l]}))]}))}onDisplayStateChange(){const{errors:e,exception:t,isCollapsed:n}=this.state,r=!((null==e?void 0:e.length)||t);this.props.onSizeChange&&this.props.onSizeChange(r?void 0:n?pxt.editor.ErrorListState.HeaderOnly:pxt.editor.ErrorListState.Expanded)}onCollapseClick(){pxt.tickEvent("errorlist.collapse",null,{interactiveConsent:!0}),this.setState({isCollapsed:!this.state.isCollapsed},this.onDisplayStateChange)}onErrorMessageClick(e,t){pxt.tickEvent("errorlist.goto",{errorIndex:t},{interactiveConsent:!0}),this.props.goToError(e)}onErrorsChanged(e){this.setState({errors:e,isCollapsed:0==(null==e?void 0:e.length)||this.state.isCollapsed,exception:null},this.onDisplayStateChange)}onBlockErrorsChanged(e){this.setState({blockErrors:e,isCollapsed:0==(null==e?void 0:e.length)||this.state.isCollapsed,exception:null},this.onDisplayStateChange)}onExceptionDetected(e,t){this.setState({isCollapsed:!1,exception:e,callLocations:t})}getCompilerErrors(e){const t=function(e){const t=new Map;let n=0;for(const r of e){const e=c(r);t.has(e)?t.get(e).count++:t.set(e,{index:n++,count:1,error:r})}const r=[];return t.forEach((e=>r.push(e))),r.sort(((e,t)=>e.index-t.index))}(e);return(0,r.jsx)("div",Object.assign({className:"ui selection list"},{children:t.map(((e,t)=>(0,r.jsx)(l,{index:t,error:e,revealError:this.onErrorMessageClick},function(e){return`${e.messageText}-${e.fileName}-${e.line}-${e.column}`}(e.error))))}))}generateStackTraces(e){return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",Object.assign({className:"exceptionMessage"},{children:pxt.Util.rlf(e.exceptionMessage)})),(0,r.jsx)("div",Object.assign({className:"ui selection list"},{children:(e.stackframes||[]).map(((e,t)=>{const n=this.state.callLocations[e.callLocationId];return n?(0,r.jsx)(l,{index:t,stackframe:e,location:n,revealError:this.onErrorMessageClick},t):null}))}))]})}listBlockErrors(e){return(0,r.jsx)("div",Object.assign({className:"ui selection list"},{children:(e||[]).map(((e,t)=>(0,r.jsx)(l,{index:t,blockError:e},`${t}-${e}`)))}))}}n.ErrorList=a;class l extends i.Component{constructor(e){super(e),this.onErrorListItemClick=this.onErrorListItemClick.bind(this)}render(){const{error:e,stackframe:t,location:n,blockError:i}=this.props,o=i?lf("{0}",i.message):t?function(e,t){return lf("at {0} (line {1})",e.funcInfo.functionName,t.line+1)}(t,n):c(e.error),a=t||i?1:e.count;return(0,r.jsxs)("div",Object.assign({className:"item "+(t?"stackframe":""),role:"button",onClick:i?void 0:this.onErrorListItemClick,onKeyDown:s.fireClickOnEnter,"aria-label":lf("Go to {0}: {1}",t?"":"error",o),tabIndex:0},{children:[o," ",a<=1?null:(0,r.jsx)("div",Object.assign({className:"ui gray circular label countBubble"},{children:a}))]}))}onErrorListItemClick(){const e=this.props.stackframe?this.props.location:this.props.error.error;this.props.revealError(e,this.props.index)}}function c(e){return lf("Line {0}: {1}",e.endLine?e.endLine+1:e.line+1,e.messageText)}},{"./sui":200,"./util":206,react:366,"react/jsx-runtime":367}],148:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.resolveExtensionUrl=n.ExtensionManager=void 0;const r=e("./package");function i(e,t){const n=r.mainEditorPkg();t.resp=n.getAllFiles()}n.ExtensionManager=class{constructor(e){this.host=e,this.nameToExtId={},this.extIdToName={},this.streams={},this.messages={}}clear(){}streamingExtensions(){return Object.keys(this.streams)}messagesExtensions(){return Object.keys(this.messages)}handleExtensionMessage(e){this.handleRequestAsync(e).catch((e=>{}))}sendEvent(e,t){this.host.send(e,function(e){return{target:pxt.appTarget.id,type:"pxtpkgext",event:e}}(t))}getExtId(e){return this.nameToExtId[e]||(this.nameToExtId[e]=ts.pxtc.Util.guidGen(),this.extIdToName[this.nameToExtId[e]]=e),this.nameToExtId[e]}sendResponse(e){this.host.send(this.extIdToName[e.extId],e)}handleRequestAsync(e){var t;const n=function(e,t=!0){return{type:"pxtpkgext",id:e.id,extId:e.extId,success:t}}(e);switch(e.action){case"extinit":n.target=pxt.appTarget,this.sendResponse(n);break;case"extdatastream":return(null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.messages)?this.operation(e.extId,n,((e,t)=>this.handleMessageStreamRequest(e,t))):this.operation(e.extId,n,((e,t)=>this.handleDataStreamRequest(e,t)));case"extusercode":return this.operation(e.extId,n,i);case"extreadcode":(function(e,t){const n=r.mainEditorPkg(),i=ts.pxtc.escapeIdentifier(e),o=n.getAllFiles();t.resp={json:o[i+".json"],code:o[i+".ts"],jres:o[i+".jres"],asm:o[i+".asm"]}})(this.extIdToName[e.extId],n),this.sendResponse(n);break;case"extwritecode":const o=()=>function(e,t,n){var i;const o=r.mainEditorPkg(),s=ts.pxtc.escapeIdentifier(e);function a(e,t){return void 0!==e&&(!o.files[s+t]||o.files[s+t].content!=e)}let l,c=!1;if(a(n.json,".json")&&(c=!0,o.setFile(s+".json",n.json)),a(n.code,".ts")&&(c=!0,o.setFile(s+".ts",n.code)),a(n.jres,".jres")&&(c=!0,o.setFile(s+".jres",n.jres)),a(n.asm,".asm")&&(c=!0,o.setFile(s+".asm",n.asm)),n.dependencies){const e=pxt.Util.jsonTryParse(null===(i=o.files[pxt.CONFIG_NAME])||void 0===i?void 0:i.content);(null==e?void 0:e.dependencies)&&(l=Object.keys(n.dependencies).filter((t=>!e.dependencies[t])),c=c||!!(null==l?void 0:l.length))}return c?o.updateConfigAsync((e=>{void 0!==n.json&&e.files.indexOf(s+".json")<0&&e.files.push(s+".json"),void 0!==n.code&&e.files.indexOf(s+".ts")<0&&e.files.push(s+".ts"),void 0!==n.jres&&e.files.indexOf(s+".jres")<0&&e.files.push(s+".jres"),void 0!==n.asm&&e.files.indexOf(s+".asm")<0&&e.files.push(s+".asm"),null==l||l.forEach((t=>e.dependencies[t]=n.dependencies[t]))})).then((()=>o.saveFilesAsync())):Promise.resolve()}(this.extIdToName[e.extId],0,e.body).then((()=>this.sendResponse(n))),s=function(e){var t;let n;if(null==e?void 0:e.dependencies){const i=r.mainEditorPkg(),o=pxt.Util.jsonTryParse(null===(t=null==i?void 0:i.files[pxt.CONFIG_NAME])||void 0===t?void 0:t.content);(null==o?void 0:o.dependencies)&&(n=Object.keys(e.dependencies).filter((e=>!o.dependencies[e])))}return n}(e.body);(null==s?void 0:s.length)?this.operation(e.extId,n,o):o()}return Promise.resolve()}operation(e,t,n){return Promise.resolve().then((()=>{n(this.extIdToName[e],t),this.sendResponse(t)})).catch((e=>{t.success=!1,t.error=e,this.sendResponse(t)}))}handleDataStreamRequest(e,t){this.streams[e]=!0}handleMessageStreamRequest(e,t){this.messages[e]=!0}},n.resolveExtensionUrl=async function(e){var t;const{config:n,installedVersion:r}=e,{extension:i}=n,o=await pxt.packagesConfigAsync(),s=pxt.github.parseRepoId(r),a=pxt.github.repoStatus(s,o);let l="",c=!1;const u=pxt.BrowserUtils.isLocalHost()&&/debugextensions=1/i.test(window.location.href),d=!u&&pxt.BrowserUtils.isLocalHost()&&/localeditorextensions=1/i.test(window.location.href)&&i.localUrl;return u?(l="http://localhost:3232/extension.html",c=!0):d?(l=i.localUrl,c=!0):i.url&&a===pxt.github.GitRepoStatus.Approved&&(null===(t=null==o?void 0:o.approvedEditorExtensionUrls)||void 0===t?void 0:t.indexOf(i.url))>-1&&(pxt.log(`extension url ${i.url} trusted`),l=i.url,c=!0),pxt.log(`extension ${n.name}: resolved ${l}`),{url:l,name:n.name,trusted:c}}},{"./package":179}],149:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Extensions=void 0;const r=e("react/jsx-runtime"),i=e("./data"),o=e("./core"),s=e("./sui"),a=e("./extensionManager");class l extends i.Component{constructor(e){super(e),this.handleExtensionWrapperRef=e=>{this.extensionWrapper=e},this.state={visible:!1},this.manager=new a.ExtensionManager(this),window.addEventListener("message",this.processMessage.bind(this),!1),this.hide=this.hide.bind(this),this.updateDimensions=this.updateDimensions.bind(this)}unload(){const e=l.getCustomContent();e&&pxsim.U.removeChildren(e),this.manager.clear()}processSerialMessage(e){const t=this.manager.streamingExtensions();if(!(null==t?void 0:t.length))return;const n=e.data||"",r=e.id||"?",i={target:pxt.appTarget.id,type:"pxtpkgext",event:"extconsole",body:{source:r,sim:e.sim,data:n}};t.forEach((e=>this.send(e,i)))}processMessagePacketMessage(e){const t=this.manager.messagesExtensions();if(!(null==t?void 0:t.length))return;const n=e.data,r=e.channel,i=e.source,o={target:pxt.appTarget.id,type:"pxtpkgext",event:"extmessagepacket",body:{source:i,channel:r,data:n}};t.forEach((e=>this.send(e,o)))}processMessage(e){const t=e.data;"serial"===(null==t?void 0:t.type)?this.processSerialMessage(t):"messagepacket"===(null==t?void 0:t.type)&&this.processMessagePacketMessage(t)}hide(){this.setState({visible:!1}),l.getFrame(this.state.extension,!0).style.display="none",o.showLoading("reloadproject",lf("loading...")),this.send(this.state.extension,{target:pxt.appTarget.id,type:"pxtpkgext",event:"exthidden"}),this.props.parent.reloadHeaderAsync().then((()=>o.hideLoading("reloadproject")))}showExtensionAsync(e,t){this.setState({visible:!0,extension:e,url:t},(()=>{this.send(e,{target:pxt.appTarget.id,type:"pxtpkgext",event:"extshown"})}))}initializeFrame(){const e=l.getFrame(this.state.extension,!0);e.style.display="block",e.src||(e.src=this.state.url+"#"+this.manager.getExtId(this.state.extension),e.onload=()=>{this.send(this.state.extension,{target:pxt.appTarget.id,type:"pxtpkgext",event:"extloaded"})})}shouldComponentUpdate(e,t,n){return this.state.visible!=t.visible||this.state.extension!=t.extension}updateDimensions(){if(this.extensionWrapper){const e=60,t=this.extensionWrapper.getAttribute("data-frame");if(t){const n=l.getFrame(t,!1),r=document.getElementsByClassName("extensiondialog")[0];r&&n&&(r.getBoundingClientRect(),n.width=`${window.innerWidth}px`,n.height=window.innerHeight-e+"px",n.style.top=`${e}px`,n.style.left="0px")}}}componentDidMount(){window.addEventListener("resize",this.updateDimensions)}componentWillUnmount(){window.removeEventListener("resize",this.updateDimensions)}componentDidUpdate(){setTimeout((()=>{this.updateDimensions()}),0)}UNSAFE_componentWillUpdate(e,t){t.extension&&t.visible&&l.getFrame(t.extension,!0)}handleExtensionRequest(e){this.manager.handleExtensionMessage(e)}send(e,t){const n=l.getFrame(e,!1);n?n.contentWindow.postMessage(t,"*"):console.warn(`Attempting to post message to unloaded extesnion ${e}`)}static getCustomContent(){return document.getElementById("custom-content")}static getFrame(e,t){let n=this.getCustomContent().getElementsByClassName(`extension-frame-${e}`)[0];return!n&&t&&(n=this.createFrame(e)),n}static createFrame(e){const t=this.getCustomContent(),n=document.createElement("iframe");return n.className=`extension-frame extension-frame-${e}`,n.allowFullscreen=!0,n.setAttribute("sandbox","allow-same-origin allow-scripts"),n.frameBorder="0",n.style.display="none",t.appendChild(n),n}static hideAllFrames(){const e=this.getCustomContent();e&&pxt.Util.toArray(e.getElementsByClassName("extension-frame")).forEach((e=>{e.style.zIndex="10"}))}static showAllFrames(){const e=this.getCustomContent();e&&pxt.Util.toArray(e.getElementsByClassName("extension-frame")).forEach((e=>{e.style.zIndex=""}))}renderCore(){const{visible:e,extension:t}=this.state;return l.showAllFrames(),e&&this.initializeFrame(),(0,r.jsx)(s.Modal,Object.assign({isOpen:e,className:"extensiondialog",size:"fullscreen",closeIcon:!0,onClose:this.hide,dimmer:!0,modalDidOpen:this.updateDimensions,shouldFocusAfterRender:!1,onPositionChanged:this.updateDimensions,closeOnDimmerClick:!0},{children:(0,r.jsx)("div",{id:"extensionWrapper","data-frame":t,ref:this.handleExtensionWrapperRef})}))}}n.Extensions=l},{"./core":133,"./data":136,"./extensionManager":148,"./sui":200,"react/jsx-runtime":367}],150:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ExtensionsBrowser=void 0;const r=e("react/jsx-runtime"),i=e("./data"),o=e("./core"),s=e("./workspace"),a=e("./package"),l=e("../../react-common/components/controls/Button"),c=e("../../react-common/components/controls/Input"),u=e("react"),d=e("../../react-common/components/extensions/ImportModal"),p=e("../../react-common/components/extensions/ExtensionCard"),h=e("../../react-common/components/controls/Modal"),f=pxtc.service.ExtensionType,g={name:"",loading:!0};var m,v;(v=m||(m={}))[v.Recommended=0]="Recommended",v[v.InDevelopment=1]="InDevelopment";n.ExtensionsBrowser=e=>{const[t,n]=(0,u.useState)(""),[v,y]=(0,u.useState)(!0),[b,x]=(0,u.useState)(V()),E=(0,u.useMemo)((()=>function(){let t=s.getHeaders();return/localdependencies=1/i.test(window.location.href)||(t=t.filter((e=>!!e.githubId))),e.header&&(t=t.filter((t=>t.id!=e.header.id))),t}()),[]),[_,w]=(0,u.useState)([]),[S,T]=(0,u.useState)(""),[k,C]=(0,u.useState)(m.Recommended),[A,j]=(0,u.useState)(!1),[I,O]=(0,u.useState)([]),[N,R]=(0,u.useState)(new Map);function P(e){if(!e)return;const t=b;e.forEach((e=>{t.has(e.name.toLowerCase())||t.set(e.name.toLowerCase(),e)})),x(t)}function D(e){const t=pxt.github.parseRepoId(e);if(t)return b.get(t.fullName.toLowerCase());return b.get(e.toLowerCase())||void 0}async function M(t,n){try{e.hideExtensions(),o.showLoading("installingextension",lf("Adding extension...")),await a.mainEditorPkg().addDependencyAsync(Object.assign(Object.assign({},t),{isExtension:!0}),n,!1)&&(await pxt.Util.delay(200),await e.reloadHeaderAsync())}finally{o.hideLoading("installingextension")}}async function L(e){let t;try{o.showLoading("downloadingpackage",lf("downloading extension..."));const n=D(e.repo.fullName);if(n)t=await pxt.github.downloadLatestPackageAsync(n.repo);else{const n=await B([e.repo.fullName]);if(n&&n.length>0){const e=G(n[0]);P([e]),t=await pxt.github.downloadLatestPackageAsync(e.repo)}}}catch(e){o.handleNetworkError(e)}finally{o.hideLoading("downloadingpackage")}return await M(t.config,t.version)}async function B(e){const t=e.length<=1?"gh-search":"extension-search";return i.getAsync(`${t}:${e.join("|")}`)}async function F(e){if(!e.length)return[];const t=await B(e);if(!t)return[];const n=t.map((e=>G(e)));return P(n),n}function U(e){pxt.tickEvent("extensions.local"),s.getTextAsync(e.id).then((t=>M(JSON.parse(t[pxt.CONFIG_NAME]),"workspace:"+e.id)))}function H(t){switch(t.type){case f.Bundled:pxt.tickEvent("extensions.bundled",{name:t.name}),e.hideExtensions(),M(t.pkgConfig,"*");break;case f.Github:pxt.tickEvent("extensions.github",{name:t.repo.fullName,slug:t.repo.slug.toLowerCase(),tag:t.repo.tag,fileName:t.repo.fileName}),e.hideExtensions(),L(t);break;case f.ShareScript:pxt.tickEvent("extensions.sharescript",{name:t.scriptInfo.id}),e.hideExtensions(),async function(e){const t=await s.getPublishedScriptAsync(e.id),n=pxt.Util.jsonTryParse(t[pxt.CONFIG_NAME]);M(Object.assign(Object.assign({},n),{version:e.id}),`pub:${e.id}`)}(t.scriptInfo)}}function G(e){return{name:(t=e,t.name.replace(/^pxt-/,"")),type:f.Github,imageUrl:pxt.github.repoIconUrl(e),repo:e,description:e.description,fullName:e.fullName};var t}async function q(e){if(e==S)return T(""),void w([]);T(e),n("");const t=N.get(e),r=[],i=[];t.forEach((e=>{const t=D(e);t?i.push(t):r.push(e)}));const o=[];for(let e=0;e<r.length;e++)o.push(g);if(w([...i,...o]),r.length>0){const e=await F(r);w([...i,...e])}}function V(){const e=pxt.appTarget.bundledpkgs,n=new Map;return Object.keys(e).filter((e=>!/prj$/.test(e))).map((t=>JSON.parse(e[t]["pxt.json"]))).filter((e=>!e.hidden)).filter((e=>!/---/.test(e.name))).filter((e=>!e.searchOnly||0!=(null==t?void 0:t.length))).filter((e=>"core"!=e.name)).filter((e=>0==!!e.core)).filter((e=>!a.mainPkg.deps[e.name]||a.mainPkg.deps[e.name].cppOnly)).sort(((e,t)=>{if(e.core!=t.core)return e.core?-1:1;const n=pxt.isPkgBeta(e);if(n!=pxt.isPkgBeta(t))return n?1:-1;const r=void 0===e.weight?50:e.weight,i=void 0===t.weight?50:t.weight;return r!=i?-r+i:pxt.Util.strcmp(e.name,t.name)})).forEach((e=>n.set(e.name,function(e){return{name:e.name,imageUrl:e.icon,type:f.Bundled,learnMoreUrl:`/reference/${e.name}`,pkgConfig:e,description:e.description}}(e)))),n}function z(e){const{extensionInfo:t}=e,{description:n,fullName:i,imageUrl:o,learnMoreUrl:s,loading:a,name:l,repo:c,type:u}=t;return(0,r.jsx)(p.ExtensionCard,{title:l||i,description:n,imageUrl:o,extension:t,onClick:H,learnMoreUrl:s||(i?`/pkg/${i}`:void 0),loading:a,label:pxt.isPkgBeta(t)?lf("Beta"):void 0,showDisclaimer:u!=f.Bundled&&(null==c?void 0:c.status)!=pxt.github.GitRepoStatus.Approved})}let W,K;(0,u.useEffect)((()=>{!async function(){var e,t;if(N.size>0)return;let n=await i.getAsync("target-config:");const r=null===(e=null==n?void 0:n.packages)||void 0===e?void 0:e.approvedRepoLib,o=null===(t=null==n?void 0:n.packages)||void 0===t?void 0:t.builtinExtensionsLib;let s=[];const a=N;(r||o)&&(r&&(s=s.concat(Object.keys(r))),o&&(s=s.concat(Object.keys(o))),s.forEach((e=>{var t;null===(t=((null==r?void 0:r[e])||(null==o?void 0:o[e])).tags)||void 0===t||t.forEach((t=>{a.has(t)||a.set(t,[]);const n=a.get(t);-1===n.indexOf(e)&&n.push(e)}))})),R(a))}(),async function(){var e;const t=V(),n=[];t.forEach((e=>{n.push(e)}));let r=await i.getAsync("target-config:");const o=[];(null===(e=null==r?void 0:r.packages)||void 0===e?void 0:e.approvedRepoLib)&&Object.keys(r.packages.approvedRepoLib).forEach((e=>{if(!r.packages.approvedRepoLib[e].preferred)return;const t=D(e);t?n.push(t):o.push(e)}));const s=[];for(let e=0;e<o.length;e++)s.push(g);O([...n,...s]);const a=await F(o);O([...n,...a])}()}),[]),(0,u.useEffect)((()=>{t&&""!=t&&async function(){const e=/^\/@(.*)$/.exec(t);let n=null==e?void 0:e[1];if(n){let e=pxt.appTarget.appTheme.homeUrl;/\/$/.test(e)||(e+="/"),n=n.replace(/^\//,""),window.location.href=`${e}${n}`}T(""),y(!1),w([g,g,g,g]);const r=(await B([t])).map((e=>G(e)));V().forEach((e=>{e.name.toLowerCase().indexOf(t.toLowerCase())>-1&&r.unshift(e)}));const o=await async function(e){const t=pxt.Cloud.parseScriptId(e);if(!t)return;const n=await i.getAsync(`cloud-search:${t}`);return 404!=n.statusCode?Array.isArray(n)?n[0]:n:void 0}(t);var s;o&&r.unshift({name:(s=o).name,type:f.ShareScript,imageUrl:s.thumb?`${pxt.Cloud.apiRoot}/${s.id}/thumb`:void 0,description:s.description,scriptInfo:s}),P(r),w(r),y(!0)}()}),[t]),function(e){e[e.Tabbed=0]="Tabbed",e[e.Search=1]="Search",e[e.Tags=2]="Tags"}(W||(W={})),K=""!=t?W.Search:""!=S?W.Tags:W.Tabbed;const $=N?Array.from(N.keys()):[],Y=e=>{n(e||"")};return(0,r.jsx)(h.Modal,Object.assign({title:lf("Extensions"),fullscreen:!0,className:"extensions-browser",onClose:e.hideExtensions,helpUrl:"/extensions"},{children:(0,r.jsxs)("div",Object.assign({className:"ui"},{children:[A&&(0,r.jsx)(d.ImportModal,{onCancelClick:()=>j(!1),onImportClick:async function(t){j(!1),e.hideExtensions();const n=D(t);n?L(n):P(await F([t]))}}),(0,r.jsxs)("div",Object.assign({className:"extension-search-header"},{children:[(0,r.jsx)(c.Input,{placeholder:lf("Search or enter project URL..."),ariaLabel:lf("Search or enter project URL..."),initialValue:t,onEnterKey:Y,onBlur:Y,icon:"fas fa-search"}),(0,r.jsx)("div",Object.assign({className:"extension-tags"},{children:$.map((e=>(0,r.jsx)(l.Button,{title:pxt.Util.rlf(e),label:pxt.Util.rlf(e),onClick:()=>q(e),onKeydown:()=>q,className:"extension-tag "+(S==e?"selected":"")},e)))}))]})),(0,r.jsxs)("div",Object.assign({className:"extension-display"},{children:[(0,r.jsxs)("div",Object.assign({className:"extension-header"},{children:[(K==W.Search||K==W.Tags)&&(0,r.jsxs)("div",Object.assign({className:"breadcrumbs"},{children:[(0,r.jsx)(l.Button,{title:lf("Home"),label:lf("Home"),onClick:function(){T(""),n("")},className:"link-button"}),K==W.Tags&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:"/"}),(0,r.jsx)("span",{children:S})]})]})),K==W.Tabbed&&(0,r.jsxs)("div",Object.assign({className:"tab-header"},{children:[!!E.length&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.Button,{title:lf("Recommended Extensions"),label:lf("Recommended"),onClick:()=>{C(m.Recommended)},className:k==m.Recommended?"selected":""}),(0,r.jsx)(l.Button,{title:lf("Local GitHub Projects"),label:lf("Local"),onClick:()=>{C(m.InDevelopment)},className:k==m.InDevelopment?"selected":""})]}),!E.length&&!!I.length&&(0,r.jsx)("h2",{children:lf("Recommended")})]})),(0,r.jsx)("div",Object.assign({className:"import-button"},{children:(0,r.jsx)(l.Button,{ariaLabel:lf("Open file from your computer"),title:lf("Import File"),label:lf("Import File"),leftIcon:"fas fa-upload",className:"gray",onClick:function(){pxt.tickEvent("extensions.importfile",void 0,{interactiveConsent:!0}),e.hideExtensions(),e.importExtensionCallback()}})}))]})),K==W.Search&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",Object.assign({className:"extension-cards"},{children:null==_?void 0:_.map(((e,t)=>(0,r.jsx)(z,{extensionInfo:e},t)))})),v&&0==_.length&&(0,r.jsx)("div",Object.assign({"aria-label":"Extension search results"},{children:(0,r.jsx)("p",{children:lf("We couldn't find any extensions matching '{0}'",t)})}))]}),K==W.Tags&&(0,r.jsx)("div",Object.assign({className:"extension-cards"},{children:null==_?void 0:_.map(((e,t)=>(0,r.jsx)(z,{extensionInfo:e},t)))})),K==W.Tabbed&&(0,r.jsxs)("div",Object.assign({className:"extension-cards"},{children:[k==m.Recommended&&I.map(((e,t)=>(0,r.jsx)(z,{extensionInfo:e},t))),k==m.InDevelopment&&E.map(((e,t)=>(0,r.jsx)(p.ExtensionCard,{title:e.name,description:lf("Local copy of {0} hosted on github.com",e.githubId),imageUrl:e.icon,extension:e,onClick:U},`local:${t}`)))]}))]}))]}))}))}},{"../../react-common/components/controls/Button":3,"../../react-common/components/controls/Input":11,"../../react-common/components/controls/Modal":16,"../../react-common/components/extensions/ExtensionCard":21,"../../react-common/components/extensions/ImportModal":22,"./core":133,"./data":136,"./package":179,"./workspace":208,react:366,"react/jsx-runtime":367}],151:[function(e,t,n){"use strict";var r=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.FileList=void 0;const i=e("react/jsx-runtime"),o=e("./data"),s=e("./sui"),a=e("./package"),l=e("./core"),c=e("./util"),u="custom.ts",d=`\nenum MyEnum {\n    //% block="one"\n    One,\n    //% block="two"\n    Two\n}\n\n/**\n * ${lf("Custom blocks")}\n */\n//% weight=100 color=#0fbc11 icon=""\nnamespace custom {\n    /**\n     * TODO: ${lf("describe your function here")}\n     * @param n ${lf("describe parameter here")}, eg: 5\n     * @param s ${lf("describe parameter here")}, eg: "Hello"\n     * @param e ${lf("describe parameter here")}\n     */\n    //% block\n    export function foo(n: number, s: string, e: MyEnum): void {\n        // Add code here\n    }\n\n    /**\n     * TODO: ${lf("describe your function here")}\n     * @param value ${lf("describe value here")}, eg: 5\n     */\n    //% block\n    export function fib(value: number): number {\n        return value <= 1 ? value : fib(value -1) + fib(value - 2);\n    }\n}\n`,p=e=>`\n/**\n* ${lf("Use this file to define custom functions and blocks.")}\n* ${lf("Read more at {0}",e+"blocks/custom")}\n*/\n`;class h extends o.Component{constructor(e){super(e),this.state={},this.toggleVisibility=this.toggleVisibility.bind(this),this.handleCustomBlocksClick=this.handleCustomBlocksClick.bind(this),this.handleButtonKeydown=this.handleButtonKeydown.bind(this),this.setFile=this.setFile.bind(this),this.removeFile=this.removeFile.bind(this),this.addLocalizedFile=this.addLocalizedFile.bind(this),this.removePkg=this.removePkg.bind(this),this.updatePkg=this.updatePkg.bind(this),this.togglePkg=this.togglePkg.bind(this),this.navigateToError=this.navigateToError.bind(this)}UNSAFE_componentWillReceiveProps(e){const t=e.parent.state.currFile;if(this.state.currentFile!=t){let e;a.allEditorPkgs().forEach((n=>{this.packageContainsFile(n,t)&&(e=n.getPkgId())})),this.setState({expandedPkg:e,currentFile:t})}}removePkg(e){l.confirmAsync({header:lf("Remove {0} extension",e.getPkgId()),body:lf("You are about to remove an extension from your project. Are you sure?"),agreeClass:"red",agreeIcon:"trash",agreeLbl:lf("Remove it")}).then((t=>{t&&a.mainEditorPkg().removeDepAsync(e.getPkgId()).then((()=>this.props.parent.reloadHeaderAsync()))}))}setFile(e){this.props.parent.setSideFile(e)}removeFile(e){this.props.parent.removeFile(e)}addLocalizedFile(e,t){return this.props.parent.updateFileAsync(t,e.content,!0)}updatePkg(e){l.showLoading("update",lf("Updating...")),a.mainEditorPkg().updateDepAsync(e.getPkgId()).then((()=>this.props.parent.reloadHeaderAsync())).finally((()=>l.hideLoading("update")))}navigateToError(e){const t=e&&e.diagnostics&&e.diagnostics[0];t&&this.props.parent.navigateToError(t)}filesOf(e){const t=e.isTopLevel(),n=e.getLanguageRestrictions();let r=e.sortedFiles();t&&(r=r.filter((e=>{switch(n){case"javascript-only":return!/\.(blocks|py)$/.test(e.name);case"python-only":return!/\.(blocks|ts)$/.test(e.name);default:return!0}})));const o={};return r.forEach((e=>{const t=e.name.lastIndexOf("/"),n=t<0?"":e.name.slice(0,t);(o[n]||(o[n]=[])).push(e)})),Object.keys(o).map((t=>(0,i.jsx)(f,Object.assign({folder:t},{children:this.folderFilesOf(e,t,o[t])}),"folder-"+t))).reduce(((e,t)=>e.concat(t)),[])}folderFilesOf(e,t,n){const{currentFile:r}=this.state,o=this.props.parent.state.header,a=e.isTopLevel(),l=pxt.shell.isReadOnly(),c=a&&!l;return n.map((u=>{const d=this.getData("open-meta:"+u.getName()),p=!!o&&!!o.githubId,h=a&&p&&/\.md$/.test(u.name)&&!/^_locales\//.test(u.name),f=u.name.replace(/\.[a-z]+$/,""),m=!l&&h&&`#tutorial:${o.id}:${f}`,v=p&&pxt.github.parseRepoId(o.githubId),y=h&&v&&pxt.appTarget.appTheme.embedUrl&&`${window.location.origin}${window.location.pathname||""}#tutorial:github:${v.fullName}/${f}`,b=`_locales/${pxt.Util.userLanguage()}/${u.name}`,x=!l&&h&&pxt.Util.userLanguage()!==(pxt.appTarget.appTheme.defaultLocale||"en")&&!n.some((e=>e.name==b)),E=c&&u.name!=pxt.CONFIG_NAME&&(p||u.name!=pxt.MAIN_TS)&&!u.isReadonly(),_=t.length?t.length+1:0;return(0,i.jsxs)(g,Object.assign({file:u,meta:d,onItemClick:this.setFile,onItemRemove:this.removeFile,onErrorClick:this.navigateToError,onItemLocalize:this.addLocalizedFile,isActive:r==u,hasDelete:E,previewUrl:m,shareUrl:y,addLocalizedFile:x&&b,className:(r==u?"active ":"")+(e.isTopLevel()?"":"nested ")+(t?"folderitem ":"")+"item"},{children:[u.name.slice(_),"",d.isGitModified?" ":"",d.isReadonly?(0,i.jsx)(s.Icon,{icon:"lock"}):null]}),"file-"+u.getName())}))}packageOf(e){var t;const n=this.state.expandedPkg,r=e.getPkgId(),o=!pxt.shell.isReadOnly()&&r!=pxt.appTarget.id&&"built"!=r&&"assets"!=r&&r!=pxt.appTarget.corepkg&&e.getKsPkg().config&&!e.getKsPkg().config.core&&e.getKsPkg().level<=1,s="github"==(null===(t=e.getKsPkg())||void 0===t?void 0:t.verProtocol()),a=o&&s,l=this.getData("open-pkg-meta:"+e.getPkgId());let c=s?e.getKsPkg().verArgument().split("#")[1]:void 0;return c&&c.length>20&&(c=c.substring(0,7)),[(0,i.jsxs)(m,Object.assign({pkg:e,isActive:n==r,onItemClick:this.togglePkg,hasDelete:o,onItemRemove:this.removePkg,version:c,hasRefresh:a,onItemRefresh:this.updatePkg},{children:[l.numErrors?(0,i.jsx)("span",Object.assign({className:"ui label red"},{children:l.numErrors})):null,r,n==r?(0,i.jsx)("div",Object.assign({role:"group",className:"menu"},{children:this.filesOf(e)})):void 0]}),"hd-"+r)]}packageContainsFile(e,t){return e.sortedFiles().filter((e=>e==t)).length>0}togglePkg(e){this.setState({expandedPkg:this.state.expandedPkg==e.getPkgId()?void 0:e.getPkgId()})}filesWithHeader(e){return e.isTopLevel()?this.filesOf(e):this.packageOf(e)}toggleVisibility(){this.props.parent.setState({showFiles:!this.props.parent.state.showFiles})}handleCustomBlocksClick(e){this.addCustomBlocksFile(),e.stopPropagation()}handleButtonKeydown(e){e.stopPropagation()}addProjectFile(){const e=a.mainEditorPkg(),t=/^[\w][\/\w\-\.]*$/;l.promptAsync({header:lf("Add new file?"),hasCloseIcon:!0,onInputValidation:e=>e?(e=e.trim(),t.test(e)?void 0:lf("Don't use spaces or special characters.")):lf("filename is empty."),body:lf("Please provide a name for your new file."),initialValue:e.files[u]?void 0:u}).then((e=>{if(!e)return Promise.resolve();const n=(e=e.replace(/\s+/g,"")).lastIndexOf(".");let r,i=e;-1!=n&&(i=e.slice(0,n),r=e.slice(n+1).toLowerCase());const o=a.mainPkg&&a.mainPkg.config,s=o&&o.languageRestriction;let c="ts",h="//",f=pxt.U.lf("Add your code here");if("python-only"===s&&(c="py",h="#"),r)switch(r){case"js":case"ts":break;case"py":"javascript-only"!==s&&(c="py",h="#");break;case"md":c="md",h="#",f=i;break;case"json":c="json",h=void 0;break;case"jres":c="jres",h=void 0;break;default:i=e}if(!i)return Promise.resolve();if(!t.test(i))return l.warningNotification(lf("Invalid file name")),Promise.resolve();const g=`${i}.${c}`;if(a.mainEditorPkg().sortedFiles().some((e=>e.name==g)))return l.warningNotification(lf("File already exists")),Promise.resolve();let m="";return g==u?m=p(pxt.appTarget.appTheme.homeUrl)+d:h&&(m=`${h} ${f}\n`),this.props.parent.updateFileAsync(g,m,!0)}))}addCustomBlocksFile(){this.props.parent.state.header.githubId||pxt.appTarget.appTheme.addNewTypeScriptFile?this.addProjectFile():l.confirmAsync({header:lf("Add custom blocks?"),body:lf("A new JavaScript file, custom.ts, will be added to your project. You can define custom functions and blocks in that file.")}).then((e=>{if(e)return this.props.parent.updateFileAsync(u,p(pxt.appTarget.appTheme.homeUrl)+d,!0)}))}renderCore(){const e=!!this.props.parent.state.showFiles,t=pxt.appTarget.appTheme,n=a.mainEditorPkg(),r=e&&!pxt.shell.isReadOnly()&&(!n.files[u]||pxt.appTarget.appTheme.addNewTypeScriptFile),o=this.getData("open-pkg-meta:"+n.getPkgId());return(0,i.jsxs)("div",Object.assign({role:"tree",className:`ui tiny vertical ${t.invertedMenu?"inverted":""} menu filemenu landscape only hidefullscreen`},{children:[(0,i.jsxs)("div",Object.assign({role:"treeitem","aria-selected":e,"aria-expanded":e,"aria-label":lf("File explorer toolbar"),className:"link item",onClick:this.toggleVisibility,tabIndex:0,onKeyDown:c.fireClickOnEnter},{children:[lf("Explorer"),(0,i.jsx)(s.Icon,{icon:`chevron ${e?"up":"down"} icon`}),r?(0,i.jsx)(s.Button,{className:"primary label",icon:"plus",title:lf("Add custom blocks?"),onClick:this.handleCustomBlocksClick,onKeyDown:this.handleButtonKeydown}):void 0,o.numErrors?(0,i.jsx)("span",Object.assign({className:"ui label red"},{children:o.numErrors})):null]}),"projectheader"),e?pxt.Util.concat(a.allEditorPkgs().map((e=>this.filesWithHeader(e)))):void 0]}))}}n.FileList=h;class f extends s.StatelessUIElement{constructor(e){super(e)}renderCore(){const{folder:e,children:t}=this.props;return e?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",Object.assign({className:"folder item",role:"treeitem","aria-selected":!1,"aria-label":lf("Files in folder {0}",e)},{children:[(0,i.jsx)("i",{className:"folder open outline icon"}),e]})),t]}):t}}class g extends s.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.handleRemove=this.handleRemove.bind(this),this.handleButtonKeydown=this.handleButtonKeydown.bind(this),this.handlePreview=this.handlePreview.bind(this),this.handleShare=this.handleShare.bind(this),this.handleAddLocale=this.handleAddLocale.bind(this)}handleClick(e){this.props.onErrorClick&&this.props.meta&&this.props.meta.numErrors&&this.props.meta.diagnostics&&this.props.meta.diagnostics[0]?this.props.onErrorClick(this.props.meta):this.props.onItemClick(this.props.file),e.stopPropagation()}handleRemove(e){pxt.tickEvent("explorer.file.remove"),e.preventDefault(),e.stopPropagation(),this.props.onItemRemove(this.props.file)}handlePreview(e){pxt.tickEvent("explorer.file.preview"),e.preventDefault(),e.stopPropagation(),window.open(this.props.previewUrl,"_blank")}handleShare(e){pxt.tickEvent("explorer.file.share"),e.preventDefault(),e.stopPropagation(),l.dialogAsync({header:lf("Share this tutorial"),body:lf("The URL will start the MakeCode editor in your tutorial."),copyable:this.props.shareUrl,hasCloseIcon:!0})}handleAddLocale(e){pxt.tickEvent("explorer.file.addlocale");const{addLocalizedFile:t,onItemLocalize:n}=this.props;n&&t&&n(this.props.file,t),e.stopPropagation()}handleButtonKeydown(e){e.stopPropagation()}renderCore(){const{isActive:e,hasDelete:t,file:n,meta:r,previewUrl:o,shareUrl:a,addLocalizedFile:l,className:u}=this.props;return(0,i.jsxs)("a",Object.assign({onClick:this.handleClick,tabIndex:0,role:"treeitem","aria-selected":e,"aria-label":e?lf("{0}, it is the current opened file in the JavaScript editor",n.name):n.name,onKeyDown:c.fireClickOnEnter,className:u},{children:[this.props.children,t&&(0,i.jsx)(s.Button,{className:"primary label",icon:"trash",title:lf("Delete file {0}",n.name),onClick:this.handleRemove,onKeyDown:this.handleButtonKeydown}),r&&r.numErrors?(0,i.jsx)("span",Object.assign({className:"ui label red button",role:"button",title:lf("Go to error")},{children:r.numErrors})):void 0,a&&(0,i.jsx)(s.Button,{className:"button primary label",icon:"share alternate",title:lf("Share"),onClick:this.handleShare,onKeyDown:c.fireClickOnEnter}),o&&(0,i.jsx)(s.Button,{className:"button primary label",icon:"flask",title:lf("Preview"),onClick:this.handlePreview,onKeyDown:c.fireClickOnEnter}),!!l&&(0,i.jsx)(s.Button,{className:"primary label",icon:"xicon globe",title:lf("Add localized file"),onClick:this.handleAddLocale,onKeyDown:this.handleButtonKeydown})]}))}}class m extends s.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.handleRemove=this.handleRemove.bind(this),this.handleRefresh=this.handleRefresh.bind(this),this.handleButtonKeydown=this.handleButtonKeydown.bind(this)}handleClick(){this.props.onItemClick(this.props.pkg)}handleRefresh(e){e.stopPropagation(),this.props.onItemRefresh(this.props.pkg)}handleRemove(e){e.stopPropagation(),this.props.onItemRemove(this.props.pkg)}handleButtonKeydown(e){e.stopPropagation()}renderCore(){const e=this.props,{onItemClick:t,onItemRemove:n,onItemRefresh:o,version:a,isActive:l,hasRefresh:u,hasDelete:d,pkg:p}=e,h=r(e,["onItemClick","onItemRemove","onItemRefresh","version","isActive","hasRefresh","hasDelete","pkg"]);return(0,i.jsxs)("div",Object.assign({className:"header link item",role:"treeitem","aria-selected":l,"aria-expanded":l,"aria-label":lf("{0}, {1}",p.getPkgId(),l?lf("expanded"):lf("collapsed")),onClick:this.handleClick,tabIndex:0,onKeyDown:c.fireClickOnEnter},h,{children:[(0,i.jsx)(s.Icon,{icon:`chevron ${l?"up":"down"} icon`}),u?(0,i.jsx)(s.Button,{className:"primary label",icon:"refresh",title:lf("Refresh extension {0}",p.getPkgId()),onClick:this.handleRefresh,onKeyDown:this.handleButtonKeydown,text:a||""}):a?(0,i.jsx)("span",Object.assign({className:"label",style:{background:"transparent"}},{children:a})):void 0,d?(0,i.jsx)(s.Button,{className:"primary label",icon:"trash",title:lf("Delete extension {0}",p.getPkgId()),onClick:this.handleRemove,onKeyDown:this.handleButtonKeydown}):void 0,this.props.children]}))}}},{"./core":133,"./data":136,"./package":179,"./sui":200,"./util":206,"react/jsx-runtime":367}],152:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.provider=n.setApiAsync=void 0;const r=e("./core");var i=pxt.Util,o=pxt.Cloud;let s=(e,t)=>i.requestAsync({url:"/api/"+e,headers:{Authorization:o.localToken},method:t?"POST":"GET",data:t||void 0}).then((e=>e.json)).catch(r.handleNetworkError);function a(e,t,n){let r={files:[],config:null,header:e,path:e.path,isDeleted:e.isDeleted};if(n){t||(t={});for(let e of Object.keys(n))n[e]!==t[e]&&r.files.push({name:e,mtime:null,content:n[e],prevContent:t[e]});for(let e of Object.keys(t))void 0===n[e]&&r.files.push({name:e,mtime:null,content:null,prevContent:t[e]})}let o=i.flatClone(n||{});return s("pkg/"+e.path,r).then((e=>o))}n.setApiAsync=function(e){s=e},n.provider={getAsync:function(e){return s("pkg/"+e.path).then((t=>{let n={header:e,text:{},version:null};for(let r of t.files)n.text[r.name]=r.content,e.modificationTime=Math.max(e.modificationTime,r.mtime/1e3|0);return e.recentUse=Math.max(e.recentUse,e.modificationTime),n.version=i.flatClone(n.text),n}))},setAsync:a,listAsync:async function(){let e=await s("list");for(let t of e.pkgs)if(t.header)t.header.path=t.path;else{let e=t.files.map((e=>e.mtime));e.sort(((e,t)=>t-e));let n=Math.round(e[0]/1e3)||i.nowSeconds();t.header=pxt.workspace.freshHeader(t.config.name,n),t.config.preferredEditor&&(t.header.editor=t.config.preferredEditor),t.header.path=t.path,await a(t.header,null)}return e.pkgs.map((e=>e.header))},resetAsync:function(){return pxt.BrowserUtils.isPxtElectron()?s("resetworkspace",{}).then((()=>{})):Promise.resolve()},deleteAsync:function(e,t){return e.isDeleted=!0,a(e,t,{})},saveScreenshotAsync:function(e,t,n){return s("screenshot/"+e.path,{screenshot:t,icon:n})},saveAssetAsync:function(e,t,n){return s("pkgasset/"+e,{encoding:"base64",name:t,data:btoa(ts.pxtc.Util.uint8ArrayToString(n))}).then((e=>{}))},listAssetsAsync:function(e){return s("pkgasset/"+e).then((e=>e.files))}}},{"./core":133}],153:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GithubButton=void 0;const r=e("react/jsx-runtime"),i=e("./sui"),o=e("./package"),s=e("./workspace"),a=e("./util");class l extends i.UIElement{constructor(e){super(e),this.state={},this.handleClick=this.handleClick.bind(this),this.handleButtonKeydown=this.handleButtonKeydown.bind(this),this.createRepository=this.createRepository.bind(this)}handleButtonKeydown(e){e.stopPropagation()}createRepository(e){pxt.tickEvent("github.button.create",void 0,{interactiveConsent:!0}),this.props.parent.createGitHubRepositoryAsync()}handleClick(e){e.stopPropagation();const{header:t}=this.props.parent.state;if(!t)return;const{githubId:n}=t;if(!n)return;pxt.tickEvent("github.button.nav");const r=o.mainEditorPkg().lookupFile("this/"+pxt.github.GIT_JSON);r&&this.props.parent.setSideFile(r)}renderCore(){const e=this.props.parent.state.header;if(!e)return(0,r.jsx)("div",{});const{githubId:t}=e,n=pxt.github.parseRepoId(t),o="ui icon button editortools-btn editortools-github-btn";if(!n)return(0,r.jsx)(i.Button,{className:`${o} ${this.props.className||""}`,icon:"github",title:lf("create GitHub repository"),ariaLabel:lf("create GitHub repository"),onClick:this.createRepository},"githubcreatebtn");const l=this.getData("pkg-git-status:"+e.id),c=l&&this.getData("pkg-git-pull-status:"+e.id),u=c==s.PullStatus.BranchNotFound,d=c==s.PullStatus.GotChanges,p=l&&!!l.modified,h=n.project&&n.tag?`${n.project}${pxt.github.isDefaultBranch(n.tag)?"":`#${n.tag}`}`:n.fullName;let f=n.tag&&pxt.github.isDefaultBranch(n.tag)?"":`#${n.tag}`;f.length>20&&(f=f.slice(0,18)+"..");const g=u?lf("{0}: there is an issue with your GitHub connection.",h):d?lf("{0}: remote changes are ready to be pulled.",h):p?lf("{0}: review, commit & push local changes to GitHub.",h):lf("{0}: local changes are synchronized with GitHub.",h);return(0,r.jsxs)("div",Object.assign({role:"button",className:`${o}\n            ${this.props.className||""}`,title:g,onClick:this.handleClick,onKeyDown:a.fireClickOnEnter,tabIndex:0},{children:[(0,r.jsx)("i",{className:"github icon"}),(0,r.jsx)("span",Object.assign({className:"ui mobile hide"},{children:f})),(0,r.jsx)("span",Object.assign({className:"ui long mobile hide"},{children:(0,r.jsx)("i",{className:(u?"exclamation circle":d?"arrow alternate down":p?"arrow alternate up":"check")+" icon"})}))]}),"githubeditorbtn")}}n.GithubButton=l},{"./package":179,"./sui":200,"./util":206,"./workspace":208,"react/jsx-runtime":367}],154:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GithubProvider=n.PROVIDER_NAME=void 0;const r=e("react/jsx-runtime"),i=e("./sui"),o=e("./core"),s=e("./cloudsync"),a=e("./dialogs"),l=e("./workspace");n.PROVIDER_NAME="github";class c extends s.ProviderBase{constructor(){super(n.PROVIDER_NAME,lf("GitHub"),"icon github","https://api.github.com"),pxt.github.handleGithubNetworkError=(e,t)=>401==t.statusCode&&pxt.github.token?(pxt.log("github: invalid token"),this.clearToken(),"GET"==e.method):(403==t.statusCode?pxt.log("github: unauthorized access"):404==t.statusCode&&(t.needsWritePermission=!0),!1)}clearToken(){pxt.github.token=void 0,super.logout()}logout(){pxt.github.token=void 0,super.logout(),window.open("https://github.com/logout","_blank")}hasToken(){return this.loginCheck(),!!this.token()}loginCheck(){super.loginCheck();const e=this.token();pxt.github.token=e}loginAsync(e,t){return this.routedLoginAsync(void 0)}routedLoginAsync(e){this.loginCheck();let t=Promise.resolve();return this.token()||(t=t.then((()=>this.showLoginAsync(e)))),t.then((()=>({accessToken:this.token()})))}showLoginAsync(e){pxt.tickEvent("github.login.dialog");let t,n=!(pxt.appTarget&&!pxt.BrowserUtils.isPxtElectron()&&pxt.appTarget.cloud&&pxt.appTarget.cloud.cloudProviders&&pxt.appTarget.cloud.cloudProviders[this.name]),s=!1;const a=e=>{s=e,o.forceUpdate()};return o.confirmAsync({header:lf("Sign in with GitHub"),hasCloseIcon:!0,helpUrl:"/github",agreeLbl:lf("Sign in"),onLoaded:e=>{t=e},jsxd:()=>(0,r.jsxs)("div",Object.assign({className:"ui form"},{children:[(0,r.jsx)("p",{children:lf("You need to sign in with GitHub to use this feature.")}),(0,r.jsx)("p",{children:lf("You can host your code on GitHub and collaborate with friends on projects.")}),(0,r.jsx)("div",{children:(0,r.jsx)(i.PlainCheckbox,{label:lf("Remember me"),onChange:a})}),!n&&(0,r.jsxs)("p",Object.assign({className:"ui small"},{children:[lf("Looking to use a Developer token instead?"),(0,r.jsx)(i.Link,{className:"link",text:lf("Use Developer token"),onClick:l,href:"#"})]})),n&&(0,r.jsxs)("ol",{children:[(0,r.jsxs)("li",{children:[lf("Navigate to: "),(0,r.jsx)("a",Object.assign({href:"https://github.com/settings/tokens/new",target:"_blank",rel:"noopener noreferrer"},{children:lf("GitHub token generation page")}))]}),(0,r.jsx)("li",{children:lf("Put something like 'MakeCode {0}' in description",pxt.appTarget.name)}),(0,r.jsx)("li",{children:lf("Select either '{0}' or '{1}' scope, depending which repos you want to edit from here","repo","public_repo")}),(0,r.jsx)("li",{children:lf("Click generate token, copy it, and paste it below.")})]}),n&&(0,r.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,r.jsx)("label",Object.assign({id:"selectUrlToOpenLabel"},{children:lf("Paste GitHub token here:")})),(0,r.jsx)("input",{id:"githubTokenInput",type:"url",tabIndex:0,autoFocus:!0,"aria-labelledby":"selectUrlToOpenLabel",placeholder:"ghp_ABC...",className:"ui blue fluid"})]}))]}))}).then((r=>{var i;if(r){if(n){const e=t.querySelector("#githubTokenInput"),n=null===(i=null==e?void 0:e.value)||void 0===i?void 0:i.trim();return this.saveAndValidateTokenAsync(n,s)}return this.oauthRedirectAsync(s,e)}return pxt.tickEvent("github.login.cancel"),Promise.resolve()}));function l(){n=!0,o.forceUpdate()}}authorizeAppAsync(e,t){return this.oauthRedirectAsync(e,t||window.location.hash,!0)}oauthRedirectAsync(e,t,n){o.showLoading("ghlogin",lf("Signing you into GitHub...")),t=(t||"").replace(/^#/,"");const r=s.setOauth(this.name,e,t?`#github:${t}`:void 0),i=window.location.href.replace(/#.*/,""),a=pxt.Cloud.getServiceUrl()+"/oauth/login?state="+r+(n?"&prompt=consent":"")+"&response_type=token&client_id=gh-token&redirect_uri="+encodeURIComponent(i);return window.location.href=a,pxt.Util.delay(1e3)}getUserInfoAsync(){return this.token()?pxt.github.authenticatedUserAsync().then((e=>{if(e)return{id:e.login,userName:e.login,name:e.name,photo:e.avatar_url,profile:`https://github.com/${e.login}`};pxt.log("unknown github user")})):Promise.resolve(void 0)}setNewToken(e,t){super.setNewToken(e,t),pxt.github.token=e}saveAndValidateTokenAsync(e,t){return o.showLoading("githubtokensave",lf("validating GitHub token...")),Promise.resolve().then((()=>(pxt.github.token=e,pxt.github.createRepoAsync(void 0,"").then((n=>{pxt.reportError("github","Succeeded creating undefined repo!"),o.infoNotification(lf("Something went wrong with validation; token stored")),this.setNewToken(e,t),pxt.tickEvent("github.token.wrong")}),(n=>{pxt.github.token="",a.showGithubTokenError(n)||(422==n.statusCode?o.infoNotification(lf("Token validated and stored")):o.infoNotification(lf("Token stored but not validated")),this.setNewToken(e,t),pxt.tickEvent("github.token.ok"))})).then((()=>s.syncAsync()))))).finally((()=>o.hideLoading("githubtokensave")))}async createRepositoryAsync(e,t){if(pxt.tickEvent("github.filelist.create.start"),await this.routedLoginAsync(`create-repository:${t.id}`),!this.token())return pxt.tickEvent("github.filelist.create.notoken"),!1;const n=await a.showCreateGithubRepoDialogAsync(e);if(!n)return!1;pxt.tickEvent("github.filelist.create.export");const r=pxt.github.parseRepoId(n);o.showLoading("creategithub",lf("preparing {0} repository...",r.project||r.fullName));try{return await l.exportToGithubAsync(t,n),!0}finally{o.hideLoading("creategithub")}}}n.GithubProvider=c},{"./cloudsync":55,"./core":133,"./dialogs":143,"./sui":200,"./workspace":208,"react/jsx-runtime":367}],155:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Editor=void 0;const r=e("react/jsx-runtime"),i=e("./package"),o=e("./core"),s=e("./srceditor"),a=e("./sui"),l=e("./workspace"),c=e("./dialogs"),u=e("./coretsx"),d=e("./data"),p=e("./marked"),h=e("./compiler"),f=e("./cloudsync"),g=e("./tutorial"),m=e("./package"),v=e("./util");class y extends d.Component{constructor(e){super(e),this.diffCache={},this.goBack=this.goBack.bind(this),this.handlePullClick=this.handlePullClick.bind(this),this.handleBranchClick=this.handleBranchClick.bind(this),this.handleGithubError=this.handleGithubError.bind(this),this.handlePullRequest=this.handlePullRequest.bind(this)}clearCacheDiff(e,t){t?delete this.diffCache[e+t.name]:this.diffCache={}}cachedDiff(e,t){let n=this.diffCache[e+t.name];return n&&n.file.file===t.file||(n={file:t},this.diffCache[e+t.name]=n),n}fastForwardMergeAsync(e,t,n){return n=n||t.title||lf("Merge pull request"),o.showLoading("github.merge",lf("merging pull request...")),pxt.github.mergeAsync(e.fullName,t.base,e.tag,`${n} (#${t.number})`).then((()=>this.switchProjectToBranchAsync(t.base))).then((()=>this.pullAsync())).then((()=>{o.hideLoading("github.merge"),o.infoNotification("Pull request merged successfully!")})).then((()=>this.handleGithubError)).finally((()=>o.hideLoading("github.merge"))).then((()=>{}))}async revertAllFilesAsync(){if(pxt.tickEvent("github.revertall",{start:1},{interactiveConsent:!0}),!await o.confirmAsync({header:lf("Would you like to revert all local changes?"),body:lf("Changes will be lost for good. No undo."),agreeLbl:lf("Revert"),agreeClass:"red",agreeIcon:"trash"}))return;pxt.tickEvent("github.revertall",{ok:1}),this.setState({needsCommitMessage:!1});const{header:e}=this.props.parent.state;await l.revertAllAsync(e),await this.props.parent.reloadHeaderAsync()}async revertFileAsync(e,t,n,r){if(pxt.tickEvent("github.revert",{start:1},{interactiveConsent:!0}),!await o.confirmAsync({header:lf("Would you like to revert changes to {0}?",e.name),body:lf("Changes will be lost for good. No undo."),agreeLbl:lf("Revert"),agreeClass:"red",agreeIcon:"trash"}))return;pxt.tickEvent("github.revert",{ok:1}),this.setState({needsCommitMessage:!1});let s=!1;const a=i.mainEditorPkg();if(null==e.gitFile){s=!0,await a.removeFileAsync(e.name);for(const e of r)await a.removeFileAsync(e.name)}else if(e.name==pxt.CONFIG_NAME){s=!0;const r=this.getGitJson(),i=this.parsedRepoId();for(let e of t){const t=pxt.github.lookupFile(i,r.commit,e);a.setFile(e,t&&t.blobContent||"// Cannot restore.")}for(let e of n)delete a.files[e];await e.file.setContentAsync(e.gitFile)}else{await e.file.setContentAsync(e.gitFile),a.files;for(const e of r)null==e.baseGitContent?(s=!0,await a.removeFileAsync(e.name)):await e.setContentAsync(e.baseGitContent)}s?await this.props.parent.reloadHeaderAsync():this.forceUpdate()}async saveGitJsonAsync(e){const t=i.mainEditorPkg().files[pxt.github.GIT_JSON];await t.setContentAsync(JSON.stringify(e,null,4))}async switchProjectToBranchAsync(e){const{header:t}=this.props.parent.state,n=this.getGitJson(),r=this.parsedRepoId();t.githubId=r.fullName+"#"+e,n.repo=t.githubId,await this.saveGitJsonAsync(n),i.invalidatePullRequestStatus(t)}async newBranchAsync(){await f.ensureGitHubTokenAsync();const e=this.parsedRepoId(),t=await pxt.github.getNewBranchNameAsync(e.slug,"patch-"),n=await o.promptAsync({header:lf("New branch name"),body:lf("Name cannot have spaces or special characters. Examples: {0}","my_feature, add-colors, fix_something"),agreeLbl:lf("Create"),initialValue:t,hasCloseIcon:!0,onInputValidation:e=>{if(/[^\w\-]/.test(e))return lf("Don't use spaces or special characters.")}});if(n){this.showLoading("github.branch",!0,lf("creating branch..."));try{const t=this.getGitJson();await pxt.github.createNewBranchAsync(e.slug,n,t.commit.sha),await this.switchProjectToBranchAsync(n),this.forceUpdate()}catch(e){this.handleGithubError(e)}finally{this.hideLoading()}}}async switchBranchAsync(e){await this.setStateAsync({needsCommitMessage:!1});const t=this.parsedRepoId().tag;try{await this.switchProjectToBranchAsync(e),await this.pullAsync()}finally{this.state.needsCommitMessage&&await this.switchProjectToBranchAsync(t)}}async showSwitchBranchDialogAsync(){const e=this.parsedRepoId(),t=await pxt.github.listRefsExtAsync(e.slug,"heads"),n=Object.keys(t.refs).map((e=>({name:e,description:t.refs[e],onClick:async()=>{o.hideDialog(),await this.switchBranchAsync(e)}})));"master"==e.tag&&n.unshift({name:lf("Create new branch"),description:lf("Based on {0}",e.tag),onClick:()=>(o.hideDialog(),this.newBranchAsync())}),await o.confirmAsync({header:lf("Switch to a different branch"),hasCloseIcon:!0,hideAgree:!0,jsx:(0,r.jsx)("div",Object.assign({className:"ui form"},{children:(0,r.jsx)("div",Object.assign({className:"ui relaxed divided list",role:"menu"},{children:n.map((e=>(0,r.jsxs)("div",Object.assign({className:"item link"},{children:[(0,r.jsx)("i",{className:"large github middle aligned icon"}),(0,r.jsxs)("div",Object.assign({className:"content"},{children:[(0,r.jsx)("a",Object.assign({onClick:e.onClick,role:"menuitem",className:"header",tabIndex:0,onKeyDown:v.fireClickOnEnter},{children:e.name})),(0,r.jsx)("div",Object.assign({className:"description"},{children:e.description}))]}))]}),e.name)))}))}))})}handleBranchClick(e){pxt.tickEvent("github.branch"),e.stopPropagation(),this.showSwitchBranchDialogAsync()}goBack(){pxt.tickEvent("github.backButton",void 0,{interactiveConsent:!0}),this.props.parent.openPreviousEditor()}handlePullClick(e){pxt.tickEvent("github.pull"),this.pullAsync()}async forkAsync(e){const t=this.parsedRepoId(),n=f.githubProvider().user();let i,s=!1;const l=e=>{s=e,o.forceUpdate()},c=()=>{pxt.tickEvent("github.authorize"),f.githubProvider().authorizeAppAsync(s)};e&&n&&t.owner!==n.userName&&await pxt.github.isOrgAsync(t.owner)&&(i=(0,r.jsxs)("div",Object.assign({className:"ui small"},{children:[lf("If you already have write permissions to this repository, you may have to authorize the MakeCode App in the {0} organization.",t.owner),(0,r.jsx)(a.PlainCheckbox,{label:lf("Remember me"),onChange:l}),(0,r.jsx)(a.Link,{className:"ui link",text:lf("Authorize MakeCode"),onClick:c,onKeyDown:v.fireClickOnEnter})]})));const u=e&&(0,r.jsxs)("div",Object.assign({className:"ui message warning"},{children:[lf("Oops, we could not write to {0}.",t.slug),i]})),d=(0,r.jsx)("p",{children:lf("Forking creates a copy of {0} under your account. You can submit your changes back via a pull request.",t.slug)});if(await o.confirmAsync({header:lf("Do you want to fork {0}?",t.slug),hasCloseIcon:!0,helpUrl:"/github/fork",jsx:(0,r.jsxs)("div",{children:[u,d]}),agreeLbl:"Fork",agreeIcon:"copy outline"})){this.showLoading("github.fork",!0,lf("forking repository (this may take a minute or two)..."));try{const e=this.getGitJson(),n=await pxt.github.forkRepoAsync(t.slug,e.commit.sha),{header:r}=this.props.parent.state;r.githubId=n,e.repo=r.githubId,await this.saveGitJsonAsync(e)}catch(e){this.handleGithubError(e)}finally{this.hideLoading()}}}handleGithubError(e){const t=parseInt(e.statusCode);e.isOffline||0===t?o.warningNotification(lf("Please connect to internet and try again.")):e.needsWritePermission?(o.hideDialog(),this.forkAsync(!0)):e.isMergeConflictMarkerError?(pxt.tickEvent("github.commitwithconflicts"),o.warningNotification(lf("Please merge all conflicts before commiting changes."))):401==t?(f.githubProvider().clearToken(),this.forceUpdate(),o.warningNotification(lf("Please sign in to GitHub again."))):404==t?o.warningNotification(lf("GitHub resource not found; please check that it still exists.")):403==t?o.warningNotification(lf("GitHub rate limit exceeded, please wait and try again.")):(pxt.reportException(e),o.warningNotification(lf("Oops, something went wrong. Please try again.")))}async bumpAsync(){try{l.prepareConfigForGithub(i.mainPkg.readFile(pxt.CONFIG_NAME),!0)}catch(e){return void o.warningNotification(e.message)}let e=i.mainPkg.config.version;try{const t=this.parsedRepoId(),n=await pxt.github.listRefsAsync(t.slug,"tags");e=pxt.semver.sortLatestTags(n)[0]}catch(e){console.log(e)}const t=pxt.semver.parse(e,"0.0.0"),n=pxt.semver.parse(pxt.semver.stringify(t));n.major++,n.minor=0,n.patch=0;const s=pxt.semver.parse(pxt.semver.stringify(t));s.minor++,s.patch=0;const c=pxt.semver.parse(pxt.semver.stringify(t));c.patch++;let d="patch";function p(e){d=e.currentTarget.name,u.forceUpdate()}let h=!1;function f(e){h=!h,u.forceUpdate()}if(!await o.confirmAsync({header:lf("Pick a release version"),agreeLbl:lf("Create release"),disagreeLbl:lf("Cancel"),jsxd:()=>(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",Object.assign({className:"grouped fields"},{children:[(0,r.jsxs)("label",{children:[lf("Choose a release version that describes the changes you made to the code."),a.helpIconLink("/github/release#versioning",lf("Learn about version numbers."))]}),(0,r.jsx)("div",Object.assign({className:"field"},{children:(0,r.jsxs)("div",Object.assign({className:"ui radio checkbox"},{children:[(0,r.jsx)("input",{type:"radio",name:"patch",checked:"patch"==d,"aria-checked":"patch"==d,onChange:p}),(0,r.jsx)("label",{children:lf("{0}: patch (bug fixes or other non-user visible changes)",pxt.semver.stringify(c))})]}))})),(0,r.jsx)("div",Object.assign({className:"field"},{children:(0,r.jsxs)("div",Object.assign({className:"ui radio checkbox"},{children:[(0,r.jsx)("input",{type:"radio",name:"minor",checked:"minor"==d,"aria-checked":"minor"==d,onChange:p}),(0,r.jsx)("label",{children:lf("{0}: minor change (added function or optional parameters)",pxt.semver.stringify(s))})]}))})),(0,r.jsx)("div",Object.assign({className:"field"},{children:(0,r.jsxs)("div",Object.assign({className:"ui radio checkbox"},{children:[(0,r.jsx)("input",{type:"radio",name:"major",checked:"major"==d,"aria-checked":"major"==d,onChange:p}),(0,r.jsx)("label",{children:lf("{0}: major change (renamed functions, deleted parameters or functions)",pxt.semver.stringify(n))})]}))}))]})),(0,r.jsxs)("div",Object.assign({className:"grouped fields"},{children:[(0,r.jsx)("label",{children:lf("Advanced")}),(0,r.jsxs)("div",Object.assign({className:"field checkbox"},{children:[(0,r.jsx)("input",{type:"checkbox",name:"cachetutorial",checked:h,"aria-checked":h,onChange:f}),(0,r.jsx)("label",{children:lf("Optimize for tutorials by caching information about the markdown.")})]}))]}))]})}))return;let g=c;"major"==d?g=n:"minor"==d&&(g=s);const m=pxt.semver.stringify(g);this.showLoading("github.release.new",!0,lf("creating release..."));try{const{header:e}=this.props.parent.state;h&&await this.cacheTutorialInfo(e),await l.bumpAsync(e,m),i.mainPkg.config.version=m,await this.maybeReloadAsync(),this.hideLoading(),o.infoNotification(lf("GitHub release created."))}catch(e){this.handleGithubError(e)}finally{this.hideLoading()}}async cacheTutorialInfo(e){const t=/\.md$/,n=this.parsedRepoId();let r=await l.getTextAsync(e.id),i=Object.keys(r).filter((e=>e.match(t)));const o={};for(let e of i){const i=pxt.tutorial.parseTutorial(r[e]),s=pxt.BrowserUtils.getTutorialCodeHash(i.code),a=await g.getUsedBlocksAsync(i.code,e,i.language,!0);if(a){const r=e.replace(t,"");o[`https://github.com/${n.fullName}${"README"==r?"":"/"+r}`]={snippetBlocks:a.snippetBlocks,usedBlocks:a.usedBlocks,highlightBlocks:a.highlightBlocks,hash:s}}}r[pxt.TUTORIAL_INFO_FILE]=JSON.stringify(o);let s=pxt.Package.parseAndValidConfig(r[pxt.CONFIG_NAME]);return s.files.indexOf(pxt.TUTORIAL_INFO_FILE)<0&&(s.files.push(pxt.TUTORIAL_INFO_FILE),r[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(s)),await l.saveAsync(e,r),await this.commitAsync()}async showLoading(e,t,n){t&&await f.ensureGitHubTokenAsync(),pxt.tickEvent(e),await this.setStateAsync({loadingMessage:n}),o.showLoading("githubjson",n)}hideLoading(){this.state.loadingMessage&&(o.hideLoading("githubjson"),this.setState({loadingMessage:void 0}))}pkgConfigKey(e){const t=JSON.parse(e);return delete t.version,JSON.stringify(t)}async maybeReloadAsync(){const{header:e}=this.props.parent.state,t=await l.getTextAsync(e.id);i.mainEditorPkg().setFiles(t);const n=this.pkgConfigKey(t[pxt.CONFIG_NAME]);m.invalidatePullStatus(e),n!=this.state.previousCfgKey&&(await this.setStateAsync({previousCfgKey:n}),await this.props.parent.reloadHeaderAsync())}async pullAsync(){this.showLoading("github.pull",!1,lf("pulling changes from GitHub..."));const{header:e}=this.props.parent.state;try{switch(await l.pullAsync(this.props.parent.state.header)){case l.PullStatus.NoSourceControl:case l.PullStatus.UpToDate:break;case l.PullStatus.NeedsCommit:this.setState({needsCommitMessage:!0});break;case l.PullStatus.GotChanges:await this.maybeReloadAsync()}}catch(e){this.handleGithubError(e)}finally{m.invalidatePullStatus(e),this.hideLoading()}}getGitJson(){return i.mainPkg.readGitJson()}parsedRepoId(){const e=this.props.parent.state.header;return pxt.github.parseRepoId(e.githubId)}async commitCoreAsync(){const{parent:e}=this.props,{header:t}=e.state,n=t.githubId;if(await l.pullAsync(t),await l.hasMergeConflictMarkersAsync(t))return await this.maybeReloadAsync(),void o.warningNotification(lf("Merge conflicts found. Resolve them before commiting."));let r=await l.commitAsync(t,{message:this.state.description,blocksScreenshotAsync:()=>{var e;return this.props.parent.blocksScreenshotAsync(1,null===(e=pxt.appTarget.appTheme)||void 0===e?void 0:e.embedBlocksInSnapshot)},blocksDiffScreenshotAsync:()=>{const e=i.mainEditorPkg().sortedFiles().find((e=>e.name==pxt.MAIN_BLOCKS)),t=pxt.blocks.diffXml(e.baseGitContent,e.content);return t&&t.ws?pxt.blocks.layout.toPngAsync(t.ws,1):Promise.resolve(void 0)}});if(r){let e=await l.prAsync(t,r,this.state.description||lf("Commit conflict"));await c.showPRDialogAsync(n,e),await l.pullAsync(t)}else i.invalidatePagesStatus(t),i.invalidatePullRequestStatus(t),await this.maybeReloadAsync();this.setState({description:""})}async commitAsync(){let e=!0;this.setState({needsCommitMessage:!1}),this.showLoading("github.commit",!0,lf("commit and push changes to GitHub..."));try{await this.commitCoreAsync(),await this.maybeReloadAsync()}catch(t){e=!1,pxt.tickEvent("github.commit.fail"),this.handleGithubError(t)}finally{e&&pxt.tickEvent("github.commit.success"),this.hideLoading()}}setVisible(e){if(e===this.state.isVisible)return;const{header:t}=this.props.parent.state;e?(d.invalidateHeader("pkg-git-pr",t),this.setState({previousCfgKey:this.pkgConfigKey(i.mainEditorPkg().files[pxt.CONFIG_NAME].content)})):(this.clearCacheDiff(),this.setState({needsCommitMessage:!1}))}async handlePullRequest(){const e=this.parsedRepoId();if(!await o.confirmAsync({header:lf("Create pull request"),jsx:(0,r.jsx)("p",{children:lf("Pull requests let you tell others about changes you've pushed to a branch in a repository on GitHub.")}),helpUrl:"/github/pull-request",hasCloseIcon:!0}))return;const t=e.tag;this.showLoading("github.createpr",!0,lf("creating pull request..."));try{const e=this.parsedRepoId(),n=`\n### ${lf("How to use this pull request")}\n\n- [ ] ${lf("assign a reviewer (you can be your own reviewer)")}\n- [ ] ${lf("reviewer approves or requests changes")}\n- [ ] ${lf("apply requested changes if any")}\n- [ ] ${lf("merge once approved")}\n`,r=await pxt.github.createPRFromBranchAsync(e.slug,"master",e.tag,t,n);d.invalidateHeader("pkg-git-pr",this.props.parent.state.header),o.infoNotification(lf("Pull request created successfully!",r))}catch(e){422==e.statusCode?o.warningNotification(lf("Please commit changes before creating a pull request.")):this.handleGithubError(e)}finally{this.hideLoading()}}computeDiffFiles(){const e=i.mainEditorPkg().sortedFiles();return e.map((t=>{const n=t.publishedContent();if(t.baseGitContent!=n){const r={file:t,name:t.name,gitFile:t.baseGitContent,editorFile:n};if(/\.blocks$/.test(t.name)){const n=t.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME),i=e.find((e=>e.name==n));i&&(r.tsGitFile=i.baseGitContent,r.tsEditorFile=i.publishedContent())}return r}})).filter((e=>!!e))}renderCore(){const e=this.getGitJson();if(!e)return(0,r.jsx)("div",{});const{header:t}=this.props.parent.state,n=i.mainPkg.getPreferredEditor()==pxt.BLOCKS_PROJECT_NAME,o=this.computeDiffFiles(),s=o.length>0,c=this.getData("pkg-git-pull-status:"+t.id),u=c==l.PullStatus.BranchNotFound||c==l.PullStatus.NoSourceControl,d=c==l.PullStatus.GotChanges,p=this.parsedRepoId(),h="master"==p.tag,f=this.getData("github:user"),g=`https://github.com/${p.slug}/${h&&!p.fileName?"":pxt.github.join("tree",p.tag||"master",p.fileName)}`,m=!pxt.github.token,y=this.getData("pkg-git-pr:"+t.id),T=null!==y&&(e.isFork||!h),C=T&&y&&y.number>0,A=T&&y&&y.number<=0,j=f&&f.id===p.owner;return(0,r.jsxs)("div",Object.assign({id:"githubArea"},{children:[(0,r.jsxs)("div",Object.assign({className:"ui serialHeader"},{children:[(0,r.jsx)("div",Object.assign({className:"leftHeaderWrapper"},{children:(0,r.jsx)("div",Object.assign({className:"leftHeader"},{children:(0,r.jsx)(a.Button,{title:lf("Go back"),icon:"arrow left",text:lf("Go back"),textClass:"landscape only",tabIndex:0,onClick:this.goBack,onKeyDown:v.fireClickOnEnter})}))})),(0,r.jsxs)("div",Object.assign({className:"rightHeader"},{children:[(0,r.jsx)(a.Button,{icon:""+(u?"exclamation circle":d?"long arrow alternate down":"check"),className:!0===d?"positive":"",text:lf("Pull changes"),title:lf("Pull changes from GitHub to get your code up-to-date."),onClick:this.handlePullClick,onKeyDown:v.fireClickOnEnter}),!n&&j&&(0,r.jsx)(a.Link,{className:"ui item button desktop only",icon:"user plus",href:`https://github.com/${p.slug}/settings/collaboration`,target:"_blank",title:lf("Invite others to contributes to this GitHub repository.")}),(0,r.jsx)(a.Link,{className:"ui button",icon:"external alternate",href:g,title:lf("Open repository in GitHub."),target:"_blank",onKeyDown:v.fireClickOnEnter})]}))]})),(0,r.jsx)(x,{parent:this,needsToken:m,githubId:p,master:h,gs:e,isBlocks:n,needsCommit:s,user:f,pullStatus:c,pullRequest:y}),(0,r.jsxs)("div",Object.assign({className:"ui form"},{children:[C&&(0,r.jsx)(a.Link,{href:y.url,role:"button",className:"ui tiny basic button create-pr",target:"_blank",text:lf("Pull request (#{0})",y.number),icon:"external alternate"}),A&&(0,r.jsx)(a.Button,{className:"tiny basic create-pr",text:lf("Create pull request"),onClick:this.handlePullRequest}),(0,r.jsxs)("h3",Object.assign({className:"header"},{children:[(0,r.jsx)("i",{className:"large github icon"}),(0,r.jsx)("span",Object.assign({className:"repo-name"},{children:p.fullName})),(0,r.jsxs)("span",Object.assign({onClick:this.handleBranchClick,onKeyDown:v.fireClickOnEnter,tabIndex:0,role:"button",className:"repo-branch"},{children:["#"+p.tag,(0,r.jsx)("i",{className:"dropdown icon"})]}))]})),s&&(0,r.jsx)(E,{parent:this,needsToken:m,githubId:p,master:h,gs:e,isBlocks:n,needsCommit:s,user:f,pullStatus:c,pullRequest:y}),C&&!s&&(0,r.jsx)(_,{parent:this,needsToken:m,githubId:p,master:h,gs:e,isBlocks:n,needsCommit:s,user:f,pullStatus:c,pullRequest:y}),o&&(0,r.jsx)(b,{parent:this,diffFiles:o,cacheKey:e.commit.sha,allowRevert:!0,showWhitespaceDiff:!0,blocksMode:n,showConflicts:!0}),(0,r.jsx)(k,{parent:this,needsToken:m,githubId:p,master:h,gs:e,isBlocks:n,needsCommit:s,user:f,pullStatus:c,pullRequest:y}),h&&(0,r.jsx)(w,{parent:this,needsToken:m,githubId:p,master:h,gs:e,isBlocks:n,needsCommit:s,user:f,pullStatus:c,pullRequest:y}),!n&&(0,r.jsx)(S,{parent:this,needsToken:m,githubId:p,master:h,gs:e,isBlocks:n,needsCommit:s,user:f,pullStatus:c,pullRequest:y}),(0,r.jsx)("div",{})]}))]}))}}class b extends a.StatelessUIElement{constructor(e){super(e),this.revertAllFiles=this.revertAllFiles.bind(this)}lineDiff(e,t){const n=pxt.diff.compute(e.split("").join("\n"),t.split("").join("\n"),{context:1/0});if(!n)return{a:(0,r.jsx)("div",Object.assign({className:"inline-diff"},{children:(0,r.jsx)("code",{children:e})})),b:(0,r.jsx)("div",Object.assign({className:"inline-diff"},{children:(0,r.jsx)("code",{children:t})}))};const i=[],o=[];for(let e=0;e<n.length;){let t=e;const s=n[e][0];for(;n[t]&&n[t][0]==s;)t++;const a=n.slice(e,t).map((e=>e.slice(2))).join("");" "==s?(i.push((0,r.jsx)("code",Object.assign({className:"ch-common"},{children:a}),e)),o.push((0,r.jsx)("code",Object.assign({className:"ch-common"},{children:a}),e))):"-"==s?i.push((0,r.jsx)("code",Object.assign({className:"ch-removed"},{children:a}),e)):"+"==s?o.push((0,r.jsx)("code",Object.assign({className:"ch-added"},{children:a}),e)):pxt.Util.oops(),e=t}return{a:(0,r.jsx)("div",Object.assign({className:"inline-diff"},{children:i})),b:(0,r.jsx)("div",Object.assign({className:"inline-diff"},{children:o}))}}showDiff(e){const{cacheKey:t,blocksMode:n,showConflicts:o,showWhitespaceDiff:s}=this.props,l=this.props.parent.cachedDiff(t,e);if(l.diff&&l.file.gitFile==e.gitFile&&l.file.editorFile==e.editorFile)return l.diff;const c=/\.blocks$/.test(e.name),u=()=>{l.whitespace||(l.whitespace=!0,l.diff=d(),this.forceUpdate())},d=()=>{let i;return i=c?this.createBlocksDiffJSX(e):this.createTextDiffJSX(e,!l.whitespace),(0,r.jsxs)("div",Object.assign({className:"ui segments filediff"},{children:[(0,r.jsxs)("div",Object.assign({className:"ui segment diffheader"},{children:[(!n||e.name!=pxt.MAIN_BLOCKS)&&(0,r.jsx)("span",{children:e.name}),!!l.revert&&(0,r.jsx)(a.Button,{className:"small",icon:"undo",text:lf("Revert"),ariaLabel:lf("Revert file"),title:lf("Revert file"),textClass:"landscape only",onClick:l.revert}),i.legendJSX,o&&!!i.conflicts&&(0,r.jsx)("p",{children:lf("Merge conflicts found. Resolve them before commiting.")}),!!l.revert&&!!p.length&&(0,r.jsx)("p",{children:lf("Reverting this file will also restore: {0}",p.join(", "))}),!!l.revert&&!!h.length&&(0,r.jsx)("p",{children:lf("Reverting this file will also remove: {0}",h.join(", "))}),!!l.revert&&!!f.length&&!n&&(0,r.jsx)("p",{children:lf("Reverting this file will also revert: {0}",f.map((e=>e.name)).join(", "))})]})),i.diffJSX?(0,r.jsx)("div",Object.assign({className:"ui segment diff"},{children:i.diffJSX})):(0,r.jsx)("div",Object.assign({className:"ui segment"},{children:(0,r.jsxs)("p",{children:[lf("Whitespace changes only."),s&&(0,r.jsx)(a.Link,{className:"link",text:lf("Show"),onClick:u})]})}))]}),`difffile${t}${e.name}`)};let p=[],h=[];if(e.name==pxt.CONFIG_NAME){const t=pxt.Package.parseAndValidConfig(e.gitFile),n=pxt.Package.parseAndValidConfig(e.editorFile);if(t&&n){const e=pxt.allPkgFiles(t),r=pxt.allPkgFiles(n);p=e.filter((e=>-1==r.indexOf(e))),h=r.filter((t=>-1==e.indexOf(t)))}}const f=[];if(l.file=e,this.props.allowRevert){const t=i.mainEditorPkg().files,r=n&&t[e.file.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME)];r&&r!=e.file&&f.push(r);for(const t of i.mainEditorPkg().getGeneratedFiles(e.file))f.push(t);l.revert=()=>this.props.parent.revertFileAsync(e,p,h,f)}return l.diff=d(),l.diff}createBlocksDiffJSX(e){const t=e.gitFile||"",n=e.editorFile;let i;if(n){let o;o=e.tsEditorFile&&pxt.blocks.needsDecompiledDiff(t,n)?`\n\`\`\`diffblocks\n${e.tsGitFile||""}\n---------------------\n${e.tsEditorFile}\n\`\`\`\n`:`\n\`\`\`diffblocksxml\n${t}\n---------------------\n${n}\n\`\`\`\n`,i=(0,r.jsx)(p.MarkedContent,{parent:this.props.parent.props.parent,markdown:o},`diffblocksxxml${e.name}`)}else i=(0,r.jsx)("div",Object.assign({className:"ui basic segment"},{children:lf("Your blocks were updated. Go back to the editor to view the changes.")}));return{diffJSX:i,legendJSX:(0,r.jsxs)("p",Object.assign({className:"legend"},{children:[(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"added icon"}),lf("added, changed or moved")]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"deleted icon"}),lf("deleted")]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"notchanged icon"}),lf("not changed")]}),a.helpIconLink("/github/diff#blocks",lf("Learn about reading differences in blocks code."))]})),conflicts:0}}createTextDiffJSX(e,t){const{showConflicts:n}=this.props,i=e.gitFile||"",o=e.editorFile||"",s={"@":"diff-marker"," ":"diff-unchanged","+":"diff-added","-":"diff-removed"},l=pxt.diff.compute(i,o,{ignoreWhitespace:!!t});if(!l)return pxt.tickEvent("github.diff.toobig"),{diffJSX:(0,r.jsx)("div",{children:lf("Too many differences to render diff.")}),conflicts:0};let c=0,u="",d=0,p=0,h="",f=null;const g=[];return l.forEach(((t,i)=>{const o=/^@@ -(\d+),\d+ \+(\d+),\d+/.exec(t);o?(d=parseInt(o[1])-1,p=parseInt(o[2])-1):("+"!=t[0]&&d++,"-"!=t[0]&&p++);const m=l[i+1]?l[i+1][0]:"",v=l[i+2]?l[i+2][0]:"",y=t.slice(2);let b=(0,r.jsx)("code",{children:y});if(f)b=f,f=null;else if(!("-"!=t[0]||" "!=h&&"@"!=h||"+"!=m||" "!=v&&"@"!=v&&""!=v)){const e=this.lineDiff(t.slice(2),l[i+1].slice(2));b=e.a,f=e.b}let x=h=t[0];if("+"==h&&/^<<<<<<<[^<]/.test(y)){c++,u="local",x="@",g.push((0,r.jsx)("tr",Object.assign({className:"conflict ui small header"},{children:(0,r.jsx)("td",Object.assign({colSpan:4,className:"ui small header"},{children:lf("Merge conflict")}))}),"conflictheader"+d+p)),g.push((0,r.jsx)("tr",Object.assign({className:"conflict ui description"},{children:(0,r.jsxs)("td",Object.assign({colSpan:4,className:"ui small description"},{children:[lf("Changes from GitHub are conflicting with local changes."),a.helpIconLink("/github/merge-conflict",lf("Learn about merge conflicts and resolution."))]}))}),"conflictdescr"+d+p));const t=Math.min(d,p),i=()=>this.handleMergeConflictResolution(e,t,!0,!1),o=()=>this.handleMergeConflictResolution(e,t,!1,!0),s=()=>this.handleMergeConflictResolution(e,t,!0,!0);n&&g.push((0,r.jsx)("tr",Object.assign({className:"conflict ui mergebtn"},{children:(0,r.jsxs)("td",Object.assign({colSpan:4,className:"ui"},{children:[(0,r.jsx)(a.Button,{className:"compact",text:lf("Keep local"),title:lf("Ignore the changes from GitHub."),onClick:i}),(0,r.jsx)(a.Button,{className:"compact",text:lf("Keep remote"),title:lf("Override local changes with changes from GitHub."),onClick:o}),(0,r.jsx)(a.Button,{className:"compact",text:lf("Keep both"),title:lf("Keep both local and remote changes."),onClick:s})]}))}),"merge"+d+p))}else"+"==h&&/^>>>>>>>[^>]/.test(y)?(u="footer",x="@"):"+"==h&&/^=======$/.test(y)&&(x="@",u="remote");const E="@"==x,_=`${u?"conflict":""} ${u} ${s[x]}`;g.push((0,r.jsxs)("tr",Object.assign({className:_},{children:[(0,r.jsx)("td",{className:"line-a","data-content":d}),(0,r.jsx)("td",{className:"line-b","data-content":p}),E?(0,r.jsx)("td",Object.assign({colSpan:2,className:"change"},{children:(0,r.jsx)("code",{children:t})})):(0,r.jsx)("td",{className:"marker","data-content":x}),E?void 0:(0,r.jsx)("td",Object.assign({className:"change"},{children:b}))]}),d+p)),"footer"==u&&(u="")})),{diffJSX:g.length?(0,r.jsx)("table",Object.assign({className:"diffview"},{children:(0,r.jsx)("tbody",{children:g})})):void 0,legendJSX:void 0,conflicts:c}}handleMergeConflictResolution(e,t,n,r){pxt.tickEvent("github.conflict.resolve",{local:n?1:0,remote:r?1:0},{interactiveConsent:!0});const i=pxt.diff.resolveMergeConflictMarker(e.file.content,t,n,r);e.file.setContentAsync(i).then((()=>this.props.parent.clearCacheDiff(this.props.cacheKey,e))).then((()=>this.props.parent.forceUpdate()))}revertAllFiles(){this.props.parent.revertAllFilesAsync()}renderCore(){const{diffFiles:e,blocksMode:t,allowRevert:n}=this.props,i=pxt.appTarget.appTheme,o=i.invertedMenu&&i.invertedMonaco,s=t&&!pxt.options.debug?e.filter((e=>/\.blocks$/.test(e.name))):e;return e.length?(0,r.jsxs)("div",Object.assign({className:"ui section"},{children:[(0,r.jsxs)("div",Object.assign({className:`ui ${o?"inverted ":""} diffheader segment`},{children:[lf("There are local changes."),n&&(0,r.jsx)(a.Button,{className:"small",icon:"undo",text:lf("Revert all"),ariaLabel:lf("Revert all changes"),title:lf("Revert all changes"),textClass:"landscape only",onClick:this.revertAllFiles})]})),s.map((e=>this.showDiff(e)))]})):(0,r.jsx)("div",Object.assign({className:`ui ${o?"inverted ":""}segment`},{children:lf("No local changes found.")}))}}class x extends a.StatelessUIElement{constructor(e){super(e),this.handleSwitchMasterBranch=this.handleSwitchMasterBranch.bind(this)}handleSwitchMasterBranch(e){pxt.tickEvent("github.branch.switch"),e.stopPropagation(),this.props.parent.switchBranchAsync("master")}renderCore(){const{needsCommitMessage:e}=this.props.parent.state,{pullStatus:t,pullRequest:n,githubId:i}=this.props,o="CLOSED"==(null==n?void 0:n.state),s="MERGED"==(null==n?void 0:n.state);return o||s?(0,r.jsxs)("div",Object.assign({className:"ui icon negative message"},{children:[(0,r.jsx)("i",{className:"exclamation circle icon"}),(0,r.jsxs)("div",Object.assign({className:"content"},{children:[o&&lf("This Pull Request is closed!"),s&&lf("This pull request has been merged."),(0,r.jsx)("span",Object.assign({role:"button",className:"ui link",onClick:this.handleSwitchMasterBranch,onKeyDown:v.fireClickOnEnter},{children:lf("Switch to master branch")}))]}))]})):t==l.PullStatus.NoSourceControl?(0,r.jsxs)("div",Object.assign({className:"ui icon warning message"},{children:[(0,r.jsx)("i",{className:"exclamation circle icon"}),(0,r.jsxs)("div",Object.assign({className:"content"},{children:[lf("This repository was not found. It might have been deleted or you may not have rights to access it."),(0,r.jsx)(a.Link,{href:`https://github.com/${i.slug}`,text:lf("Go to GitHub")})]}))]})):t==l.PullStatus.BranchNotFound?(0,r.jsxs)("div",Object.assign({className:"ui icon warning message"},{children:[(0,r.jsx)("i",{className:"exclamation circle icon"}),(0,r.jsxs)("div",Object.assign({className:"content"},{children:[lf("This branch was not found, please pull again or switch to a different branch."),(0,r.jsx)("span",Object.assign({role:"button",className:"ui link",onClick:this.handleSwitchMasterBranch,onKeyDown:v.fireClickOnEnter},{children:lf("Switch to master branch")}))]}))]})):e?(0,r.jsx)("div",Object.assign({className:"ui warning message"},{children:(0,r.jsx)("div",Object.assign({className:"content"},{children:lf("You need to commit your changes before you can pull from GitHub.")}))})):(0,r.jsx)("div",{})}}class E extends a.StatelessUIElement{constructor(e){super(e),this.handleDescriptionChange=this.handleDescriptionChange.bind(this),this.handleCommitClick=this.handleCommitClick.bind(this)}handleDescriptionChange(e){this.props.parent.setState({description:e})}async handleCommitClick(e){pxt.tickEvent("github.commit"),e.stopPropagation(),await f.githubProvider().loginAsync(),pxt.github.token&&await this.props.parent.commitAsync()}renderCore(){const{description:e}=this.props.parent.state,t=e&&e.length>70?lf("Your description is getting long..."):void 0;return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",Object.assign({className:"ui field"},{children:(0,r.jsx)(a.Input,{type:"text",placeholder:lf("Describe your changes."),value:this.props.parent.state.description,onChange:this.handleDescriptionChange,error:t})})),(0,r.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,r.jsx)(a.Button,{className:"green",text:lf("Commit and push changes"),icon:"long arrow alternate up",onClick:this.handleCommitClick,onKeyDown:v.fireClickOnEnter}),(0,r.jsxs)("span",Object.assign({className:"inline-help"},{children:[lf("Save your changes in GitHub."),a.helpIconLink("/github/commit",lf("Learn about commiting and pushing code into GitHub."))]}))]}))]})}}class _ extends a.StatelessUIElement{constructor(e){super(e),this.scheduleRefreshPullRequestStatus=pxtc.Util.debounce((()=>{const e=this.props.parent.props.parent.state.header;e&&(i.invalidatePullRequestStatus(e),this.pullRequestStatus())}),1e4,!1),this.handleMergeClick=this.handleMergeClick.bind(this)}pullRequestStatus(){const e=this.props.parent.props.parent.state.header,t=this.props.parent.getData("pkg-git-pr:"+e.id);return"UNKNOWN"===(null==t?void 0:t.mergeable)&&"OPEN"===(null==t?void 0:t.state)&&this.scheduleRefreshPullRequestStatus(),t}handleMergeClick(e){pxt.tickEvent("github.pr.merge",null,{interactiveConsent:!0}),e.stopPropagation();const{githubId:t}=this.props,n=this.props.parent.props.parent.state.header,i=this.props.parent.getData("pkg-git-pr:"+n.id);o.promptAsync({header:lf("Squash and merge?"),jsx:(0,r.jsx)("p",{children:lf("Your changes will merged as a single commit into the base branch and you will switch back to the base branch.")}),agreeLbl:lf("Confirm merge"),helpUrl:"/github/pull-request",hasCloseIcon:!0,placeholder:lf("Describe your changes")}).then((e=>null===e?Promise.resolve():this.props.parent.fastForwardMergeAsync(t,i,e)))}renderCore(){const{gs:e,githubId:t}=this.props,n=this.pullRequestStatus(),i=!!e.mergeSha,o="MERGEABLE"===n.mergeable,s="OPEN"===n.state,l=s&&"UNKNOWN"===n.mergeable,c=i?"sync":o?"check":l?"circle outline":"exclamation triangle",u=i?"orange":o?"green":l?"orange":"grey",d=i?lf("A merge is in progress. Please resolve conflicts or cancel it"):o?lf("This branch has no conflicts with the base branch"):l?lf("Checking if your branch can be merged"):lf("This branch has conflicts that must be resolved");return s?(0,r.jsxs)("div",Object.assign({className:`ui ${u} segment`},{children:[(0,r.jsx)("div",Object.assign({className:"ui field"},{children:(0,r.jsxs)("div",Object.assign({className:"ui"},{children:[(0,r.jsx)("i",{className:`icon ${u} inverted circular ${c}`}),d]}))})),!o&&!l&&(0,r.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,r.jsx)(a.Link,{className:"button",text:lf("Resolve conflicts"),href:`https://github.com/${t.slug}/pull/${n.number}/conflicts`,target:"_blank"}),(0,r.jsxs)("span",Object.assign({className:"inline-help"},{children:[lf("Resolve merge conflicts in GitHub."),a.helpIconLink("/github/pull-requests",lf("Learn about merging pull requests in GitHub."))]}))]})),o&&(0,r.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,r.jsx)(a.Button,{className:u,text:lf("Squash and merge"),onClick:this.handleMergeClick,onKeyDown:v.fireClickOnEnter}),(0,r.jsxs)("span",Object.assign({className:"inline-help"},{children:[lf("Merge your changes as a single commit into the base branch."),a.helpIconLink("/github/pull-requests",lf("Learn about merging pull requests in GitHub."))]}))]}))]})):(0,r.jsx)("div",{})}}class w extends a.StatelessUIElement{constructor(e){super(e),this.scheduleRefreshPageStatus=pxtc.Util.debounce((()=>{const e=this.props.parent.props.parent.state.header;e&&(i.invalidatePagesStatus(e),this.pagesStatus())}),1e4,!1),this.handleBumpClick=this.handleBumpClick.bind(this)}handleBumpClick(e){pxt.tickEvent("github.releasezone.bump",void 0,{interactiveConsent:!0}),e.stopPropagation();const{needsCommit:t,master:n}=this.props,r=this.props.parent.props.parent.state.header;t?o.confirmAsync({header:lf("Commit your changes..."),body:lf("You need to commit your local changes to create a release."),agreeLbl:lf("Ok"),hideAgree:!0}):n?f.githubProvider().loginAsync().then((()=>pxt.github.token&&this.props.parent.bumpAsync())).finally((()=>i.invalidatePagesStatus(r))):o.confirmAsync({header:lf("Checkout the master branch..."),body:lf("You need to checkout the master branch to create a release."),agreeLbl:lf("Ok"),hideAgree:!0})}pagesStatus(){const e=this.props.parent.props.parent.state.header,t=this.props.parent.getData("pkg-git-pages:"+e.id);return t&&"building"==t.status&&this.scheduleRefreshPageStatus(),t}renderCore(){const{gs:e,needsCommit:t}=this.props,n=e.commit&&e.commit.tag,i=!!pxt.appTarget.appTheme.githubCompiledJs;if(t)return(0,r.jsx)("div",{});const o=this.pagesStatus(),s=o&&!!o.html_url,l=o&&"building"==o.status,c=!!pxt.appTarget.appTheme.invertedGitHub;return(0,r.jsxs)("div",Object.assign({className:`ui transparent ${c?"inverted":""} segment`},{children:[(0,r.jsx)("div",Object.assign({className:"ui header"},{children:lf("Release zone")})),!t&&!n&&(0,r.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,r.jsx)(a.Button,{className:"basic",text:lf("Create release"),inverted:c,onClick:this.handleBumpClick,onKeyDown:v.fireClickOnEnter}),(0,r.jsxs)("span",Object.assign({className:"inline-help"},{children:[lf("Snapshot and publish your code."),a.helpIconLink("/github/release",lf("Learn more about extension releases."))]}))]})),!t&&n&&(0,r.jsx)("div",Object.assign({className:"ui field"},{children:(0,r.jsxs)("p",Object.assign({className:"inline-help"},{children:[lf("Current release: {0}",n),a.helpIconLink("/github/release",lf("Learn about releases."))]}))})),s&&(0,r.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,r.jsx)(a.Link,{className:"basic button",href:o.html_url,inverted:c,loading:l,text:lf("Open Pages"),target:"_blank"}),(0,r.jsxs)("span",Object.assign({className:"inline-help"},{children:[l?lf("Pages building, it may take a few minutes."):i?lf("Commit & create release to update Pages."):lf("Commit to update Pages."),a.helpIconLink("/github/pages",lf("Learn about GitHub Pages."))]}))]}))]}))}}class S extends a.StatelessUIElement{constructor(e){super(e),this.handleForkClick=this.handleForkClick.bind(this),this.handleSaveClick=this.handleSaveClick.bind(this)}handleForkClick(e){pxt.tickEvent("github.extensionzone.fork",void 0,{interactiveConsent:!0}),e.stopPropagation(),this.props.parent.forkAsync(!1)}handleSaveClick(e){pxt.tickEvent("github.extensionzone.save",void 0,{interactiveConsent:!0}),e.stopPropagation(),this.props.parent.props.parent.saveAndCompile()}renderCore(){const{needsToken:e,githubId:t,gs:n,user:i}=this.props,o=this.props.parent.props.parent.state.header,s=!e&&n.commit&&!n.commit.tree.tree.some((e=>/^LICENSE/.test(e.path.toUpperCase())||/^COPYING/.test(e.path.toUpperCase()))),l=o&&`${window.location.href.replace(/#.*$/,"")}#testproject:${o.id}`,c=i&&i.id!=t.owner,u=!!pxt.appTarget.appTheme.invertedGitHub;return(0,r.jsxs)("div",Object.assign({className:`ui transparent ${u?"inverted":""} segment`},{children:[(0,r.jsx)("div",Object.assign({className:"ui header"},{children:lf("Extension zone")})),(0,r.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,r.jsx)(a.Link,{className:"basic button",href:l,inverted:u,text:lf("Test Extension"),target:`${pxt.appTarget.id}testproject`}),(0,r.jsxs)("span",Object.assign({className:"inline-help"},{children:[lf("Open a test project that uses this extension."),a.helpIconLink("/github/test-extension",lf("Learn about testing extensions."))]}))]})),c&&(0,r.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,r.jsx)(a.Button,{className:"basic",text:lf("Fork repository"),onClick:this.handleForkClick,inverted:u,onKeyDown:v.fireClickOnEnter}),(0,r.jsxs)("span",Object.assign({className:"inline-help"},{children:[lf("Fork your own copy of {0} to your account.",t.slug),a.helpIconLink("/github/fork",lf("Learn more about forking repositories."))]}))]})),s&&(0,r.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,r.jsx)(a.Link,{className:"basic button",href:`https://github.com/${t.slug}/community/license/new?branch=${t.tag}&template=mit`,inverted:u,text:lf("Add license"),target:"_blank"}),(0,r.jsxs)("span",Object.assign({className:"inline-help"},{children:[lf("Your project doesn't seem to have a license."),a.helpIconLink("/github/license",lf("Learn more about licenses."))]}))]})),(0,r.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,r.jsx)(a.Button,{className:"basic",text:lf("Save for offline"),onClick:this.handleSaveClick,inverted:u,onKeyDown:v.fireClickOnEnter}),(0,r.jsxs)("span",Object.assign({className:"inline-help"},{children:[lf("Export this extension to a file that can be imported without Internet."),a.helpIconLink("/github/offline",lf("Learn more about offline support for extensions."))]}))]}))]}))}}class T extends a.UIElement{constructor(e){super(e),this.handleRestore=this.handleRestore.bind(this)}loadDiffFilesAsync(){const{githubId:e,commit:t}=this.props;this.setState({loading:!0}),pxt.github.getCommitAsync(e.slug,t.sha).then((e=>this.computeDiffAsync(e))).then((e=>this.setState({diffFiles:e}))).finally((()=>this.setState({loading:!1})))}computeDiffAsync(e){const{githubId:t}=this.props,n=i.mainEditorPkg().sortedFiles(),r={};return Promise.all(n.map((n=>{const i=n.name;return pxt.github.lookupFile(t,e,i)?pxt.github.downloadTextAsync(t.fullName,e.sha,i).then((e=>{r[i]=e})):Promise.resolve()}))).then((()=>n.map((e=>{const t=e.name,i=r[t],o=/\.blocks$/.test(t),s=e.publishedContent();if(i===s)return;const a={file:e,name:e.name,gitFile:i,editorFile:s};if(o&&pxt.blocks.needsDecompiledDiff(i,s)){const t=e.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME),i=n.find((e=>e.name==t)),o=r[t];i&&o&&(a.tsEditorFile=i.publishedContent(),a.tsGitFile=o)}return a})))).then((e=>e.filter((e=>!!e))))}handleRestore(e){e.stopPropagation(),pxt.tickEvent("github.restore",void 0,{interactiveConsent:!0});const{commit:t}=this.props;return o.confirmAsync({header:lf("Would you like to restore this commit?"),body:lf("You will restore your project to the point in time when this commit was made. Don't worry, you can undo this action by restoring to the previous commit."),agreeLbl:lf("Restore"),agreeClass:"green"}).then((e=>{e&&(o.showLoading("github.restore",lf("restoring commit...")),l.restoreCommitAsync(this.props.parent.props.parent.state.header,t).then((()=>(d.invalidate("gh-commits:*"),this.props.parent.props.parent.reloadHeaderAsync()))).finally((()=>o.hideLoading("github.restore"))))})),!1}renderCore(){const{parent:e,commit:t,expanded:n,onClick:i}=this.props,{diffFiles:o,loading:s}=this.state,l=new Date(Date.parse(t.author.date));return!n||o||s||this.loadDiffFilesAsync(),(0,r.jsx)("div",Object.assign({className:"ui item link",role:"button",onClick:i,onKeyDown:v.fireClickOnEnter},{children:(0,r.jsxs)("div",Object.assign({className:"content"},{children:[n&&(0,r.jsx)(a.Button,{loading:s,className:"right floated",text:lf("Restore"),onClick:this.handleRestore,onKeyDown:v.fireClickOnEnter}),(0,r.jsx)("div",Object.assign({className:"meta"},{children:(0,r.jsx)("span",{children:l.toLocaleTimeString()})})),(0,r.jsx)("div",Object.assign({className:"description"},{children:t.message})),n&&o&&(0,r.jsx)("div",Object.assign({className:"ui inverted segment"},{children:lf("Comparing selected commit with local files")})),n&&o&&(0,r.jsx)(b,{parent:e,blocksMode:!1,diffFiles:o,cacheKey:t.sha})]}))}))}}class k extends a.UIElement{constructor(e){super(e),this.handleLoadClick=this.handleLoadClick.bind(this)}handleLoadClick(){pxt.tickEvent("github.history.load",void 0,{interactiveConsent:!0});const{expanded:e}=this.state;this.setState({expanded:!e,selectedCommit:void 0,selectedDay:void 0})}renderCore(){const{githubId:e,gs:t,parent:n}=this.props,{selectedCommit:i,expanded:o,selectedDay:s}=this.state,l=!!pxt.appTarget.appTheme.invertedGitHub,c=o&&this.getData(`gh-commits:${e.slug}#${t.commit.sha}`),u=o&&!c,d={};return c&&c.forEach((e=>{const t=new Date(Date.parse(e.author.date)).toLocaleDateString();let n=d[t];n||(n=d[t]=[]),n.push(e)})),(0,r.jsxs)("div",Object.assign({className:`ui transparent ${l?"inverted":""} segment`},{children:[(0,r.jsx)("div",Object.assign({className:"ui header"},{children:lf("History")})),(u||!o)&&(0,r.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,r.jsx)(a.Button,{loading:u,className:"basic",text:lf("View commits"),onClick:this.handleLoadClick,inverted:l,onKeyDown:v.fireClickOnEnter}),(0,r.jsxs)("span",Object.assign({className:"inline-help"},{children:[lf("Restore your project to a previous commit."),a.helpIconLink("/github/history",lf("Learn more about history of commits."))]}))]})),c&&(0,r.jsx)("div",Object.assign({className:"ui items"},{children:Object.keys(d).map((t=>(0,r.jsx)("div",Object.assign({role:"button",className:"ui link item",onClick:e=>{e.stopPropagation(),pxt.tickEvent("github.history.selectday"),this.setState({selectedDay:s===t?void 0:t,selectedCommit:void 0})},onKeyDown:v.fireClickOnEnter},{children:(0,r.jsxs)("div",Object.assign({className:"content"},{children:[(0,r.jsxs)("div",Object.assign({className:"ui header"},{children:[t,(0,r.jsxs)("div",Object.assign({className:"ui label button"},{children:[(0,r.jsx)("i",{className:"long arrow alternate up icon"})," ",d[t].length]}))]})),t===s&&(0,r.jsx)("div",Object.assign({className:"ui divided items"},{children:d[t].map((t=>(0,r.jsx)(T,{onClick:e=>{e.stopPropagation(),pxt.tickEvent("github.history.selectcommit",void 0,{interactiveConsent:!0});const{selectedCommit:n}=this.state;this.setState({selectedCommit:t==n?void 0:t})},commit:t,parent:n,githubId:e,expanded:i===t},"commit"+t.sha)))}))]}))}),"commitday"+t)))}))]}))}}class C extends s.Editor{constructor(e){super(e),this.parent=e,this.handleViewRef=e=>{this.view=e,this.view&&this.view.setVisible(this.isVisible)},this.handleViewRef=this.handleViewRef.bind(this)}getId(){return"githubEditor"}getCurrentSource(){return i.mainEditorPkg().files[pxt.github.GIT_JSON].content}hasHistory(){return!0}hasEditorToolbar(){return!1}setVisible(e){this.isVisible=e,this.view&&this.view.setVisible(e)}setHighContrast(e){}acceptsFile(e){return e.name===pxt.github.GIT_JSON}loadFileAsync(e,t){return super.loadFileAsync(e,t).then((()=>h.getBlocksAsync())).then((()=>this.parent.forceUpdate()))}display(){if(!this.isVisible)return;const e=this.parent.state.header;return e&&e.githubId?(0,r.jsx)(y,{ref:this.handleViewRef,parent:this.parent}):void 0}}n.Editor=C},{"./cloudsync":55,"./compiler":58,"./core":133,"./coretsx":134,"./data":136,"./dialogs":143,"./marked":167,"./package":179,"./srceditor":199,"./sui":200,"./tutorial":203,"./util":206,"./workspace":208,"react/jsx-runtime":367}],156:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WebCam=void 0;const r=e("react/jsx-runtime"),i=e("./data"),o=e("./sui"),s=e("./util");class a extends i.Component{constructor(e){super(e),this.handleVideoRef=e=>{this.video=e},this.state={hasPrompt:!0},this.handleDeviceClick=this.handleDeviceClick.bind(this),this.handleClose=this.handleClose.bind(this)}handleDeviceClick(e){this.setState({hasPrompt:!1}),pxt.debug("greenscreen: start"),this.deviceId=e,this.deviceId&&navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:e}},audio:!1}).then((e=>{pxt.debug("greenscreen: stream acquired");try{this.stream=e,this.video.srcObject=this.stream,this.video.play();const t=this.stream.getVideoTracks()[0];if(t){const e="environment"!==t.getSettings().facingMode;this.setState({userFacing:e})}}catch(e){pxt.debug("greenscreen: play failed"),console.error(e),this.stop()}}),(e=>{pxt.debug("greenscreen: get camera failed"),console.error(e),this.stop()}))}handleClose(){this.deviceId||this.props.close()}componentDidMount(){void 0!==typeof navigator&&navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.getUserMedia&&!pxt.BrowserUtils.isElectron()&&navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then((()=>navigator.mediaDevices.enumerateDevices())).then((e=>{this.setState({devices:e.filter((e=>"videoinput"==e.kind))})}),(e=>{pxt.debug("greenscreen: enumerate devices failed"),console.error(e)}))}componentWillUnmount(){this.stop()}stop(){if(this.deviceId=void 0,this.stream){try{const e=this.stream.getTracks();e&&e.forEach((e=>e.stop()))}catch(e){}this.stream=void 0}if(this.video)try{this.video.srcObject=void 0}catch(e){}}render(){const{hasPrompt:e,devices:t,userFacing:n}=this.state;return(0,r.jsxs)("div",Object.assign({className:"videoContainer"},{children:[(0,r.jsx)("video",{className:n?"flipx":"",autoPlay:!0,playsInline:!0,ref:this.handleVideoRef,width:"100%"}),e?(0,r.jsx)(o.Modal,Object.assign({isOpen:e,onClose:this.handleClose,closeIcon:!0,dimmer:!0,header:lf("Choose a camera")},{children:(0,r.jsxs)("div",Object.assign({className:"ui cards "+(t?"":"loading")},{children:[(0,r.jsx)(l,{icon:"green tint",onClick:this.handleDeviceClick,deviceId:"",header:lf("Green background")},"devicegreenscreen"),t&&t.map(((e,t)=>(0,r.jsx)(l,{icon:"video camera",onClick:this.handleDeviceClick,deviceId:e.deviceId,header:e.label||lf("camera {0}",t)},`device${t}`)))]}))})):void 0]}))}}n.WebCam=a;class l extends i.Component{constructor(e){super(e),this.state={},this.handleClick=this.handleClick.bind(this)}handleClick(){const{deviceId:e,onClick:t}=this.props;t(e)}renderCore(){const{header:e,icon:t}=this.props;return(0,r.jsxs)("div",Object.assign({role:"button",className:"ui card link",tabIndex:0,onClick:this.handleClick,onKeyDown:s.fireClickOnEnter},{children:[(0,r.jsx)("div",Object.assign({className:"imageicon"},{children:(0,r.jsx)(o.Icon,{icon:`${t} massive`})})),(0,r.jsx)("div",Object.assign({className:"content"},{children:(0,r.jsx)("span",Object.assign({className:"header"},{children:e}))}))]}))}}},{"./data":136,"./sui":200,"./util":206,"react/jsx-runtime":367}],157:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HeaderBar=void 0;const r=e("react/jsx-runtime"),i=e("./data"),o=e("./sui"),s=e("./auth"),a=e("./cmds"),l=e("./container"),c=e("./identity"),u=e("./package"),d=e("./projects"),p=e("./tutorial");class h extends i.Component{constructor(e){super(e),this.goHome=()=>{pxt.tickEvent("menu.home",void 0,{interactiveConsent:!0}),"home"!==this.getView()&&this.props.parent.showExitAndSaveDialog()},this.showShareDialog=()=>{pxt.tickEvent("menu.share",void 0,{interactiveConsent:!0}),this.props.parent.showShareDialog()},this.launchFullEditor=()=>{pxt.tickEvent("sandbox.openfulleditor",void 0,{interactiveConsent:!0}),this.props.parent.launchFullEditor()},this.exitTutorial=()=>{const e=this.props.parent.state.tutorialOptions;pxt.tickEvent("menu.exitTutorial",{tutorial:null==e?void 0:e.tutorial},{interactiveConsent:!0}),this.props.parent.exitTutorial()},this.showReportAbuse=()=>{pxt.tickEvent("tutorial.reportabuse",void 0,{interactiveConsent:!0}),this.props.parent.showReportAbuse()},this.toggleDebug=()=>{pxt.tickEvent("simulator.debug",void 0,{interactiveConsent:!0}),this.props.parent.toggleDebugging()},this.brandIconClick=()=>{pxt.tickEvent("projects.brand",void 0,{interactiveConsent:!0}),this.goHome()},this.backButtonTouchStart=e=>{this.longpressTimer=setTimeout((()=>a.nativeHostLongpressAsync()),750),this.touchStartTime=(new Date).getTime()},this.backButtonTouchEnd=e=>{e.preventDefault(),this.touchStartTime&&(new Date).getTime()-this.touchStartTime<750&&a.nativeHostBackAsync(),this.touchStartTime=null,clearTimeout(this.longpressTimer)},this.onPlayWithFriendsClick=e=>{e.preventDefault(),pxt.tickEvent("menu.playwithfriends",void 0,{interactiveConsent:!0}),window.open(pxt.multiplayer.SHORT_LINK(),"_blank")},this.getView=()=>{const{home:e,debugging:t,tutorialOptions:n}=this.props.parent.state;return e?"home":pxt.shell.isSandboxMode()?"sandbox":t?"debugging":!pxt.BrowserUtils.useOldTutorialLayout()&&(null==n?void 0:n.tutorial)?"tutorial-tab":(null==n?void 0:n.tutorial)?"tutorial":"editor"},this.getSettingsMenu=e=>{const{greenScreen:t,accessibleBlocks:n,header:i}=this.props.parent.state;switch(e){case"home":return(0,r.jsx)(d.ProjectSettingsMenu,{parent:this.props.parent});case"tutorial-tab":case"editor":return(0,r.jsx)(l.SettingsMenu,{parent:this.props.parent,greenScreen:t,accessibleBlocks:n,showShare:!!i});default:return(0,r.jsx)("div",{})}}}getOrganizationLogo(e,t,n){return(0,r.jsxs)("div",Object.assign({className:"ui item logo organization"},{children:[e.organizationWideLogo||e.organizationLogo?(0,r.jsx)("img",{className:"ui logo "+("home"!==n?"mobile hide":""),src:e.organizationWideLogo||e.organizationLogo,alt:lf("{0} Logo",e.organization)}):(0,r.jsx)("span",Object.assign({className:"name"},{children:e.organization})),e.organizationLogo&&"home"!==n&&(0,r.jsx)("img",{className:"ui image mobile only",src:e.organizationLogo,alt:lf("{0} Logo",e.organization)})]}))}getTargetLogo(e,t,n){return(0,r.jsx)("div",Object.assign({"aria-label":lf("{0} Logo",e.boardName),role:"menuitem",className:"ui item logo brand "+("sandbox"!==n&&"home"!==n?"mobile hide":""),onClick:this.brandIconClick},{children:e.useTextLogo?[(0,r.jsx)("span",Object.assign({className:"name"},{children:e.organizationText}),"org-name"),(0,r.jsx)("span",Object.assign({className:"name-short"},{children:e.organizationShortText||e.organizationText}),"org-name-short")]:e.logo||e.portraitLogo?(0,r.jsx)("img",{className:`ui ${e.logoWide?"small":""} logo`,src:e.logo||e.portraitLogo,alt:lf("{0} Logo",e.boardName)}):(0,r.jsx)("span",Object.assign({className:"name"},{children:e.boardName}))}))}getCenterLabel(e,t,n){var i,s,a,c,d,h,f;const g=!!u.mainEditorPkg().files[pxt.ASSETS_FILE],m=null===(s=null===(i=u.mainPkg)||void 0===i?void 0:i.config)||void 0===s?void 0:s.languageRestriction,v=!g&&("javascript-only"===m||"python-only"===m)||e.blocksOnly;switch(t){case"tutorial":const i=(null==n?void 0:n.tutorialActivityInfo)?n.tutorialActivityInfo[n.tutorialStepInfo[n.tutorialStep].activity].name:null,s=null===(a=null==n?void 0:n.metadata)||void 0===a?void 0:a.hideIteration;if(i)return(0,r.jsx)("div",Object.assign({className:"ui item"},{children:i}));if(!s)return(0,r.jsx)(p.TutorialMenu,{parent:this.props.parent});break;case"tutorial-tab":if(n&&((null===(d=null===(c=pxt.appTarget)||void 0===c?void 0:c.appTheme)||void 0===d?void 0:d.tutorialSimSidebarLayout)||pxt.BrowserUtils.isTabletSize())){const e=n.tutorialStep?n.tutorialStep+1:void 0,t=n.tutorialStepInfo?null===(h=n.tutorialStepInfo)||void 0===h?void 0:h.length:void 0;return(0,r.jsxs)("div",Object.assign({className:"tutorial-header-label"},{children:[(0,r.jsx)("div",Object.assign({className:"ui item tutorial-header-name-label"},{children:n.tutorialName})),e&&t&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",Object.assign({className:"ui item tutorial-header-step-label"},{children:" - "}))," ",(0,r.jsx)("div",Object.assign({className:"ui item tutorial-header-step-label"},{children:lf("Step {0} of {1}",e,t,t)}))]})]}))}return(0,r.jsx)("div",{});case"debugging":return(0,r.jsx)(o.MenuItem,{className:"centered",icon:"large bug",name:"Debug Mode"});case"sandbox":case"editor":if(!v)return(0,r.jsx)("div",Object.assign({className:"ui item link editor-menuitem"},{children:(0,r.jsx)(l.EditorSelector,{parent:this.props.parent,sandbox:"sandbox"===t,python:e.python,languageRestriction:m,headless:null===(f=pxt.appTarget.simulator)||void 0===f?void 0:f.headless})}));switch(m){case"python-only":return(0,r.jsx)(o.MenuItem,{className:"centered",icon:"xicon python",name:"Python"});case"javascript-only":return(0,r.jsx)(o.MenuItem,{className:"centered",icon:"xicon js",name:"JavaScript"})}}return(0,r.jsx)("div",{})}getExitButtons(e,t,n){var i,s;switch(t){case"debugging":return(0,r.jsx)(o.ButtonMenuItem,{className:"exit-debugmode-btn",role:"menuitem",icon:"external",text:lf("Exit Debug Mode"),textClass:"landscape only",onClick:this.toggleDebug});case"sandbox":if(!e.hideEmbedEdit)return(0,r.jsx)(o.Item,{role:"menuitem",icon:"external",textClass:"mobile hide",text:lf("Edit"),onClick:this.launchFullEditor});break;case"tutorial":case"tutorial-tab":const a=[];if(null==n?void 0:n.tutorialReportId){const e=lf("Unapproved Content");a.push((0,r.jsx)(o.Item,{role:"menuitem",icon:"exclamation triangle",className:"report-tutorial-btn link-button icon-and-text",textClass:"landscape only",text:e,ariaLabel:e,onClick:this.showReportAbuse},"tutorial-report"))}if(!e.lockedEditor&&!(null===(i=null==n?void 0:n.metadata)||void 0===i?void 0:i.hideIteration)&&("tutorial-tab"!==t||(null===(s=pxt.appTarget.simulator)||void 0===s?void 0:s.headless))){const e=lf("Exit tutorial");a.push((0,r.jsx)(o.Item,{role:"menuitem",icon:"sign out large",className:"exit-tutorial-btn link-button icon-and-text",textClass:"landscape only",text:e,ariaLabel:e,onClick:this.exitTutorial},"tutorial-exit"))}if(a.length)return a}return(0,r.jsx)("div",{})}renderCore(){var e,t;const n=pxt.appTarget.appTheme,i=this.getData(s.HIGHCONTRAST),u=this.getView(),{home:d,header:p,tutorialOptions:h}=this.props.parent.state,f=pxt.shell.isControllerMode(),g=a.isNativeHost(),m=s.hasIdentity(),v=this.props.parent.isPythonActive()?"Python":this.props.parent.isJavaScriptActive()?"JavaScript":"Blocks",y=!("editor"!==u&&"tutorial-tab"!==u||n.lockedEditor||f),b=("editor"===u||"tutorial-tab"===u)&&p&&(null===(e=pxt.appTarget.cloud)||void 0===e?void 0:e.sharing)&&!f,x="editor"===u&&(null===(t=n.docMenu)||void 0===t?void 0:t.length),E="tutorial"==u&&22*h.tutorialStepInfo.length>window.innerWidth/3;return(0,r.jsxs)("div",Object.assign({id:"mainmenu",className:`ui borderless fixed menu ${n.invertedMenu?"inverted":""} ${E?"thin":""}`,role:"menubar"},{children:[(0,r.jsxs)("div",Object.assign({className:"left menu"},{children:[g&&(0,r.jsx)(o.Item,{className:"icon nativeback",role:"menuitem",icon:"chevron left large",ariaLabel:lf("Back to application"),onClick:a.nativeHostBackAsync,onMouseDown:this.backButtonTouchStart,onMouseUp:this.backButtonTouchEnd,onMouseLeave:this.backButtonTouchEnd}),this.getOrganizationLogo(n,i,u),"tutorial"===u?(0,r.jsx)(o.Item,{className:"tutorialname",tabIndex:-1,textClass:"landscape only",text:h.tutorialName}):this.getTargetLogo(n,i,u)]})),!d&&(0,r.jsx)("div",Object.assign({className:"center menu"},{children:this.getCenterLabel(n,u,h)})),(0,r.jsxs)("div",Object.assign({className:"right menu"},{children:[this.getExitButtons(n,u,h),y&&(0,r.jsx)(o.Item,{className:"icon openproject "+(m?"mobile hide":""),role:"menuitem",title:lf("Home"),icon:"home large",ariaLabel:lf("Home screen"),onClick:this.goHome}),b&&(0,r.jsx)(o.Item,{className:"icon shareproject mobile hide",role:"menuitem",title:lf("Publish your game to create a shareable link"),icon:"share alternate large",ariaLabel:lf("Share Project"),onClick:this.showShareDialog}),x&&(0,r.jsx)(l.DocsMenu,{parent:this.props.parent,editor:v}),this.getSettingsMenu(u),m&&("home"===u||"editor"===u||"tutorial-tab"===u)&&(0,r.jsx)(c.UserMenu,{parent:this.props.parent})]}))]}))}}n.HeaderBar=h},{"./auth":48,"./cmds":56,"./container":132,"./data":136,"./identity":161,"./package":179,"./projects":180,"./sui":200,"./tutorial":203,"react/jsx-runtime":367}],158:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.mkHIDBridgePacketIOAsync=n.shouldUse=n.HIDError=void 0;var r=pxt.Cloud,i=pxt.Util;let o;class s extends Error{constructor(e){super(e),this.message=e}}n.HIDError=s;let a={};function l(e){let t=i.lookup(a,e.result.path);t?t.onOOB(e):console.error("Dropping data for "+e.result.path)}n.shouldUse=function(){let e=pxt.appTarget.serial;return e&&e.useHF2&&pxt.BrowserUtils.isLocalHost()&&!!r.localToken},n.mkHIDBridgePacketIOAsync=function(){!function(){if(!o){if(!pxt.BrowserUtils.isLocalHost()||!r.localToken)return;pxt.debug("initializing hid pipe"),o=pxt.worker.makeWebSocket(`ws://localhost:${pxt.options.wsPort}/${r.localToken}/hid`,l)}}();let e=!1;pxt.appTarget.serial&&pxt.appTarget.serial.rawHID&&(e=!0);let t=new c(e);return t.initAsync().then((()=>t))};class c{constructor(e=!1){this.rawMode=e,this.onDeviceConnectionChanged=e=>{},this.onConnectionChanged=()=>{},this.onData=e=>{},this.onEvent=e=>{},this.onError=e=>{},this.onSerial=(e,t)=>{},this.connecting=!1,e&&(this.onEvent=e=>this.onData(e))}disposeAsync(){return Promise.resolve()}isConnecting(){return this.connecting}isConnected(){return!!this.dev&&this.connected}onOOB(e){"serial"==e.op?this.onSerial(i.fromHex(e.result.data),e.result.isError):"event"==e.op&&this.onEvent(i.fromHex(e.result.data))}talksAsync(e){return o.opAsync("talk",{path:this.dev.path,cmds:e.map((e=>({cmd:e.cmd,data:e.data?i.toHex(e.data):""})))}).then((e=>e.map((e=>i.fromHex(e.data)))))}error(e){throw this.connected=!1,new s(i.lf("USB/HID error on device {0} ({1})",this.dev.product,e))}reconnectAsync(){return this.initAsync()}disconnectAsync(){return this.connected=!1,o.opAsync("disconnect",{path:this.dev.path}).finally((()=>{this.onConnectionChanged&&this.onConnectionChanged()}))}sendPacketAsync(e){if(this.rawMode)return o.opAsync("send",{path:this.dev.path,data:i.toHex(e),raw:!0});throw new Error("should use talksAsync()!")}sendSerialAsync(e,t){return o.opAsync("sendserial",{path:this.dev.path,data:i.toHex(e),isError:t})}initAsync(){return this.connected=!1,this.connecting=!0,o.opAsync("list",{}).then((e=>{let t=e.devices,n=t.filter((e=>16896==(65280&e.release)))[0];if(pxt.appTarget.serial&&pxt.appTarget.serial.rawHID&&(n=t[0]),!n)throw new Error("No device connected");this.dev&&delete a[this.dev.path],this.dev=n,a[this.dev.path]=this})).then((()=>o.opAsync("init",{path:this.dev.path,raw:this.rawMode}))).then((()=>{this.connected=!0})).finally((()=>{this.connecting=!1,this.onConnectionChanged&&this.onConnectionChanged()}))}}},{}],159:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HintManager=n.HintTooltip=void 0;const r=e("react/jsx-runtime"),i=e("./data");class o extends i.Component{constructor(e){super(e)}UNSAFE_componentWillReceiveProps(e){e.pokeUser!=this.state.show&&this.setState({show:e.pokeUser})}renderCore(){return(0,r.jsx)("div",Object.assign({className:"tooltip "+(this.state.show?"show":""),role:"tooltip",onClick:this.props.onClick},{children:this.props.text}))}}n.HintTooltip=o;n.HintManager=class{constructor(){this.defaultDuration=1e4,this.defaultDisplayCount=3,this.hints={},this.seenHints={}}viewedHint(e){this.seenHints[e]=!0}clearViewedHints(){this.seenHints={}}addHint(e,t,n){this.hints[e]=pxt.Util.debounce((()=>{t(),this.stopPokeUserActivity()}),n||this.defaultDuration)}pokeUserActivity(e,t,n){(null==n||n<this.defaultDisplayCount)&&!this.seenHints[t]&&(this.stopPokeUserActivity(),this.timer=this.hints[e]())}stopPokeUserActivity(){clearTimeout(this.timer),this.timer=null}}},{"./data":136,"react/jsx-runtime":367}],160:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.provider=void 0;const r=e("./browserworkspace"),i="texts",o="headers";let s;async function a(){return s?await s:s=async function(){const e=new pxt.BrowserUtils.IDBWrapper("__pxt_idb_workspace",1,((e,t)=>{const n=t.result;n.createObjectStore(i,{keyPath:"id"}),n.createObjectStore(o,{keyPath:"id"})}),(async()=>{await pxt.BrowserUtils.clearTranslationDbAsync(),await pxt.BrowserUtils.clearTutorialInfoDbAsync()}));try{await e.openAsync()}catch(e){return pxt.reportException(e),Promise.reject(e)}return e}()}async function l(e,t,n){const r=await a();try{await s(r,e,t,n)}catch(i){if(409==i.status)return void pxt.debug("idb: set conflict (409)");pxt.reportException(i),pxt.log("idb: set failed, cleaning cache dbs"),await pxt.BrowserUtils.clearTranslationDbAsync(),await pxt.BrowserUtils.clearTutorialInfoDbAsync();try{await s(r,e,t,n)}catch(e){throw pxt.reportException(e,{ws:"idb"}),pxt.log("idb: we are out of space..."),e}}async function s(e,t,n,r){const s={id:t.id,files:r,_rev:n};r&&await e.setAsync(i,s),await e.setAsync(o,t)}}n.provider={getAsync:async function(e){const t=await a(),n=await t.getAsync(i,e.id);return{header:e,text:n.files,version:n._rev}},setAsync:l,deleteAsync:async function(e,t){const n=await a();await n.deleteAsync(i,e.id),await n.deleteAsync(o,e.id)},listAsync:async function(){return await async function(){const e=await a();if((await e.getAllAsync(o)).length)return;const t=await r.provider.listAsync();await Promise.all(t.map((e=>(async e=>{const t=await r.provider.getAsync(e);delete t._id,delete t._rev,await l(e,void 0,t.text)})(e))))}(),(await a()).getAllAsync(o)},resetAsync:async function(){const e=await a();await e.deleteAllAsync(i),await e.deleteAllAsync(o)}}},{"./browserworkspace":52}],161:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CloudSaveStatus=n.UserMenu=n.LoginDialog=void 0;const r=e("react/jsx-runtime"),i=e("./sui"),o=e("./core"),s=e("./auth"),a=e("./data"),l=e("./cloudsync"),c=e("./cloud"),u=e("../../react-common/components/profile/SignInModal");class d extends s.Component{constructor(e){super(e),this.hide=()=>{this.setState({visible:!1})},this.signInAsync=async(e,t)=>{pxt.tickEvent("identity.loginClick",{provider:e.name,rememberMe:t.toString()}),await s.loginAsync(e.id,t,{hash:this.state.continuationHash,params:pxt.Util.parseQueryString(window.location.search)})},this.state={visible:!1,continuationHash:""}}async show(e){this.setState({visible:!0,continuationHash:e})}renderCore(){const{visible:e}=this.state;return(0,r.jsx)(r.Fragment,{children:e&&(0,r.jsx)(u.SignInModal,{onClose:this.hide,onSignIn:this.signInAsync})})}}n.LoginDialog=d;class p extends s.Component{constructor(e){super(e),this.handleDropdownClicked=()=>{const e=this.isLoggedIn(),t=this.getData("github:user");return!(!e&&!t&&(this.props.parent.showLoginDialog(this.props.continuationHash),1))},this.handleLoginClicked=()=>{this.props.parent.showLoginDialog(this.props.continuationHash)},this.handleLogoutClicked=async()=>{await s.logoutAsync()},this.handleProfileClicked=()=>{this.props.parent.showProfileDialog()},this.handleUnlinkGitHubClicked=()=>{pxt.tickEvent("menu.github.signout");const e=l.githubProvider();e&&(e.logout(),this.props.parent.forceUpdate(),o.infoNotification(lf("Signed out from GitHub...")))},this.state={}}avatarPicUrl(){var e,t,n,r;const i=this.getUserProfile();return null!==(t=null===(e=null==i?void 0:i.idp)||void 0===e?void 0:e.pictureUrl)&&void 0!==t?t:null===(r=null===(n=null==i?void 0:i.idp)||void 0===n?void 0:n.picture)||void 0===r?void 0:r.dataUrl}renderCore(){const e=this.isLoggedIn(),t=this.getUserProfile(),n=lf("User Menu"),o=(0,r.jsxs)("div",Object.assign({className:"signin-button"},{children:[(0,r.jsx)("div",Object.assign({className:"ui text desktop only"},{children:lf("Sign In")})),i.genericContent({icon:"xicon cloud-user large"})]})),s=(0,r.jsx)("div",Object.assign({className:"avatar"},{children:(0,r.jsx)("img",{src:this.avatarPicUrl(),alt:lf("User Menu"),referrerPolicy:"no-referrer"})})),a=(0,r.jsx)("div",Object.assign({className:"avatar"},{children:(0,r.jsx)("span",Object.assign({className:"initials"},{children:pxt.auth.userInitials(t)}))})),l=this.avatarPicUrl()?s:a,c=this.getData("github:user");return(0,r.jsxs)(i.DropdownMenu,Object.assign({role:"menuitem",title:n,className:"item icon user-dropdown-menuitem "+(e?"logged-in-dropdown":"sign-in-dropdown"),titleContent:e?l:o,tabIndex:e?0:-1,onClick:this.handleDropdownClicked},{children:[e?(0,r.jsx)(i.Item,{role:"menuitem",text:lf("My Profile"),onClick:this.handleProfileClicked}):void 0,e?(0,r.jsx)("div",{className:"ui divider"}):void 0,c?(0,r.jsxs)(i.Item,Object.assign({role:"menuitem",title:lf("Unlink {0} from GitHub",c.name),onClick:this.handleUnlinkGitHubClicked},{children:[(0,r.jsx)("div",Object.assign({className:"icon avatar",role:"presentation"},{children:(0,r.jsx)("img",{className:"circular image",src:c.photo,alt:lf("User picture")})})),(0,r.jsx)("span",{children:lf("Unlink GitHub")})]})):void 0,c&&(0,r.jsx)("div",{className:"ui divider"}),e?void 0:(0,r.jsx)(i.Item,{role:"menuitem",text:lf("Sign in"),onClick:this.handleLoginClicked}),e?(0,r.jsx)(i.Item,{role:"menuitem",text:lf("Sign out"),onClick:this.handleLogoutClicked}):void 0]}))}}n.UserMenu=p;class h extends a.Component{static wouldRender(e){const t=c.getCloudTempMetadata(e).cloudStatus();return!!t&&"none"!==t.value&&s.hasIdentity()}renderCore(){if(!this.props.headerId)return null;const e=this.getData(`${c.HEADER_CLOUDSTATE}:${this.props.headerId}`).cloudStatus();if(!e||"none"===e.value||!s.hasIdentity())return null;const t="localEdits"===e.value,n=t||"syncing"===e.value;return(0,r.jsxs)("div",Object.assign({className:"cloudstatusarea"},{children:[!n&&(0,r.jsx)(i.Item,{className:"ui tiny cloudicon xicon "+e.icon,title:e.tooltip,tabIndex:-1}),n&&(0,r.jsx)(i.Item,{className:"ui tiny inline loader active cloudprogress"+(t?" indeterminate":""),title:e.tooltip,tabIndex:-1}),"none"!==e.value&&"synced"!==e.value&&(0,r.jsx)("span",Object.assign({className:"ui mobile hide no-select cloudtext",role:"note"},{children:e.shortStatus}))]}))}}n.CloudSaveStatus=h},{"../../react-common/components/profile/SignInModal":32,"./auth":48,"./cloud":54,"./cloudsync":55,"./core":133,"./data":136,"./sui":200,"react/jsx-runtime":367}],162:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.provider=void 0;const r=e("./memoryworkspace");let i;n.provider={getAsync:function(e){return r.provider.getAsync(e)},setAsync:function(e,t,n){return r.provider.setAsync(e,t,n).then((()=>{const t=n||r.projects[e.id]&&r.projects[e.id].text;return pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspacesave",project:{header:e,text:t},response:!1})})).then((()=>{}))},listAsync:function(){return pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspacesync",response:!0}).then((e=>((e.projects||[]).forEach(r.merge),i=e.editor,pxt.tickEvent("pxt.controller",{controllerId:e.controllerId}),r.provider.listAsync())))},resetAsync:function(){return r.provider.resetAsync().then((()=>pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspacereset",response:!0}))).then((()=>{}))},loadedAsync:function(){return pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspaceloaded",response:!0}).then((()=>{}))},getSyncState:function(){return i},fireEvent:function(e){pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspaceevent",response:!1,event:e})}}},{"./memoryworkspace":168}],163:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ImmersiveReaderButton=n.launchImmersiveReader=void 0;const r=e("react/jsx-runtime"),i=e("./data"),o=e("./core"),s=e("./auth"),a=e("@microsoft/immersive-reader-sdk");var l=pxt.Cloud;const c=e("./util");function u(e){const t=[function(e){return e.replace(/@boardname@/g,pxt.appTarget.appTheme.boardName||"device")},function(e){return e.replace(/(!\w*\[[^\]]*\]\w*\([^)]*\))/gu,"")},function(e){return e.replace(/\w*\[([^\]]*)\]\w*\([^)]*\)/gu,((e,t,n,r)=>lf("{0}",t)))},function(e){return e.replace(/`?`\|\|[\w|\s]+:(.+?)\|\|``?/gu,((e,t,n,r)=>lf('"{0}"',t)))},function(e){return e.replace(/``\|([^|]+)\|``/gu,((e,t,n,r)=>lf("{0}",t)))},function(e){return e.replace(pxt.tutorial.getMetadataRegex(),"")},function(e){return e.replace(/\*\*([^*^\s]+)\*\*|__([^\s^_]+)__/gu,((e,t,n,r,i)=>'"'+lf("{0}",t||n)+'"')).replace(/\*\*([^*]+)\*\*|__([^_]+)__/gu,((e,t,n,r,i)=>t?lf("{0}",t):lf("{0}",n)))},function(e){return e.replace(/\*([^*]+)\*|_([^_]+)_/gu,((e,t,n,r,i)=>lf("{0}",t||n)))},function(e){return e.replace(/[\r\n]{2,}/gmu,"<br />\n")},function(e){return e.replace(/^\* \* \*$|^- - -$|^<hr\/>$|---/gmu,"<br />")},function(e){return e.replace(/^>>/gu,"")},function(e){let t;try{t=new RegExp("\\p{Extended_Pictographic}","ug")}catch(e){}const n=[];return t?e.replace(t,((e,t,r,i)=>""==e?"":n.indexOf(e)<0?"":e)):e},function(e){return e.replace(/[]/gu,lf("{0}","A")).replace(/[]/gu,lf("{0}","B"))},function(e){return e.replace(/<(true|false|down|up|high|low|on|off|yes|no|win|lose)>/giu,((e,t,n,r)=>"`"+lf("{0}",t)+"`"))}];let n=e;return t.forEach((e=>{n=e(n)})),n}function d(e,t){pxt.tickEvent("immersiveReader.launch",{tutorial:t.tutorial,tutorialStep:t.tutorialStep});const n=i.getData(s.READER)||"",r=i.getData(s.LANGUAGE)||"",c={chunks:[{content:u(e),mimeType:"text/html"}]},d={uiLang:r,onExit:()=>{pxt.tickEvent("immersiveReader.close",{tutorial:t.tutorial,tutorialStep:t.tutorialStep})},onPreferencesChanged:e=>{s.setImmersiveReaderPrefAsync(e)},preferences:n};(function(){const e=pxt.storage.getLocal("immReader"),t=pxt.Util.jsonTryParse(e);return!t||Date.now()/1e3>t.expiration?pxt.Cloud.privateGetAsync("immreader",!0).then((e=>(pxt.storage.setLocal("immReader",JSON.stringify(e)),e)),(e=>(pxt.storage.removeLocal("immReader"),pxt.reportException(e),pxt.tickEvent("immersiveReader.error",{error:e.statusCode,message:e.message}),e.isOffline?Promise.reject(new Error("offline")):Promise.reject(new Error("token"))))):(pxt.tickEvent("immersiveReader.cachedToken"),Promise.resolve(t))})().then((e=>function(e){return pxt.Cloud.privateGetAsync("ping",!0).then((()=>e))}(e))).then((e=>{if(l.isOnline()){const t=pxt.Util.now();return a.launchAsync(e.token,e.subdomain,c,d).then((e=>{const n=pxt.Util.now()-t;pxt.tickEvent("immersiveReader.launch.finished",{elapsed:n})}))}return Promise.reject(new Error("offline"))})).catch((e=>{if(e.isOffline)o.warningNotification(lf("Immersive Reader cannot be used offline"));else switch(e.message){case"offline":o.warningNotification(lf("Immersive Reader cannot be used offline"));break;case"token":default:o.warningNotification(lf("Immersive Reader could not be launched")),"string"==typeof e?pxt.tickEvent("immersiveReader.error",{message:e}):pxt.tickEvent("immersiveReader.error",{message:e.message,statusCode:e.statusCode})}pxt.reportException(e),a.close()}))}n.launchImmersiveReader=d;class p extends i.Component{constructor(){super(...arguments),this.buttonClickHandler=()=>{d(this.props.content,this.props.tutorialOptions)}}render(){return(0,r.jsx)("div",{className:"immersive-reader-button ui item",onClick:this.buttonClickHandler,"aria-label":lf("Launch Immersive Reader"),role:"button",onKeyDown:c.fireClickOnEnter,tabIndex:0,title:lf("Launch Immersive Reader")})}}n.ImmersiveReaderButton=p},{"./auth":48,"./core":133,"./data":136,"./util":206,"@microsoft/immersive-reader-sdk":218,"react/jsx-runtime":367}],164:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Keymap=void 0;const r=e("react/jsx-runtime"),i=e("./data");class o extends i.Component{constructor(e){super(e),this.hideKeymap=()=>{this.props.parent.showKeymap(!1)},this.setData();const t=pxt.appTarget&&pxt.appTarget.appTheme&&pxt.appTarget.appTheme.boardName.toLowerCase();this.keymap=t&&o._data[t],this.state={above:!0}}renderCore(){return(0,r.jsxs)("div",Object.assign({className:"keymap "+(this.state.above?"above":""),ref:"keymap"},{children:[(0,r.jsx)("i",{className:"icon large close remove circle",role:"presentation",onClick:this.hideKeymap}),this.keymap&&this.keymap.map(((e,t)=>(0,r.jsxs)("div",{children:[(0,r.jsx)("span",Object.assign({className:"keymap-title"},{children:e.title})),Object.keys(e.map).map(((t,n)=>(0,r.jsxs)("div",Object.assign({className:"keymap-row"},{children:[e.map[t].map(((e,t)=>(0,r.jsx)("div",Object.assign({className:"keymap-key"},{children:e}),t))),(0,r.jsx)("span",Object.assign({className:"keymap-name"},{children:t}))]}),n)))]},t)))]}))}setData(){o._data||(o._data={arcade:[{title:lf("player 1"),map:{[lf("up")]:["","W"],[lf("down")]:["","S"],[lf("left")]:["","A"],[lf("right")]:["","D"],a:["Z",lf("{id:keyboard symbol}space")],b:["X",lf("{id:keyboard symbol}enter")]}},{title:lf("player 2"),map:{[lf("up")]:["I"],[lf("down")]:["K"],[lf("left")]:["J"],[lf("right")]:["L"],[lf("a")]:["U"],[lf("b")]:["O"]}}]})}}n.Keymap=o},{"./data":136,"react/jsx-runtime":367}],165:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LanguagePicker=n.setInitialLang=n.initialLang=void 0;const r=e("react/jsx-runtime"),i=e("./codecard"),o=e("./sui"),s=e("./data"),a=e("./core"),l=["en"];n.setInitialLang=function(e){n.initialLang=pxt.Util.normalizeLanguageCode(e)[0]};class c extends s.Component{constructor(e){super(e),this.state={visible:!1},this.hide=this.hide.bind(this),this.changeLanguage=this.changeLanguage.bind(this),this.translateEditor=this.translateEditor.bind(this)}languageList(){return pxt.appTarget.appTheme.selectLanguage&&pxt.appTarget.appTheme.availableLocales&&pxt.appTarget.appTheme.availableLocales.length?pxt.appTarget.appTheme.availableLocales:l}translateEditor(){pxt.tickEvent("translate.editor.incontext",void 0,{interactiveConsent:!0}),a.confirmAsync({header:lf("Translate the editor"),jsx:(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{children:lf("This editor uses crowd-sourced translation! If you wish to help with translation, make sure to register as a translator.")}),(0,r.jsx)("p",{children:lf("'Translate' will reload the editor with in-context translations. Close the editor when done.")})]}),helpUrl:"/translate",buttons:[{label:lf("Register"),icon:"xicon globe",className:lf("secondary"),title:lf("Register as a translator before starting the translation."),url:`https://crowdin.com/project/${pxt.appTarget.appTheme.crowdinProject}`}],agreeLbl:lf("Translate"),hasCloseIcon:!0}).then((e=>{if(e){pxt.tickEvent("translate.editor.incontext.translate");const e=window.location.href.indexOf("?")<0?"?":"&";window.location.href=window.location.pathname+(window.location.search||"")+e+"translate=1"+(window.location.hash||"")}}))}changeLanguage(e){pxt.Util.allLanguages[e]&&(e!==n.initialLang?(pxt.tickEvent("menu.lang.changelang",{lang:e}),a.setLanguage(e).then((()=>{this.props.parent.reloadEditor()}))):(pxt.tickEvent("menu.lang.samelang",{lang:e}),this.hide()))}hide(){this.setState({visible:!1})}show(){this.setState({visible:!0})}renderCore(){if(!this.state.visible)return(0,r.jsx)("div",{});const e=pxt.appTarget.appTheme,t=this.languageList(),n=t.length>4?"large":"small",i=!pxt.BrowserUtils.isIE()&&!pxt.shell.isReadOnly()&&!pxt.BrowserUtils.isPxtElectron()&&pxt.appTarget.appTheme.crowdinProject,s=this.props.parent.createModalClasses();return(0,r.jsx)(o.Modal,Object.assign({isOpen:this.state.visible,className:s,size:n,onClose:this.hide,dimmer:!0,header:lf("Select Language"),closeIcon:!0,allowResetFocus:!0,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},{children:(0,r.jsxs)("div",Object.assign({id:"langmodal"},{children:[(0,r.jsx)("div",Object.assign({id:"availablelocales",className:"ui cards centered",role:"list","aria-label":lf("List of available languages")},{children:t.map((e=>{const t=pxt.Util.allLanguages[e];return(0,r.jsx)(u,{langId:e,name:t.localizedName,ariaLabel:t.englishName,description:t.englishName,onClick:this.changeLanguage},e)}))})),e.crowdinProject?(0,r.jsxs)("div",Object.assign({className:"ui",id:"langmodalfooter"},{children:[(0,r.jsx)(o.Link,{"aria-label":lf("How do I add a new language?"),href:"/translate",text:lf("How do I add a new language?"),target:"_blank"}),i&&(0,r.jsx)(o.Button,{"aria-label":lf("Translate the editor"),onClick:this.translateEditor,text:lf("Translate the editor")})]})):void 0]}))}))}}n.LanguagePicker=c;class u extends o.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}handleClick(){this.props.onClick(this.props.langId)}renderCore(){const{name:e,ariaLabel:t,description:n}=this.props;return(0,r.jsx)(i.CodeCardView,{className:"card-selected langoption",name:e,ariaLabel:t,role:"listitem",description:n,onClick:this.handleClick})}}},{"./codecard":57,"./core":133,"./data":136,"./sui":200,"react/jsx-runtime":367}],166:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.makeAsync=void 0;const r=e("react/jsx-runtime"),i=e("./package"),o=e("./core"),s=e("./compiler"),a="instructions";function l(e){return function(e){return new Promise(((t,n)=>{window.addEventListener("message",(function e(n){const r=n.data;"ready"==r.type&&r.frameid==a&&(window.removeEventListener("message",e),t())})),e.src=pxt.webConfig.partsUrl+"#"+a}))}(e).then((()=>s.compileAsync({native:!0}))).then((t=>{const n=i.mainEditorPkg().header.name||lf("Untitled"),r=pxt.appTarget.simulator.boardDefinition,o=ts.pxtc.computeUsedParts(t).sort(),s=i.mainPkg.computePartDefinitions(o),a=t.usedArguments;let l={},c={};for(let e of t.configData||[])l[e.key+""]=e.value,c[e.name]=e.key;const u={cfg:l,cfgKey:c};return e.contentWindow.postMessage({type:"instructions",options:{name:n,boardDef:r,parts:o,partDefinitions:s,fnArgs:a,configData:u,print:!0}},"*"),e}))}n.makeAsync=function(){return o.dialogAsync({header:lf("Make"),size:"large",hasCloseIcon:!0,jsx:(0,r.jsx)("div",Object.assign({className:"ui container"},{children:(0,r.jsx)("div",Object.assign({id:"makecontainer",style:{position:"relative",height:0,paddingBottom:"40%",overflow:"hidden"}},{children:(0,r.jsx)("iframe",{id:"makeiframe",frameBorder:"0",sandbox:"allow-popups allow-forms allow-scripts allow-same-origin allow-modals",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"}})}))})),onLoaded:e=>{l(e.querySelectorAll("#makeiframe")[0])}}).then((e=>{}))}},{"./compiler":58,"./core":133,"./package":179,"react/jsx-runtime":367}],167:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MarkedContent=void 0;const r=e("react/jsx-runtime"),i=e("./data"),o=e("marked"),s=e("./compiler"),a=e("dashjs"),l=e("dashjs"),c=e("../../react-common/components/util");class u extends i.Component{constructor(){super(...arguments),this.semanticIconNames=["flipped","horizontally","vertically","rotated","counterclockwise","access","accessible","accusoft","add","address","adjust","adn","adversal","affiliatetheme","aid","alarm","ald","algolia","alien","align","all","alphabet","als","alt","alternate","alternative","amazon","ambulance","american","amex","amilia","amount","anchor","and","android","angellist","angle","angrycreative","angular","announcement","app","apper","apple","archive","area","arrow","arrows","ascending","asexual","asl","assistive","asterisk","asymmetrik","at","attach","attention","audible","audio","autoprefixer","avianex","aviato","awesome","aws","backward","badge","bag","balance","ball","ban","band","bandcamp","bar","barcode","bars","baseball","basket","basketball","bath","bathtub","battery","bed","beer","beginner","behance","bell","bicycle","bill","bimobject","binary","binoculars","birthday","bishop","bitbucket","bitcoin","bity","black","blackberry","blind","block","blogger","bluetooth","board","bold","bolt","bomb","book","bookmark","bowling","box","boxes","braille","branch","briefcase","broken","browser","brush","btc","bug","building","bullhorn","bullseye","bureau","buromobelexperte","bus","buysellads","cake","calculator","calendar","call","camera","camp","cancel","cap","captioning","car","card","caret","cart","cc","center","centercode","certificate","chain","chart","chat","check","checked","checkered","checkmark","chess","chevron","child","chrome","circle","clipboard","clock","clone","close","closed","cloud","cloudscale","cloudsmith","cloudversify","club","cny","cocktail","code","codepen","codiepie","coffee","cog","cogs","columns","combinator","comment","commenting","comments","commons","compass","compose","compress","computer","configure","connectdevelop","contao","content","control","conversation","copy","copyright","cord","cpanel","creative","credit","crop","crosshairs","css3","cube","cubes","currency","cursor","cut","cuttlefish","dashboard","dashcube","database","deaf","deafness","delete","delicious","deploydog","descending","description","deskpro","desktop","detective","deviantart","devices","diamond","digg","digital","diners","discord","discourse","discover","discussions","disk","dna","dochub","docker","doctor","dollar","dolly","dont","dot","double","down","download","draft2digital","dribbble","dribble","drive","drivers","dropbox","dropdown","dropper","drupal","dyalog","earlybirds","edge","edit","eercast","eject","elementor","ellipsis","ember","emergency","empire","empty","end","envelope","envira","erase","eraser","erlang","ethereum","etsy","eur","euro","excel","exchange","exclamation","expand","expeditedssl","explorer","express","external","extinguisher","eye","eyedropper","facebook","factory","fast","favorite","fax","feed","female","fi","fighter","file","film","filter","find","fire","firefox","first","firstdraft","five","flag","flask","flatbed","flickr","flipboard","fly","folder","font","fonticons","food","football","fork","forms","fort","forumbee","forward","four","foursquare","framework","free","freebsd","from","frown","full","futbol","gallery","game","gavel","gay","gbp","gem","gender","genderless","get","gg","ghost","gift","git","github","gitkraken","gitlab","gitter","gittip","glass","glide","globe","gofore","golf","goodreads","google","grab","graduation","graph","gratipay","grav","grid","gripfire","group","grunt","gulp","hacker","half","hand","handicap","handshake","hard","hash","hashtag","hat","hdd","header","heading","headphones","hearing","heart","heartbeat","height","help","helper","heterosexual","hide","high","hips","hire","history","hockey","home","homosexual","hooli","horizontal","hospital","hotel","hotjar","hourglass","houzz","html5","hubspot","hundred","hunt","id","idea","ils","image","images","imdb","in","in-cart","inbox","indent","industry","info","inr","instagram","intergender","international","internet","interpreting","intersex","ios","ioxhost","isle","italic","itunes","japan","jcb","jenkins","jet","joget","joomla","jpy","js","jsfiddle","justify","key","keyboard","keycdn","kickstarter","king","knight","korvue","krw","lab","language","laptop","laravel","large","lastfm","law","layout","leaf","leanpub","left","legal","lemon","lesbian","less","level","license","life","lightbulb","lightning","like","line","linechat","linkedin","linkify","linode","linux","lira","list","listening","lizard","location","lock","log","logout","long","low","lyft","magento","magic","magnet","magnify","mail","male","man","map","marker","mars","martini","mastercard","maxcdn","maximize","md","meanpath","medapps","medium","medkit","medrt","meetup","meh","mercury","messenger","microchip","microphone","microsoft","military","minimize","minus","mix","mixcloud","mizuni","mobile","modx","monero","money","monster","moon","motorcycle","mouse","move","ms","mule","music","mute","napster","neuter","new","news","newspaper","nintendo","node","non","notch","notched","note","npm","ns8","numbered","numeric","nutritionix","object","ocean","odnoklassniki","of","off","official","ol","on","one","open","opencart","openid","opera","optin","optinmonster","options","order","ordered","osi","other","out","outdent","outline","overflow","page4","pagelines","paint","palfed","pallet","paper","paperclip","paragraph","paste","patreon","pause","paw","pawn","pay","payment","paypal","pdf","peace","pen","pencil","percent","periscope","phabricator","phoenix","phone","photo","php","picture","pie","piece","pied","pills","pin","pinterest","piper","pixels","plane","play","playstation","play","plug","plus","pocket","podcast","point","pointer","pointing","pound","power","powerpoint","pp","print","privacy","product","protect","puck","pushed","puzzle","python","qq","qrcode","quarter","quarters","queen","question","quidditch","quinscape","quora","quote","radio","rain","random","ravelry","react","rebel","record","rectangle","recycle","reddit","redo","redriver","refresh","registered","remove","rendact","renren","repeat","reply","replyd","resize","resolving","restore","retro","retweet","right","ring","rmb","road","rock","rocket","rocketchat","rockrms","rook","rouble","rss","rub","ruble","rupee","s15","safari","sass","save","scale","schlix","scissors","scribd","search","searchengin","secret","selected","sellcast","sellsy","send","server","servicestack","setting","settings","share","shekel","sheqel","shield","ship","shipping","shirtsinbulk","shop","shopping","shower","shuffle","shutdown","shuttle","sidebar","sign","sign-in","sign-out","signal","signing","signs","signup","simple","simplybuilt","sistrix","sitemap","skyatlas","skype","slack","slash","sliders","slideshare","smile","snapchat","snowflake","soccer","sort","sound","soundcloud","space","speakap","spinner","spock","spoon","spotify","spy","square","stack","star","start","staylinked","steam","step","stethoscope","sticker","sticky","stop","stopwatch","store","strava","street","strikethrough","stripe","stroke","student","studiovinari","stumbleupon","subscript","subway","suitcase","sun","superpowers","superscript","supple","switch","symbol","sync","syringe","systems","table","tablet","tachometer","tack","tag","tags","talk","target","tasks","taxi","telegram","telephone","teletype","television","tencent","tennis","terminal","text","th","theme","themeisle","thermometer","thin","three","thumb","thumbs","thumbtack","ticket","tie","time","times","tint","tm","to","toggle","trademark","train","transgender","translate","trash","travel","treatment","tree","trello","triangle","tripadvisor","trophy","truck","try","tumblr","tv","twitch","twitter","two","uber","uikit","ul","umbrella","underline","undo","ungroup","unhide","uniregistry","universal","university","unlink","unlinkify","unlock","unmute","unordered","untappd","up","upload","usb","usd","user","users","ussunnah","utensil","utensils","vaadin","vcard","venus","vertical","viacoin","viadeo","viber","victory","video","view","vimeo","vine","visa","vision","vk","vnv","volleyball","volume","vuejs","wait","wallet","warehouse","warning","wechat","weibo","weight","weixin","whatsapp","wheelchair","whmcs","wi-fi","width","wifi","wikipedia","window","windows","winner","wizard","woman","won","word","wordpress","world","wpbeginner","wpexplorer","wpforms","wrench","write","xbox","xing","yahoo","yandex","yc","ycombinator","yelp","yen","yoast","youtube","zero","zip","zoom","zoom-in","zoom-out"],this.customIconNames=["blocks","js","python","toolbox","book-reader","photo-video","gamepad","function"]}static clearBlockSnippetCache(){this.blockSnippetCache={}}getBuiltinMacros(){const e={},t=pxt.appTarget.appTheme;return t.boardName&&(e.boardname=pxt.Util.htmlEscape(t.boardName)),t.boardNickname&&(e.boardnickname=pxt.Util.htmlEscape(t.boardNickname)),t.driveDisplayName&&(e.drivename=pxt.Util.htmlEscape(t.driveDisplayName)),t.homeUrl&&(e.homeurl=pxt.Util.htmlEscape(t.homeUrl)),e.targetid=t.id||"???",e.targetname=t.name||"Microsoft MakeCode",e.targetlogo=t.docsLogo?`<img aria-hidden="true" role="presentation" class="ui mini image" src="${t.docsLogo}" />`:"",e}startRenderLangSnippet(e){const{unboxSnippets:t}=this.props,n=e.parentElement,r=n.parentElement,i=document.createElement("div");return i.className=`ui ${t?"":"segment raised "}loading codewidget`,r.insertBefore(i,n),r.removeChild(n),i}finishRenderLangSnippet(e,t){if("string"==typeof t){let e=document.createElement("code");e.className="hljs",e.textContent=t,pxt.tutorial.highlight(e),t=e}e.appendChild(t),pxsim.U.removeClass(e,"loading")}cachedRenderLangSnippetAsync(e,t){const n=e.textContent,r=e.className,i=this.startRenderLangSnippet(e);return u.blockSnippetCache[r+n]?void this.finishRenderLangSnippet(i,u.blockSnippetCache[r+n]):t(n).then((e=>{u.blockSnippetCache[r+n]=e,this.finishRenderLangSnippet(i,u.blockSnippetCache[r+n])})).catch((e=>{pxt.reportException(e),this.finishRenderLangSnippet(i,lf("Something changed."))}))}renderSnippets(e){const{parent:t,unboxSnippets:n,onDidRender:r,blocksDiffOptions:i,textDiffOptions:o}=this.props;let a=[];function l(e){const t=e.svg;if(t){if("SVG"==t.tagName){const e=t.getAttribute("viewBox").split(" ").map(parseFloat),n=e[2];let r=e[3];(n>480||r>128)&&(r=.8*r|0),t.setAttribute("height",`${r}px`)}return t}{const t=document.createElement("div");return t.className="ui basic segment",t.textContent=e.message||lf("No changes."),t}}function c(e,r){const i=e.textContent,o=document.createElement("div");pxsim.U.clear(e),e.appendChild(o),o.className=`ui ${n?"":"segment raised "} loading`;const s={type:"pxteditor",action:"renderblocks",ts:i,snippetMode:r},l=JSON.stringify(s);if(u.blockSnippetCache[l]){const e=u.blockSnippetCache[l],t=Blockly.utils.xml.textToDomDocument(pxt.blocks.layout.serializeSvgString(e));o.appendChild(t.documentElement),pxsim.U.removeClass(o,"loading")}else a.push(t.renderBlocksAsync(s).then((e=>{const t=e.svg;if(t){const e=t.getAttribute("viewBox").split(" ").map(parseFloat),n=e[2];let r=e[3];(n>480||r>128)&&(r=.8*r|0),t.setAttribute("height",`${r}px`),pxt.BrowserUtils.isIE()||(u.blockSnippetCache[l]=Blockly.Xml.domToText(t)),o.appendChild(t),pxsim.U.removeClass(o,"loading")}else{const e=document.createElement("span");e.textContent=lf("Oops, something went wrong trying to render this block snippet."),o.appendChild(e),pxsim.U.removeClass(o,"loading")}})))}pxt.Util.toArray(e.querySelectorAll("img")).forEach((e=>{a.push(new Promise(((t,n)=>{e.addEventListener("load",(()=>t()),!1),e.addEventListener("error",(()=>t()),!1)})))})),pxt.Util.toArray(e.querySelectorAll("code.lang-typescript,code.lang-python")).forEach((e=>{const t=e.textContent,n=this.startRenderLangSnippet(e);this.finishRenderLangSnippet(n,t)})),pxt.Util.toArray(e.querySelectorAll("code.lang-spy")).forEach((e=>{a.push(this.cachedRenderLangSnippetAsync(e,(e=>t.renderPythonAsync({type:"pxteditor",action:"renderpython",ts:e}).then((e=>e.python)))))})),pxt.Util.toArray(e.querySelectorAll("code.lang-diffspy")).forEach((e=>{a.push(this.cachedRenderLangSnippetAsync(e,(e=>{const{fileA:n,fileB:r}=pxt.diff.split(e);return pxt.Util.promiseMapAllSeries([n,r],(e=>t.renderPythonAsync({type:"pxteditor",action:"renderpython",ts:e}).then((e=>e.python)))).then((e=>pxt.diff.render(e[0],e[1],o||{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0})))})))})),pxt.Util.toArray(e.querySelectorAll("code.lang-diff,code.lang-diffpython")).forEach((e=>{a.push(this.cachedRenderLangSnippetAsync(e,(e=>{const{fileA:t,fileB:n}=pxt.diff.split(e),r=pxt.diff.render(t,n,o||{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0});return Promise.resolve(r)})))})),pxt.Util.toArray(e.querySelectorAll("code.lang-blocks")).forEach((e=>c(e,!1))),pxt.Util.toArray(e.querySelectorAll("code.lang-block")).forEach((e=>c(e,!0))),pxt.Util.toArray(e.querySelectorAll("code.lang-diffblocksxml")).forEach((e=>{const t=e.textContent,{fileA:n,fileB:r}=pxt.diff.split(t);a.push(this.cachedRenderLangSnippetAsync(e,(e=>pxt.BrowserUtils.loadBlocklyAsync().then((()=>l(pxt.blocks.diffXml(n,r,i)))))))})),pxt.Util.toArray(e.querySelectorAll("code.lang-diffblocks")).forEach((e=>{const t=e.textContent,{fileA:n,fileB:r}=pxt.diff.split(t);a.push(this.cachedRenderLangSnippetAsync(e,(e=>pxt.BrowserUtils.loadBlocklyAsync().then((()=>s.getBlocksAsync())).then((e=>pxt.Util.promiseMapAllSeries([n,r],(t=>s.decompileBlocksSnippetAsync(t,e))))).then((e=>pxt.blocks.decompiledDiffAsync(n,e[0],r,e[1],i||{hideDeletedTopBlocks:!0,hideDeletedBlocks:!0}))).then((e=>l(e))))))})),(a=a.filter((e=>!!e))).length&&r&&Promise.all(a).then((()=>{pxt.log("markdowcontent: forcing update after async rendering"),r()}))}renderVideo(e){pxt.Util.toArray(e.querySelectorAll("iframe.yt-embed")).forEach((e=>{var t,n;let r=null!==(n=null===(t=pxt.appTarget.appTheme)||void 0===t?void 0:t.defaultLocale)&&void 0!==n?n:"en";const i=e.getAttribute("src");let o=new URL(i);pxt.tickEvent("video.loaded",{player:"youtube",url:i}),o.searchParams.append("hl",r),e.setAttribute("src",o.toString())})),pxt.Util.toArray(e.querySelectorAll("Video.ams-embed")).forEach((e=>{let t=(0,a.MediaPlayer)().create();t.initialize(e,e.getAttribute("src"),!1);const n=e.getAttribute("src");let r=new URL(n);pxt.tickEvent("video.loaded",{player:"azure",url:n});const i=t.getVideoElement(),o=parseInt(r.searchParams.get("startTime"))||0,s=parseInt(r.searchParams.get("endTime"));if(s&&t.on(l.MediaPlayer.events.PLAYBACK_TIME_UPDATED,(e=>{s<=e.time&&(i.currentTime=o,t.pause())})),null==i?void 0:i.requestPictureInPicture){i.addEventListener("enterpictureinpicture",(()=>{i.setAttribute("data-pip-active","true")})),i.addEventListener("leavepictureinpicture",(()=>{i.setAttribute("data-pip-active",void 0),t.pause()}));const n=document.createElement("button");e.parentElement.appendChild(n),n.addEventListener("click",(()=>{pxt.tickEvent("video.pip.requested"),i.requestPictureInPicture()})),n.addEventListener("keydown",(e=>(0,c.fireClickOnEnter)(e))),n.className="common-button",n.textContent=lf("Pop out video"),n.ariaLabel=lf("Open video in picture-in-picture mode"),n.title=n.ariaLabel}else if(pxt.BrowserUtils.isFirefox()){const t=document.createElement("button");e.parentElement.appendChild(t),t.addEventListener("click",(()=>{pxt.tickEvent("video.pip.firefoxHelp"),window.open("/firefox-picture-in-picture","_blank")})),t.addEventListener("keydown",(e=>(0,c.fireClickOnEnter)(e))),t.className="common-button",t.textContent=lf("Pop out video"),t.ariaLabel=lf("Instructions on how to open video in picture-in-picture mode"),t.title=t.ariaLabel}t.on(l.MediaPlayer.events.PLAYBACK_STARTED,(e=>{pxt.tickEvent("video.playback.started",{player:"azure",url:n})}))}))}renderInlineBlocks(e){const t=pxt.Util.toArray(e.querySelectorAll(":not(pre) > code")).map((e=>{const t=e.innerText,n=/^(\|+)([^\|]+)\|+$/.exec(t);if(n){const t=/^(([^:.]*?)[:.])?(.*)$/.exec(n[2]),r=t[3].trim(),i=1==n[1].length,o=t[2]?t[2].trim().toLowerCase():"",s=/^([^()]+)\(([^()]+)\)$/.exec(o),a=pxt.Util.htmlEscape((null==s?void 0:s[1])||o),l=pxt.Util.htmlEscape((null==s?void 0:s[2])||o),c=i?`docs inlinebutton ui button ${pxt.Util.htmlEscape(r.toLowerCase())}-button`:`docs inlineblock ${a}`,u=document.createElement("span");return pxsim.U.clear(e),e.appendChild(u),u.className=c,u.textContent=pxt.U.rlf(r),u.setAttribute("data-ns",l),a!==l&&u.setAttribute("data-norecolor","true"),!i&&u}})).filter((e=>!!e));s.getBlocksAsync().then((e=>{var n,r;const i=Object.keys(e.apis.byQName).filter((t=>{var n;return 5===(null===(n=e.apis.byQName[t])||void 0===n?void 0:n.kind)}));for(const o of t){let t=o.getAttribute("data-ns");const s=i.find((e=>t.toLowerCase()==e.toLowerCase()));s&&t!==s&&(t=s);const a=e.apis.byQName[t];let l=null===(n=null==a?void 0:a.attributes)||void 0===n?void 0:n.color;if(/^logic$/i.test(t))t="logic",l=pxt.toolbox.getNamespaceColor(t);else if(/^functions?$/i.test(t))t="functions",l=pxt.toolbox.getNamespaceColor(t);else if(/^variables?$/i.test(t))t="variables",l=pxt.toolbox.getNamespaceColor(t);else if(/^arrays?$/i.test(t))t="arrays",l=pxt.toolbox.getNamespaceColor(t);else if(5!==(null==a?void 0:a.kind))continue;const u=(null===(r=null==a?void 0:a.attributes)||void 0===r?void 0:r.advanced)||"arrays"===t;o.classList.add("clickable"),o.tabIndex=0,o.ariaLabel=lf("Toggle the {0} category",t),o.title=o.ariaLabel,l&&!o.getAttribute("data-norecolor")&&(o.style.backgroundColor=l,o.style.borderColor=pxt.toolbox.fadeColor(l,.1,!1)),o.addEventListener("click",(e=>{const n='#maineditor > div:not([style*="display:none"]):not([style*="display: none"])';if(u){const e=`${n} .blocklyTreeRow[data-ns="advancedcollapsed"]`,t=document.querySelector(e);null==t||t.click()}const r=`${n} .blocklyTreeRow[data-ns="${t}"]`,i=document.querySelector(r);null==i||i.click()})),o.addEventListener("keydown",(e=>(0,c.fireClickOnEnter)(e)))}}))}renderBullets(e){const t=/^:([^:]+):/i;pxt.Util.toArray(e.querySelectorAll("li")).forEach((e=>{const n=e.innerHTML.match(t);if(null==n?void 0:n[1]){const t=document.createElement("p");pxt.Util.toArray(e.childNodes).forEach((e=>t.appendChild(e))),e.appendChild(t)}})),pxt.Util.toArray(e.querySelectorAll("li > p")).forEach((e=>{const n=e.innerText.match(t);if(null==n?void 0:n[1]){const r=pxt.Util.toArray(e.childNodes).find((e=>"#text"===e.nodeName));(null==r?void 0:r.nodeValue)&&(r.nodeValue=r.nodeValue.replace(t,""));const i=e.parentElement;i.className+=" formatted-bullet-li";const o=i.parentElement;o.classList.contains("formatted-bullet-ul")||(o.className+=" formatted-bullet-ul");const s=document.createElement("div");s.className="formatted-bullet";const a=document.createElement("i");let l=n[1].split(" "),c=l.filter((e=>this.semanticIconNames.indexOf(e)>=0));c.length?a.className=`ui icon ${c.join(" ")}`:(c=l.filter((e=>this.customIconNames.indexOf(e)>=0)),a.className=`ui xicon ${c.join(" ")}`),s.appendChild(a),i.insertBefore(s,e)}}))}renderAccordianHints(e){const t=/^\s*~hint\s*(.+)\n?([\s\S]*)/i,n=/([\s\S]*\n|^.*)hint~\s*/im;class r{constructor(){this.beginElement=null,this.summary=null,this.childNodes=[]}}let i=[],o=null;for(let s of e.childNodes)if(s instanceof HTMLElement){const e=s;if(null==o&&"p"===e.tagName.toLowerCase()){const n=e.innerHTML.match(t);if(n&&((o=new r).beginElement=e,o.summary=document.createElement("summary"),o.summary.append(n[1]),0!=n[2].length)){const e=document.createElement("p");e.append(n[2].replace("hint~","")),o.childNodes.push(e)}}null!=o&&(o.beginElement!=e&&o.childNodes.push(e),e.innerHTML.match(n)&&(e.innerHTML=e.innerHTML.replace("hint~",""),i.push(o),o=null))}else null!=o&&o.childNodes.push(s);i.forEach((e=>{const t=document.createElement("details");t.addEventListener("pointerdown",(()=>{const e=t.querySelectorAll("video");for(const t of e)t.getAttribute("data-pip-active")||t.pause()})),t.addEventListener("keydown",c.fireClickOnEnter),t.append(e.summary),e.childNodes.forEach((e=>{t.appendChild(e)})),e.beginElement.parentNode.replaceChild(t,e.beginElement)}))}renderOthers(e){pxt.Util.toArray(e.querySelectorAll(".lang-package,.lang-config,.lang-apis")).forEach((e=>{e.parentNode.removeChild(e)}))}renderMarkdown(e){const t=this.refs["marked-content"],n=this.getBuiltinMacros();if(!e)return;pxt.perf.measureStart("renderMarkdown"),e=e.replace(/@([a-z]+)@/gi,((e,t)=>n[t]||"unknown macro"));let r=new o.Renderer;pxt.docs.setupRenderer(r);const i=r.link;r.link=function(e,t,n){const o=/^[\/#]/.test(e)?"":"_blank";return i.call(r,e,t,n).replace(/^<a /,`<a ${o?`target="${o}"`:""} rel="nofollow noopener" `)},o.setOptions({renderer:r,sanitize:!0,sanitizer:pxt.docs.requireDOMSanitizer()}),e=e.replace(/<\s*script[^>]*>.*<\/\s*script[^>]*>/gi,"");const s=document.createElement("div");s.innerHTML=o(e),this.renderInlineBlocks(s),this.renderSnippets(s),this.renderBullets(s),this.renderAccordianHints(s),this.renderOthers(s),this.renderVideo(s),t.innerHTML="",t.append(...s.childNodes),pxt.perf.measureEnd("renderMarkdown")}componentDidMount(){const{markdown:e}=this.props;this.renderMarkdown(e)}UNSAFE_componentWillReceiveProps(e){const{markdown:t}=e;this.props.markdown!=e.markdown&&this.renderMarkdown(t)}renderCore(){const{className:e,tabIndex:t}=this.props;return(0,r.jsx)("div",{ref:"marked-content",className:e||"",tabIndex:t})}}n.MarkedContent=u,u.blockSnippetCache={}},{"../../react-common/components/util":41,"./compiler":58,"./data":136,dashjs:231,marked:273,"react/jsx-runtime":367}],168:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.provider=n.merge=n.projects=void 0;var r=pxt.Util;n.projects={},n.merge=function(e){let t=e.header;t||(e.header=t=pxt.workspace.freshHeader(lf("Untitled"),r.nowSeconds()),e.text&&e.text[pxt.MAIN_BLOCKS]&&(e.header.editor=pxt.BLOCKS_PROJECT_NAME)),n.projects[e.header.id]=e},n.provider={getAsync:function(e){let t=n.projects[e.id];return Promise.resolve({header:e,text:t?t.text:{},version:null})},setAsync:function(e,t,r){return r&&(n.projects[e.id]={header:e,text:r}),Promise.resolve()},deleteAsync:function(e,t){return delete n.projects[e.id],Promise.resolve()},listAsync:function(){return Promise.resolve(r.values(n.projects).map((e=>e.header)))},resetAsync:function(){return n.projects={},Promise.resolve()}}},{}],169:[function(e,t,n){"use strict";function r(e,t){var n;if(!e)return t;if(!t)return e;const r=JSON.parse(e),i=JSON.parse(t),o={},s={},a={},l={},c={},u=i["*"].mimeType;for(const e of Object.keys(i)){if("*"===e)continue;const t=i[e];let n;a[e]=!0;let r=u,l=!1;"string"==typeof t?n=t:(n=t.data,r=t.mimeType,l=!!t.tilemapTile,t.displayName&&(s[t.displayName]=!0)),r!==pxt.TILEMAP_MIME_TYPE&&(o[r+l+n]=e)}for(const e of Object.keys(r)){if("*"===e)continue;const t=r[e];let n,d,p=u,h=!1,f=!1;"string"==typeof t?(n=t,f=!0):(n=t.data,d=t.displayName,p=t.mimeType,h=!!t.tilemapTile);const g=p+h+n;if(o[g]){h&&(l[pxt.sprite.TILE_NAMESPACE+"."+e]=pxt.sprite.TILE_NAMESPACE+"."+o[g]);continue}if(!d)switch(p){case pxt.IMAGE_MIME_TYPE:d=h?`${pxt.sprite.TILE_NAMESPACE}.${pxt.sprite.TILE_PREFIX}`:`${pxt.sprite.IMAGES_NAMESPACE}.${pxt.sprite.IMAGE_PREFIX}`;break;case pxt.TILEMAP_MIME_TYPE:d="tilemap";break;case pxt.ANIMATION_MIME_TYPE:d=`${pxt.sprite.ANIMATION_NAMESPACE}.${pxt.sprite.ANIMATION_PREFIX}`}if(d&&s[d]){let e=0;for(;s[d+e];)e++;s[d+=e]=!0}let m=e;if(a[m]){let t=0;for(;a[m+t];)t++;a[m+=t]=!0,h&&(l[pxt.sprite.TILE_NAMESPACE+"."+e]=pxt.sprite.TILE_NAMESPACE+"."+m)}p!==pxt.TILEMAP_MIME_TYPE&&(o[g]=e);const v=Object.assign(Object.assign({},f?{}:r[e]),{data:n,displayName:d,mimeType:p});v.id&&(v.id=m),p===pxt.TILEMAP_MIME_TYPE?c[m]=v:i[m]=v}for(const e of Object.keys(c)){const t=c[e];t.tileset=null===(n=t.tileset)||void 0===n?void 0:n.map((e=>l[e]||e)),i[e]=t}return JSON.stringify(i)}function i(e,t){if(!e)return t;let n=pxt.U.jsonTryParse(t)||{};n["*"]||(n["*"]={mimeType:"image/x-mkcd-f4",dataEncoding:"base64",namespace:pxt.sprite.IMAGES_NAMESPACE});let r=0;return function(e){const t=[];return e.replace(/<field name=\"[\da-zA-Z]+\">\s*(img`[\s\da-f.#tngrpoyw]+`)\s*<\/field>/gim,((e,n)=>{var r;const i=null===(r=pxt.sprite.imageLiteralToBitmap(n))||void 0===r?void 0:r.data();return i&&t.push(i),e})),t}(e).forEach((e=>{const t=pxt.Util.guidGen();for(;n[`${pxt.sprite.IMAGES_NAMESPACE}.${pxt.sprite.IMAGE_PREFIX}${r}`];)r++;n[t]={data:pxt.sprite.base64EncodeBitmap(e),mimeType:pxt.IMAGE_MIME_TYPE,displayName:`${pxt.sprite.IMAGES_NAMESPACE}.${pxt.sprite.IMAGE_PREFIX}${r}`},r++})),r=0,function(e){const t=[];return e.replace(/<field name=\"[\da-zA-Z]+\">\s*\[((?:img`[\s\da-f.#tngrpoyw]+`,?)+)\]\s*<\/field>(?:.*<shadow type=\"timePicker\"><field name=\"ms\">(\d+)<\/field><\/shadow>)?/gim,((e,n,r)=>{const i=n.split(",").map((e=>{var t;return null===(t=pxt.sprite.imageLiteralToBitmap(e))||void 0===t?void 0:t.data()}));return t.push({frames:i.filter((e=>!!e)),interval:r||500}),e})),t}(e).forEach((e=>{const t=pxt.Util.guidGen();for(;n[`${pxt.sprite.ANIMATION_NAMESPACE}.${pxt.sprite.ANIMATION_NAMESPACE}${r}`];)r++;n[t]={data:pxt.sprite.encodeAnimationString(e.frames,e.interval),mimeType:pxt.ANIMATION_MIME_TYPE,displayName:`${pxt.sprite.ANIMATION_NAMESPACE}.${pxt.sprite.ANIMATION_PREFIX}${r}`},r++})),JSON.stringify(n)}Object.defineProperty(n,"__esModule",{value:!0}),n.appendTemporaryAssets=n.mergeProjectCode=void 0,n.mergeProjectCode=function(e,t,n){var o,s;const a=t[pxt.CONFIG_NAME],l=pxt.U.jsonTryParse(a),c=n?r(t[pxt.TILEMAP_JRES],e[pxt.TILEMAP_JRES]):r(e[pxt.TILEMAP_JRES],t[pxt.TILEMAP_JRES]),u=n?r(t[pxt.IMAGES_JRES],e[pxt.IMAGES_JRES]):r(i(e[pxt.MAIN_BLOCKS],e[pxt.IMAGES_JRES]),t[pxt.IMAGES_JRES]);return c&&(null===(o=null==l?void 0:l.files)||void 0===o?void 0:o.indexOf(pxt.TILEMAP_JRES))<0&&l.files.push(pxt.TILEMAP_JRES),u&&(null===(s=null==l?void 0:l.files)||void 0===s?void 0:s.indexOf(pxt.IMAGES_JRES))<0&&l.files.push(pxt.IMAGES_JRES),Object.assign(Object.assign({},t),{[pxt.MAIN_TS]:n?e[pxt.MAIN_TS]:t[pxt.MAIN_TS],[pxt.MAIN_PY]:n?e[pxt.MAIN_PY]:t[pxt.MAIN_PY],[pxt.MAIN_BLOCKS]:n?e[pxt.MAIN_BLOCKS]:t[pxt.MAIN_BLOCKS],[pxt.TILEMAP_JRES]:c,[pxt.IMAGES_JRES]:u,[pxt.CONFIG_NAME]:JSON.stringify(l)})},n.appendTemporaryAssets=i},{}],170:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.rangeToSelection=n.Editor=void 0;const r=e("react/jsx-runtime"),i=e("react-dom"),o=e("./package"),s=e("./core"),a=e("./toolboxeditor"),l=e("./compiler"),c=e("./monacoSnippets"),u=e("./monacopyhelper"),d=e("./simulator"),p=e("./toolbox"),h=e("./blocklyFieldView"),f=e("./monacoFieldEditorHost"),g=e("./data");var m=pxt.Util;const v=e("./monacoDebugger"),y=e("./debuggerToolbox"),b=e("./monacoEditAmendments"),x=e("./monacoFlyout"),E=e("./errorList"),_=e("./auth");class w{constructor(e,t){this.editor=e,this.python=t,this.triggerCharacters=["(","."],this.kindMap={}}tsKindToMonacoKind(e){switch(e){case 1:return monaco.languages.CompletionItemKind.Method;case 2:return monaco.languages.CompletionItemKind.Property;case 3:return monaco.languages.CompletionItemKind.Function;case 4:return monaco.languages.CompletionItemKind.Variable;case 5:return monaco.languages.CompletionItemKind.Module;case 6:return monaco.languages.CompletionItemKind.Class;case 7:return monaco.languages.CompletionItemKind.Enum;case 8:return monaco.languages.CompletionItemKind.Class;case 9:return monaco.languages.CompletionItemKind.Interface;default:return monaco.languages.CompletionItemKind.Text}}provideCompletionItems(e,t,n,r){const i=e.getOffsetAt(t),o=e.getValue(),s=this.editor.currFile.name,a=e.getWordUntilPosition(t),c=e.getOffsetAt({lineNumber:t.lineNumber,column:a.startColumn}),u=e.getOffsetAt({lineNumber:t.lineNumber,column:a.endColumn});return l.completionsAsync(s,i,c,u,o,pxt.options.light).then((n=>{function r(e){if(!e)return e;for(let t of n.namespace){if(!e.startsWith(t+"."))break;e=e.substr((t+".").length)}return e}let i=n.entries||[];return{suggestions:(i=i.filter((e=>"_"!=e.name.charAt(0)))).map(((i,o)=>{let s=this.python?i.pySnippetWithMarkers:i.snippetWithMarkers;const a=!!s,l=this.python?i.pySnippet:i.snippet;let c=a?s:l;c=r(c);let u=r(this.python?i.pyQName:i.qName),p=this.python?i.pyName:i.name,h=c&&c.indexOf("\n")>=0;if(this.python&&c&&h&&pxt.blocks.hasHandler(i))c=(0,b.amendmentToInsertSnippet)((0,b.createLineReplacementPyAmendment)(c));else if(c=c||u,n.isMemberCompletion&&c){const e=c.lastIndexOf(p);-1!==e&&(c=c.substr(e))}const f=n.isMemberCompletion?p:u,g=pxt.Util.rlf(i.attributes.jsDoc),m=pxt.Util.rlf(i.attributes.block),v=e.getWordAtPosition(t),y={startLineNumber:t.lineNumber,startColumn:v?v.startColumn:t.column,endColumn:t.column,endLineNumber:t.lineNumber},x=`${f},${g},${m}`.replace(/\s/g,","),E=this.tsKindToMonacoKind(i.kind);return{label:f,range:y,kind:E,documentation:g,detail:`(${monaco.languages.CompletionItemKind[E].toLowerCase()}) ${l||""}`,sortText:`${d(o)} ${c}`,filterText:x,insertText:c||void 0,insertTextRules:a?monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet:void 0}}))}}));function d(e){return("000"+e).slice(-4)}}}class S{constructor(e,t){this.editor=e,this.python=t,this.signatureHelpTriggerCharacters=["(",","],this.isPython=!1,this.isPython=t}provideSignatureHelp(e,t,n,r){const i=e.getOffsetAt(t),o=e.getValue(),s=this.editor.currFile.name;return l.syntaxInfoAsync("signature",s,i,o).then((e=>{let t=e.symbols?e.symbols[0]:null;if(!t||!t.parameters)return null;const n=pxt.Util.rlf(t.attributes.jsDoc);let r=t.parameters.map((e=>({label:`${e.name}: ${this.isPython?e.pyTypeString:e.type}`,documentation:pxt.Util.rlf(e.description)})));return{value:{signatures:[{label:`${this.isPython&&t.pyName?t.pyName:t.name}(${r.map((e=>e.label)).join(", ")})`,documentation:n,parameters:r}],activeSignature:0,activeParameter:e.auxResult},dispose:()=>{}}}))}}class T{constructor(e,t){this.editor=e,this.python=t}provideHover(e,t,n){if(this.editor.hasInsertionSnippet())return null;const r=e.getOffsetAt(t),i=e.getValue(),o=this.editor.currFile.name;return l.syntaxInfoAsync("symbol",o,r,i).then((t=>{let n,r=t.symbols?t.symbols[0]:null;if(r){const e=pxt.Util.rlf(r.attributes.jsDoc);n=[t.auxResult[0],e]}else t.auxResult&&(n=[t.auxResult.displayString,t.auxResult.documentation]);return n?{contents:n.map(k),range:monaco.Range.fromPositions(e.getPositionAt(t.beginPos),e.getPositionAt(t.endPos))}:null}))}}function k(e){return{value:e}}const C={comments:{lineComment:"#",blockComment:['"""','"""']},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"',notIn:["string"]},{open:'r"',close:'"',notIn:["string","comment"]},{open:'R"',close:'"',notIn:["string","comment"]},{open:'u"',close:'"',notIn:["string","comment"]},{open:'U"',close:'"',notIn:["string","comment"]},{open:'f"',close:'"',notIn:["string","comment"]},{open:'F"',close:'"',notIn:["string","comment"]},{open:'b"',close:'"',notIn:["string","comment"]},{open:'B"',close:'"',notIn:["string","comment"]},{open:"'",close:"'",notIn:["string","comment"]},{open:"r'",close:"'",notIn:["string","comment"]},{open:"R'",close:"'",notIn:["string","comment"]},{open:"u'",close:"'",notIn:["string","comment"]},{open:"U'",close:"'",notIn:["string","comment"]},{open:"f'",close:"'",notIn:["string","comment"]},{open:"F'",close:"'",notIn:["string","comment"]},{open:"b'",close:"'",notIn:["string","comment"]},{open:"B'",close:"'",notIn:["string","comment"]},{open:"`",close:"`",notIn:["string"]}],onEnterRules:[{beforeText:/^\s*(?:def|class|for|if|elif|else|while|try|with|finally|except|async).*?:\s*$/,action:{indentAction:1}}]};class A{constructor(e,t){this.editor=e,this.python=t,this.isPython=!1,this.isPython=t}provideDocumentRangeFormattingEdits(e,t,n,r){return Promise.resolve().then((i=>this.isPython?u.provideDocumentRangeFormattingEdits(e,t,n,r):null))}}const j={cpp:"cpp",h:"cpp",json:"json",md:"markdown",py:"python",ts:"typescript",js:"javascript",svg:"xml",blocks:"xml",asm:"asm"};class I extends a.ToolboxEditor{constructor(e){super(e),this.fileType="text",this.giveFocusOnLoading=!0,this.foldFieldEditorRanges=!0,this.hasFieldEditors=!(!pxt.appTarget.appTheme.monacoFieldEditors||!pxt.appTarget.appTheme.monacoFieldEditors.length),this.highlightDecorations=[],this.errorChangesListeners={},this.exceptionChangesListeners={},this.userPreferencesSubscriber={subscriptions:[],onDataChanged:()=>{this.onUserPreferencesChanged()}},this.handleFlyoutWheel=e=>e.stopPropagation(),this.handleFlyoutScroll=e=>e.stopPropagation(),this.insertSnippet=(e,t,n=!1)=>{let r=this.editor.getPosition(),i=this.editor.getModel();if(e||(e=r),!e)return;let o,s=e.clone();"NewLineAfter"==(o=n?"Inline":1===e.column?"NewLineBefore":"NewLineAfter")&&(s=s.with(s.lineNumber,i.getLineMaxColumn(e.lineNumber)));const a=i.getLineContent(e.lineNumber);"Inline"===o||!a||("NewLineAfter"===o?t="\n"+t:t+="\n");const l=e=>{let t=e.match(/^\s*/)[0]||"";return t=t.replace("\t"," ".repeat(4)),Math.floor(t.length/4)},c=l(a);let u;if("NewLineAfter"===o){const t=Math.min(e.lineNumber+1,i.getLineCount()),n=l(i.getLineContent(t));u=Math.max(c,n)}else u="NewLineBefore"===o?c:0;const d=" ".repeat(4*u);if(d){let e=t.split("\n");t=(e=e.map((e=>e?d+e:e))).join("\n")}this.editor.pushUndoStop(),this.editor.executeEdits("",[{range:new monaco.Range(s.lineNumber,s.column,s.lineNumber,s.column),text:t||"",forceMoveMarkers:!0}]),this.beforeCompile(),this.editor.pushUndoStop(),this.editor.focus()},this.dragCurrentPos={x:0,y:0},this.onDragBlockThrottled=m.throttle((()=>{const{x:e,y:t}=this.dragCurrentPos;let n=this.editor.getTargetAtClientPoint(e,t);n&&n.position&&this.editor.getPosition()!=n.position&&this.editor.setPosition(n.position),this.editor.focus()}),200),this.onPointerMove=e=>{this.insertionSnippet&&(this.dragCurrentPos={x:pxt.BrowserUtils.getClientX(e),y:pxt.BrowserUtils.getClientY(e)},this.onDragBlockThrottled(e))},this.onPointerUp=e=>{let t=this.insertionSnippet;if(this.setInsertionSnippet(void 0),t){let n=pxtc.U.startsWith(t,"inline:1&");n&&(t=t.substring("inline:1&".length));let r=Promise.resolve(t);if(pxtc.U.startsWith(t,"qName:")){let e="python"==this.fileType,n=t.substring("qName:".length);r=(e?this.parent.saveFileAsync():Promise.resolve()).then((()=>l.snippetAsync(n,e)))}r.then((t=>{let r=this.editor.getTargetAtClientPoint(pxt.BrowserUtils.getClientX(e),pxt.BrowserUtils.getClientY(e)).position;pxt.tickEvent("monaco.toolbox.insertsnippet"),this.insertSnippet(r,t,n)}))}},this.moveFocusToToolbox=()=>{this.toolbox&&this.toolbox.focus()},this.revealBreakpointLocation=(e,t)=>{if(!this.breakpoints)return;const n=this.breakpoints.getLocationOfBreakpoint(e);n&&(this.highlightedBreakpoint=e,this.currFile.getTextFileName()!==n.fileName?(o.mainEditorPkg(),P(n.fileName)&&this.parent.setFile(P(n.fileName))):this.highilightStatementCore(n,!0),this.debuggerToolbox&&this.debuggerToolbox.setState({currentFrame:t}))},this.setInsertionSnippet=e=>{this.insertionSnippet=e},this.hasInsertionSnippet=()=>!!this.insertionSnippet,this.uniqueBlockId=0,this.handleToolboxRef=e=>{this.toolbox=e},this.handleDebugToolboxRef=e=>{e&&(this.debuggerToolbox=e,this.isDebugging()&&this.updateToolbox())},this.handleFlyoutRef=e=>{e&&(this.flyout=e)},this.setErrorListState=this.setErrorListState.bind(this),this.listenToErrorChanges=this.listenToErrorChanges.bind(this),this.listenToExceptionChanges=this.listenToExceptionChanges.bind(this),this.goToError=this.goToError.bind(this),this.startDebugger=this.startDebugger.bind(this),this.onUserPreferencesChanged=this.onUserPreferencesChanged.bind(this),g.subscribe(this.userPreferencesSubscriber,_.HIGHCONTRAST)}onUserPreferencesChanged(){const e=g.getData(_.HIGHCONTRAST);this.loadMonacoPromise&&this.defineEditorTheme(e,!0)}hasBlocks(){if(!this.currFile)return!0;let e=this.currFile.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME);return e&&null!=o.mainEditorPkg().files[e]}openBlocks(){this.openBlocksAsync()}async openBlocksAsync(){pxt.tickEvent("typescript.showBlocks");let e=Promise.resolve();if(!this.currFile){const e=o.mainEditorPkg();if(!e||!e.files[pxt.MAIN_TS])return;await this.loadFileAsync(e.files[pxt.MAIN_TS])}let t=e.then((()=>{const e="python"==this.fileType,t=e?"python":"typescript";pxt.tickEvent(`${t}.convertBlocks`);const n=o.mainEditorPkg();if(!this.hasBlocks()&&!n&&!n.files[pxt.MAIN_BLOCKS])return void pxt.debug("cancelling convertion to blocks, but main.blocks is missing");this.feWidget&&(this.feWidget.close(),this.activeRangeID=null);let r=this.currFile.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME),i=e?this.currFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME):this.currFile.name;if(!this.hasBlocks()){if(!n||!n.files[pxt.MAIN_BLOCKS])return void(n&&this.parent.setFile(n.files[pxt.MAIN_TS]));this.currFile=n.files[pxt.MAIN_TS],r=this.currFile.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME),i=pxt.MAIN_TS}const a=(e,t=!1)=>(s.cancelAsyncLoading("switchtoblocks"),this.forceDiagnosticsUpdate(),this.showBlockConversionFailedDialog(e,t));let c,u;return this.parent.saveFileAsync().then((()=>this.parent.saveFileAsync())).then((()=>this.parent.loadBlocklyAsync())).then((()=>this.saveToTypeScriptAsync())).then((()=>l.getBlocksAsync())).then((e=>{if(u=e,pxt.blocks.cleanBlocks(),pxt.blocks.initializeAndInject(u),!pxt.blocks.validateAllReferencedBlocksExist(n.files[r].content))return[void 0,!0];const i=pxt.blocks.loadWorkspaceXml(n.files[r].content);return i?pxt.blocks.compileAsync(i,u).then((e=>{const o=e.source;return l.formatAsync(o,0).then((e=>l.formatAsync(this.editor.getValue(),0).then((o=>e.formatted==o.formatted?(pxt.debug(`${t} not changed, skipping decompile`),pxt.tickEvent(`${t}.noChanges`),this.parent.setFile(n.files[r]),[i,!1]):[i,!0]))))})):[i,!0]})).then((e=>{if(!e)return Promise.resolve();const t=e[0];return e[1]?l.compileAsync().then((e=>e.success?this.transpileToBlocksInternalAsync(this.currFile,u,t).then((e=>{if(!e.success){const t=e.failedResponse;this.currFile.diagnostics=t.diagnostics;let n=!1;return t.diagnostics.forEach((e=>n=n||9266===e.code)),a(r,n)}return c=e.outText,m.assert(!!c),n.setContentAsync(r,c).then((()=>this.parent.setFile(n.files[r])))})):a(r,!1))):Promise.resolve()})).catch((e=>{pxt.reportException(e),s.errorNotification(lf("Oops, something went wrong trying to convert your code."))}))}));return s.showLoadingAsync("switchtoblocks",lf("switching to blocks..."),t),e}showBlockConversionFailedDialog(e,t){const n="python"==this.fileType,r=n?"python":"typescript";let i,a,l=o.mainEditorPkg().files[e];return t&&pxt.tickEvent(`${r}.programTooLarge`),n?(i=t?lf("Your program is too large to convert into blocks. You can keep working in Python or discard your changes and go back to the previous Blocks version."):lf("We are unable to convert your Python code back to blocks. You can keep working in Python or discard your changes and go back to the previous Blocks version."),a=lf("Stay in Python")):(i=t?lf("Your program is too large to convert into blocks. You can keep working in JavaScript or discard your changes and go back to the previous Blocks version."):lf("We are unable to convert your JavaScript code back to blocks. You can keep working in JavaScript or discard your changes and go back to the previous Blocks version."),a=lf("Stay in JavaScript")),s.confirmAsync({header:t?lf("Program too large"):lf("Oops, there is a problem converting your code."),body:i,agreeLbl:lf("Discard and go to Blocks"),agreeClass:"cancel",agreeIcon:"cancel",disagreeLbl:a,disagreeClass:"positive",disagreeIcon:"checkmark",hideCancel:!l}).then((e=>{e?(pxt.tickEvent(`${r}.discardText`,void 0,{interactiveConsent:!0}),this.parent.saveBlocksToTypeScriptAsync().then((e=>{this.overrideFile(e),this.parent.setFile(l)}))):pxt.tickEvent(`${r}.keepText`,void 0,{interactiveConsent:!0})}))}transpileToBlocksInternalAsync(e,t,n){const r=o.mainEditorPkg(),i=e.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME),s=e.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME),a="py"===e.getExtension()?"py":"ts",c=e.content,u=r.getCachedTranspile(a,c,"blocks");return null!=u?Promise.resolve({success:!0,outText:u}):l.decompileAsync(i,t,n,s).then((e=>{if(!e.success)return{success:!1,failedResponse:e};const t=e.outfiles[s];return r.cacheTranspile(a,c,"blocks",t),{success:!0,outText:t}}))}decompileAsync(e){return l.decompileAsync(e)}setVisible(e){super.setVisible(e),e||this.onErrorChanges([])}display(){const e=pxt.appTarget.appTheme.errorList,t=pxt.BrowserUtils.isAndroid();return(0,r.jsxs)("div",Object.assign({id:"monacoEditorArea",className:"monacoEditorArea "+(t?"android":""),style:{direction:"ltr"}},{children:[this.isVisible&&(0,r.jsxs)("div",Object.assign({className:"monacoToolboxDiv "+(!this.toolbox||this.toolbox.state.visible||this.isDebugging()?"":"invisible")},{children:[(0,r.jsx)(p.Toolbox,{ref:this.handleToolboxRef,editorname:"monaco",parent:this}),(0,r.jsx)("div",{id:"monacoDebuggerToolbox"})]})),(0,r.jsxs)("div",Object.assign({id:"monacoEditorRightArea",className:"monacoEditorRightArea"},{children:[(0,r.jsx)("div",Object.assign({id:"monacoEditorInner"},{children:(0,r.jsx)(x.MonacoFlyout,{ref:this.handleFlyoutRef,fileType:this.fileType,blockIdMap:this.blockIdMap,moveFocusToParent:this.moveFocusToToolbox,insertSnippet:this.insertSnippet,setInsertionSnippet:this.setInsertionSnippet,parent:this.parent})})),e&&(0,r.jsx)(E.ErrorList,{isInBlocksEditor:!1,onSizeChange:this.setErrorListState,listenToErrorChanges:this.listenToErrorChanges,listenToExceptionChanges:this.listenToExceptionChanges,goToError:this.goToError,startDebugger:this.startDebugger})]}))]}))}listenToExceptionChanges(e,t){this.exceptionChangesListeners[e]=t}onExceptionDetected(e){for(let t of pxt.U.values(this.exceptionChangesListeners))t(e,this.callLocations)}listenToErrorChanges(e,t){this.errorChangesListeners[e]=t}goToError(e){let t,n;e.endLine&&e.endColumn?(t=e.endLine+1,n=e.endColumn+1):(t=e.line+1,n=e.column+e.length+1),this.editor.revealLineInCenter(t),this.editor.setPosition({column:n,lineNumber:t}),this.editor.focus()}startDebugger(){pxt.tickEvent("errorList.startDebugger",null,{interactiveConsent:!0}),this.parent.toggleDebugging()}onErrorChanges(e){for(let t of pxt.U.values(this.errorChangesListeners))t(e)}showPackageDialog(){pxt.tickEvent("monaco.addpackage",void 0,{interactiveConsent:!0}),this.hideFlyout(),this.parent.showPackageDialog()}defineEditorTheme(e,t){const n=pxt.appTarget.appTheme.invertedMonaco;let r=[];if(!e&&t){const e={};this.getNamespaces().forEach((t=>{const n=this.getNamespaceAttrs(t),i=c.isBuiltin(t)?c.getBuiltinCategory(t).blocks.concat(this.nsMap[t]||[]):this.nsMap[t];if(n.color&&i){let s=o(n.color);i.forEach((e=>{r.push({token:`identifier.ts ${e.name}`,foreground:s})})),r.push({token:`identifier.ts ${t}`,foreground:s}),e[t]=n.color}})),r.push({token:"identifier.ts if",foreground:"5B80A5"}),r.push({token:"identifier.ts else",foreground:"5B80A5"}),r.push({token:"identifier.ts while",foreground:"5BA55B"}),r.push({token:"identifier.ts for",foreground:"5BA55B"});const t=pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock;if(t){const n=t.callName||"pauseUntil",i=t.color||e[t.category];i&&r.push({token:`identifier.ts ${n}`,foreground:o(i)})}}const i=pxt.appTarget.appTheme.monacoColors||{};function o(e){return e=pxt.toolbox.convertColor(e),(n?pxt.toolbox.fadeColor(e,.6,!0):e).replace("#","")}monaco.editor.defineTheme("pxtTheme",{base:e?"hc-black":n?"vs-dark":"vs",inherit:!0,rules:r,colors:e?{}:i}),monaco.editor.setTheme("pxtTheme")}saveToTypeScriptAsync(){return"python"==this.fileType?this.convertPythonToTypeScriptAsync(this.isDebugging()||this.parent.state.tracing):Promise.resolve(void 0)}convertPythonToTypeScriptAsync(e=!1){if(!this.currFile)return Promise.resolve(void 0);const t=this.currFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME);return l.py2tsAsync(e).then((e=>{var n;if(e.sourceMap){const r=o.mainEditorPkg(),i=e.outfiles[t],s=null===(n=r.files[this.currFile.getFileNameWithExtension("py")])||void 0===n?void 0:n.content;this.pythonSourceMap=i&&s?pxtc.BuildSourceMapHelpers(e.sourceMap,i,s):null}if(!e.diagnostics||!e.diagnostics.length)return e.outfiles[t]?e.outfiles[t]:""}))}setHighContrast(e){}beforeCompile(){}isIncomplete(){return!!(this.editor&&this.editor._view&&this.editor._view.contentWidgets._widgets["editor.widget.suggestWidget"].isVisible)||!(!this.editor||this.currFile.name!==pxt.CONFIG_NAME||m.jsonTryParse(this.getCurrentSource()))}resize(e){let t=document.getElementById("monacoEditorArea");if(!t)return;let n=t.getElementsByClassName("monacoToolboxDiv")[0];if(t&&this.editor){const e=n&&n.offsetWidth||0,r=this.parent.isJavaScriptActive()?this.parent.updateEditorLogo(e,this.getEditorColor()):0;if(this.editor.layout({width:t.offsetWidth-e,height:t.offsetHeight-r}),t&&this.parent.isTutorial()&&!pxt.BrowserUtils.isTabletSize()){const e=t.getBoundingClientRect();h.setEditorBounds({top:e.top,left:e.left,width:e.width,height:e.height})}else h.setEditorBounds({top:0,left:0,width:window.innerWidth,height:window.innerHeight});n&&(n.style.height="100%")}}setErrorListState(e){this.parent.state.errorListState!=e&&(this.resize(),this.parent.setState({errorListState:e}))}prepare(){this.isReady=!0}loadMonacoAsync(){return this.loadMonacoPromise||(this.loadMonacoPromise=this.createLoadMonacoPromise()),this.loadMonacoPromise}createLoadMonacoPromise(){this.extraLibs=Object.create(null),document.getElementById("monacoEditorArea");let e=document.getElementById("monacoEditorInner");return pxt.vs.initMonacoAsync(e).then((e=>{if(this.editor=e,"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1&&!this.mobileKeyboardWidget&&(this.mobileKeyboardWidget=new N(this.editor)),this.editor.updateOptions({fontSize:this.parent.settings.editorFontSize}),this.editor.addAction({id:"save",label:lf("Save"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.KEY_S],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",contextMenuGroupId:"0_pxtnavigation",contextMenuOrder:.2,run:()=>Promise.resolve(this.parent.typecheckNow())}),this.editor.addAction({id:"runSimulator",label:lf("Run Simulator"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.Enter],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",contextMenuGroupId:"0_pxtnavigation",contextMenuOrder:.21,run:()=>Promise.resolve(this.parent.runSimulator())}),pxt.appTarget.compile&&pxt.appTarget.compile.hasHex&&this.editor.addAction({id:"compileHex",label:lf("Download"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyMod.Alt|monaco.KeyCode.Enter],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",contextMenuGroupId:"0_pxtnavigation",contextMenuOrder:.22,run:()=>Promise.resolve(this.parent.compile())}),this.editor.addAction({id:"zoomIn",label:lf("Zoom In"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.NUMPAD_ADD,monaco.KeyMod.CtrlCmd|monaco.KeyCode.US_EQUAL],run:()=>Promise.resolve(this.zoomIn())}),this.editor.addAction({id:"zoomOut",label:lf("Zoom Out"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.NUMPAD_SUBTRACT,monaco.KeyMod.CtrlCmd|monaco.KeyCode.US_MINUS],run:()=>Promise.resolve(this.zoomOut())}),pxt.appTarget.appTheme.hasReferenceDocs){let e=this.editor.createContextKey("editorHasReference",!1);this.editor.addAction({id:"reference",label:lf("Help"),keybindingContext:"!editorReadonly && editorHasReference",precondition:"!editorReadonly && editorHasReference",contextMenuGroupId:"navigation",contextMenuOrder:.1,run:()=>Promise.resolve(this.loadReference())}),this.editor.onDidChangeCursorPosition((t=>{let n=this.editor.getModel().getWordUntilPosition(t.position);n&&""!=n.word?e.set(!0):e.reset()}))}this.editor.addAction({id:"jumptoolbox",label:lf("Jump to Toolbox"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyMod.Alt|monaco.KeyCode.KEY_T],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",run:()=>Promise.resolve(this.moveFocusToToolbox())}),this.editor.onDidLayoutChange((e=>{let t=this.getEditorFontSize();this.parent.settings.editorFontSize!=t&&(this.parent.settings.editorFontSize=t,this.forceDiagnosticsUpdate());const n=document.getElementById("monacoToolboxDiv");n&&(n.style.height=`${this.editor.getLayoutInfo().height}px`)}));const t=document.getElementById("monacoEditorInner");pxt.BrowserUtils.hasPointerEvents()?(t.onpointermove=this.onPointerMove,t.onpointerup=this.onPointerUp):(t.onmousemove=this.onPointerMove,t.onmouseup=this.onPointerUp,pxt.BrowserUtils.isTouchEnabled()&&(t.ontouchend=this.onPointerUp)),this.editor.onDidFocusEditorText((()=>{this.hideFlyout()})),monaco.languages.registerCompletionItemProvider("python",new w(this,!0)),monaco.languages.registerSignatureHelpProvider("python",new S(this,!0)),monaco.languages.registerHoverProvider("python",new T(this,!0)),monaco.languages.registerDocumentRangeFormattingEditProvider("python",new A(this,!0)),monaco.languages.setLanguageConfiguration("python",C),this.editorViewZones=[],this.setupFieldEditors(),this.editor.onMouseDown((e=>{e.target.type===monaco.editor.MouseTargetType.GUTTER_GLYPH_MARGIN&&this.handleGutterClick(e)})),e.onDidChangeModelContent((t=>{this.fieldEditors&&this.fieldEditors.clearRanges(e)}))}))}undo(){this.editor&&this.editor.trigger("keyboard","undo",null)}redo(){this.editor&&this.editor.trigger("keyboard","redo",null)}zoomIn(){if(!this.editor)return;if(this.parent.settings.editorFontSize>=40)return;let e=this.getEditorFontSize();this.parent.settings.editorFontSize=e+1,this.editor.updateOptions({fontSize:this.parent.settings.editorFontSize}),this.forceDiagnosticsUpdate()}zoomOut(){if(!this.editor)return;if(this.parent.settings.editorFontSize<=10)return;let e=this.getEditorFontSize();this.parent.settings.editorFontSize=e-1,this.editor.updateOptions({fontSize:this.parent.settings.editorFontSize}),this.forceDiagnosticsUpdate()}loadReference(){m.assert(null!=this.editor);const e=this.editor.getModel(),t=e.getOffsetAt(this.editor.getPosition()),n=e.getValue(),r=this.currFile.name;l.syntaxInfoAsync("symbol",r,t,n).then((e=>{if(null==e?void 0:e.symbols)for(const t of e.symbols){const e=pxt.blocks.getHelpUrl(t);if(e)return void(pxt.blocks.openHelpUrl?pxt.blocks.openHelpUrl(e):window.open(e))}s.warningNotification(m.lf("Help resource not found"))}))}setupFieldEditors(){this.hasFieldEditors&&!pxt.shell.isReadOnly()&&(this.fieldEditors||(this.fieldEditors=new f.FieldEditorManager(this.editor),monaco.languages.registerFoldingRangeProvider("typescript",this.fieldEditors),monaco.languages.registerFoldingRangeProvider("python",this.fieldEditors)),this.editor.onDidChangeCursorPosition((e=>{this.fieldEditors&&this.fieldEditors.setCursorLine(e.position.lineNumber)})),pxt.appTarget.appTheme.monacoFieldEditors.forEach((e=>{const t=pxt.editor.getMonacoFieldEditor(e);t?this.fieldEditors.addFieldEditor(t):pxt.debug("Skipping unknown monaco field editor '"+e+"'")})))}closeFlyout(){this.editor&&this.hideFlyout()}hideFlyout(){this.flyout&&this.flyout.setState({groups:void 0}),this.toolbox&&this.toolbox.clearSelection(),this.parent.setState({hideEditorFloats:!1})}updateToolbox(){pxt.appTarget.appTheme.monacoToolbox&&!pxt.shell.isReadOnly()&&this.editor&&(this.editor.layout(),this.toolbox&&(this.toolbox.setState({loading:!1,categories:this.getAllCategories(),showSearchBox:this.shouldShowSearch()}),this.shouldShowToolbox()?this.toolbox.show():this.toolbox.hide()),this.updateDebuggerToolbox())}updateDebuggerToolbox(){const e=document.getElementById("monacoDebuggerToolbox");if(!e||!this.blockInfo)return;const t=this.isDebugging();t&&this.flyout&&this.flyout.setState({groups:void 0});const n=t?(0,r.jsx)(y.DebuggerToolbox,{ref:this.handleDebugToolboxRef,parent:this.parent,apis:this.blockInfo.apis.byQName,openLocation:this.revealBreakpointLocation,showCallStack:!0}):null;i.render(n,e)}getId(){return"monacoEditor"}getViewState(){return this.editor?this.editor.getPosition():{}}getCurrentSource(){return this.editor?this.editor.getValue():this.currSource}acceptsFile(e){return!0}setValue(e){this.editor.setValue(e)}overrideFile(e){m.assert(null!=this.editor),this.editor.setValue(e)}shouldShowToolbox(){const e=!this.currFile||this.currFile.isReadonly()||pxt.shell.isReadOnly()||this.isDebugging();return pxt.appTarget.appTheme.monacoToolbox&&!e&&("typescript"==this.fileType||"python"==this.fileType)}loadFileAsync(e,t){let n="text";this.currSource=e.content;let r=document.createElement("div");r.className="ui inverted loading dimmer active";let i=document.getElementById("monacoEditorRightArea"),s=document.getElementById("monacoEditorInner");return i.insertBefore(r,s),this.pythonSourceMap=null,this.loadMonacoAsync().then((()=>{if(!this.editor)return Promise.resolve();this.foldFieldEditorRanges=!0,this.updateFieldEditors();let r=e.getExtension();j.hasOwnProperty(r)&&(n=j[r]),this.fileType=n;const i=e.isReadonly()||pxt.shell.isReadOnly()||this.isDebugging();this.editor.updateOptions({readOnly:i});let s="pkg:"+e.getName(),a=monaco.editor.getModels().filter((e=>e.uri.toString()==s))[0];if(a||(a=monaco.editor.createModel(o.mainPkg.readFile(e.getName()),n,monaco.Uri.parse(s))),a&&this.editor.setModel(a),this.defineEditorTheme(t),this.currFile=e,this.shouldShowToolbox()?this.beginLoadToolbox(e,t):this.toolbox&&this.toolbox.hide(),this.setValue(e.content),this.setDiagnostics(e,this.snapshotState()),this.breakpoints){this.breakpoints.loadBreakpointsForFile(e,this.editor);const t=this.breakpoints.getLocationOfBreakpoint(this.highlightedBreakpoint);t&&t.fileName===e.getTextFileName()&&this.highilightStatementCore(t,!0)}return"markdown"==this.fileType&&this.parent.setSideMarkdown(e.content),this.currFile.setForceChangeCallback(((e,t)=>{e!=t&&(pxt.debug(`File changed (from ${e}, to ${t}). Reloading editor`),this.loadFileAsync(this.currFile))})),e.isReadonly()||a.onDidChangeContent((e=>{this.clearHighlightedStatements();let t=this.editorViewZones||[];this.editor.changeViewZones((function(e){t.forEach((t=>{e.removeZone(t)}))})),this.editorViewZones=[];const n=/[\u{201c}\u{201d}\u{2018}\u{2019}]/u;if(e.changes.some((e=>n.test(e.text)))){const t=e.changes.filter((e=>n.test(e.text))).map((e=>{const t=a.getPositionAt(e.rangeOffset),n=a.getPositionAt(e.rangeOffset+e.text.length);return{range:new monaco.Range(t.lineNumber,t.column,n.lineNumber,n.column),text:e.text.replace(/\u{201c}|\u{201d}/gu,'"').replace(/\u{2018}|\u{2019}/gu,"'")}}));this.editor.executeEdits("pxt",t)}this.updateDiagnostics(),this.changeCallback(),this.updateFieldEditors()})),this.resize(),this.hideFlyout(),this.extensions=o.allEditorPkgs().map((e=>e.getKsPkg())).filter((e=>!!e&&e.config&&!!e.config.extension&&/^(file:|github:)/.test(e.installedVersion))),this.giveFocusOnLoading&&this.editor.focus(),"python"===this.fileType&&(this.editAmendmentsListener=(0,b.listenForEditAmendments)(this.editor)),this.foldFieldEditorRangesAsync()})).finally((()=>{i.removeChild(r),this.parent.isTutorial()&&this.parent.onTutorialLoaded()}))}unloadFileAsync(){return this.toolbox&&this.toolbox.clearSearch(),this.currFile&&this.currFile.getName()=="this/"+pxt.CONFIG_NAME?this.parent.reloadHeaderAsync():(this.editAmendmentsListener&&(this.editAmendmentsListener.dispose(),this.editAmendmentsListener=void 0),Promise.resolve())}beginLoadToolbox(e,t){this.toolbox&&this.toolbox.showLoading(),l.getBlocksAsync().then((n=>{this.blockInfo=n,this.nsMap=this.partitionBlocks(),this.updateToolbox(),pxt.vs.syncModels(o.mainPkg,this.extraLibs,e.getName(),e.isReadonly()),this.defineEditorTheme(t,!0)})),this.blockIdMap=c.blockIdMap()}snapshotState(){return this.editor&&this.editor.getModel()?this.editor.getModel().getLinesContent():null}setViewState(e){this.editor&&e&&0!==Object.keys(e).length&&(this.editor.setPosition(e),this.editor.setScrollPosition({scrollTop:this.editor.getTopForLineNumber(e.lineNumber)}))}setBreakpointsMap(e,t){this.callLocations=t,this.isDebugging()?(this.breakpoints||(this.breakpoints=new v.BreakpointCollection(e,this.pythonSourceMap),this.breakpoints.loadBreakpointsForFile(this.currFile,this.editor)),this.fieldEditors&&this.fieldEditors.clearRanges(this.editor),this.feWidget&&this.feWidget.close(),this.editor&&this.editor.updateOptions({readOnly:!0})):(this.editor&&this.editor.updateOptions({readOnly:pxt.shell.isReadOnly()||this.currFile&&this.currFile.isReadonly()}),this.breakpoints&&(this.breakpoints.dispose(),this.breakpoints=void 0),this.updateFieldEditors())}setDiagnostics(e,t){this.editor&&this.currFile===e&&(this.diagSnapshot=t,this.forceDiagnosticsUpdate())}updateDiagnostics(){this.needsDiagUpdate()&&this.forceDiagnosticsUpdate()}getBreakpoints(){return this.breakpoints?this.breakpoints.getActiveBreakpoints():[]}getEditorFontSize(){return this.editor.getOptions().get(monaco.editor.EditorOption.fontInfo).fontSize}sendBreakpoints(){this.breakpoints&&d.driver.setBreakpoints(this.getBreakpoints())}needsDiagUpdate(){if(!this.annotationLines)return!1;let e=this.editor.getModel().getLinesContent();for(let t of this.annotationLines)if(this.diagSnapshot[t]!==e[t])return!0;return!1}forceDiagnosticsUpdate(){if("typescript"!=this.fileType&&"python"!=this.fileType)return;let e=this.currFile,t=[];if(e&&e.diagnostics){const n=monaco.editor.getModel(monaco.Uri.parse(`pkg:${e.getName()}`));for(let r of e.diagnostics){const e=e=>{t.push({severity:monaco.MarkerSeverity.Error,message:e,startLineNumber:r.line+1,startColumn:r.column+1,endLineNumber:null==r.endLine?i.lineNumber:r.endLine+1,endColumn:null==r.endColumn?i.column:r.endColumn})},i=n.getPositionAt(r.start+r.length);if("string"==typeof r.messageText)e(r.messageText);else{let t=r.messageText;for(;null!=t.next;)e(t.messageText),t=t.next}}monaco.editor.setModelMarkers(n,"typescript",t),this.onErrorChanges(e.diagnostics)}}showFieldEditor(e,t,n,r){this.feWidget&&this.feWidget.close(),this.feWidget=new f.ModalEditorHost(t,e,this.editor.getModel());const i=()=>{r&&(d.setDirty(),"typescript"==this.fileType&&o.mainEditorPkg().invalidateCachedTranspile("ts",this.getCurrentSource(),"blocks"))};this.feWidget.showAsync(this.fileType,this.editor).then((e=>{this.activeRangeID=null,e?this.editModelAsync(e.range,e.replacement).then((e=>this.indentRangeAsync(e))).then((()=>this.foldFieldEditorRangesAsync())).then(i):i()}))}updateFieldEditors(){this.fieldEditors&&this.fieldEditors.setFieldEditorsEnabled(this.hasFieldEditors&&this.editor&&!pxt.shell.isReadOnly()&&!this.isDebugging())}foldFieldEditorRangesAsync(){return this.foldFieldEditorRanges?this.editor.getAction("editor.foldAllBlockComments").run():Promise.resolve()}highlightStatement(e,t){var n;if(!e)return this.clearHighlightedStatements(),this.debuggerToolbox&&this.debuggerToolbox.setBreakpoint(null),!1;if(!this.editor)return!1;if(t&&(null===(n=this.breakpoints)||void 0===n?void 0:n.getLoadedBreakpoint(t.breakpointId))?e=this.breakpoints.getLoadedBreakpoint(t.breakpointId):"py"===this.currFile.getExtension()&&this.pythonSourceMap&&(e=this.pythonSourceMap.ts.locToLoc(e)),this.currFile.getTextFileName()!==e.fileName&&this.isDebugging()&&P(e.fileName))this.parent.setFile(P(e.fileName));else if(!this.highilightStatementCore(e,!!t))return!1;return this.highlightedBreakpoint=t?t.breakpointId:void 0,t&&this.isDebugging()&&this.debuggerToolbox&&(this.debuggerToolbox.setBreakpoint(t),this.resize()),!0}highilightStatementCore(e,t=!1){let n=this.editor.getModel().getPositionAt(e.start),r=this.editor.getModel().getPositionAt(e.start+e.length);return!(!n||!r||(this.highlightDecorations=this.editor.deltaDecorations(this.highlightDecorations,[{range:new monaco.Range(n.lineNumber,n.column,r.lineNumber,r.column),options:{inlineClassName:"highlight-statement"}}]),t&&this.editor.revealPositionInCenter(n),0))}clearHighlightedStatements(){this.editor&&this.highlightDecorations&&this.editor.deltaDecorations(this.highlightDecorations,[])}partitionBlocks(){const e={};this.topBlocks=[];const t=c.allBuiltinBlocksByName(),n=this;function r(e,t){n.subcategoryMap[e]||(n.subcategoryMap[e]={}),n.subcategoryMap[e][t]=!0}if(this.blockInfo.blocks.forEach((n=>{let i=(n.attributes.blockNamespace||n.namespace).split(".")[0];if(t[n.qName]||"TD_ID"==n.attributes.shim)return;e[i]||(e[i]=[]),e[i].push(n);const o=n.attributes.subcategory;n.attributes.advanced?r(i,lf("more")):o&&r(i,o),n.attributes.topblock&&this.topBlocks.push(n)})),c.getPauseUntil()){const t=pxt.appTarget.runtime.pauseUntilBlock.category;e[t]&&e[t].push(c.getPauseUntil())}return e}clearCaches(){super.clearCaches(),c.clearBuiltinBlockCache()}shouldShowSearch(){return!this.parent.state.editorState||null==this.parent.state.editorState.searchBar||this.parent.state.editorState.searchBar}getBuiltinCategory(e){return c.getBuiltinCategory(e)}isBuiltIn(e){return c.isBuiltin(e)}getNamespaceAttrs(e){const t=c.getBuiltinCategory(e);return t?(t.attributes.color=pxt.toolbox.getNamespaceColor(t.nameid),t.attributes):this.blockInfo?super.getNamespaceAttrs(e):void 0}getNamespaces(){const e=Object.keys(this.nsMap).filter((e=>!c.isBuiltin(e)&&!!this.getNamespaceAttrs(e)));function t(e){return c.getBuiltinCategory(e).removed}let n=pxt.appTarget.runtime||{};return n.loopsBlocks&&!t("loops")&&e.push("loops"),n.logicBlocks&&!t("logic")&&e.push("logic"),n.variablesBlocks&&!t("variables")&&e.push("variables"),n.mathBlocks&&!t("Math")&&e.push("Math"),n.functionBlocks&&!t("functions")&&e.push("functions"),n.listsBlocks&&!t("arrays")&&e.push("arrays"),n.textBlocks&&!t("text")&&e.push("text"),pxt.appTarget.cloud&&pxt.appTarget.cloud.packages&&e.push("addpackage"),e.concat(super.getNamespaces())}moveFocusToFlyout(){if(this.flyout){let e=document.querySelector(".monacoBlock");e&&(e.focus(),e.click())}}getBlocksForCategory(e,t){return c.isBuiltin(e)?this.getBuiltinBlocks(e,t):this.filterBlocks(t,this.nsMap[e])}filterBlocks(e,t){return t.filter((t=>!t.attributes.blockHidden&&!(t.attributes.deprecated&&!this.parent.isTutorial())&&0!=t.name.indexOf("_")&&(!e&&!t.attributes.subcategory&&!t.attributes.advanced||e&&(t.attributes.advanced&&e==lf("more")||t.attributes.subcategory&&e==t.attributes.subcategory))))}getBuiltinBlocks(e,t){let n=c.getBuiltinCategory(e),r=n.blocks||[];return!n.custom&&this.nsMap[e]&&(r=r.concat(this.nsMap[e].filter((e=>!(e.attributes.blockHidden||e.attributes.deprecated&&!this.parent.isTutorial()))))),this.filterBlocks(t,r)}showFlyout(e){if(!this.editor)return;let{nameid:t,name:n,subns:r,color:i,icon:o,blocks:s}=e,a=[];if(this.flyout){if("search"==t)try{0==(s=this.getSearchBlocks()).length&&(n=lf("No search results...")),a.push({name:pxt.DEFAULT_GROUP_NAME,blocks:s})}catch(e){pxt.reportException(e),s=[],n=lf("No search results...")}else"topblocks"==t?0==(s=this.getTopBlocks()).length?n=lf("No basic results..."):(i=pxt.toolbox.getNamespaceColor("topblocks"),o=pxt.toolbox.getNamespaceIcon("topblocks"),n=lf("{id:category}Basic"),a.push({name:pxt.DEFAULT_GROUP_NAME,blocks:s})):a=this.getBlockGroups(e);this.flyout.setState({name:n||m.capitalize(r||t),selectedBlock:void 0,hide:!1,ns:t,color:i,icon:o,groups:a})}}showFlyoutHeadingLabel(e,t,n,r,i){}showFlyoutGroupLabel(e,t,n,r){}showFlyoutBlocks(e,t,n){}handleGutterClick(e){const t=e.target.position.lineNumber;if(this.isDebugging())this.breakpoints&&(this.breakpoints.toggleBreakpointAt(t),this.sendBreakpoints());else if(this.fieldEditors){const e=this.editor.getModel();if(e.getDecorationsInRange(new monaco.Range(t,e.getLineMinColumn(t),t,e.getLineMaxColumn(t))).length){const e=this.fieldEditors.getInfoForLine(t);if(e){if(this.feWidget&&null!=this.activeRangeID&&e.id===this.activeRangeID)return this.feWidget.close(),void(this.activeRangeID=null);this.activeRangeID=e.id;const t=this.fieldEditors.getFieldEditorById(e.owner);t&&this.showFieldEditor(e.range,new t.proto,t.heightInPixels||500,t.alwaysBuildOnClose)}}}}getSearchBlocks(){let e=[];const t=this.toolbox.getSearchBlocks(),n=this;function r(e){const t=n.blockInfo.apis.byQName[e];return(t?t.attributes.color:void 0)||pxt.toolbox.getNamespaceColor(e)||"255"}return t.forEach((t=>{if(t.name){const n=this.blockInfo.apis.byQName[t.name];if(n){if(0==n.name.indexOf("_"))return;const t=(n.attributes.blockNamespace||n.namespace).split(".")[0];n.attributes.color=n.attributes.color||r(t),e.push(n)}else pxt.log("couldn't find non builtin search by qName: "+t.name)}else if(t.attributes.blockId==pxtc.PAUSE_UNTIL_TYPE){const t=c.getPauseUntil();if(t){const n=t.attributes.blockNamespace;t.attributes.color=r(n),e.push(t)}}else{const n=c.allBuiltinBlocks()[t.attributes.blockId];n?(n[0].attributes.blockNamespace=n[1],e.push(n[0])):pxt.log("couldn't find buildin search qName for block: "+t.attributes.blockId)}})),e}indentRangeAsync(e){const t=this.editor.getModel(),n=t.getLineFirstNonWhitespaceColumn(e.startLineNumber)-1,r=R(t.getOptions().indentSize+n),i=t.getValueInRange(e).split(/\n/),o=i.map(((e,t)=>0===t?e.trim():t===i.length-1?R(n)+e.trim():r+e.trim())).join(t.getEOL());return this.editModelAsync(e,o)}editModelAsync(e,t){return new Promise((n=>{const r=this.editor.getModel(),i=t.split("\n"),o=new monaco.Range(e.startLineNumber,e.startColumn,e.startLineNumber+i.length-1,i[i.length-1].length);let s=this.editor.onDidChangeModelContent((e=>{s&&(s.dispose(),s=void 0),this.editor.setSelection(o),this.fieldEditors&&this.fieldEditors.clearRanges(this.editor),n(o)}));r.pushEditOperations(this.editor.getSelections(),[{range:r.validateRange(e),text:t,forceMoveMarkers:!0}],(e=>[O(e[0].range)]))}))}isDebugging(){return this.parent.state.debugging}getEditorColor(){return pxt.appTarget.appTheme.monacoColors&&pxt.appTarget.appTheme.monacoColors["editor.background"]?pxt.appTarget.appTheme.monacoColors["editor.background"]:pxt.appTarget.appTheme.invertedMonaco?"#1e1e1e":"#ffffff"}}function O(e){return new monaco.Selection(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn)}n.Editor=I,n.rangeToSelection=O;class N{constructor(e){this.touchHandler=()=>{this.editor.focus()},this.editor=e,this._domNode=document.createElement("textarea"),this._domNode.className="iPadShowKeyboard",this._domNode.addEventListener("touchstart",this.touchHandler),this._domNode.addEventListener("focus",this.touchHandler),this.editor.addOverlayWidget(this)}dispose(){this.editor.removeOverlayWidget(this),this._domNode.removeEventListener("touchstart",this.touchHandler),this._domNode.removeEventListener("focus",this.touchHandler)}getId(){return N.ID}getDomNode(){return this._domNode}getPosition(){return{preference:monaco.editor.OverlayWidgetPositionPreference.TOP_RIGHT_CORNER}}}function R(e){let t="";for(let n=0;n<e;n++)t+=" ";return t}function P(e){const t=o.mainEditorPkg();if(t.files[e])return t.files[e];return t.lookupFile(e)||void 0}N.ID="editor.contrib.ShowKeyboardWidget_pxt"},{"./auth":48,"./blocklyFieldView":49,"./compiler":58,"./core":133,"./data":136,"./debuggerToolbox":141,"./errorList":147,"./monacoDebugger":171,"./monacoEditAmendments":172,"./monacoFieldEditorHost":173,"./monacoFlyout":174,"./monacoSnippets":175,"./monacopyhelper":176,"./package":179,"./simulator":192,"./toolbox":201,"./toolboxeditor":202,"react-dom":309,"react/jsx-runtime":367}],171:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BreakpointCollection=n.MonacoBreakpoint=void 0;class r{constructor(e,t){this.source=e,this.editor=t,this.active=!1;const n=this.editor.getModel(),r=n.getPositionAt(this.source.start),i=n.getPositionAt(this.source.start+this.source.length);i.lineNumber===r.lineNumber?this.range=new monaco.Range(r.lineNumber,r.column,i.lineNumber,i.column):this.range=new monaco.Range(r.lineNumber,r.column,r.lineNumber,n.getLineMaxColumn(r.lineNumber)),this.updateDecoration()}simulatorID(){return this.source.id}isActive(){return this.active}setActive(e){this.active!==e&&(this.active=e,this.updateDecoration())}toggle(){this.setActive(!this.active)}distanceFromLine(e){return Math.abs(this.range.startLineNumber-e)}dispose(){this.decoration&&(this.editor.deltaDecorations([this.decoration],[]),this.decoration=void 0)}updateDecoration(){const e=this.active?"monaco-breakpoint active":"monaco-breakpoint",t=this.active?pxt.U.lf("Remove breakpoint"):pxt.U.lf("Add breakpoint"),n=this.editor.deltaDecorations(this.decoration?[this.decoration]:[],[{range:this.range,options:{glyphMarginClassName:e,glyphMarginHoverMessage:{value:t}}}]);this.decoration=n[0]}}n.MonacoBreakpoint=r;n.BreakpointCollection=class{constructor(e,t){this.fileToBreakpoint={},this.activeBreakpoints=[],this.sourcemap=t;for(const t of e)this.fileToBreakpoint[t.fileName]||(this.fileToBreakpoint[t.fileName]=[]),this.fileToBreakpoint[t.fileName].push(t)}loadBreakpointsForFile(e,t){if(this.loadedBreakpoints&&this.loadedBreakpoints.forEach((e=>e.dispose())),!e)return;const n="py"===e.getExtension();let i=e.getTextFileName();n&&(i=e.getFileNameWithExtension("ts"));let o=this.fileToBreakpoint[i];if(n){if(!this.sourcemap)return;o=null==o?void 0:o.map((e=>{const t=this.sourcemap.ts.locToLoc(e);return Object.assign(Object.assign({},e),t)}))}o&&(this.loadedBreakpoints=o.map((e=>{const n=new r(e,t);return-1!=this.activeBreakpoints.indexOf(e.id)&&n.setActive(!0),n})))}toggleBreakpointAt(e){const t=this.getBreakpointForLine(e);t&&(t.toggle(),t.isActive()?this.activeBreakpoints.push(t.source.id):this.activeBreakpoints=this.activeBreakpoints.filter((e=>e!=t.source.id)))}refreshDecorations(){this.loadedBreakpoints&&this.loadedBreakpoints.forEach((e=>e.updateDecoration()))}clearDecorations(){this.loadedBreakpoints&&this.loadedBreakpoints.forEach((e=>e.dispose()))}getActiveBreakpoints(){return this.activeBreakpoints}dispose(){this.loadedBreakpoints&&(this.loadedBreakpoints.forEach((e=>e.dispose())),this.loadedBreakpoints=void 0),this.activeBreakpoints=void 0,this.fileToBreakpoint=void 0}getLocationOfBreakpoint(e){const t=this.getLoadedBreakpoint(e);if(t)return t;for(const t of Object.keys(this.fileToBreakpoint)){const n=this.fileToBreakpoint[t];for(const t of n)if(t.id===e)return t}}getLoadedBreakpoint(e){if(this.loadedBreakpoints)for(const t of this.loadedBreakpoints)if(t.source.id===e)return t.source;return null}getBreakpointForLine(e){if(!this.loadedBreakpoints||!this.loadedBreakpoints.length)return;let t,n;for(const r of this.loadedBreakpoints){const i=r.distanceFromLine(e);(void 0===n||i<n)&&(t=r,n=i)}return n<5?t:void 0}}},{}],172:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.listenForEditAmendments=n.amendmentToInsertSnippet=n.createLineReplacementPyAmendment=void 0;const r=e("./monaco"),i=e("./monacopyhelper"),o="#AMENDMENT:";n.createLineReplacementPyAmendment=function(e,t="pass"){return{behavior:"replaceLine",insertText:e||"",selectText:t}},n.amendmentToInsertSnippet=function(e){return`#AMENDMENT:${JSON.stringify(e)}`},n.listenForEditAmendments=function(e){return e.onDidChangeModelContent((t=>{let n=function(e){if(1!=e.changes.length)return null;let t=e.changes[0];if(!(t.text.indexOf(o)>=0))return null;let n=t.text.split(o);if(2!=n.length)return null;n[0];let r=n[1],i=pxt.U.jsonTryParse(r);return i?Object.assign({range:t.range},i):null}(t);n&&function(e,t){const n=t.getModel();setTimeout((()=>{let o=e.range;"replaceLine"===e.behavior?o=Object.assign(Object.assign({},o),{endColumn:99999,startColumn:1}):e.behavior;const s=(0,i.fixIndentationInRange)(n,n.validateRange(o),e.insertText)[0];e.range=s.range,e.insertText=s.text;let a=null;if(e.selectText){let t=e.insertText.split(e.selectText);if(t.length>=2){let n=t[0].split("\n"),r=n[n.length-1],i=o.startLineNumber+n.length-1,s=r.length+1;a=new monaco.Range(i,s,i,s+e.selectText.length)}}let l=Object.assign(Object.assign({},e.range),{endColumn:99999}),c=[{range:n.validateRange(l),text:"",forceMoveMarkers:!1}];n.applyEdits(c),setTimeout((()=>{const i=t.onDidChangeModelContent((e=>{i.dispose(),a&&t.setSelection(a)}));let s=[{range:n.validateRange(o),text:e.insertText,forceMoveMarkers:!0}];n.pushEditOperations(t.getSelections(),s,(e=>[(0,r.rangeToSelection)(e[0].range)]))}),0)}),0)}(n,e)}))}},{"./monaco":170,"./monacopyhelper":176}],173:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.computeRanges=n.RangesCollector=n.FieldEditorManager=n.ModalEditorHost=n.ViewZoneEditorHost=void 0;const r=e("./compiler"),i=e("./package");n.ViewZoneEditorHost=class{constructor(e,t,n){this.fe=e,this.range=t,this.model=n,this.heightInPx=520,this.suppressMouseDown=!1,this.afterLineNumber=t.endLineNumber;const r=document.createElement("div");r.setAttribute("class","pxt-view-zone");const i=document.createElement("div");i.setAttribute("class","monaco-field-editor-frame"),r.appendChild(i),this.domNode=r,this.wrapper=i}getId(){return"pxt-monaco-field-editor"}contentDiv(){return this.content||(this.content=document.createElement("div"),this.wrapper.appendChild(this.content)),this.content}showAsync(e,t){return this.fileType=e,this.editor=t,r.getBlocksAsync().then((e=>(this.blocks=e,this.showViewZoneAsync()))).then((()=>(this.editor.setScrollPosition({scrollTop:this.editor.getTopForLineNumber(this.afterLineNumber)}),this.fe.showEditorAsync(this.fileType,this.range,this)))).finally((()=>{this.close()}))}onComputedHeight(e){this.contentDiv().style.height=e+"px"}onDomNodeTop(e){this._deferredShow&&(this._deferredShow(),this._deferredShow=void 0)}package(){return i.mainPkg}writeFileAsync(e,t){return i.mainEditorPkg().setContentAsync(e,t)}readFile(e){return this.package().host().readFile(i.mainPkg,e)}showViewZoneAsync(){return this._deferredShow?Promise.resolve():new Promise((e=>{this._deferredShow=e,this.editor.changeViewZones((e=>{this.id=e.addZone(this)}))}))}resizeViewZoneAsync(){return this.id?new Promise((e=>{this.editor.changeViewZones((e=>{e.layoutZone(this.id)}))})):Promise.resolve()}getText(e){return this.model.getValueInRange(e)}blocksInfo(){return this.blocks}close(){this.fe.onClosed(),this.fe.dispose(),this.editor.changeViewZones((e=>{e.removeZone(this.id)}))}};n.ModalEditorHost=class{constructor(e,t,n){this.fe=e,this.range=t,this.model=n}contentDiv(){return null}getText(e){return this.model.getValueInRange(e)}blocksInfo(){return this.blocks}package(){return i.mainPkg}writeFileAsync(e,t){return i.mainEditorPkg().setContentAsync(e,t)}readFile(e){return this.package().host().readFile(i.mainPkg,e)}showAsync(e,t){return r.getBlocksAsync().then((t=>(this.blocks=t,this.fe.showEditorAsync(e,this.range,this))))}close(){this.fe.onClosed(),this.fe.dispose()}};n.FieldEditorManager=class{constructor(e){this.editor=e,this.fieldEditors=[],this.decorations={},this.liveRanges=[],this.fieldEditorsEnabled=!0,this.rangeID=0}setFieldEditorsEnabled(e){this.fieldEditorsEnabled=e,e||this.clearRanges(this.editor)}setCursorLine(e){if(this.fieldEditorsEnabled&&e!=this.currentCursorLine){const t=this.getInfoForLine(this.currentCursorLine);t&&this.reapplyDecorations(t.owner);const n=this.getInfoForLine(e);n&&this.reapplyDecorations(n.owner,e),this.currentCursorLine=e}}addFieldEditor(e){for(const t of this.fieldEditors)if(t.id===e.id)return;this.fieldEditors.push(e)}getDecorations(e){return this.decorations[e]||[]}allDecorations(){const e=[];return Object.keys(this.decorations).forEach((t=>e.push(...this.getDecorations(t)))),e}setDecorations(e,t){this.decorations[e]=t}clearRanges(e){e&&Object.keys(this.decorations).forEach((t=>{e.deltaDecorations(this.decorations[t],[])})),this.decorations={},this.liveRanges=[],this.rangeID=0}trackRange(e,t,n){return!this.getInfoForLine(t)&&(this.liveRanges.push({line:t,owner:e,range:n,id:this.rangeID++}),!0)}getFieldEditorById(e){for(const t of this.fieldEditors)if(t.id===e)return t}getInfoForLine(e){for(const t of this.liveRanges)if(t.line===e)return t}allRanges(){return this.liveRanges}allFieldEditors(){return this.fieldEditors}provideFoldingRanges(e,t,n){this.updateFieldEditorRanges(e);const r=this.liveRanges.map((e=>({start:e.range.startLineNumber,end:e.range.endLineNumber-1,kind:monaco.languages.FoldingRangeKind.Comment})));let i=a(e,!1);return r.forEach((e=>{i=i.filter((t=>t.start!=e.start))})),r.concat(i)}reapplyDecorations(e,t=-1){const n=this.fieldEditors.find((t=>t.id===e));if(!n)return;const r=this.decorations[e],i=this.liveRanges.filter((t=>t.owner===e)),o=this.editor.getModel(),s=[];for(const e of i){let r=n.glyphCssClass;e.line===t&&(r+=" pxt-monaco-glyph-highlight"),s.push({range:new monaco.Range(e.line,o.getLineMinColumn(e.line),e.line,o.getLineMaxColumn(e.line)),options:{glyphMarginClassName:r}})}this.setDecorations(n.id,this.editor.deltaDecorations(r,s))}updateFieldEditorRanges(e){this.clearRanges(this.editor),this.fieldEditorsEnabled&&this.allFieldEditors().sort(((e,t)=>(t.weight||0)-(e.weight||0))).forEach((t=>{const n=t.matcher,r=e.findMatches(n.searchString,!0,n.isRegex,n.matchCase,n.matchWholeWord?this.editor.getOptions().get(monaco.editor.EditorOption.wordSeparators):null,!1),i=[];r.forEach((r=>{let o=r.range;if(n.validateRange&&!(o=n.validateRange(o,e)))return;const s=o.startLineNumber;this.getInfoForLine(s)||(i.push({range:new monaco.Range(s,e.getLineMinColumn(s),s,e.getLineMaxColumn(s)),options:{glyphMarginClassName:t.glyphCssClass}}),this.trackRange(t.id,s,o))})),this.setDecorations(t.id,this.editor.deltaDecorations([],i))}))}};class o{constructor(e){this._startIndexes=[],this._endIndexes=[],this._indentOccurrences=[],this._length=0,this._foldingRangesLimit=e}insertFirst(e,t,n){let r=this._length;this._startIndexes[r]=e,this._endIndexes[r]=t,this._length++,n<1e3&&(this._indentOccurrences[n]=(this._indentOccurrences[n]||0)+1)}toIndentRanges(e){if(this._length<=this._foldingRangesLimit){let e=new Uint32Array(this._length),t=new Uint32Array(this._length);for(let n=this._length-1,r=0;n>=0;n--,r++)e[r]=this._startIndexes[n],t[r]=this._endIndexes[n];return s(e,t)}{let t=0,n=this._indentOccurrences.length;for(let e=0;e<this._indentOccurrences.length;e++){let r=this._indentOccurrences[e];if(r){if(r+t>this._foldingRangesLimit){n=e;break}t+=r}}const r=e.getOptions().tabSize;let i=new Uint32Array(this._foldingRangesLimit),o=new Uint32Array(this._foldingRangesLimit);for(let s=this._length-1,a=0;s>=0;s--){let c=this._startIndexes[s],u=l(e.getLineContent(c),r);(u<n||u===n&&t++<this._foldingRangesLimit)&&(i[a]=c,o[a]=this._endIndexes[s],a++)}return s(i,o)}}}function s(e,t){const n=[];for(let r=0;r<e.length;r++)n.push({start:e[r],end:t[r],kind:monaco.languages.FoldingRangeKind.Region});return n}function a(e,t,n,r=5e3){const i=e.getOptions().tabSize;let s,a=new o(r);n&&(s=new RegExp(`(${n.start.source})|(?:${n.end.source})`));let c=[],u=e.getLineCount()+1;c.push({indent:-1,endAbove:u,line:u});for(let n=e.getLineCount();n>0;n--){let r,o=e.getLineContent(n),u=l(o,i),d=c[c.length-1];if(-1!==u){if(s&&(r=o.match(s))){if(!r[1]){c.push({indent:-2,endAbove:n,line:n});continue}{let e=c.length-1;for(;e>0&&-2!==c[e].indent;)e--;if(e>0){c.length=e+1,d=c[e],a.insertFirst(n,d.line,u),d.line=n,d.indent=u,d.endAbove=n;continue}}}if(d.indent>u){do{c.pop(),d=c[c.length-1]}while(d.indent>u);let e=d.endAbove-1;e-n>=1&&a.insertFirst(n,e,u)}d.indent===u?d.endAbove=n:c.push({indent:u,endAbove:n,line:n})}else t&&(d.endAbove=n)}return a.toIndentRanges(e)}function l(e,t){let n=0,r=0,i=e.length;for(;r<i;){let i=e.charCodeAt(r);if(32===i)n++;else{if(9!==i)break;n=n-n%t+t}r++}return r===i?-1:n}n.RangesCollector=o,n.computeRanges=a},{"./compiler":58,"./package":179}],174:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MonacoFlyout=void 0;const r=e("react/jsx-runtime"),i=e("./compiler"),o=e("./core"),s=e("./workspace"),a=e("./data"),l=e("./auth");class c extends a.Component{constructor(e){super(e),this.dragging=!1,this.getBlockClickHandler=e=>()=>{pxt.tickEvent("monaco.toolbox.itemclick",void 0,{interactiveConsent:!0}),this.setState({selectedBlock:e!=this.state.selectedBlock?e:void 0})},this.getBlockMouseOver=e=>()=>{pxt.tickEvent("monaco.toolbox.itemmouseover"),this.setState({hoverBlock:e!=this.state.hoverBlock?e:void 0})},this.getBlockMouseOut=e=>()=>{e==this.state.hoverBlock&&this.setState({hoverBlock:void 0})},this.getBlockDragStartHandler=(e,t,n)=>r=>{this.dragInfo={x:pxt.BrowserUtils.getClientX(r),y:pxt.BrowserUtils.getClientY(r),block:e,snippet:t,color:n}},this.isHorizontalDrag=e=>{const t=Math.abs(this.dragInfo.x-pxt.BrowserUtils.getClientX(e)),n=Math.abs(this.dragInfo.y-pxt.BrowserUtils.getClientY(e));return t>5&&n>5&&t>n},this.blockDragHandler=e=>{let t=document.getElementById("monacoDraggingBlock");if(this.dragInfo&&(t||this.isHorizontalDrag(e))){pxt.tickEvent("monaco.toolbox.itemdrag",void 0,{interactiveConsent:!0}),e.preventDefault(),e.stopPropagation();const n=this.dragInfo.block,r=n.parameters;if(this.dragging=!0,!t){const e=document.getElementById("root");e.style.overflow="hidden",(t=document.createElement("div")).id="monacoDraggingBlock",t.textContent=n.snippetOnly?n.snippet:`${this.getQName(n)||this.getSnippetName(n)}${r?`(${r.map((e=>e.name)).join(", ")})`:""}`,t.style.backgroundColor=this.dragInfo.color,e.appendChild(t),s.fireEvent({type:"create",editor:"ts",blockId:n.attributes.blockId});let i="";"void"!=n.retType&&(i="inline:1&"),this.props.setInsertionSnippet(this.dragInfo.snippet||i+"qName:"+n.qName)}t.style.top=`${pxt.BrowserUtils.getClientY(e)}px`,t.style.left=`${pxt.BrowserUtils.getClientX(e)}px`,this.setState({hide:!0})}},this.blockDragEndHandler=e=>{this.dragInfo=void 0,this.dragging=!1,this.props.setInsertionSnippet(void 0);const t=document.getElementById("monacoDraggingBlock");t&&t.remove(),document.getElementById("root").style.overflow=""},this.getKeyDownHandler=(e,t,n)=>r=>{const a=pxt.Util.isUserLanguageRtl(),l=o.keyCodeFromEvent(r),c=r.target;if(40==l){let e=c.nextElementSibling;c&&e&&(e.click(),e.focus())}else if(38==l){let e=c.previousElementSibling;c&&e&&(e.click(),e.focus())}else 37==l&&!a||38==l&&a?this.props.moveFocusToParent():27==l?(this.setState({groups:void 0}),this.props.moveFocusToParent()):13==l&&e&&(t?Promise.resolve(t):i.snippetAsync(e.qName,n)).then((t=>{this.props.insertSnippet(null,t,"void"!=e.retType),s.fireEvent({type:"create",editor:"ts",blockId:e.attributes.blockId})}))},this.getHelpButtonClickHandler=e=>()=>{pxt.debug(`${e} help icon clicked.`),s.fireEvent({type:"ui",editor:"ts",action:"groupHelpClicked",data:{group:e}})},this.wheelHandler=e=>{e.stopPropagation()},this.scrollHandler=e=>{this.positionDragHandle()},this.getFlyoutStyle=()=>{var e,t;return{display:(null===(e=this.state)||void 0===e?void 0:e.groups)&&!(null===(t=this.state)||void 0===t?void 0:t.hide)?"block":"none"}},this.getIconStyle=e=>({color:e}),this.getSelectedStyle=()=>({touchAction:pxt.BrowserUtils.hasPointerEvents()?"pan-y":void 0}),this.getBlockStyle=e=>({backgroundColor:e,border:this.getData(l.HIGHCONTRAST)?`2px solid ${e}`:"none",fontSize:`${this.props.parent.settings.editorFontSize}px`,lineHeight:`${this.props.parent.settings.editorFontSize+16}px`}),this.state={}}componentDidMount(){pxt.BrowserUtils.hasPointerEvents()?(document.addEventListener("pointermove",this.blockDragHandler),document.addEventListener("pointerup",this.blockDragEndHandler)):(document.addEventListener("mousemove",this.blockDragHandler),document.addEventListener("mouseup",this.blockDragEndHandler),pxt.BrowserUtils.isTouchEnabled()&&(document.addEventListener("touchmove",this.blockDragHandler),document.addEventListener("touchend",this.blockDragEndHandler)))}componentWillUnmount(){pxt.BrowserUtils.hasPointerEvents()?(document.removeEventListener("pointermove",this.blockDragHandler),document.removeEventListener("pointerup",this.blockDragEndHandler)):(document.removeEventListener("mousemove",this.blockDragHandler),document.removeEventListener("mouseup",this.blockDragEndHandler),pxt.BrowserUtils.isTouchEnabled()&&(document.removeEventListener("touchmove",this.blockDragHandler),document.removeEventListener("touchend",this.blockDragEndHandler)))}componentDidUpdate(){this.positionDragHandle()}getQName(e){return"python"==this.props.fileType&&e.pyQName?e.pyQName:e.qName}getSnippetName(e){return("python"==this.props.fileType?e.pySnippetName||e.pyName:void 0)||e.snippetName||e.name}getBlockDescription(e,t){let n=[],i=pxt.blocks.compileInfo(e),o=e.attributes._def&&e.attributes._def.parts,s=e.qName||e.name;const a="python"==this.props.fileType;return o?(t&&o.filter((e=>"param"==e.kind)).length>t.length&&t.unshift(null),o.forEach(((e,t)=>{switch(e.kind){case"label":n.push((0,r.jsx)("span",{children:e.text},s+t));break;case"break":n.push((0,r.jsx)("span",{children:" "},s+t));break;case"param":let o=null==i?void 0:i.definitionNameToParam[e.name],l=(null==o?void 0:o.defaultValue)||e.varName||(null==o?void 0:o.actualName)||e.name;a&&(null==o?void 0:o.defaultValue)&&(l=pxtc.tsSnippetToPySnippet(l)),n.push((0,r.jsx)("span",Object.assign({className:"argName"},{children:l}),s+t))}}))):n.push((0,r.jsx)("span",{children:this.getSnippetName(e)||e.name},s)),t&&t.find((e=>(null==e?void 0:e.type)&&e.type.indexOf("=>")>=0))&&(n.unshift((0,r.jsx)("span",{children:lf("run code ")},"prefix")),(null==i?void 0:i.handlerArgs)&&(n.push((0,r.jsx)("span",{children:" "},"handler_break")),i.handlerArgs.forEach((e=>{e.inBlockDef||n.push((0,r.jsx)("span",Object.assign({className:"argName"},{children:e.name}),`handler_${e.name}`))})))),n}positionDragHandle(){let e=document.querySelector(".monacoBlock.hover .blockHandle");if(e){let t=e.parentElement,n=document.getElementById("monacoFlyoutWrapper");e.style.height=`${t.clientHeight}px`,e.style.left=`${t.clientWidth}px`,e.style.top=t.offsetTop-n.scrollTop+"px"}let t=document.querySelector(".monacoBlock.expand .blockHandle");if(t){let e=t.parentElement,n=document.getElementById("monacoFlyoutWrapper");t.style.height=`${e.clientHeight+8}px`,t.style.left=e.clientWidth+4-1+"px",t.style.top=e.offsetTop-n.scrollTop+"px"}}getMonacoBlock(e,t,n){if(void 0===e.snippet)return;const{ns:i}=this.state,o=this.props.parent.state.editorState?this.props.parent.state.editorState.filters:void 0,s=o?o.namespaces&&null!=o.namespaces[i]?o.namespaces[i]:o.defaultState:void 0,a=this.props.blockIdMap&&this.props.blockIdMap[e.attributes.blockId];let l=o?o.defaultState:pxt.editor.FilterState.Visible;if(o&&o.fns&&void 0!==o.fns[e.name]?l=o.fns[e.name]:o&&o.blocks&&e.attributes.blockId&&(void 0!==o.blocks[e.attributes.blockId]||(null==a?void 0:a.some((e=>o.blocks[e]))))?l=o.blocks[e.attributes.blockId]:void 0!==s&&(l=s),l==pxt.editor.FilterState.Hidden)return;const c=l==pxt.editor.FilterState.Disabled,u="python"==this.props.fileType,d=u?e.pySnippet:e.snippet,p=e.parameters,h=e.attributes.color||n,f=this.getBlockDescription(e,p?p.slice():null),g=e.attributes.help,m=this.getQName(e)||this.getSnippetName(e),v=m==this.state.selectedBlock,y=m==this.state.hoverBlock,b=pxt.BrowserUtils.hasPointerEvents(),x=pxt.BrowserUtils.isTouchEnabled(),E=this.getBlockDragStartHandler(e,d,h),_=e.attributes.jsDoc.replace(/``/g,'"').split("* @param",1)[0];return(0,r.jsxs)("div",Object.assign({className:`monacoBlock ${c?"monacoDisabledBlock":""} ${v?"expand":""} ${y?"hover":""}`,style:this.getSelectedStyle(),title:e.attributes.jsDoc,tabIndex:0,role:"listitem",onClick:this.getBlockClickHandler(m),onMouseOver:this.getBlockMouseOver(m),onMouseOut:this.getBlockMouseOut(m),onKeyDown:this.getKeyDownHandler(e,d,u),onPointerDown:b?E:void 0,onMouseDown:b?void 0:E,onTouchStart:!b&&x?E:void 0},{children:[(0,r.jsx)("div",Object.assign({className:"blockHandle",style:this.getSelectedStyle()},{children:(0,r.jsx)("i",{className:"icon bars"})})),(0,r.jsx)("div",Object.assign({className:"monacoDraggableBlock",style:this.getBlockStyle(h)},{children:(0,r.jsx)("span",Object.assign({className:"blockName"},{children:f}))})),(0,r.jsxs)("div",Object.assign({className:"detail"},{children:[(0,r.jsx)("div",Object.assign({className:"description"},{children:_})),(0,r.jsxs)("div",Object.assign({className:"signature"},{children:[(0,r.jsx)("span",{children:d||`${m}(${p?p.map((e=>`${e.name}`)).join(", "):""})`}),g&&(0,r.jsx)("a",Object.assign({className:"blockHelp",href:`/reference/${g}`,target:"_blank",rel:"noopener noreferrer",role:"button"},{children:(0,r.jsx)("i",{className:"question circle outline icon","aria-label":lf("Open documentation")})}))]})),p&&(0,r.jsx)("div",Object.assign({className:"params"},{children:p.map(((e,t)=>(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"separator"}),(0,r.jsx)("span",Object.assign({className:"paramName"},{children:e.name})),e.description&&(0,r.jsx)("span",Object.assign({className:"paramDescription"},{children:e.description.replace(/``/g,'"')}))]},t)))}))]}))]}),`block_${m}_${t}`)}renderCore(){const{name:e,ns:t,color:n,icon:i,groups:o}=this.state,s=pxt.toolbox.convertColor(n||t&&pxt.toolbox.getNamespaceColor(t)||"255"),a=`blocklyTreeIcon${i?(t||i).toLowerCase():"Default"}`.replace(/\s/g,"");return(0,r.jsx)("div",Object.assign({id:"monacoFlyoutWidget",className:"monacoFlyout",style:this.getFlyoutStyle()},{children:(0,r.jsxs)("div",Object.assign({id:"monacoFlyoutWrapper",onScroll:this.scrollHandler,onWheel:this.wheelHandler,role:"list"},{children:[(0,r.jsxs)("div",Object.assign({className:"monacoFlyoutLabel monacoFlyoutHeading"},{children:[(0,r.jsx)("span",Object.assign({className:`monacoFlyoutHeadingIcon blocklyTreeIcon ${a}`,role:"presentation",style:this.getIconStyle(s)},{children:i&&1===i.length?i:""})),(0,r.jsx)("div",Object.assign({className:"monacoFlyoutLabelText"},{children:pxtc.U.rlf(`{id:category}${e}`)}))]})),o&&o.map(((e,t)=>{let n=[];if(e.name!=pxt.DEFAULT_GROUP_NAME&&o.length>1&&n.push((0,r.jsxs)("div",Object.assign({className:"monacoFlyoutLabel blocklyFlyoutGroup",tabIndex:0,onKeyDown:this.getKeyDownHandler(),role:"separator"},{children:[e.icon&&(0,r.jsx)("span",Object.assign({className:`monacoFlyoutHeadingIcon blocklyTreeIcon ${a}`,role:"presentation"},{children:e.icon})),(0,r.jsx)("div",Object.assign({className:"monacoFlyoutLabelText"},{children:pxtc.U.rlf(`{id:group}${e.name}`)})),e.hasHelp&&pxt.editor.HELP_IMAGE_URI&&(0,r.jsx)("span",{children:(0,r.jsx)("img",{src:pxt.editor.HELP_IMAGE_URI,onClick:this.getHelpButtonClickHandler(e.name),alt:lf("Click for help")})}),(0,r.jsx)("hr",{className:"monacoFlyoutLabelLine"})]}),`label_${t}`)),e.blocks){let t=e.blocks.map(((e,t)=>e.attributes.blockBuiltin?void pxt.log("ignoring built in block: "+e.attributes.blockId):this.getMonacoBlock(e,t,s))).filter((e=>void 0!==e));if(!(t&&t.length>0))return null;n=n.concat(t)}return n}))]}))}))}}n.MonacoFlyout=c},{"./auth":48,"./compiler":58,"./core":133,"./data":136,"./workspace":208,"react/jsx-runtime":367}],175:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getToolboxDefinition=n.overrideToolbox=n.overrideCategory=n.clearBuiltinBlockCache=n.allBuiltinBlocksByName=n.allBuiltinBlocks=n.isBuiltin=n.getBuiltinCategory=n.blockIdMap=n.getPauseUntil=void 0;let r,i,o,s,a=null;function l(){return a||((a={}).loops={name:lf("{id:category}Loops"),nameid:"loops",blocks:[{name:"loops_while",snippetName:"while",snippet:"while (true) {\n    \n}",pySnippet:"while True:\n    pass",attributes:{blockId:"device_while",weight:48,jsDoc:lf("Repeat code while condition is true")}},{name:"loops_for",snippetName:"for",snippet:"for (let i = 0; i < 5; i++) {\n    \n}",pySnippet:"for i in range(4):\n    pass",attributes:{blockId:"pxt_controls_for",weight:47,jsDoc:lf("Repeat code a number of times in a loop")}}],attributes:{callingConvention:0,icon:"loops",weight:50.09,paramDefl:{}}},a.logic={name:lf("{id:category}Logic"),nameid:"logic",blocks:[{name:"logic_if",snippetName:"if",snippet:"if (true) {\n    \n}",pySnippet:"if True:\n    pass",attributes:{blockId:"controls_if",weight:49,jsDoc:lf("Runs code if the condition is true")}},{name:"logic_if_else",snippetName:"if else",snippet:"if (true) {\n    \n} else {\n    \n}",pySnippet:"if True:\n    pass\nelse:\n    pass",attributes:{blockId:"controls_if",weight:48,jsDoc:lf("Runs code if the condition is true; else run other code")}},{name:"logic_and",snippetName:"and",snippet:"true && true",pySnippet:"True and True",attributes:{blockId:"logic_compare",weight:47,jsDoc:lf("Runs code if both specified conditions are true")}},{name:"logic_or",snippetName:"or",snippet:"true || false",pySnippet:"True or False",attributes:{blockId:"logic_compare",weight:46,jsDoc:lf("Runs code if either of two specified conditions is true")}}],attributes:{callingConvention:0,weight:50.08,icon:"logic",paramDefl:{}}},a.variables={name:lf("{id:category}Variables"),nameid:"variables",blocks:[{name:"var_let",snippetName:"let",snippet:"let item: number",pySnippet:"item = 0",pySnippetName:"item = 0",snippetOnly:!0,attributes:{blockId:"variables_set",jsDoc:lf("Declares a variable named 'item'")}},{name:"var_equals",snippetName:"equals",snippet:"item = 0",pySnippet:"item = 0",snippetOnly:!0,attributes:{blockId:"variables_get",jsDoc:lf("Assigns a value to a variable")}},{name:"var_change",snippetName:"change",snippet:"item += 1",pySnippet:"item += 1",snippetOnly:!0,attributes:{blockId:"variables_change",jsDoc:lf("Changes the value of item by 1")}}],attributes:{callingConvention:0,weight:50.07,icon:"variables",paramDefl:{}}},a.Math={name:lf("{id:category}Math"),nameid:"Math",blocks:[{name:"Math.plus",snippetName:"plus",snippet:"1 + 1",pySnippet:"1 + 1",snippetOnly:!0,attributes:{weight:90,blockId:"math_arithmetic",jsDoc:lf("Adds two numbers together")},retType:"number"},{name:"Math.minus",snippetName:"minus",snippet:"1 - 1",pySnippet:"1 - 1",snippetOnly:!0,attributes:{weight:89,blockId:"math_arithmetic",jsDoc:lf("Subtracts the value of one number from another")},retType:"number"},{name:"Math.multiply",snippetName:"multiply",snippet:"1 * 1",pySnippet:"1 * 1",snippetOnly:!0,attributes:{weight:88,blockId:"math_arithmetic",jsDoc:lf("Multiplies two numbers together")},retType:"number"},{name:"Math.divide",snippetName:"divide",snippet:"1 / 1",pySnippet:"1 / 1",snippetOnly:!0,attributes:{weight:87,blockId:"math_arithmetic",jsDoc:lf("Returns the quotient of one number divided by another")},retType:"number"},{name:"Math.remainder",snippetName:"remainder",snippet:"1 % 2",pySnippet:"1 % 2",snippetOnly:!0,attributes:{weight:80,blockId:"math_modulo",jsDoc:lf("Returns the remainder of one number divided by another")},retType:"number"},{name:"Math.max",snippetName:"max",snippet:"Math.max(1, 2)",pySnippet:"max(1, 2)",attributes:{weight:75,blockId:"math_op2",jsDoc:lf("Returns the largest of two numbers")},retType:"number"},{name:"Math.min",snippetName:"min",snippet:"Math.min(1, 2)",pySnippet:"min(1, 2)",attributes:{weight:74,blockId:"math_op2",jsDoc:lf("Returns the smallest of two numbers")},retType:"number"},{name:"Math.abs",snippetName:"abs",snippet:"Math.abs(-1)",pySnippet:"abs(-1)",attributes:{weight:70,blockId:"math_op3",jsDoc:lf("Returns the absolute value of a number")},retType:"number"},{name:"randint",snippetName:"randint",snippet:"randint(0, 10)",pySnippetName:"randint",pySnippet:"randint(0, 10)",attributes:{weight:65,blockId:"device_random",jsDoc:lf("Returns a random number between min and max")},retType:"number"}],attributes:{callingConvention:0,weight:50.06,icon:"math",paramDefl:{}}},a.functions={name:lf("{id:category}Functions"),nameid:"functions",blocks:[{name:"functionDef",snippetName:"function doSomething",snippet:"function doSomething() {\n    \n}",pySnippetName:"def do_something",pySnippet:"def do_something():\n    pass",attributes:{blockId:"function_definition",jsDoc:lf("Define a function")}},{name:"functionCall",snippetName:"doSomething",snippet:"doSomething()",pySnippetName:"do_something",pySnippet:"do_something()",attributes:{blockId:"function_call",jsDoc:lf("Call a function")}}],attributes:{advanced:!0,weight:50.08,callingConvention:0,icon:"functions",paramDefl:{}}},a.arrays={name:lf("{id:category}Arrays"),nameid:"arrays",custom:!0,blocks:[{name:"array_create",snippetName:"create",snippet:`let ${lf("{id:snippets}list")} = [1, 2, 3]`,pySnippet:`${lf("{id:snippets}list")} = [1, 2, 3]`,snippetOnly:!0,attributes:{weight:100,blockId:"lists_create_with",jsDoc:lf("Creates a new Array")},retType:"array"},{name:"array_length",snippetName:"length",snippet:`${lf("{id:snippets}list")}.length`,pySnippetName:"len",pySnippet:`len(${lf("{id:snippets}list")})`,snippetOnly:!0,attributes:{weight:99,blockId:"lists_length",jsDoc:lf("Returns the number of values in an Array")},retType:"number"},{name:"array_get",snippetName:"get",snippet:`${lf("{id:snippets}list")}[0]`,pySnippet:`${lf("{id:snippets}list")}[0]`,snippetOnly:!0,attributes:{weight:98,blockId:"lists_index_get",jsDoc:lf("Returns the value in the Array at the given index")}},{name:"array_set",snippetName:"set",snippet:`${lf("{id:snippets}list")}[0] = 1`,pySnippet:`${lf("{id:snippets}list")}[0] = 1`,snippetOnly:!0,attributes:{weight:97,blockId:"lists_index_set",jsDoc:lf("Overwrites the value in an Array at the given index")}},{name:"array_push",snippetName:"push",snippet:`${lf("{id:snippets}list")}.push(1)`,pySnippetName:"append",pySnippet:`${lf("{id:snippets}list")}.append(1)`,attributes:{weight:96,blockId:"array_push",jsDoc:lf("Adds a value to the end of an Array")}},{name:"arary_pop",snippetName:"pop",snippet:`${lf("{id:snippets}list")}.pop()`,pySnippetName:"pop",pySnippet:`${lf("{id:snippets}list")}.pop()`,attributes:{weight:95,blockId:"array_pop",jsDoc:lf("Removes and returns the value at the end of an Array")},retType:"object"},{name:"array_insertAt",snippetName:"insertAt",snippet:`${lf("{id:snippets}list")}.insertAt(0, 0)`,pySnippetName:"insert",pySnippet:`${lf("{id:snippets}list")}.insert(0, 0)`,attributes:{weight:50,blockId:"array_insertAt",jsDoc:lf("Inserts a value into the Array at the given index"),advanced:!0}},{name:"array_removeAt",snippetName:"removeAt",snippet:`${lf("{id:snippets}list")}.removeAt(0)`,attributes:{weight:49,blockId:"array_removeat",jsDoc:lf("Removes a value from the Array at the given index and returns it"),advanced:!0},retType:"object"},{name:"array_shift",snippetName:"shift",snippet:`${lf("{id:snippets}list")}.shift()`,attributes:{weight:48,blockId:"array_shift",jsDoc:lf("Removes and returns the value at the front of an Array"),advanced:!0}},{name:"array_unshift",snippetName:"unshift",snippet:`${lf("{id:snippets}list")}.unshift(0)`,pySnippetName:"append",pySnippet:`${lf("{id:snippets}list")}.append(0)`,attributes:{weight:47,blockId:"array_unshift",jsDoc:lf("Inserts a value at the beginning of an Array"),advanced:!0}},{name:"array_indexOf",snippetName:"indexOf",snippet:"[0, 1, 2].indexOf(1)",pySnippetName:"index",pySnippet:"[0, 1, 2].index(1)",attributes:{weight:46,jsDoc:lf("Returns the first index in the Array that contains the given value or -1 if it does not exist in the Array"),advanced:!0},retType:"number"},{name:"array_reverse",snippetName:"reverse",snippet:`${lf("{id:snippets}list")}.reverse()`,pySnippet:`${lf("{id:snippets}list")}.reverse()`,attributes:{weight:45,jsDoc:lf("Reverses the contents of an Array"),advanced:!0}}],attributes:{advanced:!0,weight:50.07,icon:"arrays",callingConvention:0,paramDefl:{}}},a.text={name:lf("{id:category}Text"),nameid:"text",custom:!0,blocks:[{name:"text_length",snippetName:"length",snippet:'"".length',pySnippetName:"len",pySnippet:'len("")',snippetOnly:!0,attributes:{blockId:"text_length",jsDoc:lf("Returns the number of characters in a string")},retType:"number"},{name:"text_concat",snippetName:"concat",snippet:'"" + 5',pySnippet:'"" + 5',snippetOnly:!0,attributes:{blockId:"text_join",jsDoc:lf("Combines a string with a number, boolean, string, or other object into one string")},retType:"string"},{name:"text_compare",snippetName:"compare",snippet:'"".compare("")',attributes:{blockId:"string_compare",jsDoc:lf("Compares one string against another alphabetically and returns a number")},retType:"number"},{name:"text_parseInt",snippetName:"parseInt",snippet:'parseInt("5")',pySnippetName:"int",pySnippet:'int("5")',attributes:{blockId:"string_parseint",jsDoc:lf("Converts a number written as text into a number")},retType:"number"},{name:"text_substr",snippetName:"substr",snippet:'"".substr(0, 0)',pySnippet:'""[0:1]',attributes:{blockId:"string_substr",jsDoc:lf("Returns the part of a string starting at a given index with the given length")},retType:"string"},{name:"text_charAt",snippetName:"charAt",snippet:'"".charAt(0)',pySnippetName:"str[0]",pySnippet:'""[0]',attributes:{blockId:"string_get",jsDoc:lf("Returns the character at the given index")},retType:"string"}],attributes:{advanced:!0,weight:50.06,icon:"text",callingConvention:0,paramDefl:{}}},a.addpackage={name:pxt.toolbox.addPackageTitle(),nameid:"addpackage",blocks:[],custom:!0,customClick:e=>(e.closeFlyout(),e.showPackageDialog(),!0),attributes:{advanced:!1,weight:-1,icon:"addpackage",callingConvention:0,paramDefl:{}}}),a}function c(){if(r)return r;const e=pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock;if(e){const t=e.callName||"pauseUntil";let n=`${t}(() => true)`;e.namespace&&(n=`${e.namespace}.${n}`),r={name:"pause_until",snippetName:t,snippet:n,attributes:{blockNamespace:e.category||"loops",weight:null==e.weight?0:e.weight,jsDoc:lf("Pause execution of code until the given boolean expression is true"),advanced:!1}}}return r}function u(e){return l()[e]}function d(){o||(o={},s={},[u("loops"),u("logic"),u("Math"),u("text"),u("arrays"),u("variables"),u("functions")].forEach((e=>{e.blocks.forEach((t=>{t.type||t.snippet&&(t.attributes.blockId&&!o[t.attributes.blockId]&&(o[t.attributes.blockId]=[t,e.nameid]),s[t.name]||(s[t.name]=[t,e.nameid]))}))})))}function p(e,t){const n=u(e);if(t&&n&&(0===Object.keys(t).length&&(n.removed=!0),t.name&&(n.name=t.name),t.icon&&(n.attributes.icon=t.icon),void 0!==t.weight&&(n.attributes.weight=t.weight),void 0!==t.advanced&&(n.attributes.advanced=t.advanced),null!=t.groups&&(n.groups=t.groups),t.blocks)){let e=100;n.blocks=t.blocks.map(((t,n)=>(t.weight?e=t.weight:e--,function(e,t){return{name:e.name,snippet:e.snippet,pySnippet:e.pySnippet,snippetName:e.snippetName,pySnippetName:e.pySnippetName,snippetOnly:e.snippetOnly,attributes:{blockId:e.blockId,weight:t||e.weight,advanced:e.advanced,jsDoc:e.jsDoc,group:e.group},retType:e.retType,blockXml:e.blockXml}}(t,e))))}}function h(e){return{name:e.name,icon:e.attributes.icon,color:e.attributes.color,weight:e.attributes.weight,advanced:e.attributes.advanced,blocks:e.blocks?e.blocks.map((e=>function(e){return{name:e.name,snippet:e.snippet,pySnippet:e.pySnippet,snippetName:e.snippetName,pySnippetName:e.pySnippetName,snippetOnly:e.snippetOnly,retType:e.retType,weight:e.attributes.weight,advanced:e.attributes.advanced,jsDoc:e.attributes.jsDoc,group:e.attributes.group,blockXml:e.blockXml,blockId:e.attributes.blockId}}(e))):[]}}n.getPauseUntil=c,n.blockIdMap=function(){if(!i){i={pxt_controls_for:["controls_repeat_ext"]};const e=pxt.appTarget.blockIdMap;e&&Object.keys(e).forEach((t=>i[t]=e[t]))}return i},n.getBuiltinCategory=u,n.isBuiltin=function(e){return!!l()[e]},n.allBuiltinBlocks=function(){d();const e=c();return e&&(o[pxtc.PAUSE_UNTIL_TYPE]=[e,"pause_until"]),o},n.allBuiltinBlocksByName=function(){d();const e=c();return e&&(s[pxtc.PAUSE_UNTIL_TYPE]=[e,"pause_until"]),s},n.clearBuiltinBlockCache=function(){o=void 0,s=void 0},n.overrideCategory=p,n.overrideToolbox=function(e){p("loops",e.loops),p("logic",e.logic),p("variables",e.variables),p("Math",e.maths),p("text",e.text),p("arrays",e.arrays),p("functions",e.functions)},n.getToolboxDefinition=function(){return{loops:h(u("loops")),logic:h(u("logic")),variables:h(u("variables")),maths:h(u("Math")),text:h(u("text")),arrays:h(u("arrays")),functions:h(u("functions"))}}},{}],176:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.fixIndentationInRange=n.provideDocumentRangeFormattingEdits=void 0;function r(e){return e&&e.match(/^ */)[0].length||0}function i(e,t){return new Array(e+1).join(" ")+t.trim()}function o(e,t,n){return e.slice(t.getOffsetAt({lineNumber:n,column:0}),t.getOffsetAt({lineNumber:n+1,column:0}))}function s(e,t,n){const s=e.getValue(),a=e.getOffsetAt({lineNumber:t.startLineNumber,column:0}),l=e.getOffsetAt({lineNumber:t.startLineNumber,column:t.startColumn}),c=e.getOffsetAt({lineNumber:t.endLineNumber,column:t.endColumn});let u;u=n?(s.slice(a,l)+n).split("\n"):s.slice(a,c).split("\n");const d=a!==l&&!!s.substring(a,l).trim(),p=u.map(((e,t)=>e?t:-1)).filter((e=>e>=0));let h=t.startLineNumber-1,f=o(s,e,h);for(;!f&&h>0;)f=o(s,e,h-=1);let g=r(f);(function(e){return":"==(e=e.trim())[e.length-1]})(f)&&(g+=4),u[0]=d?u[0]:i(g,u[0]);for(let e=1;e<p.length;e++){let t=p[e],n=u[t],o=r(n);u[t]=i(g+o,n)}return[{text:u.join("\n"),range:t.setStartPosition(t.startLineNumber,0)}]}n.provideDocumentRangeFormattingEdits=function(e,t,n,r){return s(e,t)},n.fixIndentationInRange=s},{}],177:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.NotificationBanner=n.GenericBanner=void 0;const r=e("react/jsx-runtime"),i=e("./data"),o=e("./sui");class s extends i.Component{constructor(e){super(e),this.delayTime=this.props.delayTime||0,this.doneSleeping=this.sleepDone(),this.bannerType=this.props.bannerType||"default",this.handleClick=this.handleClick.bind(this)}componentDidMount(){this.doneSleeping&&(this.timer=setTimeout((()=>this.show()),this.delayTime))}componentWillUnmount(){clearTimeout(this.timer)}sleepDone(){if(!this.props.sleepTime)return!0;const e=parseInt(pxt.storage.getLocal("lastBannerClosedTime")||"0");return pxt.Util.nowSeconds()-e>this.props.sleepTime}show(){pxt.tickEvent(`notificationBanner.${this.props.id}.show`),this.props.displayTime&&(this.timer=setTimeout((()=>this.hide("automatic")),this.delayTime+this.props.displayTime)),this.props.parent.setBannerVisible(!0),this.render()}hide(e){pxt.tickEvent(`notificationBanner.${this.props.id}.`+e+"Close"),pxt.storage.setLocal("lastBannerClosedTime",pxt.Util.nowSeconds().toString()),this.props.parent.setBannerVisible(!1),this.render()}handleClick(){this.hide("manual"),clearTimeout(this.timer)}renderCore(){return this.props.parent.state.bannerVisible&&this.doneSleeping?(0,r.jsxs)("div",Object.assign({id:"notificationBanner",className:`ui attached ${this.bannerType} message`},{children:[(0,r.jsx)("div",Object.assign({className:"bannerLeft"},{children:(0,r.jsx)("div",Object.assign({className:"content"},{children:this.props.children}))})),(0,r.jsx)("div",Object.assign({className:"bannerRight"},{children:(0,r.jsx)(o.Icon,{icon:"close",tabIndex:0,onClick:this.handleClick})}))]})):(0,r.jsx)("div",{})}}n.GenericBanner=s;class a extends i.Component{constructor(e){super(e),this.state={},this.clearExperiments=this.clearExperiments.bind(this)}clearExperiments(){pxt.tickEvent("banner.experiments",void 0,{interactiveConsent:!0}),pxt.editor.experiments.clear(),this.props.parent.reloadEditor()}renderCore(){const e=pxt.appTarget.appTheme,t=pxt.BrowserUtils.isElectron(),n="localhost"===location.hostname,i="/"!==location.pathname&&-1===(e.appPathNames||[]).indexOf(location.pathname),a=!n&&t&&i;if(pxt.editor.experiments.someEnabled()&&!/experiments=1/.test(window.location.href)){const e=2e4;return(0,r.jsxs)(s,Object.assign({id:"experimentsbanner",parent:this.props.parent,bannerType:"negative",displayTime:e},{children:[(0,r.jsx)(o.Icon,{icon:"information circle"}),(0,r.jsx)("div",Object.assign({className:"header"},{children:lf("Experiments enabled.")})),(0,r.jsx)(o.Link,Object.assign({className:"link",ariaLabel:lf("Clear"),onClick:this.clearExperiments},{children:lf("Clear")}))]}))}if(a){const e=pxt.appTarget.appTheme.homeUrl+location.search+location.hash;return(0,r.jsxs)(s,Object.assign({id:"experimental",parent:this.props.parent,bannerType:"negative"},{children:[(0,r.jsx)(o.Icon,{icon:"warning circle"}),(0,r.jsx)("div",Object.assign({className:"header"},{children:lf("You are viewing an experimental version of the editor")})),(0,r.jsx)(o.Link,Object.assign({className:"link",ariaLabel:lf("Go back to live editor"),href:e},{children:lf("Take me back")}))]}))}return(0,r.jsx)("div",{})}}n.NotificationBanner=a},{"./data":136,"./sui":200,"react/jsx-runtime":367}],178:[function(e,t,n){"use strict";function r(e){return{simulator:{targetQuery:"#boardview"},toolbox:{targetQuery:".blocklyToolboxDiv"},workspace:{targetQuery:"#blocksEditor",sansQuery:".blocklyToolboxDiv",sansLocation:2},share:{targetQuery:".shareproject"},download:{targetQuery:"#downloadArea"},everything:{targetQuery:"#root"}}[e]}async function i(e){const t=await pxt.Cloud.markdownAsync(e);return pxt.getSectionsFromMarkdownMetadata(t)}function o(e){switch(e){case"above":return 0;case"below":return 1;case"left":return 2;case"right":return 3;case"center":default:return 4}}Object.defineProperty(n,"__esModule",{value:!0}),n.getLocation=n.parseTourStepsAsync=n.loadTourStepsAsync=void 0,n.loadTourStepsAsync=i,n.parseTourStepsAsync=async function(e){var t,n;const s=[],a=await i(e);for(const e of a)if("double"===e.headerKind&&e.attributes&&e.attributes.title&&e.attributes.description&&e.attributes.location&&e.attributes.highlight){const i=e.attributes.title,a=e.attributes.description;let l=o(e.attributes.location.toLowerCase()),c=r(e.attributes.highlight.toLowerCase());c||(c={targetQuery:"#root"},l=4,console.log(`Tour steps: "${e.attributes.highlight}" is not a valid element to highlight!`));const u={title:i,description:a,location:l,targetQuery:c.targetQuery,sansQuery:null!==(t=c.sansQuery)&&void 0!==t?t:void 0,sansLocation:null!==(n=c.sansLocation)&&void 0!==n?n:void 0};s.push(u)}return s},n.getLocation=o},{}],179:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getExtensionOfFileName=n.invalidatePagesStatus=n.invalidatePullRequestStatus=n.invalidatePullStatus=n.loadPkgAsync=n.notifySyncDone=n.allEditorPkgs=n.genFileName=n.mainEditorPkg=n.getEditorPkg=n.mainPkg=n.EditorPackage=n.File=n.setupAppTarget=void 0;const r=e("./workspace"),i=e("./data"),o=e("./core"),s=e("./db"),a=e("./compiler");var l=pxt.Util;let c=new s.Table("hostcache"),u={ts:10,blocks:20,jres:25,json:30,md:40};n.setupAppTarget=function(e){pxt.setAppTarget(e)};const d=".g.";class p{constructor(e,t,n){this.epkg=e,this.name=t,this.content=n,this.inSyncWithEditor=!0}isReadonly(){return!this.epkg.header||this.isAutoGenerated()}getName(){return this.epkg.getPkgId()+"/"+this.name}getTextFileName(){return this.epkg.isTopLevel()?this.name:"pxt_modules/"+this.epkg.getPkgId()+"/"+this.name}getFileNameWithExtension(e){const t=this.getTextFileName();return t.substring(0,t.length-this.getExtension().length)+e}getExtension(){return b(this.name)}getVirtualFileName(e){const t=this.name.replace(/.*\./,""),n=t?this.name.slice(0,-t.length-1):this.name;if(/^blocks|py|ts$/.test(t))switch(e){case pxt.BLOCKS_PROJECT_NAME:return n+".blocks";case pxt.JAVASCRIPT_PROJECT_NAME:return n+".ts";case pxt.PYTHON_PROJECT_NAME:return n+".py";default:return void pxt.U.oops()}}weight(){return/^main\./.test(this.name)?5:/^_locales\//.test(this.name)?500:u.hasOwnProperty(this.getExtension())?u[this.getExtension()]:60}markDirty(){this.inSyncWithEditor=!1,this.updateStatus()}updateStatus(){i.invalidate("open-meta:"+this.getName())}setBaseGitContent(e){e!=this.baseGitContent&&(this.baseGitContent=e,this.updateStatus())}setContentAsync(e,t){if(l.assert(void 0!==e),this.inSyncWithEditor=!0,e!=this.content){let n=this.content;return this.content=e,this.updateStatus(),this.epkg.saveFileAsync(this.name).then((()=>{this.content==e&&this.updateStatus(),t&&this.forceChangeCallback&&this.forceChangeCallback(n,e),this.name==pxt.github.GIT_JSON&&this.epkg.updateGitJsonCache()}))}return this.updateStatus(),Promise.resolve()}setForceChangeCallback(e){this.forceChangeCallback=e}publishedContent(){let e=this.content;return this.name==pxt.CONFIG_NAME&&(e=r.prepareConfigForGithub(e)),e}isAutoGenerated(){return"this"===this.epkg.getPkgId()&&(this.name===pxt.TILEMAP_CODE||this.name===pxt.TILEMAP_JRES||this.name===pxt.IMAGES_CODE||this.name===pxt.IMAGES_JRES||this.name===pxt.TUTORIAL_INFO_FILE||this.name==pxt.ASSETS_FILE)}}n.File=p;class h{constructor(e,t){this.ksPkg=e,this.topPkg=t,this.files={},this.onupdate=()=>{},this.saveScheduled=!1,this.savingNow=0,this.simStateSaveScheduled=!1,this.transpileCache=[],e&&"workspace"==e.verProtocol()&&(this.header=r.getHeader(e.verArgument()))}getSimState(){if(!this.simState){this.files[pxt.SIMSTATE_JSON]||this.setFile(pxt.SIMSTATE_JSON,"{}");const e=this.files[pxt.SIMSTATE_JSON];try{this.simState=JSON.parse(e.content)}catch(e){this.simState={}}}return this.simState}setSimState(e,t){const n=this.getSimState();n[e]!=t&&(null==t?delete n[e]:n[e]=t,this.simStateSaveScheduled||(this.simStateSaveScheduled=!0,setTimeout((()=>{if(this.simStateSaveScheduled=!1,!this.simState)return;const e=this.files[pxt.SIMSTATE_JSON];e&&e.setContentAsync(JSON.stringify(this.simState))}),2e3)))}getTopHeader(){return this.topPkg.header}getLanguageRestrictions(){const e=this.topPkg.ksPkg,t=e&&e.config;return t&&t.languageRestriction}getGeneratedFiles(e){if(e.name.indexOf(d)>-1){const t=e.name.substring(0,e.name.indexOf(d)+d.length);return l.values(this.files).filter((n=>n!==e&&pxt.U.startsWith(n.name,t)))}return[]}afterMainLoadAsync(){return this.assetsPkg?this.assetsPkg.loadAssetsAsync():Promise.resolve()}saveAssetAsync(e,t){return r.saveAssetAsync(this.header.id,e,t).then((()=>this.assetsPkg.loadAssetsAsync()))}loadAssetsAsync(){return"assets"!=this.id?Promise.resolve():r.listAssetsAsync(this.topPkg.header.id).then((e=>{let t=l.flatClone(this.files);for(let n of e){let e=n.name,r=l.lookup(this.files,e);r?delete t[e]:(r=new p(this,e,`File size: ${n.size}; URL: ${n.url}`),this.files[e]=r)}for(let e of Object.keys(t))delete this.files[e];let n="";for(let t of this.sortedFiles()){let r=e.filter((e=>e.name==t.name))[0];n+=`    export const ${t.name.replace(/\..*/,"").replace(/[^a-zA-Z0-9_]/g,"_")} = "${r.url}";\n`}let r=this.topPkg.lookupFile("assets.ts");if(r||n){n=`namespace assets {\n${n}}\n`;let e=this.topPkg.ksPkg.config;if(e.files.indexOf("assets.ts")<0&&(e.files.push("assets.ts"),this.topPkg.ksPkg.saveConfig()),r)return r.setContentAsync(n);this.topPkg.setFile("assets.ts",n)}return Promise.resolve()}))}makeTopLevel(){this.topPkg=this,this.outputPkg=new h(null,this),this.outputPkg.id="built",pxt.appTarget.runtime&&pxt.appTarget.runtime.assetExtensions&&(this.assetsPkg=new h(null,this),this.assetsPkg.id="assets")}updateConfigAsync(e){let t=this.files[pxt.CONFIG_NAME];if(t)try{let n=JSON.parse(t.content);return e(n),t.setContentAsync(pxt.Package.stringifyConfig(n)).then((()=>this.ksPkg.loadConfig()))}catch(e){}return null}async updateDepAsync(e){let t=this.ksPkg.resolveDep(e);if(!t||"github"!=t.verProtocol())return Promise.resolve();let n=pxt.github.parseRepoId(t.verArgument());if(!n)return;const r=await pxt.packagesConfigAsync(),i=await pxt.github.latestVersionAsync(n.slug,r,!0),s=l.values(this.ksPkg.dependencies()).map((e=>pxt.github.parseRepoId(e))).filter((e=>(null==e?void 0:e.slug)===n.slug)),a=await Promise.all(s.map((e=>(e.tag=i,pxt.github.pkgConfigAsync(e.fullName,e.tag,r).catch(o.handleNetworkError).then((t=>({ghid:e,cfg:t})))))));await this.updateConfigAsync((e=>a.forEach((({ghid:t,cfg:n})=>e.dependencies[n.name]=pxt.github.stringifyRepo(t))))),await this.saveFilesAsync()}removeDepAsync(e){return this.updateConfigAsync((t=>delete t.dependencies[e]))}setDependencyAsync(e,t){return this.updateConfigAsync((n=>n.dependencies[e]=t)).then((()=>this.saveFilesAsync()))}getKsPkg(){return this.ksPkg}getPkgId(){return this.ksPkg?this.ksPkg.id:this.id}isTopLevel(){return this.ksPkg&&0==this.ksPkg.level}setFile(e,t,n){l.assert(!!e,"missing file name");let r=new p(this,e,t);return n&&(r.virtual=!0),this.files[e]=r,i.invalidate("open-meta:"),r}removeFileAsync(e){return delete this.files[e],i.invalidate("open-meta:"),this.updateConfigAsync((t=>{t.files=t.files.filter((t=>t!=e)),t.testFiles&&(t.testFiles=t.testFiles.filter((t=>t!=e)))}))}setContentAsync(e,t){l.assert(!!e,"missing file name");let n=this.files[e],r=Promise.resolve();return n||(n=new p(this,e,""),this.files[e]=n,r=r.then((()=>this.updateConfigAsync((t=>t.files.indexOf(e)<0?t.files.push(e):0))))),r.then((()=>n.setContentAsync(t)))}updateGitJsonCache(){const e=this.files[pxt.github.GIT_JSON];if(e){const t=JSON.parse(e.content),n=pxt.github.parseRepoId(t.repo);t.commit&&Object.keys(this.files).forEach((e=>{const r=pxt.github.lookupFile(n,t.commit,e);r&&null!=r.blobContent&&this.files[e].setBaseGitContent(r.blobContent)}))}}setFiles(e){this.files=l.mapMap(e,((e,t)=>new p(this,e,t))),i.invalidate("open-meta:"),this.updateGitJsonCache()}getAllFiles(){let e=l.mapMap(this.files,((e,t)=>t.content));return delete e[pxt.SERIAL_EDITOR_FILE],e}saveFileAsync(e){var t;if(!this.header)return Promise.resolve();const n=null===(t=this.files[e])||void 0===t?void 0:t.content;return e===pxt.CONFIG_NAME?this.saveFilesAsync():r.partialSaveAsync(this.header.id,e,n)}saveFilesAsync(){if(!this.header)return Promise.resolve();let e=this.files[pxt.CONFIG_NAME];if(e)try{let t=JSON.parse(e.content);this.header.name=t.name}catch(e){}return r.saveAsync(this.header,this.getAllFiles())}sortedFiles(){let e=l.values(this.files);return pxt.options.debug||(e=e.filter((e=>e.name!=pxt.github.GIT_JSON&&e.name!=pxt.SIMSTATE_JSON&&e.name!=pxt.SERIAL_EDITOR_FILE&&e.name!=pxt.PALETTES_FILE))),e.sort(((e,t)=>e.weight()-t.weight()||l.strcmp(e.name,t.name))),e}forEachFile(e){this.pkgAndDeps().forEach((t=>{l.values(t.files).forEach(e)}))}getMainFile(){return this.sortedFiles()[0]}pkgAndDeps(){if(this.topPkg!=this)return this.topPkg.pkgAndDeps();let e=this.ksPkg.deps,t=Object.keys(e),n=[];for(let r of t)/---/.test(r)||e[r].cppOnly||n.push(m(e[r]));return this.assetsPkg&&n.push(this.assetsPkg),n.push(this.outputPkg),n}filterFiles(e){return l.concat(this.pkgAndDeps().map((t=>l.values(t.files).filter(e))))}lookupFile(e){return 0===e.indexOf("pxt_modules/")&&(e=e.slice(12)),this.filterFiles((t=>t.getName()==e))[0]}async buildAssetsAsync(){var e;(null===(e=this.tilemapProject)||void 0===e?void 0:e.needsRebuild)&&(this.tilemapProject.needsRebuild=!1,await this.buildTilemapsAsync(),await this.buildImagesAsync())}buildTilemapsAsync(){const e=this.lookupFile("this/"+pxt.TILEMAP_CODE),t=this.lookupFile("this/"+pxt.TILEMAP_JRES),r=this.tilemapProject.getProjectTilesetJRes();if(!e&&1===Object.keys(r).length)return Promise.resolve();const i=pxt.emitTilemapsFromJRes(r),o=JSON.stringify(r,null,4);return(null==e?void 0:e.content)===i&&(null==t?void 0:t.content)===o?Promise.resolve():this.setContentAsync(pxt.TILEMAP_JRES,o).then((()=>this.setContentAsync(pxt.TILEMAP_CODE,i))).then((()=>{n.mainPkg.updateJRes(),a.refreshLanguageServiceApisInfo()}))}buildImagesAsync(){const e=this.lookupFile("this/"+pxt.IMAGES_CODE),t=this.lookupFile("this/"+pxt.IMAGES_JRES),r=this.tilemapProject.getProjectAssetsJRes();if(!e&&1===Object.keys(r).length)return Promise.resolve();const i=pxt.emitProjectImages(r),o=JSON.stringify(r,null,4);return(null==e?void 0:e.content)===i&&(null==t?void 0:t.content)===o?Promise.resolve():this.setContentAsync(pxt.IMAGES_JRES,o).then((()=>this.setContentAsync(pxt.IMAGES_CODE,i))).then((()=>{n.mainPkg.updateJRes(),a.refreshLanguageServiceApisInfo()}))}cacheTranspile(e,t,n,r){this.transpileCache.push({fromLanguage:e,fromText:t,toLanguage:n,toText:r}),this.transpileCache.length>10&&this.transpileCache.shift()}getCachedTranspile(e,t,n){for(const r of this.transpileCache){if(r.toLanguage===e&&r.fromLanguage===n&&f(e,r.toText,t))return r.fromText;if(r.fromLanguage===e&&r.toLanguage===n&&f(e,r.fromText,t))return r.toText}return null}invalidateCachedTranspile(e,t,n){for(let r=0;r<this.transpileCache.length;r++){const i=this.transpileCache[r],o=i.toLanguage===e&&i.fromLanguage===n&&f(e,i.toText,t),s=i.fromLanguage===e&&i.toLanguage===n&&f(e,i.fromText,t);if(o||s)return void this.transpileCache.splice(r,1)}}addDependencyAsync(e,t,n){return this.topPkg!==this?this.topPkg.addDependencyAsync(e,t):this.ksPkg.findConflictsAsync(e,t).then((r=>{let i=e.core?[]:r.filter((e=>this.ksPkg.isPackageInUse(e.pkg0.id))),s=Promise.resolve(!0);if(i.length)s=s.then((()=>o.confirmAsync({header:lf("Cannot add {0} extension",e.name),hideCancel:!0,agreeLbl:lf("Ok"),body:lf("Remove all the blocks from the {0} extension and try again.",i[0].pkg0.id)}))).then((()=>!1));else if(r.length){const t=1===r.length?lf("Extension {0} is incompatible with {1}. Remove {0} and add {1}?",r[0].pkg0.id,e.name):lf("Extensions {0} and {1} are incompatible with {2}. Remove them and add {2}?",r.slice(0,-1).map((e=>e.pkg0.id)).join(", "),r.slice(-1)[0].pkg0.id,e.name);s=s.then((()=>n?Promise.resolve(1):o.confirmAsync({header:lf("Some extensions will be removed"),agreeLbl:lf("Remove extension(s) and add {0}",e.name),agreeClass:"pink",body:t}))).then((e=>0!==e?Promise.all(r.map((e=>this.removeDepAsync(e.pkg0.id)))).then((()=>!0)):Promise.resolve(!1)))}return s.then((n=>n?this.setDependencyAsync(e.name,t).then((()=>!0)):Promise.resolve(!1)))}))}}function f(e,t,n){return t===n}n.EditorPackage=h;const g=new class{readFile(e,t){let n=m(e).files[t];return n?n.content:null}writeFile(e,t,n,r){if(t!=pxt.CONFIG_NAME&&!r)throw l.oops("trying to write "+e+" / "+t);{let i=m(e),o=i.files[t];if(o)o.setContentAsync(n,r);else{if(-1===e.config.files.indexOf(t))throw l.oops("trying to write file not listed in pxt.json "+e+" / "+t);i.files[t]=new p(i,t,n)}}}getHexInfoAsync(e){return pxt.hexloader.getHexInfoAsync(this,e).catch(o.handleNetworkError)}cacheStoreAsync(e,t){return c.forceSetAsync({id:e,val:t}).then((()=>{}),(t=>{pxt.tickEvent("cache.store.failed",{error:t.name}),pxt.log(`cache store failed for ${e}: ${t.name}`)}))}cacheGetAsync(e){return c.getAsync(e).then((e=>e.val),(e=>null))}downloadPackageAsync(e){let t=e.verProtocol(),i=m(e),o=t=>r.getTextAsync(t).then((n=>i.isTopLevel()||n?n?i.isTopLevel()&&i.header?r.recomputeHeaderFlagsAsync(i.header,n).then((()=>i.setFiles(n))):(i.setFiles(n),Promise.resolve()):Promise.reject(new Error(`Cannot find text for package '${t}' in the workspace.`)):(e.configureAsInvalidPackage(`cannot find '${t}' in the workspace.`),Promise.resolve())));if("pub"==t)return r.getPublishedScriptAsync(e.verArgument()).then((e=>i.setFiles(e)));if("github"==t)return r.getPublishedScriptAsync(e.version()).then((e=>i.setFiles(e)));if("workspace"==t)return o(e.verArgument());if("file"==t){let t=e.verArgument();return"."==t[0]&&(t=function(e){return e.replace(/\/+/g,"/").replace(/[^\/]+\/\.\.\//g,"").replace(/\/\.\//g,"/")}(e.parent.verArgument()+"/"+t)),o(t)}if("embed"==t)return i.setFiles(pxt.getEmbeddedScript(e.verArgument())),Promise.resolve();if("pkg"==t){const t=n.mainPkg.readFile(e.verArgument().replace(/^\.\//,"")),r=ts.pxtc.Util.jsonTryParse(t);return r?i.setFiles(r):pxt.log(`failed to resolve ${e.version()}`),Promise.resolve()}return"invalid"==t?(pxt.log(`skipping invalid pkg ${e.id}`),Promise.resolve()):Promise.reject(`Cannot download ${e.version()}; unknown protocol`)}};function m(e){let t=e._editorPkg;if(t)return t;let r=null;e!=n.mainPkg&&(r=m(n.mainPkg));let i=new h(e,r);return e==n.mainPkg&&i.makeTopLevel(),e._editorPkg=i,i}function v(){return m(n.mainPkg)}function y(){return m(n.mainPkg).pkgAndDeps()}function b(e){let t=/\.([^\.]+)$/.exec(e);return t?t[1]:""}n.mainPkg=new pxt.MainPackage(g),n.getEditorPkg=m,n.mainEditorPkg=v,n.genFileName=function(e){let t=v().header.name.replace(/[()\\\/.,?*^:<>!;'#$%^&|"@+={}\[\]~`\x00-\x1F]/g,"");if(t=t.trim().replace(/\s+/g,"-"),pxt.appTarget.appTheme&&pxt.appTarget.appTheme.fileNameExclusiveFilter){const e=new RegExp(pxt.appTarget.appTheme.fileNameExclusiveFilter,"g");t=t.replace(e,"")}return t||(t="Untitled"),`${pxt.appTarget.nickname||pxt.appTarget.id}-${t}${e}`},n.allEditorPkgs=y,n.notifySyncDone=function(e){l.values(n.mainPkg.deps).filter((t=>"workspace"==t.verProtocol()&&e.hasOwnProperty(t.verArgument()))).length>0&&m(n.mainPkg).onupdate()},n.loadPkgAsync=function(e,t){return n.mainPkg=new pxt.MainPackage(g),n.mainPkg._verspec="workspace:"+e,g.downloadPackageAsync(n.mainPkg).catch(o.handleNetworkError).then((()=>ts.pxtc.Util.jsonTryParse(g.readFile(n.mainPkg,pxt.CONFIG_NAME)))).then((e=>e?n.mainPkg.installAllAsync(t).then((()=>v().afterMainLoadAsync())):(n.mainPkg.configureAsInvalidPackage(lf("invalid pxt.json file")),v().afterMainLoadAsync())))},i.mountVirtualApi("open-meta",{getSync:e=>{e=i.stripProtocol(e);const t=v(),n=t.lookupFile(e);if(!n)return{};const r=!(!t.header||!t.header.githubId||n.epkg!=t),o={isReadonly:n.isReadonly(),numErrors:n.numDiagnosticsOverride,isGitModified:r&&n.baseGitContent!=n.publishedContent()};return null==o.numErrors&&(o.numErrors=n.diagnostics?n.diagnostics.length:0,o.diagnostics=n.diagnostics),o}}),i.mountVirtualApi("open-pkg-meta",{getSync:e=>{e=i.stripProtocol(e);const t=y().filter((t=>t.getPkgId()==e))[0];if(!t||"built"==t.getPkgId())return{};const n=t.sortedFiles();let r=n.reduce(((e,t)=>e+(t.numDiagnosticsOverride||(t.diagnostics?t.diagnostics.length:0)||0)),0);const o=t.getKsPkg();o&&o.invalid()&&r++;const s={numErrors:r};return r&&(s.diagnostics=[],n.filter((e=>!!e.diagnostics)).forEach((e=>s.diagnostics.concat(e.diagnostics)))),s}}),i.mountVirtualApi("pkg-git-status",{getSync:e=>{e=i.stripProtocol(e);const t=y().find((t=>t.header&&t.header.id==e)),n={};if(t&&(n.id="this"==t.getPkgId()&&t.header&&t.header.githubId,n.id)){const e=t.sortedFiles();n.modified=!!e.find((e=>e.baseGitContent!=e.publishedContent()))}return n}}),n.invalidatePullStatus=function(e){i.invalidateHeader("pkg-git-pull-status",e)},i.mountVirtualApi("pkg-git-pull-status",{getAsync:e=>{e=i.stripProtocol(e);const t=y().find((t=>t.header&&t.header.id==e));return"this"==t.getPkgId()&&t.header&&t.header.githubId?r.pullAsync(t.header,!0).catch((e=>r.PullStatus.NoSourceControl)):Promise.resolve(r.PullStatus.NoSourceControl)},expirationTime:e=>36e5}),n.invalidatePullRequestStatus=function(e){i.invalidateHeader("pkg-git-pr",e)},i.mountVirtualApi("pkg-git-pr",{getAsync:e=>{const t={number:-1};e=i.stripProtocol(e);const n=y().find((t=>t.header&&t.header.id==e)),r=n.header,o="this"==n.getPkgId()&&r&&r.githubId;if(!o)return Promise.resolve(t);const s=pxt.github.parseRepoId(o);return s&&s.tag&&"master"!=s.tag?pxt.github.findPRNumberforBranchAsync(s.fullName,s.tag).catch((e=>t)):Promise.resolve(t)},expirationTime:e=>36e5}),n.invalidatePagesStatus=function(e){i.invalidateHeader("pkg-git-pages",e)},i.mountVirtualApi("pkg-git-pages",{getAsync:e=>{e=i.stripProtocol(e);const t=y().find((t=>t.header&&t.header.id==e)),n=t.header,r="this"==t.getPkgId()&&n&&n.githubId;if(!r)return Promise.resolve(void 0);const o=pxt.github.parseRepoId(r);return o?pxt.github.getPagesStatusAsync(o.fullName).catch((e=>{})):Promise.resolve(void 0)},expirationTime:e=>36e5}),i.mountVirtualApi("pkg-status",{getSync:e=>{e=i.stripProtocol(e);const t=y().find((t=>t.header&&t.header.id==e));return t&&t.savingNow?"saving":""}}),n.getExtensionOfFileName=b},{"./compiler":58,"./core":133,"./data":136,"./db":137,"./workspace":208}],180:[function(e,t,n){"use strict";var r=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.ChooseHwDialog=n.NewProjectDialog=n.ExitAndSaveDialog=n.ImportDialog=n.ProjectsDetail=n.ProjectsCodeCard=n.ProjectsCarousel=n.ProjectSettingsMenu=n.Projects=void 0;const i=e("react/jsx-runtime"),o=e("react"),s=e("react-dom"),a=e("./data"),l=e("./sui"),c=e("./core"),u=e("./cloudsync"),d=e("./auth"),p=e("./codecard"),h=e("./carousel"),f=e("./dialogs"),g=e("./util");class m extends d.Component{constructor(e){super(e),this.state={visible:!1},this.showLanguagePicker=this.showLanguagePicker.bind(this),this.showAboutDialog=this.showAboutDialog.bind(this),this.chgHeader=this.chgHeader.bind(this),this.chgGallery=this.chgGallery.bind(this),this.importProject=this.importProject.bind(this),this.showScriptManager=this.showScriptManager.bind(this),this.setSelected=this.setSelected.bind(this)}shouldComponentUpdate(e,t,n){return this.state.visible!=t.visible||this.state.selectedCategory!=t.selectedCategory||this.state.selectedIndex!=t.selectedIndex}setSelected(e,t){null==t||this.state.selectedCategory==e&&this.state.selectedIndex==t?this.setState({selectedCategory:void 0,selectedIndex:void 0}):this.setState({selectedCategory:e,selectedIndex:t})}componentDidUpdate(e,t){this.state.selectedCategory!==t.selectedCategory&&this.ensureSelectedItemVisible()}ensureSelectedItemVisible(){let e=this.refs.activeCarousel;if(e){let t=e.getCarouselDOM();this.scrollElementIntoViewIfNeeded(t)}}scrollElementIntoViewIfNeeded(e){let t=s.findDOMNode(this.refs.homeContainer);const n=e.getBoundingClientRect().top;t.parentElement.scrollTop=t.parentElement.scrollTop+n-30}showLanguagePicker(){pxt.tickEvent("projects.langpicker"),this.props.parent.showLanguagePicker()}showAboutDialog(){(0,f.showAboutDialogAsync)(this.props.parent)}chgHeader(e){pxt.tickEvent("projects.header"),c.showLoading("changeheader",lf("loading...")),this.props.parent.loadHeaderAsync(e).catch((e=>(c.warningNotification(lf("Sorry, we could not load this project.")),pxt.reportException(e),this.props.parent.openHome(),Promise.reject(e)))).finally((()=>{c.hideLoading("changeheader")}))}chgGallery(e,t){k(this.props.parent,"projects",e,t)}importProject(){pxt.tickEvent("projects.importdialog",void 0,{interactiveConsent:!0}),this.props.parent.importProjectDialog()}showScriptManager(){pxt.tickEvent("projects.showall.header",void 0,{interactiveConsent:!0}),this.props.parent.showScriptManager()}renderCore(){const{selectedCategory:e,selectedIndex:t}=this.state,n=pxt.appTarget.appTheme,{scriptManager:r}=n,o=this.getData("target-config:"),s=pxt.Util.userLanguage();let a={};o&&o.localizedGalleries&&o.localizedGalleries[s]&&pxt.Util.jsonCopyFrom(a,o.localizedGalleries[s]),o&&o.galleries&&pxt.Util.jsonCopyFrom(a,o.galleries);const c=l.cx(["ui segment bottom attached tab active tabsegment"]);return(0,i.jsxs)("div",Object.assign({ref:"homeContainer",className:c,role:"main"},{children:[(0,i.jsx)(y,{parent:this.props.parent}),(0,i.jsx)("h1",Object.assign({className:"accessible-hidden"},{children:lf("MakeCode Home")})),(0,i.jsxs)("div",Object.assign({className:"ui segment gallerysegment mystuff-segment",role:"region","aria-label":lf("My Projects")},{children:[(0,i.jsxs)("div",Object.assign({className:"ui heading"},{children:[(0,i.jsx)("div",Object.assign({className:"column",style:{zIndex:1},role:r&&"button",onClick:r&&this.showScriptManager,onKeyDown:r&&g.fireClickOnEnter},{children:r?(0,i.jsxs)("h2",Object.assign({className:"ui header myproject-header"},{children:[lf("My Projects"),(0,i.jsx)("span",Object.assign({className:"view-all-button",tabIndex:0,title:lf("View all projects"),role:"button"},{children:lf("View All")}))]})):(0,i.jsx)("h2",Object.assign({className:"ui header"},{children:lf("My Projects")}))})),(0,i.jsx)("div",Object.assign({className:"column right aligned",style:{zIndex:1}},{children:pxt.appTarget.compile||pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.cloud.importing?(0,i.jsx)(l.Button,{icon:"upload",className:"import-dialog-btn",textClass:"landscape only",text:lf("Import"),title:lf("Import a project"),onClick:this.importProject},"import"):void 0}))]})),(0,i.jsx)("div",Object.assign({className:"content"},{children:(0,i.jsx)(b,{parent:this.props.parent,name:"recent",onClick:this.chgHeader},"mystuff_carousel")}))]}),"mystuff_gallerysegment"),Object.keys(a).filter((e=>{const t=a[e];if("string"==typeof t)return!0;const n=t.experimentName;if(n&&!pxt.appTarget.appTheme[n])return!1;const r=t.locales;if(r&&r.indexOf(pxt.Util.userLanguage())<0)return!1;const i=t.testUrl||!!t.youTube&&"https://www.youtube.com/favicon.ico";return!i||!0===this.getData(`ping:${i.replace("@random@",Math.random().toString())}`)})).map((n=>{const r=a[n],o="string"==typeof r?r:r.url,s="string"==typeof r?void 0:r.shuffle;return(0,i.jsxs)("div",Object.assign({className:"ui segment gallerysegment",role:"region","aria-label":pxt.Util.rlf(n)},{children:[(0,i.jsxs)("h2",Object.assign({className:"ui header heading"},{children:[pxt.Util.rlf(n)," "]})),(0,i.jsx)("div",Object.assign({className:"content"},{children:(0,i.jsx)(b,{ref:""+(e==n?"activeCarousel":""),parent:this.props.parent,name:n,path:o,onClick:this.chgGallery,setSelected:this.setSelected,shuffle:s,selectedIndex:e==n?t:void 0},`${n}_carousel`)}))]}),`${n}_gallerysegment`)})),n.organizationUrl||n.organizationUrl||n.privacyUrl||n.copyrightText?(0,i.jsxs)("div",Object.assign({className:"ui horizontal small divided link list homefooter",role:"contentinfo"},{children:[n.organizationUrl&&n.organization?(0,i.jsx)("a",Object.assign({className:"item",target:"_blank",rel:"noopener noreferrer",href:n.organizationUrl},{children:n.organization})):void 0,n.selectLanguage?(0,i.jsx)(l.Link,{className:"item",icon:"xicon globe",text:lf("Language"),onClick:this.showLanguagePicker,onKeyDown:g.fireClickOnEnter,role:"button"}):void 0,n.termsOfUseUrl?(0,i.jsx)("a",Object.assign({target:"_blank",className:"item",href:n.termsOfUseUrl,rel:"noopener noreferrer"},{children:lf("Terms of Use")})):void 0,n.privacyUrl?(0,i.jsx)("a",Object.assign({target:"_blank",className:"item",href:n.privacyUrl,rel:"noopener noreferrer"},{children:lf("Privacy")})):void 0,pxt.appTarget.versions?(0,i.jsx)(l.Link,{className:"item",text:`v${pxt.appTarget.versions.target}`,onClick:this.showAboutDialog,onKeyDown:g.fireClickOnEnter,role:"button"}):void 0,n.copyrightText?(0,i.jsx)("div",Object.assign({className:"ui item copyright"},{children:n.copyrightText})):void 0]})):void 0]}))}}n.Projects=m;class v extends a.Component{constructor(e){super(e),this.state={},this.showLanguagePicker=this.showLanguagePicker.bind(this),this.toggleHighContrast=this.toggleHighContrast.bind(this),this.showResetDialog=this.showResetDialog.bind(this),this.showReportAbuse=this.showReportAbuse.bind(this),this.showAboutDialog=this.showAboutDialog.bind(this),this.signOutGithub=this.signOutGithub.bind(this)}showLanguagePicker(){pxt.tickEvent("home.langpicker",void 0,{interactiveConsent:!0}),this.props.parent.showLanguagePicker()}toggleHighContrast(){pxt.tickEvent("home.togglecontrast",void 0,{interactiveConsent:!0}),c.toggleHighContrast()}toggleGreenScreen(){pxt.tickEvent("home.togglegreenscreen",void 0,{interactiveConsent:!0}),this.props.parent.toggleGreenScreen()}toggleAccessibleBlocks(){pxt.tickEvent("home.toggleaccessibleblocks",void 0,{interactiveConsent:!0}),this.props.parent.toggleAccessibleBlocks()}showResetDialog(){pxt.tickEvent("home.reset",void 0,{interactiveConsent:!0}),this.props.parent.showResetDialog()}showReportAbuse(){pxt.tickEvent("home.reportabuse",void 0,{interactiveConsent:!0}),this.props.parent.showReportAbuse()}showAboutDialog(){pxt.tickEvent("home.about"),this.props.parent.showAboutDialog()}signOutGithub(){pxt.tickEvent("home.github.signout");const e=u.githubProvider();e&&(e.logout(),this.props.parent.forceUpdate(),c.infoNotification(lf("Signed out from GitHub")))}renderCore(){const e=pxt.auth.hasIdentity(),t=this.getData(d.HIGHCONTRAST),n=pxt.appTarget.appTheme,r=!e&&this.getData("github:user"),o=pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.cloud.importing,s=n.selectLanguage||n.highContrast||r;return(0,i.jsxs)(l.DropdownMenu,Object.assign({role:"menuitem",icon:"setting large",title:lf("More..."),className:"item icon more-dropdown-menuitem"},{children:[n.selectLanguage&&(0,i.jsx)(l.Item,{icon:"xicon globe",role:"menuitem",text:lf("Language"),onClick:this.showLanguagePicker}),n.highContrast&&(0,i.jsx)(l.Item,{role:"menuitem",text:t?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}),r&&(0,i.jsx)("div",{className:"ui divider"}),r&&(0,i.jsxs)("div",Object.assign({className:"ui item",title:lf("Unlink {0} from GitHub",r.name),role:"menuitem",onClick:this.signOutGithub},{children:[(0,i.jsx)("div",Object.assign({className:"avatar",role:"presentation"},{children:(0,i.jsx)("img",{className:"ui circular image",src:r.photo,alt:lf("User picture")})})),lf("Unlink GitHub")]})),s&&(0,i.jsx)("div",{className:"ui divider"}),o?(0,i.jsx)(l.Item,{role:"menuitem",icon:"warning circle",text:lf("Report Abuse..."),onClick:this.showReportAbuse}):void 0,(0,i.jsx)(l.Item,{role:"menuitem",icon:"sign out",text:lf("Reset"),onClick:this.showResetDialog}),(0,i.jsx)(l.Item,{role:"menuitem",text:lf("About..."),onClick:this.showAboutDialog}),n.feedbackUrl?(0,i.jsx)("a",Object.assign({className:"ui item",href:n.feedbackUrl,role:"menuitem",title:lf("Give Feedback"),target:"_blank",rel:"noopener noreferrer"},{children:lf("Give Feedback")})):void 0]}))}}n.ProjectSettingsMenu=v;class y extends a.Component{constructor(e){super(e),this.carouselTimeout=void 0,this.handleRefreshCard=e=>{var t;if(pxt.debug("next hero carousel"),null===(t=this.prevGalleries)||void 0===t?void 0:t.length){const t=this.state.cardIndex,n=e?this.prevGalleries.length-1:1;this.setState({cardIndex:(t+n)%this.prevGalleries.length})}this.scheduleRefresh()},this.handleSetCardIndex=e=>{this.clearRefresh(),this.setState({cardIndex:e,paused:!0})},this.onPointerDown=e=>{this.dragStartX=e.clientX},this.onTouchstart=e=>{var t;(null===(t=e.touches)||void 0===t?void 0:t.length)&&(this.dragStartX=e.touches[0].clientX)},this.onPointerUp=e=>{this.handleRelease(e.clientX,e)},this.onTouchEnd=e=>{var t,n;this.handleRelease(null===(n=null===(t=e.changedTouches)||void 0===t?void 0:t[0])||void 0===n?void 0:n.clientX,e)},this.onKeyDown=e=>{switch(c.keyCodeFromEvent(e)){case 37:this.handleRefreshCard(!0),e.stopPropagation();break;case 39:this.handleRefreshCard(),e.stopPropagation()}},this.handleCardClick=()=>{const e=void 0!==this.state.cardIndex&&this.prevGalleries[this.state.cardIndex];e&&(pxt.tickEvent("hero.card.click",{gallery:pxt.appTarget.appTheme.homeScreenHeroGallery,card:e.name,cardIndex:this.state.cardIndex}),k(this.props.parent,"herobanner",e))},this.scheduleRefresh=()=>{const{paused:e}=this.state;e||(this.clearRefresh(),this.carouselTimeout=setTimeout(this.handleRefreshCard,9e3))},this.state={cardIndex:0}}handleRelease(e,t){if(void 0!==this.dragStartX&&void 0!==e){const n=this.dragStartX-e;this.dragStartX=void 0,Math.abs(n)>30&&(t.stopPropagation(),t.preventDefault(),this.handleRefreshCard(n<0))}}clearRefresh(){this.carouselTimeout&&(clearTimeout(this.carouselTimeout),this.carouselTimeout=void 0)}componentDidMount(){this.scheduleRefresh()}componentWillUnmount(){this.clearRefresh()}fetchGallery(){const e=pxt.appTarget.appTheme,t=e.homeScreenHeroGallery;let n,r;"string"==typeof e.homeScreenHero?r=e.homeScreenHero:e.homeScreenHero&&(n=e.homeScreenHero);const i=e.homeScreenHero&&Object.assign(Object.assign({},null!=n?n:{}),{imageUrl:r||(null==n?void 0:n.imageUrl),description:(null==n?void 0:n.description)&&pxt.U.rlf(n.description),name:(null==n?void 0:n.name)&&pxt.U.rlf(n.name),buttonLabel:(null==n?void 0:n.buttonLabel)&&pxt.U.rlf(n.buttonLabel)});if(this.prevGalleries||(this.prevGalleries=[],i&&this.prevGalleries.push(i)),!t)return this.prevGalleries;let o=this.getData(`gallery:${encodeURIComponent(t)}`);return o&&(o instanceof Error||(this.prevGalleries=pxt.Util.concat(o.map((e=>e.cards))).slice(0,5),i&&this.prevGalleries.unshift(i),this.prevGalleries.forEach((e=>{const t=encodeURI(e.largeImageUrl||e.imageUrl);if(!y.fetchedImages[t]){const e=new Image;e.src=t,y.fetchedImages[t]=e}})),this.scheduleRefresh())),this.prevGalleries}renderCore(){const e=pxt.appTarget.appTheme,{cardIndex:t}=this.state,n=!!e.homeScreenHeroGallery,r=this.fetchGallery(),o=r[t];if(!o)return null;const s=e=>()=>this.handleSetCardIndex(e),a=o.url,l=o.description||o.name,c=`url(${encodeURI(o.largeImageUrl||o.imageUrl)})`,u=o.buttonLabel||_(o.cardType,o.youTubeId,o.youTubePlaylistId),d=!!a||!!o.youTubeId||!!o.youTubePlaylistId;return(0,i.jsxs)("div",Object.assign({className:"ui segment getting-started-segment hero",style:{backgroundImage:c},onKeyDown:this.onKeyDown,onPointerDown:this.onPointerDown,onTouchStart:this.onTouchstart,onPointerUp:this.onPointerUp,onTouchEnd:this.onTouchEnd},{children:[(!!l||d||n)&&(0,i.jsx)("div",{className:"gradient-overlay"}),(0,i.jsxs)("div",Object.assign({className:"hero-banner-contents"},{children:[!!l&&(0,i.jsx)("div",Object.assign({className:"description"},{children:(0,i.jsx)("p",{children:l})})),d&&(0,i.jsx)("div",Object.assign({className:"action"},{children:T({url:a,youTubeId:o.youTubeId,youTubePlaylistId:o.youTubePlaylistId,scr:o},"large blue button",u,o.cardType,this.handleCardClick)})),n&&(0,i.jsx)("div",Object.assign({className:"dots"},{children:r.map(((e,n)=>(0,i.jsx)("button",{className:`ui button empty circular label  clear ${n===t&&"active"}`,onClick:s(n),"aria-label":lf("View {0} hero image",e.title||e.name),title:lf("View {0} hero image",e.title||e.name)},"dot"+n)))}),"cards")]}))]}))}}y.fetchedImages={};class b extends a.Component{constructor(e){super(e),this.prevGalleries=[],this.hasFetchErrors=!1,this.state={},this.closeDetail=this.closeDetail.bind(this),this.closeDetailOnEscape=this.closeDetailOnEscape.bind(this),this.reload=this.reload.bind(this),this.newProject=this.newProject.bind(this),this.showScriptManager=this.showScriptManager.bind(this),this.handleCardClick=this.handleCardClick.bind(this)}componentDidMount(){this.props.parent.state.header&&this.latestProject&&this.latestProject.element&&this.latestProject.element.focus()}fetchGallery(e){let t=this.getData(`gallery:${encodeURIComponent(e)}`);if(t)if(t instanceof Error)this.hasFetchErrors=!0;else if(this.prevGalleries=pxt.Util.concat(t.map((e=>e.cards))),this.props.shuffle){const e=this.prevGalleries.pop(),t=(new Date).toDateString();this.prevGalleries.sort(((e,n)=>ts.pxtc.Util.codalHash16(e.name+t)-ts.pxtc.Util.codalHash16(n.name+t))),e&&this.prevGalleries.push(e)}return this.prevGalleries||[]}fetchLocalData(){return this.getData("headers:")||[]}newProject(){pxt.tickEvent("projects.new",void 0,{interactiveConsent:!0}),pxt.appTarget.appTheme.nameProjectFirst||pxt.appTarget.appTheme.chooseLanguageRestrictionOnNewProject?this.props.parent.askForProjectCreationOptionsAsync().then((e=>{const{name:t,languageRestriction:n}=e;this.props.parent.newProject({name:t,languageRestriction:n})})):this.props.parent.newProject({})}showScriptManager(){pxt.tickEvent("projects.showscriptmanager",void 0,{interactiveConsent:!0}),this.props.parent.showScriptManager()}closeDetail(){const{name:e}=this.props;pxt.tickEvent("projects.detail.close"),this.props.setSelected(e,void 0)}getCarouselDOM(){return s.findDOMNode(this.refs.carousel)}getDetailDOM(){return s.findDOMNode(this.refs.detailView)}closeDetailOnEscape(e){c.keyCodeFromEvent(e)==c.ESC_KEY&&(this.closeDetail(),document.removeEventListener("keydown",this.closeDetailOnEscape),e.preventDefault())}UNSAFE_componentWillReceiveProps(e){null!=e.selectedIndex&&document.addEventListener("keydown",this.closeDetailOnEscape)}reload(){this.setState({})}handleCardClick(e,t,n){const{name:r}=this.props;!this.props.setSelected||t&&t.directOpen?this.props.onClick(t):(pxt.tickEvent("projects.detail.open",{name:null==t?void 0:t.name,url:null==t?void 0:t.url,cardType:null==t?void 0:t.cardType,editor:null==t?void 0:t.editor},{interactiveConsent:!0}),this.props.setSelected(r,n))}renderCore(){const{name:e,path:t,selectedIndex:n}=this.props,r=pxt.appTarget.appTheme;if(t){this.hasFetchErrors=!1;const e=this.fetchGallery(t);if(this.hasFetchErrors)return(0,i.jsx)("div",Object.assign({className:"ui carouselouter"},{children:(0,i.jsx)("div",Object.assign({role:"button",className:"carouselcontainer",tabIndex:0,onClick:this.reload},{children:(0,i.jsx)("p",Object.assign({className:"ui grey inverted segment"},{children:lf("Oops, please connect to the Internet and try again.")}))}))}));{const r=e[n],o=e.some((e=>e.tags&&0!=e.tags.length));return(0,i.jsxs)("div",{children:[(0,i.jsx)(h.Carousel,Object.assign({ref:"carousel",tickId:t,bleedPercent:20,selectedIndex:n},{children:e.map(((e,n)=>(0,i.jsx)(x,{className:"example",name:e.name,url:e.url,imageUrl:e.imageUrl,youTubeId:e.youTubeId,youTubePlaylistId:e.youTubePlaylistId,buttonLabel:e.buttonLabel,label:e.label,labelClass:e.labelClass,tags:e.tags,scr:e,index:n,onCardClick:this.handleCardClick,cardType:e.cardType,tallCard:o,tutorialStep:e.tutorialStep,tutorialLength:e.tutorialLength},t+(e.youTubeId||e.name||e.url))))})),r&&(0,i.jsxs)("div",Object.assign({ref:"detailView",className:"detailview"},{children:[(0,i.jsx)(l.CloseButton,{onClick:this.closeDetail}),(0,i.jsx)(E,{parent:this.props.parent,name:r.name,description:r.description,url:r.url,imageUrl:r.imageUrl,largeImageUrl:r.largeImageUrl,videoUrl:r.videoUrl,youTubeId:r.youTubeId,youTubePlaylistId:r.youTubePlaylistId,buttonLabel:r.buttonLabel,actionIcon:r.actionIcon,scr:r,onClick:this.props.onClick,cardType:r.cardType,tags:r.tags,otherActions:r.otherActions},"detail"+r.name)]}))]})}}{const e=this.fetchLocalData(),t=pxt.appTarget.appTheme&&!pxt.appTarget.appTheme.hideNewProjectButton,n=r.scriptManager&&e.length>b.NUM_PROJECTS_HOMESCREEN,o=d.hasIdentity()&&!d.loggedIn()&&pxt.storage.getLocal(d.HAS_USED_CLOUD),s=e.filter((e=>{var t,n;return!(null===(n=null===(t=e.tutorial)||void 0===t?void 0:t.metadata)||void 0===n?void 0:n.hideIteration)})).slice(0,b.NUM_PROJECTS_HOMESCREEN);return(0,i.jsxs)(h.Carousel,Object.assign({tickId:"myprojects",bleedPercent:20},{children:[t&&(0,i.jsx)("div",Object.assign({role:"button",className:"ui card link buttoncard newprojectcard",title:lf("Creates a new empty project"),onClick:this.newProject,onKeyDown:g.fireClickOnEnter},{children:(0,i.jsxs)("div",Object.assign({className:"content"},{children:[(0,i.jsx)(l.Icon,{icon:"huge add circle"}),(0,i.jsx)("span",Object.assign({className:"header"},{children:lf("New Project")}))]}))})),o&&(0,i.jsx)("div",Object.assign({role:"button",className:"ui card link buttoncard cloudprojectscard",title:lf("Sign in to see cloud projects"),onClick:e=>this.props.parent.showLoginDialog(),onKeyDown:g.fireClickOnEnter},{children:(0,i.jsxs)("div",Object.assign({className:"content"},{children:[(0,i.jsx)(l.Icon,{icon:"huge xicon cloud-profile"}),(0,i.jsx)("span",Object.assign({className:"header"},{children:lf("Cloud Projects")}))]}))})),s.map(((e,t)=>{const n=e.tutorial?e.tutorial.tutorialStep:e.tutorialCompleted?e.tutorialCompleted.steps-1:void 0,r=e.tutorial?e.tutorial.tutorialStepInfo.length:e.tutorialCompleted?e.tutorialCompleted.steps:void 0,o=pxt.github.parseRepoId(e.githubId);return(0,i.jsx)(x,{cardType:"file",name:o&&pxt.github.join(o.project,o.fileName)||e.name,time:e.modificationTime,url:e.pubId&&e.pubCurrent?"/"+e.pubId:"",scr:e,index:t,onCardClick:this.handleCardClick,tutorialStep:n,tutorialLength:r,projectId:e.id},"local"+e.id+e.recentUse)})),n&&(0,i.jsx)("div",Object.assign({role:"button",className:"ui card link buttoncard scriptmanagercard",title:lf("See all projects"),onClick:this.showScriptManager,onKeyDown:g.fireClickOnEnter},{children:(0,i.jsxs)("div",Object.assign({className:"content"},{children:[(0,i.jsx)(l.Icon,{icon:"huge right angle"}),(0,i.jsx)("span",Object.assign({className:"header"},{children:lf("See all projects")}))]}))}))]}))}}}n.ProjectsCarousel=b,b.NUM_PROJECTS_HOMESCREEN=8;class x extends l.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.handleLabelClick=this.handleLabelClick.bind(this)}handleClick(e){this.props.onCardClick(e,this.props.scr,this.props.index,this.props.id)}handleLabelClick(e){this.props.onLabelClick(e,this.props.scr,this.props.index,this.props.id)}renderCore(){let e=this.props,{scr:t,onCardClick:n,onLabelClick:o,onClick:s,cardType:a,imageUrl:l,className:c}=e,u=r(e,["scr","onCardClick","onLabelClick","onClick","cardType","imageUrl","className"]);return c=c||"",t&&"file"==a&&(t.githubId?c="file github "+c:t.extensionUnderTest?c="file test "+c:t.board?(c="file board "+c,l=pxt.bundledSvg(t.board)):c=t.editor?"file "+t.editor:"file "+c),(0,i.jsx)(p.CodeCardView,Object.assign({role:"button",className:c,imageUrl:l,cardType:a},u,{onClick:this.handleClick,onLabelClicked:o?this.handleLabelClick:void 0}))}}n.ProjectsCodeCard=x;class E extends a.Component{constructor(e){super(e),this.state={},this.handleDetailClick=this.handleDetailClick.bind(this),this.handleOpenForumUrlInEditor=this.handleOpenForumUrlInEditor.bind(this),this.linkRef=o.createRef()}isLink(e){return w(this.props,e)}getUrl(){return S(this.props)}getClickLabel(e){const{youTubeId:t,youTubePlaylistId:n}=this.props;return _(e,t,n)}getActionEditor(e,t){switch(e){case"tutorial":case"example":return t&&t.editor?t.editor:"blocks";case"codeExample":return t&&t.editor?t.editor:"js";case"sharedExample":return null==t?void 0:t.editor;default:return null}}getActionIcon(e,t,n,r){const{youTubeId:o,youTubePlaylistId:s}=this.props;let a="file text";if(r)a=r;else switch(t){case"tutorial":case"example":a="xicon blocks",n&&(a=`xicon ${n}`);break;case"codeExample":a=`xicon ${n||"js"}`;break;case"sharedExample":a="pencil",n&&(a=`xicon ${n}`);break;case"forumUrl":a="comments";break;case"forumExample":a="pencil";break;case"template":default:(o||s)&&(a="youtube")}return this.isLink(t)&&"forumExample"!=t?(0,i.jsx)(l.Link,{role:"presentation",className:"link button attached",icon:a,href:this.getUrl(),target:"_blank",tabIndex:-1}):(0,i.jsx)(l.Item,{role:"presentation",className:"button attached",icon:a,onClick:e,tabIndex:-1})}getActionTitle(e){switch(e){case"py":return"Python";case"js":return"JavaScript";case"blocks":return lf("Blocks");default:return null}}getActionCard(e,t,n,r,o,s,a){const l=this.getActionEditor(t,o),c=this.getActionTitle(l);return(0,i.jsxs)("div",Object.assign({className:`card-action ui items ${l||""} ${a?"custom-icon":""}`},{children:[this.getActionIcon(n,t,l,a),c&&(0,i.jsx)("div",Object.assign({className:"card-action-title"},{children:c})),T(this.props,"button attached approve large",e,t,n,r,c,this.linkRef)]}),s)}handleDetailClick(){const{scr:e,onClick:t}=this.props;pxt.tickEvent("projects.actions.details",{name:e.name,url:e.url,cardType:e.cardType,editor:e.editor},{interactiveConsent:!0}),t(e)}handleActionClick(e){const{scr:t,onClick:n}=this.props;return pxt.tickEvent("projects.actions.click",{name:t.name,url:t.url,cardType:t.cardType,editor:t.editor},{interactiveConsent:!0}),()=>n(t,e)}handleOpenForumUrlInEditor(){pxt.tickEvent("projects.actions.forum",void 0,{interactiveConsent:!0});const{url:e}=this.props;pxt.discourse.extractSharedIdFromPostUrl(e).then((e=>{e?window.location.hash="pub:"+e:c.warningNotification(lf("Oops, we could not find the program in the forum."))})).catch(c.handleNetworkError)}isYouTubeOnline(){const{youTubeId:e,youTubePlaylistId:t}=this.props;return(e||t)&&this.getData("ping:https://www.youtube.com/favicon.ico")}componentDidMount(){this.linkRef&&this.linkRef.current&&this.linkRef.current.focus()}renderCore(){const{name:e,description:t,largeImageUrl:n,videoUrl:r,youTubeId:o,youTubePlaylistId:s,buttonLabel:a,actionIcon:c,cardType:u,tags:p,otherActions:h}=this.props,f=this.getData(d.HIGHCONTRAST),g=pxt.appTarget.appTheme.tagColors||{},m=t&&t.split("\n"),v=!f&&(n||o&&`https://img.youtube.com/vi/${o}/0.jpg`),y=!f&&!pxt.BrowserUtils.isElectron()&&!pxt.BrowserUtils.isIOS()&&r,b=!pxt.appTarget.appTheme.hideHomeDetailsVideo,x=pxt.youtube.watchUrl(o,s);let E;return E=a?ts.pxtc.Util.rlf(a):this.getClickLabel(u),(0,i.jsxs)("div",Object.assign({className:"ui grid stackable padded"},{children:[b&&(y||v)&&(0,i.jsx)("div",Object.assign({className:"imagewrapper"},{children:y?(0,i.jsx)("video",{className:"video",src:y,autoPlay:!0,controls:!1,loop:!0,playsInline:!0}):(0,i.jsx)("div",{className:"image",style:{backgroundImage:`url("${v}")`}})})),(0,i.jsx)("div",Object.assign({className:"column six wide"},{children:(0,i.jsxs)("div",Object.assign({className:"segment"},{children:[(0,i.jsxs)("div",Object.assign({className:"header"},{children:[" ",e," "]})),p&&(0,i.jsx)("div",Object.assign({className:"ui labels"},{children:p.map((e=>(0,i.jsx)("div",Object.assign({className:`ui ${g[e]||""} label`},{children:pxt.Util.rlf(e)}))))})),m&&m.map(((e,t)=>(0,i.jsx)("p",Object.assign({className:"detail"},{children:e}),`line${t}`))),!!u&&x&&this.isYouTubeOnline()&&(0,i.jsx)(l.Link,{href:x,target:"_blank",icon:"play",text:lf("Play Video Lesson"),className:"yt-button button attached approve large inverted",title:lf("Open YouTube video in new window")})]}))})),(0,i.jsx)("div",Object.assign({className:"actions column ten wide"},{children:(0,i.jsxs)("div",Object.assign({className:"segment"},{children:[this.getActionCard(E,u,this.handleDetailClick,!0,void 0,void 0,c),h&&h.map(((e,t)=>{let n=this.handleActionClick(e),r=e.cardType?this.getClickLabel(e.cardType):E;return this.getActionCard(r,e.cardType||u,n,!1,e,`action${t}`)})),"forumUrl"===u&&(!h||0==h.length)&&!pxt.BrowserUtils.isPxtElectron()&&this.getActionCard(lf("Open in Editor"),"forumExample",this.handleOpenForumUrlInEditor)]}))}))]}))}}function _(e,t,n){return"tutorial"==e?lf("Start Tutorial"):"codeExample"==e||"example"==e?lf("Open Example"):"forumUrl"==e?lf("Open in Forum"):"sharedExample"==e?lf("Open in Editor"):"template"==e?lf("New Project"):t?lf("Watch Video"):n?lf("Watch Playlist"):lf("Show Instructions")}function w(e,t){const{cardType:n,url:r,youTubeId:i,youTubePlaylistId:o}=e;return function(e){switch(e){case"file":case"example":case"codeExample":case"sharedExample":case"tutorial":case"side":case"template":case"package":case"hw":return!1;case"forumUrl":default:return!0}}(t||n)&&(i||o||r)}function S(e){const{url:t,youTubeId:n,youTubePlaylistId:r}=e;return!n&&!r||t?/^https:\/\//i.test(t)||/^\//i.test(t)?t:"":pxt.youtube.watchUrl(n,r)}function T(e,t,n,r,o,s,a,c){const u=w(e,r)&&"forumExample"!=r,d=u?lf("Open link in new window"):lf("Open in {0}",a||lf("Editor"));return u?(0,i.jsx)(l.Link,{href:S(e),refCallback:s?c:void 0,target:"_blank",text:n,className:t,title:d,ariaLabel:d,autoFocus:s}):(0,i.jsx)(l.Button,{text:n,className:t,onClick:o,onKeyDown:g.fireClickOnEnter,autoFocus:s,title:d,ariaLabel:d})}function k(e,t,n,r){let i=r&&r.editor||"blocks";"js"==i&&(i="ts");const o=r?r.url:n.url,s=(null==r?void 0:r.cardType)||n.cardType,a=i+"prj";switch(pxt.tickEvent(`${t}.gallery`,{name:n.name,cardType:s,editor:i}),s){case"template":const t=pxt.Util.clone(pxt.appTarget.blocksprj);t.config.dependencies={},l(n.name,o,!0,pxt.BLOCKS_PROJECT_NAME,t);break;case"example":l(n.name,o,!0,a);break;case"codeExample":l(n.name,o,!1,a);break;case"side":e.newEmptyProject(n.name,o);break;case"tutorial":e.startActivity({activity:"tutorial",path:o,title:n.name,editor:a});break;case"sharedExample":console.log("shared example");let r=pxt.github.normalizeRepoId(o)||pxt.Cloud.parseScriptId(o);r?window.location.hash="pub:"+r:c.errorNotification(lf("Sorry, the project url looks invalid."));break;case"link":window.open(/^https:\/\//i.test(o)||/^\//i.test(o)?o:"","_blank");break;default:const i=/^\/#tutorial:([a-z0A-Z0-9\-\/]+)$/.exec(o);if(i)e.startActivity({activity:"tutorial",path:i[1]});else{if(n.youTubeId&&!o)return;if(/^https:\/\//i.test(o))return;if(o){if(/^\//i.test(o))return;c.errorNotification(lf("Sorry, the project url looks invalid."))}else e.newEmptyProject(n.name.toLowerCase())}}function l(t,n,r,i,o){return e.startActivity({activity:"example",path:n,title:t,editor:i,importOptions:{path:n,name:t,loadBlocks:r,prj:o}})}}n.ProjectsDetail=E;class C extends a.Component{constructor(e){super(e),this.state={visible:!1},this.close=this.close.bind(this),this.importHex=this.importHex.bind(this),this.importUrl=this.importUrl.bind(this),this.cloneGithub=this.cloneGithub.bind(this)}hide(){this.setState({visible:!1})}close(){this.setState({visible:!1})}show(){this.setState({visible:!0})}importHex(){pxt.tickEvent("projects.import",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.showImportFileDialog()}importUrl(){pxt.tickEvent("projects.importurl",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.showImportUrlDialog()}async cloneGithub(){pxt.tickEvent("github.projects.clone",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.showImportGithubDialog()}renderCore(){var e,t,n;const{visible:r}=this.state,o=pxt.appTarget.appTheme,s=pxt.appTarget.appTheme.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac()),a=pxt.appTarget.appTheme.disableFileAccessinAndroid&&pxt.BrowserUtils.isAndroid(),c=pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.cloud.importing,u=this.props.parent.createModalClasses("importdialog"),d=o.githubEditor&&!pxt.BrowserUtils.isPxtElectron()&&(null===(n=null===(t=null===(e=pxt.appTarget)||void 0===e?void 0:e.cloud)||void 0===t?void 0:t.cloudProviders)||void 0===n?void 0:n.github),h=pxt.appTarget.compile&&!s&&!a;let f=h?1:0;f+=c?1:0;const g=1===(f+=d?1:0)?"one":2===f?"two":"three";return(0,i.jsx)(l.Modal,Object.assign({isOpen:r,className:u,size:"small",onClose:this.close,dimmer:!0,closeIcon:!0,header:lf("Import"),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},{children:(0,i.jsxs)("div",Object.assign({className:`ui ${g} cards`},{children:[h&&(0,i.jsx)(p.CodeCardView,{ariaLabel:lf("Open files from your computer"),role:"button",icon:"upload",iconColor:"secondary",name:lf("Import File..."),description:lf("Open files from your computer"),onClick:this.importHex},"import"),c&&(0,i.jsx)(p.CodeCardView,{ariaLabel:lf("Open a shared project URL or GitHub repo"),role:"button",icon:"cloud download",iconColor:"secondary",name:lf("Import URL..."),description:lf("Open a shared project URL or GitHub repo"),onClick:this.importUrl},"importurl"),d&&(0,i.jsx)(p.CodeCardView,{ariaLabel:lf("Clone or create your own GitHub repository"),role:"button",icon:"github",iconColor:"secondary",name:lf("Your GitHub Repo..."),description:lf("Clone or create your own GitHub repository"),onClick:this.cloneGithub},"importgithub")]}))}))}}n.ImportDialog=C;class A extends a.Component{constructor(e){super(e),this.state={visible:!1,emoji:""},this.hide=this.hide.bind(this),this.handleChange=this.handleChange.bind(this),this.save=this.save.bind(this),this.skip=this.skip.bind(this)}hide(){this.setState({visible:!1})}show(){pxt.tickEvent("exitandsave.show",void 0,{interactiveConsent:!1}),this.setState({projectName:this.props.parent.state.projectName,visible:!0})}handleChange(e){this.setState({projectName:e,emoji:I(e)})}skip(){pxt.tickEvent("exitandsave.skip",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.openHome()}save(){const{projectName:e}=this.state;this.hide();let t=Promise.resolve();e&&this.props.parent.state.projectName!=e&&(pxt.tickEvent("exitandsave.projectrename",{length:e&&e.length},{interactiveConsent:!0}),t=t.then((()=>this.props.parent.updateHeaderNameAsync(e)))),t.then((()=>{this.props.parent.openHome()}))}renderCore(){const{visible:e,projectName:t}=this.state,n=pxt.BrowserUtils.isMobile(),r=[{label:lf("Save"),onclick:this.save,icon:"check",className:"approve positive"},{label:lf("Skip"),onclick:this.skip}],o=this.props.parent.createModalClasses("exitandsave"),s=lf("Give your project a name.");return(0,i.jsx)(l.Modal,Object.assign({isOpen:e,className:o,size:"tiny",onClose:this.hide,dimmer:!0,buttons:r,closeIcon:!0,header:lf("Project has no name {0}",this.state.emoji),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},{children:(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{children:s}),(0,i.jsx)("div",Object.assign({className:"ui form"},{children:(0,i.jsx)(l.Input,{ref:"filenameinput",id:"projectNameInput",ariaLabel:s,autoComplete:!1,value:t||"",onChange:this.handleChange,onEnter:this.save,selectOnMount:!n,autoFocus:!n})}))]})}))}}n.ExitAndSaveDialog=A;class j extends a.Component{constructor(e){super(e),this.hide=()=>{this.setState({visible:!1})},this.show=()=>{pxt.tickEvent("newprojectdialog.show",void 0,{interactiveConsent:!1}),this.setState({name:"",emoji:"",visible:!0,languageRestriction:""})},this.handleTextChange=e=>{this.setState({name:e,emoji:I(e)})},this.handleLanguageChange=e=>{this.setState({languageRestriction:e})},this.save=()=>{const{name:e,languageRestriction:t}=this.state;this.hide(),this.createProjectCb&&this.createProjectCb({name:e,languageRestriction:t}),pxt.tickEvent("newprojectdialog.projectcreate",{language:t},{interactiveConsent:!0}),this.createProjectCb=null},this.onExpandedMenuHide=()=>{pxt.tickEvent("newprojectdialog.codeoptions.hide"),this.setState({languageRestriction:""})},this.onExpandedMenuShow=()=>{pxt.tickEvent("newprojectdialog.codeoptions.show")},this.state={visible:!1,emoji:"",languageRestriction:""}}promptUserAsync(){return this.show(),new Promise((e=>{this.createProjectCb=e}))}renderCore(){const{visible:e,name:t,emoji:n}=this.state,{python:r,chooseLanguageRestrictionOnNewProject:o}=pxt.appTarget.appTheme,s=[{label:lf("Create"),onclick:this.save,icon:"check",className:"approve positive"}],a=pxt.BrowserUtils.isMobile(),c=[{value:"",display:r?lf("Blocks, {0}, and {1}","JavaScript","Python"):lf("Blocks and {0}","JavaScript")},r&&{value:"python-only",display:lf("{0} Only","Python")},{value:"javascript-only",display:lf("{0} Only","JavaScript")}],u=this.props.parent.createModalClasses("newproject"),d=lf("Give your project a name.");return(0,i.jsxs)(l.Modal,Object.assign({isOpen:e,className:u,size:"tiny",onClose:this.hide,dimmer:!0,buttons:s,closeIcon:!0,header:lf("Create a Project {0}",n),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{children:d}),(0,i.jsx)("div",Object.assign({className:"ui form"},{children:(0,i.jsx)(l.Input,{ref:"filenameinput",id:"projectNameInput",ariaLabel:d,autoComplete:!1,value:t||"",onChange:this.handleTextChange,onEnter:this.save,selectOnMount:!a,autoFocus:!a})}))]}),o&&(0,i.jsxs)("div",{children:[(0,i.jsx)("br",{}),(0,i.jsx)(l.ExpandableMenu,Object.assign({title:lf("Code options"),onShow:this.onExpandedMenuShow,onHide:this.onExpandedMenuHide},{children:(0,i.jsx)(l.Select,{options:c,onChange:this.handleLanguageChange,"aria-label":lf("Select Language")})}))]})]}))}}function I(e){const t=lf("Untitled");let n="";if(e&&-1===t.indexOf(e)){const t=["","","",""];n=t[Math.min(e.length,t.length)-1];const r=e.length>>1;if(r>t.length)for(let e=0;e<Math.min(2,r-t.length);++e)n+=t[t.length-1]}return n}n.NewProjectDialog=j;class O extends a.Component{constructor(e){super(e),this.prevGalleries=[],this.state={visible:!1,skipDownload:!1},this.close=this.close.bind(this)}hide(){this.setState({visible:!1})}close(){this.setState({visible:!1})}show(e){this.setState({visible:!0,skipDownload:!!e})}fetchGallery(){let e=this.getData(`gallery:${encodeURIComponent("/hardware")}`);return e&&(e instanceof Error||(this.prevGalleries=pxt.Util.concat(e.map((e=>e.cards))).filter((e=>!!e.variant)))),this.prevGalleries||[]}setHwVariant(e,t){pxt.tickEvent("projects.choosehwvariant",{hwid:e.name,card:t?t.name:e.name},{interactiveConsent:!0}),this.hide(),pxt.setHwVariant(e.name,t?t.name:e.description||e.name);let n=this.props.parent;n.reloadHeaderAsync().then((()=>!this.state.skipDownload&&n.compile()))}renderCore(){const{visible:e}=this.state;if(!e)return(0,i.jsx)("div",{});const t=pxt.getHwVariants();for(const e of t){e.card||(e.card={name:e.description});const t=e;e.card.onClick=()=>this.setHwVariant(t,null)}let n=this.fetchGallery();for(const e of n){const n=t.find((t=>t.name==e.variant)),r=e;n?e.onClick=()=>this.setHwVariant(n,r):pxt.reportError("hw","invalid variant")}return n=n.filter((e=>!!e.onClick)),(0,i.jsxs)(l.Modal,Object.assign({isOpen:e,className:"hardwaredialog",size:"large",onClose:this.close,dimmer:!0,closeIcon:!0,header:lf("Choose your hardware"),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},{children:[(0,i.jsx)("div",Object.assign({className:"group"},{children:(0,i.jsxs)("div",Object.assign({className:"ui cards centered",role:"listbox"},{children:[n.map((e=>(0,i.jsx)(p.CodeCardView,{name:e.name,ariaLabel:e.name,description:e.description,imageUrl:e.imageUrl,learnMoreUrl:e.url,onClick:e.onClick},"card"+e.name))),t.map((e=>(0,i.jsx)(p.CodeCardView,{name:e.card.name,ariaLabel:e.card.name,description:e.card.description,imageUrl:e.card.imageUrl,learnMoreUrl:e.card.learnMoreUrl,onClick:e.card.onClick},"variant"+e.name)))]}))})),(0,i.jsxs)("p",{children:[(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),lf("No hardware? Or want to add some?")," ",(0,i.jsx)("a",Object.assign({className:"small",href:"/hardware",target:"_blank",rel:"noopener noreferrer","aria-label":lf("Learn more about hardware")},{children:lf("Learn more!")}))]})]}))}}n.ChooseHwDialog=O},{"./auth":48,"./carousel":53,"./cloudsync":55,"./codecard":57,"./core":133,"./data":136,"./dialogs":143,"./sui":200,"./util":206,react:366,"react-dom":309,"react/jsx-runtime":367}],181:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Editor=void 0;const r=e("react/jsx-runtime"),i=e("./package"),o=e("./srceditor"),s=e("./sui"),a=e("./core"),l=e("./data");var c=pxt.Util;const u=e("./util");class d extends o.Editor{constructor(e){super(e),this.parent=e,this.config={},this.changeMade=!1,this.handleNameInputRef=e=>{this.nameInput=e},this.saveOnClick=e=>{this.save()},this.editSettingsText=this.editSettingsText.bind(this),this.save=this.save.bind(this),this.setFileName=this.setFileName.bind(this),this.isUserConfigActive=this.isUserConfigActive.bind(this),this.applyUserConfig=this.applyUserConfig.bind(this),this.goBack=this.goBack.bind(this)}goBack(){pxt.tickEvent("pxtjson.backButton",void 0,{interactiveConsent:!0}),this.parent.openPreviousEditor()}prepare(){this.isReady=!0}getId(){return"pxtJsonEditor"}hasEditorToolbar(){return!1}save(e){const t=this.config;if(this.isSaving=!0,!t.name)return a.errorNotification(lf("Please choose a project name. It can't be blank.")),void(this.isSaving=!1);i.mainEditorPkg().lookupFile("this/"+pxt.CONFIG_NAME).setContentAsync(pxt.Package.stringifyConfig(t)).then((()=>{i.mainPkg.config.name=t.name,this.parent.setState({projectName:t.name}),this.parent.forceUpdate(),c.nextTick(this.changeCallback),this.isSaving=!1,this.changeMade=!0,e||this.parent.openPreviousEditor(),a.resetFocus()}))}setFileName(e){this.config.name=e,this.parent.forceUpdate()}optionaldepConfig(){let e={};return i.mainPkg.sortedDeps().filter((e=>e.config&&e.config.yotta&&e.config.yotta.optionalConfig)).forEach((t=>c.jsonMergeFrom(e,t.config.yotta.optionalConfig))),e}isUserConfigActive(e){let t=this.optionaldepConfig();this.config.yotta&&this.config.yotta.config&&c.jsonMergeFrom(t,this.config.yotta.config),t=c.jsonFlatten(t);const n=c.jsonFlatten(e.config);return!Object.keys(n).some((e=>null===n[e]?!!t[e]:t[e]!==n[e]))}applyUserConfig(e){c.jsonFlatten(this.optionaldepConfig());const t=c.jsonFlatten(this.config.yotta?this.config.yotta.config:{}),n=c.jsonFlatten(e.config);this.isUserConfigActive(e)?Object.keys(n).forEach((e=>{delete t[e]})):Object.keys(n).forEach((e=>t[e]=n[e])),Object.keys(t).length?(this.config.yotta||(this.config.yotta={}),this.config.yotta.config=c.jsonUnFlatten(t)):this.config.yotta&&(delete this.config.yotta.config,Object.keys(this.config.yotta).length||delete this.config.yotta),this.save(!0)}display(){if(!this.isVisible)return;const e=this.config;let t=[];return i.allEditorPkgs().map((e=>e.getKsPkg())).filter((e=>!!e&&e.isLoaded&&!!e.config&&!!e.config.yotta&&!!e.config.yotta.userConfigs)).forEach((e=>t=t.concat(e.config.yotta.userConfigs))),(0,r.jsxs)("div",Object.assign({className:"ui content"},{children:[(0,r.jsx)("div",Object.assign({className:"ui small header"},{children:(0,r.jsx)("div",Object.assign({className:"content"},{children:(0,r.jsxs)(s.Button,Object.assign({autoFocus:!0,title:lf("Go back"),tabIndex:0,onClick:this.goBack,onKeyDown:u.fireClickOnEnter},{children:[(0,r.jsx)(s.Icon,{icon:"arrow left"}),(0,r.jsx)("span",Object.assign({className:"ui text landscape only"},{children:lf("Go back")}))]}))}))})),(0,r.jsxs)("div",Object.assign({className:"ui segment form text"},{children:[(0,r.jsx)(s.Input,{ref:this.handleNameInputRef,id:"fileNameInput",label:lf("Name"),ariaLabel:lf("Type a name for your project"),value:e.name||"",onChange:this.setFileName,autoComplete:!1}),t.map((e=>(0,r.jsx)(p,{uc:e,isUserConfigActive:this.isUserConfigActive,applyUserConfig:this.applyUserConfig},`userconfig-${e.description}`))),(0,r.jsxs)(s.Field,{children:[(0,r.jsx)(s.Button,{text:lf("Save"),className:"green "+(this.isSaving?"disabled":""),onClick:this.saveOnClick}),(0,r.jsx)(s.Button,{text:lf("Edit Settings As text"),onClick:this.editSettingsText})]})]}))]}))}isIncomplete(){return!this.changeMade}editSettingsText(){this.changeMade=!1,this.parent.editText()}getCurrentSource(){return pxt.Package.stringifyConfig(this.config)}acceptsFile(e){if(e.name!=pxt.CONFIG_NAME)return!1;if(e.isReadonly())return!1;try{return JSON.parse(e.content),!0}catch(e){return!1}}loadFileAsync(e){return this.config=JSON.parse(e.content),this.nameInput&&this.nameInput.clearValue(),this.setDiagnostics(e,this.snapshotState()),this.changeMade=!1,Promise.resolve()}unloadFileAsync(){var e;return this.changeMade&&!(null===(e=this.parent.state)||void 0===e?void 0:e.home)?this.parent.reloadHeaderAsync():Promise.resolve()}}n.Editor=d;class p extends l.Component{constructor(e){super(e),this.state={},this.isUserConfigActive=this.isUserConfigActive.bind(this),this.applyUserConfig=this.applyUserConfig.bind(this)}isUserConfigActive(){const{applyUserConfig:e,isUserConfigActive:t,uc:n}=this.props;return t(n)}applyUserConfig(){const{applyUserConfig:e,isUserConfigActive:t,uc:n}=this.props;e(n)}renderCore(){const{uc:e}=this.props,t=this.isUserConfigActive();return(0,r.jsx)(s.Checkbox,{inputLabel:pxt.Util.rlf(e.description),checked:t,onChange:this.applyUserConfig},`userconfig-${e.description}`)}}},{"./core":133,"./data":136,"./package":179,"./srceditor":199,"./sui":200,"./util":206,"react/jsx-runtime":367}],182:[function(e,t,n){"use strict";let r;Object.defineProperty(n,"__esModule",{value:!0}),n.renderAsync=void 0,n.renderAsync=function(e){return(r||(r=pxt.BrowserUtils.loadScriptAsync("qrcode/qrcode.min.js").then((()=>"undefined"!=typeof qrcode)).catch((e=>!1))),r).then((t=>{if(!t)return;const n=qrcode(0,"L");let r=/^(https.*\/)([0-9-]+)$/.exec(e);return r?(n.addData(r[1].toUpperCase(),"Alphanumeric"),n.addData(r[2].replace(/-/g,""),"Numeric")):(r=/^(https.*\/)(_[a-zA-Z0-9]+)$/.exec(e))?(n.addData(r[1].toUpperCase(),"Alphanumeric"),n.addData(r[2],"Byte")):n.addData(e,"Byte"),n.make(),n.createDataURL(5,5)})).catch((e=>{pxt.reportException(e)}))}},{}],183:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.loadGifEncoderAsync=n.GifEncoder=n.encodeBlobAsync=n.saveAsync=void 0;const r=e("./workspace"),i=e("./data");function o(e,t){let n=0,r=0,i=0,o=0;t.height>t.width?(n=0,o=(i=t.width)/e.width*e.height,r=(t.height-o)/2):(r=0,i=(o=t.height)/e.height*e.width,n=(t.width-i)/2),e.getContext("2d").drawImage(t,n,r,i,o,0,0,e.width,e.height)}function s(){return pxt.BrowserUtils.loadImageAsync(pxt.appTarget.appTheme.logo).then((e=>{const t=document.createElement("canvas");t.width=160,t.height=120;const n=t.getContext("2d"),r=pxt.appTarget.appTheme.accentColor;return r&&(n.fillStyle=r,n.fillRect(0,0,t.width,t.height)),o(t,e),t})).catch((()=>function(){const e=document.createElement("canvas");e.width=160,e.height=120;const t=e.getContext("2d");return t.fillStyle="#33b",t.fillRect(0,0,160,120),t.font="30px monospace",t.fillStyle="#fff",t.fillText(":(",60,70),Promise.resolve(e)}()))}n.saveAsync=function(e,t){return pxt.BrowserUtils.loadImageAsync(t).then((n=>{const s=function(e){let t=null;if(e&&e.width>0&&e.height>0){const n=document.createElement("canvas");n.width=305,n.height=200,o(n,e),t=n.toDataURL("image/jpeg",85)}return t}(n);return r.saveScreenshotAsync(e,t,s).then((()=>{i.invalidateHeader("header",e)}))}))},n.encodeBlobAsync=function(e,t,n){return(t?pxt.BrowserUtils.loadCanvasAsync(t):s()).catch((()=>s())).then((t=>function(e,t){const n=e.width,r=e.height,i=document.createElement("canvas");i.width=n+16+16,i.height=r+16+16+32;const o=i.getContext("2d");o.imageSmoothingEnabled=!1,o.fillStyle="white",o.fillRect(0,0,i.width,i.height),o.drawImage(e,16,16);const s=pxt.appTarget.thumbnailName||pxt.appTarget.name;if(s){const e=12;o.fillStyle="black",o.font="10px monospace",o.fillText(s,16,e,n-16)}if(t){const e=32+r+4;o.fillStyle="black",o.font="13px monospace",o.fillText(t,16,e,n-16)}{const e=32+r+4+16;o.fillStyle="#444",o.font="10px monospace";const t=pxt.appTarget.appTheme.homeUrl.replace(/^https:\/\//,"").replace(/\/$/,"");o.fillText(t,16,e,n)}return i}(t,e))).then((e=>pxt.Util.encodeBlobAsync(e,n).toDataURL("image/png")))};class a{constructor(e){this.options=e,this.scale=1,this.cancellationToken=new pxt.Util.CancellationToken,this.options.maxFrames||(this.options.maxFrames=64),e.scale&&(this.scale=e.scale)}start(){pxt.debug("gif: start encoder"),this.gif=new GIF(this.options),this.time=-1,this.cancellationToken=new pxt.Util.CancellationToken,this.cancellationToken.startOperation(),this.renderPromise=void 0}cancel(){if(pxt.debug("gif: cancel"),!this.cancellationToken.isCancelled()){if(this.cancellationToken.cancel(),this.gif&&this.gif.running)try{this.gif.abort()}catch(e){}this.clean()}}clean(){this.gif&&this.gif.freeWorkers&&(this.gif.freeWorkers.forEach((e=>e.terminate())),this.gif.freeWorkers=[]),this.gif=void 0,this.time=-1}addFrame(e,t){if(this.cancellationToken.isCancelled()||this.renderPromise)return!1;const n=pxt.Util.now();return this.time<0&&(this.time=n),void 0===t&&(t=n-this.time),1!=this.scale&&(e=pxt.BrowserUtils.scaleImageData(e,this.scale)),pxt.debug(`gif: frame ${t}ms`),this.gif.addFrame(e,{delay:t}),this.time=n,this.gif.frames.length>this.options.maxFrames}renderAsync(){if(this.cancellationToken.isCancelled())return Promise.resolve(void 0);const e=()=>this.renderGifAsync().then((t=>{if(this.cancellationToken.throwIfCancelled(),this.options.maxLength&&t.length>this.options.maxLength){const n=Math.floor(this.gif.frames.length*this.options.maxLength/t.length)-1;return pxt.log(`gif: size too large (${t.length/1e3|0}kb) reducing frames to ${n}`),n<=0?void pxt.log("gif: simulator image too large, cannot have a single frame"):(this.gif.frames=this.gif.frames.slice(0,n),e())}return pxt.log(`gif: rendered ${this.gif.frames.length} frames to ${t.length/1e3|0}kb`),t}));return pxt.debug(`gif: render ${this.gif.frames.length} frames`),this.renderPromise||(this.renderPromise=e().finally((()=>this.clean())).catch((e=>{pxt.debug("rendering failed"),pxt.debug(e)}))),this.renderPromise}renderGifAsync(){return this.cancellationToken.throwIfCancelled(),new Promise(((e,t)=>{this.gif.on("finished",(t=>{this.gif.running=!1,e(t)})),this.gif.on("abort",(()=>{pxt.debug("gif: abort"),e(void 0)})),this.gif.render()})).then((e=>ts.pxtc.Util.blobReadAsDataURL(e)))}}n.GifEncoder=a,n.loadGifEncoderAsync=function(){if(!pxt.webConfig.gifworkerjs)return Promise.resolve(void 0);const e={workers:1,dither:!1,workerScript:pxt.webConfig.gifworkerjs,quality:pxt.appTarget.appTheme.simGifQuality||16,transparent:pxt.appTarget.appTheme.simGifTransparent,maxFrames:pxt.appTarget.appTheme.simGifMaxFrames||64,maxLength:pxt.appTarget.appTheme.simScreenshotMaxUriLength||3e5,scale:2};return pxt.BrowserUtils.loadScriptAsync("gifjs/gif.js").then((()=>new a(e)))}},{"./data":136,"./workspace":208}],184:[function(e,t,n){"use strict";var r=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.ScriptManagerDialog=n.loadZipAsync=void 0;const i=e("react/jsx-runtime"),o=e("./data"),s=e("./sui"),a=e("./core"),l=e("./workspace"),c=e("./compiler"),u=e("./components/searchInput"),d=e("./projects"),p=e("./util"),h=e("../../react-common/components/controls/Modal"),f=e("./dialogs");let g;function m(){return g||(g=pxt.BrowserUtils.loadScriptAsync("zip.js/zip.min.js").then((()=>"undefined"!=typeof zip)).catch((e=>!1))),g}n.loadZipAsync=m;class v extends o.Component{constructor(e){super(e),this.handleKeyDown=e=>{const t=a.keyCodeFromEvent(e);(pxt.BrowserUtils.isMac()?e.metaKey:e.ctrlKey)&&65===t&&this.handleSelectAll(e)},this.handleAreaClick=()=>{this.setState({selected:{}})},this.handleSelectAll=e=>{let{selected:t}=this.state;const n=this.getSortedHeaders();n.length>0&&n.length==Object.keys(t).length?t={}:n.forEach(((e,n)=>{t[this.getId(e)]=1})),this.setState({selected:t}),e.stopPropagation(),e.preventDefault()},this.toggleSortName=e=>{let{sortedBy:t,sortedAsc:n}=this.state;n=!("name"==t&&!e&&n),this.setState({sortedBy:"name",sortedAsc:n})},this.toggleSortTime=e=>{let{sortedAsc:t,sortedBy:n}=this.state;t="time"==n&&!e&&!t,this.setState({sortedBy:"time",sortedAsc:t})},this.handleSortName=e=>{e.stopPropagation(),this.toggleSortName(!0)},this.handleSortTime=e=>{e.stopPropagation(),this.toggleSortTime(!0)},this.handleToggleSortName=e=>{e.stopPropagation(),this.toggleSortName(!1)},this.handleToggleSortTime=e=>{e.stopPropagation(),this.toggleSortTime(!1)},this.handleSwitchSortDirection=e=>{e.stopPropagation();const{sortedAsc:t}=this.state;this.setState({sortedAsc:!t})},this.handleDownloadAsync=async()=>{pxt.tickEvent("scriptmanager.downloadZip",void 0,{interactiveConsent:!0}),await m();const{selected:e}=this.state,t=new zip.ZipWriter(new zip.Data64URIWriter("application/zip")),n=this.getSortedHeaders().filter((t=>e[this.getId(t)]));let r=0;const i={},o=(e,t=2)=>{let n=e+"";for(;n.length<t;)n="0"+n;return n.substring(0,t)};this.setState({download:{completed:0,max:n.length}});const s=pxt.appTarget.nickname||pxt.appTarget.id;for(const a of n){const c=await l.getTextAsync(a.id);let u="blocksprj";try{u=JSON.parse(c["pxt.json"]).preferredEditor||"blocksprj"}catch(e){}const d={meta:{cloudId:pxt.CLOUD_ID+pxt.appTarget.id,targetVersions:pxt.appTarget.versions,editor:u,name:a.name},source:JSON.stringify(c,null,2)},p=await pxt.lzmaCompressAsync(JSON.stringify(d,null,2));let h=a.name.replace(/[()\\\/.,?*^:<>!;'#$%^&|"@+={}\[\]~`\x00-\x1F]/g,"");if(h=h.trim().replace(/\s+/g,"-"),pxt.appTarget.appTheme&&pxt.appTarget.appTheme.fileNameExclusiveFilter){const e=new RegExp(pxt.appTarget.appTheme.fileNameExclusiveFilter,"g");h=h.replace(e,"")}h||(h="Untitled");const f=new Date(1e3*a.recentUse),g=`${f.getFullYear()}-${o(f.getMonth())}-${o(f.getDate())}`;let m=`${s}-${g}-${h}.mkcd`;if(i[m]){let e=2;do{m=`${s}-${g}-${h}${e}.mkcd`,e++}while(i[m])}if(i[m]=!0,await t.add(m,new zip.Uint8ArrayReader(p)),!this.state.download)return;r++,this.setState({download:{completed:r,max:n.length}})}const a=await t.close(),c=`makecode-${s}-project-download.zip`;pxt.BrowserUtils.browserDownloadDataUri(a,c),this.setState({download:null})},this.handleDownloadProgressClose=()=>{this.setState({download:null})},this.state={visible:!1,selected:{},markedNew:{},view:"grid",sortedBy:"time",sortedAsc:!1},this.close=this.close.bind(this),this.handleCardClick=this.handleCardClick.bind(this),this.handleDelete=this.handleDelete.bind(this),this.handleOpen=this.handleOpen.bind(this),this.handleOpenNewTab=this.handleOpenNewTab.bind(this),this.handleOpenNewLinkedTab=this.handleOpenNewLinkedTab.bind(this),this.handleDuplicate=this.handleDuplicate.bind(this),this.handleSwitchView=this.handleSwitchView.bind(this),this.handleSearch=this.handleSearch.bind(this),this.handleCheckboxClick=this.handleCheckboxClick.bind(this)}hide(){this.setState({visible:!1,searchFor:void 0})}close(){this.setState({visible:!1,searchFor:void 0}),this.props.onClose&&this.props.onClose()}show(){this.setState({visible:!0}),c.projectSearchClear()}fetchLocalData(){return this.getData(`headers:${this.state.searchFor||""}`)}handleCardClick(e,t,n,r,i){const o=e.shiftKey,s=i&&!o||(pxt.BrowserUtils.isMac()?e.metaKey:e.ctrlKey);let{selected:a,multiSelect:l,multiSelectStart:c}=this.state;if(!o||!s){if(s)a[r]?delete a[r]:a[r]=1,a[r]&&(c=n);else if(o){const e=this.getSortedHeaders();a={};for(let t=Math.min(n,c);t<=Math.max(n,c);t++)a[this.getId(e[t])]=1;l=!0}else l&&(a={},l=!1);o||s||(1==Object.keys(a).length&&a[r]?delete a[r]:((a={})[r]=1,c=n)),this.setState({selected:a,multiSelect:l,multiSelectStart:c}),e.stopPropagation(),e.preventDefault()}}handleCheckboxClick(e,t,n,r){this.handleCardClick(e,t,n,r,!0),e.preventDefault(),e.stopPropagation()}handleDelete(){let{selected:e}=this.state;const t=this.getSortedHeaders(),n=Object.keys(e).length;a.confirmDelete(1==n?t.find((t=>Object.keys(e)[0].includes(t.id))).name:n.toString(),(()=>{const n=[];return t.forEach(((t,r)=>{e[this.getId(t)]&&(t.isDeleted=!0,n.push(l.forceSaveAsync(t,{})))})),this.setState({selected:{}}),Promise.all(n).then((()=>{o.clearCache()}))}),n>1)}handleOpen(){pxt.tickEvent("scriptmanager.open",void 0,{interactiveConsent:!0});const e=this.getSelectedHeader();a.showLoading("changeheader",lf("loading...")),this.props.parent.loadHeaderAsync(e).then((()=>{a.hideLoading("changeheader")}))}handleOpenNewTab(){pxt.tickEvent("scriptmanager.newtab",void 0,{interactiveConsent:!0});const e=this.getSelectedHeader();this.props.parent.openNewTab(e,!1)}handleOpenNewLinkedTab(){pxt.tickEvent("scriptmanager.newlinkedtab",void 0,{interactiveConsent:!0});const e=this.getSelectedHeader();this.props.parent.openNewTab(e,!0)}handleDuplicate(){pxt.tickEvent("scriptmanager.dup",void 0,{interactiveConsent:!0});const e=this.getSelectedHeader(),t={header:lf("Choose a new name for your project"),agreeLbl:lf("Duplicate"),agreeClass:"green approve positive",agreeIcon:"clone",initialValue:l.createDuplicateName(e),placeholder:lf("Enter your project name here"),size:"tiny"};return a.promptAsync(t).then((t=>{if(null===t)return!1;let n;return l.duplicateAsync(e,t).then((e=>(n=this.getId(e),l.saveAsync(e)))).then((()=>(o.invalidate(`headers:${this.state.searchFor}`),this.setState({selected:{},markedNew:{[n]:1},sortedBy:"time",sortedAsc:!1}),setTimeout((()=>{this.setState({markedNew:{}})}),5e3),!0)))}))}handleSwitchView(){const e="grid"==this.state.view?"list":"grid";this.setState({view:e})}handleSearch(e){this.setState({searchFor:e,selected:{}})}getSelectedHeader(){const{selected:e}=this.state;if(1!==Object.keys(e).length)return null;const t=Object.keys(e)[0];return this.fetchLocalData().find((e=>t.includes(e.id)))}getSortedHeaders(){const{sortedBy:e,sortedAsc:t}=this.state;return(this.fetchLocalData()||[]).filter((e=>{var t,n;return!(null===(n=null===(t=e.tutorial)||void 0===t?void 0:t.metadata)||void 0===n?void 0:n.hideIteration)})).sort(this.getSortingFunction(e,t))}getSortingFunction(e,t){return(n,r)=>"time"===e?t?n.modificationTime-r.modificationTime:r.modificationTime-n.modificationTime:t?n.name.localeCompare(r.name):r.name.localeCompare(n.name)}getId(e){return"local"+e.id+e.recentUse}renderCore(){const{visible:e,selected:t,markedNew:n,view:r,searchFor:o,sortedBy:a,sortedAsc:l,download:c}=this.state;if(!e)return(0,i.jsx)("div",{});const g="dark"==pxt.appTarget.appTheme.baseTheme;let m=this.getSortedHeaders()||[];m=m.filter((e=>!e.isDeleted));const v=!!o||m.length>0,b=m.length>0&&m.length==Object.keys(t).length,x=pxt.appTarget.appTheme.openProjectNewTab&&!pxt.BrowserUtils.isElectron()&&!pxt.BrowserUtils.isIOS(),E=x&&pxt.appTarget.appTheme.openProjectNewDependentTab&&!/nestededitorsim=1/.test(window.location.href);let _;if(v){(_=[]).push((0,i.jsx)(u.SearchInput,{ariaMessage:lf("{0} result matching '{1}'",m.length,o),placeholder:lf("Search..."),className:"mobile hide",searchHandler:this.handleSearch,disabled:!1,style:{flexGrow:1},searchOnChange:!0},"search"));const e=Object.keys(t).length;if(e>0){if(1==e){const e=(0,i.jsx)(s.Button,{icon:"edit outline",className:"icon",text:lf("Open"),textClass:"landscape only",title:lf("Open Project"),onClick:this.handleOpen},"edit");x?_.push((0,i.jsxs)("div",Object.assign({className:"ui buttons"},{children:[e,(0,i.jsxs)(s.DropdownMenu,Object.assign({className:"floating button",icon:"dropdown"},{children:[(0,i.jsx)(s.Item,{icon:"external alternate",className:"icon",text:lf("New Tab"),title:lf("Open Project in a new tab"),onClick:this.handleOpenNewTab},"editnewtab"),E&&(0,i.jsx)(s.Item,{icon:"external alternate",className:"icon",text:lf("New Connected Tab"),title:lf("Open Project in a new tab with a connected simulator"),onClick:this.handleOpenNewLinkedTab},"editnewlinkedtab")]}))]}))):_.push(e),_.push((0,i.jsx)(s.Button,{icon:"clone outline",className:"icon",text:lf("Duplicate"),textClass:"landscape only",title:lf("Duplicate Project"),onClick:this.handleDuplicate},"clone"))}_.push((0,i.jsx)(s.Button,{icon:"trash",className:"icon red",text:lf("Delete"),textClass:"landscape only",title:lf("Delete Project"),onClick:this.handleDelete},"delete")),e>1&&_.push((0,i.jsx)(s.Button,{icon:"download",className:"icon",text:lf("Download Zip"),textClass:"landscape only",title:lf("Download Zip"),onClick:this.handleDownloadAsync},"download-zip")),_.push((0,i.jsx)("div",{className:"divider"},"divider"))}_.push((0,i.jsx)(s.Button,{icon:"grid"==r?"th list":"grid layout",className:"icon",title:`${"grid"==r?lf("List view"):lf("Grid view")}`,onClick:this.handleSwitchView},"view"))}return(0,i.jsxs)(s.Modal,Object.assign({isOpen:e,className:"scriptmanager",size:"fullscreen",onClose:this.close,dimmer:!0,header:lf("My Projects"),closeIcon:!0,headerActions:_,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},{children:[v?void 0:(0,i.jsx)("div",Object.assign({className:"empty-content"},{children:(0,i.jsx)("h2",Object.assign({className:"ui center aligned header "+(g?"inverted":"")},{children:(0,i.jsxs)("div",Object.assign({className:"content"},{children:[lf("It's empty in here"),(0,i.jsx)("div",Object.assign({className:"sub header"},{children:lf("Go back to create a new project")}))]}))}))})),v&&"grid"==r?(0,i.jsxs)("div",Object.assign({role:"button",className:"ui container fluid",style:{height:"100%"},onClick:this.handleAreaClick,onKeyDown:this.handleKeyDown},{children:[(0,i.jsx)("div",Object.assign({className:"sort-by"},{children:(0,i.jsxs)("div",Object.assign({role:"menu",className:"ui compact buttons"},{children:[(0,i.jsxs)(s.DropdownMenu,Object.assign({role:"menuitem",text:"time"==a?lf("Last Modified"):lf("Name"),title:lf("Sort by dropdown"),className:"inline button "+(g?"inverted":""),displayLeft:!0},{children:[(0,i.jsx)(s.Item,{role:"menuitem",icon:"name"==a?"check":void 0,className:`${"name"!=a?"no-icon":""} ${g?"inverted":""}`,text:lf("Name"),tabIndex:-1,onClick:this.handleSortName}),(0,i.jsx)(s.Item,{role:"menuitem",icon:"time"==a?"check":void 0,className:`${"time"!=a?"no-icon":""} ${g?"inverted":""}`,text:lf("Last Modified"),tabIndex:-1,onClick:this.handleSortTime})]})),(0,i.jsx)(s.Button,{role:"menuitem",icon:"arrow "+(l?"up":"down"),className:""+(g?"inverted":""),onClick:this.handleSwitchSortDirection,title:lf("Switch sort order to {0}",l?lf("descending"):lf("ascending"))})]}))})),(0,i.jsx)("div",Object.assign({className:"ui cards"},{children:m.sort(this.getSortingFunction(a,l)).map(((e,r)=>{const o=this.getId(e),s=!!n[o],a=!!t[o],l=s&&!a;let c=`circle outline ${a?"check":""} ${a?"green":"grey"} ${g?"inverted":""}`;l&&(c=void 0);const u=l?"orange right ribbon label":"right corner label large selected-label",p=l?lf("New"):void 0;return(0,i.jsx)(d.ProjectsCodeCard,{id:o,cardType:"file",className:"file "+(s?"warning":a?"positive":""),name:e.name,time:e.recentUse,url:e.pubId&&e.pubCurrent?"/"+e.pubId:"",scr:e,index:r,labelIcon:c,labelClass:u,label:p,onCardClick:this.handleCardClick,onLabelClick:this.handleCheckboxClick,projectId:e.id},o)}))}))]})):void 0,v&&"list"==r?(0,i.jsx)("div",Object.assign({role:"table",className:"ui container",style:{height:"100%"},onClick:this.handleAreaClick,onKeyDown:this.handleKeyDown},{children:(0,i.jsxs)("table",Object.assign({className:"ui definition unstackable table "+(g?"inverted":"")},{children:[(0,i.jsx)("thead",Object.assign({className:"full-width"},{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",Object.assign({onClick:this.handleSelectAll,tabIndex:0,onKeyDown:p.fireClickOnEnter,title:b?lf("De-select all projects"):lf("Select all projects"),style:{cursor:"pointer"}},{children:(0,i.jsx)(s.Icon,{icon:"circle outline large "+(b?"check":"")})})),(0,i.jsxs)("th",Object.assign({onClick:this.handleToggleSortName,tabIndex:0,onKeyDown:p.fireClickOnEnter,title:lf("Sort by Name {0}",l?lf("ascending"):lf("descending")),style:{cursor:"pointer"}},{children:[lf("Name")," ","name"==a?(0,i.jsx)(s.Icon,{icon:"arrow "+(l?"up":"down")}):void 0]})),(0,i.jsxs)("th",Object.assign({onClick:this.handleToggleSortTime,tabIndex:0,onKeyDown:p.fireClickOnEnter,title:lf("Sort by Last Modified {0}",l?lf("ascending"):lf("descending")),style:{cursor:"pointer"}},{children:[lf("Last Modified")," ","time"==a?(0,i.jsx)(s.Icon,{icon:"arrow "+(l?"up":"down")}):void 0]}))]})})),(0,i.jsx)("tbody",{children:m.sort(this.getSortingFunction(a,l)).map(((e,r)=>{const o=this.getId(e),s=!!n[o],a=!!t[o],l=s&&!a;return(0,i.jsxs)(y,Object.assign({id:o,selected:a,onRowClicked:this.handleCardClick,index:r,scr:e,markedNew:l},{children:[(0,i.jsx)("td",{children:e.name}),(0,i.jsx)("td",{children:pxt.Util.timeSince(e.recentUse)})]}),o)}))})]}))})):void 0,c&&(0,i.jsx)(h.Modal,Object.assign({title:lf("Preparing your zip file..."),onClose:this.handleDownloadProgressClose},{children:(0,i.jsx)(f.ProgressBar,{percentage:c.completed/c.max*100})}))]}))}}n.ScriptManagerDialog=v;class y extends s.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.handleCheckboxClick=this.handleCheckboxClick.bind(this)}handleClick(e){this.props.onRowClicked(e,this.props.scr,this.props.index,this.props.id)}handleCheckboxClick(e){this.props.onRowClicked(e,this.props.scr,this.props.index,this.props.id,!0),e.preventDefault(),e.stopPropagation()}renderCore(){const e=this.props,{scr:t,onRowClicked:n,onClick:o,selected:a,markedNew:l,children:c}=e,u=r(e,["scr","onRowClicked","onClick","selected","markedNew","children"]);return(0,i.jsxs)("tr",Object.assign({tabIndex:0},u,{onKeyDown:p.fireClickOnEnter,onClick:this.handleClick,style:{cursor:"pointer"},className:""+(l?"warning":a?"positive":"")},{children:[(0,i.jsx)("td",Object.assign({className:"collapsing",onClick:this.handleCheckboxClick},{children:(0,i.jsx)(s.Icon,{icon:"circle outline large "+(a?"check green":l?"black":"")})})),c]}))}}},{"../../react-common/components/controls/Modal":16,"./compiler":58,"./components/searchInput":118,"./core":133,"./data":136,"./dialogs":143,"./projects":180,"./sui":200,"./util":206,"./workspace":208,"react/jsx-runtime":367}],185:[function(e,t,n){"use strict";var r=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.ScriptSearch=n.ScriptSearchMode=void 0;const i=e("react/jsx-runtime"),o=e("react-dom"),s=e("./data"),a=e("./sui"),l=e("./package"),c=e("./core"),u=e("./codecard"),d=e("./electron"),p=e("./workspace"),h=e("./components/searchInput");var f,g;(g=f=n.ScriptSearchMode||(n.ScriptSearchMode={}))[g.Extensions=0]="Extensions",g[g.Boards=1]="Boards",g[g.Experiments=2]="Experiments";class m extends s.Component{constructor(e){super(e),this.state={searchFor:"",visible:!1,mode:f.Extensions,closeIcon:!0},this.hide=this.hide.bind(this),this.handleSearch=this.handleSearch.bind(this),this.addUrl=this.addUrl.bind(this),this.addBundle=this.addBundle.bind(this),this.installGh=this.installGh.bind(this),this.addLocal=this.addLocal.bind(this),this.toggleExperiment=this.toggleExperiment.bind(this),this.importExtensionFile=this.importExtensionFile.bind(this),this.backOnHide=this.backOnHide.bind(this)}hide(e,t){this.setState({visible:!1}),!0===t&&this.props.parent.openPreviousEditor(),this.state.mode==f.Experiments&&this.state.experimentsState!==pxt.editor.experiments.state()&&this.props.parent.reloadEditor()}afterHide(){const e=this.state.resolve;e&&(this.setState({resolve:void 0}),e())}showExtensions(e){this.setState({visible:!0,defaultSearch:e||"",searchFor:e||"",mode:f.Extensions,closeIcon:!0,features:void 0,resolve:void 0})}showBoardsAsync(e,t){return new Promise(((n,r)=>{this.setState({visible:!0,defaultSearch:void 0,searchFor:"",mode:f.Boards,closeIcon:!!t,features:e,resolve:n})}))}showExperiments(){this.setState({visible:!0,defaultSearch:void 0,searchFor:"",mode:f.Experiments,closeIcon:!0,experimentsState:pxt.editor.experiments.state(),features:void 0,resolve:void 0})}fetchUrlData(){const e={data:[],status:s.FetchStatus.Complete};if(!this.state.searchFor||this.state.mode!=f.Extensions)return e;const t=pxt.Cloud.parseScriptId(this.state.searchFor);if(!t)return e;const n=this.getDataWithStatus(`cloud-search:${t}`);return(!n.data||n.data&&404===n.data.statusCode)&&(n.data=[]),Array.isArray(n.data)||(n.data=[n.data]),n}fetchGhData(){var e,t;const n={data:[],status:s.FetchStatus.Complete};if(this.state.mode!=f.Extensions)return n;const r=pxt.appTarget.cloud||{};if(!r.packages)return n;let i=r.githubPackages?this.state.searchFor:void 0;if(!i){const n=this.getDataWithStatus("target-config:"),r=n.data;if(n.status===s.FetchStatus.Complete&&(null===(e=null==r?void 0:r.packages)||void 0===e?void 0:e.approvedRepoLib)){const e=null===(t=null==r?void 0:r.packages)||void 0===t?void 0:t.approvedRepoLib,n=e&&Object.keys(e).filter((t=>!!e[t].preferred));n&&(i=n.join("|"))}}if(!i)return n;const o=this.getDataWithStatus(`gh-search:${i}`);return o.data&&404!==o.data.statusCode||(o.data=[]),o}fetchLocalRepositories(){if(this.state.mode!=f.Extensions)return[];let e=this.state.searchFor;const{header:t}=this.props.parent.state;let n=p.getHeaders();return/localdependencies=1/i.test(window.location.href)||(n=n.filter((e=>!!e.githubId))),t&&(n=n.filter((e=>e.id!=t.id))),e&&(e=e.toLocaleLowerCase(),n=n.filter((t=>t.name.toLocaleLowerCase().indexOf(e)>-1))),n}fetchBundled(){if(this.state.mode!=f.Boards&&this.state.mode!=f.Extensions)return[];const e=this.state.searchFor,t=pxt.appTarget.bundledpkgs,n=this.state.mode==f.Boards,r=this.state.features;return Object.keys(t).filter((e=>!/prj$/.test(e))).map((e=>JSON.parse(t[e]["pxt.json"]))).filter((e=>!e.hidden)).filter((t=>!(!e&&t.searchOnly))).filter((t=>!e||t.name.toLowerCase().indexOf(e.toLowerCase())>-1)).filter((e=>n||!l.mainPkg.deps[e.name]||l.mainPkg.deps[e.name].cppOnly)).filter((e=>!/---/.test(e.name))).filter((e=>n==!!e.core)).filter((e=>!r||r.every((t=>e.features&&e.features.indexOf(t)>-1))))}fetchExperiments(){return this.state.mode!=f.Experiments?[]:pxt.editor.experiments.all()}shouldComponentUpdate(e,t,n){return this.state.visible!=t.visible||this.state.searchFor!=t.searchFor||this.state.mode!=t.mode}componentDidUpdate(){let e=o.findDOMNode(this.refs.searchInput);e&&e.focus()}handleSearch(e){const t=/^\/@(.*)$/.exec(e);let n=t&&t[1];if(n)if("devtools"===n&&pxt.BrowserUtils.isPxtElectron())d.openDevTools(),this.hide(),this.afterHide();else{let e=pxt.appTarget.appTheme.homeUrl;/\/$/.test(e)||(e+="/"),n=n.replace(/^\//,""),window.location.href=e+n}else this.setState({searchFor:e})}addUrl(e){return this.hide(null,this.backOnHide()),l.mainEditorPkg().setDependencyAsync(e.name,"pub:"+e.id).then((()=>this.props.parent.reloadHeaderAsync())).finally((()=>this.afterHide()))}addBundle(e){pxt.tickEvent("packages.bundled",{name:e.name}),this.hide(null,this.backOnHide()),this.addDepIfNoConflict(e,"*").finally((()=>this.afterHide()))}addLocal(e){pxt.tickEvent("packages.local"),this.hide(null,this.backOnHide()),p.getTextAsync(e.id).then((t=>{let n=JSON.parse(t[pxt.CONFIG_NAME]);return this.addDepIfNoConflict(n,"workspace:"+e.id)})).finally((()=>this.afterHide()))}async installGh(e){const t=pxt.github.parseRepoId(e.fullName);let n;pxt.tickEvent("packages.github",{name:e.fullName,slug:e.slug.toLowerCase(),tag:e.tag,fileName:t.fileName}),this.hide(null,this.backOnHide());try{c.showLoading("downloadingpackage",lf("downloading extension...")),n=await pxt.github.downloadLatestPackageAsync(e,!0)}catch(e){c.handleNetworkError(e)}finally{c.hideLoading("downloadingpackage")}return await this.addDepIfNoConflict(n.config,n.version)}async addDepIfNoConflict(e,t){try{this.hide(null,this.backOnHide()),c.showLoading("installingextension",lf("Adding extension...")),await l.mainEditorPkg().addDependencyAsync(e,t,this.state.mode==f.Boards)&&this.props.parent.reloadHeaderAsync()}finally{c.hideLoading("installingextension"),this.afterHide()}}toggleExperiment(e){pxt.editor.experiments.toggle(e),pxt.tickEvent("experiments.toggle",{experiment:e.id,enabled:pxt.editor.experiments.isEnabled(e)?1:0},{interactiveConsent:!0}),this.forceUpdate()}importExtensionFile(){pxt.tickEvent("extensions.import",void 0,{interactiveConsent:!0}),this.hide(null,this.backOnHide()),this.props.parent.showImportFileDialog({extension:!0})}backOnHide(){return this.props.parent.isPxtJsonEditor()}renderCore(){const{mode:e,closeIcon:t,visible:n,searchFor:r,experimentsState:o,defaultSearch:l}=this.state;if(!n)return(0,i.jsx)("div",{});const c=this.fetchBundled(),d=this.fetchGhData(),p=this.fetchUrlData(),g=this.fetchLocalRepositories(),m=this.fetchExperiments(),y=r&&(d.status===s.FetchStatus.Pending||p.status===s.FetchStatus.Pending),b=pxt.appTarget.appTheme.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac()),x=pxt.appTarget.appTheme.disableFileAccessinAndroid&&pxt.BrowserUtils.isAndroid(),E=e==f.Extensions&&pxt.appTarget.appTheme.importExtensionFiles&&!b&&!x&&!r,_=window.location.href.replace(/\/(#|$|\?)/,"/beta$1"),w=e==f.Experiments&&_!=window.location.href;c.sort(((e,t)=>{if(e.core!=t.core)return e.core?-1:1;const n=pxt.isPkgBeta(e);if(n!=pxt.isPkgBeta(t))return n?1:-1;const r=void 0===e.weight?50:e.weight,i=void 0===t.weight?50:t.weight;return r!=i?-r+i:pxt.Util.strcmp(e.name,t.name)}));const S=e==f.Boards?lf("Boards"):e==f.Experiments?lf("Experiments"):lf("Extensions"),T=e==f.Boards?lf("Change development board"):e==f.Experiments?lf("Turn on and off experimental features"):lf("Add an extension to the project"),k=e==f.Boards?"/boards":e==f.Experiments?"/experiments":"/extensions",C=e==f.Experiments&&o!=pxt.editor.experiments.state(),A=this.props.parent.createModalClasses("searchdialog"),j=e=>e.name.replace(/^pxt-/,""),I=lf("Search or enter project URL...");return(0,i.jsxs)(a.Modal,Object.assign({isOpen:n,dimmer:!0,className:A,size:"fullscreen",onClose:this.hide,closeIcon:t,header:S,helpUrl:k,closeOnDimmerClick:!0,closeOnEscape:!0,description:T},{children:[(0,i.jsxs)("div",Object.assign({className:"ui"},{children:[e==f.Experiments?(0,i.jsxs)("div",Object.assign({className:"ui message info"},{children:[(0,i.jsx)("div",Object.assign({className:"header"},{children:lf("WARNING: EXPERIMENTAL FEATURES AHEAD!")})),lf("Try out these features and tell us what you think!")]})):void 0,e==f.Extensions?(0,i.jsx)(h.SearchInput,{defaultValue:l,ariaMessage:lf("{0} result matching '{1}'",c.length+d.data.length+p.data.length,r),placeholder:I,"aria-label":I,searchHandler:this.handleSearch,inputClassName:"fluid",autoFocus:!0,disabled:y},"search"):void 0,y?(0,i.jsx)("div",{className:"ui medium active centered inline loader"}):(0,i.jsxs)("div",Object.assign({className:"ui cards centered","aria-label":lf("Extension search results")},{children:[p.data.map((e=>(0,i.jsx)(v,{name:e.name,description:e.description,url:"/"+e.id,scr:e,onCardClick:this.addUrl,role:"button"},"url"+e.id))),g.map((e=>(0,i.jsx)(v,{name:e.name,description:lf("Local copy of {0} hosted on github.com",e.githubId),url:"https://github.com/"+e.githubId,imageUrl:e.icon,scr:e,onCardClick:this.addLocal,label:lf("Local"),title:lf("Local GitHub extension"),labelClass:"blue right ribbon",role:"button"},"local"+e.id))),c.map((e=>(0,i.jsx)(v,{name:e.name,description:e.description,imageUrl:e.icon,scr:e,onCardClick:this.addBundle,label:pxt.isPkgBeta(e)?lf("Beta"):void 0,role:"button"},"bundled"+e.name))),d.data.filter((e=>e.status==pxt.github.GitRepoStatus.Approved)).map((e=>(0,i.jsx)(v,{name:j(e),description:e.description,scr:e,onCardClick:this.installGh,url:"github:"+e.fullName,imageUrl:pxt.github.repoIconUrl(e),label:pxt.isPkgBeta(e)?lf("Beta"):void 0,role:"button",learnMoreUrl:`/pkg/${e.fullName}`},"gha"+e.fullName))),d.data.filter((e=>e.status!=pxt.github.GitRepoStatus.Approved)).map((e=>(0,i.jsx)(v,{name:j(e),description:e.description||"",extracontent:lf("User-provided extension, not endorsed by Microsoft."),scr:e,onCardClick:this.installGh,imageUrl:pxt.github.repoIconUrl(e),label:pxt.isPkgBeta(e)?lf("Beta"):void 0,url:"github:"+e.fullName,role:"button",learnMoreUrl:`/pkg/${e.fullName}`},"ghd"+e.fullName))),m.map((e=>(0,i.jsx)(v,{name:e.name,scr:e,imageUrl:`/static/experiments/${e.id.toLowerCase()}.png`,description:e.description,role:"button",label:pxt.editor.experiments.isEnabled(e)?lf("Enabled"):lf("Disabled"),labelClass:pxt.editor.experiments.isEnabled(e)?"green right ribbon":"grey right ribbon",onCardClick:this.toggleExperiment,feedbackUrl:e.feedbackUrl},"exp"+e.id))),E&&(0,i.jsx)(u.CodeCardView,{ariaLabel:lf("Open files from your computer"),role:"button",icon:"upload ui cardimage",iconColor:"secondary",name:lf("Import File..."),description:lf("Open files from your computer"),onClick:this.importExtensionFile},"import"),w&&(0,i.jsx)(u.CodeCardView,{ariaLabel:lf("Open the next version of the editor"),role:"button",icon:"lab ui cardimage",iconColor:"secondary",name:lf("Beta Editor"),label:lf("Beta"),labelClass:"red right ribbon",description:lf("Open the next version of the editor"),url:_},"beta")]})),r&&!y&&c.length+d.data.length+p.data.length===0?(0,i.jsx)("div",Object.assign({className:"ui items"},{children:(0,i.jsx)("div",Object.assign({className:"ui item"},{children:lf("We couldn't find any extensions matching '{0}'",r)}))})):void 0]})),C?(0,i.jsxs)("div",Object.assign({className:"ui warning message"},{children:[(0,i.jsx)("div",Object.assign({className:"header"},{children:lf("Experiments changed")})),lf("The editor will reload when leaving this page.")]})):void 0]}))}}n.ScriptSearch=m;class v extends a.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}handleClick(){const{scr:e,onCardClick:t}=this.props;t(e)}renderCore(){const e=this.props,{onCardClick:t,onClick:n,scr:o}=e,s=r(e,["onCardClick","onClick","scr"]);return(0,i.jsx)(u.CodeCardView,Object.assign({},s,{onClick:this.handleClick}))}}},{"./codecard":57,"./components/searchInput":118,"./core":133,"./data":136,"./electron":146,"./package":179,"./sui":200,"./workspace":208,"react-dom":309,"react/jsx-runtime":367}],186:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ResourceImporter=n.StartPauseButton=n.Editor=void 0;const r=e("react/jsx-runtime"),i=e("smoothie"),o=e("./core"),s=e("./srceditor"),a=e("./sui"),l=e("./data"),c=e("../../react-common/components/controls/EditorToggle");var u=pxt.Util;const d=e("./util"),p=e("../../react-common/components/util");class h extends s.Editor{constructor(e){super(e),this.parent=e,this.savedMessageQueue=[],this.maxSavedMessages=1e3,this.charts=[],this.chartIdx=0,this.sourceMap={},this.serialInputDataBuffer="",this.maxSerialInputDataLength=255,this.isSim=!0,this.isCsvView=void 0,this.maxConsoleEntries=500,this.active=!0,this.rawDataBuffer="",this.maxBufferLength=1e5,this.csvHeaders=[],this.highContrast=!1,this.rawCsvBuf="",this.nextEntryIsOdd=!0,this.goToLatest=()=>{var e,t,n;const r=null===(e=this.csvRoot)||void 0===e?void 0:e.lastChild;r&&(null===(n=(t=r.lastChild.lastChild||r.firstChild.lastChild).scrollIntoView)||void 0===n||n.call(t),pxt.BrowserUtils.addClass(this.serialRoot,"hide-view-latest"))},this.handleStartPauseRef=e=>{this.startPauseButton=e},this.handleChartRootRef=e=>{this.chartRoot=e},this.handleConsoleRootRef=e=>{this.consoleRoot=e},this.handleCsvRootRef=e=>{this.csvRoot=e},this.handleSerialRootRef=e=>{this.serialRoot=e},this.toggleOptions=()=>[{label:lf("Console"),title:lf("Console"),focusable:!0,icon:"fas fa-terminal",onClick:()=>{this.setCsv(!1),this.parent.forceUpdate()},view:"console"},{label:lf("Data Log"),title:lf("Data Log"),focusable:!0,icon:"fas fa-table",onClick:()=>{this.setCsv(!0),this.parent.forceUpdate()},view:"datalog"}],this.getToggle=()=>{const e=this.toggleOptions();return(0,r.jsx)(c.EditorToggle,{id:"serial-editor-toggle",className:"slim tablet-compact",items:e,selected:e.findIndex((e=>e.view===(this.isCsvView?"datalog":"console")))})},this.shouldShowToggle=()=>this.receivedCsv&&this.receivedLog&&this.isSim,window.addEventListener("message",this.processEvent.bind(this),!1);const t=pxt.appTarget.serial&&pxt.appTarget.serial.editorTheme;this.lineColors=t&&t.lineColors||["#e00","#00e","#0e0"],this.hcLineColors=["#000"],this.currentLineColors=this.lineColors,this.goBack=this.goBack.bind(this),this.toggleRecording=this.toggleRecording.bind(this),this.downloadRaw=this.downloadRaw.bind(this),this.downloadRawText=this.downloadRawText.bind(this),this.downloadConsoleCSV=this.downloadConsoleCSV.bind(this),this.setCsv=this.setCsv.bind(this)}getId(){return"serialEditor"}hasHistory(){return!1}hasEditorToolbar(){return!1}setVisible(e){const t=o.getHighContrastOnce();t!==this.highContrast&&this.setHighContrast(t),this.isVisible=e,!this.isSim||!this.receivedCsv||void 0!==this.isCsvView&&this.receivedLog?!this.isCsvView||this.receivedCsv&&this.isSim||(this.setCsv(!1),this.parent.forceUpdate()):(this.setCsv(!this.receivedLog),this.parent.forceUpdate()),this.isCsvView?pxt.BrowserUtils.addClass(this.serialRoot,"csv-view"):pxt.BrowserUtils.removeClass(this.serialRoot,"csv-view"),this.isVisible?(this.processQueuedMessages(),this.startRecording()):(this.pauseRecording(),this.clear())}setHighContrast(e){e!==this.highContrast&&(this.highContrast=e,this.currentLineColors=e?this.hcLineColors:this.lineColors,this.clear())}acceptsFile(e){return e.name===pxt.SERIAL_EDITOR_FILE}setSim(e){this.isSim!=e&&(this.isSim=e,this.clear())}setCsv(e){this.isCsvView!=e&&(this.isCsvView=!!e,this.serialRoot&&(this.isCsvView?pxt.BrowserUtils.addClass(this.serialRoot,"csv-view"):pxt.BrowserUtils.removeClass(this.serialRoot,"csv-view")))}simStateChanged(){this.charts.forEach((e=>e.setRealtimeData(this.wantRealtimeData())))}wantRealtimeData(){return!this.isSim||this.parent.isSimulatorRunning()}saveMessageForLater(e){this.savedMessageQueue.push(e),this.savedMessageQueue.length>this.maxSavedMessages&&this.savedMessageQueue.shift()}processQueuedMessages(){this.savedMessageQueue.forEach((e=>this.processMessage(e))),this.savedMessageQueue=[]}processEvent(e){let t=e.data;"serial"===t.type?this.processEventCore(t):"bulkserial"===t.type&&t.data.forEach((e=>{this.processEventCore({type:"serial",data:e.data,receivedTime:e.time,sim:t.sim,id:t.id})}))}processEventCore(e){e.receivedTime=e.receivedTime||u.now(),e.csvType?this.receivedCsv=!0:this.receivedLog=!0,this.isVisible&&(this.isCsvView&&!this.receivedCsv?this.setCsv(!1):this.isCsvView||this.receivedLog||this.setCsv(!0)),this.active?this.processMessage(e):this.saveMessageForLater(e)}mapSource(e){if(!this.sourceMap[e]){const t=Object.keys(this.sourceMap).length+1;this.sourceMap[e]=lf("source")+t.toString()}return this.sourceMap[e]}processMessage(e){const t=!!e.sim,n=!!e.csvType;if(t!=this.isSim)return;const r=e.data||"",i=e.id||"?",o=e.receivedTime||u.now(),s=this.mapSource(i);if(this.shouldShowToggle()&&pxt.BrowserUtils.removeClass(this.serialRoot,"no-toggle"),n)this.appendRawCsvData(r),"headers"===e.csvType?this.processCsvHeaders(r,o):this.processCsvRows(r,o);else{this.appendRawData(r);const e=this.chunkDataIntoLines(r);for(const t of e)this.processMessageLine(t,s,o)}}createTable(){const e=document.createElement("table");return e.appendChild(document.createElement("thead")),e.appendChild(document.createElement("tbody")),this.csvRoot.appendChild(e),this.nextEntryIsOdd=!0,e}processCsvHeaders(e,t){const n=this.createTable(),r=document.createElement("tr");r.title=lf("Received: {0}",new Date(t).toTimeString());for(const t of e.trim().split(",")){const e=document.createElement("th");e.appendChild(document.createTextNode(t)),r.appendChild(e)}this.addCsvRow(r,n.firstChild)}processCsvRows(e,t){let n=this.csvRoot.lastChild||this.createTable();const r=document.createElement("tr");r.title=lf("Received: {0}",new Date(t).toTimeString()),this.nextEntryIsOdd&&r.classList.add("odd"),this.nextEntryIsOdd=!this.nextEntryIsOdd;for(const t of e.trim().split(",")){const e=document.createElement("td");e.appendChild(document.createTextNode(t)),r.appendChild(e)}this.addCsvRow(r,n.lastChild)}addCsvRow(e,t){const n=t.getBoundingClientRect().bottom<=window.innerHeight;t.appendChild(e),this.checkCsvLineCount(),n?e.scrollIntoView():pxt.BrowserUtils.removeClass(this.serialRoot,"hide-view-latest")}checkCsvLineCount(){for(this.csvLineCount++;this.csvLineCount>this.maxConsoleEntries;){const e=this.csvRoot.firstChild,t=e.firstChild,n=e.lastChild;n.hasChildNodes()?(n.firstChild.remove(),this.csvLineCount--):n.hasChildNodes()&&(t.firstChild.remove(),this.csvLineCount--),n.hasChildNodes()||t.hasChildNodes()||e.remove()}}processMessageLine(e,t,n){if(/^\s*\{[^}]+\}\s*$/.test(e))try{const t=JSON.parse(e),r=parseInt(t.t),i=this.mapSource(t.s),o=t.n||"",s=parseFloat(t.v);isNaN(r)||isNaN(s)||this.appendGraphEntry(i,o,s,n)}catch(e){}else if(/^\s*(-?\d+(\.\d*)?(e[\+\-]\d+)?)(\s*,\s*(-?\d+(\.\d*)?(e[\+\-]\d+)?))+\s*,?\s*$/.test(e))e.split(/\s*,\s*/).map((e=>parseFloat(e))).filter((e=>!isNaN(e))).forEach(((e,r)=>{const i="data."+(this.csvHeaders[r]||r);this.appendGraphEntry(t,i,e,n)}));else if(/^\s*[\s\w]+(\s*,\s*[\w\s]+)+\s*,?\s*$/.test(e))this.csvHeaders=e.split(/\s*,\s*/).map((e=>e.trim()));else{const r=/^\s*(([^:]+):)?\s*(-?\d+(\.\d*)?(e[\+\-]\d+)?)/i.exec(e);if(r){const e=r[2]||"",i=parseFloat(r[3]);isNaN(i)||this.appendGraphEntry(t,e,i,n)}}this.appendConsoleEntry(e)}appendRawData(e){this.rawDataBuffer+=e,this.rawDataBuffer.length>this.maxBufferLength&&this.rawDataBuffer.slice(this.rawDataBuffer.length/4)}appendRawCsvData(e){this.rawCsvBuf+=e,this.rawCsvBuf.length>this.maxBufferLength&&this.rawCsvBuf.slice(this.rawCsvBuf.length/4)}appendGraphEntry(e,t,n,r){let i=this.charts.find((n=>n.shouldContain(e,t)));i||((i=new m(e,t,this.chartIdx,this.currentLineColors)).setRealtimeData(this.wantRealtimeData()),this.chartIdx++,this.charts.push(i),this.chartRoot.appendChild(i.getElement()),pxt.BrowserUtils.removeClass(this.chartRoot,"nochart"),this.consoleRoot&&pxt.BrowserUtils.removeClass(this.consoleRoot,"nochart"),1==this.charts.length&&this.parent.forceUpdate()),i.addPoint(t,n,r)}chunkDataIntoLines(e){let t=[];for(let n=0;n<e.length;++n){const r=e[n];this.serialInputDataBuffer+=r,"\n"!==r&&this.serialInputDataBuffer.length<this.maxSerialInputDataLength||("\n"===r?(this.serialInputDataBuffer=this.serialInputDataBuffer.replace(/\s+$/,""),this.serialInputDataBuffer.length&&t.push(this.serialInputDataBuffer)):t.push(this.serialInputDataBuffer),this.serialInputDataBuffer="")}return t}appendConsoleEntry(e){if(e.length>=this.maxSerialInputDataLength){let t=document.createElement("span");t.appendChild(document.createTextNode(e)),this.consoleRoot.appendChild(t)}else{let t=document.createElement("div");t.appendChild(document.createTextNode(e)),this.consoleRoot.appendChild(t)}for(this.consoleRoot.scrollTop=this.consoleRoot.scrollHeight;this.consoleRoot.childElementCount>this.maxConsoleEntries;)this.consoleRoot.removeChild(this.consoleRoot.firstChild);this.consoleRoot&&this.consoleRoot.childElementCount>0&&(this.chartRoot&&pxt.BrowserUtils.removeClass(this.chartRoot,"noconsole"),this.consoleRoot&&pxt.BrowserUtils.removeClass(this.consoleRoot,"noconsole"))}pauseRecording(){this.active=!1,this.startPauseButton&&this.startPauseButton.setState({active:this.active}),this.charts.forEach((e=>e.stop()))}startRecording(){this.active=!0,this.startPauseButton&&this.startPauseButton.setState({active:this.active}),this.charts.forEach((e=>e.start()))}toggleRecording(){pxt.tickEvent("serial.toggleRecording",void 0,{interactiveConsent:!0}),this.active?this.pauseRecording():this.startRecording()}clearNode(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}clear(){this.chartRoot&&(this.clearNode(this.chartRoot),pxt.BrowserUtils.addClass(this.chartRoot,"noconsole"),pxt.BrowserUtils.addClass(this.chartRoot,"nochart")),this.consoleRoot&&(this.clearNode(this.consoleRoot),pxt.BrowserUtils.addClass(this.consoleRoot,"noconsole"),pxt.BrowserUtils.addClass(this.consoleRoot,"nochart")),this.isSim||this.setCsv(!1),this.charts=[],this.serialInputDataBuffer="",this.rawDataBuffer="",this.rawCsvBuf="",this.savedMessageQueue=[],this.sourceMap={},this.csvHeaders=[],this.savedMessageQueue=[],this.csvRoot&&this.clearNode(this.csvRoot),this.csvLineCount=0,pxt.BrowserUtils.addClass(this.serialRoot,"hide-view-latest"),this.isVisible||(this.receivedCsv=!1,this.receivedLog=!1,this.serialRoot&&pxt.BrowserUtils.addClass(this.serialRoot,"no-toggle"))}dataIsCsv(e,t){if(t.length<2)return!1;for(let n=0;n<t.length;++n)if(t[n].length!=e)return!1;for(let n=0;n<e;++n){let e=t[0][n][0];for(let r=1;r<t.length;++r)if(t[r][n][0]!=e)return!1}return!0}downloadConsoleCSV(){if(this.isCsvView)return void this.downloadRaw(this.rawCsvBuf,"csv","text/csv");const e=lf("{id:csvseparator}\t");let t=[];if(!this.charts.length||!this.charts.some((e=>Object.keys(e.datas).length>0)))return void o.confirmAsync({header:lf("No data to export"),hideAgree:!0,disagreeLbl:lf("Ok"),body:lf("You must generate some serial data before you can export it.")});this.charts.forEach((n=>{const r=[];Object.keys(n.datas).forEach((e=>r.push({name:e,line:n.datas[e]})));const i=r.map((e=>e.line)),o=i.length>0?i.map((e=>e.length)).reduce(((e,t)=>Math.max(e,t))):0;if(this.dataIsCsv(o,i)){let s=`time (${n.source})${e}`+r.map((e=>e.name)).join(e)+e;t[0]=t[0]?t[0]+e+s:s;for(let n=0;n<o;++n){const r=(i[0][n][0]-i[0][0][0])/1e3+e+i.map((e=>e[n][1])).join(e)+e;t[n+1]=t[n+1]?t[n+1]+e+r:r}}else{let s=r.map((t=>`time (${n.source})${e}${t.name}`)).join(e);t[0]=t[0]?t[0]+e+s:s;for(let n=0;n<o;++n){const r=i.map((t=>n<t.length?`${(t[n][0]-t[0][0])/1e3}${e}${t[n][1]}`:e)).join(e);t[n+1]=t[n+1]?t[n+1]+e+r:r}}})),t.unshift(`sep=${e}`);const n=t.join("\r\n");o.infoNotification(lf("Exporting data...."));const r=f();pxt.commands.browserDownloadAsync(u.toUTF8(n),pxt.appTarget.id+"-"+lf("{id:csvfilename}data")+"-"+r+".csv","text/csv")}downloadRaw(e,t="txt",n="text/plain"){o.infoNotification(lf("Exporting text...."));const r=f();pxt.BrowserUtils.isWindows()&&(e=e.replace(/([^\r])\n/g,"$1\r\n")),pxt.commands.browserDownloadAsync(u.toUTF8(e),pxt.appTarget.id+"-"+lf("{id:csvfilename}console")+"-"+r+`.${t}`,n)}downloadRawText(){this.downloadRaw(this.rawDataBuffer)}goBack(){pxt.tickEvent("serial.backButton",void 0,{interactiveConsent:!0}),this.parent.openPreviousEditor()}display(){var e;const t=(0,p.classList)(!this.shouldShowToggle()&&"no-toggle",this.isCsvView&&"csv-view","hide-view-latest");return(0,r.jsxs)("div",Object.assign({id:"serialArea",className:t,ref:this.handleSerialRootRef},{children:[(0,r.jsxs)("div",Object.assign({id:"serialHeader",className:"ui serialHeader"},{children:[(0,r.jsx)("div",Object.assign({className:"leftHeaderWrapper"},{children:(0,r.jsxs)("div",Object.assign({className:"leftHeader"},{children:[(0,r.jsxs)(a.Button,Object.assign({title:lf("Go back"),tabIndex:0,onClick:this.goBack,onKeyDown:d.fireClickOnEnter},{children:[(0,r.jsx)(a.Icon,{icon:"arrow left"}),(0,r.jsx)("span",Object.assign({className:"ui text landscape only"},{children:lf("Go back")}))]})),this.getToggle()]}))})),(0,r.jsxs)("div",Object.assign({className:"rightHeader"},{children:[(0,r.jsx)(a.Button,Object.assign({title:lf("Save raw text"),className:"ui icon button editorExport csv-hide",ariaLabel:lf("Save raw text"),onClick:this.downloadRawText},{children:(0,r.jsx)(a.Icon,{icon:"copy"})})),(0,r.jsx)(a.Button,Object.assign({title:lf("Export data"),className:"ui icon blue button editorExport",ariaLabel:lf("Export data"),onClick:this.downloadConsoleCSV},{children:(0,r.jsx)(a.Icon,{icon:"download"})})),(0,r.jsx)(g,{ref:this.handleStartPauseRef,active:this.active,toggle:this.toggleRecording}),(0,r.jsx)("span",Object.assign({className:"ui small header"},{children:this.isSim?lf("Simulator"):lf("Device")}))]}))]})),0==(null===(e=this.charts)||void 0===e?void 0:e.length)&&(0,r.jsx)("div",Object.assign({id:"serialPlaceholder",className:"ui segment"},{children:(0,r.jsx)("div",Object.assign({className:"ui bottom left attached no-select label seriallabel"},{children:lf("Values will be logged when the {0} sends data",this.isSim?lf("simulator"):lf("device"))}))})),(0,r.jsx)("div",{id:"serialCharts",ref:this.handleChartRootRef}),(0,r.jsx)("div",{id:"serialConsole",ref:this.handleConsoleRootRef}),(0,r.jsx)("div",{id:"serialCsv",ref:this.handleCsvRootRef}),(0,r.jsx)(a.Button,Object.assign({id:"serialCsvViewLatest",onClick:this.goToLatest},{children:lf("View latest row...")}))]}))}domUpdate(){}}function f(){return(new Date).toISOString().replace(/[^\d\w]/gi,"-")}n.Editor=h;class g extends l.PureComponent{constructor(e){super(e),this.state={active:this.props.active}}renderCore(){const{toggle:e}=this.props,{active:t}=this.state;return(0,r.jsx)(a.Button,Object.assign({title:t?lf("Pause recording"):lf("Start recording"),className:`ui left floated icon button ${t?"green":"red circular"} toggleRecord csv-hide`,onClick:e},{children:(0,r.jsx)(a.Icon,{icon:t?"pause icon":"circle icon"})}))}}n.StartPauseButton=g;class m{constructor(e,t,n,r){this.rootElement=document.createElement("div"),this.lines={},this.datas={};const o=pxt.appTarget.serial&&pxt.appTarget.serial.editorTheme,s={interpolation:"bezier",labels:{disabled:!1,fillStyle:"black",fontSize:14},responsive:!0,millisPerPixel:20,grid:{verticalSections:0,borderVisible:!1,millisPerLine:5e3,fillStyle:o&&o.gridFillStyle||"transparent",strokeStyle:o&&o.gridStrokeStyle||"#fff"},tooltip:!0,tooltipFormatter:(e,t)=>this.tooltip(e,t)};this.lineColors=r,this.chartIdx=n,this.chart=new i.SmoothieChart(s),this.rootElement.className="ui segment",this.source=e,this.variable=t.replace(/\..*$/,""),this.rootElement.appendChild(this.makeLabel()),this.rootElement.appendChild(this.makeCanvas())}tooltip(e,t){return t.map((e=>{const t=e.series.timeSeries.__name;return`<span>${t?t+": ":""}${e.value}</span>`})).join("<br/>")}getLine(e){let t=this.lines[e];if(!t){const n=this.lineColors[this.chartIdx++%this.lineColors.length];this.lines[e]=t=new i.TimeSeries,t.__name=u.htmlEscape(e.substring(this.variable.length+1)),this.chart.addTimeSeries(t,{strokeStyle:n,lineWidth:3}),this.datas[e]=[]}return t}makeLabel(){return this.label=document.createElement("div"),this.label.className="ui orange bottom left attached no-select label seriallabel",this.label.innerText=this.variable||"...",this.label}makeCanvas(){let e=document.createElement("canvas");return this.chart.streamTo(e),this.canvas=e,e}getCanvas(){return this.canvas}getElement(){return this.rootElement}shouldContain(e,t){return this.source==e&&this.variable==t.replace(/\..*$/,"")}addPoint(e,t,n){if(this.getLine(e).append(n,t),1==Object.keys(this.lines).length){const e=pxsim.Math_.roundWithPrecision(t,2).toString();this.label.innerText=this.variable?`${this.variable}: ${e}`:e}else this.label.innerText=this.variable||"";const r=this.datas[e];r.push([n,t]),r.length>4e3&&r.splice(0,r.length/4)}start(){this.chart.start()}stop(){this.chart.stop()}setRealtimeData(e){this.chart.options.nonRealtimeData=!e}}n.ResourceImporter=class{canImport(e){return"text/plain"==e.type}importAsync(e,t){return ts.pxtc.Util.fileReadAsTextAsync(t).then((e=>{if(!e)return void o.errorNotification(lf("Ooops, could not read file"));const n=e.split(/\n/g).map((e=>{const n=/^\s*(\d+)>/.exec(e);return n&&(e=e.substr(n[0].length)),{type:"serial",data:e+"\n",id:t.name,receivedTime:n?parseFloat(n[1]):void 0}}));if(!n.length)return;const r=u.now(),i=n.filter((e=>!!e.receivedTime));if(i.length){const e=i[i.length-1].receivedTime||0;i.forEach((t=>t.receivedTime+=r-e))}n.forEach((e=>window.postMessage(e,"*")))}))}}},{"../../react-common/components/controls/EditorToggle":8,"../../react-common/components/util":41,"./core":133,"./data":136,"./srceditor":199,"./sui":200,"./util":206,"react/jsx-runtime":367,smoothie:425}],187:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SerialIndicator=void 0;const r=e("react/jsx-runtime"),i=e("./data"),o=e("./util");class s extends i.Component{constructor(e){super(e),this.state={active:!1}}componentDidMount(){window.addEventListener("message",this.setActive.bind(this))}componentWillUnmount(){window.addEventListener("message",this.setActive.bind(this))}setActive(e){let t=e.data;if(!this.state.active&&("serial"===t.type||"bulkserial"===t.type)&&!!t.sim===this.props.isSim){this.setState({active:!0});const e=this.props.parent;this.props.isSim?e.setState({simSerialActive:!0}):e.setState({deviceSerialActive:!0})}}active(){return!!this.state.active}clear(){this.setState({active:!1})}renderCore(){if(!this.active())return(0,r.jsx)("div",{});const e=this.props.isSim?lf("Simulator"):lf("Device");return(0,r.jsxs)("div",Object.assign({role:"button",title:lf("Open {0} data",e),className:"ui label circular",tabIndex:0,onClick:this.props.onClick,onKeyDown:o.fireClickOnEnter},{children:[(0,r.jsx)("div",Object.assign({className:"detail"},{children:(0,r.jsx)("img",{alt:lf("Animated bar chart"),className:"barcharticon",src:pxt.Util.pathJoin(pxt.webConfig.commitCdnUrl,"images/Bars_black.gif")})})),(0,r.jsx)("span",{children:lf("Show data")}),(0,r.jsx)("div",Object.assign({className:"detail"},{children:e}))]}))}}n.SerialIndicator=s},{"./data":136,"./util":206,"react/jsx-runtime":367}],188:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ShareEditor=n.ShareMode=void 0;const r=e("react/jsx-runtime"),i=e("./auth"),o=e("./screenshot"),s=e("../../react-common/components/controls/Modal"),a=e("../../react-common/components/share/Share"),l=e("./components/SimRecorder");var c,u;(u=c=n.ShareMode||(n.ShareMode={}))[u.Code=0]="Code",u[u.Url=1]="Url",u[u.Editor=2]="Editor",u[u.Simulator=3]="Simulator";class d extends i.Component{constructor(e){super(e),this.state={pubId:void 0,visible:!1,screenshotUri:void 0,recordError:void 0,title:void 0},this.hide=this.hide.bind(this),this.setAdvancedMode=this.setAdvancedMode.bind(this),this.handleProjectNameChange=this.handleProjectNameChange.bind(this),this.restartSimulator=this.restartSimulator.bind(this),this.handleCreateGitHubRepository=this.handleCreateGitHubRepository.bind(this)}hide(){if(this.state.qrCodeExpanded){pxt.tickEvent("share.qrtoggle");const{qrCodeExpanded:e}=this.state;this.setState({qrCodeExpanded:!e})}else this.setState({visible:!1,screenshotUri:void 0,projectName:void 0,projectNameChanged:!1,recordError:void 0,qrCodeUri:void 0,title:void 0})}show(e,t="share"){const{header:n}=this.props.parent.state;if(!n)return;const r=pxt.appTarget.cloud&&pxt.appTarget.cloud.thumbnails&&(pxt.appTarget.appTheme.simScreenshot||pxt.appTarget.appTheme.simGif);r&&this.renderInitialScreenshotAsync(),this.setState({thumbnails:r,visible:!0,mode:c.Code,pubId:void 0,sharingError:void 0,screenshotUri:void 0,qrCodeUri:void 0,qrCodeExpanded:!1,title:e,projectName:n.name,kind:t},r?()=>this.props.parent.startSimulator():void 0)}setThumbnailFrames(e){this.autoThumbnailFrames=e}UNSAFE_componentWillReceiveProps(e){const t={};this.state.projectNameChanged||e.parent.state.projectName==this.state.projectName||(t.projectName=e.parent.state.projectName),e.loading!=this.state.loading&&(t.loading=e.loading),Object.keys(t).length>0&&this.setState(t)}shouldComponentUpdate(e,t,n){return this.state.visible!=t.visible||this.state.mode!=t.mode||this.state.pubId!=t.pubId||this.state.sharingError!==t.sharingError||this.state.projectName!=t.projectName||this.state.projectNameChanged!=t.projectNameChanged||this.state.loading!=t.loading||this.state.screenshotUri!=t.screenshotUri||this.state.qrCodeUri!=t.qrCodeUri||this.state.qrCodeExpanded!=t.qrCodeExpanded||this.state.title!=t.title||this.state.kind!=t.kind}setAdvancedMode(e){this.setState({mode:e})}handleProjectNameChange(e){this.setState({projectName:e,projectNameChanged:!0})}restartSimulator(){pxt.tickEvent("share.restart",void 0,{interactiveConsent:!0}),this.props.parent.restartSimulator()}handleCreateGitHubRepository(){pxt.tickEvent("share.github.create",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.createGitHubRepositoryAsync()}async renderInitialScreenshotAsync(){let e;if(this.autoThumbnailFrames){const t=await o.loadGifEncoderAsync();t.start();for(const e of this.autoThumbnailFrames)t.addFrame(e);e=await t.renderAsync()}else e=await this.props.parent.requestScreenshotAsync();e?this.setState({screenshotUri:e}):setTimeout((()=>{this.renderInitialScreenshotAsync()}),500)}renderCore(){const{parent:e}=this.props,{visible:t,projectName:n,title:o,screenshotUri:c}=this.state,{simScreenshot:u,simGif:d}=pxt.appTarget.appTheme,p=i.hasIdentity()&&this.isLoggedIn(),h=(pxt.options.light,pxt.appTarget.cloud&&pxt.appTarget.cloud.thumbnails,e.hasHeaderBeenPersistentShared());return t?(0,r.jsx)(s.Modal,Object.assign({title:lf("Share Project"),className:"sharedialog wide",parentElement:document.getElementById("root")||void 0,onClose:this.hide},{children:(0,r.jsx)(a.Share,{projectName:n,screenshotUri:c,isLoggedIn:p,publishAsync:async(t,n,r)=>e.publishAsync(t,n,r),hasProjectBeenPersistentShared:h,simRecorder:l.SimRecorderImpl,anonymousShareByDefault:e.getSharePreferenceForHeader(),setAnonymousSharePreference:t=>e.saveSharePreferenceForHeaderAsync(t),isMultiplayerGame:this.props.parent.state.isMultiplayerGame,kind:this.state.kind,onClose:this.hide})})):(0,r.jsx)(r.Fragment,{})}}n.ShareEditor=d},{"../../react-common/components/controls/Modal":16,"../../react-common/components/share/Share":37,"./auth":48,"./components/SimRecorder":85,"./screenshot":183,"react/jsx-runtime":367}],189:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SidebarTutorialCard=n.SidebarTutorialHint=void 0;const r=e("react/jsx-runtime"),i=e("./sui"),o=e("./marked"),s=e("./tutorial"),a=e("./util");class l extends s.TutorialHint{constructor(e){super(e)}renderCore(){const e=this.props.parent.state.tutorialOptions,{tutorialName:t,tutorialReady:n,tutorialStepInfo:s,tutorialStep:l,tutorialStepExpanded:c,metadata:u}=e,d=s[l],p=d.hintContentMd,h=d.showDialog,f=d.contentMd,g=this.props.parent.createModalClasses("hintdialog");let m=l<s.length-1?this.next:this.closeHint;const v=[{label:lf("Start"),onclick:m,className:"green"}];return(0,r.jsxs)("div",Object.assign({id:"callout",className:"callout-container"},{children:[(0,r.jsx)(i.Button,{className:"callout-hint ui circular label blue hintbutton",icon:"lightbulb outline",tabIndex:-1,onKeyDown:a.fireClickOnEnter}),h?(0,r.jsx)(i.Modal,Object.assign({isOpen:!0,className:g,closeIcon:!1,header:t,buttons:v,onClose:m,dimmer:!0,longer:!0,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},{children:(0,r.jsx)(o.MarkedContent,{markdown:f,parent:this.props.parent})})):(0,r.jsxs)("div",Object.assign({className:"callout-wrapper"},{children:[(0,r.jsx)("div",Object.assign({className:"callout-hint-header"},{children:"Hint:"})),(0,r.jsx)("div",Object.assign({className:"callout-hint-text"},{children:(0,r.jsx)(o.MarkedContent,{markdown:p,unboxSnippets:!0,parent:this.props.parent})}))]}))]}))}}n.SidebarTutorialHint=l;class c extends s.TutorialCard{constructor(e){super(e)}renderCore(){const e=this.props.parent.state.tutorialOptions,{tutorialName:t,tutorialStepInfo:n,tutorialStep:i}=e,s=n[i],c=!!n[i].hintContentMd||n[i].showDialog,u=s.headerContentMd,d=s.showDialog;let p="",h="";return c&&(p+=lf("Press Space or Enter to show a hint."),lf("Click to show a hint!")),(0,r.jsxs)("div",Object.assign({id:"sidebar"},{children:[(0,r.jsx)("div",Object.assign({className:"tutorialTitle"},{children:(0,r.jsx)("p",{children:t})})),(0,r.jsx)("div",Object.assign({ref:"tutorialmessage",className:"tutorialMessage",role:"alert","aria-label":p,tabIndex:c?0:-1,onKeyDown:c?a.fireClickOnEnter:void 0},{children:(0,r.jsx)("div",Object.assign({className:"content"},{children:!d&&(0,r.jsx)(o.MarkedContent,{className:"no-select",markdown:u,parent:this.props.parent,onDidRender:this.onMarkdownDidRender})}))})),c&&(0,r.jsx)(l,{parent:this.props.parent})]}))}}n.SidebarTutorialCard=c},{"./marked":167,"./sui":200,"./tutorial":203,"./util":206,"react/jsx-runtime":367}],190:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Sidepanel=void 0;const r=e("react/jsx-runtime"),i=e("./data"),o=e("./filelist"),s=e("./keymap"),a=e("./serialindicator"),l=e("./simtoolbar"),c=e("./simulator"),u=e("./sui"),d=e("./components/SimulatorPresenceBar"),p=e("./components/tutorial/TutorialContainer");class h extends i.Component{constructor(e){var t;super(e),this.tryShowSimulator=()=>{var e,t;const n=(null===(e=this.props.tutorialOptions)||void 0===e?void 0:e.tutorial)&&!pxt.BrowserUtils.useOldTutorialLayout(),r=!(null===(t=pxt.appTarget.simulator)||void 0===t?void 0:t.headless);(!n||this.props.tutorialSimSidebar)&&r&&this.showSimulator()},this.showSimulator=()=>{this.props.showMiniSim(!1),c.driver.focus()},this.handleSimSerialClick=()=>{this.props.openSerial(!0)},this.handleDeviceSerialClick=()=>{this.props.openSerial(!1)},this.handleSimOverlayClick=()=>{const{tutorialOptions:e,handleFullscreenButtonClick:t}=this.props;!e||pxt.BrowserUtils.useOldTutorialLayout()?t():this.tryShowSimulator()},this.handleSimPanelRef=e=>{this.simPanelRef=e,e&&"undefined"!=typeof ResizeObserver&&new ResizeObserver((()=>{var t,n;e.scrollHeight>e.clientHeight?null===(t=this.simPanelRef)||void 0===t||t.classList.remove("invisibleScrollbar"):null===(n=this.simPanelRef)||void 0===n||n.classList.add("invisibleScrollbar")})).observe(e)},this.setComponentHeight=e=>{e!=this.state.height&&this.setState({height:e})},this.onHostMultiplayerGameClick=e=>{e.preventDefault(),pxt.tickEvent("sidepanel.hostmultiplayergame"),this.props.parent.showShareDialog(void 0,"multiplayer")},this.onOpenInVSCodeClick=e=>{e.preventDefault(),pxt.tickEvent("sidepanel.openinvscode"),this.props.parent.showShareDialog(void 0,"vscode")},(null===(t=e.tutorialOptions)||void 0===t?void 0:t.tutorial)&&!e.tutorialSimSidebar&&this.props.showMiniSim(!0)}UNSAFE_componentWillReceiveProps(e){var t,n;!e.tutorialSimSidebar&&(!this.props.tutorialOptions&&e.tutorialOptions||this.props.inHome&&!e.inHome&&e.tutorialOptions||(null===(t=this.props.tutorialOptions)||void 0===t?void 0:t.tutorial)&&(null===(n=e.tutorialOptions)||void 0===n?void 0:n.tutorial)&&this.props.tutorialOptions.tutorial!==e.tutorialOptions.tutorial)?this.props.showMiniSim(!0):(!this.props.inHome&&e.inHome||this.props.tutorialOptions&&!e.tutorialOptions)&&this.showSimulator()}componentDidUpdate(e,t){(this.state.height||t.height)&&this.state.height!=t.height&&this.props.setEditorOffset()}renderCore(){var e,t,n;const{parent:i,inHome:c,showKeymap:h,showSerialButtons:f,showFileList:g,showFullscreenButton:m,showHostMultiplayerGameButton:v,collapseEditorTools:y,simSerialActive:b,deviceSerialActive:x,tutorialOptions:E,handleHardwareDebugClick:_,onTutorialStepChange:w,onTutorialComplete:S}=this.props,{height:T}=this.state,k=!(null===(e=pxt.appTarget.simulator)||void 0===e?void 0:e.headless),C=i.isJavaScriptActive(),A="simulator-container "+(this.props.tutorialSimSidebar?"":" hidden"),j="editor-sidebar tutorial-container-outer"+(this.props.tutorialSimSidebar?" topInstructions":""),I=T?{height:`calc(${T}px + 0.5rem)`}:void 0;return(0,r.jsxs)("div",Object.assign({id:"simulator",className:"simulator"},{children:[!k&&(0,r.jsx)("div",{id:"boardview",className:"headless-sim",role:"region","aria-label":lf("Simulator"),tabIndex:-1}),(0,r.jsx)("div",Object.assign({id:"editorSidebar",className:"editor-sidebar",style:this.props.tutorialSimSidebar?void 0:I},{children:(0,r.jsx)("div",Object.assign({className:A},{children:(0,r.jsxs)("div",Object.assign({className:"ui items simPanel "+(v?"multiplayer-preview":""),ref:this.handleSimPanelRef},{children:[(0,r.jsx)("div",{id:"boardview",className:"ui vertical editorFloat",role:"region","aria-label":lf("Simulator"),tabIndex:c?-1:0}),v&&(0,r.jsx)("div",Object.assign({className:"ui item grid centered portrait multiplayer-presence"},{children:(0,r.jsx)(d.SimulatorPresenceBar,{})})),(0,r.jsx)(l.SimulatorToolbar,{parent:i,collapsed:y,simSerialActive:b,devSerialActive:x,showSimulatorSidebar:this.tryShowSimulator}),h&&(0,r.jsx)(s.Keymap,{parent:i}),(0,r.jsx)("div",Object.assign({className:"ui item portrait hide hidefullscreen"},{children:pxt.options.debug&&(0,r.jsx)(u.Button,{className:"teal",icon:"xicon chip",text:"Dev Debug",onClick:_},"hwdebugbtn")})),(0,r.jsx)("div",Object.assign({className:"ui item grid centered portrait hide hidefullscreen"},{children:C&&(0,r.jsx)(u.Button,{className:"teal hostmultiplayergame-button",icon:"icon share",text:lf("Open in VS Code"),ariaLabel:lf("Open in Visual Studio Code for Web"),onClick:this.onOpenInVSCodeClick})})),(0,r.jsx)("div",Object.assign({className:"ui item grid centered portrait hide hidefullscreen"},{children:v&&(0,r.jsx)(u.Button,{className:"teal hostmultiplayergame-button",icon:"xicon multiplayer",text:lf("Host multiplayer game"),ariaLabel:lf("Host multiplayer game"),onClick:this.onHostMultiplayerGameClick})})),f&&(0,r.jsxs)("div",Object.assign({id:"serialPreview",className:"ui editorFloat portrait hide hidefullscreen"},{children:[(0,r.jsx)(a.SerialIndicator,{ref:"simIndicator",isSim:!0,onClick:this.handleSimSerialClick,parent:i}),(0,r.jsx)(a.SerialIndicator,{ref:"devIndicator",isSim:!1,onClick:this.handleDeviceSerialClick,parent:i})]})),g&&(0,r.jsx)(o.FileList,{parent:i}),m&&(0,r.jsx)("div",{id:"miniSimOverlay",role:"button",title:lf("Open in fullscreen"),onClick:this.handleSimOverlayClick})]}))}))})),E&&(0,r.jsx)("div",Object.assign({className:this.props.tutorialSimSidebar?"topInstructionsWrapper":""},{children:(0,r.jsx)("div",Object.assign({id:"tutorialWrapper",className:j,style:I},{children:(0,r.jsx)(p.TutorialContainer,{parent:i,tutorialId:E.tutorial,name:E.tutorialName,steps:E.tutorialStepInfo,currentStep:E.tutorialStep,tutorialOptions:E,hideIteration:null===(t=E.metadata)||void 0===t?void 0:t.hideIteration,hasTemplate:!!E.templateCode,preferredEditor:null===(n=E.metadata)||void 0===n?void 0:n.preferredEditor,tutorialSimSidebar:this.props.tutorialSimSidebar,onTutorialStepChange:w,onTutorialComplete:S,setParentHeight:this.setComponentHeight})}))}))]}))}}n.Sidepanel=h},{"./components/SimulatorPresenceBar":86,"./components/tutorial/TutorialContainer":126,"./data":136,"./filelist":151,"./keymap":164,"./serialindicator":187,"./simtoolbar":191,"./simulator":192,"./sui":200,"react/jsx-runtime":367}],191:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PlayButton=n.SimulatorToolbar=void 0;const r=e("react/jsx-runtime"),i=e("./data"),o=e("./sui");class s extends i.Component{constructor(e){super(e),this.state={},pxt.BrowserUtils.isIOS()&&this.props.parent.setMute(!0),this.toggleMute=this.toggleMute.bind(this),this.restartSimulator=this.restartSimulator.bind(this),this.openInstructions=this.openInstructions.bind(this),this.startStopSimulator=this.startStopSimulator.bind(this),this.toggleSimulatorFullscreen=this.toggleSimulatorFullscreen.bind(this),this.toggleSimulatorCollapse=this.toggleSimulatorCollapse.bind(this),this.openDeviceSimulator=this.openDeviceSimulator.bind(this),this.openDeviceSerial=this.openDeviceSerial.bind(this),this.takeScreenshot=this.takeScreenshot.bind(this),this.toggleDebug=this.toggleDebug.bind(this)}openInstructions(){pxt.tickEvent("simulator.make",void 0,{interactiveConsent:!0}),this.props.parent.openInstructions()}startStopSimulator(){pxt.tickEvent("simulator.startstop",void 0,{interactiveConsent:!0}),this.props.parent.startStopSimulator({clickTrigger:!0})}restartSimulator(){pxt.tickEvent("simulator.restart",void 0,{interactiveConsent:!0}),this.props.parent.restartSimulator()}toggleDebug(){pxt.tickEvent("simulator.debug",void 0,{interactiveConsent:!0}),this.props.parent.toggleDebugging()}toggleMute(){pxt.tickEvent("simulator.mute",{view:"computer",muteTo:""+!this.props.parent.state.mute},{interactiveConsent:!0}),this.props.parent.toggleMute()}toggleSimulatorFullscreen(){pxt.tickEvent("simulator.fullscreen",{view:"computer",fullScreenTo:""+!this.props.parent.state.fullscreen},{interactiveConsent:!0}),this.props.parent.toggleSimulatorFullscreen()}toggleSimulatorCollapse(){pxt.tickEvent("simulator.toggleCollapse",{view:"computer",collapsedTo:""+!this.props.parent.state.collapseEditorTools},{interactiveConsent:!0}),this.props.parent.toggleSimulatorCollapse()}openDeviceSerial(){pxt.tickEvent("simulator.fullscreen.serial.simulator",{},{interactiveConsent:!0}),this.props.parent.toggleSimulatorFullscreen(),this.props.parent.openDeviceSerial()}openDeviceSimulator(){pxt.tickEvent("simulator.fullscreen.serial.device",{},{interactiveConsent:!0}),this.props.parent.toggleSimulatorFullscreen(),this.props.parent.openSimSerial()}takeScreenshot(){pxt.tickEvent("simulator.takescreenshot",{view:"computer",collapsedTo:""+!this.props.parent.state.collapseEditorTools},{interactiveConsent:!0}),this.props.parent.downloadScreenshotAsync()}renderCore(){const{collapsed:e,devSerialActive:t,parent:n,simSerialActive:i,showSimulatorSidebar:s}=this.props,l=n.state;if(!l.currFile||l.home)return(0,r.jsx)("div",{});const c=pxt.appTarget.appTheme,u=pxt.appTarget.simulator,d=pxt.shell.isSandboxMode(),p=!d&&l.showParts&&c.instructions,h=l.simState,f=h==pxt.editor.SimState.Running,g=h==pxt.editor.SimState.Starting,m=h==pxt.editor.SimState.Pending,v=l.fullscreen,y=l.mute,b=!!l.tutorialOptions&&!!l.tutorialOptions.tutorial,x=b&&!pxt.BrowserUtils.useOldTutorialLayout(),E=n.isBlocksActive()||n.isJavaScriptActive()||n.isPythonActive(),_=!u.hideRestart,w=c.debugger&&!b&&!pxt.BrowserUtils.isIE(),S=l.debugging,T=!u.hideFullscreen&&!d,k=c.hasAudio,C=u.headless,A=!!c.simScreenshot,j=l.screenshoting?"loading":"",I=!g&&!m&&E,O=!S&&!g&&!m,N=!c.bigRunButton,R=lf("Open assembly instructions"),P=lf("Restart the simulator"),D=lf("Toggle debug mode"),M=lf("View simulator keyboard shortcuts"),L=v?lf("Exit fullscreen mode"):lf("Launch in fullscreen"),B=y?lf("Unmute audio"):lf("Mute audio"),F=c.simScreenshotKey?lf("Take Screenshot (shortcut {0})",c.simScreenshotKey):lf("Take Screenshot"),U=e?lf("Show the simulator"):lf("Hide the simulator"),H=lf("Open simulator console"),G=lf("Open device console"),q=v&&(i||t);return(0,r.jsxs)("aside",Object.assign({className:"ui item grid centered simtoolbar"+(d?"":" portrait "),role:"complementary","aria-label":lf("Simulator toolbar")},{children:[(0,r.jsxs)("div",Object.assign({className:"ui icon tiny buttons",style:{padding:"0"}},{children:[p&&(0,r.jsx)(o.Button,{disabled:S,icon:"configure",className:"secondary",title:R,onClick:this.openInstructions}),!c.bigRunButton&&(0,r.jsx)(a,{parent:n,simState:l.simState,debugging:l.debugging}),T&&(0,r.jsx)(o.Button,{className:"fullscreen-button tablet only hidefullscreen",icon:"xicon fullscreen",title:L,onClick:this.toggleSimulatorFullscreen},"fullscreenbtn"),_&&(0,r.jsx)(o.Button,{disabled:!O,className:"restart-button",icon:"refresh",title:P,onClick:this.restartSimulator},"restartbtn"),w&&(0,r.jsx)(o.Button,{disabled:!I,className:"debug-button "+(S?"orange":""),icon:"icon bug",title:D,onClick:this.toggleDebug},"debugbtn"),k&&x&&(0,r.jsx)(o.Button,{className:"hidefullscreen tutorial mute-button",icon:""+(y?"volume off":"volume up"),title:B,onClick:this.toggleMute},"mutebtn"),N&&(0,r.jsx)(o.Button,{className:"expand-button portrait only editortools-btn hidefullscreen",icon:""+(e?"play":"stop"),title:U,onClick:this.toggleSimulatorCollapse})]})),!C&&(0,r.jsxs)("div",Object.assign({className:"ui icon tiny buttons computer only",style:{padding:"0"}},{children:[k&&(0,r.jsx)(o.Button,{className:"mute-button "+(y?"red":""),icon:""+(y?"volume off":"volume up"),title:B,onClick:this.toggleMute},"mutebtn"),u.keymap&&(0,r.jsx)(o.Button,{className:"keymap-button",icon:"keyboard",title:M,onClick:n.toggleKeymap},"keymap")]})),q&&(0,r.jsxs)("div",Object.assign({className:"ui item tiny buttons full-screen-console"},{children:[i&&(0,r.jsx)(o.Button,{icon:"list",className:"purple",title:H,onClick:this.openDeviceSimulator}),t&&(0,r.jsx)(o.Button,{icon:"usb",className:"purple",title:G,onClick:this.openDeviceSerial})]})),!C&&(0,r.jsxs)("div",Object.assign({className:"ui icon tiny buttons computer only",style:{padding:"0"}},{children:[A&&(0,r.jsx)(o.Button,{disabled:!f,className:`screenshot-button ${j}`,icon:"icon camera left",title:F,onClick:this.takeScreenshot},"screenshotbtn"),T&&(0,r.jsx)(o.Button,{className:"fullscreen-button",icon:"xicon "+(v?"fullscreencollapse":"fullscreen"),title:L,onClick:this.toggleSimulatorFullscreen},"fullscreenbtn")]}))]}))}}n.SimulatorToolbar=s;class a extends o.StatelessUIElement{constructor(e){super(e),this.startStopSimulator=()=>{pxt.tickEvent("simulator.startstop",void 0,{interactiveConsent:!0}),this.props.parent.startStopSimulator({clickTrigger:!0})}}renderCore(){const e=this.props.simState,t=e==pxt.editor.SimState.Running,n=e==pxt.editor.SimState.Starting,i=e==pxt.editor.SimState.Pending,s=!this.props.debugging&&!n&&!i,a=(()=>{switch(e){case pxt.editor.SimState.Stopped:return lf("Start the simulator");case pxt.editor.SimState.Pending:case pxt.editor.SimState.Starting:return lf("Starting the simulator");case pxt.editor.SimState.Running:return lf("Stop the simulator")}})();return(0,r.jsx)(o.Button,{disabled:!s,className:`play-button ${this.props.className||""} ${t?"stop":"play"}`,icon:t?"stop":"play green",title:a,onClick:this.startStopSimulator},"runbtn")}}n.PlayButton=a},{"./data":136,"./sui":200,"react/jsx-runtime":367}],192:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.dbgStepOut=n.dbgStepInto=n.dbgStepOver=n.dbgPauseResume=n.proxy=n.setTraceInterval=n.unhide=n.hide=n.suspend=n.stop=n.mute=n.run=n.setPending=n.setDirty=n.setState=n.init=n.setTranslations=n.simTranslations=n.driver=n.SLOW_TRACE_INTERVAL=n.FAST_TRACE_INTERVAL=void 0;const r=e("./core"),i=e("./coretsx");var o=pxt.U;let s,a;n.FAST_TRACE_INTERVAL=100,n.SLOW_TRACE_INTERVAL=500;let l={};function c(e,t){pxt.editor.shouldPostHostMessages()&&pxt.editor.postHostMessageAsync({type:"pxthost",action:"simevent",subtype:e,exception:t})}n.setTranslations=function(e){n.simTranslations!==e&&(n.simTranslations=e,d())},n.init=function(e,t){var u,d,h,f;if(!e)return;pxsim.U.clear(e);const g=document.createElement("div");g.id="simulators",g.className="simulator",e.appendChild(g);const m=document.createElement("div");m.id="debugger",m.className="ui item landscape only",e.appendChild(m);const v=/nestededitorsim=1/i.test(window.location.href),y=null===(d=null===(u=/[\&\?]mp=(server|client)/i.exec(window.location.href))||void 0===u?void 0:u[1])||void 0===d?void 0:d.toLowerCase();let b=null;if(window.parent!==window){const e=new URLSearchParams(window.location.search).get("parentOrigin");if(e)try{b=new URL(e).origin}catch(t){console.error(`Invalid parent origin: ${e}`)}}let x={restart:()=>t.restartSimulator(),revealElement:e=>{if(pxt.options.light||n.driver.isLoanedSimulator(e))return;const t=pxt.appTarget.appTheme.simAnimationEnter||"fly right in";e.style.animationDuration="500ms";const r=`${t} visible transition animating`;pxsim.U.addClass(e,r),pxt.Util.delay(500).then((()=>{pxsim.U.removeClass(e,r),e.style.animationDuration="",pxt.BrowserUtils.isEdge()&&i.dialogIsShowing()&&(document.body.style.display="none",requestAnimationFrame((()=>{document.body.style.display="block"})))}))},removeElement:(e,t)=>{if(pxt.appTarget.simulator.headless)pxsim.U.addClass(e,"simHeadless"),t&&t();else{if(pxt.options.light)return t&&t(),void pxsim.U.remove(e);const n=pxt.appTarget.appTheme.simAnimationExit||"fly right out";e.style.animationDuration="500ms";const r=`${n} visible transition animating`;pxsim.U.addClass(e,r),pxt.Util.delay(500).then((()=>{pxsim.U.removeClass(e,"animating"),e.style.animationDuration="",t&&t(),pxsim.U.remove(e)}))}},unhideElement:e=>{pxsim.U.removeClass(e,"simHeadless")},onDebuggerBreakpoint:function(e){let t=!1;if(s){let n=0,r=e.breakpointId;for(;!t;){if(r){const n=a.breakpoints[r];t=s.highlightStatement(n,e)}if(!t){n++;const t=e.stackframes?e.stackframes[n]:void 0;if(!t)break;r=t.breakpointId}}}e.exceptionMessage||!s||t?(!t&&e.exceptionMessage&&(pxt.debug(`runtime error: ${e.exceptionMessage}`),pxt.debug(e.exceptionStack),s&&s.orphanException(e)),c("stopped",e.exceptionMessage)):n.driver.resume(pxsim.SimulatorDebuggerCommand.StepInto)},onTraceMessage:function(e){let t=a.breakpoints[e.breakpointId];s&&s.highlightStatement(t,e)},onDebuggerWarning:function(e){for(let t of e.breakpointIds){let e=a.breakpoints[t];if(e&&!o.startsWith("pxt_modules/",e.fileName)){s&&s.highlightStatement(e);break}}},onDebuggerResume:function(){c("resumed"),s&&s.highlightStatement(null)},onStateChanged:function(e){e===pxsim.SimulatorState.Stopped?c("stopped"):e===pxsim.SimulatorState.Running&&this.onDebuggerResume(),t.onStateChanged(e)},onSimulatorReady:function(){pxt.perf.recordMilestone("simulator ready"),pxt.perf.perfReportLogged||pxt.perf.report()},onSimulatorCommand:e=>{switch(e.command){case"setstate":t.setState(e.stateKey,e.stateValue);break;case"restart":t.restartSimulator();break;case"reload":p(!0),t.restartSimulator();break;case"modal":if(p(),!(pxt.shell.isSandboxMode()||e.displayOnceId&&l[e.displayOnceId])){const t={header:e.header,body:e.body,size:"large",copyable:e.copyable,disagreeLbl:lf("Close"),modalContext:e.modalContext},n=pxt.appTarget.simulator.trustedUrls,i=e.linkButtonHref&&n&&-1!==n.indexOf(e.linkButtonHref);i?t.agreeLbl=e.linkButtonLabel:t.hideAgree=!0,l[e.displayOnceId]=!0,r.confirmAsync(t).then((t=>{i&&1==t&&window.open(e.linkButtonHref,"_blank")}))}}},onTopLevelCodeEnd:()=>{c("toplevelfinished")},stoppedClass:pxt.appTarget.simulator&&pxt.appTarget.simulator.stoppedClass,invalidatedClass:pxt.appTarget.simulator&&pxt.appTarget.simulator.invalidatedClass,nestedEditorSim:v,parentOrigin:b,mpRole:y,messageSimulators:null===(f=null===(h=pxt.appTarget)||void 0===h?void 0:h.simulator)||void 0===f?void 0:f.messageSimulators};n.driver=new pxsim.SimulatorDriver(document.getElementById("simulators"),x),s=t};let u=!1;function d(){n.driver&&n.driver.setDirty()}function p(e,t){n.driver&&(n.driver.stopSound(),n.driver.stop(e,t))}n.setState=function(e,t){s&&s.editor!=e&&(s.editor=e,s.highlightStatement(null)),u=t},n.setDirty=d,n.setPending=function(){n.driver&&n.driver.setPending()},n.run=function(e,t,r,i,o){var s;const l=pxt.appTarget.simulator.boardDefinition,{js:u,fnArgs:d,parts:p,usedBuiltinParts:h,allParts:f}=pxtc.buildSimJsInfo(r);a=r;const{mute:g,highContrast:m,light:v,clickTrigger:y,storedState:b,autoRun:x}=i,E=pxt.BrowserUtils.isIpcRenderer()||void 0,_={};for(const t of e.sortedDeps())_[t.id]=t.version();const w=f&&f.indexOf("multiplayer")>=0?1:void 0;if(w){const e=document.getElementById("root");for(let t=1;t<=4;t++){const n=`--multiplayer-presence-icon-${t}`;null===(s=null==e?void 0:e.style)||void 0===s||s.removeProperty(n)}}const S={boardDefinition:l,mute:g,parts:p,builtinParts:h,debug:t,trace:o,fnArgs:d,highContrast:m,light:v,aspectRatio:p.length?pxt.appTarget.simulator.partsAspectRatio:pxt.appTarget.simulator.aspectRatio,partDefinitions:e.computePartDefinitions(p),cdnUrl:pxt.webConfig.commitCdnUrl,localizedStrings:n.simTranslations,refCountingDebug:pxt.options.debug,version:e.version(),clickTrigger:y,breakOnStart:t,storedState:b,autoRun:x,ipc:E,dependencies:_,activePlayer:w,theme:e.config.theme};c("started"),n.driver.run(u,S)},n.mute=function(e){n.driver&&n.driver.mute(e)},n.stop=p,n.suspend=function(){n.driver&&n.driver.suspend()},n.hide=function(e){n.driver&&n.driver.hide(e)},n.unhide=function(){n.driver&&n.driver.unhide()},n.setTraceInterval=function(e){n.driver&&n.driver.setTraceInterval(e)},n.proxy=function(e){n.driver&&n.driver.postMessage(e)},n.dbgPauseResume=function(){n.driver.state==pxsim.SimulatorState.Paused?n.driver.resume(pxsim.SimulatorDebuggerCommand.Resume):n.driver.state==pxsim.SimulatorState.Running&&n.driver.resume(pxsim.SimulatorDebuggerCommand.Pause)},n.dbgStepOver=function(){n.driver.state==pxsim.SimulatorState.Paused&&n.driver.resume(pxsim.SimulatorDebuggerCommand.StepOver)},n.dbgStepInto=function(){n.driver.state==pxsim.SimulatorState.Paused&&n.driver.resume(pxsim.SimulatorDebuggerCommand.StepInto)},n.dbgStepOut=function(){n.driver.state==pxsim.SimulatorState.Paused&&n.driver.resume(pxsim.SimulatorDebuggerCommand.StepOut)}},{"./core":133,"./coretsx":134}],193:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isSnippetInputAnswerTypeDropdown=n.isSnippetInputAnswerTypeYesNo=n.isSnippetInputAnswerTypeNumber=n.isSnippetInputAnswerTypeOther=n.isSnippetInputAnswerSingular=n.initializeSnippetExtensions=n.SnippetBuilder=void 0;const r=e("react/jsx-runtime"),i=e("react"),o=e("./data"),s=e("./sui"),a=e("./marked"),l=e("./compiler"),c=e("react-dom"),u=e("./package"),d=e("./core"),p=e("./snippetBuilderInputHandler");class h extends o.Component{constructor(e){super(e),this.generateOutputMarkdown=pxt.Util.debounce((()=>{const{config:e,tsOutput:t}=this.state;let n=`\`\`\`${e.outputType}\n`;n+=this.replaceTokens(this.highlightEditedBlocks(t)),n+="\n```",this.setState({mdOutput:n})}),300,!1),this.onChange=e=>t=>{let n=this.getCurrentQuestion();this.setState((r=>{let i=Object.assign(Object.assign({},r.answers),{[e]:t});return{answers:i,tsOutput:this.updateOutput(n,i,r.tsOutput)}}),this.generateOutputMarkdown)},this.state={visible:!1,answers:{},history:[0],defaults:{},config:e.config,tsOutput:[e.config.initialOutput]},this.cleanup=this.cleanup.bind(this),this.hide=this.hide.bind(this),this.cancel=this.cancel.bind(this),this.confirm=this.confirm.bind(this),this.backPage=this.backPage.bind(this),this.nextPage=this.nextPage.bind(this),this.handleModalKeyDown=this.handleModalKeyDown.bind(this)}buildDefaults(){const{config:e}=this.state,t={};for(const n of e.questions){const{inputs:e}=n;for(const n of e)if(f(n)){const{defaultAnswer:e,answerToken:r}=n;t[r]=e}else{const{defaultAnswers:e,answerTokens:r}=n;for(let n=0;n<r.length;n++){const i=r[n],o=e[n];t[i]=o}}}this.setState({answers:t,defaults:t},this.generateOutputMarkdown)}toggleActionButton(){let e;e=this.isLastQuestion()?{label:lf("Done"),onclick:this.confirm,icon:"check",className:"approve positive"}:{label:lf("Next"),onclick:this.nextPage,icon:"arrow right",className:"arrow right"},this.state.actions[1]!==e&&this.setState({actions:[this.state.actions[0],e]})}initializeActionButtons(){const e=[{label:lf("Back"),onclick:this.backPage,icon:"arrow left",className:"arrow left",labelPosition:"left"},{label:lf("Next"),onclick:this.nextPage,icon:"arrow right",className:"arrow right"}];this.setState({actions:e})}componentDidMount(){this.buildDefaults()}replaceTokens(e){const{answers:t,defaults:n}=this.state;let r=e.join("\n");const i=Object.keys(n);for(let e of i){const i=t[e]||n[e];r=r.split(`$${e}`).join(i)}return r}highlightEditedBlocks(e){const t=this.getCurrentQuestion().inputs.reduce(((e,t)=>f(t)?pxt.Util.concat([e,[t.answerToken]]):pxt.Util.concat([e,t.answerTokens])),[]);return e.reduce(((e,n)=>{for(const r of t)if(-1!==n.indexOf(r))return pxt.Util.concat([e,["// @highlight",n]]);return pxt.Util.concat([e,[n]])}),[])}hide(){this.setState({visible:!1})}show(){pxt.tickEvent("snippet.builder.show",null,{interactiveConsent:!0}),this.initializeActionButtons(),this.setState({visible:!0})}cleanup(){this.setState({answers:{},history:[0],tsOutput:[this.props.config.initialOutput]}),Blockly.hideChaff()}cancel(){const{name:e}=this.state.config;pxt.tickEvent("snippet.builder.cancel",{snippet:e,page:this.getCurrentPage()},{interactiveConsent:!0}),this.hide(),this.cleanup()}injectBlocksToWorkspace(){const{tsOutput:e}=this.state,{mainWorkspace:t}=this.props,{outputBehavior:n}=this.state.config;l.getBlocksAsync().then((t=>l.decompileBlocksSnippetAsync(this.replaceTokens(e),t))).then((e=>{const r=Blockly.Xml.textToDom(e.outfiles[pxt.MAIN_BLOCKS]),i=pxt.blocks.findRootBlocks(r);let o=t.getTopBlocks(!0);"replace"===n&&(o.forEach((e=>{e.dispose(!1)})),o=[]);let s=i.map((e=>{let t=o.filter((t=>e.getAttribute("type")===t.type));return t.length?{newB:e,exB:t[0]}:{newB:e,exB:null}})),a=s.filter((e=>!!e.exB)),l=s.filter((e=>!e.exB));a.forEach((function(e){let{newB:n,exB:r}=e;const i=pxt.blocks.findRootBlock(n),o=Blockly.Xml.domToBlock(i,t);r.getInput("HANDLER").connection.connect(o.previousConnection)})),l.forEach((function(e){let{newB:n}=e;Blockly.Xml.domToBlock(n,t)})),o.length<=1&&pxt.blocks.layout.flow(t,{useViewWidth:!0})})).catch((e=>{throw d.errorNotification(e),new Error("Failed to decompile snippet output")}))}confirm(){const{name:e}=this.state.config;pxt.tickEvent("snippet.builder.back.page",{snippet:e,page:this.getCurrentPage()},{interactiveConsent:!0}),this.injectBlocksToWorkspace(),Blockly.hideChaff(),this.hide()}getCurrentPage(){const{history:e}=this.state;return e[e.length-1]}getCurrentQuestion(){const{config:e}=this.state;return e.questions[this.getCurrentPage()]}getNextQuestionNumber(){const{answers:e,defaults:t}=this.state,n=this.getCurrentQuestion();if(n.goto){const{parameters:r}=n.goto;if(r)for(const n of r){const{answer:r,token:i}=n;if(r&&i&&(r===e[i]||!e[i]&&r===t[i]))return n.question}return n.goto.question}return null}getNextQuestion(){const{config:e}=this.state,t=this.getNextQuestionNumber();return t?e.questions[t]:null}isLastQuestion(){return!this.getCurrentQuestion().goto}nextPage(){const{config:e,history:t}=this.state,n=this.getCurrentQuestion().goto;if(this.isLastQuestion())this.confirm();else if(n){const n=this.getNextQuestion();let r=this.updateOutput(n,this.state.answers,this.state.tsOutput);const i=this.getNextQuestionNumber();this.setState({history:[...t,i],tsOutput:r},this.toggleActionButton),pxt.tickEvent("snippet.builder.next.page",{snippet:e.name,page:i},{interactiveConsent:!0}),this.generateOutputMarkdown()}}backPage(){const{history:e,config:t}=this.state;e.length>1&&this.setState({history:e.slice(0,e.length-1)},(()=>{this.toggleActionButton(),pxt.tickEvent("snippet.builder.back.page",{snippet:t.name,page:this.getCurrentPage()},{interactiveConsent:!0}),this.generateOutputMarkdown()}))}handleModalKeyDown(e){13!==e.keyCode&&39!==e.keyCode||this.nextPage(),37===e.keyCode&&this.backPage()}updateOutput(e,t,n){let r=!1;if(e.outputConditionalOnAnswer){let n=e.outputConditionalOnAnswer;e.inputs.map((e=>f(e)?[e.answerToken]:e.answerTokens)).reduce(((e,t)=>[...e,...t]),[]).every((e=>t[e]!=n))&&(r=!0)}let i=!!e.output,o=i&&-1!==n.indexOf(e.output),s=n;return r||o||!i?r&&o&&(s=n.filter((t=>t!==e.output))):s=pxt.Util.concat([n,[e.output]]),s}renderCore(){const{visible:e,answers:t,config:n,mdOutput:i,actions:o,defaults:l}=this.state,{parent:c}=this.props,u=this.getCurrentQuestion();let d=0===this.getCurrentPage();return(0,r.jsx)(s.Modal,Object.assign({isOpen:e,className:"snippet-builder full-screen-no-bg "+(d?"no-back-btn":""),overlayClassName:"snippet-builder-modal-overlay",closeOnEscape:!0,closeIcon:!0,closeOnDimmerClick:!1,closeOnDocumentClick:!1,dimmer:!0,buttons:o,header:n.name,onClose:this.cancel,onKeyDown:this.handleModalKeyDown},{children:(0,r.jsxs)("div",Object.assign({className:"snippet-builder-inner"},{children:[u&&(0,r.jsxs)("div",Object.assign({className:"snippet-question"},{children:[(0,r.jsxs)("div",Object.assign({className:"ui segment raised"},{children:[(0,r.jsx)("h3",{children:pxt.Util.rlf(u.title)}),(0,r.jsx)("div",Object.assign({className:"ui equal width grid"},{children:u.inputs.map(((e,n)=>(0,r.jsx)("span",Object.assign({className:"column"},{children:(0,r.jsx)(p.InputHandler,{onChange:f(e)?this.onChange(e.answerToken):this.onChange,input:e,value:f(e)?t[e.answerToken]:t[e.answerTokens[0]],onEnter:this.nextPage},f(e)?e.answerToken:e.answerTokens[0])}),`span-${n}`)))})),u.errorMessage&&(0,r.jsx)("p",Object.assign({className:"snippet-error"},{children:u.errorMessage}))]})),u.hint&&(0,r.jsx)("div",Object.assign({className:"snippet hint ui segment"},{children:pxt.Util.rlf(u.hint).split("\n").reduce(((e,t)=>[...e,e.length?(0,r.jsx)("br",{}):"",t]),[])}))]})),(0,r.jsx)("div",Object.assign({className:"snippet output-section"},{children:i&&(0,r.jsx)(a.MarkedContent,{className:"snippet-markdown-content",markdown:i,parent:c})}))]}))}))}}function f(e){return void 0!==e.answerToken}n.SnippetBuilder=h,n.initializeSnippetExtensions=function(e,t,n,r){(function(){let e=pxt.Util.concat(u.allEditorPkgs().map((e=>e.sortedFiles()))),t=e.filter((e=>"pxtsnippets.json"===e.name)).map((e=>pxt.Util.jsonTryParse(e.content)));const n=e.filter((e=>e.name.endsWith(".snippetts")));return t=t.map((e=>e.map((e=>{if(e.initialOutput.startsWith("file:")){let t=e.initialOutput.slice("file:".length,e.initialOutput.length);if(1!=n.filter((e=>e.name===t)).length)return pxt.reportError("snippetbuilder",`invalid external .ts file path: ${t}`),null}return e})).filter((e=>!!e)))),pxt.Util.concat(t)})().filter((t=>t.namespace==e)).forEach((e=>{t.push({name:`SNIPPET${name}_BUTTON`,type:"button",attributes:{blockId:`SNIPPET${name}_BUTTON`,label:e.label?pxt.Util.rlf(e.label):pxt.Util.lf("Editor"),weight:101,group:e.group&&e.group},callback:()=>{!function(e,t,n){const r=document.createElement("div"),o=document.body.appendChild(r),s={parent:n,mainWorkspace:t,config:e};c.render(i.createElement(h,s),o).show()}(e,n,r)}})}))},n.isSnippetInputAnswerSingular=f,n.isSnippetInputAnswerTypeOther=function(e){return"number"!==e.type},n.isSnippetInputAnswerTypeNumber=function(e){return void 0!==e.max},n.isSnippetInputAnswerTypeYesNo=function(e){return"yesno"===e.type},n.isSnippetInputAnswerTypeDropdown=function(e){return void 0!==e.options}},{"./compiler":58,"./core":133,"./data":136,"./marked":167,"./package":179,"./snippetBuilderInputHandler":194,"./sui":200,react:366,"react-dom":309,"react/jsx-runtime":367}],194:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.InputHandler=void 0;const r=e("react/jsx-runtime"),i=e("./data"),o=e("./components/ImageEditor/ImageEditor"),s=e("./sui"),a=e("./snippetBuilderPositionPicker"),l=e("./snippetBuilder");class c extends i.Component{constructor(e){super(e),this.textOnChange=e=>this.props.onChange(e),this.variableNameOnChange=e=>this.props.onChange(ts.pxtc.escapeIdentifier(e)),this.state={isFocused:!1}}renderInput(){const{value:e,input:t,onChange:n}=this.props;switch(t.type){case"dropdown":return(0,r.jsx)(u,{input:t,value:e,onChange:n});case"yesno":return(0,r.jsx)(p,{input:t,onChange:n});case"spriteEditor":if(l.isSnippetInputAnswerTypeOther(t)){const t=pxt.sprite.imageLiteralToBitmap(e);return(0,r.jsx)(o.ImageEditor,{singleFrame:!0,asset:{internalID:0,type:"image",id:"",jresData:"",meta:{},bitmap:t.data()},onChange:n})}case"number":return(0,r.jsx)(d,{input:t,value:e,onChange:n,autoFocus:!0});case"positionPicker":if(!l.isSnippetInputAnswerSingular(t))return(0,r.jsx)(a.PositionPicker,{defaultX:parseInt(t.defaultAnswers[0]),defaultY:parseInt(t.defaultAnswers[1]),input:t,onChange:n});case"text":case"variableName":default:if(l.isSnippetInputAnswerTypeOther(t))return(0,r.jsx)(s.Input,{label:t.label&&t.label,value:e||"",onChange:"variableName"==t.type?this.variableNameOnChange:this.textOnChange,autoFocus:!0,selectOnMount:!0})}return null}renderCore(){return this.renderInput()}}n.InputHandler=c;class u extends i.Component{constructor(e){super(e),this.onChange=e=>()=>{const{onChange:t}=this.props;t(e)},this.onChange=this.onChange.bind(this)}renderCore(){const{value:e,input:t}=this.props;return l.isSnippetInputAnswerTypeDropdown(t)?(0,r.jsx)(s.DropdownMenu,Object.assign({className:"inline button",role:"menuitem",text:e.length?pxt.Util.rlf(t.options[e]):pxt.Util.rlf(t.options[Object.keys(t.options)[0]]),icon:"dropdown"},{children:Object.keys(t.options).map((e=>(0,r.jsx)(s.Item,{role:"menuitem",value:e,text:pxt.Util.rlf(t.options[e]),onClick:this.onChange(e)},t.options[e])))})):null}}class d extends i.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this)}onChange(e){const{onChange:t}=this.props;t(e.target.value)}renderCore(){const{input:e,value:t,autoFocus:n}=this.props;return l.isSnippetInputAnswerTypeNumber(e)?(0,r.jsxs)("div",Object.assign({className:"slider-outer"},{children:[(0,r.jsx)("span",{children:e.label&&e.label}),(0,r.jsxs)("div",{children:[(0,r.jsx)("input",{type:"range",autoFocus:n,className:"slider blocklyMockSlider",role:"slider",max:e.max,min:e.min,value:t,onChange:this.onChange,"aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":+t,style:{marginLeft:0}}),(0,r.jsx)(s.Input,{value:t,onChange:this.props.onChange,class:"snippet slider-input"})]})]})):null}}class p extends i.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this)}onChange(e){const{onChange:t}=this.props;return()=>t(e)}renderCore(){const{input:e}=this.props;return l.isSnippetInputAnswerTypeYesNo(e)?(0,r.jsxs)("div",{children:[(0,r.jsx)(s.Button,{text:"Yes",title:"Yes",onClick:this.onChange("true")}),(0,r.jsx)(s.Button,{text:"No",title:"No",onClick:this.onChange("false")})]}):null}}},{"./components/ImageEditor/ImageEditor":66,"./data":136,"./snippetBuilder":193,"./snippetBuilderPositionPicker":195,"./sui":200,"react/jsx-runtime":367}],195:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PositionPicker=void 0;const r=e("react/jsx-runtime"),i=e("./data"),o=e("./snippetBuilder"),s=e("./sui"),a=e("./snippetBuilderSimulatorDisplay");class l extends i.Component{constructor(e){super(e),this.onChange=e=>t=>{const{input:n,onChange:r}=this.props;if(!o.isSnippetInputAnswerSingular(n)){const i=this.state;let o=parseInt(t);if(isNaN(o)||o<0)return;this.setState({x:e?this.unScalePointX(o):i.x,y:e?i.y:this.unScalePointY(o)},(()=>{const t=this.getScaledPoints();e&&r(n.answerTokens[0])(t.x.toString()),e||r(n.answerTokens[1])(t.y.toString()),this.setState({dotVisible:!0})}))}},this.state={x:this.unScalePointX(this.props.defaultX||80),y:this.unScalePointY(this.props.defaultY||60),dotVisible:!1},this.setDot=this.setDot.bind(this),this.onChange=this.onChange.bind(this),this.setScale=this.setScale.bind(this)}componentWillUnmount(){window.removeEventListener("resize",this.setScale)}componentDidMount(){this.setScale(),window.addEventListener("resize",this.setScale)}setScale(){const e=window.innerHeight,t=window.innerWidth;let n=e>t?t/2100:e/1003;n<.71?n=.71:n>1.01&&(n=1.01),this.setState({scale:n})}getScale(e,t){const{scale:n}=this.state;return t*n/e}getXScale(){return this.getScale(160,309)}getYScale(){return this.getScale(120,227)}scalePoint(e,t){return isNaN(e)?0:Math.round(e/t)}scalePointX(e){return this.scalePoint(e,this.getXScale())}scalePointY(e){return this.scalePoint(e,this.getYScale())}unScalePoint(e,t){return isNaN(e)?0:Math.round(e*t)}unScalePointX(e){return this.unScalePoint(e,this.getXScale())}unScalePointY(e){return this.unScalePoint(e,this.getYScale())}getScaledPoints(){const{x:e,y:t}=this.state;return{x:this.scalePointX(e),y:this.scalePointY(t)}}scalePixel(e){const{scale:t}=this.state;return e*t+"px"}setDot(e){const{input:t,onChange:n}=this.props,r=e.nativeEvent.offsetX,i=e.nativeEvent.offsetY;this.setState({dotVisible:!0,x:Math.round(r),y:Math.round(i)},(()=>{if(!o.isSnippetInputAnswerSingular(t)){const e=this.getScaledPoints();n(t.answerTokens[0])(e.x.toString()),n(t.answerTokens[1])(e.y.toString())}}))}renderCore(){const{dotVisible:e,x:t,y:n,scale:i}=this.state,o=this.getScaledPoints();return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",Object.assign({className:"ui grid"},{children:[(0,r.jsx)("div",Object.assign({className:"column"},{children:(0,r.jsx)(s.Input,{class:"position-picker preview-input",value:o.x.toString(),onChange:this.onChange(!0)})})),(0,r.jsx)("div",Object.assign({className:"column"},{children:(0,r.jsx)(s.Input,{class:"position-picker preview-input",value:o.y.toString(),onChange:this.onChange(!1)})}))]})),(0,r.jsx)(a.SimulatorDisplay,Object.assign({scale:i},{children:(0,r.jsx)("div",Object.assign({ref:"positionPickerContainer",className:"position-picker container",onClick:this.setDot,style:{left:this.scalePixel(28),top:this.scalePixel(28),width:this.scalePixel(309),height:this.scalePixel(227),margin:"8px",maxWidth:this.scalePixel(309),maxHeight:this.scalePixel(227)},role:"grid"},{children:e&&(0,r.jsx)("div",{className:"position-picker dot",style:{top:`${n}px`,left:`${t}px`}})}))}))]})}}n.PositionPicker=l},{"./data":136,"./snippetBuilder":193,"./snippetBuilderSimulatorDisplay":196,"./sui":200,"react/jsx-runtime":367}],196:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SimulatorDisplay=void 0;const r=e("react/jsx-runtime"),i=e("./data");class o extends i.Component{scalePixel(e,t){const{scale:n}=this.props;return`${e*n}${!t&&"px"}`}renderCore(){const{children:e,scale:t}=this.props,n=(0,r.jsx)("svg",Object.assign({height:"127.2",width:"127.2",style:{transform:`scale(${t})`,transformOrigin:"0 0",position:"absolute",left:"0px",top:this.scalePixel(297.85)},visibility:"visible"},{children:(0,r.jsxs)("g",Object.assign({transform:"translate(18.80933368822642 18.80933368822642) scale(3.7618667376452843)"},{children:[(0,r.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 23.813 24.362",width:"23.813",height:"24.362"},{children:[(0,r.jsx)("path",{fill:"#f290c1",d:"M11.906 0c-2.431 0-3.304.092-3.59.378-.29.29-.378 1.21-.378 3.969v3.591h-3.59c-2.76 0-3.68.087-3.97.378C.092 8.602 0 9.474 0 11.9c0 3.051.032 3.237.65 3.855.62.62.797.65 3.968.65h3.32v3.583c0 2.49.1 3.697.33 3.958.48.544 6.688.56 7.23.018.29-.29.377-1.21.377-3.968v-3.591h3.32c3.171 0 3.348-.03 3.969-.65.618-.618.649-.804.649-3.855 0-2.426-.092-3.298-.378-3.584-.288-.288-1.174-.378-3.704-.378h-3.327V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416 0-.98-.65-1.172-3.969-1.172z"}),(0,r.jsx)("path",{fill:"#f291bd",d:"M11.906 0c-2.431 0-3.304.092-3.59.378-.29.29-.378 1.21-.378 3.969v3.591h-3.59c-2.76 0-3.68.087-3.97.378C.092 8.602 0 9.474 0 11.9c0 3.051.032 3.237.65 3.855.62.62.797.65 3.968.65h3.32v3.583c0 2.49.1 3.697.33 3.958.48.544 6.688.56 7.23.018.29-.29.377-1.21.377-3.968v-3.591h3.241c3.027-.001 3.29-.042 3.97-.627.719-.619.727-.66.727-3.855 0-2.446-.092-3.321-.378-3.607-.288-.288-1.174-.378-3.704-.378h-3.327V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416 0-.98-.65-1.172-3.969-1.172zm1.799.534c.188-.002.635.288.992.645.626.626.649.781.649 4.234 0 2.368-.096 3.583-.283 3.583-.19 0-.263-1.135-.222-3.438.058-3.3.035-3.46-.552-3.969-.336-.292-.504-.532-.372-.534.131-.002.06-.12-.159-.26-.283-.184-.298-.258-.053-.261zm-4.488.525c.12 0 .22.178.22.397 0 .45-.019.466-.264.22-.247-.246-.22-.617.044-.617zm-.561 6.398c.044-.018.099.08.19.283.114.254.138.641.054.86-.169.44-.962.549-.962.132 0-.146.11-.265.246-.265s.293-.268.35-.595c.046-.261.078-.396.122-.415zM22.4 8.997c.24 0 .883.755.883 1.039 0 .387-.45.357-.704-.048-.25-.399-.356-.992-.18-.992zM.936 9.63c.027-.006.051 0 .071.02.082.081 0 .295-.18.474-.261.26-.292.23-.148-.148.074-.196.176-.327.257-.346zm21.876 2.83c.038-.01.107.097.234.315.151.26.234.595.185.745-.142.424-.477-.054-.468-.666.003-.254.01-.383.049-.394zm-22.071.88a.16.16 0 0 1 .053.02c.145.09.264.336.264.546 0 .21-.119.381-.264.381-.146 0-.265-.245-.265-.545 0-.262.091-.426.212-.403zm3.214 1.5c1.97-.026 4.558.11 4.762.355.137.166.27 1.781.296 3.59.03 2.222-.05 3.319-.25 3.385-.208.07-.296-.931-.296-3.363v-3.462H5.012c-2.294 0-3.4-.09-3.288-.271.089-.144 1.049-.218 2.231-.234zm5.258 7.66c.128.001.393.127.725.378.387.292.416.387.116.386-.218 0-.55-.176-.738-.388-.22-.25-.23-.375-.103-.375z"}),(0,r.jsx)("path",{fill:"#a3809c",d:"M12.012 0C7.81 0 7.938-.139 7.938 4.407v3.531H4.453c-4.58 0-4.453-.113-4.452 3.943 0 2.844.045 3.122.625 3.796.622.723.65.728 3.97.728h3.342v3.609c0 3.126.062 3.655.463 3.96.318.241 1.374.354 3.38.36 4.184.012 4.094.108 4.094-4.372v-3.557h3.271c3.182 0 3.29-.02 3.969-.698.675-.675.697-.798.69-3.77-.006-2.135-.116-3.214-.36-3.536-.302-.398-.821-.463-3.696-.463h-3.345V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416C15.875.199 15.22 0 12.012 0zm-.106.53c1.92 0 2.208.067 2.79.65.621.62.65.797.65 3.968v3.32h3.32c3.171 0 3.348.028 3.968.649.575.574.65.879.65 2.646 0 1.154-.112 1.996-.265 1.996-.15 0-.265-.75-.265-1.718 0-1.386-.111-1.846-.576-2.381-.56-.644-.678-.664-3.97-.664h-3.391V5.677c0-3.171-.029-3.348-.65-3.969-.547-.547-.902-.65-2.26-.65-1.359 0-1.714.103-2.261.65-.62.62-.65.798-.65 3.97v3.318h-3.32c-3.17 0-3.347.03-3.968.65-.568.568-.65.886-.65 2.532 0 1.28.122 2.005.379 2.261.29.29 1.21.378 3.969.378h3.59v3.394c0 3.205.034 3.425.612 3.968.45.422.944.576 1.852.576.682 0 1.24.119 1.24.264 0 .148-.673.258-1.521.249-1.253-.014-1.627-.129-2.117-.652-.552-.59-.595-.878-.595-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.579-.578-.65-.874-.65-2.711.001-1.787.084-2.16.627-2.79.62-.723.65-.728 3.968-.728h3.343V5.148c0-3.171.029-3.348.65-3.969.582-.582.87-.65 2.79-.65zM9.782 11.668c.154.024.358.267.56.723.182.412.668.898 1.08 1.08.412.183.749.441.749.575 0 .133-.281.242-.625.242-.807 0-2.02-1.214-2.02-2.02 0-.426.102-.623.256-.6z"}),(0,r.jsx)("path",{fill:"#a8769a",d:"M12.06 0C7.84 0 7.939-.105 7.939 4.425v3.513H4.5c-4.598 0-4.5-.086-4.5 3.991 0 2.976.023 3.104.697 3.778.678.678.787.698 3.969.698h3.27v3.485c0 2.87.078 3.57.439 3.968.374.413.865.484 3.356.484 2.633 0 2.978-.057 3.53-.576.58-.543.613-.763.613-3.968v-3.394l3.241-.008c4.438-.011 4.697-.266 4.697-4.618 0-3.822-.02-3.84-4.234-3.84h-3.175V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416 0-.97-.657-1.172-3.814-1.172zm-.154.53c1.92 0 2.208.067 2.79.65.621.62.65.797.65 3.968v3.32h3.32c3.171 0 3.348.028 3.968.649.575.574.65.879.65 2.646 0 1.737-.062 1.996-.471 1.996-.26 0-.643.238-.852.529-.348.482-.685.53-3.763.53h-3.381l-.034 1.653c-.018.91-.04 2.424-.047 3.366-.011 1.42-.117 1.817-.616 2.316-.33.33-.786.602-1.01.602-.225 0-.41.119-.41.264 0 .148-.673.258-1.521.249-1.253-.014-1.627-.129-2.117-.652-.552-.59-.595-.878-.595-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.583-.582-.65-.87-.65-2.79s.067-2.207.65-2.79c.62-.62.797-.649 3.969-.649h3.319V5.148c0-3.171.029-3.348.65-3.969.582-.582.87-.65 2.79-.65zm0 2.116c-.617 0-.793.117-.793.529 0 .291-.12.53-.265.53-.145 0-.265.237-.265.528 0 .291-.119.53-.264.53-.146 0-.265.238-.265.529 0 .29-.119.529-.264.529-.146 0-.28.208-.3.463-.019.254-.127.046-.24-.463l-.206-.926.042.926.042.926 2.646.147c1.455.081 2.735.17 2.844.199.251.064.26-1.072.013-1.714-.167-.433-.202-.419-.331.13-.128.541-.232.448-.877-.794-.402-.774-.73-1.557-.727-1.738.002-.192-.329-.331-.79-.331zm9.525 6.35c-.013.013.067.12.231.33.346.441.563.582.563.364 0-.055-.208-.264-.463-.463-.21-.165-.317-.245-.33-.231zm-14.874.021c-.772-.016-.951.065-.831.377.111.29-.285.596-1.455 1.125-1.343.607-1.608.834-1.609 1.387-.001.56.264.78 1.722 1.432 1.728.772 1.875 1.067.643 1.288-.364.065.35.115 1.588.11 1.237-.005 1.802-.055 1.257-.112l-.993-.104v-2.608c0-1.838.098-2.647.331-2.741.182-.073-.112-.143-.653-.154zm5.365.464c-.676.022-1.35.282-1.77.772-.651.756-.817 1.389-.364 1.389.144 0 .41-.238.592-.53.426-.68 1.271-.673 2.152.02.85.668.931 1.812.168 2.362-.29.21-.529.474-.529.587 0 .383.718.21 1.42-.342.93-.732.996-2.67.121-3.602-.434-.462-1.113-.678-1.79-.656zm5.23.044c-.229 0-.313 4.58-.089 4.804.071.071 1.017-.296 2.1-.816 1.73-.83 1.973-1.034 1.987-1.673.01-.4-.1-.728-.244-.728-.143 0-.997-.357-1.898-.793-.901-.437-1.737-.794-1.856-.794zm-15.98 3.386c-.034.018-.058.178-.062.45-.005.437.05.648.122.469.073-.18.077-.537.01-.794-.025-.097-.05-.136-.07-.125zm1.704 1.673a2.998 2.998 0 0 0-.558.046c-.329.063-.122.117.46.12.582.003.852-.049.599-.115a2.182 2.182 0 0 0-.501-.05zm10.134 2.282c-.297.002-.625.008-.97.02-1.538.051-2.515.193-2.515.364 0 .154.387 1.092.86 2.084.721 1.513.967 1.804 1.521 1.81.568.004.793-.279 1.588-2.005.51-1.105.956-2.083.993-2.174.028-.067-.585-.104-1.477-.099zm-3.946 4.427a.043.043 0 0 0-.03.012c-.062.063.037.296.221.517.472.57.6.501.216-.114-.155-.249-.325-.419-.407-.415z"}),(0,r.jsx)("path",{fill:"#2f99a1",d:"M12.093.009C9.408 0 9.198.039 8.587.65c-.62.62-.65.797-.65 3.969v3.319H4.619c-3.171 0-3.348.029-3.968.65-.608.607-.65.83-.65 3.44 0 1.683.105 2.79.265 2.79.145 0 .264.237.264.528 0 .353.177.53.53.53.29 0 .529.119.529.264 0 .162 1.234.265 3.175.265h3.175v3.316c0 3.075.043 3.364.595 3.953.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.62-.62.65-.798.65-3.97v-3.318h3.174c1.94 0 3.175-.103 3.175-.265 0-.145.19-.265.422-.265.232 0 .484-.238.56-.529.076-.29.244-.529.372-.529.129 0 .234-1.255.234-2.79 0-2.61-.042-2.832-.65-3.44-.62-.62-.796-.649-3.98-.649H15.85l.053-3.579c.067-4.471.184-4.338-3.811-4.35zm-.114.52c2.033 0 2.26.055 2.79.664.527.606.577.952.577 3.969v3.305h3.32c3.171 0 3.348.03 3.968.65.575.574.65.879.65 2.646 0 1.737-.062 1.996-.471 1.996-.26 0-.643.238-.852.529-.348.482-.685.53-3.763.53h-3.381v3.318c0 3.172-.029 3.349-.65 3.97-.356.356-.833.649-1.058.649-.224 0-.409.119-.409.264 0 .148-.673.258-1.521.249-1.253-.014-1.627-.129-2.117-.652-.552-.59-.595-.878-.595-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.583-.582-.65-.87-.65-2.79s.067-2.207.65-2.79c.62-.62.797-.649 3.969-.649h3.319V5.148c0-3.171.029-3.348.65-3.969.585-.586.865-.65 2.862-.65zm-.044 2.117c-.286 0-.788.7-1.425 1.989-.542 1.094-.985 2.046-.985 2.116 0 .07 1.072.129 2.381.129 1.31 0 2.382-.048 2.382-.105 0-.058-.43-1.01-.956-2.117-.627-1.321-1.107-2.012-1.397-2.012zm-5.138 6.88c-.046 0-.727.31-1.513.69-.787.379-1.702.793-2.034.92-1.142.433-.72 1.126 1.314 2.153 1.055.532 2.008.974 2.117.983.109.01.198-1.056.198-2.365 0-1.31-.037-2.382-.082-2.382zm5.103 0c-1.12 0-1.536.25-2.068 1.244-.376.702-.384.872-.042.872.145 0 .264-.14.264-.31 0-.17.193-.523.429-.783.41-.454.468-.453 1.415.03.567.29 1.165.874 1.408 1.375.386.797.386.91 0 1.338-.233.256-.583.467-.779.467-.196 0-.356.119-.356.264 0 .346.15.334.858-.066.932-.525 1.241-1.052 1.25-2.128.012-1.409-.912-2.304-2.38-2.304zm5.162 0c-.07 0-.129 1.071-.129 2.38 0 1.31.058 2.382.129 2.382.07 0 1.023-.443 2.116-.984 1.206-.597 1.989-1.147 1.989-1.397s-.783-.8-1.989-1.398c-1.093-.54-2.046-.984-2.116-.984zm-5.156 7.408c-1.31 0-2.38.058-2.38.128s.444 1.026.987 2.124c.657 1.328 1.122 1.971 1.39 1.922.346-.064 2.353-3.421 2.376-3.976.005-.109-1.063-.198-2.373-.198z"}),(0,r.jsx)("path",{fill:"#96266c",d:"M12.093.009C9.408 0 9.198.039 8.587.65c-.62.62-.65.797-.65 3.969v3.319H4.619c-3.171 0-3.348.029-3.968.65-.608.607-.65.83-.65 3.44 0 1.683.105 2.79.265 2.79.145 0 .264.237.264.528 0 .353.177.53.53.53.29 0 .529.119.529.264 0 .162 1.234.265 3.175.265h3.175v3.316c0 3.075.043 3.364.595 3.953.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.62-.62.65-.798.65-3.97v-3.318h3.174c1.94 0 3.175-.103 3.175-.265 0-.145.19-.265.422-.265.232 0 .484-.238.56-.529.076-.29.244-.529.372-.529.129 0 .234-1.255.234-2.79 0-2.61-.042-2.832-.65-3.44-.62-.62-.796-.649-3.98-.649H15.85l.053-3.579c.067-4.471.184-4.338-3.811-4.35zm-.114.52c2.033 0 2.26.055 2.79.664.527.606.577.952.577 3.969v3.305h3.32c3.171 0 3.348.03 3.968.65.583.582.65.87.65 2.79s-.067 2.207-.65 2.79c-.62.62-.797.65-3.968.65h-3.32v3.318c0 3.172-.029 3.349-.65 3.97-.588.588-.854.647-2.843.633-1.965-.015-2.258-.083-2.79-.652-.553-.59-.596-.878-.596-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.583-.582-.65-.87-.65-2.79s.067-2.207.65-2.79c.62-.62.797-.649 3.969-.649h3.319V5.148c0-3.171.029-3.348.65-3.969.585-.586.865-.65 2.862-.65zm-.044 2.117c-.286 0-.788.7-1.425 1.989-.542 1.094-.985 2.046-.985 2.116 0 .07 1.072.129 2.381.129 1.31 0 2.382-.048 2.382-.105 0-.058-.43-1.01-.956-2.117-.627-1.321-1.107-2.012-1.397-2.012zm-5.138 6.88c-.046 0-.727.31-1.513.69-.787.379-1.702.793-2.034.92-1.142.433-.72 1.126 1.314 2.153 1.055.532 2.008.974 2.117.983.109.01.198-1.056.198-2.365 0-1.31-.037-2.382-.082-2.382zm5.103 0c-1.12 0-1.536.25-2.068 1.244-.376.702-.384.872-.042.872.145 0 .264-.14.264-.31 0-.17.193-.523.429-.783.41-.454.468-.453 1.415.03.567.29 1.165.874 1.408 1.375.386.797.386.91 0 1.338-.233.256-.583.467-.779.467-.196 0-.356.119-.356.264 0 .346.15.334.858-.066.932-.525 1.241-1.052 1.25-2.128.012-1.409-.912-2.304-2.38-2.304zm5.162 0c-.07 0-.129 1.071-.129 2.38 0 1.31.058 2.382.129 2.382.07 0 1.023-.443 2.116-.984 1.206-.597 1.989-1.147 1.989-1.397s-.783-.8-1.989-1.398c-1.093-.54-2.046-.984-2.116-.984zm-5.156 7.408c-1.31 0-2.38.058-2.38.128s.444 1.026.987 2.124c.657 1.328 1.122 1.971 1.39 1.922.346-.064 2.353-3.421 2.376-3.976.005-.109-1.063-.198-2.373-.198z"}),(0,r.jsx)("path",{fill:"#5b3b6a",d:"M12.093.009C9.408 0 9.198.039 8.587.65c-.62.62-.65.797-.65 3.969v3.319H4.619c-3.171 0-3.348.029-3.968.65-.608.607-.65.83-.65 3.44 0 1.683.105 2.79.265 2.79.145 0 .264.237.264.528 0 .353.177.53.53.53.29 0 .529.119.529.264 0 .162 1.234.265 3.175.265h3.175v3.316c0 3.075.043 3.364.595 3.953.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.62-.62.65-.798.65-3.97v-3.318h3.174c1.94 0 3.175-.103 3.175-.265 0-.145.19-.265.422-.265.232 0 .484-.238.56-.529.076-.29.244-.529.372-.529.129 0 .234-1.255.234-2.79 0-2.61-.042-2.832-.65-3.44-.62-.62-.797-.649-3.968-.649h-3.32v-3.61c0-3.126-.062-3.655-.463-3.96-.317-.24-1.364-.353-3.319-.36zm-.112.52c1.973 0 2.277.067 2.79.613.528.562.575.887.575 3.969v3.356h3.394c3.205 0 3.425.034 3.968.612.495.527.575.919.575 2.79 0 1.96-.064 2.243-.649 2.828-.62.62-.797.65-3.968.65h-3.32v3.318c0 3.172-.029 3.349-.65 3.97-.585.585-.865.649-2.863.649-1.974 0-2.278-.067-2.79-.613-.529-.562-.576-.886-.576-3.968v-3.357H5.074c-3.205 0-3.426-.034-3.969-.612-.498-.53-.576-.917-.576-2.863 0-2.072.053-2.296.664-2.827.605-.527.951-.577 3.969-.577h3.305V5.148c0-3.171.029-3.348.65-3.969.585-.586.865-.65 2.864-.65zm-.046 2.117c-.286 0-.788.7-1.425 1.989-.542 1.094-.985 2.046-.985 2.116 0 .07 1.072.129 2.381.129 1.31 0 2.382-.048 2.382-.105 0-.058-.43-1.01-.956-2.117-.627-1.321-1.107-2.012-1.397-2.012zm-5.138 6.88c-.046 0-.727.31-1.513.69-.787.379-1.702.793-2.034.92-1.142.433-.72 1.126 1.314 2.153 1.055.532 2.008.974 2.117.983.109.009.198-1.056.198-2.365 0-1.31-.037-2.382-.082-2.382zm5.103 0c-1.12 0-1.536.25-2.068 1.244-.376.702-.384.872-.042.872.145 0 .264-.14.264-.31 0-.17.193-.523.429-.783.41-.454.468-.453 1.415.03.567.29 1.165.874 1.408 1.375.386.797.386.91 0 1.338-.233.256-.583.467-.779.467-.196 0-.356.119-.356.264 0 .346.15.334.858-.066.932-.525 1.241-1.052 1.25-2.128.012-1.409-.912-2.304-2.38-2.304zm5.162 0c-.07 0-.129 1.071-.129 2.38 0 1.31.058 2.382.129 2.382.07 0 1.023-.443 2.116-.984 1.206-.597 1.989-1.147 1.989-1.397s-.783-.8-1.989-1.398c-1.093-.54-2.046-.984-2.116-.984zm-5.156 7.408c-1.31 0-2.38.057-2.38.127s.444 1.027.987 2.125c.657 1.328 1.122 1.971 1.39 1.922.346-.064 2.353-3.421 2.376-3.976.005-.109-1.063-.198-2.373-.198z"}),(0,r.jsx)("path",{d:"M9.763 0c-.295.002-.765.24-1.176.65-.357.357-.65.714-.65.794 0 .323.437.111.794-.385.21-.291.594-.53.853-.53.258 0 .47-.118.47-.264 0-.182-.114-.265-.29-.265zm4.286 0c-.177 0-.29.083-.29.265 0 .146.187.265.415.265 1.002 0 1.172.63 1.172 4.346 0 2.218.101 3.591.265 3.591.163 0 .264-1.37.264-3.584 0-3.452-.023-3.607-.649-4.233-.41-.41-.882-.648-1.177-.65zM4.883 7.938c-3.452 0-3.608.024-4.233.65C.293 8.945 0 9.42 0 9.646c0 .225.12.409.265.409.145 0 .264-.188.264-.416 0-1.002.632-1.172 4.347-1.172 2.218 0 3.59-.101 3.59-.264 0-.164-1.37-.265-3.583-.265zm18.04.612a.168.168 0 0 0-.115.054c-.102.11-.037.253.145.318s.33.347.33.626.12.507.265.507c.146 0 .265-.188.265-.416 0-.459-.579-1.112-.89-1.089zM.265 13.76c-.485 0-.273.81.385 1.467.62.62.797.65 3.968.65h3.32v3.58c0 3.35.038 3.623.595 4.218.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.626-.626.65-.781.65-4.234v-3.584h3.391c3.291 0 3.41-.02 3.969-.663.603-.693.766-1.453.312-1.453-.145 0-.265.187-.265.416 0 1.001-.63 1.171-4.346 1.171h-3.591v3.591c0 3.716-.17 4.347-1.172 4.347-.228 0-.416.119-.416.264 0 .152-.793.265-1.852.265-1.058 0-1.852-.113-1.852-.265 0-.145-.186-.264-.415-.264-1.002 0-1.172-.631-1.172-4.347v-3.59h-3.59c-3.716 0-4.348-.17-4.348-1.172 0-.229-.119-.416-.264-.416z"})]})),(0,r.jsx)("rect",{className:"controller-button-overlay",x:"7.937666666666666",y:"0",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"}),(0,r.jsx)("rect",{className:"controller-button-overlay",x:"15.875333333333332",y:"7.937666666666666",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"}),(0,r.jsx)("rect",{className:"controller-button-overlay",x:"7.937666666666666",y:"15.875333333333332",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"}),(0,r.jsx)("rect",{className:"controller-button-overlay",x:"0",y:"7.937666666666666",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"})]}))})),i=(0,r.jsx)("svg",Object.assign({height:"127.2",width:"127.2",style:{transform:`scale(${t})`,transformOrigin:"0 0",position:"absolute",left:this.scalePixel(240.8),top:this.scalePixel(297.85)},visibility:"visible"},{children:(0,r.jsxs)("g",Object.assign({transform:"translate(17.15858198888469 17.15858198888469) scale(3.4317163977769383)"},{children:[(0,r.jsxs)("g",Object.assign({transform:"translate(13.533000000000001 2.2554999999999996)"},{children:[(0,r.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 13.533 13.246",width:"13.533",height:"13.246"},{children:[(0,r.jsx)("path",{fill:"#ff8135",stroke:"#5c406c",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:".861",d:"M13.099 6.602c.1 2.457-1.61 4.712-3.813 5.662a6.152 6.152 0 0 1-4.661.175C1.38 11.444-.431 7.43.85 4.317c.68-1.583 1.982-2.925 3.63-3.485 2.494-.914 5.612-.248 7.246 1.923a6.112 6.112 0 0 1 1.372 3.847z"}),(0,r.jsx)("path",{fill:"#e5cdc4",fillRule:"evenodd",stroke:"#e5cdc4",strokeWidth:".265",d:"M2.454 2.619C.284 4.916 1.146 7.611 1.146 7.611c.792-4.598 3.68-6.217 8.39-6.006 0 0-4.269-1.965-7.082 1.014z"}),(0,r.jsx)("path",{fill:"#af4282",d:"M8.745 9.825h1.423l-1.72-6.914H7.027L2.542 9.825h1.412c.444-.507.61-1.53 1.45-1.304H8.42l.326 1.304zm-.602-2.519H5.574c.621-.807 1.397-2.523 1.92-2.76l.649 2.76z",fontFamily:"Nexa Bold",fontSize:"15.875",fontWeight:"400",letterSpacing:"0",style:{lineHeight:"125%"},wordSpacing:"0"})]})),(0,r.jsx)("circle",{className:"controller-button-overlay",cx:"6.766500000000001",cy:"6.766500000000001",r:"6.766500000000001",fill:"black",fillOpacity:"0"})]})),(0,r.jsxs)("g",Object.assign({transform:"translate(0 13.533000000000001)"},{children:[(0,r.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 13.533 13.246",width:"13.533",height:"13.246"},{children:[(0,r.jsx)("path",{fill:"#ff91c4",stroke:"#5c406c",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:".861",d:"M13.099 6.602c.1 2.457-1.61 4.712-3.813 5.662a6.152 6.152 0 0 1-4.661.175C1.38 11.444-.431 7.43.85 4.317c.68-1.583 1.982-2.925 3.63-3.485 2.494-.914 5.612-.248 7.246 1.923a6.112 6.112 0 0 1 1.372 3.847z"}),(0,r.jsx)("path",{fill:"#e5cdc4",fillRule:"evenodd",stroke:"#e5cdc4",strokeWidth:".265",d:"M2.454 2.619C.284 4.916 1.051 7.563 1.051 7.563c.793-4.597 3.823-6.169 8.533-5.958 0 0-4.317-1.965-7.13 1.014z"}),(0,r.jsx)("path",{fill:"#af4282",d:"M5.337 7.226c.909.088 1.876-.201 2.736.21.288.113.37.493.32.773-.143.515-.716.742-1.197.817-.607-.047-1.91.169-2.181-.227-.058-.371.217-.697.222-1.073l.1-.5zM5.88 4.49c.81.122 1.664-.209 2.444.123.263.119.537.35.451.67-.591 1.227-2.213.797-3.21.797l.315-1.59zm2.233-1.186h-3.28L3.45 10.22c1.523-.054 3.064.132 4.572-.152 1.117-.305 1.976-1.536 1.666-2.692-.146-.282-.515-.448-.562-.79.088-.354.606-.278.717-.652.452-.693.41-1.769-.288-2.287-.42-.274-.95-.333-1.442-.342z",fontFamily:"Nexa Bold",fontSize:"15.875",fontWeight:"400",letterSpacing:"0",style:{lineHeight:"125%"},wordSpacing:"0"})]})),(0,r.jsx)("circle",{className:"controller-button-overlay",cx:"6.766500000000001",cy:"6.766500000000001",r:"6.766500000000001",fill:"black",fillOpacity:"0"})]}))]}))})),o=(0,r.jsxs)("svg",Object.assign({visibility:"visible",width:"70px",height:"26.25px",style:{transform:`scale(${t})`,transformOrigin:"0 0",position:"absolute",left:this.scalePixel(105.25),top:this.scalePixel(284)}},{children:[(0,r.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16.937 6.35"},{children:[(0,r.jsx)("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .806-.072.806.073 0 .17 1.912.36 5.969.36s6.334 0 6.334-.169c0-.145.184-.264.41-.264.224 0 .7-.293 1.057-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472z",fill:"#f290c1"}),(0,r.jsx)("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .806.008.806.153 0 .17 1.418-.021 5.376-.021 3.85 0 6.693.297 6.795.132.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm13.915.983l.595.366c.385.237.595.623.595 1.096 0 .401-.06.73-.132.73-.135 0-.187-.708-.066-.898.036-.058-.172-.372-.463-.7zM.898 3.543c.097.003.164.108.164.278 0 .465-.158.533-.385.166-.084-.136-.031-.321.117-.413a.188.188 0 0 1 .104-.032zm.6.502c.039-.013.065.073.073.254.011.255.11.45.22.432.108-.017 2.103-.009 4.43.019 2.704.031 4.043.134 3.705.283-.291.128-2.22.227-4.288.22-3.826-.013-4.575-.204-4.225-1.077.033-.08.061-.123.085-.131z",fill:"#f291bd"}),(0,r.jsx)("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 1.076.04 1.076.185 0 .17 1.807.09 5.765.09 3.85 0 6.034.154 6.136-.011.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm1.1.53H15.11l.65.649c.639.64.9 1.996.384 1.996-.146 0-.265-.178-.265-.395 0-.217-.26-.693-.577-1.058l-.576-.664H8.873c-6.265 0-6.941.117-7.496 1.293-.44.931-.4 1.181.298 1.836.575.54.865.575 4.762.575 2.59 0 4.15.1 4.15.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.924-.986-.797-3.218.34-4.26z",fill:"#a3809c"}),(0,r.jsx)("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.826.65 1.043.65.216 0 .386.232.542.241.535.03.73.005 1.13-.049.4-.055 3.114.04 6.344-.023l5.872-.115.676-.677c.577-.577.676-.912.676-2.288 0-1.358-.101-1.713-.649-2.26l-.65-.65H8.472zm.766.53h13.04l.65.649c.742.742.92 2.157.239 1.895-.234-.09-.342-.045-.25.102.088.143-.139.558-.504.923-.591.591-.881.663-2.66.663-1.154 0-1.997.112-1.997.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.863-.92-.714-3.018.251-4.05zm12.487.528c-.013.014.067.121.231.331.2.255.408.463.463.463.218 0 .078-.217-.363-.563-.21-.164-.317-.244-.33-.23zM1.184 3.44c-.117 0 .066.297.408.661.341.364.714.661.827.661.113 0 .39.053.054-.311-.337-.364-1.171-1.011-1.289-1.011zM6.09 4.528c-.6 0-1.2.013-1.654.039-.91.051-.165.094 1.654.094s2.563-.043 1.653-.094a31.07 31.07 0 0 0-1.653-.04z",fill:"#a8769a"}),(0,r.jsx)("path",{d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.143.008.728-.64c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.885.886.815 1.583-.269 2.666-.884.884-.703.965-2.624.965-1.153 0-2.28.064-2.28.217 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.845-.902-.819-2.572.054-3.444z",fill:"#2f99a1"}),(0,r.jsx)("path",{d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.016.103.855-.735c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.477.478.648.935.648 1.731 0 .797-.17 1.254-.649 1.732l-.65.65-6.692-.016-6.693-.017-.595-.635c-.845-.904-.755-2.749.118-3.62z",fill:"#5b3b6a"}),(0,r.jsx)("path",{d:"M16.673 1.587c-.12-.084-.265.542-.265 1.203 0 .924-.15 1.353-.649 1.852l-.65.65-13.228-.19-.698-.46c-.356-.357-.506-.943-.506-1.17 0-.224-.262-.297-.407-.297-.533 0-.005 1.371.833 2.25l.622.359 6.69.019 6.689.018.917-.917c.777-.777.917-1.101.917-2.117 0-.66-.034-1.037-.153-1.12z"}),(0,r.jsx)("text",{style:{lineHeight:"1.25"},x:"2.765",y:"2.203",fontWeight:"400",fontSize:"5.333",fontFamily:"sans-serif",letterSpacing:"0",wordSpacing:"0"}),(0,r.jsx)("g",Object.assign({"aria-label":"reset",style:{lineHeight:1.25},fontWeight:"400",fontSize:"4.667",fontFamily:"Arial Rounded MT Bold",letterSpacing:"0",wordSpacing:"0",fill:"#5b3b6a"},{children:(0,r.jsx)("path",{d:"M3.417 3.587v.52c0 .125-.03.22-.088.284a.298.298 0 0 1-.226.093.285.285 0 0 1-.221-.095c-.058-.064-.087-.158-.087-.283V2.374c0-.28.101-.419.303-.419.104 0 .178.033.224.098a.54.54 0 0 1 .075.29c.074-.128.15-.225.228-.29a.478.478 0 0 1 .314-.098c.13 0 .258.033.38.098.124.065.185.152.185.26a.249.249 0 0 1-.08.19.242.242 0 0 1-.168.072.815.815 0 0 1-.166-.041.74.74 0 0 0-.23-.043.335.335 0 0 0-.224.073c-.058.047-.055.165-.087.26-.032.093-.101.158-.113.289-.013.129-.019.287-.019.474zM6.464 3.372H5.247c.002.142.03.266.084.374.057.108.13.19.221.244a.59.59 0 0 0 .306.082c.074 0 .094-.04.155-.057.062-.018.138-.093.196-.13.058-.037.11-.046.16-.088.048-.043.143-.053.22-.126a.204.204 0 0 1 .137-.041c.064 0 .115.017.155.052.04.035.06.085.06.149a.41.41 0 0 1-.067.198.798.798 0 0 1-.2.216c-.089.069-.2.126-.335.171a1.432 1.432 0 0 1-.463.068c-.4 0-.758-.05-.98-.278-.221-.228-.285-.6-.285-.99 0-.185.028-.355.082-.511.055-.158.135-.293.24-.406.105-.112.234-.198.387-.257.153-.061.324-.091.51-.091.244 0 .452.051.625.155.175.101.305.234.392.396.086.163.13.328.13.497 0 .156-.045.258-.135.305a.85.85 0 0 1-.378.068zM5.247 3.02l1.049-.016c-.016-.212.006-.355-.094-.46a.51.51 0 0 0-.392-.16.5.5 0 0 0-.383.162c-.099.107-.159.265-.18.474zM9.506 3.671a.768.768 0 0 1-.125.442.776.776 0 0 1-.372.278c-.162.062-.36.093-.595.093-.223 0-.414-.034-.574-.102a.841.841 0 0 1-.353-.255.521.521 0 0 1-.114-.31.25.25 0 0 1 .257-.248c.066 0 .116.015.151.047a.524.524 0 0 1 .1.135c.064.11.076.146.165.2.266-.033.433.05.587.05.124 0 .067.053.146-.002.08-.056.12-.12.12-.191 0-.11-.041-.19-.125-.24a1.515 1.515 0 0 0-.407-.143 3.538 3.538 0 0 1-.524-.166.873.873 0 0 1-.322-.233.53.53 0 0 1-.12-.353c0-.125.037-.242.111-.353a.76.76 0 0 1 .328-.265c.146-.066.322-.1.527-.1.16 0 .305.017.433.05.129.034.236.079.32.135a.645.645 0 0 1 .197.187.361.361 0 0 1 .068.2.23.23 0 0 1-.073.176c-.047.045-.114.068-.203.068a.254.254 0 0 1-.164-.055 1.116 1.116 0 0 1-.152-.164.562.562 0 0 0-.167-.146.524.524 0 0 0-.26-.054.503.503 0 0 0-.28.073c-.074.047-.111.106-.111.177 0 .066.027.12.082.162.054.041.192.06.284.087.093.027.157.076.32.116.192.047.35.103.471.169a.767.767 0 0 1 .278.232c.064.088.096.19.096.303zM11.773 3.372l-1.121.064c.001.141-.066.202-.011.31.056.108.13.19.22.244a.59.59 0 0 0 .306.082.764.764 0 0 0 .203-.025.71.71 0 0 0 .18-.082c.058-.038.11-.078.16-.12l.189-.174a.204.204 0 0 1 .136-.041c.064 0 .116.017.155.052.04.035.06.085.06.149a.41.41 0 0 1-.067.198.797.797 0 0 1-.2.216c-.088.069-.2.126-.335.171a1.432 1.432 0 0 1-.463.068c-.4 0-.71-.113-.932-.341-.221-.228-.332-.537-.332-.928 0-.184.027-.354.082-.51.054-.158.134-.293.239-.406.105-.112.234-.198.387-.257.154-.061.324-.091.51-.091.244 0 .452.051.625.155.175.101.305.234.392.396.087.163.13.328.13.497 0 .156-.045.258-.135.305a.85.85 0 0 1-.378.068zm-1.217-.353h1.128c-.015-.212-.073-.371-.173-.476-.099-.106-.182-.064-.344-.064-.155 0-.267.006-.367.114-.099.106-.222.217-.244.426zM12.842 2.01h.068v-.374c0-.1.003-.178.007-.235a.362.362 0 0 1 .046-.148.272.272 0 0 1 .104-.102.307.307 0 0 1 .367.048c.043.04.07.088.08.145.012.057-.006.36.002.464l.016.202h.228c.088 0 .155.021.2.064.048.04.071.094.071.16 0 .083-.033.141-.1.175-.065.033-.208-.048-.283.05l-.108.143c-.082.381 0 .762 0 1.144 0 .097-.005.03.001.082a.245.245 0 0 0 .055.128c.03.032.08.048.146.048a.82.82 0 0 0 .148-.019.729.729 0 0 1 .146-.02c.05 0 .095.02.134.061.041.04.062.09.062.149 0 .1-.055.177-.164.23-.11.053-.267.08-.472.08-.194 0-.342-.033-.442-.099a.46.46 0 0 1-.198-.27c-.03-.116-.101-.27-.093-.463.015-.398-.12-.343.047-1.194h-.082c-.09 0-.158-.022-.205-.064a.209.209 0 0 1-.07-.162c0-.065.024-.118.072-.16a.326.326 0 0 1 .217-.063z"})}))]})),(0,r.jsx)("rect",{className:"controller-button-overlay",width:"100%",height:"100%",fill:"black",fillOpacity:"0",rx:"10",ry:"10"})]})),s=(0,r.jsxs)("svg",Object.assign({visibility:"visible",width:"70px",height:"26.25px",style:{transform:`scale(${t})`,transformOrigin:"0 0",position:"absolute",left:this.scalePixel(192.75),top:this.scalePixel(284)}},{children:[(0,r.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16.937 6.35"},{children:[(0,r.jsx)("path",{fill:"#f290c1",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .409.119.409.264 0 .17 2.293.265 6.35.265 4.057 0 6.35-.096 6.35-.265 0-.145.184-.264.41-.264.224 0 .7-.293 1.057-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472z"}),(0,r.jsx)("path",{fill:"#f291bd",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .409.119.409.264 0 .17 2.244.265 6.202.265 3.85 0 6.264-.1 6.366-.265.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm13.915.983l.595.366c.385.237.595.623.595 1.096 0 .401-.06.73-.132.73-.135 0-.187-.708-.066-.898.036-.058-.172-.372-.463-.7zM.898 3.543c.097.003.164.108.164.278 0 .465-.158.533-.385.166-.084-.136-.031-.321.117-.413a.188.188 0 0 1 .104-.032zm.6.502c.039-.013.065.073.073.254.011.255.11.45.22.432.108-.017 2.103-.009 4.43.019 2.704.031 4.043.134 3.705.283-.291.128-2.22.227-4.288.22-3.826-.013-4.575-.204-4.225-1.077.033-.08.061-.123.085-.131z"}),(0,r.jsx)("path",{fill:"#a3809c",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .409.119.409.264 0 .17 2.244.265 6.202.265 3.85 0 6.264-.1 6.366-.265.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm1.1.53H15.11l.65.649c.639.64.9 1.996.384 1.996-.146 0-.265-.178-.265-.395 0-.217-.26-.693-.577-1.058l-.576-.664H8.873c-6.265 0-6.941.117-7.496 1.293-.44.931-.4 1.181.298 1.836.575.54.865.575 4.762.575 2.59 0 4.15.1 4.15.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.924-.986-.797-2.193.34-3.236z"}),(0,r.jsx)("path",{fill:"#a8769a",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.826.65 1.043.65.216 0 .46.108.542.241.082.133.476.196.876.142.4-.055 3.368-.151 6.598-.214l5.872-.115.676-.677c.577-.577.676-.912.676-2.288 0-1.358-.101-1.713-.649-2.26l-.65-.65H8.472zm.766.53h13.04l.65.649c.742.742.92 2.157.239 1.895-.234-.09-.342-.045-.25.102.088.143-.139.558-.504.923-.591.591-.881.663-2.66.663-1.154 0-1.997.112-1.997.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.863-.92-.793-2.239.172-3.272zm12.487.528c-.013.014.067.121.231.331.2.255.408.463.463.463.218 0 .078-.217-.363-.563-.21-.164-.317-.244-.33-.23zM1.184 3.44c-.117 0 .066.297.408.661.341.364.714.661.827.661.113 0-.07-.297-.407-.661-.337-.364-.71-.661-.828-.661zM6.09 4.528c-.6 0-1.2.013-1.654.039-.91.051-.165.094 1.654.094s2.563-.043 1.653-.094a31.07 31.07 0 0 0-1.653-.04z"}),(0,r.jsx)("path",{fill:"#2f99a1",d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.143.008.728-.64c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.885.886.815 1.583-.269 2.666-.884.884-.989.917-2.91.917-1.153 0-1.994.112-1.994.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.845-.902-.819-2.572.054-3.444z"}),(0,r.jsx)("path",{fill:"#5b3b6a",d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.143.008.728-.64c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.477.478.648.935.648 1.731 0 .797-.17 1.254-.649 1.732l-.65.65-6.692-.016-6.693-.017-.595-.635C.284 3.72.31 2.05 1.183 1.179z"}),(0,r.jsx)("path",{d:"M16.673 1.587c-.146 0-.265.542-.265 1.203 0 .924-.15 1.353-.649 1.852l-.65.65H1.833l-.65-.65C.827 4.285.534 3.81.534 3.584c0-.225-.119-.409-.264-.409-.533 0-.243.831.595 1.709l.86.9 6.69.019 6.689.018.917-.917c.777-.777.917-1.101.917-2.117 0-.66-.119-1.2-.264-1.2z"}),(0,r.jsx)("path",{fill:"#5b3b6a",d:"M3.773 1.723c-.1.007-.2.056-.304.175-.243.263-.34-.344-.645-.087-.219.159-.07.434-.108.658v1.597h.56c.051-.533-.12-1.11.123-1.61.36-.45 1.038.15.82.609.04.378-.212 1.192.456 1.001h.105c.056-.535-.13-1.11.133-1.612.335-.39.855.064.83.478.034.347-.282.99.169 1.135.545.15.278-.472.348-.78-.008-.428.044-.943-.287-1.27-.348-.327-.983-.361-1.302.025-.313.015-.599-.34-.898-.319zm4.12.001c-.599.022-1.183.496-1.174 1.125-.051.62.434 1.27 1.082 1.27.367.008.959.003 1.073-.427-.266-.54-.722.142-1.15-.112-.45-.06-.384-.634.083-.451.419.035.842-.01 1.263.007.127-.605-.26-1.348-.923-1.392a1.13 1.13 0 0 0-.255-.02zm1.927.028c-.04-.012-.09-.002-.154.047-.34.104-.115.567-.174.837v1.431h.555c.06-.543-.157-1.163.19-1.642.384-.399 1.11.097.933.6.106.316-.215.898.167 1.042h.393c-.056-.651.16-1.385-.237-1.963-.328-.396-1.002-.468-1.362-.076-.147.001-.19-.238-.311-.276zm2.315.054c.05.645-.141 1.359.213 1.944.299.387.96.513 1.314.132.25-.084.356.443.641.157.17-.234.03-.55.07-.826V1.806h-.555c-.06.543.156 1.163-.19 1.642-.385.398-1.11-.097-.933-.601-.106-.318.256-1.05-.27-1.041h-.29zm-4.228.424c.268-.015.542.11.618.389-.382.126-.79.025-1.183.054h-.028c.06-.275.324-.429.593-.443z",fontFamily:"Nexa Bold",fontSize:"15.875",fontWeight:"400",letterSpacing:"0",style:{lineHeight:"125%"},wordSpacing:"0"})]})),(0,r.jsx)("rect",{className:"controller-button-overlay",width:"100%",height:"100%",fill:"black",fillOpacity:"0",rx:"10",ry:"10"})]}));return(0,r.jsxs)("div",Object.assign({className:"simulator-display",id:"wrap",style:{transform:`scale(${t})`,transformOrigin:"0 0",width:this.scalePixel(368),height:this.scalePixel(432.938)}},{children:[(0,r.jsx)("div",{className:"debug-stats",id:"debug-stats"}),(0,r.jsx)("div",{className:"screen-back",id:"screen-back"}),(0,r.jsxs)("div",Object.assign({id:"screen"},{children:[(0,r.jsx)("div",Object.assign({id:"paint-surface-container",style:{top:this.scalePixel(12),left:this.scalePixel(12)}},{children:(0,r.jsx)("canvas",{id:"paint-surface",width:"160",height:"120",className:"borders",style:{transform:`scale(${t})`,transformOrigin:"0 0",height:229,width:312,left:this.scalePixel(28),top:this.scalePixel(20),clipPath:"polygon(0px 5.33333px, 5.33333px 0px, 338.667px/1.2) 0px, 344px 5.33333px, 344px 256.667px, 338.667px 262px, 5.33333px 262px, 0px 256.667px)"}})})),(0,r.jsxs)("div",Object.assign({id:"controls",className:"no-focus"},{children:[n,i,o,s]})),e]})),(0,r.jsx)("div",{id:"instructions"})]}))}}n.SimulatorDisplay=o},{"./data":136,"react/jsx-runtime":367}],197:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.tryInit=void 0;var r=pxt.Cloud,i=pxt.Util;let o,s={};function a(e){let t=i.lookup(s,e.result.socket);t?t.onOOB(e):console.error("Dropping data for "+e.result.socket)}n.tryInit=function(){pxt.BrowserUtils.isLocalHost()&&r.localToken&&(pxt.mkTCPSocket=(e,t)=>new l(e,t))};class l{constructor(e,t){this.host=e,this.port=t,this.onData=e=>{},this.onError=e=>{}}onOOB(e){if("data"==e.op){const t=i.stringToUint8Array(atob(e.result.data));this.onData(t)}else"close"==e.op&&(this.sockId=null,delete s[e.result.socket])}error(e){let t=new Error(i.lf("TCP error on socket {0}:{1} ({2})",this.host,this.port,e));throw this.onError(t),t}disconnectAsync(){return this.sockId?o.opAsync("close",{socket:this.sockId}).then((()=>{this.sockId=null})):Promise.resolve()}sendPacketAsync(e){return this.sockId||i.userError("Not connected"),o.opAsync("send",{socket:this.sockId,data:i.toHex(e),encoding:"hex"})}sendSerialAsync(e,t){return Promise.reject(new Error("No serial on socket"))}connectAsync(){return o||(pxt.BrowserUtils.isLocalHost()&&r.localToken||i.userError(lf("TCP sockets not available here")),pxt.debug("initializing tcp pipe"),o=pxt.worker.makeWebSocket(`ws://localhost:${pxt.options.wsPort}/${r.localToken}/tcp`,a)),this.sockId?Promise.resolve():o.opAsync("open",{host:this.host,port:this.port}).then((e=>{e.socket||this.error(e.errorMessage),this.sockId=e.socket,s[this.sockId]=this}))}}},{}],198:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.initTutorial=n.click=n.tutorialNext=n.tutorialStep=void 0;const r=e("./audio"),i={};function o(e){const t=(pxt.appTarget.appTheme.sounds||{})[e];if(pxt.options.light||!t)return Promise.resolve(void 0);let n=i[t];if(n)return Promise.resolve(n);const o=pxt.webConfig.commitCdnUrl+"sounds/"+t;return pxt.Util.requestAsync({url:o,headers:{Accept:"audio/"+t.slice(-3)},responseArrayBuffer:!0}).then((e=>r.loadAsync(e.buffer))).then((e=>i[t]=e))}function s(e){pxt.options.light||o(e).then((e=>e?r.play(e,.2):void 0))}n.tutorialStep=function(){s("tutorialStep")},n.tutorialNext=function(){s("tutorialNext")},n.click=function(){s("click")},n.initTutorial=function(){pxt.options.light||Promise.all([o("tutorialStep"),o("tutorialNext"),o("click")])}},{"./audio":47}],199:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Editor=void 0;const r=e("react/jsx-runtime"),i=e("./core");n.Editor=class{constructor(e){this.parent=e,this.isVisible=!1,this.changeCallback=()=>{},this.isReady=!1}setVisible(e){this.isVisible=e}simStateChanged(){}onPageVisibilityChanged(e){}acceptsFile(e){return!1}getViewState(){return{}}getCurrentSource(){return this.currSource}getStyle(e){let t={display:this.isVisible?"block":"none"};return Object.assign(t,e)}getId(){return"editor"}displayOuter(e){return(0,r.jsx)("div",Object.assign({className:"full-abs",id:this.getId(),style:this.getStyle(e)},{children:this.display()}),this.getId())}display(){return null}beforeCompile(){}prepare(){this.isReady=!0}resize(e){}snapshotState(){return null}unloadFileAsync(){return Promise.resolve()}isIncomplete(){return!1}hasHistory(){return!0}hasUndo(){return!0}hasRedo(){return!0}undo(){}redo(){}zoomIn(){}zoomOut(){}setScale(e){}closeFlyout(){}clearCaches(){}loadFileAsync(e,t){return this.currSource=e.content,this.setDiagnostics(e,this.snapshotState()),Promise.resolve()}domUpdate(){}setDiagnostics(e,t){}setViewState(e){}saveToTypeScriptAsync(e=!1){return Promise.resolve(void 0)}highlightStatement(e,t){return!1}clearHighlightedStatements(){}setHighContrast(e){}hasEditorToolbar(){return!0}filterToolbox(e){}insertBreakpoint(){}updateBreakpoints(){}getBreakpoints(){return[]}updateToolbox(){}onExceptionDetected(e){i.warningNotification(lf("Program Error: {0}",null==e?void 0:e.exceptionMessage))}validateTutorialCode(e){}}},{"./core":133,"react/jsx-runtime":367}],200:[function(e,t,n){"use strict";var r=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.PlainCheckbox=n.ProgressCircle=n.Tooltip=n.Loader=n.Dimmer=n.Modal=n.Menu=n.MenuItem=n.Icon=n.Checkbox=n.Input=n.Field=n.helpIconLink=n.Link=n.CloseButton=n.Button=n.ButtonMenuItem=n.Item=n.Select=n.ExpandableMenu=n.DropdownMenu=n.StatelessUIElement=n.UIElement=n.genericContent=n.cx=n.appElement=void 0;const i=e("react/jsx-runtime"),o=e("react"),s=e("react-dom"),a=e("react-modal"),l=e("react-tooltip"),c=e("./data"),u=e("./core"),d=e("./auth"),p=e("./util");function h(e){return e.filter((e=>!!e&&""!=e.trim())).join(" ")}function f(e,t,n=!1){return`${e} ${n?"":t.icon&&t.text?"icon icon-and-text":t.icon?"icon":""} ${t.inverted?"inverted":""} ${t.className||""}`}function g(e){let t=[e.icon?(0,i.jsx)(n.Icon,{icon:e.icon+(e.text?" icon-and-text ":"")+(e.iconClass?" "+e.iconClass:"")},"iconkey"):null,e.text?(0,i.jsx)("span",Object.assign({className:"ui text"+(e.textClass?" "+e.textClass:"")},{children:e.text}),"textkey"):null];return e.icon&&e.rightIcon&&(t=t.reverse()),t}n.appElement=document.getElementById("content"),n.cx=h,n.genericContent=g;class m extends c.Component{}n.UIElement=m;class v extends c.PureComponent{}n.StatelessUIElement=v;n.DropdownMenu=class extends m{constructor(){super(...arguments),this.navigateToNextElement=(e,t,n)=>{const r=this.refs.dropdown,i=u.keyCodeFromEvent(e),o=e.currentTarget;40===i?(e.preventDefault(),e.stopPropagation(),n&&this.focus(n)):38===i?(e.preventDefault(),e.stopPropagation(),t?this.focus(t):(r.focus(),this.setState({open:!1}))):i!==u.SPACE_KEY&&i!==u.ENTER_KEY||(e.preventDefault(),e.stopPropagation(),o.click())},this.closeOnEscape=e=>{u.keyCodeFromEvent(e)===u.ESC_KEY&&(e.preventDefault(),this.refs.dropdown.focus(),this.isMouseDown=!0,this.hide())},this.handleClick=e=>{this.props.onClick&&!this.props.onClick()||this.toggle(),e.stopPropagation()},this.handleClose=()=>{this.isMouseDown=!1;const e=document.activeElement===this.refs.dropdown;this.setState({focus:e})},this.handleMouseDown=e=>{this.isMouseDown=!0,document.addEventListener(pxsim.pointerEvents.up,this.handleDocumentMouseUp)},this.handleDocumentMouseUp=e=>{this.isMouseDown=!1,document.removeEventListener(pxsim.pointerEvents.up,this.handleDocumentMouseUp)},this.handleFocus=e=>{const{focus:t}=this.state;t||this.setState({focus:!0})},this.handleBlur=e=>{this.isMouseDown||setTimeout((()=>{let e=this.isChildFocused();this.setState({focus:e})}),1)},this.captureMouseEvent=e=>{e.stopPropagation()},this.handleKeyDown=e=>{const t=u.keyCodeFromEvent(e);40===t?(e.preventDefault(),this.focusFirst=!0,this.show()):t!==u.SPACE_KEY&&t!==u.ENTER_KEY||(e.preventDefault(),this.toggle())}}show(){this.setState({open:!0,focus:!0})}hide(){this.setState({open:!1})}toggle(){this.state.open?this.hide():this.show()}focus(e){this.setActive(e),e.focus()}blur(e){this.isActive(e)&&pxt.BrowserUtils.removeClass(e,"active")}setActive(e){this.isActive(e)||pxt.BrowserUtils.addClass(e,"active")}isActive(e){return e&&pxt.BrowserUtils.containsClass(e,"active")}getChildren(){const e=this.refs.menu,t=[];for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];pxt.BrowserUtils.containsClass(r,"divider")||pxt.BrowserUtils.containsClass(r,"mobile")&&!pxt.BrowserUtils.isMobile()||t.push(r)}return t}isChildFocused(){return this.refs.menu.contains(document.activeElement)}componentDidMount(){const e=this.getChildren();for(let t=0;t<e.length;t++){const n=t>0?e[t-1]:void 0,r=e[t],i=t<e.length?e[t+1]:void 0;r.addEventListener("keydown",(e=>{this.navigateToNextElement(e,n,i)})),r.addEventListener("focus",(e=>{this.setActive(r)})),r.addEventListener("blur",(e=>{this.blur(r)})),t==e.length-1&&r.addEventListener("keydown",(e=>{const t=u.keyCodeFromEvent(e);e.shiftKey||t!==u.TAB_KEY||this.hide()}))}}componentDidUpdate(e,t){const n=this.getChildren();for(let e=0;e<n.length;e++)n[e].tabIndex=this.state.open?0:-1;if(t.open!=this.state.open&&this.state.open){const e=this.refs.dropdown,t=this.refs.menu;e.offsetLeft+t.offsetWidth>window.innerWidth&&pxt.BrowserUtils.addClass(t,"left")}!t.focus&&this.state.focus||t.focus&&!this.state.focus&&(this.isMouseDown||this.hide()),!t.open&&this.state.open?document.addEventListener("keydown",this.closeOnEscape):t.open&&!this.state.open&&(document.removeEventListener("keydown",this.closeOnEscape),this.handleClose()),this.focusFirst&&n.length>0&&(this.focus(n[0]),this.focusFirst=!1)}renderCore(){const{disabled:e,title:t,role:n,icon:r,className:o,titleContent:s,children:a,displayAbove:l,displayLeft:c,displayRight:u,dataTooltip:d}=this.props,{open:p}=this.state,f={role:n||"combobox","aria-disabled":e,"aria-haspopup":!!e,"aria-expanded":p},m={role:"menu","aria-label":lf("Dropdown menu {0}",t),"aria-hidden":!!p},v=h(["ui",p?"active visible":"","dropdown",r?"icon":"",o||"",l?"menuAbove":"",u?"menuRight":"",c?"menuLeft":""]),y=h(["menu",p?"visible transition":""]);return(0,i.jsxs)("div",Object.assign({role:"listbox",ref:"dropdown",title:t},f,{id:this.props.id,className:v,"data-tooltip":d,onMouseDown:this.handleMouseDown,onClick:this.handleClick,onKeyDown:this.handleKeyDown,onFocus:this.handleFocus,onBlur:this.handleBlur,tabIndex:0},{children:[s||g(this.props),(0,i.jsx)("div",Object.assign({ref:"menu"},m,{className:y,role:"menu",onMouseDown:this.captureMouseEvent,onClick:this.captureMouseEvent},{children:a}))]}))}};n.ExpandableMenu=class extends m{constructor(){super(...arguments),this.hide=()=>{this.setState({expanded:!1});const{onHide:e}=this.props;e&&e()},this.show=()=>{this.setState({expanded:!0});const{onShow:e}=this.props;e&&e()},this.toggleExpanded=()=>{const{expanded:e}=this.state;e?this.hide():this.show()}}render(){const{title:e,children:t}=this.props,{expanded:n}=this.state;return(0,i.jsxs)("div",Object.assign({className:"expandable-menu"},{children:[(0,i.jsx)(E,{className:"no-select menu-header",icon:"no-select chevron "+(n?"down":"right"),text:e,ariaExpanded:n,onClick:this.toggleExpanded,role:"button"}),n&&(0,i.jsx)("div",Object.assign({className:"expanded-items"},{children:t}))]}))}};n.Select=class extends m{constructor(e){super(e),this.handleOnChange=e=>{const{onChange:t}=this.props;this.setState({selected:e.target.value}),t&&t(e.target.value)};const{options:t}=e;this.state={selected:t[0]&&t[0].value+""}}render(){const{options:e,label:t,"aria-label":n}=this.props,{selected:r}=this.state;return(0,i.jsxs)("div",{children:[t&&`${t} `,(0,i.jsx)("select",Object.assign({value:r,className:"ui dropdown",onChange:this.handleOnChange,"aria-label":n},{children:e.map((e=>e&&(0,i.jsx)("option",Object.assign({"aria-selected":r===e.value,value:e.value},{children:e.display||e.value}),e.value)))}))]})}};class y extends c.Component{renderCore(){const{text:e,title:t,ariaLabel:n,ariaHidden:r}=this.props;return(0,i.jsxs)("div",Object.assign({className:f("ui item link",this.props,!0)+" "+(this.props.active?"active":""),role:this.props.role,"aria-label":n||t||e,"aria-selected":this.props.active,"aria-hidden":r,title:t||e,tabIndex:this.props.tabIndex||0,"data-value":this.props.value,onClick:this.props.onClick,onMouseDown:this.props.onMouseDown,onTouchStart:this.props.onMouseDown,onMouseUp:this.props.onMouseUp,onTouchEnd:this.props.onMouseUp,onMouseLeave:this.props.onMouseLeave,onKeyDown:this.props.onKeyDown||p.fireClickOnEnter},{children:[g(this.props),this.props.children]}),this.props.value)}}n.Item=y;n.ButtonMenuItem=class extends m{renderCore(){return(0,i.jsx)("div",Object.assign({className:f("ui item link",this.props,!0)+" "+(this.props.active?"active":""),role:this.props.role,title:this.props.title||this.props.text,tabIndex:this.props.tabIndex||0,"data-value":this.props.value,onClick:this.props.onClick,onKeyDown:this.props.onKeyDown||p.fireClickOnEnter},{children:(0,i.jsxs)("div",Object.assign({className:f("ui button",this.props)},{children:[g(this.props),this.props.children]}))}),this.props.value)}};class b extends v{renderCore(){const{labelPosition:e,color:t,size:n,disabled:r,loading:o}=this.props,s=h([t,n,r||o?"disabled":"",o?"loading":"",f("ui button",this.props)]),a=(0,i.jsxs)("button",Object.assign({className:s,id:this.props.id,role:this.props.role,title:this.props.title,tabIndex:this.props.tabIndex||0,"aria-label":this.props.ariaLabel,"aria-expanded":this.props.ariaExpanded,onClick:this.props.onClick,onKeyDown:this.props.onKeyDown,autoFocus:this.props.autoFocus},{children:[g(this.props),this.props.children]}));return this.props.tooltipId&&!pxt.BrowserUtils.isIOS()?(0,i.jsx)(j,Object.assign({id:this.props.tooltipId,content:this.props.tooltip||this.props.title,place:this.props.tooltipPlace,delayShow:this.props.tooltipDelayShow},{children:a})):a}}n.Button=b;class x extends v{renderCore(){const{onClick:e}=this.props;return(0,i.jsx)("div",Object.assign({role:"button",className:"closeIcon",tabIndex:0,onClick:e,onKeyDown:p.fireClickOnEnter,"aria-label":lf("Close")},{children:(0,i.jsx)(n.Icon,{icon:"close remove circle"})}))}}n.CloseButton=x;class E extends v{renderCore(){return(0,i.jsxs)("a",Object.assign({className:f("ui",this.props)+(this.props.loading?" loading":"")+(this.props.disabled?" disabled":""),id:this.props.id,href:this.props.href,target:this.props.target,rel:this.props.rel||(this.props.target?"noopener noreferrer":""),download:this.props.download,ref:this.props.refCallback,role:this.props.role,title:this.props.title,tabIndex:this.props.tabIndex||0,"aria-label":this.props.ariaLabel,"aria-expanded":this.props.ariaExpanded,onClick:this.props.onClick,onKeyDown:this.props.onKeyDown||p.fireClickOnEnter},{children:[g(this.props),this.props.children]}))}}n.Link=E,n.helpIconLink=function(e,t){return(0,i.jsx)(E,{className:"help-link",href:e,icon:"help circle",target:"_blank",role:"link",title:t})};class _ extends c.Component{renderCore(){return(0,i.jsxs)("div",Object.assign({className:"field"},{children:[this.props.label?(0,i.jsx)("label",Object.assign({htmlFor:this.props.ariaLabel?void 0:this.props.htmlFor},{children:this.props.label})):null,this.props.ariaLabel&&this.props.htmlFor?(0,i.jsx)("label",Object.assign({htmlFor:this.props.htmlFor,className:"accessible-hidden"},{children:this.props.ariaLabel})):"",this.props.children]}))}}n.Field=_;class w extends c.Component{constructor(e){super(e),this.state={value:e.value},this.copy=this.copy.bind(this),this.handleClick=this.handleClick.bind(this),this.handleChange=this.handleChange.bind(this),this.handleEnterPressed=this.handleEnterPressed.bind(this)}componentDidMount(){const{selectOnMount:e,autoFocus:t}=this.props;e&&t&&this.refs.inputField.select()}UNSAFE_componentWillReceiveProps(e){this.setState({value:e.value})}clearValue(){this.setState({value:void 0})}copy(){this.setState({copied:!1});const e=this.props,t=s.findDOMNode(this);if(e.lines&&1!=e.lines){const e=t.getElementsByTagName("textarea")[0];e.focus(),e.setSelectionRange(0,9999)}else{const e=t.getElementsByTagName("input")[0];e.focus(),e.setSelectionRange(0,9999)}try{const e=document.execCommand("copy");pxt.debug("copy: "+e),this.setState({copied:!!e})}catch(e){this.setState({copied:!1})}}handleClick(e){this.props.selectOnClick&&e.target.setSelectionRange(0,9999)}handleChange(e){const t=e.target.value;this.props.readOnly||this.state&&this.state.value===t||this.setState({value:t,copied:!1}),this.props.onChange&&this.props.onChange(t)}handleEnterPressed(e){if(u.keyCodeFromEvent(e)===u.ENTER_KEY){const{onEnter:t}=this.props;t&&(e.preventDefault(),t())}}renderCore(){const e=this.props,{copy:t,error:n,ariaLabel:r,id:o,label:s,inputLabel:a,lines:l,autoFocus:c,placeholder:u,readOnly:d,autoComplete:p}=e,{value:h,copied:f}=this.state,g=t&&document.queryCommandSupported("copy")?(0,i.jsx)(b,{className:`ui right labeled ${f?"green":"primary"} icon button`,text:f?lf("Copied!"):lf("Copy"),icon:"copy",onClick:this.copy}):null;return(0,i.jsxs)(_,Object.assign({ariaLabel:r,htmlFor:o,label:s},{children:[(0,i.jsxs)("div",Object.assign({className:"ui input"+(e.inputLabel?" labelled":"")+(t?" action fluid":"")+(e.disabled?" disabled":"")},{children:[a?(0,i.jsx)("div",Object.assign({className:"ui label"},{children:a})):"",l&&1!=l?(0,i.jsx)("textarea",{id:o,className:"ui input "+(e.class||"")+(a?" labelled":""),rows:l,placeholder:u,value:h||"",readOnly:!!d,onClick:this.handleClick,onChange:this.handleChange,onKeyDown:this.handleEnterPressed}):(0,i.jsx)("input",{ref:"inputField",autoFocus:c,id:o,className:e.class||"",type:e.type||"text",placeholder:u,value:h||"",readOnly:!!d,onClick:this.handleClick,onChange:this.handleChange,onKeyDown:this.handleEnterPressed,autoComplete:p?"":"off",autoCorrect:p?"":"off",autoCapitalize:p?"":"off",spellCheck:p}),g]})),n?(0,i.jsx)("div",Object.assign({className:"ui yellow message"},{children:n})):void 0]}))}}n.Input=w;class S extends c.Component{constructor(e){super(e),this.state={},this.handleChange=this.handleChange.bind(this)}handleChange(e){this.props.onChange(e.currentTarget.checked)}renderCore(){const e=this.props;return(0,i.jsx)(_,Object.assign({label:e.label},{children:(0,i.jsxs)("div",Object.assign({className:"ui toggle checkbox"},{children:[(0,i.jsx)("input",{type:"checkbox",checked:e.checked,"aria-checked":e.checked,"aria-label":e.label||e.inputLabel,onChange:this.handleChange}),e.inputLabel?(0,i.jsx)("label",{children:e.inputLabel}):void 0]}))}))}}n.Checkbox=S;n.Icon=e=>{const{icon:t,className:n,onClick:o,onKeyDown:s,children:a}=e,l=r(e,["icon","className","onClick","onKeyDown","children"]);return(0,i.jsx)("i",Object.assign({className:`icon ${t} ${n||""}`,onClick:o,onKeyDown:s||p.fireClickOnEnter,"aria-hidden":!0,role:"presentation"},l,{children:a}))};class T extends c.Component{constructor(e){super(e),this.handleClick=e=>{const{onClick:t}=this.props;t&&t(e,this.props)}}renderCore(){const{active:e,children:t,className:r,color:o,content:s,fitted:a,header:l,icon:c,link:u,name:d,onClick:f,position:g,ariaControls:m,id:v,tabIndex:y,dataTooltip:b}=this.props,x=h([o,g,e?"active":"",!0===c||c&&!d&&!s?"icon":"",l?"header":"",u||f?"link":"",a?1==a?`${a}`:`fitted ${a}`:"","item",r]);return t?(0,i.jsx)("div",Object.assign({role:"menuitem",className:x,onClick:this.handleClick},{children:t})):(0,i.jsxs)("div",Object.assign({id:v,tabIndex:null!=y?y:-1,className:x,onClick:this.handleClick,onKeyDown:p.fireClickOnEnter,role:"tab","aria-controls":m,"aria-selected":e,"aria-label":`${s||d}`,"data-tooltip":b},{children:[c?(0,i.jsx)(n.Icon,{icon:c}):void 0,s||d]}),v)}}n.MenuItem=T;class k extends c.Component{constructor(e){super(e),this.handleKeyboardNavigation=e=>{const t=u.keyCodeFromEvent(e);let n=37===t||38===t,r=39===t||40===t;if(!n&&!r)return;let i,o=this.child(".item"),s=-1,a=0;for(;-1===s&&a<o.length;)pxt.BrowserUtils.containsClass(o[a],"active")&&(s=a),a++;-1!==s&&(n&&!pxt.Util.isUserLanguageRtl()||r&&pxt.Util.isUserLanguageRtl()?i=0===s?o[o.length-1]:o[s-1]:(r&&!pxt.Util.isUserLanguageRtl()||n&&pxt.Util.isUserLanguageRtl())&&(i=s===o.length-1?o[0]:o[s+1]),void 0!==i&&(i.click(),i.focus()))}}componentDidMount(){this.child(".item").forEach(((e,t)=>{e.onkeydown=this.handleKeyboardNavigation}))}renderCore(){const{attached:e,borderless:t,children:n,className:r,color:o,compact:s,fixed:a,floated:l,fluid:c,icon:u,inverted:d,pagination:p,pointing:f,secondary:g,size:m,stackable:v,tabular:y,text:b,vertical:x}=this.props,E=h(["ui",o,m,t?"borderless":"",s?"compact":"",c?"fluid":"",d?"inverted":"",p?"pagination":"",f?"pointing":"",g?"secondary":"",v?"stackable":"",b?"text":"",x?"vertical":"",e?1==e?"attached":`${e} attached `:"",l?1==l?"floated":`${l} floated`:"",u?1==u?"icon":`${u} icon`:"",y?1==y?"tabular":`${y} tabular`:"",a?`tabular ${y}`:"",r,"menu"]);return(0,i.jsx)("div",Object.assign({className:E,role:"tablist"},{children:n}))}}n.Menu=k;class C extends c.Component{constructor(e){super(e),this.setPositionAndClassNames=()=>{const{dimmer:e}=this.props;let t;e&&(t="dimmable dimmed","blurring"===e&&(t+=" blurring"));const n={},r=this.getRef();if(r){const{height:e}=r.getBoundingClientRect(),i=-Math.round(e/2),o=e>=window.innerHeight;this.state.marginTop!==i&&(n.marginTop=i),this.state.scrolling!==o&&(n.scrolling=o),o&&(t+=" scrolling")}this.state.mountClasses!==t&&(n.mountClasses=t),Object.keys(n).length>0&&(this.setState(n),this.props.onPositionChanged&&this.props.onPositionChanged(this.props)),this.animationRequestId=requestAnimationFrame(this.setPositionAndClassNames)},this.id=ts.pxtc.Util.guidGen(),this.state={},this.onRequestClose=this.onRequestClose.bind(this),this.afterOpen=this.afterOpen.bind(this)}afterOpen(){const{modalDidOpen:e}=this.props;this.setState({scrolling:!1}),this.setPositionAndClassNames(),e&&e(this.getRef())}onClose(){cancelAnimationFrame(this.animationRequestId)}getRef(){const e=this.refs.modal;return e&&e.node&&e.node.firstChild&&e.node.firstChild.firstChild}componentWillUnmount(){cancelAnimationFrame(this.animationRequestId)}onRequestClose(){const{onClose:e}=this.props;this.onClose(),e()}renderCore(){var e,t;const o=this.props,{isOpen:s,size:l,longer:c,basic:u,className:f,onClose:g,closeIcon:m,children:v,onKeyDown:y,header:_,headerIcon:w,headerClass:S,headerActions:T,helpUrl:k,description:C,closeOnDimmerClick:j,closeOnDocumentClick:I,closeOnEscape:O,shouldCloseOnEsc:N,shouldCloseOnOverlayClick:R,shouldFocusAfterRender:P,overlayClassName:D}=o,M=r(o,["isOpen","size","longer","basic","className","onClose","closeIcon","children","onKeyDown","header","headerIcon","headerClass","headerActions","helpUrl","description","closeOnDimmerClick","closeOnDocumentClick","closeOnEscape","shouldCloseOnEsc","shouldCloseOnOverlayClick","shouldFocusAfterRender","overlayClassName"]),{marginTop:L,scrolling:B,mountClasses:F}=this.state,U="fullscreen"==l,H=U&&!!m,G=h(["ui",l,c?"longer":"",u?"basic":"",B?"scrolling":"",m?"closable":"","modal transition visible active",f]),q=h([this.getData(d.HIGHCONTRAST)?"hc":"",F]),V={labelledby:_?this.id+"title":void 0,describedby:!U&&C?this.id+"description":this.id+"desc"},z={content:{marginTop:L}};return(0,i.jsxs)(a,Object.assign({isOpen:s,ref:"modal",appElement:n.appElement,onRequestClose:this.onRequestClose,onAfterOpen:this.afterOpen,shouldReturnFocusAfterClose:!0,shouldFocusAfterRender:P,shouldCloseOnEsc:N||O,shouldCloseOnOverlayClick:R||I||j,portalClassName:q,overlayClassName:`ui page modals dimmer transition ${D} ${s?"visible active":""}`,className:G,style:z,role:"dialog",aria:V},M,{children:[_||H||k?(0,i.jsxs)("div",Object.assign({id:this.id+"title",className:"header "+(S||"")},{children:[w&&(0,i.jsx)(n.Icon,{icon:w}),(0,i.jsx)("h3",Object.assign({className:"header-title",style:{margin:`0 ${k?"-20rem":"0"} 0 ${H?"-20rem":"0"}`}},{children:_})),H?(0,i.jsx)("div",Object.assign({className:"header-close"},{children:(0,i.jsxs)(b,Object.assign({className:"back-button large",title:lf("Go back"),onClick:g,tabIndex:0,onKeyDown:p.fireClickOnEnter},{children:[(0,i.jsx)(n.Icon,{icon:"arrow left"}),(0,i.jsx)("span",Object.assign({className:"ui text landscape only"},{children:lf("Go back")}))]}))})):void 0,k?(0,i.jsx)("div",Object.assign({className:"header-help"},{children:(0,i.jsx)("a",Object.assign({className:"ui icon help-button",href:k,target:"_docs",role:"link","aria-label":lf("Help on {0} dialog",_),title:lf("Help on {0} dialog",_)},{children:(0,i.jsx)(n.Icon,{icon:"help"})}))})):void 0]})):void 0,U&&T?(0,i.jsx)("div",Object.assign({className:"header-actions"},{children:T})):void 0,!U&&C?(0,i.jsx)("label",Object.assign({id:this.id+"description",className:"accessible-hidden"},{children:C})):void 0,(0,i.jsx)("div",Object.assign({id:this.id+"desc",className:`${c?"scrolling":""} ${T?"has-actions":""} content`},{children:v})),!U&&(this.props.actions&&this.props.actions.length||this.props.buttons&&this.props.buttons.length)?(0,i.jsxs)("div",Object.assign({className:"actions"},{children:[null===(e=this.props.actions)||void 0===e?void 0:e.map(((e,t)=>(0,i.jsx)("div",Object.assign({className:"left-action"},{children:e}),`action_left_${t}`))),null===(t=this.props.buttons)||void 0===t?void 0:t.map((e=>e.url?(0,i.jsx)(E,{icon:e.icon,text:e.label,title:e.title||e.label,className:`ui button approve ${e.icon?"icon right":""} ${e.label&&!e.urlButton?"labeled":""} ${e.className||""} ${e.loading?"loading disabled":""} ${e.disabled?"disabled":""}`,href:e.url,target:e.fileName?void 0:"_blank",download:e.fileName?pxt.Util.htmlEscape(e.fileName):void 0},`action_${e.label}`):(0,i.jsx)(A,Object.assign({},e,{labelPosition:e.labelPosition}),`action_${e.label}`)))]})):void 0,!U&&m&&(0,i.jsx)(x,{onClick:g})]}))}}n.Modal=C;class A extends c.PureComponent{constructor(e){super(e),this.state={},this.handleClick=this.handleClick.bind(this)}handleClick(){!this.props.disabled&&this.props.onclick&&this.props.onclick()}renderCore(){const e=this.props;return(0,i.jsx)(b,{icon:e.icon,text:e.label,labelPosition:e.labelPosition,className:`approve ${e.icon?`icon ${e.labelPosition?e.labelPosition:"right"} labeled`:""} ${e.className||""} ${e.loading?"loading disabled":""} ${e.disabled?"disabled":""}`,onClick:this.handleClick,onKeyDown:p.fireClickOnEnter,ariaLabel:this.props.ariaLabel?this.props.ariaLabel:this.props.label,title:this.props.title})}}n.Dimmer=class extends m{render(){const e=this.props,{disabled:t,inverted:o,page:s,simple:l,closable:c,onClose:u,active:d,children:p}=e,f=r(e,["disabled","inverted","page","simple","closable","onClose","active","children"]),g=h(["ui dimmer",d?"active transition visible":"",t?"disabled":"",o?"inverted":"",s?"page":"",l?"simple":""]);return(0,i.jsx)(a,Object.assign({appElement:n.appElement,style:{content:{background:"none",border:"0"}},shouldCloseOnOverlayClick:c,onRequestClose:u,overlayClassName:g,role:"dialog"},f,{children:p}))}};n.Loader=class extends m{render(){const{active:e,children:t,disabled:n,inverted:r,size:o,className:s}=this.props,a=h(["ui loader",o,e?"active":"",n?"disabled":"",r?"inverted":"",t?"text":"",s]);return(0,i.jsx)("div",Object.assign({className:a},{children:t}))}};class j extends o.Component{constructor(e){super(e),this.state={}}render(){const e=this.props,{id:t,content:n,className:o}=e,s=r(e,["id","content","className"]);return(0,i.jsxs)("div",{children:[(0,i.jsx)("div",Object.assign({"data-tip":"tooltip","data-for":t},{children:this.props.children})),(0,i.jsx)(l,Object.assign({id:t,className:`pxt-tooltip ${o||""}`,effect:"solid"},s,{children:n}))]})}}n.Tooltip=j;class I extends o.Component{constructor(e){super(e),this.radius=100/(2*Math.PI),this.view=2*this.radius+this.props.stroke}getPathStyle(){return{strokeWidth:this.props.stroke}}render(){let e=this.props,t=this.radius;return(0,i.jsx)("div",Object.assign({className:"progresscircle"},{children:(0,i.jsxs)("svg",Object.assign({viewBox:`0 0 ${this.view} ${this.view}`,"aria-labelledby":"circletitle",role:"img"},{children:[(0,i.jsxs)("title",Object.assign({id:"circletitle"},{children:["Currently on step ",e.progress," of ",e.steps]})),(0,i.jsx)("path",{style:this.getPathStyle(),strokeDasharray:`${Math.round(100*e.progress/e.steps)}, 100`,d:`M${this.view/2} ${e.stroke/2} a ${t} ${t} 0 0 1 0 ${2*t} a ${t} ${t} 0 0 1 0 -${2*t}`})]}))}))}}n.ProgressCircle=I;class O extends c.Component{constructor(e){super(e),this.state={isChecked:this.props.isChecked},this.setCheckedBit=this.setCheckedBit.bind(this)}setCheckedBit(){let e=!this.state.isChecked;this.props.onChange(e),this.setState({isChecked:e})}renderCore(){return(0,i.jsx)(S,{inputLabel:this.props.label,checked:this.state.isChecked,onChange:this.setCheckedBit})}}n.PlainCheckbox=O},{"./auth":48,"./core":133,"./data":136,"./util":206,react:366,"react-dom":309,"react-modal":323,"react-tooltip":358,"react/jsx-runtime":367}],201:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ToolboxStyle=n.ToolboxTrashIcon=n.ToolboxSearch=n.TreeGroup=n.TreeItem=n.TreeSeparator=n.TreeRow=n.CategoryItem=n.Toolbox=n.CategoryNameID=void 0;const r=e("react/jsx-runtime"),i=e("./data"),o=e("./sui"),s=e("./core"),a=e("./coretsx");var l=pxt.Util;const c=e("./util"),u=e("../../react-common/components/extensions/DeleteConfirmationModal");var d;(d=n.CategoryNameID||(n.CategoryNameID={})).Loops="loops",d.Logic="logic",d.Variables="variables",d.Maths="Math",d.Functions="functions",d.Arrays="arrays",d.Text="text",d.Extensions="addpackage";const p="monaco";class h extends i.Component{constructor(e){super(e),this.handleRootElementRef=e=>{this.rootElement=e},this.state={categories:[],visible:!1,loading:!1,showAdvanced:!1,shouldAnimate:!pxt.shell.getToolboxAnimation()},this.setSelection=this.setSelection.bind(this),this.advancedClicked=this.advancedClicked.bind(this),this.recoverToolbox=this.recoverToolbox.bind(this),this.handleRemoveExtension=this.handleRemoveExtension.bind(this),this.deleteExtension=this.deleteExtension.bind(this),this.cancelDeleteExtension=this.cancelDeleteExtension.bind(this)}getElement(){return this.rootElement}hide(){this.setState({visible:!1})}showLoading(){this.setState({visible:!0,loading:!0})}show(){this.setState({visible:!0})}setSelectedItem(e){this.selectedItem=e}setPreviousItem(){if(this.selectedIndex>0){const e=--this.selectedIndex;let t=this.items[e];this.setSelection(t,e)}else if(this.state.showSearchBox){const e=this.refs.searchbox;e&&e.focus()}}setNextItem(){if(this.items.length-1>this.selectedIndex){const e=++this.selectedIndex;this.setSelection(this.items[e],e)}}setSearch(){const e=this.refs.searchbox;e&&e.focus()}clear(){this.clearSelection(),this.selectedIndex=0,this.selectedTreeRow=void 0}clearSelection(){this.setState({selectedItem:void 0,focusSearch:!1})}clearExpandedItem(){this.setState({expandedItem:void 0})}clearSearch(){this.setState({hasSearch:!1,searchBlocks:void 0,focusSearch:!1})}async handleRemoveExtension(e){this.setState({tryToDeleteNamespace:e})}setSelection(e,t,n){const{editorname:r,parent:i}=this.props,{nameid:o,subns:s,customClick:a}=e;pxt.tickEvent(`${r}.toolbox.click`,void 0,{interactiveConsent:!0});let l=s?o+s:o;if(this.state.selectedItem!=l||n){let n=!1;if(a&&(n=a(i)))return;n||(this.setState({selectedItem:l,expandedItem:o,focusSearch:!1}),this.selectedIndex=t,this.selectedTreeRow=e,e.advanced&&!this.state.showAdvanced&&this.showAdvanced(),a||this.showFlyout(e))}else this.clearSelection(),this.closeFlyout()}focus(){if(this.rootElement)if(this.selectedItem&&this.selectedItem.getTreeRow()){const e=this.selectedItem.props.treeRow,t=this.items.indexOf(e);this.setSelection(e,t,!0)}else this.selectFirstItem()}selectFirstItem(){this.items[0]&&this.setSelection(this.items[0],0,!0)}moveFocusToFlyout(){const{parent:e}=this.props;e.moveFocusToFlyout()}UNSAFE_componentWillReceiveProps(e){(this.props.editorname==p&&e.editorname!=p||e.editorname==p&&e.parent.parent.state.fullscreen&&this.state.shouldAnimate)&&(pxt.shell.setToolboxAnimation(),this.setState({shouldAnimate:!1}))}componentDidUpdate(e,t){t.visible==this.state.visible&&t.loading==this.state.loading&&t.showAdvanced==this.state.showAdvanced&&this.state.expandedItem==t.expandedItem||this.props.parent.resize(),this.state.hasSearch&&this.state.searchBlocks!=t.searchBlocks?this.refreshSearchItem():t.hasSearch&&!this.state.hasSearch&&"search"==this.state.selectedItem&&this.closeFlyout()}componentDidCatch(e,t){const{editorname:n}=this.props;pxt.tickEvent(`${n}.toolbox.crashed`,{error:e}),this.setState({hasError:!0})}componentWillUnmount(){this.props.editorname==p&&pxt.shell.setToolboxAnimation()}recoverToolbox(){this.setState({hasError:!1})}advancedClicked(){const{editorname:e}=this.props;pxt.tickEvent(`${e}.advanced`,void 0,{interactiveConsent:!0}),this.showAdvanced()}showAdvanced(){const{parent:e}=this.props;this.selectedItem&&this.selectedItem.props.treeRow&&this.selectedItem.props.treeRow.advanced&&(this.clear(),this.closeFlyout()),this.setState({showAdvanced:!this.state.showAdvanced})}getSearchBlocks(){const{parent:e}=this.props,{searchBlocks:t}=this.state;return t.map((e=>({name:e.qName,attributes:{blockId:e.id},builtinBlock:e.builtinBlock,builtinField:e.field})))}refreshSelection(){const{parent:e}=this.props;this.state.selectedItem&&this.selectedTreeRow&&(this.selectedTreeRow.customClick?this.selectedTreeRow.customClick(e):this.showFlyout(this.selectedTreeRow))}refreshSearchItem(){const e=b.getSearchTreeRow();this.showFlyout(e)}showFlyout(e){const{parent:t}=this.props;t.showFlyout(e)}async deleteExtension(e){this.setState({tryToDeleteNamespace:void 0}),await this.props.parent.parent.reloadHeaderAsync()}cancelDeleteExtension(){this.setState({tryToDeleteNamespace:void 0})}closeFlyout(){const{parent:e}=this.props;e.closeFlyout()}hasAdvancedCategories(){const{categories:e}=this.state;return e.some((e=>e.advanced))}getNonAdvancedCategories(){const{categories:e}=this.state;return e.filter((e=>!e.advanced))}getAdvancedCategories(){const{categories:e}=this.state;return e.filter((e=>e.advanced))}getAllCategoriesList(e){const{categories:t,hasSearch:n,expandedItem:r}=this.state,i=[];return n&&i.push(b.getSearchTreeRow()),t.forEach((t=>{i.push(t),t.subcategories&&(!e||e&&t.nameid==r)&&t.subcategories.forEach((e=>{i.push(e)}))})),i}shouldComponentUpdate(e,t){return this.state!=t}isRtl(){const{editorname:e}=this.props;return"monaco"!=e&&l.isUserLanguageRtl()}renderCore(){const{editorname:e,parent:t}=this.props,{showAdvanced:n,visible:i,loading:s,selectedItem:a,expandedItem:l,hasSearch:c,showSearchBox:d,hasError:p,tryToDeleteNamespace:h}=this.state;if(!i)return(0,r.jsx)("div",{style:{display:"none"}});const g=pxt.appTarget.appTheme,v=t.parent.state.tutorialOptions,y=!!v&&!!v.tutorial,x=!!g.topBlocks&&!y,_=y;if(s||p)return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",Object.assign({className:"blocklyTreeRoot"},{children:(0,r.jsx)("div",{className:"blocklyTreeRow",style:{opacity:0}})})),s?(0,r.jsx)("div",Object.assign({className:"ui active dimmer"},{children:(0,r.jsx)("div",{className:"ui loader indeterminate"})})):void 0,p?(0,r.jsxs)("div",Object.assign({className:"ui"},{children:[lf("Toolbox crashed.."),(0,r.jsx)(o.Button,{icon:"refresh",onClick:this.recoverToolbox,text:lf("Reload"),className:"fluid"})]})):void 0]});const w=this.hasAdvancedCategories();let S=this.getNonAdvancedCategories();const T=w?this.getAdvancedCategories():[];this.items=this.getAllCategoriesList();const k=b.getSearchTreeRow(),C={nameid:"topblocks",name:lf("{id:category}Basic"),color:pxt.toolbox.getNamespaceColor("topblocks"),icon:pxt.toolbox.getNamespaceIcon("topblocks")},A=pxt.appTarget.appTheme,j=o.cx(["pxtToolbox",A.invertedToolbox?"invertedToolbox":"",A.coloredToolbox?"coloredToolbox":""]);let I=0,O=0;const N=n?"advancedexpanded":"advancedcollapsed";return(0,r.jsxs)("div",Object.assign({ref:this.handleRootElementRef,className:j,id:`${e}EditorToolbox`},{children:[(0,r.jsx)(E,{categories:this.items}),_&&(0,r.jsx)("div",Object.assign({className:"toolbox-title"},{children:lf("Toolbox")})),d?(0,r.jsx)(b,{ref:"searchbox",parent:t,toolbox:this,editorname:e}):void 0,(0,r.jsx)("div",Object.assign({className:"blocklyTreeRoot"},{children:(0,r.jsxs)("div",Object.assign({role:"tree"},{children:[h?(0,r.jsx)(u.DeleteConfirmationModal,{ns:h,onCancelClick:this.cancelDeleteExtension,onDeleteClick:this.deleteExtension}):void 0,c?(0,r.jsx)(f,{toolbox:this,index:I++,selected:"search"==a,treeRow:k,onCategoryClick:this.setSelection},"search"):void 0,x?(0,r.jsx)(f,{toolbox:this,selected:"topblocks"==a,treeRow:C,onCategoryClick:this.setSelection},"topblocks"):void 0,S.map((e=>(0,r.jsx)(f,Object.assign({toolbox:this,index:I++,selected:a==e.nameid,childrenVisible:l==e.nameid,treeRow:e,onCategoryClick:this.setSelection,topRowIndex:O++,shouldAnimate:this.state.shouldAnimate,hasDeleteButton:e.allowDelete,onDeleteClick:this.handleRemoveExtension},{children:e.subcategories?e.subcategories.map((e=>(0,r.jsx)(f,{index:I++,toolbox:this,selected:a==e.nameid+e.subns,treeRow:e,onCategoryClick:this.setSelection},e.nameid+e.subns))):void 0}),e.nameid))),w?(0,r.jsx)(m,{},"advancedseparator"):void 0,w?(0,r.jsx)(f,{toolbox:this,treeRow:{nameid:"",name:pxt.toolbox.advancedTitle(),color:pxt.toolbox.getNamespaceColor("advanced"),icon:pxt.toolbox.getNamespaceIcon(N),advancedButtonState:N},onCategoryClick:this.advancedClicked,topRowIndex:O++}):void 0,n?T.map((e=>(0,r.jsx)(f,Object.assign({toolbox:this,index:I++,selected:a==e.nameid,childrenVisible:l==e.nameid,treeRow:e,onCategoryClick:this.setSelection},{children:e.subcategories?e.subcategories.map((e=>(0,r.jsx)(f,{toolbox:this,index:I++,selected:a==e.nameid+e.subns,treeRow:e,onCategoryClick:this.setSelection},e.nameid))):void 0}),e.nameid))):void 0]}))}))]}))}}n.Toolbox=h;class f extends i.Component{constructor(e){super(e),this.handleTreeRowRef=e=>{this.treeRowElement=e},this.state={selected:e.selected},this.handleClick=this.handleClick.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}getTreeRow(){return this.treeRowElement}UNSAFE_componentWillReceiveProps(e){const t={};null!=e.selected&&(t.selected=e.selected),Object.keys(t).length>0&&this.setState(t)}componentDidUpdate(e,t){const{toolbox:n}=this.props;this.state.selected&&(this.props.toolbox.setSelectedItem(this),n.state.focusSearch||a.dialogIsShowing()||this.focusElement())}focusElement(){this.treeRowElement.focus()}handleClick(e){const{treeRow:t,onCategoryClick:n,index:r}=this.props;n&&n(t,r),e.preventDefault(),e.stopPropagation()}handleKeyDown(e){var t,n;const{toolbox:r}=this.props,i=l.isUserLanguageRtl(),o=Blockly.getMainWorkspace(),a=o.keyboardAccessibilityMode,u=a&&(null===(n=null===(t=r.props.parent.navigationController)||void 0===t?void 0:t.navigation)||void 0===n?void 0:n.getState(o)),d=a?83:40,p=a?87:38,h=a?65:37,f=a?68:39,g=s.keyCodeFromEvent(e);a&&"toolbox"!=u?a&&"flyout"==u&&(g==h&&!i||g==f&&i)&&(this.focusElement(),e.stopPropagation()):g==d?this.nextItem():g==p?this.previousItem():g==f&&!i||g==h&&i?r.moveFocusToFlyout():27==g?r.closeFlyout():g==s.ENTER_KEY||g==s.SPACE_KEY?c.fireClickOnEnter.call(this,e):g==s.TAB_KEY||37==g||39==g||17==g||16==g||91==g||a||r.setSearch()}previousItem(){const{toolbox:e,childrenVisible:t}=this.props,n=e.props.editorname;pxt.tickEvent(`${n}.toolbox.keyboard.prev"`,void 0,{interactiveConsent:!0}),e.setPreviousItem()}nextItem(){const{toolbox:e,childrenVisible:t}=this.props,n=e.props.editorname;pxt.tickEvent(`${n}.toolbox.keyboard.next"`,void 0,{interactiveConsent:!0}),e.setNextItem()}renderCore(){const{toolbox:e,childrenVisible:t,hasDeleteButton:n}=this.props,{selected:i}=this.state;return(0,r.jsxs)(v,{children:[(0,r.jsx)(g,Object.assign({ref:this.handleTreeRowRef,isRtl:e.isRtl()},this.props,{selected:i,onClick:this.handleClick,onKeyDown:this.handleKeyDown,hasDeleteButton:n})),(0,r.jsx)(y,Object.assign({visible:t},{children:this.props.children}))]})}}n.CategoryItem=f;class g extends i.Component{constructor(e){super(e),this.baseAnimationDelay=1,this.animationDelay=.15,this.brandIcons={"":"usb","":"accessible-icon","":"adn","":"pied-piper-pp","":"steam","":"bluetooth-b","":"rebel","":"maxcdn","":"joomla","":"sellsy","":"connectdevelop","":"github-alt"},this.handleTreeRowRef=e=>{this.treeRow=e},this.state={},this.onmouseenter=this.onmouseenter.bind(this),this.onmouseleave=this.onmouseleave.bind(this),this.handleDeleteClick=this.handleDeleteClick.bind(this)}focus(){this.treeRow&&this.treeRow.focus()}getProperties(){const{treeRow:e}=this.props;return e}onmouseenter(){const e=pxt.appTarget.appTheme,t=this.getMetaColor(),n=e.blocklyOptions&&e.blocklyOptions.toolboxOptions&&e.blocklyOptions.toolboxOptions.invertedMultiplier||.3;e.invertedToolbox&&(this.treeRow.style.backgroundColor=pxt.toolbox.fadeColor(t||"#ddd",n,!1))}onmouseleave(){const e=pxt.appTarget.appTheme,t=this.getMetaColor();e.invertedToolbox&&(this.treeRow.style.backgroundColor=t||"#ddd")}getMetaColor(){const{color:e}=this.props.treeRow;return pxt.toolbox.convertColor(e)||pxt.toolbox.getNamespaceColor("default")}handleDeleteClick(e){e.stopPropagation(),this.props.onDeleteClick(this.props.treeRow.nameid)}renderCore(){const{selected:e,onClick:t,onKeyDown:n,isRtl:i,topRowIndex:o,hasDeleteButton:s,onDeleteClick:a}=this.props,{nameid:u,advancedButtonState:d,subns:p,name:h,icon:f}=this.props.treeRow,g=pxt.appTarget.appTheme,m=this.getMetaColor(),v=g.blocklyOptions&&g.blocklyOptions.toolboxOptions&&g.blocklyOptions.toolboxOptions.invertedMultiplier||.3;let y={paddingLeft:"0px"},b="blocklyTreeRow";if(g.invertedToolbox)y.backgroundColor=m||"#ddd",y.color="#fff";else{g.coloredToolbox&&(y.color=`${m}`);const e=`8px solid ${m}`;i?y.borderRight=e:y.borderLeft=e,o&&this.props.shouldAnimate&&(y.animationDelay=`${o*this.animationDelay+this.baseAnimationDelay}s`,b+=" blocklyTreeAnimate")}e&&(b+=" blocklyTreeSelected",g.invertedToolbox?y.backgroundColor=`${pxt.toolbox.fadeColor(m,v,!1)}`:y.backgroundColor=m||"#ddd",y.color="#fff");const x=`blocklyTreeIcon${p?"more":f?(u||f).toLowerCase():"Default"}`.replace(/\s/g,"");let E,_=p?pxt.toolbox.getNamespaceIcon("more"):f||pxt.toolbox.getNamespaceIcon("default");_.length>1&&(E=(0,r.jsx)("style",{children:`.blocklyTreeIcon.${x} {\n                    background-image: url("${l.pathJoin(pxt.webConfig.commitCdnUrl,encodeURI(f))}")!important;\n                    width: 30px;\n                    height: 100%;\n                    background-size: 20px !important;\n                    background-repeat: no-repeat !important;\n                    background-position: 50% 50% !important;\n                }`}),_=void 0);const w=h||l.capitalize(p||u),S=d||u,T=!p&&Object.keys(this.brandIcons).includes(f)?"brandIcon":"";return(0,r.jsxs)("div",Object.assign({role:"button",ref:this.handleTreeRowRef,className:b,style:y,tabIndex:0,"data-ns":S,"aria-label":lf("Toggle category {0}",w),"aria-expanded":e,onMouseEnter:this.onmouseenter,onMouseLeave:this.onmouseleave,onClick:t,onContextMenu:t,onKeyDown:n||c.fireClickOnEnter},{children:[(0,r.jsx)("span",{className:"blocklyTreeIcon",role:"presentation"}),E,(0,r.jsx)("span",Object.assign({style:{display:"inline-block"},className:`blocklyTreeIcon ${x} ${T}`,role:"presentation"},{children:_})),(0,r.jsx)("span",Object.assign({className:"blocklyTreeLabel"},{children:w})),s?(0,r.jsx)("i",{className:"blocklyTreeButton icon times circle",onClick:this.handleDeleteClick}):void 0]}))}}n.TreeRow=g;class m extends i.Component{renderCore(){return(0,r.jsx)(v,{children:(0,r.jsx)("div",Object.assign({className:"blocklyTreeSeparator"},{children:(0,r.jsx)("span",{style:{display:"inline-block"},role:"presentation"})}))})}}n.TreeSeparator=m;class v extends i.Component{renderCore(){const{selected:e}=this.props;return(0,r.jsx)("div",Object.assign({role:"treeitem","aria-selected":e},{children:this.props.children}))}}n.TreeItem=v;class y extends i.Component{renderCore(){const{visible:e}=this.props;return this.props.children?(0,r.jsx)("div",Object.assign({role:"tree",style:{backgroundPosition:"0px 0px",display:e?"":"none"}},{children:this.props.children})):(0,r.jsx)("div",{})}}n.TreeGroup=y;class b extends i.Component{constructor(e){super(e),this.search=l.debounce((()=>{this.searchImmediate()}),300,!1),this.state={},this.searchImmediate=this.searchImmediate.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleChange=this.handleChange.bind(this)}static getSearchTreeRow(){return{nameid:"search",name:lf("{id:category}Search"),color:pxt.toolbox.getNamespaceColor("search"),icon:pxt.toolbox.getNamespaceIcon("search")}}handleChange(){this.search()}handleKeyDown(e){const{toolbox:t}=this.props;40===("number"==typeof e.which?e.which:e.keyCode)&&t.selectFirstItem()}focus(){this.refs.searchInput.focus()}searchImmediate(){const{parent:e,toolbox:t,editorname:n}=this.props,r=this.refs.searchInput.value;let i="",o=!1;pxt.tickEvent(`${n}.search`,void 0,{interactiveConsent:!0}),e.searchAsync(r).then((e=>{i=0==e.length?lf("No search results..."):lf("{0} result matching '{1}'",e.length,r.toLowerCase()),o=""!=r;const n={};n.hasSearch=o,n.searchBlocks=e,n.focusSearch=!0,o&&(n.selectedItem="search"),t.setState(n),this.setState({searchAccessibilityLabel:i})}))}renderCore(){const{searchAccessibilityLabel:e}=this.state;return(0,r.jsx)("div",Object.assign({id:"blocklySearchArea"},{children:(0,r.jsxs)("div",Object.assign({id:"blocklySearchInput",className:"ui fluid icon input",role:"search"},{children:[(0,r.jsx)("input",{ref:"searchInput",type:"text",placeholder:lf("Search..."),onFocus:this.searchImmediate,onKeyDown:this.handleKeyDown,onChange:this.handleChange,id:"blocklySearchInputField",className:"blocklySearchInputField","aria-label":lf("Search"),autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}),(0,r.jsx)("i",{className:"search icon",role:"presentation","aria-hidden":"true"}),(0,r.jsxs)("div",Object.assign({className:"accessible-hidden",id:"blocklySearchLabel","aria-live":"polite"},{children:[" ",e," "]}))]}))}))}}n.ToolboxSearch=b;class x extends i.Component{constructor(e){super(e)}getStyle(){let e={opacity:0,display:"none"};if(this.props.flyoutOnly){let t=document.querySelector(".blocklyFlyout");t&&(e.left=t.clientWidth/2,e.transform="translateX(-45%)")}return e}renderCore(){return(0,r.jsx)("div",Object.assign({id:"blocklyTrashIcon",style:this.getStyle()},{children:(0,r.jsx)("i",{className:"trash icon","aria-hidden":"true"})}))}}n.ToolboxTrashIcon=x;class E extends i.Component{renderCore(){const{categories:e}=this.props;return(0,r.jsx)("style",{children:e.filter((e=>!!e.color)).map((e=>`span.docs.inlineblock.${e.nameid.toLowerCase()} {\n                    background-color: ${e.color};\n                    border-color: ${pxt.toolbox.fadeColor(e.color,.1,!1)};\n                }`))})}}n.ToolboxStyle=E},{"../../react-common/components/extensions/DeleteConfirmationModal":20,"./core":133,"./coretsx":134,"./data":136,"./sui":200,"./util":206,"react/jsx-runtime":367}],202:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ToolboxEditor=void 0;const r=e("./srceditor"),i=e("./compiler");class o extends r.Editor{constructor(){super(...arguments),this.extensionsMap={},this.subcategoryMap={},this.topBlocks=[]}shouldShowBlock(e,t,n){var r;const i=this.parent.state.editorState&&this.parent.state.editorState.filters;if(i){const o=i.blocks&&(i.blocks[e]||this.blockIdMap&&(null===(r=this.blockIdMap[e])||void 0===r?void 0:r.some((e=>i.blocks[e])))),s=i.namespaces&&i.namespaces[t];if(null!=o&&o==pxt.editor.FilterState.Hidden&&!n)return!1;if(null!=o)return!0;if(null!=s&&s==pxt.editor.FilterState.Hidden)return!1;if(null!=s)return!0;if(null!=i.defaultState&&i.defaultState==pxt.editor.FilterState.Hidden&&!n)return!1}return!0}shouldShowCustomCategory(e){const t=this.parent.state.editorState&&this.parent.state.editorState.filters;return!t||!("variables"!==e||t.blocks&&!t.blocks.variables_set&&!t.blocks.variables_get&&!t.blocks.variables_change||t.namespaces&&t.namespaces.variables===pxt.editor.FilterState.Disabled)||!("functions"!==e||!(!t.blocks||t.blocks.function_definition||t.blocks.function_call||t.blocks.procedures_defnoreturn||t.blocks.procedures_callnoreturn)||t.namespaces&&t.namespaces.functions===pxt.editor.FilterState.Disabled)}getSearchSubset(){if(!this.searchSubset&&this.blockInfo){this.searchSubset={};const e=this.searchSubset;let t=pxt.blocks.blockDefinitions();for(const n in t){const r=t[n];this.shouldShowBlock(n,r.category)&&(e[n]=!0)}this.blockInfo.blocks.forEach((t=>{let n=(t.attributes.blockNamespace||t.namespace).split(".")[0];t.attributes.debug&&!pxt.options.debug||t.attributes.blockHidden||t.attributes.deprecated&&null==this.parent.state.tutorialOptions||this.shouldShowBlock(t.attributes.blockId,n)&&(e[t.attributes.blockId]=!0)}))}return this.searchSubset}searchAsync(e){const t={term:e,subset:this.getSearchSubset()};return i.apiSearchAsync(t).then((e=>e)).then((t=>(pxt.debug("searching for: "+e),t)))}clearCaches(){super.clearCaches(),this.searchSubset=void 0,this.blockGroupsCache=void 0}getAllCategories(){return this.getToolboxCategories(!1).concat(this.getToolboxCategories(!0))}getToolboxCategories(e){if(!this.blockInfo)return[];let t=this;return function(e,n){return e.sort((([,e],[,t])=>(t&&t.weight||50)>=(e&&e.weight||50)?1:-1)).map((([e,r])=>{const i=t.isBuiltIn(e),o=i?t.getBuiltinCategory(e):void 0,s=t.getBlocksForCategory(e).filter((n=>t.shouldShowBlock(n.attributes.blockId,e))),a=t.extensionsMap[e],l=o&&o.customClick;let c;if((r.subcategories&&r.subcategories.length||t.subcategoryMap[e])&&(c=function(e,n,r){return n.map((n=>{const i=e[0],o=e[1],s=t.getBlocksForCategory(i,n).filter((e=>t.shouldShowBlock(e.attributes.blockId,i)));if(!s.length)return;const a=pxt.Util.rlf(`{id:subcategory}${n}`);return{nameid:i,name:a,subns:n,color:o.color,icon:o.icon,groups:o.groups,groupIcons:o.groupIcons,groupHelp:o.groupHelp,labelLineWidth:o.labelLineWidth,blocks:s,advanced:r}})).filter((e=>!!e))}([e,r],r.subcategories||Object.keys(t.subcategoryMap[e]),n)),!(s.length||a||l||c&&c.length))return;if(l&&!t.shouldShowCustomCategory(e))return;let u={nameid:e,name:r.block?r.block:void 0,color:r.color,icon:r.icon,groups:r.groups,groupIcons:r.groupIcons,groupHelp:r.groupHelp,labelLineWidth:r.labelLineWidth,blocks:s,subcategories:c,advanced:n};return i&&(u.name=o.name,u.icon=r.icon?pxt.toolbox.getNamespaceIcon(r.icon)||r.icon:pxt.toolbox.getNamespaceIcon(e),u.groups=o.groups||r.groups,u.customClick=o.customClick),u})).filter((e=>!!e))}(this.getNamespaces().map((e=>[e,t.getNamespaceAttrs(e)])).filter((([,n])=>!(n.deprecated&&null==t.parent.state.tutorialOptions)&&(e?n.advanced:!n.advanced))),e)}moveFocusToFlyout(){}abstractShowFlyout(e){const{nameid:t,name:n,subns:r,icon:i,color:o,labelLineWidth:s,blocks:a}=e,l=this.parent.state.tutorialOptions&&!!this.parent.state.tutorialOptions.tutorial;if(!a||!a.length)return!1;pxt.appTarget.appTheme.hideFlyoutHeadings||this.showFlyoutHeadingLabel(t,n,r,i,o);let c=this.getBlockGroups(e);for(let e=0;e<c.length;++e){let n=c[e];n.blocks&&n.blocks.length&&(n.name==pxt.DEFAULT_GROUP_NAME||l||1==c.length||this.showFlyoutGroupLabel(n.name,n.icon,s,n.hasHelp?"help":""),this.showFlyoutBlocks(t,o,n.blocks))}return!0}getNamespaceAttrs(e){const t=this.blockInfo.apis.byQName[e];if(t)return t.attributes;if(this.extensionsMap[e]){const t=this.extensionsMap[e];return{weight:0,blockId:t.name,color:t.extension.color||"#7f8c8d",advanced:t.extension.advanced||!1,callingConvention:0,paramDefl:{}}}}getNamespaces(){const e=[];return this.extensions.forEach((t=>{const n=t.config,r=n.name,i=n.extension.namespace||r;this.extensionsMap[i]||(this.extensionsMap[i]=n),e.filter((e=>e==i))||e.push(r)})),e}getTopBlocks(){return this.topBlocks.sort(((e,t)=>{const n=e.attributes.topblockWeight||e.attributes.weight||50;return(t.attributes.topblockWeight||t.attributes.weight||50)>=n?1:-1}))}getBlockGroups(e){var t,n;const r=e.nameid+(e.subns||"");if(this.blockGroupsCache||(this.blockGroupsCache={}),!this.blockGroupsCache[r]){const{groups:i,groupIcons:o,groupHelp:s,blocks:a}=e;let l=i||[];a.forEach((e=>{let t=e.attributes&&e.attributes.group||pxt.DEFAULT_GROUP_NAME;l.indexOf(t)<0&&l.push(t)}));let c=[];if(l)for(let e=0;e<l.length;e++){let t=l[e],n=a.filter((e=>(e.attributes.group||pxt.DEFAULT_GROUP_NAME)==t)).sort(((e,t)=>(t.attributes.weight||50)+(t.attributes.advanced?0:1e3)>(e.attributes.weight||50)+(e.attributes.advanced?0:1e3)?1:-1));n&&n.length>0&&c.push({name:t,icon:o&&o[e]||"",hasHelp:s&&!!s[e],blocks:n})}if(null===(n=null===(t=this.parent.state)||void 0===t?void 0:t.editorState)||void 0===n?void 0:n.filters)return c;this.blockGroupsCache[r]=c}return this.blockGroupsCache[r]}}n.ToolboxEditor=o},{"./compiler":58,"./srceditor":199}],203:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WorkspaceHeader=n.TutorialCard=n.TutorialHint=n.TutorialStepCircle=n.TutorialMenuItemLink=n.TutorialMenuItem=n.TutorialMenu=n.getUsedBlocksAsync=void 0;const r=e("react/jsx-runtime"),i=e("react-dom"),o=e("./data"),s=e("./sui"),a=e("./sounds"),l=e("./core"),c=e("./marked"),u=e("./compiler"),d=e("./hinttooltip"),p=e("./editortoolbar"),h=e("./immersivereader"),f=e("./tutorialCodeValidation"),g=e("./util");function m(e,t,n,r,i=!1){const o={},s={},a={};return u.getBlocksAsync().then((t=>(pxt.blocks.initializeAndInject(t),"python"==n?u.decompilePySnippetstoXmlAsync(e):u.decompileSnippetstoXmlAsync(e)))).then((n=>{var l;if((null==n?void 0:n.length)>0){let c;for(let r=0;r<n.length;r++){const i=n[r],u=pxt.BrowserUtils.getTutorialCodeHash([e[r]]);if(!(c=pxt.blocks.loadWorkspaceXml(i,!1,{keepMetaComments:!0})))throw pxt.debug(`used blocks xml failed to load\n${i}`),new Error("blocksXml failed to load");const d=c.getAllBlocks(!1);o[u]={},a[u]={};for(let n=0;n<d.length;++n){const i=d[n];"typescript_statement"==i.type?pxt.tickEvent("tutorial.usedblocks.greyblock",{tutorial:t,code:null===(l=e[r])||void 0===l?void 0:l.substring(0,2e3)}):i.isShadow()||(o[u][i.type]||(o[u][i.type]=0),o[u][i.type]=o[u][i.type]+1,s[i.type]=1);const c=i.getCommentText();c&&/@highlight/.test(c)&&(a[u][i.type]||(a[u][i.type]=0),a[u][i.type]=a[u][i.type]+1)}}null==c||c.dispose(),pxt.options.debug&&pxt.debug(JSON.stringify(o,null,2));try{r&&!i&&r.setAsync(t,o,e,a)}catch(e){pxt.log("Unable to cache used blocks in DB")}pxt.tickEvent("tutorial.usedblocks.computed",{tutorial:t})}else if((null==e?void 0:e.length)>0)throw new Error("Failed to decompile");return{snippetBlocks:o,usedBlocks:s,highlightBlocks:a}})).catch((e=>{throw pxt.reportException(e),new Error("Failed to decompile tutorial")}))}n.getUsedBlocksAsync=function(e,t,n,r=!1){var i;if(!e)return Promise.resolve(void 0);if((null===(i=pxt.appTarget)||void 0===i?void 0:i.tutorialInfo)&&!r){const n=pxt.BrowserUtils.getTutorialCodeHash(e);if(pxt.appTarget.tutorialInfo[n])return pxt.tickEvent("tutorial.usedblocks.cached",{tutorial:t}),Promise.resolve(pxt.appTarget.tutorialInfo[n])}return pxt.BrowserUtils.tutorialInfoDbAsync().then((i=>i.getAsync(t,e).then((o=>(null==o?void 0:o.blocks)&&Object.keys(o.blocks).length>0&&!r?(pxt.tickEvent("tutorial.usedblocks.indexeddb",{tutorial:t}),(null==o?void 0:o.snippets)||m(e,t,n,i,r),Promise.resolve({snippetBlocks:o.snippets,usedBlocks:o.blocks,highlightBlocks:o.highlightBlocks})):m(e,t,n,i,r))).catch((o=>m(e,t,n,i,r))))).catch((i=>m(e,t,n,null,r)))};class v extends o.Component{constructor(e){super(e);let t=this.props.parent.state.tutorialOptions;this.hasActivities=t&&t.tutorialActivityInfo&&t.tutorialActivityInfo.length>1}renderCore(){var e;let t=this.props.parent.state.tutorialOptions;const n=null===(e=t.tutorialStepInfo)||void 0===e?void 0:e[t.tutorialStep].headerContentMd,i=pxt.appTarget.appTheme.immersiveReader;return this.hasActivities?(0,r.jsxs)("div",Object.assign({className:"menu tutorial-menu"},{children:[(0,r.jsx)(x,{parent:this.props.parent}),i&&(0,r.jsx)(h.ImmersiveReaderButton,{content:n,tutorialOptions:t})]})):t.tutorialStepInfo.length<8?(0,r.jsxs)("div",Object.assign({className:"menu tutorial-menu"},{children:[(0,r.jsx)(y,{parent:this.props.parent}),i&&(0,r.jsx)(h.ImmersiveReaderButton,{content:n,tutorialOptions:t})]})):(0,r.jsxs)("div",Object.assign({className:"menu tutorial-menu"},{children:[(0,r.jsx)(y,{parent:this.props.parent,className:"mobile hide"}),(0,r.jsx)(x,{parent:this.props.parent,className:"mobile only"}),i&&(0,r.jsx)(h.ImmersiveReaderButton,{content:n,tutorialOptions:t})]}))}}n.TutorialMenu=v;class y extends o.Component{constructor(e){super(e),this.openTutorialStep=this.openTutorialStep.bind(this)}openTutorialStep(e){let t=this.props.parent.state.tutorialOptions;pxt.tickEvent("tutorial.step",{tutorial:t.tutorial,step:e},{interactiveConsent:!0}),this.props.parent.setTutorialStep(e)}renderCore(){const{tutorialReady:e,tutorialStepInfo:t,tutorialStep:n}=this.props.parent.state.tutorialOptions,i=n;if(!e)return(0,r.jsx)("div",{});function o(e){return t.length<8||0==e||e==t.length-1||Math.abs(e-i)<2?"":"mobile hide"}return(0,r.jsx)("div",Object.assign({className:`ui item ${this.props.className}`},{children:(0,r.jsx)("div",Object.assign({className:"ui item tutorial-menuitem",role:"menubar"},{children:t.map(((t,n)=>n==i?(0,r.jsx)("span",Object.assign({className:"step-label"},{children:(0,r.jsx)(b,Object.assign({index:n,className:`ui circular label ${i==n?"blue selected":"inverted"} ${e?"":"disabled"}`,ariaLabel:lf("Tutorial step {0}. This is the current step",n+1),onClick:this.openTutorialStep},{children:n+1}))}),"tutorialStep"+n):(0,r.jsx)("span",Object.assign({className:`ui step-label ${o(n)}`,"data-tooltip":`${n+1}`,"data-inverted":"","data-position":"bottom center"},{children:(0,r.jsx)(b,{index:n,className:`ui empty circular label ${e?"":"disabled"} clear`,ariaLabel:lf("Tutorial step {0}",n+1),onClick:this.openTutorialStep})}),"tutorialStep"+n)))}))}))}}n.TutorialMenuItem=y;class b extends o.Component{constructor(){super(...arguments),this.handleClick=()=>{this.props.onClick(this.props.index)}}renderCore(){const{className:e,ariaLabel:t,index:n}=this.props;return(0,r.jsx)("a",Object.assign({className:e,role:"menuitem","aria-label":t,tabIndex:0,onClick:this.handleClick,onKeyDown:g.fireClickOnEnter},{children:this.props.children}))}}n.TutorialMenuItemLink=b;class x extends o.Component{constructor(e){super(e),this.handleNextClick=()=>{let e=this.props.parent.state.tutorialOptions;this.openTutorialStep(e.tutorialStep+1)},this.handlePrevClick=()=>{let e=this.props.parent.state.tutorialOptions;this.openTutorialStep(e.tutorialStep-1)},this.openTutorialStep=this.openTutorialStep.bind(this)}openTutorialStep(e){let t=this.props.parent.state.tutorialOptions;pxt.tickEvent("tutorial.step",{tutorial:t.tutorial,step:e},{interactiveConsent:!0}),this.props.parent.setTutorialStep(e)}renderCore(){const{tutorialReady:e,tutorialStepInfo:t,tutorialStep:n}=this.props.parent.state.tutorialOptions,i=n,o=e&&0!=i,a=e&&i!=t.length-1;return e?(0,r.jsx)("div",Object.assign({id:"tutorialsteps",className:`ui item ${this.props.className}`},{children:(0,r.jsxs)("div",Object.assign({className:"ui item",role:"menubar"},{children:[(0,r.jsx)(s.Button,{role:"button",icon:"left chevron",disabled:!o,className:"prevbutton left "+(o?"":"disabled"),text:lf("Back"),textClass:"widedesktop only",ariaLabel:lf("Go to the previous step of the tutorial."),onClick:this.handlePrevClick,onKeyDown:g.fireClickOnEnter}),(0,r.jsxs)("span",Object.assign({className:"step-label"},{children:[(0,r.jsx)(s.ProgressCircle,{progress:i+1,steps:t.length,stroke:4.5}),(0,r.jsx)("span",Object.assign({className:"ui circular label blue selected "+(e?"":"disabled"),"aria-label":lf("You are currently at tutorial step {0}.")},{children:n+1}))]}),"tutorialStep"+i),(0,r.jsx)(s.Button,{role:"button",icon:"right chevron",disabled:!a,rightIcon:!0,className:"nextbutton right "+(a?"":"disabled"),text:lf("Next"),textClass:"widedesktop only",ariaLabel:lf("Go to the next step of the tutorial."),onClick:this.handleNextClick,onKeyDown:g.fireClickOnEnter})]}))})):(0,r.jsx)("div",{})}}n.TutorialStepCircle=x;class E extends o.Component{constructor(e){super(e),this.setRef=e=>{this.elementRef=e},this.next=this.next.bind(this),this.showHint=this.showHint.bind(this),this.closeHint=this.closeHint.bind(this)}next(){const e=this.props.parent.state.tutorialOptions,{tutorialStep:t,tutorial:n}=e;this.setState({visible:!1});const r=t+1;pxt.tickEvent("tutorial.hint.next",{tutorial:n,step:r}),this.props.parent.setTutorialStep(r)}showHint(e,t){e&&Blockly.hideChaff(),this.setState({visible:e,showFullText:t})}closeHint(){this.showHint(!1,this.state.showFullText)}renderCore(){const{visible:e}=this.state,t=this.props.parent.state.tutorialOptions,{tutorialReady:n,tutorialStepInfo:i,tutorialStep:o,tutorialName:a}=t;if(!n)return(0,r.jsx)("div",{});const l=i[o],u=l.hintContentMd,d=l.contentMd,p=t.metadata.hideIteration,f=t.metadata.flyoutOnly,g=pxt.appTarget.appTheme.immersiveReader;if(l.showDialog){let n=o<i.length-1?this.next:this.closeHint,l=[];g&&l.push({className:"immersive-reader-button",onclick:()=>{h.launchImmersiveReader(d,t)},ariaLabel:lf("Launch Immersive Reader"),title:lf("Launch Immersive Reader")}),l.push({label:p&&f?lf("Start"):lf("Ok"),onclick:n,icon:"check",className:"green"});const u=this.props.parent.createModalClasses("hintdialog");return(0,r.jsx)(s.Modal,Object.assign({isOpen:e,className:u,closeIcon:!1,header:a,buttons:l,onClose:n,dimmer:!0,longer:!0,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},{children:(0,r.jsx)(c.MarkedContent,{markdown:d,parent:this.props.parent})}))}return u?(0,r.jsx)("div",Object.assign({className:"tutorialhint no-select "+(e?"":"hidden"),ref:this.setRef},{children:(0,r.jsx)(c.MarkedContent,{markdown:this.state.showFullText?d:u,unboxSnippets:!0,parent:this.props.parent})})):(0,r.jsx)("div",{})}}n.TutorialHint=E;class _ extends o.Component{constructor(e){super(e),this.closeLightboxOnEscape=e=>{27===l.keyCodeFromEvent(e)&&this.closeLightbox()},this.lastStep=-1;const t=this.props.parent.state.tutorialOptions;this.prevStep=t.tutorialStep,this.state={showSeeMore:!1,showHint:t.tutorialStepInfo[this.prevStep].showHint,showTutorialValidationMessage:!1},this.toggleHint=this.toggleHint.bind(this),this.closeHint=this.closeHint.bind(this),this.hintOnClick=this.hintOnClick.bind(this),this.closeLightbox=this.closeLightbox.bind(this),this.tutorialCardKeyDown=this.tutorialCardKeyDown.bind(this),this.okButtonKeyDown=this.okButtonKeyDown.bind(this),this.previousTutorialStep=this.previousTutorialStep.bind(this),this.nextTutorialStep=this.nextTutorialStep.bind(this),this.finishTutorial=this.finishTutorial.bind(this),this.toggleExpanded=this.toggleExpanded.bind(this),this.onMarkdownDidRender=this.onMarkdownDidRender.bind(this),this.handleResize=this.handleResize.bind(this),this.showTutorialValidationMessageOnClick=this.showTutorialValidationMessageOnClick.bind(this),this.closeTutorialValidationMessage=this.closeTutorialValidationMessage.bind(this),this.doubleClickedNextStep=this.doubleClickedNextStep.bind(this),this.validationTelemetry=this.validationTelemetry.bind(this)}previousTutorialStep(){this.showHint(!1);let e=this.props.parent.state.tutorialOptions;const t=e.tutorialStep-1;e.tutorialStep=t,pxt.tickEvent("tutorial.previous",{tutorial:e.tutorial,step:t},{interactiveConsent:!0}),this.props.parent.setTutorialStep(t),this.setState({showTutorialValidationMessage:!1})}nextTutorialStep(){this.showHint(!1);let e=this.props.parent.state.tutorialOptions;const t=e.tutorialStep+1;e.tutorialStep=t,pxt.tickEvent("tutorial.next",{tutorial:e.tutorial,step:t},{interactiveConsent:!0}),this.props.parent.setTutorialStep(t),e.metadata.tutorialCodeValidation&&this.state.showTutorialValidationMessage&&this.setState({showTutorialValidationMessage:!1})}doubleClickedNextStep(){this.validationTelemetry("next"),this.nextTutorialStep()}finishTutorial(){this.closeLightbox(),this.removeHintOnClick(),this.props.parent.completeTutorialAsync()}closeLightbox(){a.tutorialNext(),document.documentElement.removeEventListener("keydown",this.closeLightboxOnEscape),this.props.parent.hideLightbox()}UNSAFE_componentWillUpdate(){document.documentElement.addEventListener("keydown",this.closeLightboxOnEscape)}tutorialCardKeyDown(e){if(l.keyCodeFromEvent(e)==l.TAB_KEY){e.preventDefault();const t=this.refs.tutorialok;i.findDOMNode(t).focus()}}okButtonKeyDown(e){l.keyCodeFromEvent(e)==l.TAB_KEY&&(e.preventDefault(),this.refs.tutorialmessage.focus())}componentDidUpdate(e,t){const n=this.props.parent.state.tutorialOptions,r=this.refs.tutorialmessage,i=this.props.parent.state.tutorialOptions.tutorialStep;if(i!=this.lastStep){const e=`fade ${i<this.lastStep?"right":"left"} in visible transition animating`;r.style.animationDuration="500ms",this.lastStep=i,pxsim.U.addClass(r,e),pxt.Util.delay(500).then((()=>pxsim.U.removeClass(r,e)))}this.prevStep!=i&&(this.setShowSeeMore(n.autoexpandStep),this.prevStep=i,this.setState({showHint:n.tutorialStepInfo[i].showDialog||n.tutorialStepInfo[i].showHint}))}handleResize(){const e=this.props.parent.state.tutorialOptions;this.setShowSeeMore(e.autoexpandStep)}componentDidMount(){this.setShowSeeMore(this.props.parent.state.tutorialOptions.autoexpandStep),this.resizeDebouncer=pxt.Util.debounce(this.handleResize,500),window.addEventListener("resize",this.resizeDebouncer)}onMarkdownDidRender(){this.setShowSeeMore(this.props.parent.state.tutorialOptions.autoexpandStep)}componentWillUnmount(){c.MarkedContent.clearBlockSnippetCache(),this.lastStep=-1,this.props.parent.stopPokeUserActivity(),this.removeHintOnClick(),window.removeEventListener("resize",this.resizeDebouncer)}removeHintOnClick(){document.removeEventListener("click",this.closeHint)}toggleExpanded(e){e.stopPropagation(),e.preventDefault();const t=this.props.parent.state.tutorialOptions,{tutorialStepExpanded:n}=t;return this.props.parent.setTutorialInstructionsExpanded(!n),!1}hasHint(){const e=this.props.parent.state.tutorialOptions,{tutorialReady:t,tutorialStepInfo:n,tutorialStep:r}=e;return!!t&&(!!n[r].hintContentMd||n[r].showDialog)}hintOnClick(e){const t=this.props.parent.state.tutorialOptions;if(!t)return void pxt.reportError("tutorial","leaking hintonclick");e&&e.stopPropagation();const{tutorialStepInfo:n,tutorialStep:r}=t,i=n[r],o=r<n.length-1&&i&&!!i.showDialog;this.props.parent.clearUserPoke(),o||this.toggleHint()}showTutorialValidationMessageOnClick(e){this.setState({showTutorialValidationMessage:!0})}expandedHintOnClick(e){e.stopPropagation()}setShowSeeMore(e){const t=this.refs.tutorialmessage;let n=!1;t&&t.firstElementChild&&t.firstElementChild.firstElementChild&&(n=t.clientHeight<=t.firstElementChild.firstElementChild.scrollHeight)&&(this.cardHeight=t.firstElementChild.firstElementChild.scrollHeight,e&&this.props.parent.setTutorialInstructionsExpanded(!0)),this.setState({showSeeMore:n}),this.props.parent.setEditorOffset()}getCardHeight(){return this.cardHeight}getExpandedCardStyle(e){return{[e]:`calc(${this.getCardHeight()}px + 2rem)`}}toggleHint(e){this.showHint(!this.state.showHint,e)}closeHint(e){this.showHint(!1)}showHint(e,t){if(this.removeHintOnClick(),this.closeLightbox(),!this.hasHint())return;const n=this.refs.tutorialhint;if(!n)return;const r=this.props.parent.state.tutorialOptions.tutorialStep;if(e){n.elementRef&&n.elementRef.addEventListener("click",this.expandedHintOnClick),this.setState({showHint:!0}),this.props.parent.stopPokeUserActivity();const e=this.props.parent.state.tutorialOptions;e.tutorialStepInfo[e.tutorialStep].showDialog||document.addEventListener("click",this.closeHint),pxt.tickEvent("tutorial.showhint",{tutorial:e.tutorial,step:e.tutorialStep}),this.props.parent.setHintSeen(r)}else n.elementRef&&n.elementRef.removeEventListener("click",this.expandedHintOnClick),this.setState({showHint:!1}),this.props.parent.pokeUserActivity();n.showHint(e,t),e&&this.setState({showTutorialValidationMessage:!1})}closeTutorialValidationMessage(){this.setState({showTutorialValidationMessage:!1})}isCodeValidated(e){if(null!=e){for(let t=0;t<e.length;t++)if(e[t].ruleTurnOn&&!e[t].ruleStatus)return!1;return!0}return!1}areStrictRulesPresent(e){var t;return null!==(t=null==e?void 0:e.some((e=>e.ruleTurnOn&&e.isStrict)))&&void 0!==t&&t}validationTelemetry(e){const{tutorialName:t,tutorialStepInfo:n,tutorialStep:r}=this.props.parent.state.tutorialOptions,i=n[r].listOfValidationRules;if(null!=i){const n={tutorial:t,step:r};for(let t=0;t<i.length;t++)if(i[t].ruleTurnOn){n.ruleName=i[t].ruleName;let r="tutorial.validation."+e+(i[t].ruleStatus?".pass":".fail");pxt.tickEvent(r,n)}}}renderCore(){const e=this.props.parent.state.tutorialOptions,{tutorialReady:t,tutorialStepInfo:n,tutorialStep:i,tutorialStepExpanded:o,metadata:a}=e;if(!t)return(0,r.jsx)("div",{});const l=n[i],u=!!pxt.appTarget.appTheme.lockedEditor,p=i,h=n.length,m=a&&a.hideIteration,v=t&&0!=p&&!m,y=t&&p!=h-1&&!m,b=!u&&p==h-1&&!m,x=this.hasHint(),_=l.headerContentMd,w=l.showDialog,S=null!=l.listOfValidationRules,T=this.isCodeValidated(l.listOfValidationRules),k=this.state.showTutorialValidationMessage&&S,C=this.areStrictRulesPresent(l.listOfValidationRules),A=!S||!C||T&&C?this.nextTutorialStep:this.state.showTutorialValidationMessage?this.doubleClickedNextStep:this.showTutorialValidationMessageOnClick,j=lf("Press Space or Enter to show a hint."),I=lf("Click to show a hint!");let O=this.hintOnClick;(pxt.BrowserUtils.isEdge()||pxt.BrowserUtils.isIE())&&this.state.showHint&&!w&&(O=null);const N=pxt.Util.isUserLanguageRtl();return(0,r.jsxs)("div",Object.assign({id:"tutorialcard",className:`ui ${o?"tutorialExpanded":""} ${t?"tutorialReady":""} ${this.state.showSeeMore?"seemore":""}  ${this.state.showHint?"":"showTooltip"} ${x?"hasHint":""}`,style:o?this.getExpandedCardStyle("height"):null},{children:[x&&this.state.showHint&&!w&&(0,r.jsx)("div",{className:"mask",role:"region",onClick:this.closeHint}),(0,r.jsxs)("div",Object.assign({className:"ui buttons"},{children:[v?(0,r.jsx)(s.Button,{icon:(N?"right":"left")+" chevron large",className:"prevbutton left attached "+(v?"":"disabled"),text:lf("Back"),textClass:"widedesktop only",ariaLabel:lf("Go to the previous step of the tutorial."),onClick:this.previousTutorialStep,onKeyDown:g.fireClickOnEnter}):void 0,(0,r.jsxs)("div",Object.assign({className:"ui segment attached tutorialsegment"},{children:[(0,r.jsx)("div",Object.assign({ref:"tutorialmessage",className:"tutorialmessage",role:"alert"},{children:(0,r.jsx)("div",Object.assign({className:"content"},{children:!w&&(0,r.jsx)(c.MarkedContent,{className:"no-select",tabIndex:0,markdown:_,parent:this.props.parent,onDidRender:this.onMarkdownDidRender})}))})),(0,r.jsxs)("div",Object.assign({className:"avatar-container"},{children:[!w&&x&&(0,r.jsx)(s.Button,{className:"ui circular label blue hintbutton hidelightbox "+(this.props.pokeUser?"shake flash":""),icon:"lightbulb","aria-label":j,title:I,onClick:O,onKeyDown:g.fireClickOnEnter}),!w&&x&&(0,r.jsx)(d.HintTooltip,{ref:"hinttooltip",pokeUser:this.props.pokeUser,text:I,onClick:O}),(0,r.jsx)(E,{ref:"tutorialhint",parent:this.props.parent})]})),this.state.showSeeMore&&!o&&(0,r.jsx)(s.Button,{className:"fluid compact lightgrey",icon:"chevron down",tabIndex:0,text:lf("More..."),onClick:this.toggleExpanded,onKeyDown:g.fireClickOnEnter}),this.state.showSeeMore&&o&&(0,r.jsx)(s.Button,{className:"fluid compact lightgrey",icon:"chevron up",tabIndex:0,text:lf("Less..."),onClick:this.toggleExpanded,onKeyDown:g.fireClickOnEnter})]})),y?(0,r.jsx)(s.Button,{icon:(N?"left":"right")+" chevron large",className:`nextbutton right attached ${y?"":"disabled"}  ${T?"isValidated":""}`,text:lf("Next"),textClass:"widedesktop only",ariaLabel:lf("Go to the next step of the tutorial."),onClick:A,onKeyDown:g.fireClickOnEnter}):void 0,k&&(0,r.jsx)(f.ShowValidationMessage,{onYesButtonClick:this.nextTutorialStep,onNoButtonClick:this.closeTutorialValidationMessage,initialVisible:this.state.showTutorialValidationMessage,isTutorialCodeInvalid:!T,ruleComponents:l.listOfValidationRules,areStrictRulesPresent:C,validationTelemetry:this.validationTelemetry,parent:this.props.parent}),b?(0,r.jsx)(s.Button,{icon:"left checkmark",className:"orange right attached "+(t?"":"disabled"),text:lf("Finish"),ariaLabel:lf("Finish the tutorial."),onClick:this.finishTutorial,onKeyDown:g.fireClickOnEnter}):void 0]}))]}))}}n.TutorialCard=_;class w extends o.Component{constructor(e){super(e),this.flyoutWidth=0,this.flyoutTitle=lf("Toolbox"),this.workspaceWidth=0,this.handleResize=this.handleResize.bind(this),this.state={windowSize:window.innerWidth}}handleResize(){this.setState({windowSize:window.innerWidth})}componentDidMount(){window.addEventListener("resize",this.handleResize),window.addEventListener("wheel",this.handleResize),window.addEventListener("pointermove",this.handleResize)}componentWillUnmount(){window.removeEventListener("resize",this.handleResize),window.removeEventListener("wheel",this.handleResize),window.removeEventListener("pointermove",this.handleResize)}UNSAFE_componentWillUpdate(){const e=document.querySelector(".blocklyFlyout");e&&(this.flyoutWidth=e.getBoundingClientRect().width);const t=document.querySelector("#blocksArea");t&&(this.workspaceWidth=t.clientWidth-this.flyoutWidth-4)}headerStyle(){return{width:this.flyoutWidth}}workspaceStyle(){return{width:this.workspaceWidth}}renderCore(){return(0,r.jsxs)("div",Object.assign({id:"headers"},{children:[(0,r.jsx)("div",Object.assign({id:"flyoutHeader",style:this.headerStyle()},{children:(0,r.jsx)("div",Object.assign({id:"flyoutHeaderTitle",className:"no-select"},{children:this.flyoutTitle}))})),(0,r.jsx)("div",Object.assign({id:"workspaceHeader",style:this.workspaceStyle()},{children:(0,r.jsx)(p.SmallEditorToolbar,{parent:this.props.parent})}))]}))}}n.WorkspaceHeader=w},{"./compiler":58,"./core":133,"./data":136,"./editortoolbar":145,"./hinttooltip":159,"./immersivereader":163,"./marked":167,"./sounds":198,"./sui":200,"./tutorialCodeValidation":204,"./util":206,"react-dom":309,"react/jsx-runtime":367}],204:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ShowValidationMessage=void 0;const r=e("react/jsx-runtime"),i=e("./data"),o=e("./sui"),s=e("./compiler"),a=e("./util");class l extends i.Component{constructor(e){super(e),this.renderedBlockCache={},this.state={visible:this.props.initialVisible,ruleBlocks:{}}}showTutorialValidationMessage(e){this.setState({visible:e})}moveOnToNextTutorialStep(){this.props.validationTelemetry("continue"),this.props.onYesButtonClick(),this.showTutorialValidationMessage(!1)}stayOnThisTutorialStep(){this.props.validationTelemetry("edit"),this.props.onNoButtonClick()}componentDidMount(){this.props.ruleComponents.forEach((e=>{var t,n;e.blockIds&&!(null===(n=null===(t=this.state.ruleBlocks)||void 0===t?void 0:t[e.ruleName])||void 0===n?void 0:n.length)&&this.getRuleBlocksAsync(e)}))}UNSAFE_componentWillReceiveProps(e,t){e.ruleComponents.forEach((e=>{var n,r,i,o,s;const a=this.props.ruleComponents.find((t=>t.ruleName==e.ruleName));(e.blockIds&&e.blockIds.sort().toString()!=(null===(r=null===(n=null==a?void 0:a.blockIds)||void 0===n?void 0:n.sort())||void 0===r?void 0:r.toString())||(null===(i=e.blockIds)||void 0===i?void 0:i.length)!=(null===(s=null===(o=t.ruleBlocks)||void 0===o?void 0:o[e.ruleName])||void 0===s?void 0:s.length))&&this.getRuleBlocksAsync(e)}))}renderRule(e,t){var n;const i=null===(n=this.state.ruleBlocks)||void 0===n?void 0:n[e.ruleName];return i?(0,r.jsxs)("div",{children:[(0,r.jsx)("div",Object.assign({className:"codeValidationPopUpText"},{children:e.ruleTurnOn&&!e.ruleStatus?e.ruleMessage:""})),(0,r.jsx)("div",Object.assign({className:"validationRendering"},{children:i.map(((e,t)=>(0,r.jsxs)("div",{children:[" ",(0,r.jsx)("img",{src:e,alt:"block rendered"},t+e)]})))}))]}):(0,r.jsx)("p",{children:e.ruleTurnOn&&!e.ruleStatus?e.ruleMessage:""},t+e.ruleName)}getRuleBlocksAsync(e){e.blockIds&&s.getBlocksAsync().then((t=>Promise.all(e.blockIds.map((e=>{if(this.renderedBlockCache[e])return Promise.resolve(this.renderedBlockCache[e]);if(!t.blocksById[e])return Promise.resolve(void 0);const n=pxt.blocks.blockSymbol(e);if(n){const e=pxt.blocks.compileInfo(n),r=pxt.blocks.createToolboxBlock(t,n,e),i=pxt.blocks.render(`<xml xmlns="https://developers.google.com/blockly/xml">${r.outerHTML}</xml>`,{snippetMode:!0,splitSvg:!1}),o=i.getAttribute("viewBox").split(/\s+/).map((e=>parseInt(e)));return pxt.blocks.layout.blocklyToSvgAsync(i,o[0],o[1],o[2],o[3]).then((e=>e?pxt.BrowserUtils.encodeToPngAsync(e.xml,{width:e.width,height:e.height,pixelDensity:1}):Promise.resolve(void 0)))}return Promise.resolve(void 0)}))).then((t=>{this.setState({ruleBlocks:Object.assign(Object.assign({},this.state.ruleBlocks),{[e.ruleName]:t.filter((e=>!!e))})})}))))}renderCore(){const e=this.props.isTutorialCodeInvalid,t=this.props.ruleComponents,n=null!=t,i=this.props.areStrictRulesPresent;return(0,r.jsxs)("div",{children:[this.state.visible&&(0,r.jsx)("div",{className:"mask",role:"region",onClick:this.props.onNoButtonClick}),(0,r.jsxs)("div",Object.assign({className:"tutorialCodeValidation no-select "+(!e||e&&!i?"hidden":"")},{children:[(0,r.jsx)("div",{children:n&&t.map(((e,t)=>this.renderRule(e,t)))}),(0,r.jsx)("div",Object.assign({className:"codeValidationPopUpText"},{children:lf("Do you still want to continue?")})),(0,r.jsxs)("div",Object.assign({className:"moveOnButtons"},{children:[(0,r.jsxs)(o.Button,Object.assign({className:"yes",ariaLabel:lf("yes button for tutorial code validation"),onClick:this.moveOnToNextTutorialStep.bind(this),onKeyDown:a.fireClickOnEnter},{children:[" ",lf("Continue Anyway")," "]})),(0,r.jsxs)(o.Button,Object.assign({className:"no",ariaLabel:lf("no button for tutorial code validation"),onClick:this.stayOnThisTutorialStep.bind(this),onKeyDown:a.fireClickOnEnter},{children:[" ",lf("Keep Editing")," "]}))]}))]}))]})}}n.ShowValidationMessage=l},{"./compiler":58,"./data":136,"./sui":200,"./util":206,"react/jsx-runtime":367}],205:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ProfileDialog=void 0;const r=e("react/jsx-runtime"),i=e("./sui"),o=e("./core"),s=e("./auth"),a=e("./cloudsync"),l=e("../../react-common/components/profile/Profile"),c=e("../../react-common/components/util");class u extends s.Component{constructor(e){super(e),this.hide=()=>{this.setState({visible:!1})},this.handleTabClick=e=>{this.setState({location:e})},this.onLogoutClicked=()=>{pxt.tickEvent("pxt.profile.signout"),s.logoutAsync()},this.onDeleteProfileClicked=()=>{pxt.tickEvent("pxt.profile.delete"),this.deleteProfileAsync()},this.onEmailCheckClicked=e=>{this.setState({emailSelected:c.CheckboxStatus.Waiting}),s.setEmailPrefAsync(e).then((t=>{var n;t.success?(o.infoNotification(lf("Settings saved")),this.setState({emailSelected:(null===(n=t.res)||void 0===n?void 0:n.email)?c.CheckboxStatus.Selected:c.CheckboxStatus.Unselected})):(o.errorNotification(lf("Oops, something went wrong")),this.setState({emailSelected:e?c.CheckboxStatus.Unselected:c.CheckboxStatus.Selected}))}))},this.deleteProfileAsync=async()=>{this.getData(s.USER_PROFILE),await o.confirmAsync({header:lf("Delete Profile"),body:lf("Are you sure? This cannot be reversed! Your cloud-saved projects will be converted to local projects on this device."),agreeClass:"red",agreeIcon:"trash",agreeLbl:lf("Confirm"),disagreeLbl:lf("Back to safety"),disagreeIcon:"arrow right",confirmationCheckbox:lf("I understand this is permanent. No undo.")})&&(await s.deleteProfileAsync(),this.hide(),o.infoNotification(lf("Profile deleted!")))};const t=s.userPreferences();this.state={visible:e.visible,location:"my-stuff",emailSelected:(null==t?void 0:t.email)?c.CheckboxStatus.Selected:c.CheckboxStatus.Unselected},pxt.targetConfigAsync().then((e=>{this.setState({notification:e.profileNotification})}))}show(e){e=null!=e?e:"my-stuff",this.setState({visible:!0,location:e})}avatarPicUrl(){var e,t,n,r;const i=this.getUserProfile();return null!==(t=null===(e=null==i?void 0:i.idp)||void 0===e?void 0:e.pictureUrl)&&void 0!==t?t:null===(r=null===(n=null==i?void 0:i.idp)||void 0===n?void 0:n.picture)||void 0===r?void 0:r.dataUrl}renderCore(){var e;if(!this.isLoggedIn())return null;const t=this.getUserProfile(),n=this.getUserPreferences(),{emailSelected:s}=(a.githubProvider().user(),this.state);return(0,r.jsx)(i.Modal,Object.assign({isOpen:this.state.visible,className:"ui profiledialog",size:"fullscreen",onClose:this.hide,dimmer:!0,closeIcon:!0,header:null===(e=null==t?void 0:t.idp)||void 0===e?void 0:e.displayName,closeOnDimmerClick:!1,closeOnDocumentClick:!1,closeOnEscape:!1},{children:(0,r.jsx)(l.Profile,{user:{profile:t,preferences:n},signOut:this.onLogoutClicked,deleteProfile:this.onDeleteProfileClicked,notification:this.state.notification,showModalAsync:o.dialogAsync,onClickedEmail:this.onEmailCheckClicked,checkedEmail:s})}))}}n.ProfileDialog=u},{"../../react-common/components/profile/Profile":31,"../../react-common/components/util":41,"./auth":48,"./cloudsync":55,"./core":133,"./sui":200,"react/jsx-runtime":367}],206:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.fireClickOnEnter=void 0,n.fireClickOnEnter=function(e){const t="number"==typeof e.which?e.which:e.keyCode;13!==t&&32!==t||(e.preventDefault(),e.currentTarget.click())}},{}],207:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.userPrefersDownloadFlagSet=n.clearUserPrefersDownloadFlag=n.renderUnpairDialog=n.webUsbPairLegacyDialogAsync=n.webUsbPairThemedDialogAsync=n.webUsbPairDialogAsync=void 0;const r=e("react/jsx-runtime"),i=e("./core");let o=!1;async function s(e,t,n){const l=c();n||d();const p=()=>o?pxt.commands.WebUSBPairResult.UserRejected:pxt.commands.WebUSBPairResult.Failed;if(!await function(e){const t=u().connectDeviceImage,n=c(),i=t?"two":"one";return a(e,(()=>(0,r.jsxs)("div",Object.assign({className:`ui ${i} column grid padded download-dialog`},{children:[(0,r.jsx)("div",Object.assign({className:"column"},{children:(0,r.jsx)("div",Object.assign({className:"ui"},{children:(0,r.jsx)("div",Object.assign({className:"content"},{children:(0,r.jsx)("div",Object.assign({className:"description"},{children:lf("First, make sure your {0} is connected to your computer with a USB cable.",n)}))}))}))})),t&&(0,r.jsx)("div",Object.assign({className:"column"},{children:(0,r.jsx)("div",Object.assign({className:"ui"},{children:(0,r.jsx)("div",Object.assign({className:"image download-dialog-image"},{children:(0,r.jsx)("img",{alt:lf("Image connecting {0} to a computer",n),className:"ui medium rounded image",src:t})}))}))}))]}))),lf("Next"),lf("Connect your {0}",n),"downloaddialog.button.connectusb")}(t))return p();if(!await function(e){const t=c();let n,i=u().webUSBDeviceNames;i&&i.length||(i=[t]),1===i.length||i.length>3?n=lf("Pair your {0} to the computer by selecting {1} from the popup that appears after you press the 'Next' button below.",t,"{1}"):2===i.length?n=lf("Pair your {0} to the computer by selecting {1} or {2} from the popup that appears after you press the 'Next' button below.",t,"{1}","{2}"):3===i.length&&(n=lf("Pair your {0} to the computer by selecting {1}, {2}, or {3} from the popup that appears after you press the 'Next' button below.",t,"{1}","{2}","{3}"));const o=n.split(/\{\d\}/),s=[];let l=i.map((e=>(0,r.jsxs)("span",Object.assign({className:"download-device-name"},{children:["'",e,"'"]}),e)));for(;l.length;)if(s.push(o.shift()),l.length>1&&1===o.length){for(let e=0;e<l.length;e++)s.push(l[e]),e<l.length-1&&s.push(", ");l=[]}else s.push(l.shift());s.push(...o);const d=u().selectDeviceImage,p=d?"two":"one";return a(e,(()=>(0,r.jsxs)("div",Object.assign({className:`ui ${p} column grid padded download-dialog`},{children:[(0,r.jsx)("div",Object.assign({className:"column"},{children:(0,r.jsx)("div",Object.assign({className:"ui"},{children:(0,r.jsx)("div",Object.assign({className:"content"},{children:(0,r.jsx)("div",Object.assign({className:"description"},{children:s}))}))}))})),d&&(0,r.jsx)("div",Object.assign({className:"column"},{children:(0,r.jsx)("div",Object.assign({className:"ui"},{children:(0,r.jsx)("div",Object.assign({className:"image download-dialog-image"},{children:(0,r.jsx)("img",{alt:lf("Image selecting {0} from a list of web usb devices",t),className:"ui medium rounded image",src:d})}))}))}))]}))),lf("Next"),lf("Connect your {0}",t),"downloaddialog.button.pickusbdevice")}(t))return p();let h;i.showLoading("pair",lf('Select your {0} and press "Connect".',l));try{h=await e()}catch(e){i.errorNotification(lf("Pairing error: {0}",e.message)),h=!1}finally{i.hideLoading("pair")}return h?await function(e){const t=c(),n=u().connectionSuccessImage,i=n?"two":"one";return a(e,(()=>(0,r.jsxs)("div",Object.assign({className:`ui ${i} column grid padded download-dialog`},{children:[(0,r.jsx)("div",Object.assign({className:"column"},{children:(0,r.jsx)("div",Object.assign({className:"ui"},{children:(0,r.jsx)("div",Object.assign({className:"content"},{children:(0,r.jsxs)("div",Object.assign({className:"description"},{children:[lf("Your {0} is connected! Pressing 'Download' will now automatically copy your code to your {0}.",t),(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),lf("If you need to unpair this {0}, you can do so through the '' menu next to the 'Download' button",t)]}))}))}))})),n&&(0,r.jsx)("div",Object.assign({className:"column"},{children:(0,r.jsx)("div",Object.assign({className:"ui"},{children:(0,r.jsx)("div",Object.assign({className:"image download-dialog-image"},{children:(0,r.jsx)("img",{alt:lf("Image of {0}",t),className:"ui medium rounded image",src:n})}))}))}))]}))),lf("Done"),lf("Connected to {0}",t),"downloaddialog.button.webusbsuccess",void 0,"large circle check purple")}(t):await function(e,t){const n=c();let i;i=u().minimumFirmwareVersion?lf("Make sure your {0} firmware is version {1} or above.",n,u().minimumFirmwareVersion):lf("Make sure your {0} has the latest firmware.",n);const o=u().checkUSBCableImage||u().connectDeviceImage,s=u().checkFirmwareVersionImage;return a(e,(()=>(0,r.jsxs)("div",{children:[(0,r.jsx)("div",Object.assign({className:"ui content download-troubleshoot-header"},{children:lf("We couldn't find your {0}. Here's a few ways to fix that:",n)})),(0,r.jsxs)("div",Object.assign({className:"download-troubleshoot"},{children:[(0,r.jsxs)("div",Object.assign({className:"download-column"},{children:[o&&(0,r.jsx)("div",Object.assign({className:"download-row image-row"},{children:(0,r.jsx)("img",{alt:lf("Image connecting {0} to a computer",n),src:o})})),(0,r.jsx)("div",Object.assign({className:"download-row"},{children:lf("Check the USB cable connecting your {0} to your computer.",n)}))]})),(0,r.jsxs)("div",Object.assign({className:"download-column"},{children:[s&&(0,r.jsx)("div",Object.assign({className:"download-row image-row"},{children:(0,r.jsx)("img",{alt:lf("Image depicting the firmware of {0}",n),src:s})})),(0,r.jsxs)("div",Object.assign({className:"download-row"},{children:[i,(0,r.jsx)("br",{}),(0,r.jsx)("a",Object.assign({target:"_blank",href:u().firmwareHelpURL,rel:"noopener noreferrer"},{children:lf("Learn more about firmware.",n)}))]}))]}))]}))]})),lf("Try Again"),lf("Connect failed"),"downloaddialog.button.webusbfailed",u().troubleshootWebUSBHelpURL,"exclamation triangle purple",t)}(t,n)&&await s(e,t,n),h?pxt.commands.WebUSBPairResult.Success:p()}function a(e,t,n,r,s,a,l,c){let u=!1;return e({header:r,jsxd:t,hasCloseIcon:!0,hideAgree:!0,className:"downloaddialog",helpUrl:a,bigHelpButton:!!a,headerIcon:l?l+" header-inline-icon":void 0,buttons:[c?{label:lf("Download as file"),className:"secondary",onclick:()=>{pxt.tickEvent("downloaddialog.button.webusb.preferdownload"),o=!0,u=!1,i.hideDialog()}}:void 0,{label:n,className:"primary",onclick:()=>{pxt.tickEvent(s),i.hideDialog(),u=!0}}].filter((e=>!!e))}).then((()=>u))}function l(e,t){let n=!1;const o=pxt.appTarget.appTheme.boardName||lf("device"),s=pxt.appTarget.appTheme.usbDocs,a=()=>{var e,t;const i=n&&function(){var e,t,n;const r=null===(n=null===(t=null===(e=pxt.appTarget)||void 0===e?void 0:e.simulator)||void 0===t?void 0:t.boardDefinition)||void 0===n?void 0:n.id;if(r){const e=pxt.appTarget.bundledpkgs[r];if(e){const t=pxt.Package.parseAndValidConfig(e[pxt.CONFIG_NAME]);if(t)return t.firmwareUrl}}}();return(null===(e=pxt.commands)||void 0===e?void 0:e.renderUsbPairDialog)?null===(t=pxt.commands)||void 0===t?void 0:t.renderUsbPairDialog(i,n):(0,r.jsxs)("div",Object.assign({className:`ui ${i?"four":"three"} column grid stackable`},{children:[i&&(0,r.jsx)("div",Object.assign({className:"column firmware"},{children:(0,r.jsx)("div",Object.assign({className:"ui"},{children:(0,r.jsx)("div",Object.assign({className:"content"},{children:(0,r.jsxs)("div",Object.assign({className:"description"},{children:[lf("Update Firmware"),(0,r.jsx)("br",{}),(0,r.jsx)("a",Object.assign({href:i,target:"_blank",rel:"noopener noreferrer"},{children:lf("Check your firmware version and update if needed")}))]}))}))}))})),(0,r.jsx)("div",Object.assign({className:"column"},{children:(0,r.jsx)("div",Object.assign({className:"ui"},{children:(0,r.jsx)("div",Object.assign({className:"content"},{children:(0,r.jsxs)("div",Object.assign({className:"description"},{children:[(0,r.jsx)("span",Object.assign({className:"ui yellow circular label"},{children:"1"})),lf("Connect {0} to your computer with a USB cable",o),(0,r.jsx)("br",{})]}))}))}))})),(0,r.jsx)("div",Object.assign({className:"column"},{children:(0,r.jsx)("div",Object.assign({className:"ui"},{children:(0,r.jsx)("div",Object.assign({className:"content"},{children:(0,r.jsxs)("div",Object.assign({className:"description"},{children:[(0,r.jsx)("span",Object.assign({className:"ui blue circular label"},{children:"2"})),lf("Select the device in the pairing dialog")]}))}))}))})),(0,r.jsx)("div",Object.assign({className:"column"},{children:(0,r.jsx)("div",Object.assign({className:"ui"},{children:(0,r.jsx)("div",Object.assign({className:"content"},{children:(0,r.jsxs)("div",Object.assign({className:"description"},{children:[(0,r.jsx)("span",Object.assign({className:"ui blue circular label"},{children:"3"})),lf('Press "Connect"')]}))}))}))}))]}))};return new Promise(((r,o)=>{const l=c(),u=()=>({header:lf("Connect to your {0}",l),jsxd:a,hasCloseIcon:!0,hideAgree:!0,helpUrl:s,className:"downloaddialog",buttons:[{label:lf("Connect device"),icon:"usb",className:"primary",onclick:()=>{i.showLoading("pair",lf('Select your {0} and press "Connect".',l)),e().finally((()=>{i.hideLoading("pair"),i.hideDialog()})).then((e=>{e||n?r(e?pxt.commands.WebUSBPairResult.Success:pxt.commands.WebUSBPairResult.Failed):(n=!0,i.forceUpdate(),t(u()))})).catch((e=>{pxt.reportException(e),i.errorNotification(lf("Pairing error: {0}",e.message)),r(0)}))}}]});t(u())}))}function c(){return pxt.appTarget.appTheme.boardName||lf("device")}function u(){return pxt.appTarget.appTheme.downloadDialogTheme||{}}function d(){o=!1}n.webUsbPairDialogAsync=function(e,t,n){return pxt.appTarget.appTheme.downloadDialogTheme?s(e,t,n):l(e,t)},n.webUsbPairThemedDialogAsync=s,n.webUsbPairLegacyDialogAsync=l,n.renderUnpairDialog=function(){const e=c();return{header:lf("How to unpair your {0}",e),jsx:(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{children:lf("You can unpair your {0} if the WebUSB download is malfunctioning. Click on the lock icon and uncheck your device.",e)}),(0,r.jsx)("img",{className:"ui image centered medium",src:"./static/webusb/unpair.gif",alt:lf("A gif showing how to unpair the {0}",e)})]}),helpUrl:pxt.appTarget.appTheme.usbDocs&&pxt.appTarget.appTheme.usbDocs+"/webusb#unpair"}},n.clearUserPrefersDownloadFlag=d,n.userPrefersDownloadFlagSet=function(){return o}},{"./core":133,"react/jsx-runtime":367}],208:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.saveAssetAsync=n.loadedAsync=n.resetAsync=n.syncAsync=n.installByIdAsync=n.downloadFilesByIdAsync=n.importGithubAsync=n.initializeGithubRepoAsync=n.prepareConfigForGithub=n.recomputeHeaderFlagsAsync=n.exportToGithubAsync=n.mergeUpstreamAsync=n.restoreCommitAsync=n.commitAsync=n.bumpAsync=n.bumpedVersion=n.prAsync=n.hasMergeConflictMarkersAsync=n.revertAllAsync=n.pullAsync=n.hasPullAsync=n.PullStatus=n.getPublishedScriptAsync=n.fixupFileNames=n.saveScreenshotAsync=n.createDuplicateName=n.duplicateAsync=n.installAsync=n.importAsync=n.saveAsync=n.partialSaveAsync=n.forceSaveAsync=n.persistentPublishAsync=n.anonymousPublishAsync=n.getTextAsync=n.initAsync=n.getLastCloudSync=n.getHeaderLastCloudSync=n.isHeaderSessionOutdated=n.acquireHeaderSession=n.computeSessionId=n.isHeadersSessionOutdated=n.getHeader=n.restoreFromBackupAsync=n.makeBackupAsync=n.getHeaders=n.setupWorkspace=n.copyProjectToLegacyEditor=n.gitsha=n.getWorkspaceType=void 0,n.dbgHdrToString=n.fireEvent=n.isBrowserWorkspace=n.listAssetsAsync=void 0;const r=e("./db"),i=e("./core"),o=e("./data"),s=e("./browserworkspace"),a=e("./fileworkspace"),l=e("./memoryworkspace"),c=e("./iframeworkspace"),u=e("./cloudsync"),d=e("./idbworkspace"),p=e("./compiler"),h=e("./auth"),f=e("./cloud");var g=pxt.Util,m=pxt.Cloud;const v=e("crypto-js/sha1");let y,b,x=[],E=new g.PromiseQueue;function _(e){return x.find((t=>t.header.id==e||t.header.path==e))}function w(e,t="utf-8"){if("base64"==t){const t=atob(e);return v("blob "+t.length+"\0"+t)+""}return v("blob "+g.toUTF8(e).length+"\0"+e)+""}async function S(e){pxt.log(`workspace: error '${e}', switching from ${b} to memory workspace`);const t=pxt.appTarget.appTheme.disableMemoryWorkspaceWarning||y===l.provider||pxt.shell.isSandboxMode()||pxt.shell.isReadOnly()||pxt.BrowserUtils.isIFrame();pxt.tickEvent("workspace.syncerror",{ws:b,reason:e,expected:t?1:0}),t||await i.confirmAsync({header:lf("Warning! Project Auto-Save Disabled"),body:lf("We are unable to save your projects at this time. You can still manually save your project via direct download, or sharing your project."),agreeLbl:lf("Continue"),headerIcon:"warning",agreeClass:"cancel",agreeIcon:"cancel",helpUrl:"/browsers/no-auto-save",className:"auto-save-disabled-warning",hasCloseIcon:!0}),y=l.provider,b="mem"}function T(e=!1,t=!0,n){var r;j();const i=null!=n?n:null===(r=h.userProfile())||void 0===r?void 0:r.id;let o=x.map((e=>e.header)).filter((t=>(e||!t.isDeleted)&&!t.isBackup&&(!t.cloudUserId||t.cloudUserId===i)));return t&&(o=o.filter((e=>!!e.isSkillmapProject===pxt.BrowserUtils.isSkillmapEditor()))),o.sort(((e,t)=>{const n=e.cloudUserId?Math.min(e.cloudLastSyncTime,e.modificationTime):e.modificationTime;return(t.cloudUserId?Math.min(t.cloudLastSyncTime,t.modificationTime):t.modificationTime)-n})),o}function k(e){j();let t=_(e);return t&&!t.header.isDeleted?t.header:null}n.getWorkspaceType=function(){return b},n.gitsha=w,n.copyProjectToLegacyEditor=function(e,t){return ue()?s.copyProjectToLegacyEditor(e,t):Promise.reject("Copy operation only works in browser workspace")},n.setupWorkspace=function(e){switch(g.assert(!y,"workspace set twice"),pxt.log(`workspace: ${e}`),b=null!=e?e:"browser",e){case"fs":case"file":y=a.provider;break;case"mem":case"memory":y=l.provider;break;case"iframe":y=c.provider;break;case"idb":y=d.provider;break;case"browser":default:y=s.provider}},n.getHeaders=T,n.makeBackupAsync=function(e,t){let n=g.flatClone(e);return n.id=g.guidGen(),delete n._rev,delete n._id,n.isBackup=!0,H(n,t).then((()=>(e.backupRef=n.id,F(n)))).then((()=>n))},n.restoreFromBackupAsync=function(e){if(!e.backupRef||e.isDeleted)return Promise.resolve();const t=e.backupRef;return L(t).then((t=>(delete e.backupRef,F(e,t)))).then((()=>{const e=k(t);return e.isDeleted=!0,F(e)})).catch((()=>(delete e.backupRef,F(e))))},n.getHeader=k;let C="";function A(){return pxt.storage.getLocal("workspacesessionid")!=C}function j(){return A()?ce().then((()=>{})):Promise.resolve()}function I(e){return e.length+" "+e.map((e=>e.modificationTime)).reduce(((e,t)=>Math.max(e,t)),0).toString()}function O(){C=I(x.map((e=>e.header))),A()&&(pxt.storage.setLocal("workspacesessionid",C),pxt.debug(`workspace: refreshed headers session to ${C}`),o.invalidate("header:*"),o.invalidate("text:*"))}n.isHeadersSessionOutdated=A,n.computeSessionId=I;const N=pxt.Util.guidGen();function R(e){e&&pxt.storage.removeLocal("workspaceheadersessionid:"+e.id)}function P(e){if(!e)return!1;const t=pxt.storage.getLocal("workspaceheadersessionid:"+e.id);return t&&t!=N}function D(e){P(e)&&(pxt.tickEvent("workspace.conflict.header"),i.errorNotification(lf("This project is already opened elsewhere.")),pxt.debug(`saved session ID: ${pxt.storage.getLocal("workspaceheadersessionid:"+e.id)}`),pxt.debug(`our session ID: ${N}`),pxt.Util.assert(!1,"trying to access outdated session"))}function M(e){return e.cloudLastSyncTime||0}function L(e){return j().then((()=>{let t=_(e);return t?t.text?Promise.resolve(t.text):E.enqueue(e,(()=>y.getAsync(t.header).then((e=>(t.text||(t.text=V(e.text)),t.version=e.version,t.text))))):Promise.resolve(null)}))}function B(e,t,n,r){let i,o;if(r){const e=/^data:(image\/(png|gif));base64,([a-zA-Z0-9+/]+=*)$/.exec(r);e&&(i=e[3],o=e[1])}return{id:e.id,shareId:e.pubPermalink,name:e.name,target:e.target,targetVersion:e.targetVersion,description:n.description||lf("Made with  in {0}.",pxt.appTarget.title||pxt.appTarget.name),editor:e.editor,header:JSON.stringify(f.excludeLocalOnlyMetadataFields(e)),text:JSON.stringify(t),meta:{versions:pxt.appTarget.versions,blocksHeight:n.blocksHeight,blocksWidth:n.blocksWidth},thumbnailBuffer:i,thumbnailMimeType:o}}function F(e,t,n){return R(e),U(e,t,n)}async function U(e,t,n){var r;if(pxt.debug(`workspace.saveAsync ${he(e)}`),e.isDeleted&&R(e),D(e),g.assert(e.target==pxt.appTarget.id),e.temporary)return Promise.resolve();let i=_(e.id);const s=!i;s&&(i={header:e,text:t,version:null},x.push(i));const a=!n&&!t,l=!n&&(e.isDeleted||t&&(()=>{if(s)return!0;const n=function(e,t){const n=e.header||{},r=t.header||{},i=e.text||{},o=t.text||{},s=g.unique([...Object.keys(n),...Object.keys(r)],(e=>e)).filter((e=>((e,t)=>JSON.stringify(e)!==JSON.stringify(t))(n[e],r[e]))),a=s.filter((e=>e in n&&!(e in r))).map((e=>({kind:"del",key:e,oldVal:n[e]}))),l=s.filter((e=>!(e in n)&&e in r)).map((e=>({kind:"add",key:e,newVal:r[e]}))),c=s.filter((e=>e in n&&e in r)).map((e=>({kind:"mod",key:e,oldVal:n[e],newVal:r[e]}))),u=g.unique([...Object.keys(i),...Object.keys(o)],(e=>e)).filter((e=>i[e]!==o[e]));return{header:[...a,...l,...c],files:[...u.filter((e=>e in i&&!(e in o)&&!!t.text)).map((e=>({kind:"del",key:e,oldVal:i[e].length}))),...u.filter((e=>!(e in i)&&e in o)).map((e=>({kind:"add",key:e,newVal:o[e].length}))),...u.filter((e=>e in i&&e in o)).map((e=>({kind:"mod",key:e,oldVal:i[e].length,newVal:o[e].length})))]}}(i,{header:e,text:t}),r=[X,pxt.SIMSTATE_JSON,pxt.SERIAL_EDITOR_FILE],o=["recentUse","modificationTime","cloudCurrent","_rev","_id","cloudVersion"],a={header:n.header.filter((e=>o.indexOf(e.key)<0)),files:n.files.filter((e=>r.indexOf(e.key)<0))},l=a.header.length>0||a.files.length>0;return l&&(pxt.debug("user changes:"),pxt.debug(function(e){const t=e=>"\t"+e,n=e=>`${e.kind} ${e.key}: (${e.oldVal||""}) => (${e.newVal||""})`;let r="";const i=e.header.filter((e=>"del"===e.kind)),o=e.header.filter((e=>"add"===e.kind)),s=e.header.filter((e=>"mod"===e.kind));r+=`HEADER (+${o.length}-${i.length}~${s.length})`,r+="\n",r+=e.header.map(n).map(t).join("\n"),r+="\n";const a=e.files.filter((e=>"del"===e.kind)),l=e.files.filter((e=>"add"===e.kind)),c=e.files.filter((e=>"mod"===e.kind));return r+=`FILES (+${l.length}-${a.length}~${c.length})`,r+="\n",r+=e.files.map(n).map(t).join("\n"),r+"\n"}(a))),l})());if((a||l)&&(e.pubCurrent=!1,e.cloudCurrent=!1,e.modificationTime=g.nowSeconds(),e.targetVersion=e.targetVersion||"0.0.0",h.hasIdentity()&&h.loggedIn()&&(e.cloudUserId=null===(r=h.userProfile())||void 0===r?void 0:r.id)),n||(e.recentUse=g.nowSeconds()),s||(Object.assign(i.header,e),Object.keys(i.header).filter((t=>void 0===e[t])).forEach((e=>delete i.header[e])),e=i.header),t&&(i.text=t),(t||e.isDeleted)&&(e.saveId=null),t&&pxt.appTarget.simulator&&pxt.appTarget.simulator.dynamicBoardDefinition){const n=pxt.Package.parseAndValidConfig(t[pxt.CONFIG_NAME]);n&&n.dependencies&&(e.board=Object.keys(n.dependencies).filter((e=>!!pxt.bundledSvg(e)))[0])}return E.enqueue(e.id,(async()=>{let n;await function(e){return void 0!==e.version?Promise.resolve():y.getAsync(e.header).then((t=>{e.version=t.version}))}(i);const r=t?i.text:null;try{n=await y.setAsync(e,i.version,r)}catch(t){await S("write failed"),n=await y.setAsync(e,t.version,r)}!n&&t&&pxt.debug("write rejected due to version conflict!"),t&&(i.version=n),l&&(e.pubCurrent=!1,e.cloudCurrent=!1,e.saveId=null),(t||e.isDeleted)&&(o.invalidate("text:"+e.id),o.invalidate("pkg-git-status:"+e.id)),o.invalidateHeader("header",e),s&&o.invalidate("headers:"),O()}))}function H(e,t,n=!1){return e.path=function(e){let t=e.name.replace(/[^a-zA-Z0-9]+/g," ").trim().replace(/ /g,"-");if(t||(t="Untitled"),_(t)){let e=2;for(;_(t+"-"+e);)e++;t+="-"+e}return t}(e),F(e,t,n)}function G(e,t,n=!1){g.assert(e.target==pxt.appTarget.id);const r=e;n||(r.id=ts.pxtc.Util.guidGen()),r.recentUse=g.nowSeconds(),r.modificationTime=r.recentUse;const i=pxt.Package.parseAndValidConfig(t[pxt.CONFIG_NAME]);return i&&i.preferredEditor&&(r.editor=i.preferredEditor,pxt.shell.setEditorLanguagePref(i.preferredEditor)),pxt.github.cacheProjectDependenciesAsync(i).then((()=>H(r,t))).then((()=>r))}function q(e){let t=e.name.indexOf("#")>-1?e.name.substring(0,e.name.lastIndexOf("#")).trim():e.name,n=g.toDictionary(x.filter((e=>!e.header.isDeleted)),(e=>e.header.name)),r=2;for(;n.hasOwnProperty(t+" #"+r);)r++;return t+" #"+r}function V(e){return e?(["kind.json","yelm.json"].forEach((t=>{!e[pxt.CONFIG_NAME]&&e[t]&&(e[pxt.CONFIG_NAME]=e[t],delete e[t])})),e):e}n.acquireHeaderSession=function(e){e&&pxt.storage.setLocal("workspaceheadersessionid:"+e.id,N)},n.isHeaderSessionOutdated=P,n.getHeaderLastCloudSync=M,n.getLastCloudSync=function(){var e;if(!h.loggedIn())return 0;const t=null===(e=h.userProfile())||void 0===e?void 0:e.id,n=T(!0).filter((e=>e.cloudUserId&&e.cloudUserId===t));return n.length?Math.min(...n.map(M)):0},n.initAsync=function(){return y||(y=s.provider,b="browser"),ce().then((e=>function(){const e=x.map((e=>e.header)),t={};return e.filter((e=>e.backupRef)).forEach((e=>t[e.backupRef]=!0)),Promise.all(e.filter((e=>e.isBackup&&!t[e.id])).map((e=>(e.isDeleted=!0,F(e)))))}().then((()=>e)))).then((e=>(pxt.perf.recordMilestone("workspace init finished"),e)))},n.getTextAsync=L,n.anonymousPublishAsync=function(e,t,n,r){D(e);const i={};e.saveId=i;const o=B(e,t,n,r);return pxt.debug(`publishing script; ${o.text.length} bytes`),m.privatePostAsync("scripts",o,!0).then((t=>(e.pubVersions||(e.pubVersions=[]),e.pubVersions.push({id:t.id,type:"snapshot"}),t.shortid&&(t.id=t.shortid),e.pubId=t.shortid,e.pubCurrent=e.saveId===i,e.meta=t.meta,pxt.debug(`published; id /${e.pubId}`),U(e).then((()=>t)))))},n.persistentPublishAsync=function(e,t,n,r){D(e);const i={};e.saveId=i;const o=B(e,t,n,r);return pxt.debug(`publishing script; ${o.text.length} bytes`),f.shareAsync(e.id,o).then((t=>{const{shareID:n,scr:r}=t;return e.pubVersions||(e.pubVersions=[]),e.pubVersions.push({id:r.id,type:"permalink"}),e.pubId=n,e.pubCurrent=e.saveId===i,e.pubPermalink=n,e.meta=r.meta,pxt.debug(`published; id /${e.pubId}`),U(e).then((()=>e))}))},n.forceSaveAsync=F,n.partialSaveAsync=async function(e,t,n){const r=_(e);if(!r)return pxt.log("Failed to save to unknown project: "+e),void pxt.tickEvent("workspace.invalidSaveToUnknownProject");const i=Object.assign({},await L(e));return i[t]=n,U(r.header,i)},n.saveAsync=U,n.importAsync=H,n.installAsync=G,n.duplicateAsync=async function(e,t){const n=await L(e.id);t||(t=q(e));let r=g.flatClone(e);const i=g.flatClone(n);r.id=g.guidGen(),r.name=t;const o=JSON.parse(n[pxt.CONFIG_NAME]);return o.name=r.name,i[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(o),delete r._rev,delete r._id,delete r.githubCurrent,delete r.githubId,delete r.githubTag,r.cloudVersion&&pxt.tickEvent("identity.duplicatingCloudProject"),H(r=f.excludeLocalOnlyMetadataFields(r),i).then((()=>r))},n.createDuplicateName=q,n.saveScreenshotAsync=function(e,t,n){return D(e),y.saveScreenshotAsync?y.saveScreenshotAsync(e,t,n):Promise.resolve()},n.fixupFileNames=V;const z=new g.PromiseQueue,W=new r.Table("script");async function K(e){pxt.github.isGithubId(e)&&(e=pxt.github.normalizeRepoId(e));const t=await pxt.packagesConfigAsync(),n=encodeURIComponent(pxt.github.upgradedPackageId(t,e));return await z.enqueue(n,(async()=>{let r;try{r=(await W.getAsync(n)).files}catch(o){r=pxt.github.isGithubId(e)?(await pxt.github.downloadPackageAsync(e,t)).files:await m.downloadScriptFilesAsync(e).catch(i.handleNetworkError);try{await W.setAsync({id:n,files:r})}catch(e){pxt.log("Unable to cache script in DB")}}return V(r)}))}var $,Y;n.getPublishedScriptAsync=K,(Y=$=n.PullStatus||(n.PullStatus={}))[Y.NoSourceControl=0]="NoSourceControl",Y[Y.UpToDate=1]="UpToDate",Y[Y.GotChanges=2]="GotChanges",Y[Y.NeedsCommit=3]="NeedsCommit",Y[Y.BranchNotFound=4]="BranchNotFound";const X=pxt.github.GIT_JSON;async function J(e,t=!1){let n=await L(e.id);await oe(e,n);let r=n[X];if(!r)return $.NoSourceControl;let i=JSON.parse(r),o=pxt.github.parseRepoId(i.repo);const s=o.tag,a=await pxt.github.getRefAsync(o.slug,s);if(!a){const e=await pxt.github.listRefsAsync(o.slug,"heads");return e&&e.length?$.BranchNotFound:$.NoSourceControl}if(a==i.commit.sha)return $.UpToDate;if(t)return $.GotChanges;try{return await ie(e,{repo:i.repo,sha:a,files:n,tryDiff3:!0}),$.GotChanges}catch(e){if(e.isMergeError)return $.NeedsCommit;throw e}}function Q(e){let t=pxt.semver.parse(e.version,"0.0.0");return t.patch++,pxt.semver.stringify(t)}n.hasPullAsync=async function(e){return await J(e,!0)==$.GotChanges},n.pullAsync=J,n.revertAllAsync=async function(e){const t=(await L(e.id))[X];if(!t)return $.NoSourceControl;const n=JSON.parse(t),r=pxt.github.parseRepoId(e.githubId),i=n.commit,o=pxt.github.lookupFile(r,i,pxt.CONFIG_NAME),s=pxt.Package.parseAndValidConfig(o&&o.blobContent);if(!s)return $.NoSourceControl;const a={};a[X]=t,a[pxt.CONFIG_NAME]=o.blobContent;for(const e of s.files.concat(s.testFiles)){const t=pxt.github.lookupFile(r,i,e);if(!t||void 0===t.blobContent)return pxt.log(`cannot revert ${e}, corrupted based commit`),$.NoSourceControl;a[e]=t.blobContent}return await F(e,a),$.UpToDate},n.hasMergeConflictMarkersAsync=async function(e){const t=await L(e.id);return!!Object.keys(t).find((e=>pxt.diff.hasMergeConflictMarker(t[e])))},n.prAsync=async function(e,t,n){let r=pxt.github.parseRepoId(e.githubId);const i=await pxt.github.getNewBranchNameAsync(r.slug,"merge-");await pxt.github.createNewBranchAsync(r.slug,i,t);const o=await pxt.github.createPRFromBranchAsync(r.slug,r.tag,i,n);let s=await pxt.github.getRefAsync(r.slug,r.tag);return await ie(e,{repo:e.githubId,sha:s,files:{}}),o},n.bumpedVersion=Q,n.bumpAsync=async function(e,t=""){D(e);const n=await L(e.id),r=pxt.Package.parseAndValidConfig(n[pxt.CONFIG_NAME]);r.version=t||Q(r);const i="v"+r.version;if(r.dependencies){const t=pxt.github.parseRepoId(e.githubId);Object.keys(r.dependencies).forEach((e=>{const n=r.dependencies[e],i=/^github:/.test(n)&&pxt.github.parseRepoId(n);i&&t.slug===i.slug&&(r.dependencies[e]=`github:${pxt.github.join(t.slug,i.fileName)}`,pxt.debug(`patching dep ${e} to ${r.dependencies[e]}`))}))}return n[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(r),await U(e,n),await ne(e,{message:r.version,createRelease:i,binaryJs:!0})};const Z=".github/makecode/blocksdiff.png",ee="assets/js/binary.js",te="assets/version.txt";async function ne(e,t={}){await u.ensureGitHubTokenAsync();let n=await L(e.id),r=n[X];r||g.userError(lf("Not a git extension."));let i=JSON.parse(r),s=pxt.github.parseRepoId(i.repo),a=pxt.Package.parseAndValidConfig(n[pxt.CONFIG_NAME]),l={base_tree:i.commit.tree.sha,tree:[]};const c=t.filenamesToCommit||pxt.allPkgFiles(a),d=[X,pxt.SIMSTATE_JSON,pxt.SERIAL_EDITOR_FILE];for(const e of c.filter((e=>d.indexOf(e)<0))){const t=n[e];await b(e,t)}let h;if(0==l.tree.length&&g.userError(lf("Nothing to commit!")),t&&l.tree.find((e=>e.path==pxt.MAIN_BLOCKS))){if(t.blocksScreenshotAsync){const e=await t.blocksScreenshotAsync();e&&await b(".github/makecode/blocks.png",e)}if(t.blocksDiffScreenshotAsync){const e=await t.blocksDiffScreenshotAsync();e&&(h=await b(Z,e))}}if(pxt.appTarget.appTheme.githubCompiledJs&&t.binaryJs&&(!s.tag||"master"==s.tag)){const e=a.version||"0.0.0",t={jsMetaVersion:e},n=await p.compileAsync(t);if(n&&n.success&&n.outfiles[pxtc.BINARY_JS]&&(await b(ee,n.outfiles[pxtc.BINARY_JS]),await b(te,e),!a.disableTargetTemplateFiles)){const e=pxt.template.targetTemplateFiles();if(e)for(const t of Object.keys(e))await b(t,e[t])}}let f=await pxt.github.createObjectAsync(s.slug,"tree",l),m={message:t.message||lf("Update {0}",l.tree.map((e=>e.path)).filter((e=>!/\.github\/makecode\//.test(e))).join(", ")),parents:[i.commit.sha],tree:f};i.mergeSha&&m.parents.push(i.mergeSha);let v=await pxt.github.createObjectAsync(s.slug,"commit",m),y=v;return await pxt.github.fastForwardAsync(s.slug,s.tag,v)||(y=await pxt.github.mergeAsync(s.slug,s.tag,v)),null==y?v:(o.invalidate("gh-commits:*"),h&&await pxt.github.postCommitComment(s.slug,v,`![${lf("Difference between blocks")}](https://raw.githubusercontent.com/${pxt.github.join(s.slug,v,s.fileName,Z)}`),await ie(e,{repo:i.repo,sha:y,files:n,saveTag:t.createRelease}),t.createRelease&&(await pxt.github.createReleaseAsync(s.slug,t.createRelease,y),await pxt.github.enablePagesAsync(s.slug),await pxt.github.listRefsAsync(s.slug,"tags",!0,!0)),"");async function b(e,n){const r={content:n,encoding:"utf-8"};e==pxt.CONFIG_NAME&&(r.content=se(r.content,!!t.createRelease));const o=/^data:([^;]+);base64,/.exec(n);o&&(r.encoding="base64",r.content=n.substr(o[0].length));const a=w(r.content,r.encoding),c=pxt.github.lookupFile(s,i.commit,e);let u;if(!c||c.sha!=a){if("utf-8"==r.encoding&&pxt.diff.hasMergeConflictMarker(r.content))throw function(){const e=new Error("Merge conflict marker error");return e.isMergeConflictMarkerError=!0,e}();u=await pxt.github.createObjectAsync(s.slug,"blob",r),"utf-8"==r.encoding&&g.assert(u==a,`sha not matching ${u} != ${a}`);const t=pxt.github.join(s.fileName,e);l.tree.push({path:t,mode:"100644",type:"blob",sha:u,url:void 0})}return u}}function re(){const e=new Error("Merge error");return e.isMergeError=!0,e}async function ie(e,t){var n;const{repo:r,sha:i,files:o,justJSON:s}=t,a=pxt.github.parseRepoId(r),l=await pxt.github.getCommitAsync(a.slug,i);let c=JSON.parse(o[X]||"{}");c.commit||(c={repo:r,commit:null});const u={};let d=0,p=!1;const h=async e=>{u[e]=!0;const n=pxt.github.lookupFile(a,l,e),r=pxt.github.lookupFile(a,c.commit,e),h=null!=o[e]&&(!r||r.blobContent!=o[e]);if(!n)return t.tryDiff3&&h?o[e]:(s||(o[e]=""),"");let f=r?r.blobContent:o[e];if(null!=f&&w(f)==n.sha)return n.blobContent=f,t.tryDiff3||t.justJSON||(o[e]=f),f;if(f=await pxt.github.downloadTextAsync(a.fullName,i,e),n.blobContent=f,w(f)!=n.sha&&w(`\ufeff${f}`)!==n.sha&&g.userError(lf("Corrupt SHA1 on download of '{0}'.",e)),t.tryDiff3&&h)if(e==pxt.CONFIG_NAME){if(!(f=pxt.diff.mergeDiff3Config(o[e],r.blobContent,n.blobContent)))throw re()}else if(/\.blocks$/.test(e)){const t=pxt.blocks.mergeXml(o[e],r.blobContent,n.blobContent);p=p||!t,f=t||""}else if(e==ee||e==te||e==pxt.TUTORIAL_INFO_FILE||e==pxt.ASSETS_FILE)f=o[e];else{const t=pxt.diff.diff3(o[e],r.blobContent,n.blobContent,lf("local changes"),lf("remote changes (pulled from Github)"));if(!t)throw re();if(d+=t.numConflicts,t.numConflicts&&!/\.ts$/.test(e))throw re();f=t.merged}return s||(o[e]=f),f},f=pxt.Package.parseAndValidConfig(o[pxt.CONFIG_NAME]),m=await h(pxt.CONFIG_NAME);let v=pxt.Package.parseAndValidConfig(m);if(v||(e&&g.userError(lf("Invalid pxt.json file.")),pxt.debug("github: reconstructing pxt.json"),v=pxt.diff.reconstructConfig(a,o,l,pxt.appTarget.blocksprj||pxt.appTarget.tsprj),a.fileName&&a.project&&(v.dependencies[a.project]=`github:${a.slug}`),o[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(v)),f){let e=0;Object.keys(v.dependencies).filter((e=>/^github:/.test(v.dependencies[e])&&f.dependencies[e])).forEach((t=>{if(pxt.github.parseRepoId(v.dependencies[t])){const n=f.dependencies[t];v.dependencies[t]=n,e++}})),e&&(o[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(v))}for(const e of pxt.allPkgFiles(v).slice(1))await h(e);if(v.name||(v.name=a.fileName&&a.project?`${a.project}-${a.fileName}`:a.project||a.fullName,v.name=v.name.replace(/pxt-/gi,"").replace(/\//g,"-").replace(/-+/,"-").replace(/[^\w\-]/g,""),s||(o[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(v))),!s){if(p&&d)throw re();for(let e of Object.keys(o))"."==e[0]||u[e]||delete o[e]}l.tag=t.saveTag,c.mergeSha=void 0,c.commit=l,o[X]=JSON.stringify(c,null,4);const y=(null===(n=v.targetVersions)||void 0===n?void 0:n.targetId)===pxt.appTarget.id&&v.targetVersions.target?v.targetVersions.target:pxt.appTarget.versions.target;return e?(e.name=v.name,await F(e,o)):e=await G({name:v.name,githubId:r,pubId:"",pubCurrent:!1,meta:{},editor:pxt.BLOCKS_PROJECT_NAME,target:pxt.appTarget.id,targetVersion:y},o),e}async function oe(e,t){D(e),e.githubCurrent=!1;const n=JSON.parse(t[X]||"{}");if(e.githubId=n&&n.repo,e.githubTag=n&&n.commit&&n.commit.tag,!e.githubId)return;if(!n.commit||!n.commit.tree)return;const r=pxt.github.parseRepoId(e.githubId);let i=!0,o=!1;for(let e of Object.keys(t)){if(e==X||e==pxt.SIMSTATE_JSON||e==pxt.SERIAL_EDITOR_FILE)continue;let s=pxt.github.lookupFile(r,n.commit,e);if(!s||"blob"!=s.type){i=!1;continue}null==s.blobContent&&(o=!0);let a=t[e];e==pxt.CONFIG_NAME&&(a=se(a)),a&&s.sha!=w(a)&&(i=!1)}if(e.githubCurrent=i,o&&await ie(e,{repo:n.repo,sha:n.commit.sha,files:t,justJSON:!0}),null==n.isFork){const r=pxt.github.parseRepoId(n.repo),i=await pxt.github.repoAsync(r.fullName,null);i&&(n.isFork=!!i.fork,t[X]=JSON.stringify(n,null,4),await U(e,t))}}function se(e,t){const n=pxt.Package.parseAndValidConfig(e);if(!n)return e;delete n.installedVersion,delete n.additionalFilePath,delete n.additionalFilePaths;const r=n.supportedTargets||[];r.indexOf(pxt.appTarget.id)<0&&(r.push(pxt.appTarget.id),r.sort(),n.supportedTargets=r),n.targetVersions=Object.assign(Object.assign({},n.targetVersions),{target:pxt.appTarget.versions.target,targetId:pxt.appTarget.id});const i=Object.keys(n.dependencies).filter((e=>/^(file|workspace):/.test(n.dependencies[e])));for(const e of i)o(e);return pxt.Package.stringifyConfig(n);function o(e){const r=n.dependencies[e],i=k(r.substring(r.indexOf(":")+1));if(i)if(i.githubId){const r=pxt.github.parseRepoId(i.githubId);t&&!/^v\d+/.test(i.githubTag)&&g.userError(lf("You need to create a release for dependency {0}.",e));const o=i.githubTag||r.tag;n.dependencies[e]=`github:${r.fullName}#${o}`}else t&&g.userError(lf("Dependency {0} is a local project.",e))}}async function ae(e,t,n,r){await u.ensureGitHubTokenAsync();let i=pxt.github.parseRepoId(t),o=i.fullName.replace(/.*\//,""),s=await L(e.id);const a=pxt.template.packageFiles(o);if(pxt.template.packageFilesFixup(a,{repo:i.fullName,repoowner:i.owner,reponame:i.project,repotag:i.tag}),n)g.jsonMergeFrom(s,a);else{pxt.Package.parseAndValidConfig(s[pxt.CONFIG_NAME])||delete s[pxt.CONFIG_NAME];let e=a[pxt.README_FILE];const t=s[pxt.README_FILE];(e||t)&&(e=[t,e].filter((e=>!!e)).join("\n\n")),g.jsonMergeFrom(a,s),s=a,e&&(s[pxt.README_FILE]=e)}const l=pxt.Package.parseAndValidConfig(s[pxt.CONFIG_NAME]),c=l.files;c.filter((e=>/\.ts$/.test(e))).length||Object.keys(s).filter((e=>/\.(blocks|ts|py|asm|md|json)$/.test(e))).filter((e=>e!=pxt.CONFIG_NAME)).forEach((e=>c.push(e)));const d=l.testFiles||(l.testFiles=[]);s["test.ts"]&&d.indexOf("test.ts")<0&&d.push("test.ts"),s[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(l),await F(e,s),await ne(e,{message:lf("Initial files for MakeCode project"),filenamesToCommit:Object.keys(s),binaryJs:r}),s=await L(e.id);const p=pxt.allPkgFiles(pxt.Package.parseAndValidConfig(s[pxt.CONFIG_NAME])),h=[X,pxt.SIMSTATE_JSON,pxt.SERIAL_EDITOR_FILE,pxt.CONFIG_NAME];Object.keys(s).filter((e=>h.indexOf(e)<0&&p.indexOf(e)<0)).forEach((e=>delete s[e])),await U(e,s);try{await pxt.github.enablePagesAsync(i.slug)}catch(e){pxt.reportException(e)}return e}let le;function ce(){return pxt.debug("workspace: sync"),le||(le=y.listAsync().catch((e=>S("sync failed").then((()=>y.listAsync())))).then((e=>{const t=g.toDictionary(x||[],(e=>e.header.id));x=e.map((e=>{let n=t[e.id];return n?JSON.stringify(n.header)!==JSON.stringify(e)&&(g.jsonCopyFrom(n.header,e),n.text=void 0,n.version=void 0,o.invalidateHeader("header",e),o.invalidateHeader("text",e),o.invalidateHeader("pkg-git-status",e),o.invalidate("gh-commits:*")):n={header:e,text:void 0,version:void 0},n})),u.syncAsync()})).then((()=>(O(),y.getSyncState?y.getSyncState():null))).finally((()=>{le=void 0})))}function ue(){return y===s.provider}n.commitAsync=ne,n.restoreCommitAsync=async function(e,t){await u.ensureGitHubTokenAsync();const n=await L(e.id),r=n[X],i=JSON.parse(r),o=pxt.github.parseRepoId(i.repo),s=new Date(Date.parse(t.committer.date)),a={message:lf("Restore '{0} {1}'",s.toLocaleString(),t.message),parents:[i.commit.sha],tree:t.tree.sha},l=await pxt.github.createObjectAsync(o.slug,"commit",a);await pxt.github.fastForwardAsync(o.slug,o.tag,l),await ie(e,{repo:i.repo,sha:l,files:n})},n.mergeUpstreamAsync=async function(e,t){return Promise.resolve()},n.exportToGithubAsync=async function(e,t){const n=pxt.github.parseRepoId(t),r=pxt.template.packageFiles(e.name);await pxt.github.putFileAsync(n.fullName,".gitignore",r[".gitignore"]);const i=await pxt.github.getRefAsync(n.slug,n.tag),o=await pxt.github.getCommitAsync(n.slug,i),s=await L(e.id);s[X]=JSON.stringify({repo:t,commit:o});const a=s[pxt.MAIN_BLOCKS];if(a){const e=pxt.blocks.loadWorkspaceXml(a,!0);if(e){const t=pxt.blocks.saveWorkspaceXml(e,!0);t&&(s[pxt.MAIN_BLOCKS]=t)}}await F(e,s),await ae(e,t,!1,!0)},n.recomputeHeaderFlagsAsync=oe,n.prepareConfigForGithub=se,n.initializeGithubRepoAsync=ae,n.importGithubAsync=async function(e){const t=pxt.github.normalizeRepoId(e,"master").replace(/^github:/,""),n=pxt.github.parseRepoId(t);let r="",o=!1,s=!1;try{r=await pxt.github.getRefAsync(n.slug,n.tag);const e=await pxt.github.getCommitAsync(n.slug,r),t=pxt.github.join(n.fileName,pxt.CONFIG_NAME);if(!e.tree.tree.find((e=>e.path==t))){if(pxt.debug("github: detected import non-makecode project"),pxt.shell.isReadOnly()&&g.userError(lf("This repository looks empty.")),o=!0,s=!1,!await i.confirmAsync({header:n.fileName?lf("Add a nested extension to existing GitHub repository?"):lf("Initialize GitHub repository for MakeCode?"),body:n.fileName?lf("We need to add a few files under the /{0} folder to your GitHub repository https://github.com/{1} to create the nested extension.",n.fileName,n.slug):lf("We need to add a few files to your GitHub repository https://github.com/{0} to make it work with MakeCode.",n.fullName),agreeLbl:lf("Ok"),hasCloseIcon:!0,helpUrl:"/github/import"}))return Promise.resolve(void 0);await u.ensureGitHubTokenAsync()}}catch(e){409==e.statusCode?(pxt.debug("github: detected import empty project"),pxt.shell.isReadOnly()&&g.userError(lf("This repository looks empty.")),await u.ensureGitHubTokenAsync(),await pxt.github.putFileAsync(n.fullName,".gitignore","# Initial\n"),o=!0,s=!0,r=await pxt.github.getRefAsync(n.slug,n.tag)):404==e.statusCode&&(i.errorNotification(lf("Sorry, that repository looks invalid.")),g.userError(lf("No such repository or branch.")))}const a=await ie(null,{repo:t,sha:r,files:{}});return a&&o&&await ae(a,t,s,!1),a},n.downloadFilesByIdAsync=function(e){return m.privateGetAsync(e,!0).then((e=>K(e.id)))},n.installByIdAsync=function(e){return m.privateGetAsync(e,!0).then((t=>K(t.id).then((n=>G({name:t.name,pubId:e,pubCurrent:!0,meta:t.meta,editor:t.editor,target:t.target,targetVersion:t.targetVersion||t.meta&&t.meta.versions&&t.meta.versions.target},n)))))},n.syncAsync=ce,n.resetAsync=function(){return x=[],y.resetAsync().then(u.resetAsync).then(r.destroyAsync).then(pxt.BrowserUtils.clearTranslationDbAsync).then(pxt.BrowserUtils.clearTutorialInfoDbAsync).then(p.clearApiInfoDbAsync).then((()=>{pxt.storage.clearLocal(),o.clearCache(),m.localToken&&pxt.storage.setLocal("local_token",m.localToken)})).then((()=>ce())).then((()=>{}))},n.loadedAsync=function(){return y.loadedAsync?y.loadedAsync():Promise.resolve()},n.saveAssetAsync=function(e,t,n){return y.saveAssetAsync?y.saveAssetAsync(e,t,n):Promise.reject(new Error(lf("Assets not supported here.")))},n.listAssetsAsync=function(e){return y.listAssetsAsync?y.listAssetsAsync(e):Promise.resolve([])},n.isBrowserWorkspace=ue,n.fireEvent=function(e){if(y.fireEvent)return y.fireEvent(e)};const de={};let pe=1;function he(e){return e?`${e.name} ${e.id.substr(0,4)}..v${function(e){return e?(de[e]||(de[e]="#"+pe,pe+=1),de[e]):"#0"}(e.cloudVersion)}@${e.modificationTime%100}-${g.timeSince(e.modificationTime)}`:"#null"}n.dbgHdrToString=he,o.mountVirtualApi("header",{getSync:e=>"*"==(e=o.stripProtocol(e))?T():k(e)}),o.mountVirtualApi("headers",{getAsync:e=>{e=o.stripProtocol(e);const t=T();return e?p.projectSearchAsync({term:e,headers:t}).then((e=>e)).then((e=>{let n=g.toDictionary(e||[],(e=>e.id));return t.filter((e=>n[e.id]))})):Promise.resolve(t)},expirationTime:e=>5e3,onInvalidated:()=>{p.projectSearchClear()}}),o.mountVirtualApi("text",{getAsync:e=>{const t=/^[\w\-]+:([^\/]+)(\/(.*))?/.exec(e);return L(t[1]).then((e=>t[3]?e[t[3]]:e))}})},{"./auth":48,"./browserworkspace":52,"./cloud":54,"./cloudsync":55,"./compiler":58,"./core":133,"./data":136,"./db":137,"./fileworkspace":152,"./idbworkspace":160,"./iframeworkspace":162,"./memoryworkspace":168,"crypto-js/sha1":230}],209:[function(e,t,n){var r=e("./toPropertyKey.js");t.exports=function(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},t.exports.__esModule=!0,t.exports.default=t.exports},{"./toPropertyKey.js":216}],210:[function(e,t,n){function r(){return t.exports=r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},t.exports.__esModule=!0,t.exports.default=t.exports,r.apply(this,arguments)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},{}],211:[function(e,t,n){t.exports=function(e){return e&&e.__esModule?e:{default:e}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],212:[function(e,t,n){var r=e("./typeof.js").default;function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(i=function(e){return e?n:t})(e)}t.exports=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=i(t);if(n&&n.has(e))return n.get(e);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var l=s?Object.getOwnPropertyDescriptor(e,a):null;l&&(l.get||l.set)?Object.defineProperty(o,a,l):o[a]=e[a]}return o.default=e,n&&n.set(e,o),o},t.exports.__esModule=!0,t.exports.default=t.exports},{"./typeof.js":217}],213:[function(e,t,n){var r=e("./defineProperty.js");function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}t.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e},t.exports.__esModule=!0,t.exports.default=t.exports},{"./defineProperty.js":209}],214:[function(e,t,n){t.exports=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i},t.exports.__esModule=!0,t.exports.default=t.exports},{}],215:[function(e,t,n){var r=e("./typeof.js").default;t.exports=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},t.exports.__esModule=!0,t.exports.default=t.exports},{"./typeof.js":217}],216:[function(e,t,n){var r=e("./typeof.js").default,i=e("./toPrimitive.js");t.exports=function(e){var t=i(e,"string");return"symbol"===r(t)?t:String(t)},t.exports.__esModule=!0,t.exports.default=t.exports},{"./toPrimitive.js":215,"./typeof.js":217}],217:[function(e,t,n){function r(e){return t.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t.exports.__esModule=!0,t.exports.default=t.exports,r(e)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},{}],218:[function(e,t,n){var r,i;r=window,i=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CookiePolicy=void 0,function(e){e[e.Disable=0]="Disable",e[e.Enable=1]="Enable"}(t.CookiePolicy||(t.CookiePolicy={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CookiePolicy=t.launchAsync=t.close=t.renderButtons=void 0;var r=n(2);Object.defineProperty(t,"renderButtons",{enumerable:!0,get:function(){return r.renderButtons}});var i=n(3);Object.defineProperty(t,"close",{enumerable:!0,get:function(){return i.close}}),Object.defineProperty(t,"launchAsync",{enumerable:!0,get:function(){return i.launchAsync}});var o=n(0);Object.defineProperty(t,"CookiePolicy",{enumerable:!0,get:function(){return o.CookiePolicy}}),"undefined"!=typeof window&&window.addEventListener("load",(function(){var e;window.hasOwnProperty("Promise")||((e=document.createElement("script")).src="https://contentstorage.onenote.office.net/onenoteltir/permanent-static-resources/promise-polyfill.min.js",document.head.appendChild(e)),r.renderButtons()}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renderButtons=void 0;var r={af:"Indompelende leser",am:"    ",ar:" ",as:" ",az:"mmersiv Oxuyucu",be:" ",bg:" ",bn:" ","bn-bd":" ",bs:"Koncentrirani italac",ca:"Lector immersiu",cs:"Asistivn teka","cy-gb":"Darllenydd Ymdrwythol",da:"Forenklet lser",de:"Plastischer Reader",el:"  ",en:"Immersive Reader",es:"Lector inmersivo",et:"Svaluger",eu:"Irakurgailu murgiltzailea",fa:" ",fi:"Syventv lukuohjelma",fil:"Immersive Reader",fr:"Lecteur immersif","ga-ie":"Litheoir tumthach",gd:"An leughadair r-nsach",gl:"Lector avanzado",gu:" ",ha:"Mai karatu Mai barbazawa",he:"  ",hi:" ",hr:"Stopljeni ita",hu:"Modern olvas",hy:" ",id:"Pembaca Imersif",ig:"g Kenziptara",is:"Agengilegt lestrarumhverfi",it:"Strumento di lettura immersiva",ja:" ",ka:" ",kk:"  ",km:"",kn:" ",ko:" ",kok:"  ","ku-arab":" ",ky:" ",lb:"Immersive Reader",lo:"",lt:"traukianti skaitytuv",lv:"Trskata lastjs",mi:"Ppnui Rumaki",mk:" ",ml:" ",mn:" ",mr:" ",ms:"Pembaca Imersif",mt:"Qarrej Immersiv",ne:" ",nl:"Insluitende lezer","nn-no":"Engasjerande lesar",no:"Engasjerende leser",nso:"Go Bala ka Mongwalo o Mokoto",or:" ",pa:" ","pa-arab":"   ",pl:"Czytnik immersyjny",prs:" ",pt:"Leitura Avanada",quc:"Nim ucholajil sik'inel uwach",quz:"Wankisqa awiq",ro:"Immersive Reader",ru:"  ",rw:"Insakazasoma",sd:" ",si:"  ",sk:"Imerzn taka",sl:"Potopni bralnik",sq:"Lexuesi kredhs","sr-cyrl-ba":" ","sr-cyrl-rs":" ","sr-latn-rs":"Koncentrisani italac",sv:"Avancerad lsare",sw:"Kisomaji cha Kuzamisha",ta:" ",te:"   ","tg-cyrl-tj":" ",th:"",ti:"   ",tk:"Giilein okajy",tn:"Sebadi sa Imesife",tr:"Tam Ekran Okuyucu",tt:"   ","ug-cn":" ",uk:"  ",ur:"  ",uz:"Immersiv mutolaa vositasi",vi:"Trnh c Chn thc",wo:"Jngukaay bu Rafet",xh:"Isifundi Esikhulu",yo:"w Almtn",zh:"","zh-hant":"",zu:"Isifundi Sokuzizwisa"};function i(e){var t=document.createElement("img");t.src="https://contentstorage.onenote.office.net/onenoteltir/permanent-static-resources/immersive-reader-icon.svg";var n=e.getAttribute("data-icon-px-size")||"20";t.style.height=t.style.width=n+"px",t.style.verticalAlign="middle",t.style.marginTop="-2px";var r=e.getAttribute("data-locale")||"en";t.alt=a(r),e.appendChild(t)}function o(e){var t=document.createElement("span");t.style.marginLeft="8px",e.appendChild(t)}function s(e){var t=document.createElement("span"),n=e.getAttribute("data-locale")||"en";t.textContent=a(n),e.appendChild(t)}function a(e){return e=e.toLowerCase(),r[e]?r[e]:"zh-hk"===e||"zh-mo"===e||"zh-tw"===e?r["zh-hant"]:(e=e.substring(0,e.lastIndexOf("-")),r[e]?r[e]:(e=e.substring(0,e.lastIndexOf("-")),r[e]?r[e]:r.en))}t.renderButtons=function(e){var t=document.createElement("style");t.innerHTML=".immersive-reader-button{cursor:pointer;display:inline-block;padding:5px;} .immersive-reader-button:hover{background:rgba(0,0,0,.05);border-radius:2px",document.head.appendChild(t);var n=[].slice.call(document.getElementsByClassName("immersive-reader-button"));e&&e.elements&&(n=e.elements);for(var r=0,l=n;r<l.length;r++){var c=l[r];c.setAttribute("role","button");var u=c.getAttribute("data-locale")||"en";switch(c.setAttribute("aria-label",a(u)),c.getAttribute("data-button-style")||"icon"){case"icon":i(c);break;case"text":s(c);break;case"iconAndText":i(c),o(c),s(c)}}}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.isValidSubdomain=t.close=t.launchAsync=void 0;var i=n(0),o=n(4),s={};s[o.ErrorCode.TokenExpired]="The access token supplied is expired.",s[o.ErrorCode.Throttled]="You have exceeded your quota.",s[o.ErrorCode.ServerError]="An error occurred when calling the server to process the text.",s[o.ErrorCode.InvalidSubdomain]="The subdomain supplied is invalid.";var a=!1;function l(e){return!!e&&new RegExp("^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\\-]{0,61}[a-zA-Z0-9])$").test(e)}t.launchAsync=function(e,t,n,c){return a?Promise.reject("Immersive Reader is already launching"):new Promise((function(u,d){if(e)if(n)if(n.chunks)if(n.chunks.length)if(l(t)||c&&c.customDomain){a=!0;var p=Date.now();(c=r({uiZIndex:1e3,timeout:15e3,useWebview:!1,allowFullscreen:!0,hideExitButton:!1,cookiePolicy:i.CookiePolicy.Disable},c)).uiZIndex&&"number"==typeof c.uiZIndex||(c.uiZIndex=1e3);var h=null,f=document.createElement("div"),g=c.useWebview?document.createElement("webview"):document.createElement("iframe");g.allow="autoplay";var m=document.createElement("style");m.innerHTML="body{height:100%;overflow:hidden;}";var v=function(){h&&(window.clearTimeout(h),h=null)},y=function(){document.body.contains(f)&&document.body.removeChild(f),window.removeEventListener("message",x),v(),m.parentNode&&m.parentNode.removeChild(m)},b=function(){if(y(),c.onExit)try{c.onExit()}catch(e){}};y();var x=function(r){if(r&&r.data&&"string"==typeof r.data)if("ImmersiveReader-ReadyForContent"===r.data){v();var i={cogSvcsAccessToken:e,cogSvcsSubdomain:t,request:n,launchToPostMessageSentDurationInMs:Date.now()-p,disableFirstRun:c.disableFirstRun,readAloudOptions:c.readAloudOptions,translationOptions:c.translationOptions,displayOptions:c.displayOptions,sendPreferences:!!c.onPreferencesChanged,preferences:c.preferences};g.contentWindow.postMessage(JSON.stringify({messageType:"Content",messageValue:i}),"*")}else if("ImmersiveReader-Exit"===r.data)b();else if(r.data.startsWith("ImmersiveReader-LaunchResponse:")){var l=null,h=null,m=null;try{m=JSON.parse(r.data.substring("ImmersiveReader-LaunchResponse:".length))}catch(e){}m&&m.success?l={container:f,sessionId:m.sessionId,charactersProcessed:m.meteredContentSize}:h=m&&!m.success?{code:m.errorCode,message:s[m.errorCode],sessionId:m.sessionId}:{code:o.ErrorCode.ServerError,message:s[o.ErrorCode.ServerError]},a=!1,l?(v(),u(l)):h&&(b(),d(h))}else if(r.data.startsWith("ImmersiveReader-Preferences:")&&c.onPreferencesChanged&&"function"==typeof c.onPreferencesChanged)try{c.onPreferencesChanged(r.data.substring("ImmersiveReader-Preferences:".length))}catch(e){}};window.addEventListener("message",x),h=window.setTimeout((function(){y(),a=!1,d({code:o.ErrorCode.Timeout,message:"Page failed to load after timeout ("+c.timeout+" ms)"})}),c.timeout),c.allowFullscreen&&g.setAttribute("allowfullscreen",""),g.style.cssText="position: static; width: 100vw; height: 100vh; left: 0; top: 0; border-width: 0",c.useWebview&&g.addEventListener("loadstop",(function(){g.contentWindow.postMessage(JSON.stringify({messageType:"WebviewHost"}),"*")}));var E=(c.customDomain?c.customDomain:"https://"+t+".cognitiveservices.azure.com/immersivereader/webapp/v1.0/")+"reader?exitCallback=ImmersiveReader-Exit&sdkPlatform=js&sdkVersion=1.1.0";E+="&cookiePolicy="+(c.cookiePolicy===i.CookiePolicy.Enable?"enable":"disable"),c.hideExitButton&&(E+="&hideExitButton=true"),c.uiLang&&(E+="&omkt="+c.uiLang),g.src=E,f.style.cssText="position: fixed; width: 100vw; height: 100vh; left: 0; top: 0; border-width: 0; -webkit-perspective: 1px; z-index: "+c.uiZIndex+"; background: white; overflow: hidden",f.appendChild(g),document.body.appendChild(f),document.head.appendChild(m)}else d({code:o.ErrorCode.InvalidSubdomain,message:s[o.ErrorCode.InvalidSubdomain]});else d({code:o.ErrorCode.BadArgument,message:"Chunks must not be empty"});else d({code:o.ErrorCode.BadArgument,message:"Chunks must not be null"});else d({code:o.ErrorCode.BadArgument,message:"Content must not be null"});else d({code:o.ErrorCode.BadArgument,message:"Token must not be null"})}))},t.close=function(){window.postMessage("ImmersiveReader-Exit","*")},t.isValidSubdomain=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorCode=void 0,function(e){e.BadArgument="BadArgument",e.Timeout="Timeout",e.TokenExpired="TokenExpired",e.Throttled="Throttled",e.ServerError="ServerError",e.InvalidSubdomain="InvalidSubdomain"}(t.ErrorCode||(t.ErrorCode={}))}])},"object"==typeof n&&"object"==typeof t?t.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof n?n.ImmersiveReader=i():r.ImmersiveReader=i()},{}],219:[function(e,t,n){"use strict";t.exports=function(e){return function(){var t=arguments.length;if(t){for(var n=[],r=-1;++r<t;)n[r]=arguments[r];return e.call(this,n)}return e.call(this,[])}}},{}],220:[function(e,t,n){(function(n){(function(){"use strict";var r=e("object-assign");function i(e,t){if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0}function o(e){return n.Buffer&&"function"==typeof n.Buffer.isBuffer?n.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var s=e("util/"),a=Object.prototype.hasOwnProperty,l=Array.prototype.slice,c="foo"===function(){}.name;function u(e){return Object.prototype.toString.call(e)}function d(e){return!o(e)&&"function"==typeof n.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)))}var p=t.exports=y,h=/\s*function\s+([^\(\s]*)\s*/;function f(e){if(s.isFunction(e)){if(c)return e.name;var t=e.toString().match(h);return t&&t[1]}}function g(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function m(e){if(c||!s.isFunction(e))return s.inspect(e);var t=f(e);return"[Function"+(t?": "+t:"")+"]"}function v(e,t,n,r,i){throw new p.AssertionError({message:n,actual:e,expected:t,operator:r,stackStartFunction:i})}function y(e,t){e||v(e,!0,t,"==",p.ok)}function b(e,t,n,r){if(e===t)return!0;if(o(e)&&o(t))return 0===i(e,t);if(s.isDate(e)&&s.isDate(t))return e.getTime()===t.getTime();if(s.isRegExp(e)&&s.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(d(e)&&d(t)&&u(e)===u(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===i(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(o(e)!==o(t))return!1;var a=(r=r||{actual:[],expected:[]}).actual.indexOf(e);return-1!==a&&a===r.expected.indexOf(t)||(r.actual.push(e),r.expected.push(t),function(e,t,n,r){if(null==e||null==t)return!1;if(s.isPrimitive(e)||s.isPrimitive(t))return e===t;if(n&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var i=x(e),o=x(t);if(i&&!o||!i&&o)return!1;if(i)return b(e=l.call(e),t=l.call(t),n);var a,c,u=w(e),d=w(t);if(u.length!==d.length)return!1;for(u.sort(),d.sort(),c=u.length-1;c>=0;c--)if(u[c]!==d[c])return!1;for(c=u.length-1;c>=0;c--)if(!b(e[a=u[c]],t[a],n,r))return!1;return!0}(e,t,n,r))}return n?e===t:e==t}function x(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function E(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function _(e,t,n,r){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(r=n,n=null),i=function(e){var t;try{e()}catch(e){t=e}return t}(t),r=(n&&n.name?" ("+n.name+").":".")+(r?" "+r:"."),e&&!i&&v(i,n,"Missing expected exception"+r);var o="string"==typeof r,a=!e&&i&&!n;if((!e&&s.isError(i)&&o&&E(i,n)||a)&&v(i,n,"Got unwanted exception"+r),e&&i&&n&&!E(i,n)||!e&&i)throw i}p.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return g(m(e.actual),128)+" "+e.operator+" "+g(m(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||v;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var r=n.stack,i=f(t),o=r.indexOf("\n"+i);if(o>=0){var s=r.indexOf("\n",o+1);r=r.substring(s+1)}this.stack=r}}},s.inherits(p.AssertionError,Error),p.fail=v,p.ok=y,p.equal=function(e,t,n){e!=t&&v(e,t,n,"==",p.equal)},p.notEqual=function(e,t,n){e==t&&v(e,t,n,"!=",p.notEqual)},p.deepEqual=function(e,t,n){b(e,t,!1)||v(e,t,n,"deepEqual",p.deepEqual)},p.deepStrictEqual=function(e,t,n){b(e,t,!0)||v(e,t,n,"deepStrictEqual",p.deepStrictEqual)},p.notDeepEqual=function(e,t,n){b(e,t,!1)&&v(e,t,n,"notDeepEqual",p.notDeepEqual)},p.notDeepStrictEqual=function e(t,n,r){b(t,n,!0)&&v(t,n,r,"notDeepStrictEqual",e)},p.strictEqual=function(e,t,n){e!==t&&v(e,t,n,"===",p.strictEqual)},p.notStrictEqual=function(e,t,n){e===t&&v(e,t,n,"!==",p.notStrictEqual)},p.throws=function(e,t,n){_(!0,e,t,n)},p.doesNotThrow=function(e,t,n){_(!1,e,t,n)},p.ifError=function(e){if(e)throw e},p.strict=r((function e(t,n){t||v(t,!0,n,"==",e)}),p,{equal:p.strictEqual,deepEqual:p.deepStrictEqual,notEqual:p.notStrictEqual,notDeepEqual:p.notDeepStrictEqual}),p.strict.strict=p.strict;var w=Object.keys||function(e){var t=[];for(var n in e)a.call(e,n)&&t.push(n);return t}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"object-assign":288,"util/":223}],221:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],222:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],223:[function(e,t,n){(function(t,r){(function(){var i=/%[sdj%]/g;n.format=function(e){if(!v(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(a(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,o=r.length,s=String(e).replace(i,(function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),l=r[n];n<o;l=r[++n])g(l)||!x(l)?s+=" "+l:s+=" "+a(l);return s},n.deprecate=function(e,i){if(y(r.process))return function(){return n.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),o=!0}return e.apply(this,arguments)}};var o,s={};function a(e,t){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),f(t)?r.showHidden=t:t&&n._extend(r,t),y(r.showHidden)&&(r.showHidden=!1),y(r.depth)&&(r.depth=2),y(r.colors)&&(r.colors=!1),y(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=l),u(r,e,r.depth)}function l(e,t){var n=a.styles[t];return n?"["+a.colors[n][0]+"m"+e+"["+a.colors[n][1]+"m":e}function c(e,t){return e}function u(e,t,r){if(e.customInspect&&t&&w(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r,e);return v(i)||(i=u(e,i,r)),i}var o=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(v(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return m(t)?e.stylize(""+t,"number"):f(t)?e.stylize(""+t,"boolean"):g(t)?e.stylize("null","null"):void 0}(e,t);if(o)return o;var s=Object.keys(t),a=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),_(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return d(t);if(0===s.length){if(w(t)){var l=t.name?": "+t.name:"";return e.stylize("[Function"+l+"]","special")}if(b(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(E(t))return e.stylize(Date.prototype.toString.call(t),"date");if(_(t))return d(t)}var c,x="",S=!1,T=["{","}"];return h(t)&&(S=!0,T=["[","]"]),w(t)&&(x=" [Function"+(t.name?": "+t.name:"")+"]"),b(t)&&(x=" "+RegExp.prototype.toString.call(t)),E(t)&&(x=" "+Date.prototype.toUTCString.call(t)),_(t)&&(x=" "+d(t)),0!==s.length||S&&0!=t.length?r<0?b(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),c=S?function(e,t,n,r,i){for(var o=[],s=0,a=t.length;s<a;++s)A(t,String(s))?o.push(p(e,t,n,r,String(s),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(p(e,t,n,r,i,!0))})),o}(e,t,r,a,s):s.map((function(n){return p(e,t,r,a,n,S)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(c,x,T)):T[0]+x+T[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,n,r,i,o){var s,a,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(a=e.stylize("[Setter]","special")),A(r,i)||(s="["+i+"]"),a||(e.seen.indexOf(l.value)<0?(a=g(n)?u(e,l.value,null):u(e,l.value,n-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),y(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function h(e){return Array.isArray(e)}function f(e){return"boolean"==typeof e}function g(e){return null===e}function m(e){return"number"==typeof e}function v(e){return"string"==typeof e}function y(e){return void 0===e}function b(e){return x(e)&&"[object RegExp]"===S(e)}function x(e){return"object"==typeof e&&null!==e}function E(e){return x(e)&&"[object Date]"===S(e)}function _(e){return x(e)&&("[object Error]"===S(e)||e instanceof Error)}function w(e){return"function"==typeof e}function S(e){return Object.prototype.toString.call(e)}function T(e){return e<10?"0"+e.toString(10):e.toString(10)}n.debuglog=function(e){if(y(o)&&(o=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!s[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var r=t.pid;s[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,r,t)}}else s[e]=function(){};return s[e]},n.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=h,n.isBoolean=f,n.isNull=g,n.isNullOrUndefined=function(e){return null==e},n.isNumber=m,n.isString=v,n.isSymbol=function(e){return"symbol"==typeof e},n.isUndefined=y,n.isRegExp=b,n.isObject=x,n.isDate=E,n.isError=_,n.isFunction=w,n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},n.isBuffer=e("./support/isBuffer");var k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function C(){var e=new Date,t=[T(e.getHours()),T(e.getMinutes()),T(e.getSeconds())].join(":");return[e.getDate(),k[e.getMonth()],t].join(" ")}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.log=function(){console.log("%s - %s",C(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!x(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":222,_process:303,inherits:221}],224:[function(e,t,n){"use strict";n.byteLength=function(e){var t=c(e),n=t[0],r=t[1];return 3*(n+r)/4-r},n.toByteArray=function(e){var t,n,r=c(e),s=r[0],a=r[1],l=new o(function(e,t,n){return 3*(t+n)/4-n}(0,s,a)),u=0,d=a>0?s-4:s;for(n=0;n<d;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;return 2===a&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,l[u++]=255&t),1===a&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t),l},n.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],s=0,a=n-i;s<a;s+=16383)o.push(d(e,s,s+16383>a?a:s+16383));return 1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,l=s.length;a<l;++a)r[a]=s[a],i[s.charCodeAt(a)]=a;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e){return r[e>>18&63]+r[e>>12&63]+r[e>>6&63]+r[63&e]}function d(e,t,n){for(var r,i=[],o=t;o<n;o+=3)r=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(u(r));return i.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{}],225:[function(e,t,n){},{}],226:[function(e,t,n){(function(t){(function(){"use strict";var t=e("base64-js"),r=e("ieee754"),i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=a,n.SlowBuffer=function(e){return+e!=e&&(e=0),a.alloc(+e)},n.INSPECT_MAX_BYTES=50;var o=2147483647;function s(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,a.prototype),t}function a(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return u(e)}return l(e,t,n)}function l(e,t,n){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!a.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|f(e,t),r=s(n),i=r.write(e,t);return i!==n&&(r=r.slice(0,i)),r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(U(e,Uint8Array)){var t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(U(e,ArrayBuffer)||e&&U(e.buffer,ArrayBuffer))return p(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(U(e,SharedArrayBuffer)||e&&U(e.buffer,SharedArrayBuffer)))return p(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return a.from(r,t,n);var i=function(e){if(a.isBuffer(e)){var t=0|h(e.length),n=s(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||H(e.length)?s(0):d(e):"Buffer"===e.type&&Array.isArray(e.data)?d(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return a.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return c(e),s(e<0?0:0|h(e))}function d(e){for(var t=e.length<0?0:0|h(e.length),n=s(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function p(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,a.prototype),r}function h(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function f(e,t){if(a.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||U(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return L(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return B(e).length;default:if(i)return r?-1:L(e).length;t=(""+t).toLowerCase(),i=!0}}function g(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return j(this,t,n);case"utf8":case"utf-8":return T(this,t,n);case"ascii":return C(this,t,n);case"latin1":case"binary":return A(this,t,n);case"base64":return S(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function v(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),H(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=a.from(t,r)),a.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){var o,s=1,a=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,l/=2,n/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var u=-1;for(o=n;o<a;o++)if(c(e,o)===c(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===l)return u*s}else-1!==u&&(o-=o-u),u=-1}else for(n+l>a&&(n=a-l),o=n;o>=0;o--){for(var d=!0,p=0;p<l;p++)if(c(e,o+p)!==c(t,p)){d=!1;break}if(d)return o}return-1}function b(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(H(a))return s;e[n+s]=a}return s}function x(e,t,n,r){return F(L(t,e.length-n),e,n,r)}function E(e,t,n,r){return F(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function _(e,t,n,r){return F(B(t),e,n,r)}function w(e,t,n,r){return F(function(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function S(e,n,r){return 0===n&&r===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(n,r))}function T(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,s,a,l,c=e[i],u=null,d=c>239?4:c>223?3:c>191?2:1;if(i+d<=n)switch(d){case 1:c<128&&(u=c);break;case 2:128==(192&(o=e[i+1]))&&(l=(31&c)<<6|63&o)>127&&(u=l);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(l=(15&c)<<12|(63&o)<<6|63&s)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(l=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&l<1114112&&(u=l)}null===u?(u=65533,d=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=d}return function(e){var t=e.length;if(t<=k)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=k));return n}(r)}n.kMaxLength=o,a.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),a.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),a.poolSize=8192,a.from=function(e,t,n){return l(e,t,n)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array),a.alloc=function(e,t,n){return function(e,t,n){return c(e),e<=0?s(e):void 0!==t?"string"==typeof n?s(e).fill(t,n):s(e).fill(t):s(e)}(e,t,n)},a.allocUnsafe=function(e){return u(e)},a.allocUnsafeSlow=function(e){return u(e)},a.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==a.prototype},a.compare=function(e,t){if(U(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),U(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(e)||!a.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=a.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(U(o,Uint8Array))i+o.length>r.length?a.from(o).copy(r,i):Uint8Array.prototype.set.call(r,o,i);else{if(!a.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i)}i+=o.length}return r},a.byteLength=f,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},a.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?T(this,0,e):g.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(e){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},i&&(a.prototype[i]=a.prototype.inspect),a.prototype.compare=function(e,t,n,r,i){if(U(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),l=Math.min(o,s),c=this.slice(r,i),u=e.slice(t,n),d=0;d<l;++d)if(c[d]!==u[d]){o=c[d],s=u[d];break}return o<s?-1:s<o?1:0},a.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},a.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},a.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return x(this,e,t,n);case"ascii":case"latin1":case"binary":return E(this,e,t,n);case"base64":return _(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var k=4096;function C(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function A(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function j(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=G[e[o]];return i}function I(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length-1;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function O(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function N(e,t,n,r,i,o){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function R(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function P(e,t,n,i,o){return t=+t,n>>>=0,o||R(e,0,n,4),r.write(e,t,n,i,23,4),n+4}function D(e,t,n,i,o){return t=+t,n>>>=0,o||R(e,0,n,8),r.write(e,t,n,i,52,8),n+8}a.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,a.prototype),r},a.prototype.readUintLE=a.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||O(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},a.prototype.readUintBE=a.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||O(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},a.prototype.readUint8=a.prototype.readUInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),this[e]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||O(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},a.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||O(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},a.prototype.readInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},a.prototype.readInt16LE=function(e,t){e>>>=0,t||O(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(e,t){e>>>=0,t||O(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return e>>>=0,t||O(e,4,this.length),r.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return e>>>=0,t||O(e,4,this.length),r.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return e>>>=0,t||O(e,8,this.length),r.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return e>>>=0,t||O(e,8,this.length),r.read(this,e,!1,52,8)},a.prototype.writeUintLE=a.prototype.writeUIntLE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||N(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||N(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},a.prototype.writeUint8=a.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,1,255,0),this[t]=255&e,t+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);N(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},a.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);N(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},a.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeFloatLE=function(e,t,n){return P(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return P(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return D(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return D(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,r){if(!a.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},a.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){var i=e.charCodeAt(0);("utf8"===r&&i<128||"latin1"===r)&&(e=i)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=a.isBuffer(e)?e:a.from(e,r),l=s.length;if(0===l)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-t;++o)this[o+t]=s[o%l]}return this};var M=/[^+/0-9A-Za-z-_]/g;function L(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function B(e){return t.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(M,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function F(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function U(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function H(e){return e!=e}var G=function(){for(var e=new Array(256),t=0;t<16;++t)for(var n=16*t,r=0;r<16;++r)e[n+r]="0123456789abcdef"[t]+"0123456789abcdef"[r];return e}()}).call(this)}).call(this,e("buffer").Buffer)},{"base64-js":224,buffer:226,ieee754:245}],227:[function(e,t,n){!function(){"use strict";var e={}.hasOwnProperty;function n(){for(var t=[],r=0;r<arguments.length;r++){var i=arguments[r];if(i){var o=typeof i;if("string"===o||"number"===o)t.push(i);else if(Array.isArray(i)){if(i.length){var s=n.apply(null,i);s&&t.push(s)}}else if("object"===o){if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]")){t.push(i.toString());continue}for(var a in i)e.call(i,a)&&i[a]&&t.push(a)}}}return t.join(" ")}void 0!==t&&t.exports?(n.default=n,t.exports=n):"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],(function(){return n})):window.classNames=n}()},{}],228:[function(e,t,n){function r(e){return Object.prototype.toString.call(e)}n.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===r(e)},n.isBoolean=function(e){return"boolean"==typeof e},n.isNull=function(e){return null===e},n.isNullOrUndefined=function(e){return null==e},n.isNumber=function(e){return"number"==typeof e},n.isString=function(e){return"string"==typeof e},n.isSymbol=function(e){return"symbol"==typeof e},n.isUndefined=function(e){return void 0===e},n.isRegExp=function(e){return"[object RegExp]"===r(e)},n.isObject=function(e){return"object"==typeof e&&null!==e},n.isDate=function(e){return"[object Date]"===r(e)},n.isError=function(e){return"[object Error]"===r(e)||e instanceof Error},n.isFunction=function(e){return"function"==typeof e},n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},n.isBuffer=e("buffer").Buffer.isBuffer},{buffer:226}],229:[function(e,t,n){var r,i;r=this,i=function(){var e=e||function(e,t){var n=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),r={},i=r.lib={},o=i.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=i.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var s=n[o>>>2]>>>24-o%4*8&255;t[r+o>>>2]|=s<<24-(r+o)%4*8}else for(o=0;o<i;o+=4)t[r+o>>>2]=n[o>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,r=[],i=function(t){t=t;var n=987654321,r=4294967295;return function(){var i=((n=36969*(65535&n)+(n>>16)&r)<<16)+(t=18e3*(65535&t)+(t>>16)&r)&r;return i/=4294967296,(i+=.5)*(e.random()>.5?1:-1)}},o=0;o<t;o+=4){var a=i(4294967296*(n||e.random()));n=987654071*a(),r.push(4294967296*a()|0)}return new s.init(r,t)}}),a=r.enc={},l=a.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new s.init(n,t/2)}},c=a.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new s.init(n,t)}},u=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},d=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,o=this.blockSize,a=i/(4*o),l=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,c=e.min(4*l,i);if(l){for(var u=0;u<l;u+=o)this._doProcessBlock(r,u);var d=r.splice(0,l);n.sigBytes-=c}return new s.init(d,c)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),p=(i.Hasher=d.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new p.HMAC.init(e,n).finalize(t)}}}),r.algo={});return r}(Math);return e},"object"==typeof n?t.exports=n=i():"function"==typeof define&&define.amd?define([],i):r.CryptoJS=i()},{}],230:[function(e,t,n){var r,i;r=this,i=function(e){var t,n,r,i,o,s,a;return n=(t=e).lib,r=n.WordArray,i=n.Hasher,o=t.algo,s=[],a=o.SHA1=i.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],a=n[3],l=n[4],c=0;c<80;c++){if(c<16)s[c]=0|e[t+c];else{var u=s[c-3]^s[c-8]^s[c-14]^s[c-16];s[c]=u<<1|u>>>31}var d=(r<<5|r>>>27)+l+s[c];d+=c<20?1518500249+(i&o|~i&a):c<40?1859775393+(i^o^a):c<60?(i&o|i&a|o&a)-1894007588:(i^o^a)-899497514,l=a,a=o,o=i<<30|i>>>2,i=r,r=d}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}}),t.SHA1=i._createHelper(a),t.HmacSHA1=i._createHmacHelper(a),e.SHA1},"object"==typeof n?t.exports=n=i(e("./core")):"function"==typeof define&&define.amd?define(["./core"],i):i(r.CryptoJS)},{"./core":229}],231:[function(e,t,n){(function(e,r){(function(){var i,o;i=self,o=()=>(()=>{var t={"./externals/base64.js":(e,t)=>{var n=function(e){for(var t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?(t.push(192|r>>6),t.push(128|63&r)):r<65536?(t.push(224|r>>12),t.push(128|63&r>>6),t.push(128|63&r)):(t.push(240|r>>18),t.push(128|63&r>>12),t.push(128|63&r>>6),t.push(128|63&r))}return t},r=function(e){for(var t=[],n=0;n<e.length;){var r=e[n++];r<128||(r<224?(r=(31&r)<<6,r|=63&e[n++]):r<240?(r=(15&r)<<12,r|=(63&e[n++])<<6,r|=63&e[n++]):(r=(7&r)<<18,r|=(63&e[n++])<<12,r|=(63&e[n++])<<6,r|=63&e[n++])),t.push(String.fromCharCode(r))}return t.join("")},i={};!function(e){var t=function(t){for(var n=0,r=[],i=0|t.length/3;0<i--;){var o=(t[n]<<16)+(t[n+1]<<8)+t[n+2];n+=3,r.push(e.charAt(63&o>>18)),r.push(e.charAt(63&o>>12)),r.push(e.charAt(63&o>>6)),r.push(e.charAt(63&o))}return 2==t.length-n?(o=(t[n]<<16)+(t[n+1]<<8),r.push(e.charAt(63&o>>18)),r.push(e.charAt(63&o>>12)),r.push(e.charAt(63&o>>6)),r.push("=")):1==t.length-n&&(o=t[n]<<16,r.push(e.charAt(63&o>>18)),r.push(e.charAt(63&o>>12)),r.push("==")),r.join("")},o=function(){for(var t=[],n=0;n<e.length;++n)t[e.charCodeAt(n)]=n;return t["=".charCodeAt(0)]=0,t}(),l=function(e){for(var t=0,n=[],r=0|e.length/4;0<r--;){var i=(o[e.charCodeAt(t)]<<18)+(o[e.charCodeAt(t+1)]<<12)+(o[e.charCodeAt(t+2)]<<6)+o[e.charCodeAt(t+3)];n.push(255&i>>16),n.push(255&i>>8),n.push(255&i),t+=4}return n&&("="==e.charAt(t-2)?(n.pop(),n.pop()):"="==e.charAt(t-1)&&n.pop()),n},c=function(e){for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t},u=function(e){for(var t=0;t<s.length;++t)a[t]=String.fromCharCode(a[t]);return a.join("")};i.decodeArray=function(e){var t=l(e);return new Uint8Array(t)},i.encodeASCII=function(e){var n=c(e);return t(n)},i.decodeASCII=function(e){var t=l(e);return u(t)},i.encode=function(e){var r=n(e);return t(r)},i.decode=function(e){var t=l(e);return r(t)}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),t.decode=i.decode,t.decodeArray=i.decodeArray,t.encode=i.encode,t.encodeASCII=i.encodeASCII},"./externals/cea608-parser.js":(e,t)=>{!function(e){"use strict";var t={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},n=function(e){var n=e;return t.hasOwnProperty(e)&&(n=t[e]),String.fromCharCode(n)},r={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},i={17:2,18:4,21:6,22:8,23:10,19:13,20:15},o={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},s={25:2,26:4,29:6,30:8,31:10,27:13,28:15},a=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],l={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var n=this.verboseFilter[e];this.verboseLevel>=n&&console.log(this.time+" ["+e+"] "+t)}},c=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},u=function(e,t,n,r,i){this.foreground=e||"white",this.underline=t||!1,this.italics=n||!1,this.background=r||"black",this.flash=i||!1};u.prototype={reset:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},setStyles:function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}},isDefault:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},equals:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},copy:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},toString:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}};var d=function(e,t,n,r,i,o){this.uchar=e||" ",this.penState=new u(t,n,r,i,o)};d.prototype={reset:function(){this.uchar=" ",this.penState.reset()},setChar:function(e,t){this.uchar=e,this.penState.copy(t)},setPenState:function(e){this.penState.copy(e)},equals:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},copy:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},isEmpty:function(){return" "===this.uchar&&this.penState.isDefault()}};var p=function(){this.chars=[];for(var e=0;e<32;e++)this.chars.push(new d);this.pos=0,this.currPenState=new u};p.prototype={equals:function(e){for(var t=!0,n=0;n<32;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t},copy:function(e){for(var t=0;t<32;t++)this.chars[t].copy(e.chars[t])},isEmpty:function(){for(var e=!0,t=0;t<32;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},setCursor:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(l.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>32&&(l.log("ERROR","Too large cursor position "+this.pos),this.pos=32)},moveCursor:function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)},backSpace:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},insertChar:function(e){e>=144&&this.backSpace();var t=n(e);this.pos>=32?l.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},clearFromPos:function(e){var t;for(t=e;t<32;t++)this.chars[t].reset()},clear:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},clearToEndOfRow:function(){this.clearFromPos(this.pos)},getTextString:function(){for(var e=[],t=!0,n=0;n<32;n++){var r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")},setPenStyles:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}};var h=function(){this.rows=[];for(var e=0;e<15;e++)this.rows.push(new p);this.currRow=14,this.nrRollUpRows=null,this.reset()};h.prototype={reset:function(){for(var e=0;e<15;e++)this.rows[e].clear();this.currRow=14},equals:function(e){for(var t=!0,n=0;n<15;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t},copy:function(e){for(var t=0;t<15;t++)this.rows[t].copy(e.rows[t])},isEmpty:function(){for(var e=!0,t=0;t<15;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},backSpace:function(){this.rows[this.currRow].backSpace()},clearToEndOfRow:function(){this.rows[this.currRow].clearToEndOfRow()},insertChar:function(e){this.rows[this.currRow].insertChar(e)},setPen:function(e){this.rows[this.currRow].setPenStyles(e)},moveCursor:function(e){this.rows[this.currRow].moveCursor(e)},setCursor:function(e){l.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},setPAC:function(e){l.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.currRow=t;var n=this.rows[this.currRow];if(null!==e.indent){var r=e.indent,i=Math.max(r-1,0);n.setCursor(e.indent),e.color=n.chars[i].penState.foreground}var o={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(o)},setBkgData:function(e){l.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},setRollUpRows:function(e){this.nrRollUpRows=e},rollUp:function(){if(null!==this.nrRollUpRows){l.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),l.log("INFO","Rolling up")}else l.log("DEBUG","roll_up but nrRollUpRows not set yet")},getDisplayText:function(e){e=e||!1;for(var t=[],n="",r=-1,i=0;i<15;i++){var o=this.rows[i].getTextString();o&&(r=i+1,e?t.push("Row "+r+': "'+o+'"'):t.push(o.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n},getTextAndFormat:function(){return this.rows}};var f=function(e,t){this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new h,this.nonDisplayedMemory=new h,this.lastOutputScreen=new h,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null};f.prototype={modes:["MODE_ROLL-UP","MODE_POP-ON","MODE_PAINT-ON","MODE_TEXT"],reset:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},getHandler:function(){return this.outputFilter},setHandler:function(e){this.outputFilter=e},setPAC:function(e){this.writeScreen.setPAC(e)},setBkgData:function(e){this.writeScreen.setBkgData(e)},setMode:function(e){e!==this.mode&&(this.mode=e,l.log("INFO","MODE="+e),"MODE_POP-ON"==this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},insertChars:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";l.log("INFO",n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(l.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function(){l.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},cc_BS:function(){l.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function(){},cc_AON:function(){},cc_DER:function(){l.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},cc_RU:function(e){l.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},cc_FON:function(){l.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function(){l.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function(){l.log("INFO","TR"),this.setMode("MODE_TEXT")},cc_RTD:function(){l.log("INFO","RTD"),this.setMode("MODE_TEXT")},cc_EDM:function(){l.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()},cc_CR:function(){l.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()},cc_ENM:function(){l.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},cc_EOC:function(){if(l.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,l.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()},cc_TO:function(e){l.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},cc_MIDROW:function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var n=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}l.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},outputDataUpdate:function(){var e=l.time;null!==e&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},cueSplitAtTime:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}};var g=function(e,t,n){this.field=e||1,this.outputs=[t,n],this.channels=[new f(1,t),new f(2,n)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}};g.prototype={getHandler:function(e){return this.channels[e].getHandler()},setHandler:function(e,t){this.channels[e].setHandler(t)},addData:function(e,t){var n,r,i,o=!1;this.lastTime=e,l.setTime(e);for(var s=0;s<t.length;s+=2)r=127&t[s],i=127&t[s+1],r>=16&&r<=31&&r===this.lastCmdA&&i===this.lastCmdB?(this.lastCmdA=null,this.lastCmdB=null,l.log("DEBUG","Repeated command ("+c([r,i])+") is dropped")):0!==r||0!==i?(l.log("DATA","["+c([t[s],t[s+1]])+"] -> ("+c([r,i])+")"),(n=this.parseCmd(r,i))||(n=this.parseMidrow(r,i)),n||(n=this.parsePAC(r,i)),n||(n=this.parseBackgroundAttributes(r,i)),n||(o=this.parseChars(r,i))&&(this.currChNr&&this.currChNr>=0?this.channels[this.currChNr-1].insertChars(o):l.log("WARNING","No channel found yet. TEXT-MODE?")),n?this.dataCounters.cmd+=2:o?this.dataCounters.char+=2:(this.dataCounters.other+=2,l.log("WARNING","Couldn't parse cleaned data "+c([r,i])+" orig: "+c([t[s],t[s+1]])))):this.dataCounters.padding+=2},parseCmd:function(e,t){var n;if(!((20===e||21===e||28===e||29===e)&&32<=t&&t<=47||(23===e||31===e)&&33<=t&&t<=35))return!1;n=20===e||21===e||23===e?1:2;var r=this.channels[n-1];return 20===e||21===e||28===e||29===e?32===t?r.cc_RCL():33===t?r.cc_BS():34===t?r.cc_AOF():35===t?r.cc_AON():36===t?r.cc_DER():37===t?r.cc_RU(2):38===t?r.cc_RU(3):39===t?r.cc_RU(4):40===t?r.cc_FON():41===t?r.cc_RDC():42===t?r.cc_TR():43===t?r.cc_RTD():44===t?r.cc_EDM():45===t?r.cc_CR():46===t?r.cc_ENM():47===t&&r.cc_EOC():r.cc_TO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0},parseMidrow:function(e,t){var n=null;if((17===e||25===e)&&32<=t&&t<=47){if((n=17===e?1:2)!==this.currChNr)return l.log("ERROR","Mismatch channel in midrow parsing"),!1;var r=this.channels[n-1];return r.insertChars([32]),r.cc_MIDROW(t),l.log("DEBUG","MIDROW ("+c([e,t])+")"),this.lastCmdA=e,this.lastCmdB=t,!0}return!1},parsePAC:function(e,t){var n,a;if(!((17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127||(16===e||24===e)&&64<=t&&t<=95))return!1;n=e<=23?1:2,a=64<=t&&t<=95?1===n?r[e]:o[e]:1===n?i[e]:s[e];var l=this.interpretPAC(a,t);return this.channels[n-1].setPAC(l),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0},interpretPAC:function(e,t){var n,r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r},parseChars:function(e,t){var r,i=null,o=null,s=null;(e>=25?(i=2,s=e-8):(i=1,s=e),17<=s&&s<=19)?(r=17===s?t+80:18===s?t+112:t+144,l.log("INFO","Special char '"+n(r)+"' in channel "+i),o=[r],this.lastCmdA=e,this.lastCmdB=t):32<=e&&e<=127&&(o=0===t?[e]:[e,t],this.lastCmdA=null,this.lastCmdB=null);if(o){var a=c(o);l.log("DEBUG","Char codes =  "+a.join(","))}return o},parseBackgroundAttributes:function(e,t){var n,r,i;return((16===e||24===e)&&32<=t&&t<=47||(23===e||31===e)&&45<=t&&t<=47)&&(n={},16===e||24===e?(r=Math.floor((t-32)/2),n.background=a[r],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0)),i=e<24?1:2,this.channels[i-1].setBkgData(n),this.lastCmdA=e,this.lastCmdB=t,!0)},reset:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},cueSplitAtTime:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}},e.logger=l,e.PenState=u,e.CaptionScreen=h,e.Cea608Parser=g,e.findCea608Nalus=function(e,t,n){for(var r=0,i=t,o=[],s=function(e,t,n,r){if(4!==e||t<8)return null;var i=n.getUint8(r),o=n.getUint16(r+1),s=n.getUint32(r+3),a=n.getUint8(r+7);return 181==i&&49==o&&1195456820==s&&3==a};i<t+n;){if(r=e.getUint32(i),6==(31&e.getUint8(i+4)))for(var a=i+5,l=-1;a<i+4+r-1;){l=0;for(var c=255;255===c;)l+=c=e.getUint8(a),a++;var u=0;for(c=255;255===c;)u+=c=e.getUint8(a),a++;s(l,u,e,a)&&o.push([a,u]),a+=u}i+=r+4}return o},e.extractCea608DataFromRange=function(e,t){var n=t[0],r=[[],[]];n+=8;var i=31&e.getUint8(n);n+=2;for(var o=0;o<i;o++){var s=e.getUint8(n),a=4&s,l=3&s;n++;var c=e.getUint8(n);n++;var u=e.getUint8(n);n++,a&&(127&c)+(127&u)!=0&&(0===l?(r[0].push(c),r[0].push(u)):1===l&&(r[1].push(c),r[1].push(u)))}return r}}(t)},"./externals/xml2json.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function(e){void 0===(e=e||{}).escapeMode&&(e.escapeMode=!0),void 0===e.attributePrefix&&(e.attributePrefix="_"),e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0),e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0),void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0),e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[],void 0===e.useDoubleQuotes&&(e.useDoubleQuotes=!1),e.xmlElementsFilter=e.xmlElementsFilter||[],e.jsonPropertiesFilter=e.jsonPropertiesFilter||[],void 0===e.keepCData&&(e.keepCData=!1),void 0===e.ignoreRoot&&(e.ignoreRoot=!1);var t=1,n=3,r=4,i=8,o=9;function s(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function a(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e}function l(e,t,n,r){for(var i=0;i<e.length;i++){var o=e[i];if("string"==typeof o){if(o==r)break}else if(o instanceof RegExp){if(o.test(r))break}else if("function"==typeof o&&o(t,n,r))break}return i!=e.length}function c(t,n,r){switch(e.arrayAccessForm){case"property":t[n]instanceof Array?t[n+"_asArray"]=t[n]:t[n+"_asArray"]=[t[n]]}!(t[n]instanceof Array)&&e.arrayAccessFormPaths.length>0&&l(e.arrayAccessFormPaths,t,n,r)&&(t[n]=[t[n]])}function u(e){var t=e.split(/[-T:+Z]/g),n=new Date(t[0],t[1]-1,t[2]),r=t[5].split(".");if(n.setHours(t[3],t[4],r[0]),r.length>1&&n.setMilliseconds(r[1]),t[6]&&t[7]){var i=60*t[6]+Number(t[7]);i=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*i:i),n.setMinutes(n.getMinutes()-i-n.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())));return n}function d(n,r,i,o){return!(r==t&&e.xmlElementsFilter.length>0)||l(e.xmlElementsFilter,n,i,o)}function p(a,h){if(a.nodeType==o){for(var f=new Object,g=a.childNodes,m=0;m<g.length;m++)(y=g[m]).nodeType==t&&(e.ignoreRoot?f=p(y):(f={})[b=s(y)]=p(y));return f}if(a.nodeType==t){(f=new Object).__cnt=0;var v=[];for(g=a.childNodes,m=0;m<g.length;m++){var y,b=s(y=g[m]);if(y.nodeType!=i){var x=h+"."+b;if(d(f,y.nodeType,b,x))if(f.__cnt++,null==f[b]){var E=p(y,x);("#text"!=b||/[^\s]/.test(E))&&((_={})[b]=E,v.push(_)),f[b]=E,c(f,b,x)}else{var _;null!=f[b]&&(f[b]instanceof Array||(f[b]=[f[b]],c(f,b,x))),E=p(y,x),("#text"!=b||/[^\s]/.test(E))&&((_={})[b]=E,v.push(_)),f[b][f[b].length]=E}}}f.__children=v;for(var w=s(a),S=0;S<a.attributes.length;S++){var T=a.attributes[S];f.__cnt++;for(var k=T.value,C=0,A=e.matchers.length;C<A;C++){var j=e.matchers[C];j.test(T,w)&&(k=j.converter(T.value))}f[e.attributePrefix+T.name]=k}var I=function(e){return e.prefix}(a);return null!=I&&""!=I&&(f.__cnt++,f.__prefix=I),null!=f["#text"]&&(f.__text=f["#text"],f.__text instanceof Array&&(f.__text=f.__text.join("\n")),e.stripWhitespaces&&(f.__text=f.__text.trim()),delete f["#text"],"property"==e.arrayAccessForm&&delete f["#text_asArray"],f.__text=function(t,n,r){if(e.datetimeAccessFormPaths.length>0){var i=r.split(".#")[0];return l(e.datetimeAccessFormPaths,t,n,i)?u(t):t}return t}(f.__text,b,h+"."+b)),null!=f["#cdata-section"]&&(f.__cdata=f["#cdata-section"],delete f["#cdata-section"],"property"==e.arrayAccessForm&&delete f["#cdata-section_asArray"]),0==f.__cnt&&"text"==e.emptyNodeForm?f="":1==f.__cnt&&null!=f.__text?f=f.__text:1!=f.__cnt||null==f.__cdata||e.keepCData?f.__cnt>1&&null!=f.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==f.__text||""==f.__text.trim())&&delete f.__text:f=f.__cdata,delete f.__cnt,!e.enableToStringFunc||null==f.__text&&null==f.__cdata||(f.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),f}if(a.nodeType==n||a.nodeType==r)return a.nodeValue}function h(t,n,r,i){var o="<"+(null!=t&&null!=t.__prefix?t.__prefix+":":"")+n;if(null!=r)for(var s=0;s<r.length;s++){var l=r[s],c=t[l];e.escapeMode&&(c=a(c)),o+=" "+l.substr(e.attributePrefix.length)+"=",e.useDoubleQuotes?o+='"'+c+'"':o+="'"+c+"'"}return o+(i?"/>":">")}function f(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function g(t,n){return"property"==e.arrayAccessForm&&(i="_asArray",-1!==(r=n.toString()).indexOf(i,r.length-i.length))||0==n.toString().indexOf(e.attributePrefix)||0==n.toString().indexOf("__")||t[n]instanceof Function;var r,i}function m(e){var t=0;if(e instanceof Object)for(var n in e)g(e,n)||t++;return t}function v(t,n,r){return 0==e.jsonPropertiesFilter.length||""==r||l(e.jsonPropertiesFilter,t,n,r)}function y(t){var n=[];if(t instanceof Object)for(var r in t)-1==r.toString().indexOf("__")&&0==r.toString().indexOf(e.attributePrefix)&&n.push(r);return n}function b(t){var n="";return t instanceof Object?n+=function(t){var n="";return null!=t.__cdata&&(n+="<![CDATA["+t.__cdata+"]]>"),null!=t.__text&&(e.escapeMode?n+=a(t.__text):n+=t.__text),n}(t):null!=t&&(e.escapeMode?n+=a(t):n+=t),n}function x(e,t){return""===e?t:e+"."+t}function E(e,t,n,r){var i="";if(0==e.length)i+=h(e,t,n,!0);else for(var o=0;o<e.length;o++)i+=h(e[o],t,y(e[o]),!1),i+=_(e[o],x(r,t)),i+=f(e[o],t);return i}function _(e,t){var n="";if(m(e)>0)for(var r in e)if(!g(e,r)&&(""==t||v(e,r,x(t,r)))){var i=e[r],o=y(i);null==i||null==i?n+=h(i,r,o,!0):i instanceof Object?i instanceof Array?n+=E(i,r,o,t):i instanceof Date?(n+=h(i,r,o,!1),n+=i.toISOString(),n+=f(i,r)):m(i)>0||null!=i.__text||null!=i.__cdata?(n+=h(i,r,o,!1),n+=_(i,x(t,r)),n+=f(i,r)):n+=h(i,r,o,!0):(n+=h(i,r,o,!1),n+=b(i),n+=f(i,r))}return n+b(e)}this.parseXmlString=function(e){var t;if(window.ActiveXObject||window,void 0===e)return null;if(window.DOMParser){var n=new window.DOMParser;try{(t=n.parseFromString(e,"text/xml")).getElementsByTagNameNS("*","parsererror").length>0&&(t=null)}catch(e){t=null}}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e);return t},this.asArray=function(e){return void 0===e||null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?u(e):e},this.xml2json=function(e){return p(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return null!=t?this.xml2json(t):null},this.json2xml_str=function(e){return _(e,"")},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return"1.2.0"}}},"./index_mediaplayerOnly.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{Debug:()=>o.default,FactoryMaker:()=>i.default,MediaPlayer:()=>r.default,default:()=>c});var r=n("./src/streaming/MediaPlayer.js"),i=n("./src/core/FactoryMaker.js"),o=n("./src/core/Debug.js"),s=n("./src/core/Version.js"),a=(n("./node_modules/es6-promise/auto.js"),"undefined"!=typeof window&&window||n.g),l=a.dashjs;l||(l=a.dashjs={}),l.MediaPlayer=r.default,l.FactoryMaker=i.default,l.Debug=o.default,l.Version=(0,s.getVersionString)();const c=l},"./src/core/Debug.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>h});var r=n("./src/core/EventBus.js"),i=n("./src/core/events/Events.js"),o=n("./src/core/FactoryMaker.js"),s=1,a=2,l=3,c=4,u=5;function d(e){e=e||{};var t,n,o,d,p=this.context,h=(0,r.default)(p).getInstance(),f=e.settings,g=[];function m(e){return e&&e.bind?e.bind(window.console):window.console.log.bind(window.console)}function v(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];_.apply(void 0,[s,this].concat(t))}function y(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];_.apply(void 0,[a,this].concat(t))}function b(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];_.apply(void 0,[l,this].concat(t))}function x(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];_.apply(void 0,[c,this].concat(t))}function E(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];_.apply(void 0,[u,this].concat(t))}function _(e,t){var r="",s=null;n&&(s=(new Date).getTime(),r+="["+(s-d)+"]"),o&&t&&t.getClassName&&(r+="["+t.getClassName()+"]",t.getType&&(r+="["+t.getType()+"]")),r.length>0&&(r+=" ");for(var a=arguments.length,l=new Array(a>2?a-2:0),c=2;c<a;c++)l[c-2]=arguments[c];Array.apply(null,l).forEach((function(e){r+=e+" "})),g[e]&&f&&f.get().debug.logLevel>=e&&g[e](r),f&&f.get().debug.dispatchEvent&&h.trigger(i.default.LOG,{message:r,level:e})}return t={getLogger:function(e){return{fatal:v.bind(e),error:y.bind(e),warn:b.bind(e),info:x.bind(e),debug:E.bind(e)}},setLogTimestampVisible:function(e){n=e},setCalleeNameVisible:function(e){o=e}},n=!0,o=!0,d=(new Date).getTime(),"undefined"!=typeof window&&window.console&&(g[s]=m(window.console.error),g[a]=m(window.console.error),g[l]=m(window.console.warn),g[c]=m(window.console.info),g[u]=m(window.console.debug)),t}d.__dashjs_factory_name="Debug";var p=o.default.getSingletonFactory(d);p.LOG_LEVEL_NONE=0,p.LOG_LEVEL_FATAL=s,p.LOG_LEVEL_ERROR=a,p.LOG_LEVEL_WARNING=l,p.LOG_LEVEL_INFO=c,p.LOG_LEVEL_DEBUG=u,o.default.updateSingletonFactory(d.__dashjs_factory_name,p);const h=p},"./src/core/EventBus.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/MediaPlayerEvents.js");function o(){var e={};function t(t,n,r){var i=-1;return e[t]?(e[t].some((function(e,t){if(e&&e.callback===n&&(!r||r===e.scope))return i=t,!0})),i):i}return{on:function(n,r,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!n)throw new Error("event type cannot be null or undefined");if(!r||"function"!=typeof r)throw new Error("listener must be a function: "+r);var s=o.priority||0;if(!(t(n,r,i)>=0)){e[n]=e[n]||[];var a={callback:r,scope:i,priority:s};i&&i.getStreamId&&(a.streamId=i.getStreamId()),i&&i.getType&&(a.mediaType=i.getType()),o&&o.mode&&(a.mode=o.mode),e[n].some((function(t,r){if(t&&s>t.priority)return e[n].splice(r,0,a),!0}))||e[n].push(a)}},off:function(n,r,i){if(n&&r&&e[n]){var o=t(n,r,i);o<0||(e[n][o]=null)}},trigger:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t&&e[t]){if((n=n||{}).hasOwnProperty("type"))throw new Error("'type' is a reserved word for event dispatching");n.type=t,r.streamId&&(n.streamId=r.streamId),r.mediaType&&(n.mediaType=r.mediaType),e[t].filter((function(e){return!(!e||r.streamId&&e.streamId&&e.streamId!==r.streamId||r.mediaType&&e.mediaType&&e.mediaType!==r.mediaType||r.mode&&e.mode&&e.mode!==r.mode||!e.mode&&r.mode&&r.mode===i.default.EVENT_MODE_ON_RECEIVE)})).forEach((function(e){return e&&e.callback.call(e.scope,n)}))}},reset:function(){e={}}}}o.__dashjs_factory_name="EventBus";var s=r.default.getSingletonFactory(o);s.EVENT_PRIORITY_LOW=0,s.EVENT_PRIORITY_HIGH=5e3,r.default.updateSingletonFactory(o.__dashjs_factory_name,s);const a=s},"./src/core/FactoryMaker.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function(){var e,t=[],n={},r={};function i(e,n){for(var r in t){var i=t[r];if(i.context===e&&i.name===n)return i.instance}return null}function o(e,t){return t[e]}function s(e,t,n){e in n&&(n[e]=t)}function a(t,n,r){var i,o=t.__dashjs_factory_name,s=n[o];if(s){var a=s.instance;if(!s.override)return a.apply({context:n,factory:e},r);for(var l in i=t.apply({context:n},r),a=a.apply({context:n,factory:e,parent:i},r))i.hasOwnProperty(l)&&(i[l]=a[l])}else i=t.apply({context:n},r);return i.getClassName=function(){return o},i}return e={extend:function(e,t,n,r){!r[e]&&t&&(r[e]={instance:t,override:n})},getSingletonInstance:i,setSingletonInstance:function(e,n,r){for(var i in t){var o=t[i];if(o.context===e&&o.name===n)return void(t[i].instance=r)}t.push({name:n,context:e,instance:r})},deleteSingletonInstances:function(e){t=t.filter((function(t){return t.context!==e}))},getSingletonFactory:function(e){var r=o(e.__dashjs_factory_name,n);return r||(r=function(n){var r;return void 0===n&&(n={}),{getInstance:function(){return r||(r=i(n,e.__dashjs_factory_name)),r||(r=a(e,n,arguments),t.push({name:e.__dashjs_factory_name,context:n,instance:r})),r}}},n[e.__dashjs_factory_name]=r),r},getSingletonFactoryByName:function(e){return o(e,n)},updateSingletonFactory:function(e,t){s(e,t,n)},getClassFactory:function(e){var t=o(e.__dashjs_factory_name,r);return t||(t=function(t){return void 0===t&&(t={}),{create:function(){return a(e,t,arguments)}}},r[e.__dashjs_factory_name]=t),t},getClassFactoryByName:function(e){return o(e,r)},updateClassFactory:function(e,t){s(e,t,r)}}}()},"./src/core/Settings.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>h});var r=n("./src/core/FactoryMaker.js"),i=n("./src/core/Utils.js"),o=n("./src/core/Debug.js"),s=n("./src/streaming/constants/Constants.js"),a=n("./src/streaming/vo/metrics/HTTPRequest.js"),l=n("./src/core/EventBus.js"),c=n("./src/core/events/Events.js");function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(){var e,t,n=this.context,r=(0,l.default)(n).getInstance(),p={"streaming.delay.liveDelay":c.default.SETTING_UPDATED_LIVE_DELAY,"streaming.delay.liveDelayFragmentCount":c.default.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,"streaming.liveCatchup.enabled":c.default.SETTING_UPDATED_CATCHUP_ENABLED,"streaming.liveCatchup.playbackRate.min":c.default.SETTING_UPDATED_PLAYBACK_RATE_MIN,"streaming.liveCatchup.playbackRate.max":c.default.SETTING_UPDATED_PLAYBACK_RATE_MAX},h={debug:{logLevel:o.default.LOG_LEVEL_WARNING,dispatchEvent:!1},streaming:{abandonLoadTimeout:1e4,wallclockTimeUpdateInterval:100,manifestUpdateRetryInterval:100,cacheInitSegments:!1,applyServiceDescription:!0,applyProducerReferenceTime:!0,applyContentSteering:!0,eventControllerRefreshDelay:100,enableManifestDurationMismatchFix:!0,enableManifestTimescaleMismatchFix:!1,capabilities:{filterUnsupportedEssentialProperties:!0,useMediaCapabilitiesApi:!1},timeShiftBuffer:{calcFromSegmentTimeline:!1,fallbackToSegmentTimeline:!0},metrics:{maxListDepth:100},delay:{liveDelayFragmentCount:NaN,liveDelay:NaN,useSuggestedPresentationDelay:!0},protection:{keepProtectionMediaKeys:!1,ignoreEmeEncryptedEvent:!1,detectPlayreadyMessageFormat:!0},buffer:{enableSeekDecorrelationFix:!1,fastSwitchEnabled:!0,flushBufferAtTrackSwitch:!1,reuseExistingSourceBuffers:!0,bufferPruningInterval:10,bufferToKeep:20,bufferTimeAtTopQuality:30,bufferTimeAtTopQualityLongForm:60,initialBufferLevel:NaN,stableBufferTime:12,longFormContentDurationThreshold:600,stallThreshold:.3,useAppendWindow:!0,setStallState:!0,avoidCurrentTimeRangePruning:!1,useChangeTypeForTrackSwitch:!0},gaps:{jumpGaps:!0,jumpLargeGaps:!0,smallGapLimit:1.5,threshold:.3,enableSeekFix:!0,enableStallFix:!1,stallSeek:.1},utcSynchronization:{enabled:!0,useManifestDateHeaderTimeSource:!0,backgroundAttempts:2,timeBetweenSyncAttempts:30,maximumTimeBetweenSyncAttempts:600,minimumTimeBetweenSyncAttempts:2,timeBetweenSyncAttemptsAdjustmentFactor:2,maximumAllowedDrift:100,enableBackgroundSyncAfterSegmentDownloadError:!0,defaultTimingSource:{scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"https://time.akamai.com/?iso&ms"}},scheduling:{defaultTimeout:500,lowLatencyTimeout:0,scheduleWhilePaused:!0},text:{defaultEnabled:!0,extendSegmentedCues:!0,webvtt:{customRenderingEnabled:!1}},liveCatchup:{maxDrift:NaN,playbackRate:{min:NaN,max:NaN},playbackBufferMin:.5,enabled:null,mode:s.default.LIVE_CATCHUP_MODE_DEFAULT},lastBitrateCachingInfo:{enabled:!0,ttl:36e4},lastMediaSettingsCachingInfo:{enabled:!0,ttl:36e4},cacheLoadThresholds:{video:50,audio:5},trackSwitchMode:{audio:s.default.TRACK_SWITCH_MODE_ALWAYS_REPLACE,video:s.default.TRACK_SWITCH_MODE_NEVER_REPLACE},selectionModeForInitialTrack:s.default.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY,fragmentRequestTimeout:2e4,manifestRequestTimeout:1e4,retryIntervals:(e={},d(e,a.HTTPRequest.MPD_TYPE,500),d(e,a.HTTPRequest.XLINK_EXPANSION_TYPE,500),d(e,a.HTTPRequest.MEDIA_SEGMENT_TYPE,1e3),d(e,a.HTTPRequest.INIT_SEGMENT_TYPE,1e3),d(e,a.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,1e3),d(e,a.HTTPRequest.INDEX_SEGMENT_TYPE,1e3),d(e,a.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE,1e3),d(e,a.HTTPRequest.LICENSE,1e3),d(e,a.HTTPRequest.OTHER_TYPE,1e3),d(e,"lowLatencyReductionFactor",10),e),retryAttempts:(t={},d(t,a.HTTPRequest.MPD_TYPE,3),d(t,a.HTTPRequest.XLINK_EXPANSION_TYPE,1),d(t,a.HTTPRequest.MEDIA_SEGMENT_TYPE,3),d(t,a.HTTPRequest.INIT_SEGMENT_TYPE,3),d(t,a.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,3),d(t,a.HTTPRequest.INDEX_SEGMENT_TYPE,3),d(t,a.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE,3),d(t,a.HTTPRequest.LICENSE,3),d(t,a.HTTPRequest.OTHER_TYPE,3),d(t,"lowLatencyMultiplyFactor",5),t),abr:{movingAverageMethod:s.default.MOVING_AVERAGE_SLIDING_WINDOW,ABRStrategy:s.default.ABR_STRATEGY_DYNAMIC,additionalAbrRules:{insufficientBufferRule:!0,switchHistoryRule:!0,droppedFramesRule:!0,abandonRequestsRule:!0},bandwidthSafetyFactor:.9,useDefaultABRRules:!0,useDeadTimeLatency:!0,limitBitrateByPortal:!1,usePixelRatioInLimitBitrateByPortal:!1,maxBitrate:{audio:-1,video:-1},minBitrate:{audio:-1,video:-1},maxRepresentationRatio:{audio:1,video:1},initialBitrate:{audio:-1,video:-1},initialRepresentationRatio:{audio:-1,video:-1},autoSwitchBitrate:{audio:!0,video:!0},fetchThroughputCalculationMode:s.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING},cmcd:{enabled:!1,sid:null,cid:null,rtp:null,rtpSafetyFactor:5,mode:s.default.CMCD_MODE_QUERY,enabledKeys:["br","d","ot","tb","bl","dl","mtp","nor","nrr","su","bs","rtp","cid","pr","sf","sid","st","v"]},cmsd:{enabled:!1,abr:{applyMb:!1,etpWeightRatio:0}}},errors:{recoverAttempts:{mediaErrorDecode:5}}},f=i.default.clone(h);return{get:function(){return f},update:function(e){"object"===u(e)&&function e(t,n,o){for(var s in t)t.hasOwnProperty(s)&&(n.hasOwnProperty(s)?"object"!==u(t[s])||t[s]instanceof Array||null===t[s]?(n[s]=i.default.clone(t[s]),p[o+s]&&r.trigger(p[o+s])):e(t[s],n[s],o.slice()+s+"."):console.error("Settings parameter "+o+s+" is not supported"))}(e,f,"")},reset:function(){f=i.default.clone(h)}}}p.__dashjs_factory_name="Settings";const h=r.default.getSingletonFactory(p)},"./src/core/Utils.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var r=n("./node_modules/path-browserify/index.js"),i=n.n(r),o=n("./node_modules/ua-parser-js/src/ua-parser.js");function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"mixin",value:function(t,n,r){var i,o={};if(t)for(var a in n)n.hasOwnProperty(a)&&(i=n[a],a in t&&(t[a]===i||a in o&&o[a]===i)||("object"===s(t[a])&&null!==t[a]?t[a]=e.mixin(t[a],i,r):t[a]=r(i)));return t}},{key:"clone",value:function(t){if(!t||"object"!==s(t))return t;var n;if(t instanceof Array){n=[];for(var r=0,i=t.length;r<i;++r)r in t&&n.push(e.clone(t[r]))}else n={};return e.mixin(n,t,e.clone)}},{key:"addAditionalQueryParameterToUrl",value:function(e,t){try{if(!t||0===t.length)return e;var n=new URL(e);return t.forEach((function(e){e.key&&e.value&&n.searchParams.set(e.key,e.value)})),n.href}catch(t){return e}}},{key:"parseHttpHeaders",value:function(e){var t={};if(!e)return t;for(var n=e.trim().split("\r\n"),r=0,i=n.length;r<i;r++){var o=n[r],s=o.indexOf(": ");s>0&&(t[o.substring(0,s)]=o.substring(s+2))}return t}},{key:"generateUuid",value:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)}))}},{key:"generateHashCode",value:function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}},{key:"getRelativeUrl",value:function(e,t){try{var n=new URL(e),r=new URL(t);if(n.protocol=r.protocol,n.origin!==r.origin)return t;var o=i().relative(n.pathname.substr(0,n.pathname.lastIndexOf("/")),r.pathname.substr(0,r.pathname.lastIndexOf("/"))),s=0===o.length?1:0;return o+=r.pathname.substr(r.pathname.lastIndexOf("/")+s,r.pathname.length-1),r.pathname.length<o.length?r.pathname:o}catch(e){return t}}},{key:"parseUserAgent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{var t=null===e&&"undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"";return(0,o.UAParser)(t)}catch(e){return{}}}}])&&a(t,n),e}()},"./src/core/Version.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{getVersionString:()=>function(){return r}});var r="4.6.0"},"./src/core/errors/Errors.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/core/errors/ErrorsBase.js");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const a=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(n,r.default);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var o=s(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,n)}}(n);function n(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(e=t.call(this)).MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE=10,e.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE=11,e.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE=12,e.SEGMENT_BASE_LOADER_ERROR_CODE=15,e.TIME_SYNC_FAILED_ERROR_CODE=16,e.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE=17,e.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE=18,e.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE=19,e.APPEND_ERROR_CODE=20,e.REMOVE_ERROR_CODE=21,e.DATA_UPDATE_FAILED_ERROR_CODE=22,e.CAPABILITY_MEDIASOURCE_ERROR_CODE=23,e.CAPABILITY_MEDIAKEYS_ERROR_CODE=24,e.DOWNLOAD_ERROR_ID_MANIFEST_CODE=25,e.DOWNLOAD_ERROR_ID_SIDX_CODE=26,e.DOWNLOAD_ERROR_ID_CONTENT_CODE=27,e.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE=28,e.DOWNLOAD_ERROR_ID_XLINK_CODE=29,e.MANIFEST_ERROR_ID_PARSE_CODE=31,e.MANIFEST_ERROR_ID_NOSTREAMS_CODE=32,e.TIMED_TEXT_ERROR_ID_PARSE_CODE=33,e.MANIFEST_ERROR_ID_MULTIPLEXED_CODE=34,e.MEDIASOURCE_TYPE_UNSUPPORTED_CODE=35,e.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE="parsing failed for ",e.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading manifest: ",e.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading Xlink element: ",e.SEGMENTS_UPDATE_FAILED_ERROR_MESSAGE="Segments update failed",e.SEGMENTS_UNAVAILABLE_ERROR_MESSAGE="no segments are available yet",e.SEGMENT_BASE_LOADER_ERROR_MESSAGE="error loading segment ranges from sidx",e.TIME_SYNC_FAILED_ERROR_MESSAGE="Failed to synchronize client and server time",e.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE="request is null",e.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE="Failed to resolve a valid URL",e.APPEND_ERROR_MESSAGE="chunk is not defined",e.REMOVE_ERROR_MESSAGE="Removing data from the SourceBuffer",e.DATA_UPDATE_FAILED_ERROR_MESSAGE="Data update failed",e.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE="mediasource is not supported",e.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE="mediakeys is not supported",e.TIMED_TEXT_ERROR_MESSAGE_PARSE="parsing error :",e.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE="Error creating source buffer of type : ",e}return n}())},"./src/core/errors/ErrorsBase.js":(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,{default:()=>i});const i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"extend",value:function(e,t){if(e){var n=!!t&&t.override,r=!!t&&t.publicOnly;for(var i in e)!e.hasOwnProperty(i)||this[i]&&!n||r&&-1===e[i].indexOf("public_")||(this[i]=e[i])}}}])&&r(t.prototype,n),e}()},"./src/core/events/CoreEvents.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/core/events/EventsBase.js");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const a=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(n,r.default);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var o=s(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,n)}}(n);function n(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(e=t.call(this)).ATTEMPT_BACKGROUND_SYNC="attemptBackgroundSync",e.BUFFERING_COMPLETED="bufferingCompleted",e.BUFFER_CLEARED="bufferCleared",e.BYTES_APPENDED_END_FRAGMENT="bytesAppendedEndFragment",e.BUFFER_REPLACEMENT_STARTED="bufferReplacementStarted",e.CHECK_FOR_EXISTENCE_COMPLETED="checkForExistenceCompleted",e.CMSD_STATIC_HEADER="cmsdStaticHeader",e.CURRENT_TRACK_CHANGED="currentTrackChanged",e.DATA_UPDATE_COMPLETED="dataUpdateCompleted",e.INBAND_EVENTS="inbandEvents",e.INITIAL_STREAM_SWITCH="initialStreamSwitch",e.INIT_FRAGMENT_LOADED="initFragmentLoaded",e.INIT_FRAGMENT_NEEDED="initFragmentNeeded",e.INTERNAL_MANIFEST_LOADED="internalManifestLoaded",e.ORIGINAL_MANIFEST_LOADED="originalManifestLoaded",e.LOADING_COMPLETED="loadingCompleted",e.LOADING_PROGRESS="loadingProgress",e.LOADING_DATA_PROGRESS="loadingDataProgress",e.LOADING_ABANDONED="loadingAborted",e.MANIFEST_UPDATED="manifestUpdated",e.MEDIA_FRAGMENT_LOADED="mediaFragmentLoaded",e.MEDIA_FRAGMENT_NEEDED="mediaFragmentNeeded",e.QUOTA_EXCEEDED="quotaExceeded",e.SEGMENT_LOCATION_BLACKLIST_ADD="segmentLocationBlacklistAdd",e.SEGMENT_LOCATION_BLACKLIST_CHANGED="segmentLocationBlacklistChanged",e.SERVICE_LOCATION_BLACKLIST_ADD="serviceLocationBlacklistAdd",e.SERVICE_LOCATION_BLACKLIST_CHANGED="serviceLocationBlacklistChanged",e.SET_FRAGMENTED_TEXT_AFTER_DISABLED="setFragmentedTextAfterDisabled",e.SET_NON_FRAGMENTED_TEXT="setNonFragmentedText",e.SOURCE_BUFFER_ERROR="sourceBufferError",e.STREAMS_COMPOSED="streamsComposed",e.STREAM_BUFFERING_COMPLETED="streamBufferingCompleted",e.STREAM_REQUESTING_COMPLETED="streamRequestingCompleted",e.TEXT_TRACKS_QUEUE_INITIALIZED="textTracksQueueInitialized",e.TIME_SYNCHRONIZATION_COMPLETED="timeSynchronizationComplete",e.UPDATE_TIME_SYNC_OFFSET="updateTimeSyncOffset",e.URL_RESOLUTION_FAILED="urlResolutionFailed",e.VIDEO_CHUNK_RECEIVED="videoChunkReceived",e.WALLCLOCK_TIME_UPDATED="wallclockTimeUpdated",e.XLINK_ELEMENT_LOADED="xlinkElementLoaded",e.XLINK_READY="xlinkReady",e.SEEK_TARGET="seekTarget",e.SETTING_UPDATED_LIVE_DELAY="settingUpdatedLiveDelay",e.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT="settingUpdatedLiveDelayFragmentCount",e.SETTING_UPDATED_CATCHUP_ENABLED="settingUpdatedCatchupEnabled",e.SETTING_UPDATED_PLAYBACK_RATE_MIN="settingUpdatedPlaybackRateMin",e.SETTING_UPDATED_PLAYBACK_RATE_MAX="settingUpdatedPlaybackRateMax",e}return n}()},"./src/core/events/Events.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/core/events/CoreEvents.js");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const a=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(n,r.default);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var o=s(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,n)}}(n);function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t.apply(this,arguments)}return n}())},"./src/core/events/EventsBase.js":(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,{default:()=>i});const i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"extend",value:function(e,t){if(e){var n=!!t&&t.override,r=!!t&&t.publicOnly;for(var i in e)!e.hasOwnProperty(i)||this[i]&&!n||r&&-1===e[i].indexOf("public_")||(this[i]=e[i])}}}])&&r(t.prototype,n),e}()},"./src/dash/DashAdapter.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>g});var r=n("./src/dash/constants/DashConstants.js"),i=n("./src/dash/vo/RepresentationInfo.js"),o=n("./src/dash/vo/MediaInfo.js"),s=n("./src/dash/vo/StreamInfo.js"),a=n("./src/dash/vo/ManifestInfo.js"),l=n("./src/dash/vo/Event.js"),c=n("./src/core/FactoryMaker.js"),u=n("./src/dash/models/DashManifestModel.js"),d=n("./src/dash/models/PatchManifestModel.js"),p=n("./node_modules/bcp-47-normalize/index.js"),h=n.n(p);function f(){var e,t,n,c,p,f,g,m=this.context;function v(e,n,i){var o,s=t.getAdaptationsForType(c[0].mpd.manifest,e,n);if(!s||0===s.length)return null;if(s.length>1&&i){var a=x(i,n);if(p[i.id]&&p[i.id][n])for(var l=0,u=s.length;l<u;l++)if(y(p[i.id][n],a[l]))return s[l];for(var d=0,h=s.length;d<h;d++)if(o=s[d],t.getRolesForAdaptation(o).filter((function(e){return e.value===r.default.MAIN}))[0])return s[d]}return s[0]}function y(e,t){if(!e||!t)return!1;var n=e.id===t.id,r=e.codec===t.codec,i=e.viewpoint===t.viewpoint,o=e.lang===t.lang,s=e.roles.toString()===t.roles.toString(),a=e.accessibility.toString()===t.accessibility.toString(),l=e.audioChannelConfiguration.toString()===t.audioChannelConfiguration.toString();return n&&r&&i&&o&&s&&a&&l}function b(e,n,r,i,o,s){var a,l,c,u,d,p,h=[];if(!i||0===i.length)return[];var g=t.getAdaptationsForPeriod(n);for(u=0,p=i.length;u<p;u++)if(a=i[u],l=C(g[c=t.getIndexForAdaptation(a,e,r.index)]),s){var m=l.accessibility.length;for(d=0;d<m;d++)if(l){var v=l.accessibility[d];if(0===v.indexOf("cea-608:")){var y=v.substring(8).split(";");if("CC"===y[0].substring(0,2))for(d=0;d<y.length;d++)l||(l=C.call(this,g[c])),A(l,y[d].substring(0,3),y[d].substring(4)),h.push(l),l=null;else for(d=0;d<y.length;d++)l||(l=C.call(this,g[c])),A(l,"CC"+(d+1),y[d]),h.push(l),l=null}else 0===v.indexOf("cea-608")&&(A(l,f.CC1,"eng"),h.push(l),l=null)}}else o===f.IMAGE?(l.type=f.IMAGE,h.push(l),l=null):l&&h.push(l);return h}function x(e,n,r){var i=c,o=r,s=[];if(o)I(),i=E(o);else{if(!(c.length>0))return s;o=c[0].mpd.manifest}var a=k(e,i),l=t.getAdaptationsForType(o,e?e.index:null,n);return s=b(o,a,e,l,n),n===f.TEXT&&(l=t.getAdaptationsForType(o,e?e.index:null,f.VIDEO),s=s.concat(b(o,a,e,l,n,!0))),s}function E(e){var n=_(e);return t.getRegularPeriods(n)}function _(e){var n=S(e);return t.getMpd(n)}function w(){c=[],p={}}function S(e){return e||(c.length>0?c[0].mpd.manifest:null)}function T(e){try{var n=k(e.streamInfo,c),r=t.getAdaptationsForPeriod(n);return e&&e.streamInfo&&void 0!==e.streamInfo.id&&r?r[e.index]:null}catch(e){return null}}function k(e,t){for(var n=t.length,r=0;r<n;r++){var i=t[r];if(e&&e.id===i.id)return i}return null}function C(e){if(!e)return null;var n,r=new o.default,i=e.period.mpd.manifest.Period_asArray[e.period.index].AdaptationSet_asArray[e.index];if(r.id=e.id,r.index=e.index,r.type=e.type,r.streamInfo=j(e.period),r.representationCount=t.getRepresentationCount(i),r.labels=t.getLabelsForAdaptation(i),r.lang=t.getLanguageForAdaptation(i),n=t.getViewpointForAdaptation(i),r.viewpoint=n?n.value:void 0,r.accessibility=t.getAccessibilityForAdaptation(i).map((function(e){var t=e.value,n=t;return e.schemeIdUri&&e.schemeIdUri.search("cea-608")>=0&&void 0!==g&&(n=t?"cea-608:"+t:"cea-608",r.embeddedCaptions=!0),n})),r.audioChannelConfiguration=t.getAudioChannelConfigurationForAdaptation(i).map((function(e){return e.value})),0===r.audioChannelConfiguration.length&&Array.isArray(i.Representation_asArray)&&i.Representation_asArray.length>0&&(r.audioChannelConfiguration=t.getAudioChannelConfigurationForRepresentation(i.Representation_asArray[0]).map((function(e){return e.value}))),r.roles=t.getRolesForAdaptation(i).map((function(e){return e.value})),r.codec=t.getCodec(i),r.mimeType=t.getMimeType(i),r.contentProtection=t.getContentProtectionData(i),r.bitrateList=t.getBitrateListForAdaptation(i),r.selectionPriority=t.getSelectionPriority(i),r.contentProtection){var s=r.contentProtection.map((function(e){return t.getKID(e)})).filter((function(e){return null!==e}));if(s.length){var a=s[0];r.contentProtection.forEach((function(e){e.keyId=a}))}}return r.isText=t.getIsText(i),r.supplementalProperties=t.getSupplementalProperties(i),r.isFragmented=t.getIsFragmented(i),r.isEmbedded=!1,r}function A(e,t,n){e.id=t,e.index=100+parseInt(t.substring(2,3)),e.type=f.TEXT,e.codec="cea-608-in-SEI",e.isEmbedded=!0,e.isFragmented=!1,e.lang=h()(n),e.roles=["caption"]}function j(e){var n,r,i=new s.default;return i.id=e.id,i.index=e.index,i.start=e.start,i.duration=e.duration,i.manifestInfo=(n=e.mpd,(r=new a.default).dvrWindowSize=n.timeShiftBufferDepth,r.loadedTime=n.manifest.loadedTime,r.availableFrom=n.availabilityStartTime,r.minBufferTime=n.manifest.minBufferTime,r.maxFragmentDuration=n.maxSegmentDuration,r.duration=t.getDuration(n.manifest),r.isDynamic=t.getIsDynamic(n.manifest),r.serviceDescriptions=t.getServiceDescriptions(n.manifest),r.protocol=n.manifest.protocol,r),i.isLast=1===e.mpd.manifest.Period_asArray.length||Math.abs(i.start+i.duration-i.manifestInfo.duration)<1,i}function I(){if(!f)throw new Error("setConfig function has to be called previously")}function O(e){return c.length>0?c[0].mpd.manifest.Period_asArray[e]:null}function N(e,t,n){var r,i,o,s,a;if(e)for(r=e.AdaptationSet_asArray,s=0;s<r.length;s+=1)for(o=r[s].Representation_asArray,a=0;a<o.length;a+=1)if(t===(i=o[a]).id)return n?a:i;return null}return e={getBandwidthForRepresentation:function(e,t){var n;return(n=N(O(t),e))?n.bandwidth:null},getIndexForRepresentation:function(e,t){return function(e,t){var n=N(e,t,!0);return null!==n?n:-1}(O(t),e)},getMaxIndexForBufferType:function(e,n){return function(e,n){var r,i,o,s;if(!e||!n)return-1;for(i=e.AdaptationSet_asArray,s=0;s<i.length;s+=1)if(o=(r=i[s]).Representation_asArray,t.getIsTypeOf(r,n))return o.length;return-1}(O(n),e)},convertRepresentationToRepresentationInfo:function(e){if(e){var n=new i.default,r=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],o=t.getRepresentationFor(e.index,r);return n.id=e.id,n.quality=e.index,n.bandwidth=t.getBandwidth(o),n.fragmentDuration=e.segmentDuration||(e.segments&&e.segments.length>0?e.segments[0].duration:NaN),n.MSETimeOffset=e.MSETimeOffset,n.mediaInfo=C(e.adaptation),n}return null},getStreamsInfo:function(e,t){var n=[],r=c;if(e&&(I(),r=E(e)),r.length>0){(!t||t>r.length)&&(t=r.length);for(var i=0;i<t;i++)n.push(j(r[i]))}return n},getMediaInfoForType:function(e,n){if(0===c.length||!e)return null;var r=k(e,c);if(!r)return null;var i=t.getAdaptationsForPeriod(r),o=v(e.index,n,e);return o?C(i[t.getIndexForAdaptation(o,c[0].mpd.manifest,e.index)]):null},getAllMediaInfoForType:x,getAdaptationForType:v,getRealAdaptation:function(e,n){var r,i,o=k(e,c);return r=n?n.id:null,c.length>0&&o&&(i=r?t.getAdaptationForId(r,c[0].mpd.manifest,o.index):t.getAdaptationForIndex(n?n.index:null,c[0].mpd.manifest,o.index)),i},getProducerReferenceTimes:function(e,n){var r,i,o=k(e,c);return r=n?n.id:null,c.length>0&&o&&(i=r?t.getAdaptationForId(r,c[0].mpd.manifest,o.index):t.getAdaptationForIndex(n?n.index:null,c[0].mpd.manifest,o.index)),i?t.getProducerReferenceTimesForAdaptation(i):[]},getRealPeriodByIndex:function(e){return t.getRealPeriodForIndex(e,c[0].mpd.manifest)},getEssentialPropertiesForRepresentation:function(e){try{return t.getEssentialPropertiesForRepresentation(e)}catch(e){return[]}},getVoRepresentations:function(e){var n=T(e);return t.getRepresentationsForAdaptation(n)},getEventsFor:function(e,n,r){var a=[];if(c.length>0){var l=c[0].mpd.manifest;if(e instanceof s.default){var u=k(e,c);a=t.getEventsForPeriod(u)}else if(e instanceof o.default){var d=k(r,c);a=t.getEventStreamForAdaptationSet(l,T(e),d)}else if(e instanceof i.default){var p=k(r,c);a=t.getEventStreamForRepresentation(l,n,p)}}return a},getEvent:function(e,t,n,r){try{if(!e||!t||isNaN(n)||!r)return null;var i=e.scheme_id_uri,o=e.value;if(!t[i+"/"+o])return null;var s,a=new l.default,c=e.timescale||1,u=r.adaptation.period.start,d=t[i+"/"+o],p=isNaN(r.presentationTimeOffset)?isNaN(d.presentationTimeOffset)?0:d.presentationTimeOffset:r.presentationTimeOffset,h=e.presentation_time_delta/c;s=0===e.version?u+n-p+h:u-p+h;var f=e.event_duration/c,g=e.id,m=e.message_data;return a.eventStream=d,a.eventStream.value=o,a.eventStream.timescale=c,a.duration=f,a.id=g,a.calculatedPresentationTime=s,a.messageData=m,a.presentationTimeDelta=h,a}catch(e){return null}},getMpd:_,setConfig:function(e){e&&(e.constants&&(f=e.constants),e.cea608parser&&(g=e.cea608parser),e.errHandler&&t.setConfig({errHandler:e.errHandler}),e.BASE64&&t.setConfig({BASE64:e.BASE64}))},updatePeriods:function(e){if(!e)return null;I(),c=E(e)},getIsTextTrack:function(e){return t.getIsText(e)},getUTCTimingSources:function(){var e=S();return t.getUTCTimingSources(e)},getSuggestedPresentationDelay:function(){var e=c.length>0?c[0].mpd:null;return t.getSuggestedPresentationDelay(e)},getAvailabilityStartTime:function(e){var n=_(e);return t.getAvailabilityStartTime(n)},getIsTypeOf:function(e,n){return t.getIsTypeOf(e,n)},getIsDynamic:function(e){var n=S(e);return t.getIsDynamic(n)},getDuration:function(e){var n=S(e);return t.getDuration(n)},getRegularPeriods:E,getContentSteering:function(e){return t.getContentSteering(e)},getLocation:function(e){return t.getLocation(e)},getPatchLocation:function(e){var n=t.getPatchLocation(e),r=t.getPublishTime(e);if(!n||!r)return null;if(n.hasOwnProperty("ttl")&&r){var i=1e3*parseFloat(n.ttl);if(r.getTime()+i<=(new Date).getTime())return null}return n.__text},getManifestUpdatePeriod:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.getManifestUpdatePeriod(e,n)},getPublishTime:function(e){return t.getPublishTime(e)},getIsDVB:function(e){return t.hasProfile(e,"urn:dvb:dash:profile:dvb-dash:2014")},getIsPatch:function(e){return n.getIsPatch(e)},getBaseURLsFromElement:function(e){return t.getBaseURLsFromElement(e)},getRepresentationSortFunction:function(){return t.getRepresentationSortFunction()},getCodec:function(e,n,r){return t.getCodec(e,n,r)},getPeriodById:function(e){if(!e||0===c.length)return null;var t=c.filter((function(t){return t.id===e}));return t&&t.length>0?t[0]:null},setCurrentMediaInfo:function(e,t,n){p[e]=p[e]||{},p[e][t]=p[e][t]||{},p[e][t]=n},isPatchValid:function(e,r){var i=t.getId(e),o=n.getMpdId(r),s=t.getPublishTime(e),a=n.getPublishTime(r),l=n.getOriginalPublishTime(r);return!!(i&&o&&i==o&&s&&l&&s.getTime()==l.getTime()&&a&&s.getTime()<a.getTime())},applyPatchToManifest:function(e,t){n.getPatchOperations(t).forEach((function(t){var n=t.getMpdTarget(e);if(null!==n){var r=n.name,i=n.target,o=n.leaf;if(t.xpath.findsAttribute())switch(t.action){case"add":case"replace":i[r]=t.value;break;case"remove":delete i[r]}else{var s=(i[r+"_asArray"]||[]).indexOf(o),a="prepend"===t.position||"before"===t.position;if(("remove"===t.action||"replace"===t.action)&&(delete i[r],-1!=s)){var l=i[r+"_asArray"];l.splice(s,1),l.length>1?i[r]=l:1==l.length?i[r]=l[0]:delete i[r+"_asArray"]}"add"!==t.action&&"replace"!==t.action||Object.keys(t.value).forEach((function(e){var n=t.value[e],o=i[e+"_asArray"]||[];if(0===o.length&&i[e]&&o.push(i[e]),0===o.length)o=n;else{var l=o.length;l=e==r&&-1!=s?s+(a?0:1)+("replace"==t.action?-1:0):a?0:o.length,o.splice.apply(o,[l,0].concat(n))}i[e+"_asArray"]=o,i[e]=1==o.length?o[0]:o}))}}}))},areMediaInfosEqual:y,reset:w},t=(0,u.default)(m).getInstance(),n=(0,d.default)(m).getInstance(),w(),e}f.__dashjs_factory_name="DashAdapter";const g=c.default.getSingletonFactory(f)},"./src/dash/DashHandler.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var r=n("./src/streaming/vo/FragmentRequest.js"),i=n("./src/streaming/vo/metrics/HTTPRequest.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/streaming/MediaPlayerEvents.js"),a=n("./src/dash/utils/SegmentsUtils.js"),l=n("./src/dash/constants/DashConstants.js");function c(e){var t,n,o,c,u,d=(e=e||{}).eventBus,p=e.debug,h=e.urlUtils,f=e.type,g=e.streamInfo,m=e.segmentsController,v=e.timelineConverter,y=e.baseURLController;function b(){return f}function x(){o=null}function E(e,t,n){var r,i,o=y.resolve(n.path);return o&&t!==o.url&&h.isRelative(t)?(r=o.url,i=o.serviceLocation,t&&(r=h.resolve(t,r))):r=t,!h.isRelative(r)&&(e.url=r,e.serviceLocation=i,!0)}function _(e,t){if(null==t)return null;var n=new r.default,o=t.representation,s=o.adaptation.period.mpd.manifest.Period_asArray[o.adaptation.period.index].AdaptationSet_asArray[o.adaptation.index].Representation_asArray[o.index].bandwidth,l=t.media;return l=(0,a.replaceTokenForTemplate)(l,"Number",t.replacementNumber),l=(0,a.replaceTokenForTemplate)(l,"Time",t.replacementTime),l=(0,a.replaceTokenForTemplate)(l,"Bandwidth",s),l=(0,a.replaceIDForTemplate)(l,o.id),l=(0,a.unescapeDollarsInTemplate)(l),n.mediaType=b(),n.type=i.HTTPRequest.MEDIA_SEGMENT_TYPE,n.range=t.mediaRange,n.startTime=t.presentationStartTime,n.mediaStartTime=t.mediaStartTime,n.duration=t.duration,n.timescale=o.timescale,n.availabilityStartTime=t.availabilityStartTime,n.availabilityEndTime=t.availabilityEndTime,n.availabilityTimeComplete=o.availabilityTimeComplete,n.wallStartTime=t.wallStartTime,n.quality=o.index,n.index=t.index,n.mediaInfo=e,n.adaptationIndex=o.adaptation.index,n.representationId=o.id,E(n,l,o)?n:void 0}function w(e,t,r){var i=null;if(!t||!t.segmentInfoType)return i;var s=m.getSegmentByTime(t,r);return s&&(o=s,n.debug("Index for time "+r+" is "+s.index),i=_(e,s)),i}function S(){n.debug("Dynamic stream complete"),u=!0}return t={initialize:function(e){c=e,u=!1,m.initialize(e)},getStreamId:function(){return g.id},getType:b,getStreamInfo:function(){return g},getInitRequest:function(e,t){return t?function(e,t,n){var o=new r.default,s=t.adaptation.period,l=s.start;if(o.mediaType=n,o.type=i.HTTPRequest.INIT_SEGMENT_TYPE,o.range=t.range,o.availabilityStartTime=v.calcAvailabilityStartTimeFromPresentationTime(l,t,c),o.availabilityEndTime=v.calcAvailabilityEndTimeFromPresentationTime(l+s.duration,t,c),o.quality=t.index,o.mediaInfo=e,o.representationId=t.id,E(o,t.initialization,t))return o.url=(0,a.replaceTokenForTemplate)(o.url,"Bandwidth",t.bandwidth),o}(e,t,b()):null},getSegmentRequestForTime:w,getCurrentIndex:function(){return o?o.index:-1},getNextSegmentRequest:function(e,t){var r=null;if(!t||!t.segmentInfoType)return null;var i=o?o.index+1:0,s=m.getSegmentByIndex(t,i,o?o.mediaStartTime:-1);if(s)r=_(e,s),o=s;else{if(c&&!u)return n.debug(b()+" No segment found at index: "+i+". Wait for next loop"),null;u=!0}return r},isLastSegmentRequested:function(e,t){if(!e||!o)return!1;if(u)return!0;if(!isFinite(e.adaptation.period.duration))return!1;if(o.presentationStartTime+o.duration>t)return!1;if(e.mediaFinishedInformation&&!isNaN(e.mediaFinishedInformation.numberOfSegments)&&!isNaN(o.index)&&o.index>=e.mediaFinishedInformation.numberOfSegments-1){if(!c||e.segmentInfoType===l.default.SEGMENT_TEMPLATE)return!0;if(c&&e.segmentInfoType===l.default.SEGMENT_LIST&&e.adaptation.period.nextPeriodId)return!0}return!!(c&&e.adaptation.period.nextPeriodId&&e.segmentInfoType===l.default.SEGMENT_TIMELINE&&e.mediaFinishedInformation&&!isNaN(e.mediaFinishedInformation.mediaTimeOfLastSignaledSegment)&&o&&!isNaN(o.mediaStartTime)&&!isNaN(o.duration)&&o.mediaStartTime+o.duration>=e.mediaFinishedInformation.mediaTimeOfLastSignaledSegment-.05)},reset:function(){x(),d.off(s.default.DYNAMIC_TO_STATIC,S,t)},getNextSegmentRequestIdempotent:function(e,t){var n=o?o.index+1:0,r=m.getSegmentByIndex(t,n,o?o.mediaStartTime:-1);return r?_(e,r):null},getValidTimeAheadOfTargetTime:function(e,t,n,r){try{if(isNaN(e)||!t||!n)return NaN;if(e<0&&(e=0),isNaN(r)&&(r=.5),w(t,n,e))return e;if(n.adaptation.period.start+n.adaptation.period.duration<e)return NaN;for(var i=isFinite(n.adaptation.period.duration)?n.adaptation.period.start+n.adaptation.period.duration:e+30,o=Math.min(e+r,i),s=NaN,a=null;o<=i;){var l=null;if(o<=i&&(l=w(t,n,o)),l){s=o,a=l;break}o+=r}if(a){var c=a.startTime+a.duration;return e>a.startTime&&c-e>r?e:!isNaN(a.startTime)&&e<a.startTime&&s>a.startTime?a.startTime+.001:Math.min(c-r,s)}return s}catch(e){return NaN}}},n=p.getLogger(t),x(),d.on(s.default.DYNAMIC_TO_STATIC,S,t),t}c.__dashjs_factory_name="DashHandler";const u=o.default.getClassFactory(c)},"./src/dash/DashMetrics.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/streaming/vo/metrics/HTTPRequest.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/streaming/constants/MetricsConstants.js"),a=n("./src/dash/utils/Round10.js"),l=n("./src/streaming/models/MetricsModel.js"),c=n("./src/core/Utils.js"),u=n("./src/streaming/vo/metrics/PlayList.js");function d(e){e=e||{};var t,n,o,d,p=this.context,h=e.metricsModel;function f(e){var t=h.getMetricsFor(e,!0);if(!t)return null;var n,r=t.HttpList,i=null;if(!r||r.length<=0)return null;for(n=r.length-1;n>=0;){if(r[n].responsecode){i=r[n];break}n--}return i}function g(e){var t=h.getMetricsFor(e,!0);return t&&t.HttpList?t.HttpList:[]}function m(e,t){if(!e)return null;var n=e[t];return n&&0!==n.length?n[n.length-1]:null}return t={getCurrentRepresentationSwitch:function(e){return m(h.getMetricsFor(e,!0),s.default.TRACK_SWITCH)},getCurrentBufferState:function(e){return m(h.getMetricsFor(e,!0),s.default.BUFFER_STATE)},getCurrentBufferLevel:function(e){var t=m(h.getMetricsFor(e,!0),s.default.BUFFER_LEVEL);return t?a.default.round10(t.level/1e3,-3):0},getCurrentHttpRequest:f,getHttpRequests:g,getCurrentDroppedFrames:function(){return m(h.getMetricsFor(r.default.VIDEO,!0),s.default.DROPPED_FRAMES)},getCurrentSchedulingInfo:function(e){return m(h.getMetricsFor(e,!0),s.default.SCHEDULING_INFO)},getCurrentDVRInfo:function(e){return m(e?h.getMetricsFor(e,!0):h.getMetricsFor(r.default.VIDEO,!0)||h.getMetricsFor(r.default.AUDIO,!0),s.default.DVR_INFO)},getCurrentManifestUpdate:function(){return m(h.getMetricsFor(r.default.STREAM),s.default.MANIFEST_UPDATE)},getLatestFragmentRequestHeaderValueByID:function(e,t){if(!t)return null;var n={},r=f(e);r&&(n=c.default.parseHttpHeaders(r._responseHeaders));var i=n[t.toLowerCase()];return void 0===i?null:i},getLatestMPDRequestHeaderValueByID:function(e){if(!e)return null;var t,n,o,s={};for(o=(t=g(r.default.STREAM)).length-1;o>=0;o--)if((n=t[o]).type===i.HTTPRequest.MPD_TYPE){s=c.default.parseHttpHeaders(n._responseHeaders);break}var a=s[e.toLowerCase()];return void 0===a?null:a},addRepresentationSwitch:function(e,t,n,r,i){h.addRepresentationSwitch(e,t,n,r,i)},addDVRInfo:function(e,t,n,r){h.addDVRInfo(e,t,n,r)},updateManifestUpdateInfo:function(e){var t=this.getCurrentManifestUpdate();h.updateManifestUpdateInfo(t,e)},addManifestUpdateStreamInfo:function(e){if(e){var t=this.getCurrentManifestUpdate();h.addManifestUpdateStreamInfo(t,e.id,e.index,e.start,e.duration)}},addManifestUpdateRepresentationInfo:function(e,t){if(e){var n=this.getCurrentManifestUpdate();h.addManifestUpdateRepresentationInfo(n,e.id,e.index,e.streamIndex,t,e.presentationTimeOffset,e.startNumber,e.fragmentInfoType)}},addManifestUpdate:function(e){h.addManifestUpdate(r.default.STREAM,e.type,e.requestStartDate,e.requestEndDate)},addHttpRequest:function(e,t,n,r,i,o){h.addHttpRequest(e.mediaType,null,e.type,e.url,e.quality,t,e.serviceLocation||null,e.range||null,e.requestStartDate,e.firstByteDate,e.requestEndDate,n,e.duration,r,i,e.fileLoaderType,o)},addSchedulingInfo:function(e,t){h.addSchedulingInfo(e.mediaType,new Date,e.type,e.startTime,e.availabilityStartTime,e.duration,e.quality,e.range,t)},addRequestsQueue:function(e,t,n){h.addRequestsQueue(e,t,n)},addBufferLevel:function(e,t,n){h.addBufferLevel(e,t,n)},addBufferState:function(e,t,n){h.addBufferState(e,t,n)},addDroppedFrames:function(e){h.addDroppedFrames(r.default.VIDEO,e)},addPlayList:function(){d&&(h.addPlayList(d),d=null)},addDVBErrors:function(e){h.addDVBErrors(e)},createPlaylistMetrics:function(e,t){(d=new u.PlayList).start=new Date,d.mstart=e,d.starttype=t},createPlaylistTraceMetrics:function(e,t,r){!0===n&&(n=!1,(o=new u.PlayListTrace).representationid=e,o.start=new Date,o.mstart=t,o.playbackspeed=null!==r?r.toString():null)},updatePlayListTraceMetrics:function(e){if(o)for(var t in o)o[t]=e[t]},pushPlayListTraceMetrics:function(e,t){if(!1===n&&d&&o&&o.start){var r=o.start,i=e.getTime()-r.getTime();o.duration=i,o.stopreason=t,d.trace.push(o),n=!0}},clearAllCurrentMetrics:function(){h.clearAllCurrentMetrics()}},h=h||(0,l.default)(p).getInstance({settings:e.settings}),n=!0,o=null,d=null,t}d.__dashjs_factory_name="DashMetrics";const p=o.default.getSingletonFactory(d)},"./src/dash/SegmentBaseLoader.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var r=n("./src/dash/vo/Segment.js"),i=n("./src/streaming/vo/DashJSError.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/streaming/vo/FragmentRequest.js"),a=n("./src/streaming/net/URLLoader.js");function l(){var e,t,n,o,l,c,u,d,p,h,f,g,m,v=this.context;function y(e,n,r,i){var s=null,a=e?m.resolve(e.path):null,l=i||{init:!0,url:a?a.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500,mediaType:n};t.debug("Start searching for initialization.");var c=_(l);d.load({request:c,success:function(t){if(l.bytesLoaded=l.range.end,!(s=o.findInitRange(t)))return l.range.end=l.bytesLoaded+l.bytesToLoad,y(e,n,r,l);e.range=s,r(e)},error:function(){r(e)}}),t.debug("Perform init search: "+l.url)}function b(e,n,r,i,s,a){if(r&&(void 0===r.start||void 0===r.end)){var l=r?r.toString().split("-"):null;r=l?{start:parseFloat(l[0]),end:parseFloat(l[1])}:null}s=s||x;var c=null,u=null,p=!!r,h=e?m.resolve(e.path):null,f={init:!1,url:h?h.url:void 0,range:p?r:{start:0,end:1500},searching:!p,bytesLoaded:a?a.bytesLoaded:0,bytesToLoad:1500,mediaType:n},g=_(f);d.load({request:g,success:function(r){var a=f.bytesToLoad,l=r.byteLength;if(f.bytesLoaded=f.range.end-f.range.start,c=o.parse(r),(u=c.getBox("sidx"))&&u.isComplete){var d,p,h=u.references;if(null!=h&&h.length>0&&(d=1===h[0].reference_type),d){var g,m,v,y;t.debug("Initiate multiple SIDX load."),f.range.end=f.range.start+u.size;var x=[],_=0,w=(u.offset||f.range.start)+u.size,S=function(t){t?(x=x.concat(t),++_>=m&&(x.sort((function(e,t){return e.startTime-t.startTime<0?-1:0})),s(x,e,i))):s(null,e,i)};for(g=0,m=h.length;g<m;g++)v=w,y=w+h[g].referenced_size-1,w+=h[g].referenced_size,b(e,n,{start:v,end:y},i,S,f)}else t.debug("Parsing segments from SIDX. representation "+n+" - id: "+e.id+" for range : "+f.range.start+" - "+f.range.end),p=E(u,f),s(p,e,i)}else{if(u)f.range.start=u.offset||f.range.start,f.range.end=f.range.start+(u.size||a);else{if(l<f.bytesLoaded)return void s(null,e,i);var T=c.getLastBox();T&&T.size?(f.range.start=T.offset+T.size,f.range.end=f.range.start+a):f.range.end+=a}b(e,n,f.range,i,null,f)}},error:function(){s(null,e,i)}}),t.debug("Perform SIDX load for type ".concat(n," : ").concat(f.url," with range ").concat(f.range.start," - ").concat(f.range.end))}function x(e,t,n){n({segments:e,representation:t,error:e?void 0:new i.default(p.SEGMENT_BASE_LOADER_ERROR_CODE,p.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}function E(e,t){for(var n,i,o,s,a=e.references,l=a.length,c=e.timescale,u=e.earliest_presentation_time,d=t.range.start+e.offset+e.first_offset+e.size,p=[],h=0;h<l;h++)o=a[h].subsegment_duration,s=a[h].referenced_size,(n=new r.default).duration=o,n.startTime=u,n.timescale=c,i=d+s-1,n.mediaRange=d+"-"+i,p.push(n),u+=o,d+=s;return p}function _(e){if(e.url){var t=new s.default;return t.setInfo(e),t}}return e={setConfig:function(r){r.baseURLController&&(m=r.baseURLController),r.dashMetrics&&(c=r.dashMetrics),r.mediaPlayerModel&&(u=r.mediaPlayerModel),r.errHandler&&(n=r.errHandler),r.boxParser&&(o=r.boxParser),r.debug&&(t=r.debug.getLogger(e)),r.requestModifier&&(l=r.requestModifier),r.errors&&(p=r.errors),r.urlUtils&&(g=r.urlUtils),r.constants&&(h=r.constants),r.dashConstants&&(f=r.dashConstants)},initialize:function(){d=(0,a.default)(v).create({errHandler:n,dashMetrics:c,mediaPlayerModel:u,requestModifier:l,boxParser:o,errors:p,urlUtils:g,constants:h,dashConstants:f})},loadInitialization:function(e,n){return new Promise((function(r){!function(e,n,r,i){var s=null,a=e?m.resolve(e.path):null,l={init:!0,url:a?a.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500,mediaType:n};t.debug("Start searching for initialization.");var c=_(l);d.load({request:c,success:function(i){if(l.bytesLoaded=l.range.end,!(s=o.findInitRange(i)))return l.range.end=l.bytesLoaded+l.bytesToLoad,function(e,n,r,i){var s=null,a=e?m.resolve(e.path):null,l=i||{init:!0,url:a?a.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500,mediaType:n};t.debug("Start searching for initialization.");var c=_(l);d.load({request:c,success:function(t){if(l.bytesLoaded=l.range.end,!(s=o.findInitRange(t)))return l.range.end=l.bytesLoaded+l.bytesToLoad,y(e,n,r,l);e.range=s,r(e)},error:function(){r(e)}}),t.debug("Perform init search: "+l.url)}(e,n,r,l);e.range=s,r(e)},error:function(){r(e)}}),t.debug("Perform init search: "+l.url)}(e,n,r)}))},loadSegments:function(e,n,i){return new Promise((function(s){!function(e,n,i,s,a,l){if(i&&(void 0===i.start||void 0===i.end)){var c=i?i.toString().split("-"):null;i=c?{start:parseFloat(c[0]),end:parseFloat(c[1])}:null}a=a||x;var u=null,p=null,h=!!i,f=e?m.resolve(e.path):null,g={init:!1,url:f?f.url:void 0,range:h?i:{start:0,end:1500},searching:!h,bytesLoaded:0,bytesToLoad:1500,mediaType:n},v=_(g);d.load({request:v,success:function(i){var l=g.bytesToLoad,c=i.byteLength;if(g.bytesLoaded=g.range.end-g.range.start,u=o.parse(i),(p=u.getBox("sidx"))&&p.isComplete){var d,h,f=p.references;if(null!=f&&f.length>0&&(d=1===f[0].reference_type),d){var m,v,y,x;t.debug("Initiate multiple SIDX load."),g.range.end=g.range.start+p.size;var E=[],_=0,w=(p.offset||g.range.start)+p.size,S=function(t){t?(E=E.concat(t),++_>=v&&(E.sort((function(e,t){return e.startTime-t.startTime<0?-1:0})),a(E,e,s))):a(null,e,s)};for(m=0,v=f.length;m<v;m++)y=w,x=w+f[m].referenced_size-1,w+=f[m].referenced_size,b(e,n,{start:y,end:x},s,S,g)}else t.debug("Parsing segments from SIDX. representation "+n+" - id: "+e.id+" for range : "+g.range.start+" - "+g.range.end),h=function(e,t){for(var n,i,o,s,a=e.references,l=a.length,c=e.timescale,u=e.earliest_presentation_time,d=t.range.start+e.offset+e.first_offset+e.size,p=[],h=0;h<l;h++)o=a[h].subsegment_duration,s=a[h].referenced_size,(n=new r.default).duration=o,n.startTime=u,n.timescale=c,i=d+s-1,n.mediaRange=d+"-"+i,p.push(n),u+=o,d+=s;return p}(p,g),a(h,e,s)}else{if(p)g.range.start=p.offset||g.range.start,g.range.end=g.range.start+(p.size||l);else{if(c<g.bytesLoaded)return void a(null,e,s);var T=u.getLastBox();T&&T.size?(g.range.start=T.offset+T.size,g.range.end=g.range.start+l):g.range.end+=l}b(e,n,g.range,s,null,g)}},error:function(){a(null,e,s)}}),t.debug("Perform SIDX load for type ".concat(n," : ").concat(g.url," with range ").concat(g.range.start," - ").concat(g.range.end))}(e,n,i,s)}))},reset:function(){d&&(d.abort(),d=null)}}}l.__dashjs_factory_name="SegmentBaseLoader";const c=o.default.getSingletonFactory(l)},"./src/dash/WebmSegmentBaseLoader.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var r=n("./src/streaming/utils/EBMLParser.js"),i=n("./src/streaming/constants/Constants.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/dash/vo/Segment.js"),a=n("./src/streaming/vo/FragmentRequest.js"),l=n("./src/streaming/net/URLLoader.js"),c=n("./src/streaming/vo/DashJSError.js");function u(){var e,t,n,o,u,d,p,h,f,g,m=this.context;function v(e,i,o,a){var l,c,u,d,p,h,f,g;for(u=[],p=0,h=(c=function(e){var t,i,o=[],s=(0,r.default)(m).create({data:e});for(s.consumeTagAndSize(n.Segment.Cues);s.moreData()&&s.consumeTagAndSize(n.Segment.Cues.CuePoint,!0);){for((t={}).CueTime=s.parseTag(n.Segment.Cues.CuePoint.CueTime),t.CueTracks=[];s.moreData()&&s.consumeTag(n.Segment.Cues.CuePoint.CueTrackPositions,!0);){var a=s.getMatroskaCodedNum(),l=s.getPos();if((i={}).Track=s.parseTag(n.Segment.Cues.CuePoint.CueTrackPositions.CueTrack),0===i.Track)throw new Error("Cue track cannot be 0");i.ClusterPosition=s.parseTag(n.Segment.Cues.CuePoint.CueTrackPositions.CueClusterPosition),t.CueTracks.push(i),s.setPos(l+a)}if(0===t.CueTracks.length)throw new Error("Mandatory cuetrack not found");o.push(t)}if(0===o.length)throw new Error("mandatory cuepoint not found");return o}(e)).length;p<h;p+=1)d=new s.default,l=p<c.length-1?c[p+1].CueTime-c[p].CueTime:a-c[p].CueTime,d.duration=l,d.startTime=c[p].CueTime,d.timescale=1e3,f=c[p].CueTracks[0].ClusterPosition+i,g=p<c.length-1?c[p+1].CueTracks[0].ClusterPosition+i-1:o-1,d.mediaRange=f+"-"+g,u.push(d);return t.debug("Parsed cues: "+u.length+" cues."),u}function y(e){var t=new a.default;return t.setInfo(e),t}return e={setConfig:function(n){if(!(n.baseURLController&&n.dashMetrics&&n.mediaPlayerModel&&n.errHandler))throw new Error(i.default.MISSING_CONFIG_ERROR);g=n.baseURLController,d=n.dashMetrics,p=n.mediaPlayerModel,o=n.errHandler,f=n.errors,t=n.debug.getLogger(e),u=n.requestModifier},initialize:function(){h=(0,l.default)(m).create({errHandler:o,dashMetrics:d,mediaPlayerModel:p,requestModifier:u,errors:f})},loadInitialization:function(e,n){return new Promise((function(r){var i=null,o=e?g.resolve(e.path):null,s=e?e.range.split("-"):null,a={range:{start:s?parseFloat(s[0]):null,end:s?parseFloat(s[1]):null},request:i,url:o?o.url:void 0,init:!0,mediaType:n};t.info("Start loading initialization."),i=y(a),h.load({request:i,success:function(){r(e)},error:function(){r(e)}}),t.debug("Perform init load: "+a.url)}))},loadSegments:function(e,i,o){return new Promise((function(s){var a=null,l=e?g.resolve(e.path):null,u=l?l.url:void 0;a=y({bytesLoaded:0,bytesToLoad:8192,range:{start:0,end:8192},request:a,url:u,init:!1,mediaType:i}),t.debug("Parsing ebml header"),h.load({request:a,success:function(i){!function(e,i,o,s){if(e&&0!==e.byteLength){var a,l,c,u,d=(0,r.default)(m).create({data:e}),p=o?o.split("-"):null,f=null,g={url:i,range:{start:p?parseFloat(p[0]):null,end:p?parseFloat(p[1]):null},request:f};for(t.debug("Parse EBML header: "+g.url),d.skipOverElement(n.EBML),d.consumeTag(n.Segment),c=d.getMatroskaCodedNum(),c+=d.getPos(),u=d.getPos();d.moreData()&&!d.consumeTagAndSize(n.Segment.Info,!0);)if(!(d.skipOverElement(n.Segment.SeekHead,!0)||d.skipOverElement(n.Segment.Tracks,!0)||d.skipOverElement(n.Segment.Cues,!0)||d.skipOverElement(n.Void,!0)))throw new Error("no valid top level element found");for(;void 0===a;){var b=d.getMatroskaCodedNum(!0),x=d.getMatroskaCodedNum();switch(b){case n.Segment.Info.Duration.tag:a=d[n.Segment.Info.Duration.parse](x);break;default:d.setPos(d.getPos()+x)}}f=y(g),h.load({request:f,success:function(e){l=v(e,u,c,a),s(l)},error:function(){t.error("Download Error: Cues "+g.url),s(null)}}),t.debug("Perform cues load: "+g.url+" bytes="+g.range.start+"-"+g.range.end)}else s(null)}(i,u,o,(function(t){s({segments:t,representation:e,error:t?void 0:new c.default(f.SEGMENT_BASE_LOADER_ERROR_CODE,f.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}))},error:function(){s({representation:e,error:new c.default(f.SEGMENT_BASE_LOADER_ERROR_CODE,f.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}})}))},reset:function(){h&&(h.abort(),h=null)}},n={EBML:{tag:440786851,required:!0},Segment:{tag:408125543,required:!0,SeekHead:{tag:290298740,required:!0},Info:{tag:357149030,required:!0,TimecodeScale:{tag:2807729,required:!0,parse:"getMatroskaUint"},Duration:{tag:17545,required:!0,parse:"getMatroskaFloat"}},Tracks:{tag:374648427,required:!0},Cues:{tag:475249515,required:!0,CuePoint:{tag:187,required:!0,CueTime:{tag:179,required:!0,parse:"getMatroskaUint"},CueTrackPositions:{tag:183,required:!0,CueTrack:{tag:247,required:!0,parse:"getMatroskaUint"},CueClusterPosition:{tag:241,required:!0,parse:"getMatroskaUint"}}}}},Void:{tag:236,required:!0}},e}u.__dashjs_factory_name="WebmSegmentBaseLoader";const d=o.default.getSingletonFactory(u)},"./src/dash/constants/DashConstants.js":(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,{default:()=>i});const i=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t,n;return t=e,(n=[{key:"init",value:function(){this.BASE_URL="BaseURL",this.SEGMENT_BASE="SegmentBase",this.SEGMENT_TEMPLATE="SegmentTemplate",this.SEGMENT_LIST="SegmentList",this.SEGMENT_URL="SegmentURL",this.SEGMENT_TIMELINE="SegmentTimeline",this.SEGMENT_PROFILES="segmentProfiles",this.ADAPTATION_SET="AdaptationSet",this.REPRESENTATION="Representation",this.REPRESENTATION_INDEX="RepresentationIndex",this.SUB_REPRESENTATION="SubRepresentation",this.INITIALIZATION="Initialization",this.INITIALIZATION_MINUS="initialization",this.MPD="MPD",this.PERIOD="Period",this.ASSET_IDENTIFIER="AssetIdentifier",this.EVENT_STREAM="EventStream",this.ID="id",this.PROFILES="profiles",this.SERVICE_LOCATION="serviceLocation",this.RANGE="range",this.INDEX="index",this.MEDIA="media",this.BYTE_RANGE="byteRange",this.INDEX_RANGE="indexRange",this.MEDIA_RANGE="mediaRange",this.VALUE="value",this.CONTENT_TYPE="contentType",this.MIME_TYPE="mimeType",this.BITSTREAM_SWITCHING="BitstreamSwitching",this.BITSTREAM_SWITCHING_MINUS="bitstreamSwitching",this.CODECS="codecs",this.DEPENDENCY_ID="dependencyId",this.MEDIA_STREAM_STRUCTURE_ID="mediaStreamStructureId",this.METRICS="Metrics",this.METRICS_MINUS="metrics",this.REPORTING="Reporting",this.WIDTH="width",this.HEIGHT="height",this.SAR="sar",this.FRAMERATE="frameRate",this.AUDIO_SAMPLING_RATE="audioSamplingRate",this.MAXIMUM_SAP_PERIOD="maximumSAPPeriod",this.START_WITH_SAP="startWithSAP",this.MAX_PLAYOUT_RATE="maxPlayoutRate",this.CODING_DEPENDENCY="codingDependency",this.SCAN_TYPE="scanType",this.FRAME_PACKING="FramePacking",this.AUDIO_CHANNEL_CONFIGURATION="AudioChannelConfiguration",this.CONTENT_PROTECTION="ContentProtection",this.ESSENTIAL_PROPERTY="EssentialProperty",this.SUPPLEMENTAL_PROPERTY="SupplementalProperty",this.INBAND_EVENT_STREAM="InbandEventStream",this.PRODUCER_REFERENCE_TIME="ProducerReferenceTime",this.ACCESSIBILITY="Accessibility",this.ROLE="Role",this.RATING="Rating",this.CONTENT_COMPONENT="ContentComponent",this.SUBSET="Subset",this.LANG="lang",this.VIEWPOINT="Viewpoint",this.ROLE_ASARRAY="Role_asArray",this.REPRESENTATION_ASARRAY="Representation_asArray",this.PRODUCERREFERENCETIME_ASARRAY="ProducerReferenceTime_asArray",this.ACCESSIBILITY_ASARRAY="Accessibility_asArray",this.AUDIOCHANNELCONFIGURATION_ASARRAY="AudioChannelConfiguration_asArray",this.CONTENTPROTECTION_ASARRAY="ContentProtection_asArray",this.MAIN="main",this.DYNAMIC="dynamic",this.STATIC="static",this.MEDIA_PRESENTATION_DURATION="mediaPresentationDuration",this.MINIMUM_UPDATE_PERIOD="minimumUpdatePeriod",this.CODEC_PRIVATE_DATA="codecPrivateData",this.BANDWITH="bandwidth",this.SOURCE_URL="sourceURL",this.TIMESCALE="timescale",this.DURATION="duration",this.START_NUMBER="startNumber",this.PRESENTATION_TIME_OFFSET="presentationTimeOffset",this.AVAILABILITY_START_TIME="availabilityStartTime",this.AVAILABILITY_END_TIME="availabilityEndTime",this.TIMESHIFT_BUFFER_DEPTH="timeShiftBufferDepth",this.MAX_SEGMENT_DURATION="maxSegmentDuration",this.PRESENTATION_TIME="presentationTime",this.MIN_BUFFER_TIME="minBufferTime",this.MAX_SUBSEGMENT_DURATION="maxSubsegmentDuration",this.START="start",this.AVAILABILITY_TIME_OFFSET="availabilityTimeOffset",this.AVAILABILITY_TIME_COMPLETE="availabilityTimeComplete",this.CENC_DEFAULT_KID="cenc:default_KID",this.DVB_PRIORITY="dvb:priority",this.DVB_WEIGHT="dvb:weight",this.SUGGESTED_PRESENTATION_DELAY="suggestedPresentationDelay",this.SERVICE_DESCRIPTION="ServiceDescription",this.SERVICE_DESCRIPTION_SCOPE="Scope",this.SERVICE_DESCRIPTION_LATENCY="Latency",this.SERVICE_DESCRIPTION_PLAYBACK_RATE="PlaybackRate",this.SERVICE_DESCRIPTION_OPERATING_QUALITY="OperatingQuality",this.SERVICE_DESCRIPTION_OPERATING_BANDWIDTH="OperatingBandwidth",this.PATCH_LOCATION="PatchLocation",this.PUBLISH_TIME="publishTime",this.ORIGINAL_PUBLISH_TIME="originalPublishTime",this.ORIGINAL_MPD_ID="mpdId",this.WALL_CLOCK_TIME="wallClockTime",this.PRESENTATION_TIME="presentationTime",this.LABEL="Label",this.GROUP_LABEL="GroupLabel",this.CONTENT_STEERING="ContentSteering",this.CONTENT_STEERING_AS_ARRAY="ContentSteering_asArray",this.DEFAULT_SERVICE_LOCATION="defaultServiceLocation",this.QUERY_BEFORE_START="queryBeforeStart",this.PROXY_SERVER_URL="proxyServerURL",this.CONTENT_STEERING_RESPONSE={VERSION:"VERSION",TTL:"TTL",RELOAD_URI:"RELOAD-URI",SERVICE_LOCATION_PRIORITY:"SERVICE-LOCATION-PRIORITY"}}}])&&r(t.prototype,n),e}())},"./src/dash/controllers/ContentSteeringController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>b});var r=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js"),o=n("./src/streaming/net/URLLoader.js"),s=n("./src/core/errors/Errors.js"),a=n("./src/dash/vo/ContentSteeringRequest.js"),l=n("./src/dash/vo/ContentSteeringResponse.js"),c=n("./src/dash/constants/DashConstants.js"),u=n("./src/streaming/MediaPlayerEvents.js"),d=n("./src/core/events/Events.js"),p=n("./src/streaming/constants/Constants.js"),h=n("./src/core/Utils.js"),f=n("./src/streaming/utils/URLUtils.js"),g="_DASH_throughput",m="_DASH_pathway",v="url";function y(){var e,t,n,r,y,b,x,E,_,w,S,T,k,C,A,j=this.context,I=(0,f.default)(j).getInstance();function O(e){e&&e.toStreamInfo&&(r=e.toStreamInfo)}function N(e){e&&e.request&&e.request.serviceLocation&&(y=e.request.serviceLocation)}function R(){var e=S.getValue();return A.getContentSteering(e)}function P(){return new Promise((function(e){try{var i=R();if(!i||!i.serverUrl)return void e();var o=function(e){var t=e.proxyServerUrl?e.proxyServerUrl:e.serverUrl;n&&n.reloadUri&&(t=I.isRelative(n.reloadUri)?I.resolve(n.reloadUri,e.serverUrl):n.reloadUri);var i=[];if(r){var o=A.getIsDynamic(),s=A.getAllMediaInfoForType(r,p.default.VIDEO).length>0?p.default.VIDEO:p.default.AUDIO,a=k.getThroughputHistory(),l=a?a.getAverageThroughput(s,o):NaN;isNaN(l)||i.push({key:g,value:1e3*l})}return y&&i.push({key:m,value:y}),e.proxyServerUrl&&e.proxyServerUrl===t&&e.serverUrl&&i.push({key:v,value:encodeURI(e.serverUrl)}),h.default.addAditionalQueryParameterToUrl(t,i)}(i),s=new a.default(o);x.load({request:s,success:function(t){!function(e){e&&e[c.default.CONTENT_STEERING_RESPONSE.VERSION]&&1===parseInt(e[c.default.CONTENT_STEERING_RESPONSE.VERSION])&&((n=new l.default).version=e[c.default.CONTENT_STEERING_RESPONSE.VERSION],e[c.default.CONTENT_STEERING_RESPONSE.TTL]&&!isNaN(e[c.default.CONTENT_STEERING_RESPONSE.TTL])&&(n.ttl=e[c.default.CONTENT_STEERING_RESPONSE.TTL]),e[c.default.CONTENT_STEERING_RESPONSE.RELOAD_URI]&&(n.reloadUri=e[c.default.CONTENT_STEERING_RESPONSE.RELOAD_URI]),e[c.default.CONTENT_STEERING_RESPONSE.SERVICE_LOCATION_PRIORITY]&&(n.serviceLocationPriority=e[c.default.CONTENT_STEERING_RESPONSE.SERVICE_LOCATION_PRIORITY]),D())}(t),C.trigger(u.default.CONTENT_STEERING_REQUEST_COMPLETED,{currentSteeringResponseData:n,url:o}),e()},error:function(n){!function(e){t.warn("Error fetching data from content steering server",e),D()}(n),e(n)}})}catch(t){e(t)}}))}function D(){n&&n.ttl&&!isNaN(n.ttl)&&(b&&clearTimeout(b),b=setTimeout((function(){P()}),1e3*n.ttl))}function M(){b&&clearTimeout(b),b=null}function L(){n=null,r=null,y=null,M()}return e={reset:function(){L(),C.off(u.default.PERIOD_SWITCH_COMPLETED,O,e),C.off(d.default.FRAGMENT_LOADING_STARTED,N,e)},setConfig:function(e){e&&(e.adapter&&(A=e.adapter),e.errHandler&&(E=e.errHandler),e.dashMetrics&&(_=e.dashMetrics),e.mediaPlayerModel&&(w=e.mediaPlayerModel),e.requestModifier&&(T=e.requestModifier),e.manifestModel&&(S=e.manifestModel),e.abrController&&(k=e.abrController),e.eventBus&&(C=e.eventBus))},loadSteeringData:P,getCurrentSteeringResponseData:function(){return n},shouldQueryBeforeStart:function(){var e=R();return e&&e.queryBeforeStart},getSteeringDataFromManifest:R,stopSteeringRequestTimer:M,initialize:function(){x=(0,o.default)(j).create({errHandler:E,dashMetrics:_,mediaPlayerModel:w,requestModifier:T,errors:s.default}),C.on(u.default.PERIOD_SWITCH_COMPLETED,O,e),C.on(d.default.FRAGMENT_LOADING_STARTED,N,e)}},t=(0,i.default)(j).getInstance().getLogger(e),L(),e}y.__dashjs_factory_name="ContentSteeringController";const b=r.default.getSingletonFactory(y)},"./src/dash/controllers/RepresentationController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/core/FactoryMaker.js"),o=n("./src/streaming/MediaPlayerEvents.js"),s=n("./src/dash/utils/SegmentsUtils.js");function a(e){var t,n,i,a,l,c=(e=e||{}).eventBus,u=e.events,d=e.abrController,p=e.dashMetrics,h=e.playbackController,f=e.timelineConverter,g=e.type,m=e.streamInfo,v=e.dashConstants,y=e.segmentsController,b=e.isDynamic;function x(){return g}function E(){if(!(d&&p&&h&&f))throw new Error(r.default.MISSING_CONFIG_ERROR)}function _(){return i}function w(){return l}function S(){n=null,i=!0,a=[]}function T(e){return new Promise((function(t,n){var r=e.hasInitialization(),i=e.hasSegments(),o=[];o.push(y.updateInitData(e,r)),o.push(y.updateSegmentData(e,i)),Promise.all(o).then((function(n){var r;n[0]&&!n[0].error&&(e=function(e,t){return t&&!t.error&&t.representation?t.representation:e}(e,n[0])),n[1]&&!n[1].error&&(e=function(e,t){if(t&&!t.error){var n,r,i,o,a=t.segments,l=[],c=0;for(n=0,r=a?a.length:0;n<r;n++)i=a[n],(o=(0,s.getTimeBasedSegment)(f,b,e,i.startTime,i.duration,i.timescale,i.media,i.mediaRange,c))&&(l.push(o),o=null,c++);return l.length>0&&(e.segments=l),e}}(e,n[1])),(r=e).mediaFinishedInformation=y.getMediaFinishedInformation(r),function(e){if(_()){var t,n,r=p.getCurrentManifestUpdate(),i=!1;if(r){for(var o=0;o<r.representationInfo.length;o++)if((t=r.representationInfo[o]).index===e.index&&t.mediaType===x()){i=!0;break}i||p.addManifestUpdateRepresentationInfo(e,x())}if(function(){for(var e=0,t=a.length;e<t;e++){var n=a[e].segmentInfoType;if(!a[e].hasInitialization()||(n===v.SEGMENT_BASE||n===v.BASE_URL)&&!a[e].segments)return!1}return!0}()){d.setPlaybackQuality(g,m,(n=l,a.indexOf(n)));var s=p.getCurrentDVRInfo(g);s&&p.updateManifestUpdateInfo({latency:s.range.end-h.getTime()}),p.getCurrentRepresentationSwitch(w().adaptation.type)||k(),A()}}}(e),t()})).catch((function(e){n(e)}))}))}function k(){E();var e=new Date,t=w(),n=1e3*h.getTime();t&&p.addRepresentationSwitch(t.adaptation.type,e,n,t.id),c.trigger(o.default.REPRESENTATION_SWITCH,{mediaType:g,streamId:m.id,currentRepresentation:t,numberOfRepresentations:a.length},{streamId:m.id,mediaType:g})}function C(e){return null==e||e>=a.length?null:a[e]}function A(e){i=!1,c.trigger(u.DATA_UPDATE_COMPLETED,{data:n,currentRepresentation:l,error:e},{streamId:m.id,mediaType:g})}function j(e){l=e}function I(e){if(e.newDuration){var t=w();t&&t.adaptation.period&&(t.adaptation.period.duration=e.newDuration)}}return t={getStreamId:function(){return m.id},getType:x,getData:function(){return n},isUpdating:_,updateData:function(e,t,o,s,l){if(E(),i=!0,a=t,j(C(l)),n=e,o!==r.default.VIDEO&&o!==r.default.AUDIO&&(o!==r.default.TEXT||!s))return A(),Promise.resolve();for(var c=[],u=0,d=a.length;u<d;u++){var p=a[u];c.push(T(p))}return Promise.all(c)},getCurrentRepresentation:w,getRepresentationForQuality:C,prepareQualityChange:function(e){j(C(e)),k()},reset:function(){c.off(o.default.MANIFEST_VALIDITY_CHANGED,I,t),S()}},S(),c.on(o.default.MANIFEST_VALIDITY_CHANGED,I,t),t}a.__dashjs_factory_name="RepresentationController";const l=i.default.getClassFactory(a)},"./src/dash/controllers/SegmentBaseController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/core/FactoryMaker.js"),i=n("./src/dash/SegmentBaseLoader.js"),o=n("./src/dash/WebmSegmentBaseLoader.js");function s(e){e=e||{};var t,n,r,s=this.context,a=e.eventBus,l=e.events,c=e.dashMetrics,u=e.mediaPlayerModel,d=e.errHandler,p=e.baseURLController,h=e.debug,f=e.boxParser,g=e.requestModifier,m=e.errors;function v(e){return"webm"===(e?e.split("/")[1]:"").toLowerCase()}return t={initialize:function(){n.initialize(),r.initialize()},getSegmentBaseInitSegment:function(e){return v(e.representation.mimeType)?r.loadInitialization(e.representation,e.mediaType):n.loadInitialization(e.representation,e.mediaType)},getSegmentList:function(e){return v(e.mimeType)?r.loadSegments(e.representation,e.mediaType,e.representation?e.representation.indexRange:null):n.loadSegments(e.representation,e.mediaType,e.representation?e.representation.indexRange:null)},reset:function(){n.reset(),r.reset()}},n=(0,i.default)(s).getInstance(),r=(0,o.default)(s).getInstance(),n.setConfig({baseURLController:p,dashMetrics:c,mediaPlayerModel:u,errHandler:d,eventBus:a,events:l,errors:m,debug:h,boxParser:f,requestModifier:g}),r.setConfig({baseURLController:p,dashMetrics:c,mediaPlayerModel:u,errHandler:d,eventBus:a,events:l,errors:m,debug:h,requestModifier:g}),t}s.__dashjs_factory_name="SegmentBaseController";const a=r.default.getSingletonFactory(s)},"./src/dash/controllers/SegmentsController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var r=n("./src/core/FactoryMaker.js"),i=n("./src/dash/utils/TimelineSegmentsGetter.js"),o=n("./src/dash/utils/TemplateSegmentsGetter.js"),s=n("./src/dash/utils/ListSegmentsGetter.js"),a=n("./src/dash/utils/SegmentBaseGetter.js");function l(e){e=e||{};var t,n,r=this.context,l=e.dashConstants,c=e.type,u=e.segmentBaseController;function d(e){return e?e.segments?n[l.SEGMENT_BASE]:n[e.segmentInfoType]:null}return t={initialize:function(t){n[l.SEGMENT_TIMELINE]=(0,i.default)(r).create(e,t),n[l.SEGMENT_TEMPLATE]=(0,o.default)(r).create(e,t),n[l.SEGMENT_LIST]=(0,s.default)(r).create(e,t),n[l.SEGMENT_BASE]=(0,a.default)(r).create(e,t)},updateInitData:function(e,t){return t?Promise.resolve():u.getSegmentBaseInitSegment({representation:e,mediaType:c})},updateSegmentData:function(e,t){return t?Promise.resolve():u.getSegmentList({mimeType:e.mimeType,representation:e,mediaType:c})},getSegmentByIndex:function(e,t,n){var r=d(e);return r?r.getSegmentByIndex(e,t,n):null},getSegmentByTime:function(e,t){var n=d(e);return n?n.getSegmentByTime(e,t):null},getMediaFinishedInformation:function(e){var t=d(e);return t?t.getMediaFinishedInformation(e):{numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN}}},n={},t}l.__dashjs_factory_name="SegmentsController";const c=r.default.getClassFactory(l)},"./src/dash/controllers/ServiceDescriptionController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>h});var r=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js"),o=n("./src/streaming/constants/Constants.js"),s=n("./src/dash/constants/DashConstants.js"),a=[o.default.SERVICE_DESCRIPTION_DVB_LL_SCHEME],l="video",c="audio",u="any",d="all";function p(){var e,t,n,r,p,h=this.context;function f(){t={liveDelay:NaN,liveCatchup:{maxDrift:NaN,playbackRate:{min:NaN,max:NaN}},minBitrate:{},maxBitrate:{},initialBitrate:{}},n=[]}function g(e,n,i){try{t[e][n]=i/1e3}catch(e){r.error(e)}}return e={getServiceDescriptionSettings:function(){return t},getProducerReferenceTimeOffsets:function(){return n},calculateProducerReferenceTimeOffsets:function(e){try{var t=[];if(e&&e.length>0){var i=[o.default.VIDEO,o.default.AUDIO,o.default.TEXT],a=p.getAvailabilityStartTime()/1e3;e.forEach((function(e){var n=i.reduce((function(t,n){return t.concat(p.getAllMediaInfoForType(e,n))}),[]).reduce((function(t,n){return p.getProducerReferenceTimes(e,n).forEach((function(r){var i=p.getVoRepresentations(n);if(i&&i.length>0&&i[0].adaptation&&i[0].segmentInfoType===s.default.SEGMENT_TEMPLATE){var o=i[0],l=new Date(r[s.default.WALL_CLOCK_TIME]).getTime()/1e3-(r[s.default.PRESENTATION_TIME]/o[s.default.TIMESCALE]-o[s.default.PRESENTATION_TIME_OFFSET]+e.start),c=a-l;t.push({id:r[s.default.ID],to:c})}})),t}),[]);t=t.concat(n)}))}n=t}catch(e){r.error(e),n=[]}},applyServiceDescription:function(e){if(e&&e.serviceDescriptions){var i=e.serviceDescriptions.filter((function(e){return a.includes(e.schemeIdUri)})),s=e.serviceDescriptions.filter((function(e){return null==e.schemeIdUri})),p=i.length>0?i[i.length-1]:s[s.length-1];p&&(p.latency&&p.latency.target>0&&function(e){var i;if(e.schemeIdUri,o.default.SERVICE_DESCRIPTION_DVB_LL_SCHEME,i=function(e){return{liveDelay:e.latency.target/1e3,maxDrift:!isNaN(e.latency.max)&&e.latency.max>e.latency.target?(e.latency.max-e.latency.target+500)/1e3:NaN,referenceId:e.latency.referenceId||NaN}}(e),n.length>0){var s=function(e){var t,r=0,i=n.filter((function(t){return t.id===e.referenceId}));return 0===i.length?(r=n.length>0?n[0].to:0,t=n[0].id||NaN):(r=i[0].to||0,t=i[0].id||NaN),{to:r,id:t}}(i),a=s.to,l=s.id;t.liveDelay=i.liveDelay-a,t.liveCatchup.maxDrift=i.maxDrift,r.debug("\n                Found latency properties coming from service description. Applied time offset of ".concat(a," from ProducerReferenceTime element with id ").concat(l,".\n                Live Delay: ").concat(i.liveDelay-a,", Live catchup max drift: ").concat(i.maxDrift,"\n            "))}else t.liveDelay=i.liveDelay,t.liveCatchup.maxDrift=i.maxDrift,r.debug("Found latency properties coming from service description: Live Delay: ".concat(i.liveDelay,", Live catchup max drift: ").concat(i.maxDrift))}(p),p.playbackRate&&function(e){var n=e.playbackRate.min?Math.round(1e3*(e.playbackRate.min-1))/1e3:NaN,i=e.playbackRate.max?Math.round(1e3*(e.playbackRate.max-1))/1e3:NaN;t.liveCatchup.playbackRate.min=n,t.liveCatchup.playbackRate.max=i,r.debug("Found latency properties coming from service description: Live catchup min playback rate: ".concat(n)),r.debug("Found latency properties coming from service description: Live catchup max playback rate: ".concat(i))}(p),p.operatingQuality,p.operatingBandwidth&&function(e){if(e&&e.operatingBandwidth&&e.operatingBandwidth.mediaType&&e.operatingBandwidth.mediaType!==d){var t={};t.minBandwidth=e.operatingBandwidth.min,t.maxBandwidth=e.operatingBandwidth.max,t.targetBandwidth=e.operatingBandwidth.target;var n=[];e.operatingBandwidth.mediaType===l||e.operatingBandwidth.mediaType===c?n.push(e.operatingBandwidth.mediaType):e.operatingBandwidth.mediaType===u&&(n.push(c),n.push(l)),n.forEach((function(e){isNaN(t.minBandwidth)||g("minBitrate",e,t.minBandwidth),isNaN(t.maxBandwidth)||g("maxBitrate",e,t.maxBandwidth),isNaN(t.targetBandwidth)||g("initialBitrate",e,t.targetBandwidth)}))}}(p))}},reset:function(){f()},setConfig:function(e){e&&e.adapter&&(p=e.adapter)}},r=(0,i.default)(h).getInstance().getLogger(e),f(),e}p.__dashjs_factory_name="ServiceDescriptionController";const h=r.default.getSingletonFactory(p)},"./src/dash/models/DashManifestModel.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>C});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/dash/constants/DashConstants.js"),o=n("./src/dash/vo/Representation.js"),s=n("./src/dash/vo/AdaptationSet.js"),a=n("./src/dash/vo/Period.js"),l=n("./src/dash/vo/Mpd.js"),c=n("./src/dash/vo/UTCTiming.js"),u=n("./src/dash/vo/Event.js"),d=n("./src/dash/vo/BaseURL.js"),p=n("./src/dash/vo/EventStream.js"),h=n("./src/dash/vo/ProducerReferenceTime.js"),f=n("./src/dash/vo/ContentSteering.js"),g=n("./src/streaming/utils/ObjectUtils.js"),m=n("./src/streaming/utils/URLUtils.js"),v=n("./src/core/FactoryMaker.js"),y=n("./src/core/Debug.js"),b=n("./src/streaming/vo/DashJSError.js"),x=n("./src/core/errors/Errors.js"),E=n("./src/streaming/thumbnail/ThumbnailTracks.js");function _(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=S(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function w(e){return function(e){if(Array.isArray(e))return T(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||S(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(){var e,t,n,v,S=this.context,T=(0,m.default)(S).getInstance(),k=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};function C(e,t){if(!e)throw new Error("adaptation is not defined");if(!t)throw new Error("type is not defined");if(e.Representation_asArray&&e.Representation_asArray.length){var n=L(e.Representation_asArray[0]);if(n&&n.length>0&&E.THUMBNAILS_SCHEME_ID_URIS.indexOf(n[0].schemeIdUri)>=0)return t===r.default.IMAGE}if(e.ContentComponent_asArray&&e.ContentComponent_asArray.length>0){if(e.ContentComponent_asArray.length>1)return t===r.default.MUXED;if(e.ContentComponent_asArray[0].contentType===t)return!0}var o=t===r.default.TEXT?new RegExp("(ttml|vtt|wvtt|stpp)"):new RegExp(t);if(e.Representation_asArray&&e.Representation_asArray.length){var s=e.Representation_asArray[0].codecs;if(o.test(s))return!0}if(e.hasOwnProperty(i.default.MIME_TYPE))return o.test(e.mimeType);if(e.Representation_asArray)for(var a,l=0;l<e.Representation_asArray.length;l++)if((a=e.Representation_asArray[l]).hasOwnProperty(i.default.MIME_TYPE))return o.test(a.mimeType);return!1}function A(e){if(!e)throw new Error("adaptation is not defined");if(e.hasOwnProperty(i.default.SEGMENT_TEMPLATE)||e.hasOwnProperty(i.default.SEGMENT_TIMELINE)||e.hasOwnProperty(i.default.SEGMENT_LIST)||e.hasOwnProperty(i.default.SEGMENT_BASE))return!0;if(e.Representation_asArray&&e.Representation_asArray.length>0){var t=e.Representation_asArray[0];if(t.hasOwnProperty(i.default.SEGMENT_TEMPLATE)||t.hasOwnProperty(i.default.SEGMENT_TIMELINE)||t.hasOwnProperty(i.default.SEGMENT_LIST)||t.hasOwnProperty(i.default.SEGMENT_BASE))return!0}return!1}function j(e){return C(e,r.default.AUDIO)}function I(e){return C(e,r.default.VIDEO)}function O(e){return C(e,r.default.TEXT)}function N(e){return C(e,r.default.IMAGE)}function R(e){return e&&Array.isArray(e.Representation_asArray)&&e.Representation_asArray.sort((function(e,t){return e.bandwidth-t.bandwidth})),e}function P(e,t){return e&&e.Period_asArray&&k(t)&&e.Period_asArray[t]?e.Period_asArray[t].AdaptationSet_asArray:[]}function D(e){return e&&e.Period_asArray?e.Period_asArray:[]}function M(e){var t=!1;return e&&e.hasOwnProperty("type")&&(t=e.type===i.default.DYNAMIC),t}function L(e){return e&&e.EssentialProperty_asArray&&e.EssentialProperty_asArray.length?e.EssentialProperty_asArray.map((function(e){return{schemeIdUri:e.schemeIdUri,value:e.value}})):null}function B(e){if(!e||!e.S_asArray)return NaN;var t=e.S_asArray[0],n=e.S_asArray[1];return t.hasOwnProperty("d")?t.d:n.t-t.t}function F(e,t){if(!e)throw new Error("Period cannot be null or undefined");var n=a.default.DEFAULT_ID+"_"+t;return e.hasOwnProperty(i.default.ID)&&e.id.length>0&&"__proto__"!==e.id&&(n=e.id),n}function U(e,t,n){var o,s=[];if(!e)return s;for(o=0;o<e.length;o++){var a=new p.default;if(a.timescale=1,a.representation=t,!e[o].hasOwnProperty(r.default.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");a.schemeIdUri=e[o].schemeIdUri,e[o].hasOwnProperty(i.default.TIMESCALE)&&(a.timescale=e[o].timescale),e[o].hasOwnProperty(i.default.VALUE)&&(a.value=e[o].value),s.push(a),a.period=n}return s}function H(e){var t=[],n=e.BaseURL_asArray||[e.baseUri],r=!1;return n.some((function(n){if(n){var o=new d.default,s=n.__text||n;return T.isRelative(s)&&(r=!0,e.baseUri&&(s=T.resolve(s,e.baseUri))),o.url=s,n.hasOwnProperty(i.default.SERVICE_LOCATION)&&n.serviceLocation.length?o.serviceLocation=n.serviceLocation:o.serviceLocation=s,n.hasOwnProperty(i.default.DVB_PRIORITY)&&(o.dvb_priority=n[i.default.DVB_PRIORITY]),n.hasOwnProperty(i.default.DVB_WEIGHT)&&(o.dvb_weight=n[i.default.DVB_WEIGHT]),n.hasOwnProperty(i.default.AVAILABILITY_TIME_OFFSET)&&(o.availabilityTimeOffset=n[i.default.AVAILABILITY_TIME_OFFSET]),n.hasOwnProperty(i.default.AVAILABILITY_TIME_COMPLETE)&&(o.availabilityTimeComplete="false"!==n[i.default.AVAILABILITY_TIME_COMPLETE]),t.push(o),r}})),t}return e={getIsTypeOf:C,getIsText:O,getIsFragmented:A,getProducerReferenceTimesForAdaptation:function(e){var t=e&&e.hasOwnProperty(i.default.PRODUCERREFERENCETIME_ASARRAY)?e[i.default.PRODUCERREFERENCETIME_ASARRAY]:[];(e&&e.hasOwnProperty(i.default.REPRESENTATION_ASARRAY)?e[i.default.REPRESENTATION_ASARRAY]:[]).forEach((function(e){e.hasOwnProperty(i.default.PRODUCERREFERENCETIME_ASARRAY)&&t.push.apply(t,w(e[i.default.PRODUCERREFERENCETIME_ASARRAY]))}));var n=[];return t.forEach((function(e){var t=new h.default;e.hasOwnProperty(i.default.ID)&&(t[i.default.ID]=e[i.default.ID],e.hasOwnProperty(i.default.WALL_CLOCK_TIME)&&(t[i.default.WALL_CLOCK_TIME]=e[i.default.WALL_CLOCK_TIME],e.hasOwnProperty(i.default.PRESENTATION_TIME)&&(t[i.default.PRESENTATION_TIME]=e[i.default.PRESENTATION_TIME],n.push(t))))})),n},getLanguageForAdaptation:function(e){var t="";return e&&e.hasOwnProperty(i.default.LANG)&&(t=e.lang),t},getViewpointForAdaptation:function(e){return e&&e.hasOwnProperty(i.default.VIEWPOINT)?e.Viewpoint:null},getRolesForAdaptation:function(e){return e&&e.hasOwnProperty(i.default.ROLE_ASARRAY)?e.Role_asArray:[]},getAccessibilityForAdaptation:function(e){return e&&e.hasOwnProperty(i.default.ACCESSIBILITY_ASARRAY)?e.Accessibility_asArray:[]},getAudioChannelConfigurationForAdaptation:function(e){return e&&e.hasOwnProperty(i.default.AUDIOCHANNELCONFIGURATION_ASARRAY)?e.AudioChannelConfiguration_asArray:[]},getAudioChannelConfigurationForRepresentation:function(e){return e&&e.hasOwnProperty(i.default.AUDIOCHANNELCONFIGURATION_ASARRAY)?e.AudioChannelConfiguration_asArray:[]},getAdaptationForIndex:function(e,t,n){var r=P(t,n);return r.length>0&&k(e)?r[e]:null},getIndexForAdaptation:function(e,t,n){if(!e)return-1;for(var r=P(t,n),i=0;i<r.length;i++)if((0,g.default)(S).getInstance().areEqual(r[i],e))return i;return-1},getAdaptationForId:function(e,t,n){var r,o,s=P(t,n);for(r=0,o=s.length;r<o;r++)if(s[r].hasOwnProperty(i.default.ID)&&s[r].id===e)return s[r];return null},getAdaptationsForType:function(e,t,n){var r,i,o=P(e,t),s=[];for(r=0,i=o.length;r<i;r++)C(o[r],n)&&s.push(R(o[r]));return s},getRealPeriods:D,getRealPeriodForIndex:function(e,t){var n=D(t);return n.length>0&&k(e)?n[e]:null},getCodec:function(e,t,n){var r=null;if(e&&e.Representation_asArray&&e.Representation_asArray.length>0){var i=k(t)&&t>=0&&t<e.Representation_asArray.length?e.Representation_asArray[t]:e.Representation_asArray[0];i&&(r=i.mimeType+';codecs="'+i.codecs+'"',n&&void 0!==i.width&&(r+=';width="'+i.width+'";height="'+i.height+'"'))}return r&&(r=r.replace(/\sprofiles=[^;]*/g,"")),r},getSelectionPriority:function(e){try{var t=e&&void 0!==e.selectionPriority?parseInt(e.selectionPriority):1;return isNaN(t)?1:t}catch(e){return 1}},getMimeType:function(e){return e&&e.Representation_asArray&&e.Representation_asArray.length>0?e.Representation_asArray[0].mimeType:null},getKID:function(e){return e&&e.hasOwnProperty(i.default.CENC_DEFAULT_KID)?e[i.default.CENC_DEFAULT_KID]:null},getLabelsForAdaptation:function(e){if(!e||!Array.isArray(e.Label_asArray))return[];for(var t=[],n=0;n<e.Label_asArray.length;n++)t.push({lang:e.Label_asArray[n].lang,text:e.Label_asArray[n].__text||e.Label_asArray[n]});return t},getContentProtectionData:function(e){return e&&e.hasOwnProperty(i.default.CONTENTPROTECTION_ASARRAY)&&0!==e.ContentProtection_asArray.length?e.ContentProtection_asArray:null},getIsDynamic:M,getId:function(e){return e&&e[i.default.ID]||null},hasProfile:function(e,t){var n=!1;return e&&e.profiles&&e.profiles.length>0&&(n=-1!==e.profiles.indexOf(t)),n},getDuration:function(e){return e&&e.hasOwnProperty(i.default.MEDIA_PRESENTATION_DURATION)?e.mediaPresentationDuration:e&&"dynamic"==e.type?Number.POSITIVE_INFINITY:Number.MAX_SAFE_INTEGER||Number.MAX_VALUE},getBandwidth:function(e){return e&&e.bandwidth?e.bandwidth:NaN},getManifestUpdatePeriod:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=NaN;return e&&e.hasOwnProperty(i.default.MINIMUM_UPDATE_PERIOD)&&(n=e.minimumUpdatePeriod),isNaN(n)?n:Math.max(n-t,1)},getPublishTime:function(e){return e&&e.hasOwnProperty(i.default.PUBLISH_TIME)?new Date(e[i.default.PUBLISH_TIME]):null},getRepresentationCount:function(e){return e&&Array.isArray(e.Representation_asArray)?e.Representation_asArray.length:0},getBitrateListForAdaptation:function(e){var t=R(e);return(t&&Array.isArray(t.Representation_asArray)?t.Representation_asArray:[]).map((function(e){return{bandwidth:e.bandwidth,width:e.width||0,height:e.height||0,scanType:e.scanType||null,id:e.id||null}}))},getRepresentationFor:function(e,t){return t&&t.Representation_asArray&&t.Representation_asArray.length>0&&k(e)?t.Representation_asArray[e]:null},getRepresentationsForAdaptation:function(e){var t,n,r,s,a=[],l=function(e){if(e&&e.period&&k(e.period.index)){var t=e.period.mpd.manifest.Period_asArray[e.period.index];if(t&&t.AdaptationSet_asArray&&k(e.index))return R(t.AdaptationSet_asArray[e.index])}}(e);if(l&&l.Representation_asArray){if(e&&e.period&&k(e.period.index)){var c=H(e.period.mpd.manifest);c&&(n=c[0])}for(var u=0,d=l.Representation_asArray.length;u<d;++u){var p=l.Representation_asArray[u],h=new o.default;if(h.index=u,h.adaptation=e,p.hasOwnProperty(i.default.ID)&&(h.id=p.id),p.hasOwnProperty(i.default.CODECS)&&(h.codecs=p.codecs),p.hasOwnProperty(i.default.MIME_TYPE)&&(h.mimeType=p[i.default.MIME_TYPE]),p.hasOwnProperty(i.default.CODEC_PRIVATE_DATA)&&(h.codecPrivateData=p.codecPrivateData),p.hasOwnProperty(i.default.BANDWITH)&&(h.bandwidth=p.bandwidth),p.hasOwnProperty(i.default.WIDTH)&&(h.width=p.width),p.hasOwnProperty(i.default.HEIGHT)&&(h.height=p.height),p.hasOwnProperty(i.default.SCAN_TYPE)&&(h.scanType=p.scanType),p.hasOwnProperty(i.default.MAX_PLAYOUT_RATE)&&(h.maxPlayoutRate=p.maxPlayoutRate),p.hasOwnProperty(i.default.SEGMENT_BASE)?(t=p.SegmentBase,h.segmentInfoType=i.default.SEGMENT_BASE):p.hasOwnProperty(i.default.SEGMENT_LIST)?(t=p.SegmentList).hasOwnProperty(i.default.SEGMENT_TIMELINE)?h.segmentInfoType=i.default.SEGMENT_TIMELINE:h.segmentInfoType=i.default.SEGMENT_LIST:p.hasOwnProperty(i.default.SEGMENT_TEMPLATE)?((t=p.SegmentTemplate).hasOwnProperty(i.default.SEGMENT_TIMELINE)?h.segmentInfoType=i.default.SEGMENT_TIMELINE:h.segmentInfoType=i.default.SEGMENT_TEMPLATE,t.hasOwnProperty(i.default.INITIALIZATION_MINUS)&&(h.initialization=t.initialization.split("$Bandwidth$").join(p.bandwidth).split("$RepresentationID$").join(p.id))):h.segmentInfoType=i.default.BASE_URL,h.essentialProperties=L(p),t){if(t.hasOwnProperty(i.default.INITIALIZATION)){var f=t.Initialization;f.hasOwnProperty(i.default.SOURCE_URL)&&(h.initialization=f.sourceURL),f.hasOwnProperty(i.default.RANGE)&&(h.range=f.range)}else O(l)&&A(l)&&l.mimeType&&-1===l.mimeType.indexOf("application/mp4")&&(h.range=0);t.hasOwnProperty(i.default.TIMESCALE)&&(h.timescale=t.timescale),t.hasOwnProperty(i.default.DURATION)?h.segmentDuration=t.duration/h.timescale:p.hasOwnProperty(i.default.SEGMENT_TEMPLATE)&&(t=p.SegmentTemplate).hasOwnProperty(i.default.SEGMENT_TIMELINE)&&(h.segmentDuration=B(t.SegmentTimeline)/h.timescale),t.hasOwnProperty(i.default.MEDIA)&&(h.media=t.media),t.hasOwnProperty(i.default.START_NUMBER)&&(h.startNumber=t.startNumber),t.hasOwnProperty(i.default.INDEX_RANGE)&&(h.indexRange=t.indexRange),t.hasOwnProperty(i.default.PRESENTATION_TIME_OFFSET)&&(h.presentationTimeOffset=t.presentationTimeOffset/h.timescale),t.hasOwnProperty(i.default.AVAILABILITY_TIME_OFFSET)?h.availabilityTimeOffset=t.availabilityTimeOffset:n&&void 0!==n.availabilityTimeOffset&&(h.availabilityTimeOffset=n.availabilityTimeOffset),t.hasOwnProperty(i.default.AVAILABILITY_TIME_COMPLETE)?h.availabilityTimeComplete="false"!==t.availabilityTimeComplete:n&&void 0!==n.availabilityTimeComplete&&(h.availabilityTimeComplete=n.availabilityTimeComplete)}h.MSETimeOffset=(s=(r=h).presentationTimeOffset,r.adaptation.period.start-s),h.path=[e.period.index,e.index,u],a.push(h)}}return a},getAdaptationsForPeriod:function(e){var n,o,a,l=e&&k(e.index)?e.mpd.manifest.Period_asArray[e.index]:null,c=[];if(l&&l.AdaptationSet_asArray)for(a=0;a<l.AdaptationSet_asArray.length;a++)o=l.AdaptationSet_asArray[a],n=new s.default,o.hasOwnProperty(i.default.ID)&&(n.id=o.id),n.index=a,n.period=e,C(o,r.default.MUXED)?n.type=r.default.MUXED:j(o)?n.type=r.default.AUDIO:I(o)?n.type=r.default.VIDEO:O(o)?n.type=r.default.TEXT:N(o)?n.type=r.default.IMAGE:t.warn("Unknown Adaptation stream type"),c.push(n);return c},getRegularPeriods:function(e){var o,s,l=!!e&&M(e.manifest),c=[],u=null,d=null,p=null,h=null;for(s=0,o=e&&e.manifest&&e.manifest.Period_asArray?e.manifest.Period_asArray.length:0;s<o;s++)(d=e.manifest.Period_asArray[s]).hasOwnProperty(i.default.START)?(h=new a.default).start=d.start:null!==u&&u.hasOwnProperty(i.default.DURATION)&&null!==p?(h=new a.default).start=parseFloat((p.start+p.duration).toFixed(5)):0!==s||l||((h=new a.default).start=0),null!==p&&isNaN(p.duration)&&(null!==h?p.duration=parseFloat((h.start-p.start).toFixed(5)):t.warn("First period duration could not be calculated because lack of start and duration period properties. This will cause timing issues during playback")),null!==h&&(h.id=F(d,s),h.index=s,h.mpd=e,d.hasOwnProperty(i.default.DURATION)&&(h.duration=d.duration),p&&(p.nextPeriodId=h.id),c.push(h),u=d,p=h),d=null,h=null;return 0===c.length||null!==p&&isNaN(p.duration)&&(p.duration=parseFloat((function(e){!function(){if(!n||!n.hasOwnProperty("error"))throw new Error(r.default.MISSING_CONFIG_ERROR)}();var t,i=M(e.mpd.manifest);return e.mpd.manifest.mediaPresentationDuration?t=e.mpd.manifest.mediaPresentationDuration:e.duration?t=e.duration:i?t=Number.POSITIVE_INFINITY:n.error(new b.default(x.default.MANIFEST_ERROR_ID_PARSE_CODE,"Must have @mediaPresentationDuration on MPD or an explicit @duration on the last period.",e)),t}(p)-p.start).toFixed(5))),c},getMpd:function(e){var t=new l.default;return e&&(t.manifest=e,e.hasOwnProperty(i.default.AVAILABILITY_START_TIME)?t.availabilityStartTime=new Date(e.availabilityStartTime.getTime()):e.loadedTime&&(t.availabilityStartTime=new Date(e.loadedTime.getTime())),e.hasOwnProperty(i.default.AVAILABILITY_END_TIME)&&(t.availabilityEndTime=new Date(e.availabilityEndTime.getTime())),e.hasOwnProperty(i.default.MINIMUM_UPDATE_PERIOD)&&(t.minimumUpdatePeriod=e.minimumUpdatePeriod),e.hasOwnProperty(i.default.MEDIA_PRESENTATION_DURATION)&&(t.mediaPresentationDuration=e.mediaPresentationDuration),e.hasOwnProperty(i.default.SUGGESTED_PRESENTATION_DELAY)&&(t.suggestedPresentationDelay=e.suggestedPresentationDelay),e.hasOwnProperty(i.default.TIMESHIFT_BUFFER_DEPTH)&&(t.timeShiftBufferDepth=e.timeShiftBufferDepth),e.hasOwnProperty(i.default.MAX_SEGMENT_DURATION)&&(t.maxSegmentDuration=e.maxSegmentDuration),e.hasOwnProperty(i.default.PUBLISH_TIME)&&(t.publishTime=new Date(e.publishTime))),t},getEventsForPeriod:function(e){var t,n,o=e&&e.mpd&&e.mpd.manifest?e.mpd.manifest:null,s=o?o.Period_asArray:null,a=s&&e&&k(e.index)?s[e.index].EventStream_asArray:null,l=[];if(a)for(t=0;t<a.length;t++){var c=new p.default;if(c.period=e,c.timescale=1,!a[t].hasOwnProperty(r.default.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");for(c.schemeIdUri=a[t][r.default.SCHEME_ID_URI],a[t].hasOwnProperty(i.default.TIMESCALE)&&(c.timescale=a[t][i.default.TIMESCALE]),a[t].hasOwnProperty(i.default.VALUE)&&(c.value=a[t][i.default.VALUE]),a[t].hasOwnProperty(i.default.PRESENTATION_TIME_OFFSET)&&(c.presentationTimeOffset=a[t][i.default.PRESENTATION_TIME_OFFSET]),n=0;a[t].Event_asArray&&n<a[t].Event_asArray.length;n++){var d=a[t].Event_asArray[n],h=new u.default;h.presentationTime=0,h.eventStream=c,d.hasOwnProperty(i.default.PRESENTATION_TIME)&&(h.presentationTime=d.presentationTime);var f=c.presentationTimeOffset?c.presentationTimeOffset/c.timescale:0;h.calculatedPresentationTime=h.presentationTime/c.timescale+e.start-f,d.hasOwnProperty(i.default.DURATION)&&(h.duration=d.duration/c.timescale),d.hasOwnProperty(i.default.ID)?h.id=d.id:h.id=null,d.Signal&&d.Signal.Binary?h.messageData=v.decodeArray(d.Signal.Binary.toString()):h.messageData=d.messageData||d.__cdata||d.__text,l.push(h)}}return l},getEssentialPropertiesForRepresentation:L,getEventStreamForAdaptationSet:function(e,t,n){var r,i,o;return e&&e.Period_asArray&&t&&t.period&&k(t.period.index)&&(i=e.Period_asArray[t.period.index])&&i.AdaptationSet_asArray&&k(t.index)&&(o=i.AdaptationSet_asArray[t.index])&&(r=o.InbandEventStream_asArray),U(r,null,n)},getEventStreamForRepresentation:function(e,t,n){var r,i,o,s;return e&&e.Period_asArray&&t&&t.adaptation&&t.adaptation.period&&k(t.adaptation.period.index)&&(i=e.Period_asArray[t.adaptation.period.index])&&i.AdaptationSet_asArray&&k(t.adaptation.index)&&(o=i.AdaptationSet_asArray[t.adaptation.index])&&o.Representation_asArray&&k(t.index)&&(s=o.Representation_asArray[t.index])&&(r=s.InbandEventStream_asArray),U(r,t,n)},getUTCTimingSources:function(e){var t=M(e),n=!!e&&e.hasOwnProperty(i.default.AVAILABILITY_START_TIME),o=e?e.UTCTiming_asArray:null,s=[];return(t||n)&&o&&o.forEach((function(e){var t=new c.default;e.hasOwnProperty(r.default.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty(i.default.VALUE)&&(t.value=e.value.toString(),s.push(t)))})),s},getBaseURLsFromElement:H,getRepresentationSortFunction:function(){return function(e,t){return e.bandwidth-t.bandwidth}},getContentSteering:function(e){if(e&&e.hasOwnProperty(i.default.CONTENT_STEERING_AS_ARRAY)){var t=e[i.default.CONTENT_STEERING_AS_ARRAY][0],n=new f.default;return n.serverUrl=t.__text,t.hasOwnProperty(i.default.DEFAULT_SERVICE_LOCATION)&&(n.defaultServiceLocation=t[i.default.DEFAULT_SERVICE_LOCATION]),t.hasOwnProperty(i.default.QUERY_BEFORE_START)&&(n.queryBeforeStart="true"===t[i.default.QUERY_BEFORE_START].toLowerCase()),t.hasOwnProperty(i.default.PROXY_SERVER_URL)&&(n.proxyServerUrl=t[i.default.PROXY_SERVER_URL]),n}},getLocation:function(e){if(e&&e.hasOwnProperty(r.default.LOCATION))return e.Location=e.Location_asArray[0],e.Location},getPatchLocation:function(e){if(e&&e.hasOwnProperty(i.default.PATCH_LOCATION))return e.PatchLocation=e.PatchLocation_asArray[0],e.PatchLocation},getSuggestedPresentationDelay:function(e){return e&&e.hasOwnProperty(i.default.SUGGESTED_PRESENTATION_DELAY)?e.suggestedPresentationDelay:null},getAvailabilityStartTime:function(e){return e&&e.hasOwnProperty(i.default.AVAILABILITY_START_TIME)&&null!==e.availabilityStartTime?e.availabilityStartTime.getTime():null},getServiceDescriptions:function(e){var t=[];if(e&&e.hasOwnProperty(i.default.SERVICE_DESCRIPTION)){var n,r=_(e.ServiceDescription_asArray);try{for(r.s();!(n=r.n()).done;){var o=n.value,s=null,a=null,l=null,c=null,u=null,d=null;for(var p in o)o.hasOwnProperty(p)&&(p===i.default.ID?s=o[p]:p===i.default.SERVICE_DESCRIPTION_SCOPE?a=o[p].schemeIdUri:p===i.default.SERVICE_DESCRIPTION_LATENCY?l={target:parseInt(o[p].target),max:parseInt(o[p].max),min:parseInt(o[p].min),referenceId:parseInt(o[p].referenceId)}:p===i.default.SERVICE_DESCRIPTION_PLAYBACK_RATE?c={max:parseFloat(o[p].max),min:parseFloat(o[p].min)}:p===i.default.SERVICE_DESCRIPTION_OPERATING_QUALITY?u={mediaType:o[p].mediaType,max:parseInt(o[p].max),min:parseInt(o[p].min),target:parseInt(o[p].target),type:o[p].type,maxQualityDifference:parseInt(o[p].maxQualityDifference)}:p===i.default.SERVICE_DESCRIPTION_OPERATING_BANDWIDTH&&(d={mediaType:o[p].mediaType,max:parseInt(o[p].max),min:parseInt(o[p].min),target:parseInt(o[p].target)}));t.push({id:s,schemeIdUri:a,latency:l,playbackRate:c,operatingQuality:u,operatingBandwidth:d})}}catch(e){r.e(e)}finally{r.f()}}return t},getSupplementalProperties:function(e){var t={};if(e&&e.hasOwnProperty(i.default.SUPPLEMENTAL_PROPERTY)){var n,o=_(e.SupplementalProperty_asArray);try{for(o.s();!(n=o.n()).done;){var s=n.value;s.hasOwnProperty(r.default.SCHEME_ID_URI)&&s.hasOwnProperty(i.default.VALUE)&&(t[s[r.default.SCHEME_ID_URI]]=s[i.default.VALUE])}}catch(e){o.e(e)}finally{o.f()}}return t},setConfig:function(e){e&&(e.errHandler&&(n=e.errHandler),e.BASE64&&(v=e.BASE64))}},t=(0,y.default)(S).getInstance().getLogger(e),e}k.__dashjs_factory_name="DashManifestModel";const C=v.default.getSingletonFactory(k)},"./src/dash/models/PatchManifestModel.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var r=n("./src/dash/constants/DashConstants.js"),i=n("./src/core/FactoryMaker.js"),o=n("./src/core/Debug.js"),s=n("./src/dash/vo/SimpleXPath.js"),a=n("./src/dash/vo/PatchOperation.js");function l(){var e,t,n=this.context;return e={getIsPatch:function(e){return e&&e.hasOwnProperty(r.default.ORIGINAL_MPD_ID)||!1},getPublishTime:function(e){return e&&e.hasOwnProperty(r.default.PUBLISH_TIME)?new Date(e[r.default.PUBLISH_TIME]):null},getOriginalPublishTime:function(e){return e&&e.hasOwnProperty(r.default.ORIGINAL_PUBLISH_TIME)?new Date(e[r.default.ORIGINAL_PUBLISH_TIME]):null},getMpdId:function(e){return e&&e[r.default.ORIGINAL_MPD_ID]||null},getPatchOperations:function(e){return e?(e.__children||[]).map((function(e){var n=Object.keys(e)[0];if("add"!==n&&"remove"!==n&&"replace"!==n)return t.warn("Ignoring node of invalid action: ".concat(n)),null;var r=e[n],i=r.sel;if("add"===n&&r.type){if(!r.type.startsWith("@"))return t.warn("Ignoring add action for prefixed namespace declaration: ".concat(r.type,"=").concat(r.__text)),null;i="".concat(i,"/").concat(r.type)}var o=new s.default(i);if(!o.isValid())return t.warn("Ignoring action with invalid selector: ".concat(n," - ").concat(i)),null;var l=null;o.findsAttribute()?l=r.__text||"":"remove"!==n&&(l=r.__children.reduce((function(e,t){var n=Object.keys(t)[0];return"#text"!==n&&(e[n]=e[n]||[],e[n].push(t[n])),e}),{}));var c=new a.default(n,o,l);return"add"===n&&(c.position=r.pos),c})).filter((function(e){return!!e})):[]}},t=(0,o.default)(n).getInstance().getLogger(e),e}l.__dashjs_factory_name="PatchManifestModel";const c=i.default.getSingletonFactory(l)},"./src/dash/parser/DashParser.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>f});var r=n("./src/core/FactoryMaker.js"),i=n("./src/dash/parser/objectiron.js"),o=n("./externals/xml2json.js"),s=n("./src/dash/parser/matchers/StringMatcher.js"),a=n("./src/dash/parser/matchers/DurationMatcher.js"),l=n("./src/dash/parser/matchers/DateTimeMatcher.js"),c=n("./src/dash/parser/matchers/NumericMatcher.js"),u=n("./src/dash/parser/matchers/LangMatcher.js"),d=n("./src/dash/parser/maps/RepresentationBaseValuesMap.js"),p=n("./src/dash/parser/maps/SegmentValuesMap.js");function h(e){e=e||{};var t,n,r,h,f,g=this.context,m=e.debug;return t={parse:function(e){var t,r=window.performance.now();if(!(t=h.xml_str2json(e)))throw new Error("parsing the manifest failed");var i=window.performance.now();t.Patch?((t=t.Patch).add_asArray&&t.add_asArray.forEach((function(e){return f.run(e)})),t.replace_asArray&&t.replace_asArray.forEach((function(e){return f.run(e)}))):(t=t.MPD,f.run(t));var o=window.performance.now();return n.info("Parsing complete: ( xml2json: "+(i-r).toPrecision(3)+"ms, objectiron: "+(o-i).toPrecision(3)+"ms, total: "+((o-r)/1e3).toPrecision(3)+"s)"),t.protocol="DASH",t},getMatchers:function(){return r},getIron:function(){return f}},n=m.getLogger(t),r=[new a.default,new l.default,new c.default,new u.default,new s.default],h=new o.default({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!0,ignoreRoot:!1,matchers:r}),f=(0,i.default)(g).create({adaptationset:new d.default,period:new p.default}),t}h.__dashjs_factory_name="DashParser";const f=r.default.getClassFactory(h)},"./src/dash/parser/maps/CommonProperty.js":(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,{default:()=>i});const i=function(){function e(t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t,this._merge=(n=t)&&n.length&&n.charAt(0)===n.charAt(0).toUpperCase()}var t,n;return t=e,(n=[{key:"name",get:function(){return this._name}},{key:"merge",get:function(){return this._merge}}])&&r(t.prototype,n),e}()},"./src/dash/parser/maps/MapNode.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/dash/parser/maps/CommonProperty.js");function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const o=function(){function e(t,n,i){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t||"",this._properties=[],this._children=i||[],Array.isArray(n)&&n.forEach((function(e){o._properties.push(new r.default(e))}))}var t,n;return t=e,(n=[{key:"name",get:function(){return this._name}},{key:"children",get:function(){return this._children}},{key:"properties",get:function(){return this._properties}}])&&i(t.prototype,n),e}()},"./src/dash/parser/maps/RepresentationBaseValuesMap.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var r=n("./src/dash/parser/maps/MapNode.js"),i=n("./src/dash/constants/DashConstants.js");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(n,r.default);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=a(e);if(t){var i=a(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,n)}}(n);function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var e=[i.default.PROFILES,i.default.WIDTH,i.default.HEIGHT,i.default.SAR,i.default.FRAMERATE,i.default.AUDIO_SAMPLING_RATE,i.default.MIME_TYPE,i.default.SEGMENT_PROFILES,i.default.CODECS,i.default.MAXIMUM_SAP_PERIOD,i.default.START_WITH_SAP,i.default.MAX_PLAYOUT_RATE,i.default.CODING_DEPENDENCY,i.default.SCAN_TYPE,i.default.FRAME_PACKING,i.default.AUDIO_CHANNEL_CONFIGURATION,i.default.CONTENT_PROTECTION,i.default.ESSENTIAL_PROPERTY,i.default.SUPPLEMENTAL_PROPERTY,i.default.INBAND_EVENT_STREAM];return t.call(this,i.default.ADAPTATION_SET,e,[new r.default(i.default.REPRESENTATION,e,[new r.default(i.default.SUB_REPRESENTATION,e)])])}return n}()},"./src/dash/parser/maps/SegmentValuesMap.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var r=n("./src/dash/parser/maps/MapNode.js"),i=n("./src/dash/constants/DashConstants.js");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(n,r.default);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=a(e);if(t){var i=a(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,n)}}(n);function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var e=[i.default.SEGMENT_BASE,i.default.SEGMENT_TEMPLATE,i.default.SEGMENT_LIST];return t.call(this,i.default.PERIOD,e,[new r.default(i.default.ADAPTATION_SET,e,[new r.default(i.default.REPRESENTATION,e)])])}return n}()},"./src/dash/parser/matchers/BaseMatcher.js":(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,{default:()=>i});const i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._test=t,this._converter=n}var t,n;return t=e,(n=[{key:"test",get:function(){return this._test}},{key:"converter",get:function(){return this._converter}}])&&r(t.prototype,n),e}()},"./src/dash/parser/matchers/DateTimeMatcher.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var r=n("./src/dash/parser/matchers/BaseMatcher.js");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var a=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})(?::?)([0-9]{2}))?/;const l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(n,r.default);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var o=s(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,n)}}(n);function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t.call(this,(function(e){return a.test(e.value)}),(function(e){var t,n=a.exec(e);if(t=Date.UTC(parseInt(n[1],10),parseInt(n[2],10)-1,parseInt(n[3],10),parseInt(n[4],10),parseInt(n[5],10),n[6]&&parseInt(n[6],10)||0,n[7]&&1e3*parseFloat(n[7])||0),n[9]&&n[10]){var r=60*parseInt(n[9],10)+parseInt(n[10],10);t+=("+"===n[8]?-1:1)*r*60*1e3}return new Date(t)}))}return n}()},"./src/dash/parser/matchers/DurationMatcher.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var r=n("./src/dash/parser/matchers/BaseMatcher.js"),i=n("./src/streaming/constants/Constants.js"),o=n("./src/dash/constants/DashConstants.js");function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/;const u=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(n,r.default);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var i=l(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,n)}}(n);function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t.call(this,(function(e){for(var t=[o.default.MIN_BUFFER_TIME,o.default.MEDIA_PRESENTATION_DURATION,o.default.MINIMUM_UPDATE_PERIOD,o.default.TIMESHIFT_BUFFER_DEPTH,o.default.MAX_SEGMENT_DURATION,o.default.MAX_SUBSEGMENT_DURATION,o.default.SUGGESTED_PRESENTATION_DELAY,o.default.START,i.default.START_TIME,o.default.DURATION],n=t.length,r=0;r<n;r++)if(e.nodeName===t[r])return c.test(e.value);return!1}),(function(e){var t=c.exec(e),n=31536e3*parseFloat(t[3]||0)+2592e3*parseFloat(t[5]||0)+86400*parseFloat(t[7]||0)+3600*parseFloat(t[9]||0)+60*parseFloat(t[11]||0)+parseFloat(t[13]||0);return void 0!==t[1]&&(n=-n),n}))}return n}()},"./src/dash/parser/matchers/LangMatcher.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var r=n("./src/dash/parser/matchers/BaseMatcher.js"),i=n("./src/dash/constants/DashConstants.js"),o=n("./node_modules/bcp-47-normalize/index.js"),s=n.n(o);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(n,r.default);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=u(e);if(t){var i=u(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,n)}}(n);function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t.call(this,(function(e,t){var n,r=(l(n={},i.default.ADAPTATION_SET,[i.default.LANG]),l(n,i.default.REPRESENTATION,[i.default.LANG]),l(n,i.default.CONTENT_COMPONENT,[i.default.LANG]),l(n,i.default.LABEL,[i.default.LANG]),l(n,i.default.GROUP_LABEL,[i.default.LANG]),n);if(r.hasOwnProperty(t)){var o=r[t];return void 0!==o&&o.indexOf(e.name)>=0}return!1}),(function(e){var t=s()(e);return void 0!==t?t:String(e)}))}return n}()},"./src/dash/parser/matchers/NumericMatcher.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var r=n("./src/dash/parser/matchers/BaseMatcher.js");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var a=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/;const l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(n,r.default);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var o=s(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,n)}}(n);function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t.call(this,(function(e){return a.test(e.value)}),(function(e){return parseFloat(e)}))}return n}()},"./src/dash/parser/matchers/StringMatcher.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var r=n("./src/dash/parser/matchers/BaseMatcher.js"),i=n("./src/dash/constants/DashConstants.js");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(n,r.default);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var i=l(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,n)}}(n);function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t.call(this,(function(e,t){var n,r=(s(n={},i.default.MPD,[i.default.ID,i.default.PROFILES]),s(n,i.default.PERIOD,[i.default.ID]),s(n,i.default.BASE_URL,[i.default.SERVICE_LOCATION,i.default.BYTE_RANGE]),s(n,i.default.SEGMENT_BASE,[i.default.INDEX_RANGE]),s(n,i.default.INITIALIZATION,[i.default.RANGE]),s(n,i.default.REPRESENTATION_INDEX,[i.default.RANGE]),s(n,i.default.SEGMENT_LIST,[i.default.INDEX_RANGE]),s(n,i.default.BITSTREAM_SWITCHING,[i.default.RANGE]),s(n,i.default.SEGMENT_URL,[i.default.MEDIA_RANGE,i.default.INDEX_RANGE]),s(n,i.default.SEGMENT_TEMPLATE,[i.default.INDEX_RANGE,i.default.MEDIA,i.default.INDEX,i.default.INITIALIZATION_MINUS,i.default.BITSTREAM_SWITCHING_MINUS]),s(n,i.default.ASSET_IDENTIFIER,[i.default.VALUE,i.default.ID]),s(n,i.default.EVENT_STREAM,[i.default.VALUE]),s(n,i.default.ADAPTATION_SET,[i.default.PROFILES,i.default.MIME_TYPE,i.default.SEGMENT_PROFILES,i.default.CODECS,i.default.CONTENT_TYPE]),s(n,i.default.FRAME_PACKING,[i.default.VALUE,i.default.ID]),s(n,i.default.AUDIO_CHANNEL_CONFIGURATION,[i.default.VALUE,i.default.ID]),s(n,i.default.CONTENT_PROTECTION,[i.default.VALUE,i.default.ID]),s(n,i.default.ESSENTIAL_PROPERTY,[i.default.VALUE,i.default.ID]),s(n,i.default.SUPPLEMENTAL_PROPERTY,[i.default.VALUE,i.default.ID]),s(n,i.default.INBAND_EVENT_STREAM,[i.default.VALUE,i.default.ID]),s(n,i.default.ACCESSIBILITY,[i.default.VALUE,i.default.ID]),s(n,i.default.ROLE,[i.default.VALUE,i.default.ID]),s(n,i.default.RATING,[i.default.VALUE,i.default.ID]),s(n,i.default.VIEWPOINT,[i.default.VALUE,i.default.ID]),s(n,i.default.CONTENT_COMPONENT,[i.default.CONTENT_TYPE]),s(n,i.default.REPRESENTATION,[i.default.ID,i.default.DEPENDENCY_ID,i.default.MEDIA_STREAM_STRUCTURE_ID]),s(n,i.default.SUBSET,[i.default.ID]),s(n,i.default.METRICS,[i.default.METRICS_MINUS]),s(n,i.default.REPORTING,[i.default.VALUE,i.default.ID]),n);if(r.hasOwnProperty(t)){var o=r[t];return void 0!==o&&o.indexOf(e.name)>=0}return!1}),(function(e){return String(e)}))}return n}()},"./src/dash/parser/objectiron.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/core/FactoryMaker.js");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){function t(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function n(e,n,r){for(var o=0,s=e.length;o<s;++o){var a=e[o];if(n[a.name])if(r[a.name]){if(a.merge){var l=n[a.name],c=r[a.name];"object"===i(l)&&"object"===i(c)?t(l,c):r[a.name]=l+c}}else r[a.name]=n[a.name]}}function r(e,t){for(var i=0,o=e.children.length;i<o;++i){var s=e.children[i],a=t[s.name+"_asArray"];if(a)for(var l=0,c=a.length;l<c;++l){var u=a[l];n(e.properties,t,u),r(s,u)}}}return{run:function(t){if(null===t||"object"!==i(t))return t;if(t.Period_asArray&&"period"in e)for(var n=e.period,o=t.Period_asArray,s=0,a=o.length;s<a;++s){var l=o[s];if(r(n,l),"adaptationset"in e){var c=l.AdaptationSet_asArray;if(c)for(var u=e.adaptationset,d=0,p=c.length;d<p;++d)r(u,c[d])}}return t}}}o.__dashjs_factory_name="ObjectIron";const s=r.default.getClassFactory(o)},"./src/dash/utils/ListSegmentsGetter.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/constants/Constants.js"),o=n("./src/dash/utils/SegmentsUtils.js");function s(e,t){var n=(e=e||{}).timelineConverter;function r(){if(!n||!n.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(i.default.MISSING_CONFIG_ERROR)}function s(e,i){if(r(),!e)return null;var s=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,a=s.SegmentURL_asArray.length,l=e&&!isNaN(e.startNumber)?e.startNumber:1,c=Math.max(l-1,0),u=Math.max(i-c,0),d=null;if(u<a){var p=s.SegmentURL_asArray[u];(d=(0,o.getIndexBasedSegment)(n,t,e,i))&&(d.replacementTime=(l+i-1)*e.segmentDuration,d.media=p.media?p.media:"",d.mediaRange=p.mediaRange,d.indexRange=p.indexRange)}return d}return{getSegmentByIndex:s,getSegmentByTime:function(e,t){if(r(),!e)return null;var i=e.segmentDuration;if(isNaN(i))return null;var o=n.calcPeriodRelativeTimeFromMpdRelativeTime(e,t);return s(e,Math.floor(o/i))},getMediaFinishedInformation:function(e){var t={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!e)return t;var n=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,r=e&&!isNaN(e.startNumber)?e.startNumber:1,i=Math.max(r-1,0);return t.numberOfSegments=i+n.SegmentURL_asArray.length,t}}}s.__dashjs_factory_name="ListSegmentsGetter";const a=r.default.getClassFactory(s)},"./src/dash/utils/Round10.js":(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,{default:()=>i});var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"round10",value:function(e,t){return function(e,t,n){return void 0===n||0==+n?Math[e](t):(n=+n,null===(t=+t)||isNaN(t)||"number"!=typeof n||n%1!=0?NaN:(t=t.toString().split("e"),+((t=(t=Math[e](+(t[0]+"e"+(t[1]?+t[1]-n:-n)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+n:n))))}("round",e,t)}}])&&r(t,n),e}()},"./src/dash/utils/SegmentBaseGetter.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/constants/Constants.js");function o(e){var t=(e=e||{}).timelineConverter;function n(){if(!t||!t.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(i.default.MISSING_CONFIG_ERROR)}function r(e,t){if(n(),!e)return null;var r,i=e.segments?e.segments.length:-1;if(t<i&&(r=e.segments[t])&&r.index===t)return r;for(var o=0;o<i;o++)if((r=e.segments[o])&&r.index===t)return r;return null}return{getSegmentByIndex:r,getSegmentByTime:function(e,t){return n(),r(e,function(e,t){if(!e)return-1;var n,r,i,o,s,a=e.segments,l=a?a.length:null,c=-1;if(a&&l>0)for(s=0;s<l;s++)if(i=(r=a[s]).presentationStartTime,t+(n=(o=r.duration)/2)>=i&&t-n<i+o){c=r.index;break}return c}(e,t))},getMediaFinishedInformation:function(e){var t={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};return e&&e.segments?(t.numberOfSegments=e.segments.length,t):t}}}o.__dashjs_factory_name="SegmentBaseGetter";const s=r.default.getClassFactory(o)},"./src/dash/utils/SegmentsUtils.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{getIndexBasedSegment:()=>function(e,t,n,r){var i,o,l;i=n.segmentDuration,isNaN(i)&&(i=n.adaptation.period.duration),o=parseFloat((n.adaptation.period.start+r*i).toFixed(5)),l=parseFloat((o+i).toFixed(5));var c=s(n,i,o,e.calcMediaTimeFromPresentationTime(o,n),e,l,t,r);return a(e,n,c,t)?c:null},getTimeBasedSegment:()=>function(e,t,n,r,i,l,c,u,d,p){var h,f,g=r/l,m=i/l;return h=e.calcPresentationTimeFromMediaTime(g,n),a(e,n,f=s(n,m,h,g,e,h+m,t,d),t)?(f.replacementTime=p||r,c=o(c,"Number",f.replacementNumber),c=o(c,"Time",f.replacementTime),f.media=c,f.mediaRange=u,f):null},replaceIDForTemplate:()=>function(e,t){if(!t||!e||-1===e.indexOf("$RepresentationID$"))return e;var n=t.toString();return e.split("$RepresentationID$").join(n)},replaceTokenForTemplate:()=>o,unescapeDollarsInTemplate:()=>function(e){return e?e.split("$$").join("$"):e}});var r=n("./src/dash/vo/Segment.js");function i(e,t){for(;e.length<t;)e="0"+e;return e}function o(e,t,n){var r,o,s,a,l,c,u=t.length,d="%0".length;if(!e)return e;for(;;){if((r=e.indexOf("$"+t))<0)return e;if((o=e.indexOf("$",r+u))<0)return e;if((s=e.indexOf("%0",r+u))>r&&s<o)switch(a=e.charAt(o-1),l=parseInt(e.substring(s+d,o-1),10),a){case"d":case"i":case"u":c=i(n.toString(),l);break;case"x":c=i(n.toString(16),l);break;case"X":c=i(n.toString(16),l).toUpperCase();break;case"o":c=i(n.toString(8),l);break;default:return e}else c=n;e=e.substring(0,r)+c+e.substring(o+1)}}function s(e,t,n,i,o,s,a,l){var c,u=new r.default;return u.representation=e,u.duration=t,u.presentationStartTime=n,u.mediaStartTime=i,u.availabilityStartTime=o.calcAvailabilityStartTimeFromPresentationTime(s,e,a),u.availabilityEndTime=o.calcAvailabilityEndTimeFromPresentationTime(s+t,e,a),u.wallStartTime=o.calcWallTimeForSegment(u,a),u.replacementNumber=(c=l,u.representation.startNumber+c),u.index=l,u}function a(e,t,n,r){var i=t.adaptation.period;if(isFinite(i.duration)&&i.start+i.duration<=n.presentationStartTime)return!1;if(r){if("INF"===t.availabilityTimeOffset)return!0;var o=e.getClientReferenceTime();return n.availabilityStartTime.getTime()<=o&&(!isFinite(n.availabilityEndTime)||n.availabilityEndTime.getTime()>=o)}return!0}},"./src/dash/utils/TemplateSegmentsGetter.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/constants/Constants.js"),o=n("./src/dash/utils/SegmentsUtils.js");function s(e,t){var n=(e=e||{}).timelineConverter;function r(){if(!n||!n.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(i.default.MISSING_CONFIG_ERROR)}function s(e,i){if(r(),!e)return null;var s=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate;i=Math.max(i,0);var a=(0,o.getIndexBasedSegment)(n,t,e,i);if(a){a.replacementTime=Math.round((i-1)*e.segmentDuration*e.timescale,10);var l=s.media;l=(0,o.replaceTokenForTemplate)(l,"Number",a.replacementNumber),l=(0,o.replaceTokenForTemplate)(l,"Time",a.replacementTime),a.media=l}return a}return{getSegmentByIndex:s,getSegmentByTime:function(e,t){if(r(),!e)return null;var i=e.segmentDuration;if(isNaN(i))return null;var o=n.calcPeriodRelativeTimeFromMpdRelativeTime(e,t);return s(e,Math.floor(o/i))},getMediaFinishedInformation:function(e){var t={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!e)return t;var n=e.segmentDuration;return isNaN(n)?t.numberOfSegments=1:t.numberOfSegments=Math.ceil(e.adaptation.period.duration/n),t}}}s.__dashjs_factory_name="TemplateSegmentsGetter";const a=r.default.getClassFactory(s)},"./src/dash/utils/TimelineConverter.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>h});var r=n("./src/core/EventBus.js"),i=n("./src/core/events/Events.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/dash/constants/DashConstants.js"),a=n("./src/dash/models/DashManifestModel.js"),l=n("./src/core/Settings.js"),c=n("./src/streaming/constants/Constants.js"),u=n("./src/streaming/MediaPlayerEvents.js"),d=n("./src/streaming/constants/ConformanceViolationConstants.js");function p(){var e,t,n,o,p=this.context,h=(0,r.default)(p).getInstance(),f=(0,l.default)(p).getInstance();function g(e){o=e}function m(e,t,n,r){var i,o=t.adaptation.period.mpd,s=o.availabilityStartTime;if(r)i=n&&o.timeShiftBufferDepth!==Number.POSITIVE_INFINITY?new Date(s.getTime()+1e3*(e+o.timeShiftBufferDepth)):o.availabilityEndTime;else if(n){var a=t.availabilityTimeOffset;i=new Date(s.getTime()+1e3*(e-a))}else i=s;return i}function v(e,t){return(e.getTime()-t.mpd.availabilityStartTime.getTime()+1e3*o)/1e3}function y(e,t){return e+(t.adaptation.period.start-t.presentationTimeOffset)}function b(e){var n={start:NaN,end:NaN},r=e[0].getAdapter().getRegularPeriods()[0],i=v(new Date,r);if(!e||0===e.length)return{range:n,now:i};e.forEach((function(e){var r=e.getAdapter(),o=r.getMediaInfoForType(e.getStreamInfo(),c.default.VIDEO)||r.getMediaInfoForType(e.getStreamInfo(),c.default.AUDIO),a=r.getVoRepresentations(o)[0],l={start:NaN,end:NaN};if(a)if(a.segmentInfoType===s.default.SEGMENT_TIMELINE)l=function(e){var n,r,i,o,s=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],a=t.getRepresentationFor(e.index,s),l=a.SegmentTemplate.SegmentTimeline,c=a.SegmentTemplate.timescale,u=l.S_asArray,d={start:0,end:0},p=0;for(d.start=y(u[0].t/c,e),i=0,o=u.length;i<o;i++)r=0,(n=u[i]).hasOwnProperty("r")&&(r=n.r),p+=n.d*(1+r);return d.end=y((u[0].t+p)/c,e),d}(a);else{var u=a.adaptation.period;l.start=u.start,l.end=Math.max(i,u.start+u.duration)}!isNaN(l.start)&&(isNaN(n.start)||n.start>l.start)&&(n.start=l.start),!isNaN(l.end)&&(isNaN(n.end)||n.end<l.end)&&(n.end=l.end)})),n.end=Math.min(i,n.end);var o=E(e,n.end,!0);return n.end=isNaN(o)?n.end:o,n.start=r&&r.mpd&&r.mpd.timeShiftBufferDepth&&!isNaN(r.mpd.timeShiftBufferDepth)&&!isNaN(n.end)?Math.max(n.end-r.mpd.timeShiftBufferDepth,n.start):n.start,n.start=E(e,n.start),{range:n,now:i}}function x(e,t){n=e-t.end}function E(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{for(var r=0,i=!1,o=NaN;!i&&r<e.length;){var s=e[r].getStreamInfo();s.start<=t&&(!isFinite(s.duration)||s.start+s.duration>=t)?(o=t,i=!0):!n&&s.start>t&&(isNaN(o)||s.start<o)?o=s.start:n&&s.start+s.duration<t&&(isNaN(o)||s.start+s.duration>o)&&(o=s.start+s.duration),r+=1}return o}catch(e){return t}}function _(e){void 0===e.offset||isNaN(e.offset)||g(e.offset/1e3)}function w(){o=0,n=0}function S(){h.off(i.default.UPDATE_TIME_SYNC_OFFSET,_,this),w()}return e={initialize:function(){w(),h.on(i.default.UPDATE_TIME_SYNC_OFFSET,_,this)},getClientTimeOffset:function(){return o},setClientTimeOffset:g,getClientReferenceTime:function(){return Date.now()-1e3*n+1e3*o},calcAvailabilityStartTimeFromPresentationTime:function(e,t,n){return m(e,t,n)},calcAvailabilityEndTimeFromPresentationTime:function(e,t,n){return m(e,t,n,!0)},calcPresentationTimeFromWallTime:v,calcPresentationTimeFromMediaTime:y,calcPeriodRelativeTimeFromMpdRelativeTime:function(e,t){return t-e.adaptation.period.start},calcMediaTimeFromPresentationTime:function(e,t){return e-t.adaptation.period.start+t.presentationTimeOffset},calcWallTimeForSegment:function(e,t){var n,r,i;return t&&(n=e.representation.adaptation.period.mpd.suggestedPresentationDelay,r=e.presentationStartTime+n,i=new Date(e.availabilityStartTime.getTime()+1e3*r)),i},calcTimeShiftBufferWindow:function(e,t){if(!t)return function(e){var t={start:NaN,end:NaN},n=0,r=NaN;return e.forEach((function(e){var t=e.getStreamInfo();n+=t.duration,(isNaN(r)||t.start<r)&&(r=t.start)})),t.start=r,t.end=r+n,t}(e);if(f.get().streaming.timeShiftBuffer.calcFromSegmentTimeline){var n=b(e);return x(n.now,n.range),n.range}return function(e){var t={start:NaN,end:NaN};if(!e||0===e.length)return t;var n=e[0].getAdapter().getRegularPeriods()[0],r=v(new Date,n),i=n.mpd.timeShiftBufferDepth,o=isNaN(i)?0:r-i;if(t.start=E(e,o),t.end=!isNaN(t.start)&&r<t.start?r:E(e,r,!0),!isNaN(i)&&t.end<r-i&&(t.end=NaN),f.get().streaming.timeShiftBuffer.fallbackToSegmentTimeline){var s=b(e);if(s.range.end<t.start)return h.trigger(u.default.CONFORMANCE_VIOLATION,{level:d.default.LEVELS.WARNING,event:d.default.EVENTS.INVALID_DVR_WINDOW}),x(s.now,s.range),s.range}return t}(e)},reset:S},t=(0,a.default)(p).getInstance(),S(),e}p.__dashjs_factory_name="TimelineConverter";const h=o.default.getSingletonFactory(p)},"./src/dash/utils/TimelineSegmentsGetter.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/constants/Constants.js"),o=n("./src/dash/utils/SegmentsUtils.js");function s(e,t){var n=(e=e||{}).timelineConverter,r=e.dashMetrics;function s(){if(!n)throw new Error(i.default.MISSING_CONFIG_ERROR)}function a(e,t){var n,r,i,o,s,a,c,u=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate||e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,d=u.SegmentTimeline,p=u.SegmentURL_asArray,h=0,f=-1;c=e.timescale;var g=!1;for(i=0,o=(n=d.S_asArray).length;i<o&&!g;i++)for(a=0,(r=n[i]).hasOwnProperty("r")&&(a=r.r),r.hasOwnProperty("t")&&(h=r.t),a<0&&(a=l(e,n[i+1],r,c,h/c)),s=0;s<=a&&!g;s++)(g=t(h,u,p,r,c,++f,i))&&(e.segmentDuration=r.d/c),h+=r.d}function l(e,t,i,o,s){var a;if(t&&t.hasOwnProperty("t"))a=t.t/o;else try{var l=0;if(isNaN(e.adaptation.period.start)||isNaN(e.adaptation.period.duration)||!isFinite(e.adaptation.period.duration)){var c=r.getCurrentDVRInfo();l=isNaN(c.end)?0:c.end}else l=e.adaptation.period.start+e.adaptation.period.duration;a=n.calcMediaTimeFromPresentationTime(l,e),e.segmentDuration=i.d/o}catch(e){a=0}return Math.max(Math.ceil((a-s)/(i.d/o))-1,0)}return{getSegmentByIndex:function(e,r,i){if(s(),!e)return null;var l=null,c=!1;return a(e,(function(r,s,a,u,d,p,h){if(c||i<0){var f=s.media,g=u.mediaRange;return a&&(f=a[h].media||"",g=a[h].mediaRange),l=(0,o.getTimeBasedSegment)(n,t,e,r,u.d,d,f,g,p,u.tManifest),!0}return r>=i*d-.5*u.d&&(c=!0),!1})),l},getSegmentByTime:function(e,r){if(s(),!e)return null;void 0===r&&(r=null);var i=null,l=n.calcMediaTimeFromPresentationTime(r,e);return a(e,(function(r,s,a,c,u,d,p){var h=parseFloat((l*u).toPrecision(15));if(h<r+c.d&&h>=r){var f=s.media,g=c.mediaRange;return a&&(f=a[p].media||"",g=a[p].mediaRange),i=(0,o.getTimeBasedSegment)(n,t,e,r,c.d,u,f,g,d,c.tManifest),!0}return!1})),i},getMediaFinishedInformation:function(e){if(!e)return 0;var t,n,r,i,o,s,a,c=(e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate||e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList).SegmentTimeline,u=0,d=0,p=0;for(a=e.timescale,i=(t=c.S_asArray).length,r=0;r<i;r++)for(s=0,(n=t[r]).hasOwnProperty("r")&&(s=n.r),n.hasOwnProperty("t")&&(d=(u=n.t)/a),s<0&&(s=l(e,t[r+1],n,a,d)),o=0;o<=s;o++)p++,d=(u+=n.d)/a;return{numberOfSegments:p,mediaTimeOfLastSignaledSegment:d}}}}s.__dashjs_factory_name="TimelineSegmentsGetter";const a=r.default.getClassFactory(s)},"./src/dash/vo/AdaptationSet.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.period=null,this.index=-1,this.type=null}},"./src/dash/vo/BaseURL.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});var r=function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t||"",this.serviceLocation=n||t||"",this.dvb_priority=r||1,this.dvb_weight=i||1,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0};r.DEFAULT_DVB_PRIORITY=1,r.DEFAULT_DVB_WEIGHT=1;const i=r},"./src/dash/vo/ContentSteering.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.defaultServiceLocation=null,this.queryBeforeStart=!1,this.proxyServerUrl=null,this.serverUrl=null}},"./src/dash/vo/ContentSteeringRequest.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});var r=n("./src/streaming/vo/metrics/HTTPRequest.js");const i=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t||null,this.type=r.HTTPRequest.CONTENT_STEERING_TYPE,this.responseType="json"}},"./src/dash/vo/ContentSteeringResponse.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.version=null,this.ttl=300,this.reloadUri=null,this.serviceLocationPriority=[]}},"./src/dash/vo/Event.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN}},"./src/dash/vo/EventStream.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri="",this.presentationTimeOffset=0}},"./src/dash/vo/ManifestInfo.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dvrWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null}},"./src/dash/vo/MediaInfo.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.representationCount=0,this.labels=null,this.lang=null,this.viewpoint=null,this.accessibility=null,this.audioChannelConfiguration=null,this.roles=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.KID=null,this.bitrateList=null,this.isFragmented=null,this.isEmbedded=null,this.selectionPriority=1,this.supplementalProperties={}}},"./src/dash/vo/Mpd.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.publishTime=null,this.minimumUpdatePeriod=NaN,this.mediaPresentationDuration=NaN}},"./src/dash/vo/PatchOperation.js":(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,{default:()=>i});const i=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.action=t,this.xpath=n,this.value=r,this.position=null}var t,n;return t=e,(n=[{key:"getMpdTarget",value:function(e){var t="remove"===this.action||"replace"===this.action||"before"===this.position||"after"===this.position;return this.xpath.getMpdTarget(e,t)}}])&&r(t.prototype,n),e}()},"./src/dash/vo/Period.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});var r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null,this.nextPeriodId=null};r.DEFAULT_ID="defaultId";const i=r},"./src/dash/vo/ProducerReferenceTime.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.inband=!1,this.type="encoder",this.applicationScheme=null,this.wallClockTime=null,this.presentationTime=NaN,this.UTCTiming=null}},"./src/dash/vo/Representation.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/dash/constants/DashConstants.js");function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.codecs=null,this.mimeType=null,this.codecPrivateData=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.mediaFinishedInformation={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN},this.bandwidth=NaN,this.width=NaN,this.height=NaN,this.scanType=null,this.maxPlayoutRate=NaN,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0}var t,n;return t=e,(n=[{key:"hasInitialization",value:function(){return null!==this.initialization||null!==this.range}},{key:"hasSegments",value:function(){return this.segmentInfoType!==r.default.BASE_URL&&this.segmentInfoType!==r.default.SEGMENT_BASE&&!this.indexRange}}])&&i(t.prototype,n),e}()},"./src/dash/vo/RepresentationInfo.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.quality=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null}},"./src/dash/vo/Segment.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.wallStartTime=NaN,this.representation=null}},"./src/dash/vo/SimpleXPath.js":(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,{default:()=>i});const i=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.valid="/"==t[0],this.path=t.split("/").filter((function(e){return 0!==e.length})).map((function(e){var t={name:e},r=e.indexOf("[");if(-1!=r){t.name=e.substring(0,r);var i=e.substring(r+1,e.length-1);n.valid=n.valid&&-1==i.indexOf("[");var o=i.indexOf("=");-1!=o?(t.attribute={name:i.substring(1,o),value:i.substring(o+1)},-1!=["'",'"'].indexOf(t.attribute.value[0])&&(t.attribute.value=t.attribute.value.substring(1,t.attribute.value.length-1))):t.position=parseInt(i,10)-1}return t}))}var t,n;return t=e,(n=[{key:"isValid",value:function(){return this.valid}},{key:"findsElement",value:function(){return!this.findsAttribute()}},{key:"findsAttribute",value:function(){return this.path[this.path.length-1].name.startsWith("@")}},{key:"getMpdTarget",value:function(e,t){for(var n=null,r=e,i=1,o="MPD";i<this.path.length&&null!==r;){n=r;var s=this.path[i];if(o=s.name,i!==this.path.length-1||!o.startsWith("@")){var a=n[o+"_asArray"]||[];0===a.length&&n[o]&&a.push(n[o]),s.position?r=a[s.position]||null:s.attribute?function(){var e=s.attribute;r=a.filter((function(t){return t[e.name]==e.value}))[0]||null}():r=a[0]||null}i++}return null===r?null:o.startsWith("@")?{name:o.substring(1),leaf:r,target:r}:{name:o,leaf:r,target:t?n:r}}}])&&r(t.prototype,n),e}()},"./src/dash/vo/StreamInfo.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0}},"./src/dash/vo/UTCTiming.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri="",this.value=""}},"./src/streaming/FragmentLoader.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/streaming/net/URLLoader.js"),o=n("./src/streaming/vo/HeadRequest.js"),s=n("./src/streaming/vo/DashJSError.js"),a=n("./src/core/FactoryMaker.js");function l(e){e=e||{};var t,n,a=this.context,l=e.eventBus,c=e.events,u=e.urlUtils,d=e.errors,p=e.streamId;return t={checkForExistence:function(e){var t=function(t){l.trigger(c.CHECK_FOR_EXISTENCE_COMPLETED,{request:e,exists:t})};if(e){var r=new o.default(e.url);n.load({request:r,success:function(){t(!0)},error:function(){t(!1)}})}else t(!1)},load:function(e){var r=function(n,r){l.trigger(c.LOADING_COMPLETED,{request:e,response:n||null,error:r||null,sender:t})};e?n.load({request:e,progress:function(n){l.trigger(c.LOADING_PROGRESS,{request:e,stream:n.stream,streamId:p}),n.data&&l.trigger(c.LOADING_DATA_PROGRESS,{request:e,response:n.data||null,error:null,sender:t})},success:function(e){r(e)},error:function(e,t,n){r(void 0,new s.default(d.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE,n,t))},abort:function(e){e&&l.trigger(c.LOADING_ABANDONED,{mediaType:e.mediaType,request:e,sender:t})}}):r(void 0,new s.default(d.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE,d.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE))},abort:function(){n&&n.abort()},reset:function(){n&&(n.abort(),n=null)}},n=(0,i.default)(a).create({errHandler:e.errHandler,errors:d,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,urlUtils:u,constants:r.default,boxParser:e.boxParser,dashConstants:e.dashConstants,requestTimeout:e.settings.get().streaming.fragmentRequestTimeout}),t}l.__dashjs_factory_name="FragmentLoader";const c=a.default.getClassFactory(l)},"./src/streaming/ManifestLoader.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>v});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/dash/constants/DashConstants.js"),o=n("./src/streaming/controllers/XlinkController.js"),s=n("./src/streaming/net/URLLoader.js"),a=n("./src/streaming/utils/URLUtils.js"),l=n("./src/streaming/vo/TextRequest.js"),c=n("./src/streaming/vo/DashJSError.js"),u=n("./src/streaming/vo/metrics/HTTPRequest.js"),d=n("./src/core/EventBus.js"),p=n("./src/core/events/Events.js"),h=n("./src/core/errors/Errors.js"),f=n("./src/core/FactoryMaker.js"),g=n("./src/dash/parser/DashParser.js");function m(e){e=e||{};var t,n,f,m,v,y=this.context,b=e.debug,x=e.settings,E=(0,d.default)(y).getInstance(),_=(0,a.default)(y).getInstance(),w=e.mssHandler,S=e.errHandler;function T(e){E.trigger(p.default.INTERNAL_MANIFEST_LOADED,{manifest:e.manifest})}return t={load:function(e){var t=new l.default(e,u.HTTPRequest.MPD_TYPE);f.load({request:t,success:function(t,i,o){var s,a,l;if(m)if(o&&o!==e?(a=_.parseBaseUrl(o),s=o):(_.isRelative(e)&&(e=_.resolve(e,window.location.href)),a=_.parseBaseUrl(e)),"No Content"!=i)if(null===v&&(v=function(e){var t=null;return e.indexOf("SmoothStreamingMedia")>-1?(w&&(t=w.createMssParser(),w.registerEvents()),t):e.indexOf("MPD")>-1||e.indexOf("Patch")>-1?(0,g.default)(y).create({debug:b}):t}(t)),null!==v){m.setMatchers(v.getMatchers()),m.setIron(v.getIron());try{l=v.parse(t)}catch(t){return void E.trigger(p.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new c.default(h.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,h.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(e))})}if(l){if(l.url=s||e,l.originalUrl||(l.originalUrl=l.url),l.hasOwnProperty(r.default.LOCATION)&&(a=_.parseBaseUrl(l.Location_asArray[0]),n.debug("BaseURI set by Location to: "+a)),x&&x.get().streaming.enableManifestDurationMismatchFix&&l.mediaPresentationDuration&&l.Period_asArray.length>1){var u=l.Period_asArray.reduce((function(e,t){return e+t.duration}),0);!isNaN(u)&&l.mediaPresentationDuration>u&&(n.warn("Media presentation duration greater than duration of all periods. Setting duration to total period duration"),l.mediaPresentationDuration=u)}l.baseUri=a,l.loadedTime=new Date,m.resolveManifestOnLoad(l),E.trigger(p.default.ORIGINAL_MANIFEST_LOADED,{originalManifest:t})}else E.trigger(p.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new c.default(h.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,h.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(e))})}else E.trigger(p.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new c.default(h.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,h.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(e))});else E.trigger(p.default.INTERNAL_MANIFEST_LOADED,{manifest:null})},error:function(t,n,r){E.trigger(p.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new c.default(h.default.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE,h.default.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE+"".concat(e,", ").concat(r))})}})},reset:function(){E.off(p.default.XLINK_READY,T,t),w&&w.reset(),m&&(m.reset(),m=null),f&&(f.abort(),f=null)}},n=b.getLogger(t),E.on(p.default.XLINK_READY,T,t),f=(0,s.default)(y).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,urlUtils:_,constants:r.default,dashConstants:i.default,errors:h.default,requestTimeout:e.settings.get().streaming.manifestRequestTimeout}),m=(0,o.default)(y).create({errHandler:S,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,settings:e.settings}),v=null,t}m.__dashjs_factory_name="ManifestLoader";const v=f.default.getClassFactory(m)},"./src/streaming/ManifestUpdater.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});var r=n("./src/core/EventBus.js"),i=n("./src/core/events/Events.js"),o=n("./src/streaming/MediaPlayerEvents.js"),s=n("./src/core/FactoryMaker.js"),a=n("./src/core/Debug.js"),l=n("./src/core/errors/Errors.js"),c=n("./src/dash/constants/DashConstants.js"),u=n("./src/streaming/utils/URLUtils.js");function d(){var e,t,n,s,d,p,h,f,g,m,v,y,b=this.context,x=(0,r.default)(b).getInstance(),E=(0,u.default)(b).getInstance();function _(){n=NaN,h=!1,d=!0,p=!1,w()}function w(){null!==s&&(clearTimeout(s),s=null)}function S(e){w(),p||(isNaN(e)&&!isNaN(n)&&(e=1e3*n),isNaN(e)||(t.debug("Refresh manifest in "+e+" milliseconds."),s=setTimeout(C,e)))}function T(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];h=!0;var t=g.getValue(),n=t.url,r=m.getPatchLocation(t),i=m.getLocation(t);r&&!e?n=r:i&&(n=i),E.isRelative(n)&&(n=E.resolve(n,t.url)),f.load(n)}function k(e){if(e){if(m.getIsPatch(e)){var r=e;e=g.getValue();var o=m.isPatchValid(e,r),s=o;if(o){var a=m.getPublishTime(e);s=m.applyPatchToManifest(e,r);var l=m.getPublishTime(e);s=a.getTime()!=l.getTime()}if(!s)return t.debug("Patch provided is invalid, performing full manifest refresh"),void T(!0);e.loadedTime=new Date}}else(e=g.getValue()).loadedTime=new Date;if(g.getValue()&&g.getValue().type===c.default.DYNAMIC&&e.type===c.default.STATIC)return x.trigger(i.default.DYNAMIC_TO_STATIC),h=!1,void(p=!0);g.setValue(e);var u=new Date,f=(u.getTime()-e.loadedTime.getTime())/1e3;1e3*(n=m.getManifestUpdatePeriod(e,f))>2147483647&&(n=2147483.647),x.trigger(i.default.MANIFEST_UPDATED,{manifest:e}),t.info("Manifest has been refreshed at "+u+"["+u.getTime()/1e3+"] "),d||S()}function C(){d||(h?S(y.get().streaming.manifestUpdateRetryInterval):T())}function A(e){e.error?e.error.code===l.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE&&v.error(e.error):k(e.manifest)}function j(){d=!1,S()}function I(){(d=!y.get().streaming.scheduling.scheduleWhilePaused)&&w()}function O(){h=!1}return e={initialize:function(){_(),x.on(i.default.STREAMS_COMPOSED,O,this),x.on(o.default.PLAYBACK_STARTED,j,this),x.on(o.default.PLAYBACK_PAUSED,I,this),x.on(i.default.INTERNAL_MANIFEST_LOADED,A,this)},setManifest:function(e){k(e)},refreshManifest:T,getIsUpdating:function(){return h},setConfig:function(e){e&&(e.manifestModel&&(g=e.manifestModel),e.adapter&&(m=e.adapter),e.manifestLoader&&(f=e.manifestLoader),e.errHandler&&(v=e.errHandler),e.settings&&(y=e.settings))},reset:function(){x.off(o.default.PLAYBACK_STARTED,j,this),x.off(o.default.PLAYBACK_PAUSED,I,this),x.off(i.default.STREAMS_COMPOSED,O,this),x.off(i.default.INTERNAL_MANIFEST_LOADED,A,this),_()}},t=(0,a.default)(b).getInstance().getLogger(e),e}d.__dashjs_factory_name="ManifestUpdater";const p=s.default.getClassFactory(d)},"./src/streaming/MediaPlayer.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ee});var r=n("./externals/cea608-parser.js"),i=n.n(r),o=n("./src/streaming/constants/Constants.js"),s=n("./src/dash/constants/DashConstants.js"),a=n("./src/streaming/constants/MetricsConstants.js"),l=n("./src/streaming/controllers/PlaybackController.js"),c=n("./src/streaming/controllers/StreamController.js"),u=n("./src/streaming/controllers/GapController.js"),d=n("./src/streaming/controllers/CatchupController.js"),p=n("./src/dash/controllers/ServiceDescriptionController.js"),h=n("./src/dash/controllers/ContentSteeringController.js"),f=n("./src/streaming/controllers/MediaController.js"),g=n("./src/streaming/controllers/BaseURLController.js"),m=n("./src/streaming/ManifestLoader.js"),v=n("./src/streaming/utils/ErrorHandler.js"),y=n("./src/streaming/utils/Capabilities.js"),b=n("./src/streaming/utils/CapabilitiesFilter.js"),x=n("./src/streaming/utils/RequestModifier.js"),E=n("./src/streaming/models/URIFragmentModel.js"),_=n("./src/streaming/models/ManifestModel.js"),w=n("./src/streaming/models/MediaPlayerModel.js"),S=n("./src/streaming/controllers/AbrController.js"),T=n("./src/streaming/net/SchemeLoaderFactory.js"),k=n("./src/streaming/models/VideoModel.js"),C=n("./src/streaming/models/CmcdModel.js"),A=n("./src/streaming/models/CmsdModel.js"),j=n("./src/streaming/utils/DOMStorage.js"),I=n("./src/core/Debug.js"),O=n("./src/core/errors/Errors.js"),N=n("./src/core/EventBus.js"),R=n("./src/core/events/Events.js"),P=n("./src/streaming/MediaPlayerEvents.js"),D=n("./src/core/FactoryMaker.js"),M=n("./src/core/Settings.js"),L=n("./src/core/Version.js"),B=n("./src/dash/controllers/SegmentBaseController.js"),F=n("./src/dash/DashAdapter.js"),U=n("./src/dash/DashMetrics.js"),H=n("./src/dash/utils/TimelineConverter.js"),G=n("./src/streaming/vo/metrics/HTTPRequest.js"),q=n("./externals/base64.js"),V=n("./node_modules/codem-isoboxer/dist/iso_boxer.js"),z=n("./src/streaming/vo/DashJSError.js"),W=n("./src/streaming/utils/SupervisorTools.js"),K=n("./src/streaming/ManifestUpdater.js"),$=n("./src/streaming/utils/URLUtils.js"),Y=n("./src/streaming/utils/BoxParser.js"),X=n("./src/streaming/text/TextController.js"),J=n("./src/streaming/models/CustomParametersModel.js");function Q(){var e,t,n,r,Q,Z,ee,te,ne,re,ie,oe,se,ae,le,ce,ue,de,pe,he,fe,ge,me,ve,ye,be,xe,Ee,_e,we,Se,Te,ke,Ce,Ae,je,Ie,Oe,Ne="You must first call initialize() and set a source before calling this method",Re="You must first call initialize() and set a valid source and view before calling this method",Pe="You must first call attachView() to set the video element before calling this method",De="You must first call attachSource() with a valid source before calling this method",Me="MediaPlayer not initialized!",Le=this.context,Be=(0,N.default)(Le).getInstance(),Fe=(0,M.default)(Le).getInstance(),Ue=(0,I.default)(Le).getInstance({settings:Fe});function He(){tt(null),Ze(null),r=null,se&&(se.reset(),se=null),ae&&(ae.reset(),ae=null),pe&&pe.reset(),Fe.reset(),ce&&(ce.reset(),ce=null)}function Ge(){return!!n&&!!Ae.getElement()}function qe(){return(0,L.getVersionString)()}function Ve(){if(!ee)throw Re;return xe.isPaused()}function ze(){if(!ee)throw Re;return xe.getIsDynamic()}function We(e){var t=ve&&ve.hasVideoTrack()?o.default.VIDEO:o.default.AUDIO,n=Se.getCurrentDVRInfo(t);if(!n)return 0;var r=xe.getOriginalLiveDelay(),i=n.range.start+e;return i>n.range.end-r&&(i=n.range.end-r),i}function Ke(e){if(!ee)throw Re;var t=Qe().currentTime;if(void 0!==e)t=ve.getTimeRelativeToStreamId(t,e);else if(xe.getIsDynamic()){var n=ve&&ve.hasVideoTrack()?o.default.VIDEO:o.default.AUDIO,r=Se.getCurrentDVRInfo(n);t=null===r||0===t?0:Math.max(0,t-r.range.start)}return t}function $e(){if(!ee)throw Re;var e=Qe().duration;if(xe.getIsDynamic()){var t=ve&&ve.hasVideoTrack()?o.default.VIDEO:o.default.AUDIO,n=Se.getCurrentDVRInfo(t);e=n?n.range.end-n.range.start:0}return e}function Ye(e){(0,W.checkParameterType)(e,"boolean"),te=e}function Xe(){pe.restoreDefaultUTCTimingSources()}function Je(){return Se}function Qe(){if(!Ae.getElement())throw Pe;return Ae.getElement()}function Ze(e){if(!Q)throw Me;Ae.setElement(e),e&&(ot(),function(){if(!ae){var e=dashjs.MetricsReporting;if("function"==typeof e){var t=e(Le).create();ae=t.createMetricsReporting({debug:Ue,eventBus:Be,mediaElement:Qe(),adapter:ue,dashMetrics:Se,mediaPlayerModel:de,events:R.default,constants:o.default,metricsConstants:a.default})}}}(),function(){if(!le){var e=dashjs.MssHandler;"function"==typeof e&&(O.default.extend(e.errors),le=e(Le).create({eventBus:Be,mediaPlayerModel:de,dashMetrics:Se,manifestModel:Te,playbackController:xe,streamController:ve,protectionController:se,baseURLController:fe,errHandler:he,events:R.default,constants:o.default,debug:Ue,initSegmentType:G.HTTPRequest.INIT_SEGMENT_TYPE,BASE64:q,ISOBoxer:V,settings:Fe}))}}(),ve&&ve.switchToVideoElement()),ee&&rt(),lt()}function et(e){if(!Z)throw Ne;var t=ve.getActiveStreamInfo();return t?oe.getTracksFor(e,t.id):[]}function tt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;if(!Q)throw Me;"string"==typeof e&&je.initialize(e),null==t&&(t=NaN),isNaN(t)||(t=Math.max(0,t)),n=e,(Z||ee)&&rt(),Ge()&&lt(t)}function nt(){if(!Z)throw Ne;var e=ve.getActiveStreamInfo();return e?ve.getStreamById(e.id):null}function rt(){ee=!1,Z=!1,ue.reset(),ve.reset(),be.reset(),we.reset(),xe.reset(),Ee.reset(),_e.reset(),ne.reset(),oe.reset(),Oe.reset(),se&&(Fe.get().streaming.protection.keepProtectionMediaKeys?se.stop():(se.reset(),se=null,ot())),ye.reset(),ke.reset(),Ce.reset()}function it(){return(0,m.default)(Le).create({debug:Ue,errHandler:he,dashMetrics:Se,mediaPlayerModel:de,requestModifier:(0,x.default)(Le).getInstance(),mssHandler:le,settings:Fe})}function ot(){if(se)return se;var e=dashjs.Protection;if("function"==typeof e){var t=e(Le).create();return R.default.extend(e.events),P.default.extend(e.events,{publicOnly:!0}),O.default.extend(e.errors),ge||(ge=(0,y.default)(Le).getInstance()),se=t.createProtectionSystem({debug:Ue,errHandler:he,videoModel:Ae,customParametersModel:pe,capabilities:ge,eventBus:Be,events:R.default,BASE64:q,constants:o.default,cmcdModel:ke,settings:Fe})}return null}function st(){if(!Q)throw Me;if(ce)return ce;var e=dashjs.OfflineController;if("function"==typeof e){R.default.extend(e.events),P.default.extend(e.events,{publicOnly:!0}),O.default.extend(e.errors);var t=it(),n=(0,K.default)(Le).create();return n.setConfig({manifestModel:Te,adapter:ue,manifestLoader:t,errHandler:he}),ce=e(Le).create({debug:Ue,manifestUpdater:n,baseURLController:fe,manifestLoader:t,manifestModel:Te,mediaPlayerModel:de,abrController:ne,playbackController:xe,adapter:ue,errHandler:he,dashMetrics:Se,timelineConverter:ie,segmentBaseController:Oe,schemeLoaderFactory:re,eventBus:Be,events:R.default,errors:O.default,constants:o.default,settings:Fe,dashConstants:s.default,urlUtils:(0,$.default)(Le).getInstance()})}return null}function at(e){var t=ve&&ve.hasVideoTrack()?o.default.VIDEO:o.default.AUDIO,n=Se.getCurrentDVRInfo(t);return n?e+(n.manifestInfo.availableFrom.getTime()/1e3+n.range.start):0}function lt(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN;ce&&ce.resetRecords(),!Z&&n&&(Z=!0,t.info("Streaming Initialized"),e=it(),ve||(ve=(0,c.default)(Le).getInstance()),ye||(ye=(0,X.default)(Le).create({errHandler:he,manifestModel:Te,adapter:ue,mediaController:oe,videoModel:Ae,settings:Fe})),me.setConfig({capabilities:ge,customParametersModel:pe,adapter:ue,settings:Fe,manifestModel:Te,errHandler:he}),ve.setConfig({capabilities:ge,capabilitiesFilter:me,manifestLoader:e,manifestModel:Te,mediaPlayerModel:de,customParametersModel:pe,protectionController:se,textController:ye,adapter:ue,dashMetrics:Se,errHandler:he,timelineConverter:ie,videoModel:Ae,playbackController:xe,serviceDescriptionController:Ee,contentSteeringController:_e,abrController:ne,mediaController:oe,settings:Fe,baseURLController:fe,uriFragmentModel:je,segmentBaseController:Oe}),be.setConfig({settings:Fe,playbackController:xe,streamController:ve,videoModel:Ae,timelineConverter:ie,adapter:ue}),xe.setConfig({streamController:ve,serviceDescriptionController:Ee,dashMetrics:Se,adapter:ue,videoModel:Ae,timelineConverter:ie,settings:Fe}),we.setConfig({streamController:ve,playbackController:xe,mediaPlayerModel:de,videoModel:Ae,settings:Fe}),ne.setConfig({streamController:ve,domStorage:Ie,mediaPlayerModel:de,customParametersModel:pe,cmsdModel:Ce,dashMetrics:Se,adapter:ue,videoModel:Ae,settings:Fe}),ke.setConfig({abrController:ne,dashMetrics:Se,playbackController:xe}),Ce.setConfig({}),ne.initialize(),ve.initialize(te,r),ye.initialize(),be.initialize(),we.initialize(),ke.initialize(),Ce.initialize(),_e.initialize(),Oe.initialize(),"string"==typeof n?ve.load(n,i):ve.loadWithManifest(n,i)),!ee&&Ge()&&(ee=!0,t.info("Playback Initialized"))}return e={initialize:function(e,n,r){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:NaN;ge||(ge=(0,y.default)(Le).getInstance()).setConfig({settings:Fe}),he||(he=(0,v.default)(Le).getInstance()),ge.supportsMediaSource()?(Q||(Q=!0,ie=(0,H.default)(Le).getInstance(),ne||(ne=(0,S.default)(Le).getInstance()).setConfig({settings:Fe}),re||(re=(0,T.default)(Le).getInstance()),xe||(xe=(0,l.default)(Le).getInstance()),oe||(oe=(0,f.default)(Le).getInstance()),ve||(ve=(0,c.default)(Le).getInstance()),be||(be=(0,u.default)(Le).getInstance()),we||(we=(0,d.default)(Le).getInstance()),Ee||(Ee=(0,p.default)(Le).getInstance()),_e||(_e=(0,h.default)(Le).getInstance()),me||(me=(0,b.default)(Le).getInstance()),ue=(0,F.default)(Le).getInstance(),Te=(0,_.default)(Le).getInstance(),ke=(0,C.default)(Le).getInstance(),Ce=(0,A.default)(Le).getInstance(),Se=(0,U.default)(Le).getInstance({settings:Fe}),Ie=(0,j.default)(Le).getInstance({settings:Fe}),ue.setConfig({constants:o.default,cea608parser:i(),errHandler:he,BASE64:q}),fe||(fe=(0,g.default)(Le).create()),fe.setConfig({adapter:ue}),Ee.setConfig({adapter:ue}),Oe||(Oe=(0,B.default)(Le).getInstance({dashMetrics:Se,mediaPlayerModel:de,errHandler:he,baseURLController:fe,events:R.default,eventBus:Be,debug:Ue,boxParser:(0,Y.default)(Le).getInstance(),requestModifier:(0,x.default)(Le).getInstance(),errors:O.default})),oe.setConfig({domStorage:Ie,settings:Fe,customParametersModel:pe}),de.setConfig({playbackController:xe,serviceDescriptionController:Ee}),_e.setConfig({adapter:ue,errHandler:he,dashMetrics:Se,mediaPlayerModel:de,manifestModel:Te,abrController:ne,eventBus:Be,requestModifier:(0,x.default)(Le).getInstance()}),Xe(),Ye(void 0===r||r),st()),e&&Ze(e),n&&tt(n,s),t.info("[dash.js "+qe()+"] MediaPlayer has been initialized")):he.error(new z.default(O.default.CAPABILITY_MEDIASOURCE_ERROR_CODE,O.default.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE))},setConfig:function(e){e&&(e.capabilities&&(ge=e.capabilities),e.capabilitiesFilter&&(me=e.capabilitiesFilter),e.streamController&&(ve=e.streamController),e.textController&&(ye=e.textController),e.gapController&&(be=e.gapController),e.playbackController&&(xe=e.playbackController),e.serviceDescriptionController&&(Ee=e.serviceDescriptionController),e.contentSteeringController&&(_e=e.contentSteeringController),e.catchupController&&(we=e.catchupController),e.mediaPlayerModel&&(de=e.mediaPlayerModel),e.customParametersModel&&(pe=e.customParametersModel),e.abrController&&(ne=e.abrController),e.schemeLoaderFactory&&(re=e.schemeLoaderFactory),e.mediaController&&(oe=e.mediaController),e.settings&&(Fe=e.settings))},on:function(e,t,n,r){Be.on(e,t,n,r)},off:function(e,t,n){Be.off(e,t,n)},extend:function(e,t,n){D.default.extend(e,t,n,Le)},attachView:Ze,attachSource:tt,isReady:Ge,preload:function(){if(Ae.getElement()||Z)return!1;if(!n)throw De;lt()},play:function(){if(!ee)throw Re;(!te||Ve()&&ee)&&xe.play(!0)},isPaused:Ve,pause:function(){if(!ee)throw Re;xe.pause()},isSeeking:function(){if(!ee)throw Re;return xe.isSeeking()},isDynamic:ze,getLowLatencyModeEnabled:function(){if(!ee)throw Re;return xe.getLowLatencyModeEnabled()},seek:function(e){if(!ee)throw Re;if((0,W.checkParameterType)(e,"number"),isNaN(e))throw o.default.BAD_ARGUMENT_ERROR;e<0&&(e=0);var t=xe.getIsDynamic()?We(e):e,n=Qe();!xe.getIsDynamic()&&n.duration&&(t=Math.min(n.duration,t)),xe.seek(t,!1,!1,!0)},seekToOriginalLive:function(){ee&&ze()&&xe.seekToOriginalLive()},setPlaybackRate:function(e){Qe().playbackRate=e},getPlaybackRate:function(){return Qe().playbackRate},setMute:function(e){(0,W.checkParameterType)(e,"boolean"),Qe().muted=e},isMuted:function(){return Qe().muted},setVolume:function(e){if("number"!=typeof e||isNaN(e)||e<0||e>1)throw o.default.BAD_ARGUMENT_ERROR;Qe().volume=e},getVolume:function(){return Qe().volume},time:Ke,duration:$e,timeAsUTC:function(){if(!ee)throw Re;return Ke()<0?NaN:at(Ke())},durationAsUTC:function(){if(!ee)throw Re;return at($e())},getActiveStream:nt,getDVRWindowSize:function(){var e=ve&&ve.hasVideoTrack()?o.default.VIDEO:o.default.AUDIO,t=Se.getCurrentDVRInfo(e);return t?t.manifestInfo.dvrWindowSize:0},getDVRSeekOffset:We,getTargetLiveDelay:function(){if(!ee)throw Re;return xe.getOriginalLiveDelay()},convertToTimeCode:function(e){e=Math.max(e,0);var t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%3600%60);return(0===t?"":t<10?"0"+t.toString()+":":t.toString()+":")+(n<10?"0"+n.toString():n.toString())+":"+(r<10?"0"+r.toString():r.toString())},formatUTC:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=new Date(1e3*e),o=i.toLocaleDateString(t),s=i.toLocaleTimeString(t,{hour12:n});return r?s+" "+o:s},getVersion:qe,getDebug:function(){return Ue},getBufferLength:function(e){var n=[o.default.VIDEO,o.default.AUDIO,o.default.TEXT];if(e)return-1!==n.indexOf(e)?Je().getCurrentBufferLevel(e)||NaN:(t.warn("getBufferLength requested for invalid type"),NaN);var r=n.map((function(e){return et(e).length>0?Je().getCurrentBufferLevel(e):Number.MAX_VALUE})).reduce((function(e,t){return Math.min(e,t)}));return r===Number.MAX_VALUE?NaN:r},getTTMLRenderingDiv:function(){return Ae?Ae.getTTMLRenderingDiv():null},getVideoElement:Qe,getSource:function(){if(!n)throw De;return n},updateSource:function(e){n=e,ve.load(n)},getCurrentLiveLatency:function(){if(!Q)throw Me;return ee?xe.getCurrentLiveLatency():NaN},getTopBitrateInfoFor:function(e){if(!Z)throw Ne;return ne.getTopBitrateInfoFor(e)},setAutoPlay:Ye,getAutoPlay:function(){return te},getDashMetrics:Je,getQualityFor:function(e){if(!Z)throw Ne;if(e===o.default.IMAGE){var t=nt();if(!t)return-1;var n=t.getThumbnailController();return n?n.getCurrentTrackIndex():-1}return ne.getQualityFor(e)},setQualityFor:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!Z)throw Ne;if(e===o.default.IMAGE){var r=nt();if(!r)return;var i=r.getThumbnailController();i&&i.setTrackByIndex(t)}ne.setPlaybackQuality(e,ve.getActiveStreamInfo(),t,{forceReplace:n})},updatePortalSize:function(){ne.setElementSize(),ne.setWindowResizeEventCalled(!0)},enableText:function(e){var t=ve.getActiveStreamInfo();return!(!t||!ye)&&ye.enableText(t.id,e)},enableForcedTextStreaming:function(e){return!(!ve.getActiveStreamInfo()||!ye)&&ye.enableForcedTextStreaming(e)},isTextEnabled:function(){var e=ve.getActiveStreamInfo();return!(!e||!ye)&&ye.isTextEnabled(e)},setTextTrack:function(e){if(!ee)throw Re;var t=ve.getActiveStreamInfo();t&&ye&&ye.setTextTrack(t.id,e)},getBitrateInfoListFor:function(e){if(!Z)throw Ne;var t=nt();return t?t.getBitrateListFor(e):[]},getStreamsFromManifest:function(e){if(!Z)throw Ne;return ue.getStreamsInfo(e)},getTracksFor:et,getTracksForTypeFromManifest:function(e,t,n){if(!Z)throw Ne;return(n=n||ue.getStreamsInfo(t,1)[0])?ue.getAllMediaInfoForType(n,e,t):[]},getCurrentTrackFor:function(e){if(!Z)throw Ne;var t=ve.getActiveStreamInfo();return oe.getCurrentTrackFor(e,t.id)},setInitialMediaSettingsFor:function(e,t){if(!Q)throw Me;oe.setInitialSettings(e,t)},getInitialMediaSettingsFor:function(e){if(!Q)throw Me;return oe.getInitialSettings(e)},setCurrentTrack:function(e){if(!Z)throw Ne;oe.setTrack(e)},addABRCustomRule:function(e,t,n){pe.addAbrCustomRule(e,t,n)},removeABRCustomRule:function(e){pe.removeAbrCustomRule(e)},removeAllABRCustomRule:function(){pe.removeAllAbrCustomRule()},getABRCustomRules:function(){return pe.getAbrCustomRules()},getAverageThroughput:function(e){var t=ne.getThroughputHistory(),n=xe.getIsDynamic();return t?t.getAverageThroughput(e,n):0},retrieveManifest:function(e,t){var n=it(),r=this;Be.on(R.default.INTERNAL_MANIFEST_LOADED,(function e(i){i.error?t(null,i.error):t(i.manifest),Be.off(R.default.INTERNAL_MANIFEST_LOADED,e,r),n.reset()}),r),je.initialize(e),n.load(e)},addUTCTimingSource:function(e,t){pe.addUTCTimingSource(e,t)},removeUTCTimingSource:function(e,t){pe.removeUTCTimingSource(e,t)},clearDefaultUTCTimingSources:function(){pe.clearDefaultUTCTimingSources()},restoreDefaultUTCTimingSources:Xe,setXHRWithCredentialsForType:function(e,t){pe.setXHRWithCredentialsForType(e,t)},getXHRWithCredentialsForType:function(e){return pe.getXHRWithCredentialsForType(e)},getProtectionController:function(){return ot()},attachProtectionController:function(e){se=e},setProtectionData:function(e){r=e,ve&&ve.setProtectionData(r)},registerLicenseRequestFilter:function(e){pe.registerLicenseRequestFilter(e)},registerLicenseResponseFilter:function(e){pe.registerLicenseResponseFilter(e)},unregisterLicenseRequestFilter:function(e){pe.unregisterLicenseRequestFilter(e)},unregisterLicenseResponseFilter:function(e){pe.unregisterLicenseResponseFilter(e)},registerCustomCapabilitiesFilter:function(e){pe.registerCustomCapabilitiesFilter(e)},unregisterCustomCapabilitiesFilter:function(e){pe.unregisterCustomCapabilitiesFilter(e)},setCustomInitialTrackSelectionFunction:function(e){pe.setCustomInitialTrackSelectionFunction(e)},resetCustomInitialTrackSelectionFunction:function(){pe.resetCustomInitialTrackSelectionFunction(null)},attachTTMLRenderingDiv:function(e){if(!Ae.getElement())throw Pe;Ae.setTTMLRenderingDiv(e)},attachVttRenderingDiv:function(e){if(!Ae.getElement())throw Pe;Ae.setVttRenderingDiv(e)},getCurrentTextTrackIndex:function(){var e=ve.getActiveStreamInfo();if(e&&ye)return ye.getCurrentTrackIdx(e.id)},provideThumbnail:function(e,t){if("function"==typeof t)if(e<0)t(null);else{var n=xe.getIsDynamic()?We(e):e,r=ve.getStreamForTime(n);if(null!==r){var i=r.getThumbnailController();if(i)return i.provide(n,t);t(null)}else t(null)}},getDashAdapter:function(){return ue},getOfflineController:function(){return st()},triggerSteeringRequest:function(){if(_e)return _e.loadSteeringData()},getCurrentSteeringResponseData:function(){if(_e)return _e.getCurrentSteeringResponseData()},getSettings:function(){return Fe.get()},updateSettings:function(e){Fe.update(e)},resetSettings:function(){Fe.reset()},reset:He,destroy:function(){He(),D.default.deleteSingletonInstances(Le)}},t=Ue.getLogger(e),Q=!1,ee=!1,Z=!1,te=!0,se=null,ce=null,r=null,ue=null,Oe=null,R.default.extend(P.default),de=(0,w.default)(Le).getInstance(),pe=(0,J.default)(Le).getInstance(),Ae=(0,k.default)(Le).getInstance(),je=(0,E.default)(Le).getInstance(),e}Q.__dashjs_factory_name="MediaPlayer";var Z=D.default.getClassFactory(Q);Z.events=P.default,Z.errors=O.default,D.default.updateClassFactory(Q.__dashjs_factory_name,Z);const ee=Z},"./src/streaming/MediaPlayerEvents.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/core/events/EventsBase.js");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const a=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(n,r.default);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var o=s(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,n)}}(n);function n(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(e=t.call(this)).AST_IN_FUTURE="astInFuture",e.BUFFER_EMPTY="bufferStalled",e.BUFFER_LOADED="bufferLoaded",e.BUFFER_LEVEL_STATE_CHANGED="bufferStateChanged",e.BUFFER_LEVEL_UPDATED="bufferLevelUpdated",e.DYNAMIC_TO_STATIC="dynamicToStatic",e.ERROR="error",e.FRAGMENT_LOADING_COMPLETED="fragmentLoadingCompleted",e.FRAGMENT_LOADING_PROGRESS="fragmentLoadingProgress",e.FRAGMENT_LOADING_STARTED="fragmentLoadingStarted",e.FRAGMENT_LOADING_ABANDONED="fragmentLoadingAbandoned",e.LOG="log",e.MANIFEST_LOADED="manifestLoaded",e.METRICS_CHANGED="metricsChanged",e.METRIC_CHANGED="metricChanged",e.METRIC_ADDED="metricAdded",e.METRIC_UPDATED="metricUpdated",e.PERIOD_SWITCH_STARTED="periodSwitchStarted",e.PERIOD_SWITCH_COMPLETED="periodSwitchCompleted",e.QUALITY_CHANGE_REQUESTED="qualityChangeRequested",e.QUALITY_CHANGE_RENDERED="qualityChangeRendered",e.TRACK_CHANGE_RENDERED="trackChangeRendered",e.STREAM_INITIALIZING="streamInitializing",e.STREAM_UPDATED="streamUpdated",e.STREAM_ACTIVATED="streamActivated",e.STREAM_DEACTIVATED="streamDeactivated",e.STREAM_INITIALIZED="streamInitialized",e.STREAM_TEARDOWN_COMPLETE="streamTeardownComplete",e.TEXT_TRACKS_ADDED="allTextTracksAdded",e.TEXT_TRACK_ADDED="textTrackAdded",e.TTML_PARSED="ttmlParsed",e.TTML_TO_PARSE="ttmlToParse",e.CAPTION_RENDERED="captionRendered",e.CAPTION_CONTAINER_RESIZE="captionContainerResize",e.CAN_PLAY="canPlay",e.CAN_PLAY_THROUGH="canPlayThrough",e.PLAYBACK_ENDED="playbackEnded",e.PLAYBACK_ERROR="playbackError",e.PLAYBACK_NOT_ALLOWED="playbackNotAllowed",e.PLAYBACK_METADATA_LOADED="playbackMetaDataLoaded",e.PLAYBACK_LOADED_DATA="playbackLoadedData",e.PLAYBACK_PAUSED="playbackPaused",e.PLAYBACK_PLAYING="playbackPlaying",e.PLAYBACK_PROGRESS="playbackProgress",e.PLAYBACK_RATE_CHANGED="playbackRateChanged",e.PLAYBACK_SEEKED="playbackSeeked",e.PLAYBACK_SEEKING="playbackSeeking",e.PLAYBACK_STALLED="playbackStalled",e.PLAYBACK_STARTED="playbackStarted",e.PLAYBACK_TIME_UPDATED="playbackTimeUpdated",e.PLAYBACK_VOLUME_CHANGED="playbackVolumeChanged",e.PLAYBACK_WAITING="playbackWaiting",e.MANIFEST_VALIDITY_CHANGED="manifestValidityChanged",e.EVENT_MODE_ON_START="eventModeOnStart",e.EVENT_MODE_ON_RECEIVE="eventModeOnReceive",e.CONFORMANCE_VIOLATION="conformanceViolation",e.REPRESENTATION_SWITCH="representationSwitch",e.ADAPTATION_SET_REMOVED_NO_CAPABILITIES="adaptationSetRemovedNoCapabilities",e.CONTENT_STEERING_REQUEST_COMPLETED="contentSteeringRequestCompleted",e}return n}())},"./src/streaming/MediaPlayerFactory.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r,i=n("./src/streaming/MediaPlayer.js"),o=function(){var e,t="application/dash+xml";function n(n,r,o){if(!n||!/^VIDEO$/i.test(n.nodeName))return null;if(n._dashjs_player)return n._dashjs_player;var s,a=n.id||n.name||"video element";if(!(r=r||[].slice.call(n.querySelectorAll("source")).filter((function(e){return e.type==t}))[0])&&n.src)(r=document.createElement("source")).src=n.src;else if(!r&&!n.src)return null;return o=o||{},(s=(0,i.default)(o).create()).initialize(n,r.src,n.autoplay),e||(e=s.getDebug().getLogger()),e.debug("Converted "+a+" to dash.js player and added content: "+r.src),n._dashjs_player=s,s}function r(e){return/^VIDEO$/i.test(e.nodeName)?e:r(e.parentNode)}return{create:n,createAll:function(e,i){var o=[];e=e||"[data-dashjs-player]";for(var s=(i=i||document).querySelectorAll(e),a=0;a<s.length;a++){var l=n(s[a],null);o.push(l)}for(var c=i.querySelectorAll('source[type="'+t+'"]'),u=0;u<c.length;u++){var d=n(r(c[u]),null);o.push(d)}return o}}}();!("undefined"!=typeof window&&window&&window.dashjs&&window.dashjs.skipAutoCreate)&&"undefined"!=typeof window&&window&&window.addEventListener&&("complete"===window.document.readyState?window.dashjs?o.createAll():r=window.setInterval((function(){window.dashjs&&(window.clearInterval(r),o.createAll())}),500):window.addEventListener("load",(function e(){window.removeEventListener("load",e),o.createAll()})));const s=o},"./src/streaming/PreBufferSink.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/core/Debug.js"),i=n("./src/core/FactoryMaker.js");function o(e){var t,n,i,o=this.context,s=[],a=e;function l(e,t){return s=s.filter((function(n){return!((isNaN(t)||n.start<t)&&(isNaN(e)||n.end>e))})),Promise.resolve()}return t={getAllBufferRanges:function(){for(var e=[],t=0;t<s.length;t++){var n=s[t];0===e.length||n.start>e[e.length-1].end?e.push({start:n.start,end:n.end}):e[e.length-1].end=n.end}var r={start:function(t){return e[t].start},end:function(t){return e[t].end}};return Object.defineProperty(r,"length",{get:function(){return e.length}}),r},append:function(e){return"InitializationSegment"!==e.segmentType?(s.push(e),s.sort((function(e,t){return e.start-t.start})),i=null):i=e,n.debug("PreBufferSink appended chunk s: "+e.start+"; e: "+e.end),a&&a({chunk:e}),Promise.resolve()},remove:l,abort:function(){return Promise.resolve()},discharge:function(e,t){var n=function(e,t){return s.filter((function(n){return(isNaN(t)||n.start<t)&&(isNaN(e)||n.end>e)}))}(e,t);return i&&(n.push(i),i=null),l(e,t),n},reset:function(){s=[],i=null,a=null},updateTimestampOffset:function(){return Promise.resolve()},waitForUpdateEnd:function(e){e()},getBuffer:function(){return this}},n=(0,r.default)(o).getInstance().getLogger(t),t}o.__dashjs_factory_name="PreBufferSink";const s=i.default.getClassFactory(o)},"./src/streaming/SourceBufferSink.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});var r=n("./src/core/Debug.js"),i=n("./src/streaming/vo/DashJSError.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/core/errors/Errors.js"),a=n("./src/core/Settings.js"),l=n("./src/streaming/constants/Constants.js"),c=n("./src/streaming/vo/metrics/HTTPRequest.js"),u=n("./src/core/events/Events.js");function d(e){var t,n,o,d,p,h,f=this.context,g=(0,a.default)(f).getInstance(),m=e.textController,v=e.eventBus,y=[],b=[],x=!1,E=e.mediaSource,_=null;function w(e){return new Promise((function(t){O((function(){d.changeType&&d.changeType(e),t()}))}))}function S(e){return d=m.getTextSourceBuffer(e),Promise.resolve()}function T(){if("function"==typeof d.addEventListener)try{d.addEventListener("updateend",j,!1),d.addEventListener("error",I,!1),d.addEventListener("abort",I,!1)}catch(e){h=setInterval(j,50)}else h=setInterval(j,50)}function k(e){return new Promise((function(t){d&&g.get().streaming.buffer.useAppendWindow?O((function(){try{if(!d)return void t();var n=E.duration,r=0;e&&!isNaN(e.start)&&!isNaN(e.duration)&&isFinite(e.duration)&&(n=e.start+e.duration),e&&!isNaN(e.start)&&(r=e.start),d.appendWindowEnd===n&&d.appendWindowStart===r||(d.appendWindowStart=0,d.appendWindowEnd=n+.01,d.appendWindowStart=Math.max(r-.1,0),o.debug("Updated append window for ".concat(p.type,". Set start to ").concat(d.appendWindowStart," and end to ").concat(d.appendWindowEnd))),t()}catch(e){o.warn("Failed to set append window"),t()}})):t()}))}function C(e){return new Promise((function(t){d?O((function(){try{d.timestampOffset===e||isNaN(e)||(d.timestampOffset=e,o.debug("Set MSE timestamp offset to ".concat(e))),t()}catch(e){t()}})):t()}))}function A(){y.length>0&&(d.updating||(y.shift()(),A()))}function j(){d.updating||A()}function I(e){var t,r,i=e.target||{};t=u.default.SOURCE_BUFFER_ERROR,r={error:i,lastRequestAppended:_}||{},v.trigger(t,r,{streamId:p.streamInfo.id,mediaType:n})}function O(e){y.push(e),d.updating||A()}return t={getType:function(){return n},getAllBufferRanges:function(){try{return d.buffered}catch(e){return o.error("getAllBufferRanges exception: "+e.message),null}},getBuffer:function(){return d},append:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(r,a){e?(b.push({data:e,promise:{resolve:r,reject:a},request:n}),O(function e(){if(!x&&b.length>0){x=!0;var t=b[0];b.splice(0,1);var n=function(){x=!1,b.length>0&&e.call(this),t&&t.data&&t.data.segmentType&&t.data.segmentType!==c.HTTPRequest.INIT_SEGMENT_TYPE&&delete t.data.bytes,t.promise.resolve({chunk:t.data})};try{_=t.request,0===t.data.bytes.byteLength?n.call(this):(d.appendBuffer?d.appendBuffer(t.data.bytes):d.append(t.data.bytes,t.data),O(n.bind(this)))}catch(n){o.fatal('SourceBuffer append failed "'+n+'"'),b.length>0?e():x=!1,delete t.data.bytes,t.promise.reject({chunk:t.data,error:new i.default(n.code,n.message)})}}}.bind(t))):a({chunk:e,error:new i.default(s.default.APPEND_ERROR_CODE,s.default.APPEND_ERROR_MESSAGE)})}))},remove:function(e){return new Promise((function(t,n){var r=e.start,o=e.end;r>=0&&o>r?O((function(){try{d.remove(r,o),O((function(){t({from:r,to:o,unintended:!1}),e.resolve&&e.resolve()}))}catch(t){n({from:r,to:o,unintended:!1,error:new i.default(s.default.REMOVE_ERROR_CODE,s.default.REMOVE_ERROR_MESSAGE)}),e.reject&&e.reject(t)}})):t()}))},abort:function(){return new Promise((function(e){try{b=[],"open"===E.readyState?O((function(){try{d&&d.abort(),e()}catch(t){e()}})):d&&d.setTextTrack&&"ended"===E.readyState?(d.abort(),e()):e()}catch(t){e()}}))},reset:function(){if(d){try{y=[],function(){try{"function"==typeof d.removeEventListener&&(d.removeEventListener("updateend",j,!1),d.removeEventListener("error",I,!1),d.removeEventListener("abort",I,!1)),clearInterval(h)}catch(e){o.error(e)}}(),x=!1,b=[],d.getClassName&&"TextSourceBuffer"===d.getClassName()||(o.debug("Removing sourcebuffer from media source"),E.removeSourceBuffer(d))}catch(e){}d=null}_=null},updateTimestampOffset:C,initializeForStreamSwitch:function(e,t,r){n=(p=e).type;var i=p.codec;!function(e){d=e.getBuffer()}(r),T();var o=[];return o.push(new Promise((function(e){O((function(){var t=d.appendWindowStart,n=d.appendWindowEnd;d&&(d.abort(),d.appendWindowStart=t,d.appendWindowEnd=n),e()}))}))),o.push(k(p.streamInfo)),o.push(w(i)),t&&void 0!==t.MSETimeOffset&&o.push(C(t.MSETimeOffset)),Promise.all(o)},initializeForFirstUse:function(e,t,r){n=(p=t).type;var i=p.codec;try{if(i.match(/application\/mp4;\s*codecs="(stpp|wvtt).*"/i))return S(e);d=E.addSourceBuffer(i),T();var o=[];return o.push(k(p.streamInfo)),r&&void 0!==r.MSETimeOffset&&o.push(C(r.MSETimeOffset)),Promise.all(o)}catch(t){return p.type==l.default.TEXT&&!p.isFragmented||-1!==i.indexOf('codecs="stpp')||-1!==i.indexOf('codecs="vtt')?S(e):Promise.reject(t)}},updateAppendWindow:k,changeType:w},o=(0,r.default)(f).getInstance().getLogger(t),t}d.__dashjs_factory_name="SourceBufferSink";const p=o.default.getClassFactory(d)},"./src/streaming/Stream.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>b});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/dash/constants/DashConstants.js"),o=n("./src/streaming/StreamProcessor.js"),s=n("./src/streaming/controllers/FragmentController.js"),a=n("./src/streaming/thumbnail/ThumbnailController.js"),l=n("./src/core/EventBus.js"),c=n("./src/core/events/Events.js"),u=n("./src/core/Debug.js"),d=n("./src/core/errors/Errors.js"),p=n("./src/core/FactoryMaker.js"),h=n("./src/streaming/vo/DashJSError.js"),f=n("./src/streaming/utils/BoxParser.js"),g=n("./src/streaming/utils/URLUtils.js"),m=n("./src/streaming/controllers/BlacklistController.js"),v=[r.default.VIDEO,r.default.AUDIO,r.default.TEXT,r.default.MUXED,r.default.IMAGE];function y(e){e=e||{};var t,n,p,y,b,x,E,_,w,S,T,k,C,A,j,I,O,N,R=this.context,P=(0,l.default)(R).getInstance(),D=(0,g.default)(R).getInstance(),M=e.manifestModel,L=e.mediaPlayerModel,B=e.dashMetrics,F=e.manifestUpdater,U=e.adapter,H=e.timelineConverter,G=e.capabilities,q=e.errHandler,V=e.abrController,z=e.playbackController,W=e.eventController,K=e.mediaController,$=e.protectionController,Y=e.textController,X=e.videoModel,J=e.streamInfo,Q=e.settings;function Z(e,t){return new Promise((function(i,o){le(),S=!0,ue();var s,a=X.getElement();v.forEach((function(t){(t!==r.default.TEXT||e)&&(t!==r.default.VIDEO||!a||a&&/^VIDEO$/i.test(a.nodeName))&&ee(t,e)})),(s=t,new Promise((function(e){var t={},n=p.map((function(e){return e.createBufferSinks(s)}));Promise.all(n).then((function(n){n.forEach((function(e){e&&(t[e.getType()]=e)})),e(t)})).catch((function(){e(t)}))}))).then((function(t){if(S=!1,0===p.length){var r="No streams to play.";q.error(new h.default(d.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,r,M.getValue())),n.fatal(r)}else de();e&&Y.createTracks(J),i(t)})).catch((function(e){o(e)}))}))}function ee(t,s){var l,u=U.getAllMediaInfoForType(J,t),d=[],h=null;if(u&&0!==u.length){t===r.default.VIDEO&&(E=!0),t===r.default.AUDIO&&(_=!0);for(var f=0,g=u.length;f<g;f++)h=u[f],t===r.default.TEXT&&h.isEmbedded&&(Y.addEmbeddedTrack(J,h),d.push(h)),te(h)&&K.addTrack(h);if(d.length>0&&(K.setInitialMediaSettingsForType(t,J),Y.addMediaInfosToBuffer(J,t,d)),0!==(u=u.filter((function(e){return!e.isEmbedded}))).length)if(t!==r.default.IMAGE){P.trigger(c.default.STREAM_INITIALIZING,{streamInfo:J,mediaInfo:h}),K.setInitialMediaSettingsForType(t,J);var m=function(t,n){var i=t&&t.length>0?t[0]:null,s=T.getModel(i?i.type:null),a=i?i.type:null,l=i?i.mimeType:null,c=i?i.isFragmented:null,u=(0,o.default)(R).create({streamInfo:J,type:a,mimeType:l,timelineConverter:H,adapter:U,manifestModel:M,mediaPlayerModel:L,fragmentModel:s,dashMetrics:e.dashMetrics,baseURLController:e.baseURLController,segmentBaseController:e.segmentBaseController,abrController:V,playbackController:z,mediaController:K,textController:Y,errHandler:q,settings:Q,boxParser:j,segmentBlacklistController:C});u.initialize(n,E,c),p.push(u);for(var d=0;d<t.length;d++)u.addMediaInfo(t[d]);return a===r.default.TEXT&&Y.addMediaInfosToBuffer(J,a,t,s),u}(u,s);(l=K.getCurrentTrackFor(t,J.id))&&(V.updateTopQualityIndex(l),m.selectMediaInfo(t===r.default.TEXT&&l.isEmbedded?u[0]:l))}else(k=(0,a.default)(R).create({streamInfo:J,adapter:U,baseURLController:e.baseURLController,timelineConverter:e.timelineConverter,debug:I,eventBus:P,events:c.default,dashConstants:i.default,dashMetrics:e.dashMetrics,segmentBaseController:e.segmentBaseController})).initialize()}else n.info("No "+t+" data.")}function te(e){var t,i=e?e.type:null;return i===r.default.MUXED?(t="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines",n.fatal(t),q.error(new h.default(d.default.MANIFEST_ERROR_ID_MULTIPLEXED_CODE,t,M.getValue())),!1):!(i!==r.default.TEXT&&i!==r.default.IMAGE&&e.contentProtection&&!G.supportsEncryptedMedia()&&(q.error(new h.default(d.default.CAPABILITY_MEDIAKEYS_ERROR_CODE,d.default.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE)),1))}function ne(e){for(var t=p?p.length:0,n=0;n<t;n++){var r=p[n].getFragmentModel();r.abortRequests(),r.resetInitialSettings(),p[n].reset(!1,e)}Y&&Y.deactivateStream(J),p=[],b=!1,x=!1,Ee(!1),ie(!1),P.trigger(c.default.STREAM_DEACTIVATED,{streamInfo:J})}function re(e){ne(e),y=!1,E=!1,_=!1,w={},S=!1,O=!1,N=[]}function ie(e){O=e}function oe(){return J?J.start:NaN}function se(){return J?J.id:null}function ae(){return J}function le(){if(!X||!V)throw new Error(r.default.MISSING_CONFIG_ERROR)}function ce(e){e.error&&(q.error(e.error),n.fatal(e.error.message))}function ue(){if(W){var e=U.getEventsFor(J);e&&e.length>0&&W.addInlineEvents(e,J.id)}}function de(){for(var e=p.length,t=w.audio||w.video?new h.default(d.default.DATA_UPDATE_FAILED_ERROR_CODE,d.default.DATA_UPDATE_FAILED_ERROR_MESSAGE):null,n=0;n<e;n++)if(p[n].isUpdating()||S)return;if($){$.clearMediaInfoArray();for(var i=0;i<e&&p[i];i++){var o=p[i].getType(),s=p[i].getMediaInfo();if(o===r.default.AUDIO||o===r.default.VIDEO||o===r.default.TEXT&&s.isFragmented){var a=p[i].getMediaInfo();a&&$.initializeForMedia(a)}}$.handleKeySystemFromManifest()}t?q.error(t):y||(y=!0,X.waitForReadyState(r.default.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,(function(){P.trigger(c.default.STREAM_INITIALIZED,{streamInfo:J})})))}function pe(){var e=ve(),t=e.length;if(0!==t){for(var i=0;i<t;i++)if(!e[i].isBufferingCompleted()&&(e[i].getType()===r.default.AUDIO||e[i].getType()===r.default.VIDEO))return void n.debug("onBufferingCompleted - One streamProcessor has finished but",e[i].getType(),"one is not buffering completed");n.debug("onBufferingCompleted - trigger STREAM_BUFFERING_COMPLETED"),x=!0,P.trigger(c.default.STREAM_BUFFERING_COMPLETED,{streamInfo:J},{streamInfo:J})}else n.warn("onBufferingCompleted - can't trigger STREAM_BUFFERING_COMPLETED because no streamProcessor is defined")}function he(e){w[e.mediaType]=e.error,de()}function fe(e){W&&W.addInbandEvents(e.events,J.id)}function ge(e){return e&&e.type?me(e.type):null}function me(e){return e?ve().filter((function(t){return t.getType()===e}))[0]:null}function ve(){for(var e,t,n=[],i=0;i<p.length;i++)(e=(t=p[i]).getType())!==r.default.AUDIO&&e!==r.default.VIDEO&&e!==r.default.TEXT||n.push(t);return n}function ye(e,t){var n=ae(),r=t.getStreamInfo();if(!r||!n)return!0;var i=U.getAdaptationForType(r.index,e,r),o=U.getAdaptationForType(n.index,e,n);return i&&o?!(!be(o)&&be(i)):!i&&!o}function be(e){return!!e&&!!(e.ContentProtection||e.Representation&&e.Representation.length>0&&e.Representation[0].ContentProtection)}function xe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e||!e.hasOwnProperty("getStreamInfo"))return!1;var r=e.getStreamInfo(),i=n?n.getStreamInfo():ae();if(!r||!i)return!1;var o=U.getAdaptationForType(r.index,t,r),s=U.getAdaptationForType(i.index,t,i);if(!o||!s)return!o&&!s;var a=o&&s&&o.mimeType===s.mimeType,l=s.Representation_asArray.map((function(e){return e.codecs})),c=o.Representation_asArray.map((function(e){return e.codecs})),u=c.some((function(e){return l.indexOf(e)>-1})),d=c.some((function(e){return l.some((function(t){return G.codecRootCompatibleWithCodec(t,e)}))}));return u||d&&a}function Ee(e){A=e}function _e(){return A}return t={initialize:function(){P.on(c.default.BUFFERING_COMPLETED,pe,t),P.on(c.default.DATA_UPDATE_COMPLETED,he,t),P.on(c.default.INBAND_EVENTS,fe,t),$&&(P.on(c.default.KEY_ERROR,ce,t),P.on(c.default.SERVER_CERTIFICATE_UPDATED,ce,t),P.on(c.default.LICENSE_REQUEST_COMPLETE,ce,t),P.on(c.default.KEY_SYSTEM_SELECTED,ce,t),P.on(c.default.KEY_SESSION_CREATED,ce,t),P.on(c.default.KEY_STATUSES_CHANGED,ce,t)),Y.initializeForStream(J),P.trigger(c.default.STREAM_UPDATED,{streamInfo:J})},getStreamId:function(){return J?J.id:null},activate:function(e,t){return new Promise((function(n,r){if(!b)return _e()?(b=!0,P.trigger(c.default.STREAM_ACTIVATED,{streamInfo:J}),void n(t)):void function(e,t){return Z(e,t)}(e,t).then((function(e){b=!0,P.trigger(c.default.STREAM_ACTIVATED,{streamInfo:J}),n(e)})).catch((function(e){r(e)}));n(t)}))},deactivate:ne,getIsActive:function(){return b},getDuration:function(){return J?J.duration:NaN},getStartTime:oe,getId:se,getStreamInfo:ae,getHasAudioTrack:function(){return _},getHasVideoTrack:function(){return E},startPreloading:function(e,t){return new Promise((function(r,i){_e()?i():(n.info("[startPreloading] Preloading next stream with id ".concat(se())),Ee(!0),Z(e,t).then((function(){for(var e=0;e<p.length&&p[e];e++)p[e].setExplicitBufferingTime(oe()),p[e].getScheduleController().startScheduleTimer();r()})).catch((function(){Ee(!1),i()})))}))},initializeForTextWithMediaSource:function(e){return new Promise((function(t,n){var i;ee(r.default.TEXT,e),(i=me(r.default.TEXT),i?i.createBufferSinks():Promise.resolve()).then((function(){Y.createTracks(J),t()})).catch((function(e){n(e)}))}))},getThumbnailController:function(){return k},getBitrateListFor:function(e){if(le(),e===r.default.IMAGE)return k?k.getBitrateList():[];var t=function(e){for(var t=null,n=0;n<p.length;n++)if((t=p[n]).getType()===e)return t.getMediaInfo();return null}(e);return V.getBitrateList(t)},updateData:function(e){return new Promise((function(t){S=!0,J=e,W&&ue();for(var n=[],r=0,i=p.length;r<i;r++){var o=p[r],s=o.getMediaInfo();n.push(o.updateStreamInfo(J));var a=U.getAllMediaInfoForType(J,o.getType());if(a=a.filter((function(e){return!e.isEmbedded}))){o.clearMediaInfoArray();for(var l=0;l<a.length;l++){var u=a[l];o.addMediaInfo(a[l]),U.areMediaInfosEqual(s,u)&&(V.updateTopQualityIndex(u),n.push(o.selectMediaInfo(u)))}}}Promise.all(n).then((function(){for(n=[];N.length>0;){var e=N.pop(),t=e.newMediaInfo,r=ge(e.oldMediaInfo);if(!r)return;n.push(r.prepareTrackSwitch()),r.selectMediaInfo(t)}return Promise.all(n)})).then((function(){S=!1,de(),P.trigger(c.default.STREAM_UPDATED,{streamInfo:J}),t()}))}))},reset:function(e){T&&(T.reset(),T=null),V&&J&&V.clearDataForStream(J.id),C&&(C.reset(),C=null),re(e),J=null,P.off(c.default.DATA_UPDATE_COMPLETED,he,t),P.off(c.default.BUFFERING_COMPLETED,pe,t),P.off(c.default.INBAND_EVENTS,fe,t),$&&(P.off(c.default.KEY_ERROR,ce,t),P.off(c.default.SERVER_CERTIFICATE_UPDATED,ce,t),P.off(c.default.LICENSE_REQUEST_COMPLETE,ce,t),P.off(c.default.KEY_SYSTEM_SELECTED,ce,t),P.off(c.default.KEY_SESSION_CREATED,ce,t),P.off(c.default.KEY_STATUSES_CHANGED,ce,t))},getProcessors:ve,setMediaSource:function(e){return new Promise((function(t,r){for(var i=[],o=0;o<p.length;)te(p[o].getMediaInfo())?(i.push(p[o].setMediaSource(e)),o++):(p[o].reset(),p.splice(o,1));Promise.all(i).then((function(){for(var e=0;e<p.length;e++)p[e].dischargePreBuffer();if(0===p.length){var r="No streams to play.";q.error(new h.default(d.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,r+"nostreams",M.getValue())),n.fatal(r)}t()})).catch((function(e){n.error(e),r(e)}))}))},isMediaCodecCompatible:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return xe(e,r.default.VIDEO,t)&&xe(e,r.default.AUDIO,t)},isProtectionCompatible:function(e){return!e||ye(r.default.VIDEO,e)&&ye(r.default.AUDIO,e)},getPreloaded:_e,getIsEndedEventSignaled:function(){return O},setIsEndedEventSignaled:ie,getAdapter:function(){return U},getHasFinishedBuffering:function(){return x},setPreloaded:Ee,startScheduleControllers:function(){for(var e=p.length,t=0;t<e&&p[t];t++)p[t].getScheduleController().startScheduleTimer()},prepareTrackChange:function(e){if(b&&J){x=!1;var t=e.newMediaInfo,i=M.getValue();U.setCurrentMediaInfo(J.id,t.type,t);var o=ge(t);if(o){var s=z.getTime();n.info("Stream -  Process track changed at current time "+s),i.refreshManifestOnSwitchTrack?(N.push(e),F.getIsUpdating()||(n.debug("Stream -  Refreshing manifest for switch track"),F.refreshManifest())):o.selectMediaInfo(t).then((function(){t.type!==r.default.VIDEO&&t.type!==r.default.AUDIO||V.updateTopQualityIndex(t),o.prepareTrackSwitch()}))}}},prepareQualityChange:function(e){var t=me(e.mediaType);t&&t.prepareQualityChange(e)}},function(){try{I=(0,u.default)(R).getInstance(),n=I.getLogger(t),re(),j=(0,f.default)(R).getInstance(),C=(0,m.default)(R).create({updateEventName:c.default.SEGMENT_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:c.default.SEGMENT_LOCATION_BLACKLIST_ADD}),T=(0,s.default)(R).create({streamInfo:J,mediaPlayerModel:L,dashMetrics:B,errHandler:q,settings:Q,boxParser:j,dashConstants:i.default,urlUtils:D})}catch(e){throw e}}(),t}y.__dashjs_factory_name="Stream";const b=p.default.getClassFactory(y)},"./src/streaming/StreamProcessor.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>k});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/dash/constants/DashConstants.js"),o=n("./src/streaming/constants/MetricsConstants.js"),s=n("./src/streaming/models/FragmentModel.js"),a=n("./src/streaming/controllers/BufferController.js"),l=n("./src/streaming/text/NotFragmentedTextBufferController.js"),c=n("./src/streaming/controllers/ScheduleController.js"),u=n("./src/dash/controllers/RepresentationController.js"),d=n("./src/core/FactoryMaker.js"),p=n("./src/streaming/utils/SupervisorTools.js"),h=n("./src/core/EventBus.js"),f=n("./src/core/events/Events.js"),g=n("./src/dash/DashHandler.js"),m=n("./src/core/errors/Errors.js"),v=n("./src/streaming/vo/DashJSError.js"),y=n("./src/core/Debug.js"),b=n("./src/streaming/utils/RequestModifier.js"),x=n("./src/streaming/utils/URLUtils.js"),E=n("./src/streaming/utils/BoxParser.js"),_=n("./src/streaming/vo/metrics/PlayList.js"),w=n("./src/dash/controllers/SegmentsController.js"),S=n("./src/streaming/vo/metrics/HTTPRequest.js");function T(e){e=e||{};var t,n,d,T,k,C,A,j,I,O,N,R,P,D=this.context,M=(0,h.default)(D).getInstance(),L=e.streamInfo,B=e.type,F=e.errHandler,U=e.mimeType,H=e.timelineConverter,G=e.adapter,q=e.manifestModel,V=e.mediaPlayerModel,z=e.fragmentModel,W=e.abrController,K=e.playbackController,$=e.mediaController,Y=e.textController,X=e.dashMetrics,J=e.settings,Q=e.boxParser,Z=e.segmentBlacklistController;function ee(){return L.id}function te(){return B}function ne(){return G.getIsTextTrack(j.getData())}function re(){k=[],T=null,P=0,I=!1,O=!1}function ie(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.sender)if(K.getIsManifestUpdateInProgress())se();else if((!ne()||Y.isTextEnabled())&&C&&e.representationId&&!C.appendInitSegmentFromCache(e.representationId)){var n=j.getCurrentRepresentation();if(0===n.range)return void oe();var r=N?N.getInitRequest(T,n):null;r?z.executeRequest(r):t&&(A.setInitSegmentRequired(!0),se())}}function oe(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(K.getIsManifestUpdateInProgress()||C.getIsPruningInProgress())se();else{var o=function(){var e,t=xe();if(isNaN(P)||te()===r.default.TEXT&&!Y.isTextEnabled())return null;if(N){var n=j&&t?j.getRepresentationForQuality(t.quality):null;e=I?N.getSegmentRequestForTime(T,n,P):N.getNextSegmentRequest(T,n)}return e}();o?(I=!1,function(e){isNaN(e.startTime+e.duration)||(P=e.startTime+e.duration),e.delayLoadingTime=(new Date).getTime()+A.getTimeToLoadDelay(),A.setTimeToLoadDelay(0),function(e){var t=e.url;return e.range&&(t=t.concat("_",e.range)),Z.contains(t)}(e)?(n.warn("Fragment request url ".concat(e.url," for stream id ").concat(L.id," and media type ").concat(B," is on the ignore list and will be skipped")),se()):(n.debug("Next fragment request url for stream id ".concat(L.id," and media type ").concat(B," is ").concat(e.url)),z.executeRequest(e))}(o)):function(e){var t,r=j.getCurrentRepresentation();if(!J.get().streaming.gaps.enableSeekFix||!I&&0!==K.getTime()||(d?d&&r.segmentInfoType===i.default.SEGMENT_TIMELINE&&(t=N.getValidTimeAheadOfTargetTime(P,T,r,J.get().streaming.gaps.threshold)):t=N.getValidTimeAheadOfTargetTime(P,T,r,J.get().streaming.gaps.threshold),isNaN(t)||t===P)){if(N.isLastSegmentRequested(r,P)){var o=N.getCurrentIndex();return n.debug("Segment requesting for stream ".concat(L.id," has finished")),M.trigger(f.default.STREAM_REQUESTING_COMPLETED,{segmentIndex:o},{streamId:L.id,mediaType:B}),C.segmentRequestingCompleted(o),void A.clearScheduleTimer()}e&&se()}else K.isSeeking()||0===K.getTime()?(n.warn("Adjusting playback time ".concat(t," because of gap in the manifest. Seeking by ").concat(t-P)),K.seek(t,!1,!1)):(n.warn("Adjusting buffering time ".concat(t," because of gap in the manifest. Adjusting time by ").concat(t-P)),Ce(t),e&&se())}(t)}}function se(){A.startScheduleTimer(K.getLowLatencyModeEnabled()?J.get().streaming.scheduling.lowLatencyTimeout:J.get().streaming.scheduling.defaultTimeout)}function ae(e){e.error||(A.setCurrentRepresentation(G.convertRepresentationToRepresentationInfo(e.currentRepresentation)),C.getIsBufferingCompleted()||C.updateBufferTimestampOffset(e.currentRepresentation))}function le(e){X.addBufferState(B,e.state,A.getBufferTarget()),e.state!==o.default.BUFFER_EMPTY||K.isSeeking()||(n.info("Buffer is empty! Stalling!"),X.pushPlayListTraceMetrics(new Date,_.PlayListTrace.REBUFFERING_REASON))}function ce(e){z.syncExecutedRequestsWithBufferedRange(C.getBuffer().getAllBufferRanges(),L.duration),e.quotaExceeded&&e.from>K.getTime()&&Ce(e.from),e.hasEnoughSpaceToAppend&&e.quotaExceeded&&A.startScheduleTimer()}function ue(e){if(e&&e.lastRequestAppended&&e.lastRequestAppended.url){var t=e.lastRequestAppended.url;e.lastRequestAppended.range&&(t=t.concat("_",e.lastRequestAppended.range)),n.warn("Blacklisting segment with url ".concat(t)),Z.add(t)}}function de(){Te(),O=!1}function pe(e){n.info("onFragmentLoadingAbandoned request: "+e.request.url+" has been aborted"),K.isSeeking()||A.getSwitchStrack()||O||(n.info("onFragmentLoadingAbandoned request: "+e.request.url+" has to be downloaded again, origin is not seeking process or switch track call"),e.request&&e.request.isInitializationRequest()?A.setInitSegmentRequired(!0):Ce(e.request.startTime+e.request.duration/2),A.startScheduleTimer(0))}function he(e){n.info("OnFragmentLoadingCompleted for stream id "+L.id+" and media type "+B+" - Url:",e.request?e.request.url:"undefined",e.request.range?", Range:"+e.request.range:""),ne()&&A.startScheduleTimer(0),e.error&&e.request.serviceLocation&&function(e){n.info("Fragment loading completed with an error"),e&&e.request&&e.request.type&&(e.request.type===S.HTTPRequest.INIT_SEGMENT_TYPE?ie({representationId:e.request.representationId,sender:{}},!1):e.request.type===S.HTTPRequest.MEDIA_SEGMENT_TYPE&&(Ce(e.request.startTime+e.request.duration/2),oe({},!1)))}(e)}function fe(){Ce(K.getTime()),be().startScheduleTimer()}function ge(e){var t=e.currentTrackInfo;if(t){var n=k.find((function(e){return e.index===t.index&&e.lang===t.lang}));n&&ye(n).then((function(){C.setIsBufferingCompleted(!1),Ce(K.getTime()),A.setInitSegmentRequired(!0),A.startScheduleTimer()}))}}function me(e){Ce(e.quotaExceededTime),A.clearScheduleTimer()}function ve(){return C?C.getBuffer():null}function ye(e){e===T||e&&T&&e.type!==T.type||(T=e);var t=G.getRealAdaptation(L,T),n=G.getVoRepresentations(T);if(j){var i,o=j.getData(),s=W.getMaxAllowedIndexFor(B,L.id),a=W.getMinAllowedIndexFor(B,L.id),l=null;return null!==o&&o.id===t.id||B===r.default.TEXT?i=W.getQualityFor(B,L.id):(l=W.getThroughputHistory().getAverageThroughput(B,d)||W.getInitialBitrateFor(B,L.id),i=W.getQualityForBitrate(T,l,L.id)),void 0!==a&&i<a&&(i=a),i>s&&(i=s),j.updateData(t,n,B,T.isFragmented,i)}return Promise.resolve()}function be(){return A}function xe(e){var t;return void 0!==e?((0,p.checkInteger)(e),t=j?j.getRepresentationForQuality(e):null):t=j?j.getCurrentRepresentation():null,G.convertRepresentationToRepresentationInfo(t)}function Ee(){return!!C&&C.getIsBufferingCompleted()}function _e(e){if(J.get().streaming.enableManifestTimescaleMismatchFix){var t=e.chunk,n=t.bytes,r=xe(t.quality),i=j&&r?j.getRepresentationForQuality(r.quality):null;if(r&&i){var o=Q.getMediaTimescaleFromMoov(n);i.timescale=o}}}function we(e){var t=e.chunk,n=t.bytes,r=t.quality,i=xe(r),o=j&&i?j.getRepresentationForQuality(i.quality):null;if(i&&o){var a=G.getEventsFor(i.mediaInfo,null,L),l=G.getEventsFor(i,o,L);if(a&&a.length>0||l&&l.length>0){var c=function(e,t,n,r){try{for(var i={},o=[],s=n.concat(r),a=0,l=s.length;a<l;a++)i[s[a].schemeIdUri+"/"+s[a].value]=s[a];var c=(0,E.default)(D).getInstance().parse(e),u=c.getBoxes("emsg");if(!u||0===u.length)return o;for(var d=c.getBox("sidx"),p=!d||isNaN(d.earliest_presentation_time)||isNaN(d.timescale)?t&&!isNaN(t.mediaStartTime)?t.mediaStartTime:0:d.earliest_presentation_time/d.timescale,h=Math.max(p,0),f=j.getCurrentRepresentation(),g=0,m=u.length;g<m;g++){var v=G.getEvent(u[g],i,h,f);v&&o.push(v)}return o}catch(e){return[]}}(n,z.getRequests({state:s.default.FRAGMENT_MODEL_EXECUTED,quality:r,index:t.index})[0],a,l);M.trigger(f.default.INBAND_EVENTS,{events:c},{streamId:L.id})}}}function Se(){var e=K.getTime();J.get().streaming.buffer.flushBufferAtTrackSwitch&&K.seek(e+.001,!1,!0),Ce(e),C.setSeekTarget(e),A.startScheduleTimer()}function Te(){var e=K.getTime(),t=C.getContinuousBufferTimeForTargetTime(e);Ce(isNaN(t)?e:t),A.startScheduleTimer()}function ke(e){e&&!isNaN(e.time)&&(Ce(e.time),C.setSeekTarget(e.time))}function Ce(e){P=e,I=!0}return t={initialize:function(n,o,s){R=(0,w.default)(D).create({events:f.default,eventBus:M,streamInfo:L,timelineConverter:H,dashConstants:i.default,segmentBaseController:e.segmentBaseController,type:B}),N=(0,g.default)(D).create({streamInfo:L,type:B,timelineConverter:H,dashMetrics:X,mediaPlayerModel:V,baseURLController:e.baseURLController,errHandler:F,segmentsController:R,settings:J,boxParser:Q,events:f.default,eventBus:M,errors:m.default,debug:(0,y.default)(D).getInstance(),requestModifier:(0,b.default)(D).getInstance(),dashConstants:i.default,constants:r.default,urlUtils:(0,x.default)(D).getInstance()}),d=L.manifestInfo.isDynamic,N.initialize(d),W.registerStreamType(B,t),j=(0,u.default)(D).create({streamInfo:L,type:B,abrController:W,dashMetrics:X,playbackController:K,timelineConverter:H,dashConstants:i.default,events:f.default,eventBus:M,errors:m.default,isDynamic:d,segmentsController:R}),(C=function(e,t){return e?e!==r.default.TEXT||t?(0,a.default)(D).create({streamInfo:L,type:e,mediaPlayerModel:V,manifestModel:q,fragmentModel:z,errHandler:F,mediaController:$,representationController:j,adapter:G,textController:Y,abrController:W,playbackController:K,settings:J}):(0,l.default)(D).create({streamInfo:L,type:e,mimeType:U,fragmentModel:z,textController:Y,errHandler:F,settings:J}):(F.error(new v.default(m.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,m.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+"not properly defined")),null)}(B,s))&&C.initialize(n),(A=(0,c.default)(D).create({streamInfo:L,type:B,mimeType:U,adapter:G,dashMetrics:X,mediaPlayerModel:V,fragmentModel:z,abrController:W,playbackController:K,textController:Y,mediaController:$,bufferController:C,settings:J})).initialize(o),P=0,I=!1},getStreamId:ee,getType:te,isUpdating:function(){return!!j&&j.isUpdating()},getBufferController:function(){return C},dischargePreBuffer:function(){C.dischargePreBuffer()},getFragmentModel:function(){return z},getScheduleController:be,getRepresentationController:function(){return j},getRepresentationInfo:xe,getBufferLevel:function(){return C?C.getBufferLevel():0},isBufferingCompleted:Ee,createBufferSinks:function(e){var t=ve();return t?Promise.resolve(t):C?C.createBufferSink(T,e):Promise.resolve(null)},updateStreamInfo:function(e){return L=e,Ee()?Promise.resolve():C.updateAppendWindow()},getStreamInfo:function(){return L},selectMediaInfo:ye,clearMediaInfoArray:function(){k=[]},addMediaInfo:function(e){-1===k.indexOf(e)&&k.push(e)},prepareTrackSwitch:function(){return new Promise((function(e){n.debug("Preparing track switch for type ".concat(B));var t=B===r.default.TEXT||J.get().streaming.trackSwitchMode[B]===r.default.TRACK_SWITCH_MODE_ALWAYS_REPLACE&&K.getTimeToStreamEnd(L)>J.get().streaming.buffer.stallThreshold;if(C.getIsBufferingCompleted()&&!t)return C.prepareForNonReplacementTrackSwitch(T.codec).then((function(){M.trigger(f.default.BUFFERING_COMPLETED,{},{streamId:L.id,mediaType:B})})).catch((function(){M.trigger(f.default.BUFFERING_COMPLETED,{},{streamId:L.id,mediaType:B})})),void e();A.clearScheduleTimer(),A.setSwitchTrack(!0),t?(M.trigger(f.default.BUFFER_REPLACEMENT_STARTED,{mediaType:B,streamId:L.id},{mediaType:B,streamId:L.id}),z.abortRequests(),C.prepareForReplacementTrackSwitch(T.codec).then((function(){var e=xe();return C.updateBufferTimestampOffset(e)})).then((function(){Se(),e()})).catch((function(){Se(),e()}))):C.prepareForNonReplacementTrackSwitch(T.codec).then((function(){Te(),e()})).catch((function(){Te(),e()}))}))},prepareQualityChange:function(e){n.debug("Preparing quality switch for type ".concat(B));var t=e.newQuality;O=!0,A.clearScheduleTimer();var r=xe(t);A.setCurrentRepresentation(r),j.prepareQualityChange(t),z.abortRequests(),C.updateBufferTimestampOffset(r).then((function(){e.reason&&e.reason.forceReplace?(M.trigger(f.default.BUFFER_REPLACEMENT_STARTED,{mediaType:B,streamId:L.id},{mediaType:B,streamId:L.id}),C.prepareForReplacementQualitySwitch().then((function(){Se(),O=!1})).catch((function(){Se(),O=!1}))):J.get().streaming.buffer.fastSwitchEnabled?function(e){var t=K.getTime(),n=1.5*(isNaN(e.fragmentDuration)?1:e.fragmentDuration),r=z.getRequests({state:s.default.FRAGMENT_MODEL_EXECUTED,time:t+n,threshold:0})[0];if(r&&!ne()){var i=C.getBufferLevel(),a=W.getAbandonmentStateFor(L.id,B);r.quality<e.quality&&i>=n&&a!==o.default.ABANDON_LOAD?(Ce(t+n),A.setCheckPlaybackQuality(!1),A.startScheduleTimer()):de()}else A.startScheduleTimer();O=!1}(r):de(),X.pushPlayListTraceMetrics(new Date,_.PlayListTrace.REPRESENTATION_SWITCH_STOP_REASON),X.createPlaylistTraceMetrics(r.id,1e3*K.getTime(),K.getPlaybackRate())}))},getMediaInfo:function(){return T},getMediaSource:function(){return C.getMediaSource()},setMediaSource:function(e){return C.setMediaSource(e,T)},getBuffer:ve,setExplicitBufferingTime:Ce,finalisePlayList:function(e,t){X.pushPlayListTraceMetrics(e,t)},probeNextRequest:function(){var e=xe(),t=j&&e?j.getRepresentationForQuality(e.quality):null;return N.getNextSegmentRequestIdempotent(T,t)},prepareInnerPeriodPlaybackSeeking:function(e){return new Promise((function(t){if(C.hasBufferAtTime(e.seekTime))return C.pruneBuffer(),void t();A.clearScheduleTimer(),z.abortRequests(),C.prepareForPlaybackSeek().then((function(){var t=C.getAllRangesWithSafetyFactor(e.seekTime);return C.clearBuffers(t)})).then((function(){var n=C.getContinuousBufferTimeForTargetTime(e.seekTime);if(!isNaN(n)&&!isNaN(L.duration)&&isFinite(L.duration)&&n>=L.start+L.duration)C.setIsBufferingCompleted(!0),t();else{var r=isNaN(n)?e.seekTime:n;Ce(r),C.setSeekTarget(r);var i=[];i.push(C.updateAppendWindow());var o=xe();i.push(C.updateBufferTimestampOffset(o)),Promise.all(i).then((function(){A.setInitSegmentRequired(!0),A.setCheckPlaybackQuality(!1),A.startScheduleTimer(),t()}))}})).catch((function(e){n.error(e)}))}))},prepareOuterPeriodPlaybackSeeking:function(){return new Promise((function(e,t){try{A.clearScheduleTimer(),z.abortRequests(),C.prepareForPlaybackSeek().then((function(){return C.pruneAllSafely()})).then((function(){e()}))}catch(e){t(e)}}))},reset:function(e,n){N&&N.reset(),C&&(C.reset(e,n),C=null),A&&(A.reset(),A=null),j&&(j.reset(),j=null),R&&(R=null),W&&W.unRegisterStreamType(ee(),B),M.off(f.default.DATA_UPDATE_COMPLETED,ae,t),M.off(f.default.INIT_FRAGMENT_NEEDED,ie,t),M.off(f.default.MEDIA_FRAGMENT_NEEDED,oe,t),M.off(f.default.INIT_FRAGMENT_LOADED,_e,t),M.off(f.default.MEDIA_FRAGMENT_LOADED,we,t),M.off(f.default.BUFFER_LEVEL_STATE_CHANGED,le,t),M.off(f.default.BUFFER_CLEARED,ce,t),M.off(f.default.SEEK_TARGET,ke,t),M.off(f.default.FRAGMENT_LOADING_ABANDONED,pe,t),M.off(f.default.FRAGMENT_LOADING_COMPLETED,he,t),M.off(f.default.SET_FRAGMENTED_TEXT_AFTER_DISABLED,fe,t),M.off(f.default.SET_NON_FRAGMENTED_TEXT,ge,t),M.off(f.default.QUOTA_EXCEEDED,me,t),M.off(f.default.SOURCE_BUFFER_ERROR,ue,t),re(),B=null,L=null}},n=(0,y.default)(D).getInstance().getLogger(t),re(),M.on(f.default.DATA_UPDATE_COMPLETED,ae,t,{priority:h.default.EVENT_PRIORITY_HIGH}),M.on(f.default.INIT_FRAGMENT_NEEDED,ie,t),M.on(f.default.MEDIA_FRAGMENT_NEEDED,oe,t),M.on(f.default.INIT_FRAGMENT_LOADED,_e,t),M.on(f.default.MEDIA_FRAGMENT_LOADED,we,t),M.on(f.default.BUFFER_LEVEL_STATE_CHANGED,le,t),M.on(f.default.BUFFER_CLEARED,ce,t),M.on(f.default.SEEK_TARGET,ke,t),M.on(f.default.FRAGMENT_LOADING_ABANDONED,pe,t),M.on(f.default.FRAGMENT_LOADING_COMPLETED,he,t),M.on(f.default.QUOTA_EXCEEDED,me,t),M.on(f.default.SET_FRAGMENTED_TEXT_AFTER_DISABLED,fe,t),M.on(f.default.SET_NON_FRAGMENTED_TEXT,ge,t),M.on(f.default.SOURCE_BUFFER_ERROR,ue,t),t}T.__dashjs_factory_name="StreamProcessor";const k=d.default.getClassFactory(T)},"./src/streaming/XlinkLoader.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});var r=n("./src/streaming/vo/DashJSError.js"),i=n("./src/streaming/net/URLLoader.js"),o=n("./src/streaming/vo/metrics/HTTPRequest.js"),s=n("./src/streaming/vo/TextRequest.js"),a=n("./src/core/EventBus.js"),l=n("./src/core/events/Events.js"),c=n("./src/core/FactoryMaker.js"),u=n("./src/core/errors/Errors.js");function d(e){e=e||{};var t=this.context,n=(0,a.default)(t).getInstance(),c=(0,i.default)(t).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,errors:u.default});return{load:function(e,t,i){var a=function(o,s){t.resolved=!0,t.resolvedContent=o||null,n.trigger(l.default.XLINK_ELEMENT_LOADED,{element:t,resolveObject:i,error:o||s?null:new r.default(u.default.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE,u.default.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE+e)})};if("urn:mpeg:dash:resolve-to-zero:2013"===e)a(null,!0);else{var d=new s.default(e,o.HTTPRequest.XLINK_EXPANSION_TYPE);c.load({request:d,success:function(e){a(e)},error:function(){a(null)}})}},reset:function(){c&&(c.abort(),c=null)}}}d.__dashjs_factory_name="XlinkLoader";const p=c.default.getClassFactory(d)},"./src/streaming/constants/ConformanceViolationConstants.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={LEVELS:{SUGGESTION:"Suggestion",WARNING:"Warning",ERROR:"Error"},EVENTS:{NO_UTC_TIMING_ELEMENT:{key:"NO_UTC_TIMING_ELEMENT",message:"No UTCTiming element is present in the manifest. You may experience playback failures. For a detailed validation use https://conformance.dashif.org/"},NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE:{key:"NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE",message:'SMPTE 2052-1:2013 defines the attribute name as "imageType" and does not define "imagetype"'},INVALID_DVR_WINDOW:{key:"INVALID_DVR_WINDOW",message:"No valid segment found when applying a specification compliant DVR window calculation. Using SegmentTimeline entries as a fallback."}}}},"./src/streaming/constants/Constants.js":(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,{default:()=>i});const i=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t,n;return t=e,(n=[{key:"init",value:function(){this.STREAM="stream",this.VIDEO="video",this.AUDIO="audio",this.TEXT="text",this.MUXED="muxed",this.IMAGE="image",this.STPP="stpp",this.TTML="ttml",this.VTT="vtt",this.WVTT="wvtt",this.CONTENT_STEERING="contentSteering",this.ABR_STRATEGY_DYNAMIC="abrDynamic",this.ABR_STRATEGY_BOLA="abrBola",this.ABR_STRATEGY_L2A="abrL2A",this.ABR_STRATEGY_LoLP="abrLoLP",this.ABR_STRATEGY_THROUGHPUT="abrThroughput",this.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA="abrFetchThroughputCalculationDownloadedData",this.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING="abrFetchThroughputCalculationMoofParsing",this.ABR_FETCH_THROUGHPUT_CALCULATION_AAST="abrFetchThroughputCalculationAAST",this.LIVE_CATCHUP_MODE_DEFAULT="liveCatchupModeDefault",this.LIVE_CATCHUP_MODE_LOLP="liveCatchupModeLoLP",this.MOVING_AVERAGE_SLIDING_WINDOW="slidingWindow",this.MOVING_AVERAGE_EWMA="ewma",this.BAD_ARGUMENT_ERROR="Invalid Arguments",this.MISSING_CONFIG_ERROR="Missing config parameter(s)",this.TRACK_SWITCH_MODE_ALWAYS_REPLACE="alwaysReplace",this.TRACK_SWITCH_MODE_NEVER_REPLACE="neverReplace",this.TRACK_SELECTION_MODE_FIRST_TRACK="firstTrack",this.TRACK_SELECTION_MODE_HIGHEST_BITRATE="highestBitrate",this.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY="highestEfficiency",this.TRACK_SELECTION_MODE_WIDEST_RANGE="widestRange",this.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY="highestSelectionPriority",this.CMCD_MODE_QUERY="query",this.CMCD_MODE_HEADER="header",this.LOCATION="Location",this.INITIALIZE="initialize",this.TEXT_SHOWING="showing",this.TEXT_HIDDEN="hidden",this.CC1="CC1",this.CC3="CC3",this.UTF8="utf-8",this.SCHEME_ID_URI="schemeIdUri",this.START_TIME="starttime",this.SERVICE_DESCRIPTION_DVB_LL_SCHEME="urn:dvb:dash:lowlatency:scope:2019",this.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME="urn:dvb:dash:lowlatency:critical:2019",this.XML="XML",this.ARRAY_BUFFER="ArrayBuffer",this.DVB_REPORTING_URL="dvb:reportingUrl",this.DVB_PROBABILITY="dvb:probability",this.VIDEO_ELEMENT_READY_STATES={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},this.FILE_LOADER_TYPES={FETCH:"fetch_loader",XHR:"xhr_loader"}}}])&&r(t.prototype,n),e}())},"./src/streaming/constants/MetricsConstants.js":(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,{default:()=>i});const i=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t,n;return t=e,(n=[{key:"init",value:function(){this.TCP_CONNECTION="TcpList",this.HTTP_REQUEST="HttpList",this.TRACK_SWITCH="RepSwitchList",this.BUFFER_LEVEL="BufferLevel",this.BUFFER_LOADED="bufferLoaded",this.ABANDON_LOAD="abandonload",this.ALLOW_LOAD="allowload",this.BUFFER_EMPTY="bufferStalled",this.BUFFER_STATE="BufferState",this.DVR_INFO="DVRInfo",this.DROPPED_FRAMES="DroppedFrames",this.SCHEDULING_INFO="SchedulingInfo",this.REQUESTS_QUEUE="RequestsQueue",this.MANIFEST_UPDATE="ManifestUpdate",this.MANIFEST_UPDATE_STREAM_INFO="ManifestUpdatePeriodInfo",this.MANIFEST_UPDATE_TRACK_INFO="ManifestUpdateRepresentationInfo",this.PLAY_LIST="PlayList",this.DVB_ERRORS="DVBErrors",this.HTTP_REQUEST_DVB_REPORTING_TYPE="DVBReporting"}}])&&r(t.prototype,n),e}())},"./src/streaming/constants/ProtectionConstants.js":(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,{default:()=>i});const i=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t,n;return t=e,(n=[{key:"init",value:function(){this.CLEARKEY_KEYSTEM_STRING="org.w3.clearkey",this.WIDEVINE_KEYSTEM_STRING="com.widevine.alpha",this.PLAYREADY_KEYSTEM_STRING="com.microsoft.playready",this.PLAYREADY_RECOMMENDATION_KEYSTEM_STRING="com.microsoft.playready.recommendation",this.INITIALIZATION_DATA_TYPE_CENC="cenc",this.INITIALIZATION_DATA_TYPE_KEYIDS="keyids",this.INITIALIZATION_DATA_TYPE_WEBM="webm"}}])&&r(t.prototype,n),e}())},"./src/streaming/controllers/AbrController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>_});var r=n("./src/streaming/rules/abr/ABRRulesCollection.js"),i=n("./src/streaming/constants/Constants.js"),o=n("./src/streaming/constants/MetricsConstants.js"),s=n("./src/streaming/vo/BitrateInfo.js"),a=n("./src/streaming/models/FragmentModel.js"),l=n("./src/core/EventBus.js"),c=n("./src/core/events/Events.js"),u=n("./src/core/FactoryMaker.js"),d=n("./src/streaming/rules/RulesContext.js"),p=n("./src/streaming/rules/SwitchRequest.js"),h=n("./src/streaming/rules/SwitchRequestHistory.js"),f=n("./src/streaming/rules/DroppedFramesHistory.js"),g=n("./src/streaming/rules/ThroughputHistory.js"),m=n("./src/core/Debug.js"),v=n("./src/streaming/vo/metrics/HTTPRequest.js"),y=n("./src/streaming/utils/SupervisorTools.js"),b=n("./src/streaming/MediaPlayerEvents.js");function x(){var e,t,n,u,x,E,_,w,S,T,k,C,A,j,I,O,N,R,P,D,M,L,B,F,U,H,G,q=this.context,V=(0,m.default)(q).getInstance(),z=(0,l.default)(q).getInstance();function W(){x={},E={},w={},_={},D={},B={},F={},U={},void 0===T&&(T=!1),M&&M.reset(),P=void 0,M=void 0,L=void 0,clearTimeout(S),S=null}function K(t){var r=t.request.mediaType,i=t.streamId;if(r&&i&&_[i]&&G.get().streaming.abr.autoSwitchBitrate[r]){var s=_[i][r];if(s){var l=(0,d.default)(q).create({abrController:e,streamProcessor:s,currentRequest:t.request,useBufferOccupancyABR:B[r],useL2AABR:F[r],useLoLPABR:U[r],videoModel:j}),c=n.shouldAbandonFragment(l,i);c.quality>p.default.NO_CHANGE&&s.getFragmentModel().getRequests({state:a.default.FRAGMENT_MODEL_LOADING,index:t.request.index})[0]&&(w[i][r].state=o.default.ABANDON_LOAD,D[i][r].reset(),D[i][r].push({oldValue:Q(r,i),newValue:c.quality,confidence:1,reason:c.reason}),Z(r,u.getActiveStreamInfo(),c.quality,c.reason),clearTimeout(S),S=setTimeout((function(){w[i][r].state=o.default.ALLOW_LOAD,S=null}),G.get().streaming.abandonLoadTimeout))}}}function $(e){e.mediaType===i.default.VIDEO&&(void 0!==P&&M.push(e.streamId,P,j.getPlaybackQuality()),P=e.newQuality)}function Y(e){var n,r;e.metric!==o.default.HTTP_REQUEST||!e.value||e.value.type!==v.HTTPRequest.MEDIA_SEGMENT_TYPE||e.mediaType!==i.default.AUDIO&&e.mediaType!==i.default.VIDEO||L.push(e.mediaType,e.value,G.get().streaming.abr.useDeadTimeLatency),e.metric!==o.default.BUFFER_LEVEL||e.mediaType!==i.default.AUDIO&&e.mediaType!==i.default.VIDEO||(n=e.mediaType,r=.001*e.value.level,G.get().streaming.abr.ABRStrategy===i.default.ABR_STRATEGY_DYNAMIC&&function(e,n){try{var r=I.getStableBufferTime(),i=r,o=.5*r,s=B[e],a=n>(s?o:i);B[e]=a,a!==s&&(a?t.info("["+e+"] switching from throughput to buffer occupancy ABR rule (buffer: "+n.toFixed(3)+")."):t.info("["+e+"] switching from buffer occupancy to throughput ABR rule (buffer: "+n.toFixed(3)+")."))}catch(e){t.error(e)}}(n,r))}function X(e,n){try{var r;return x[n]=x[n]||{},x[n].hasOwnProperty(e)||(x[n][e]=0),r=function(e,t,n){if(t!==i.default.VIDEO||!G.get().streaming.abr.limitBitrateByPortal||!_[n]||!_[n][t])return e;T||ie();var r=_[n][t].getStreamInfo(),o=A.getAdaptationForType(r.index,t,r).Representation_asArray,s=e;if(k>0&&C>0){for(;s>0&&o[s]&&k<o[s].width&&k-o[s-1].width<o[s].width-k;)s-=1;for(;s<o.length-1&&o[s].width===o[s+1].width;)s+=1}return s}(r=function(e,t,n){var r=x[n][t],i=G.get().streaming.abr.maxRepresentationRatio[t];return isNaN(i)||i>=1||i<0?e:Math.min(e,Math.round(r*i))}(r=function(e,t){var n=x[t][e],r=n;if(!_[t]||!_[t][e])return r;var i=J(e,t);void 0!==i&&(r=Math.max(n,i));var o=function(e,t){try{var n=I.getAbrBitrateParameter("maxBitrate",e);return n>-1?ne(_[t][e].getMediaInfo(),n,t):void 0}catch(e){return}}(e,t);return void 0!==o&&(r=Math.min(r,o)),r}(e,n),e,n),e,n),G.get().streaming.cmsd.enabled&&G.get().streaming.cmsd.abr.applyMb&&(r=function(e,n,r){if("video"!==n)return e;var i=N.getMaxBitrate(n);if(i<0)return e;var o=te(r,"audio",Q("audio",r));i-=o?o.bitrate/1e3:0;var s=ne(_[r][n].getMediaInfo(),i,r);return t.debug("Stream ID: "+r+" ["+n+"] Apply max bit rate from CMSD: "+i),Math.min(e,s)}(r,e,n)),r}catch(e){return}}function J(e,t){try{return function(e,t){try{var n=I.getAbrBitrateParameter("minBitrate",e);if(n>-1){var r=_[t][e].getMediaInfo(),i=re(r),o=ne(r,n,t);return i[o]&&o<i.length-1&&i[o].bitrate<1e3*n&&o++,o}return}catch(e){return}}(e,t)}catch(e){return}}function Q(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{return t||(t=u.getActiveStreamInfo().id),e&&_[t]&&_[t][e]&&t?(E[t]=E[t]||{},E[t].hasOwnProperty(e)||(E[t][e]=0),E[t][e]):0}catch(e){return 0}}function Z(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(t&&t.id&&e){var i=t.id,o=Q(e,i);(0,y.checkInteger)(n);var s=X(e,i);n!==o&&n>=0&&n<=s&&ee(e,o,n,s,r,i)}}function ee(e,n,r,i,o,s){if(e&&_[s]&&_[s][e]){var a=_[s][e].getStreamInfo(),l=a&&a.manifestInfo&&a.manifestInfo.isDynamic,u=H.getCurrentBufferLevel(e);t.info("Stream ID: "+s+" ["+e+"] switch from "+n+" to "+r+"/"+i+" (buffer: "+u+") "+(o?JSON.stringify(o):".")),E[s]=E[s]||{},E[s][e]=r;var d=te(s,e,r);z.trigger(c.default.QUALITY_CHANGE_REQUESTED,{oldQuality:n,newQuality:r,reason:o,streamInfo:a,bitrateInfo:d,maxIdx:i,mediaType:e},{streamId:a.id,mediaType:e});var p=L.getAverageThroughput(e,l);isNaN(p)||R.setSavedBitrateSettings(e,p)}}function te(e,t,n){if(t&&_&&_[e]&&_[e][t]){var r=re(_[e][t].getMediaInfo());return r[n]?r[n]:null}return null}function ne(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=e&&e.type?_[n][e.type].getRepresentationInfo():null;if(G.get().streaming.abr.useDeadTimeLatency&&r&&i&&i.fragmentDuration){r/=1e3;var o=i.fragmentDuration;if(r>o)return 0;t*=1-r/o}for(var s=re(e),a=s.length-1;a>=0;a--)if(1e3*t>=s[a].bitrate)return a;return 0}function re(e){var t=[];if(!e||!e.bitrateList)return t;for(var n,r=e.bitrateList,i=e.type,o=0,a=r.length;o<a;o++)(n=new s.default).mediaType=i,n.qualityIndex=o,n.bitrate=r[o].bandwidth,n.width=r[o].width,n.height=r[o].height,n.scanType=r[o].scanType,t.push(n);return t}function ie(){if(j){var e=G.get().streaming.abr.usePixelRatioInLimitBitrateByPortal&&window.hasOwnProperty("devicePixelRatio")?window.devicePixelRatio:1;k=j.getClientWidth()*e,C=j.getClientHeight()*e}}return e={initialize:function(){M=(0,f.default)(q).create(),L=(0,g.default)(q).create({settings:G}),(n=(0,r.default)(q).create({dashMetrics:H,customParametersModel:O,mediaPlayerModel:I,settings:G})).initialize(),z.on(b.default.QUALITY_CHANGE_RENDERED,$,e),z.on(b.default.METRIC_ADDED,Y,e),z.on(c.default.LOADING_PROGRESS,K,e)},isPlayingAtTopQuality:function(e){var t=e?e.id:null,n=Q(i.default.AUDIO,t),r=Q(i.default.VIDEO,t);return n===X(i.default.AUDIO,t)&&r===X(i.default.VIDEO,t)},updateTopQualityIndex:function(e){var t=e.type,n=e.streamInfo.id,r=e.representationCount-1;return x[n]=x[n]||{},x[n][t]=r,r},clearDataForStream:function(e){M&&M.clearForStream(e),_[e]&&delete _[e],D[e]&&delete D[e],w[e]&&delete w[e]},getThroughputHistory:function(){return L},getBitrateList:re,getQualityForBitrate:ne,getTopBitrateInfoFor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t||(t=u.getActiveStreamInfo().id),e&&_&&_[t]&&_[t][e]){var n=X(e,t),r=re(_[t][e].getMediaInfo());return r[n]?r[n]:null}return null},getMinAllowedIndexFor:J,getMaxAllowedIndexFor:X,getInitialBitrateFor:function(e,t){if(function(){if(!R||!R.hasOwnProperty("getSavedBitrateSettings"))throw new Error(i.default.MISSING_CONFIG_ERROR)}(),e===i.default.TEXT)return NaN;var n=R.getSavedBitrateSettings(e),r=I.getAbrBitrateParameter("initialBitrate",e),o=G.get().streaming.abr.initialRepresentationRatio[e];if(-1===r)if(o>-1){var s=_[t][e].getStreamInfo(),a=A.getAdaptationForType(s.index,e,s).Representation_asArray;r=Array.isArray(a)?a[Math.max(Math.round(a.length*o)-1,0)].bandwidth/1e3:0}else r=isNaN(n)?e===i.default.VIDEO?1e3:100:n;return r},getQualityFor:Q,getAbandonmentStateFor:function(e,t){return w[e]&&w[e][t]?w[e][t].state:null},setPlaybackQuality:Z,checkPlaybackQuality:function(t,r){try{if(!(t&&_&&_[r]&&_[r][t]))return!1;if(M){var i=j.getPlaybackQuality();i&&M.push(r,P,i)}if(!G.get().streaming.abr.autoSwitchBitrate[t])return!1;var s=Q(t,r),a=(0,d.default)(q).create({abrController:e,switchHistory:D[r][t],droppedFramesHistory:M,streamProcessor:_[r][t],currentValue:s,useBufferOccupancyABR:B[t],useL2AABR:F[t],useLoLPABR:U[t],videoModel:j}),l=J(t,r),c=X(t,r),u=n.getMaxQuality(a),h=u.quality;return void 0!==l&&(h>p.default.NO_CHANGE?h:s)<l&&(h=l),h>c&&(h=c),D[r][t].push({oldValue:s,newValue:h}),h>p.default.NO_CHANGE&&h!==s&&(w[r][t].state===o.default.ALLOW_LOAD||h<s)&&(ee(t,s,h,c,u.reason,r),!0)}catch(e){return!1}},setElementSize:ie,setWindowResizeEventCalled:function(e){T=e},registerStreamType:function(e,t){var n=t.getStreamInfo().id;_[n]||(_[n]={}),D[n]||(D[n]={}),w[n]||(w[n]={}),D[n][e]=(0,h.default)(q).create(),_[n][e]=t,w[n][e]={},w[n][e].state=o.default.ALLOW_LOAD,function(e){var t=G.get().streaming.abr.ABRStrategy;t===i.default.ABR_STRATEGY_L2A?(B[e]=!1,U[e]=!1,F[e]=!0):t===i.default.ABR_STRATEGY_LoLP?(B[e]=!1,U[e]=!0,F[e]=!1):t===i.default.ABR_STRATEGY_BOLA?(B[e]=!0,U[e]=!1,F[e]=!1):t===i.default.ABR_STRATEGY_THROUGHPUT?(B[e]=!1,U[e]=!1,F[e]=!1):t===i.default.ABR_STRATEGY_DYNAMIC&&(B[e]=!(!B||!B[e])&&B[e],U[e]=!1,F[e]=!1)}(e),e===i.default.VIDEO&&ie()},unRegisterStreamType:function(e,t){try{_[e]&&_[e][t]&&delete _[e][t],D[e]&&D[e][t]&&delete D[e][t],w[e]&&w[e][t]&&delete w[e][t]}catch(e){}},setConfig:function(e){e&&(e.streamController&&(u=e.streamController),e.domStorage&&(R=e.domStorage),e.mediaPlayerModel&&(I=e.mediaPlayerModel),e.customParametersModel&&(O=e.customParametersModel),e.cmsdModel&&(N=e.cmsdModel),e.dashMetrics&&(H=e.dashMetrics),e.adapter&&(A=e.adapter),e.videoModel&&(j=e.videoModel),e.settings&&(G=e.settings))},reset:function(){W(),z.off(c.default.LOADING_PROGRESS,K,e),z.off(b.default.QUALITY_CHANGE_RENDERED,$,e),z.off(b.default.METRIC_ADDED,Y,e),n&&n.reset()}},t=V.getLogger(e),W(),e}x.__dashjs_factory_name="AbrController";var E=u.default.getSingletonFactory(x);E.QUALITY_DEFAULT=0,u.default.updateSingletonFactory(x.__dashjs_factory_name,E);const _=E},"./src/streaming/controllers/BaseURLController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var r=n("./src/streaming/models/BaseURLTreeModel.js"),i=n("./src/streaming/utils/BaseURLSelector.js"),o=n("./src/streaming/utils/URLUtils.js"),s=n("./src/dash/vo/BaseURL.js"),a=n("./src/core/FactoryMaker.js"),l=n("./src/core/EventBus.js"),c=n("./src/core/events/Events.js");function u(){var e,t,n,a,u=this.context,d=(0,l.default)(u).getInstance(),p=(0,o.default)(u).getInstance();return e={reset:function(){n.reset(),a.reset()},initialize:function(e){var r;n.setConfig({adapter:t}),r=e,n.update(r),a.chooseSelector(t.getIsDVB(r))},resolve:function(e){var t=n.getForPath(e).reduce((function(e,t){var n=a.select(t);return n?(p.isRelative(n.url)?e.url=p.resolve(n.url,e.url):(e.url=n.url,e.serviceLocation=n.serviceLocation),e.availabilityTimeOffset=n.availabilityTimeOffset,e.availabilityTimeComplete=n.availabilityTimeComplete,e):new s.default}),new s.default);if(!p.isRelative(t.url))return t},setConfig:function(e){e.baseURLTreeModel&&(n=e.baseURLTreeModel),e.baseURLSelector&&(a=e.baseURLSelector),e.adapter&&(t=e.adapter)}},n=(0,r.default)(u).create(),a=(0,i.default)(u).create(),d.on(c.default.SERVICE_LOCATION_BLACKLIST_CHANGED,(function(e){n.invalidateSelectedIndexes(e.entry)}),e),e}u.__dashjs_factory_name="BaseURLController";const d=a.default.getClassFactory(u)},"./src/streaming/controllers/BlacklistController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/core/FactoryMaker.js"),i=n("./src/core/EventBus.js");function o(e){var t;e=e||{};var n=[],r=(0,i.default)(this.context).getInstance(),o=e.updateEventName,s=e.addBlacklistEventName;function a(e){-1===n.indexOf(e)&&(n.push(e),r.trigger(o,{entry:e}))}return t={add:a,contains:function(e){return!!(n.length&&e&&e.length)&&-1!==n.indexOf(e)},reset:function(){n=[]}},s&&r.on(s,(function(e){a(e.entry)}),t),t}o.__dashjs_factory_name="BlackListController";const s=r.default.getClassFactory(o)},"./src/streaming/controllers/BufferController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>x});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/streaming/constants/MetricsConstants.js"),o=n("./src/streaming/models/FragmentModel.js"),s=n("./src/streaming/SourceBufferSink.js"),a=n("./src/streaming/PreBufferSink.js"),l=n("./src/core/EventBus.js"),c=n("./src/core/events/Events.js"),u=n("./src/core/FactoryMaker.js"),d=n("./src/core/Debug.js"),p=n("./src/streaming/utils/InitCache.js"),h=n("./src/streaming/vo/DashJSError.js"),f=n("./src/core/errors/Errors.js"),g=n("./src/streaming/vo/metrics/HTTPRequest.js"),m=n("./src/streaming/MediaPlayerEvents.js"),v=.01,y="BufferController";function b(e){e=e||{};var t,n,u,b,x,E,_,w,S,T,k,C,A,j,I,O,N,R,P,D,M=this.context,L=(0,l.default)(M).getInstance(),B=e.errHandler,F=e.fragmentModel,U=e.representationController,H=e.adapter,G=e.textController,q=e.abrController,V=e.playbackController,z=e.streamInfo,W=e.type,K=e.settings;function $(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(n,r){E=e,S&&t&&"function"==typeof S.discharge?(T=S,X(t).then((function(){n()})).catch((function(e){r(e)}))):n()}))}function Y(e){return H.convertRepresentationToRepresentationInfo(U.getRepresentationForQuality(e))}function X(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return new Promise((function(i,o){N&&e?E?function(e,t){return new Promise((function(i,o){var a=q.getQualityFor(W,z.id);S=(0,s.default)(M).create({mediaSource:E,textController:G,eventBus:L}),function(e,t,n){var i=Y(n);return t&&t[W]&&(W===r.default.VIDEO||W===r.default.AUDIO)?S.initializeForStreamSwitch(e,i,t[W]):S.initializeForFirstUse(z,e,i)}(e,t,a).then((function(){return ve(Y(a))})).then((function(){i(S)})).catch((function(e){n.fatal("Caught error on create SourceBuffer: "+e),B.error(new h.default(f.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,f.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+W)),o(e)}))}))}(e,t).then((function(e){i(e)})).catch((function(e){o(e)})):function(){var e=this;return new Promise((function(t,n){var r=q.getQualityFor(W,z.id);S=(0,a.default)(M).create(te.bind(e)),ve(Y(r)).then((function(){t(S)})).catch((function(){n()}))}))}().then((function(e){i(e)})).catch((function(e){o(e)})):i(null)}))}function J(e){K.get().streaming.cacheInitSegments&&(n.info("Init fragment finished loading saving to",W+"'s init cache"),N.save(e.chunk)),n.debug("Append Init fragment",W," with representationId:",e.chunk.representationId," and quality:",e.chunk.quality,", data size:",e.chunk.bytes.byteLength),Z(e.chunk)}function Q(e){Z(e.chunk,e.request)}function Z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;S.append(e,t).then((function(e){te(e)})).catch((function(e){te(e)})),e.mediaInfo.type===r.default.VIDEO&&Te(c.default.VIDEO_CHUNK_RECEIVED,{chunk:e})}function ee(e){if(e&&e.length>0)for(var t=0,r=e.length;t<r;t++)n.debug("Buffered range: "+e.start(t)+" - "+e.end(t)+", currentTime = ",V.getTime())}function te(e){if(e.error)return 22===e.error.code&&function(){if(O=!0,x=.8*_e(),n.warn("Quota exceeded, Critical Buffer: "+x),x>0){var e=Math.max(.2*x,1),t=x-e,r=Math.min(K.get().streaming.buffer.bufferTimeAtTopQuality,.9*t),i=Math.min(K.get().streaming.buffer.bufferTimeAtTopQualityLongForm,.9*t),o={streaming:{buffer:{bufferToKeep:parseFloat(e.toFixed(5)),bufferTimeAtTopQuality:parseFloat(r.toFixed(5)),bufferTimeAtTopQualityLongForm:parseFloat(i.toFixed(5))}}};K.update(o)}}(),void(22!==e.error.code&&Se()||(n.warn("Clearing playback buffer to overcome quota exceed situation"),Te(c.default.QUOTA_EXCEEDED,{criticalBufferLevel:x,quotaExceededTime:e.chunk.start}),fe(he())));if(S&&(le(),O=!1,(A=e.chunk)&&A.endFragment)){A&&!isNaN(A.index)&&(_=Math.max(A.index,_),ce());var t=S.getAllBufferRanges();A.segmentType===g.HTTPRequest.MEDIA_SEGMENT_TYPE&&(ee(t),ie(),function(){if(!isNaN(D))if(W===r.default.AUDIO||W===r.default.VIDEO){var e=V.getTime(),t=ae(e,0),n=ae(D,0);if(t&&n&&t.start===n.start)D=NaN;else{var i=U.getCurrentRepresentation().segmentDuration,o=ae(D,i);o&&(K.get().streaming.buffer.enableSeekDecorrelationFix&&Math.abs(e-D)>i?D<=o.end&&V.seek(Math.max(D,o.start),!1,!0):e<o.start&&V.seek(o.start,!1,!0))}}else D=NaN}());var i=!1;k&&(k.indexOf(A)>0&&(i=!0),k=null),A&&!i&&Te(c.default.BYTES_APPENDED_END_FRAGMENT,{quality:A.quality,startTime:A.start,index:A.index,bufferedRanges:t,segmentType:A.segmentType,mediaType:W})}}function ne(){return new Promise((function(e,t){var n=re();if(!n||0===n.length)return ie(),void e();fe(n).then((function(){e()})).catch((function(e){t(e)}))}))}function re(e){var t=[],r=S.getAllBufferRanges();if(!r||0===r.length)return t;if(!e&&0!==e||isNaN(e))t.push({start:r.start(0),end:r.end(r.length-1)+.5});else{var i=function(e,t){var n=K.get().streaming.buffer.bufferToKeep,r=t.start(0);if(e-r>n){var i=Math.max(0,e-n),s=F.getRequests({state:o.default.FRAGMENT_MODEL_EXECUTED,time:e,threshold:v})[0];if(s&&(i=Math.min(s.startTime,i)),i>0)return{start:r,end:i}}return null}(e,r),s=function(e,t){var r=t.end(t.length-1)+.5,i=we(e),s=z.manifestInfo.duration>=K.get().streaming.buffer.longFormContentDurationThreshold?K.get().streaming.buffer.bufferTimeAtTopQualityLongForm:K.get().streaming.buffer.bufferTimeAtTopQuality,a=isNaN(i)?e:Math.min(i,e+s);if(a>=t.end(t.length-1))return null;var l=F.getRequests({state:o.default.FRAGMENT_MODEL_EXECUTED,time:e,threshold:v})[0];if(l&&(a=Math.max(l.startTime+l.duration,a)),K.get().streaming.buffer.avoidCurrentTimeRangePruning)for(var c=0;c<t.length;c++)if(t.start(c)<=e&&e<=t.end(c)&&t.start(c)<=a&&a<=t.end(c)){var u=a;a=c+1<t.length?t.start(c+1):t.end(c)+1,n.debug("Buffered range ["+t.start(c)+", "+t.end(c)+"] overlaps with targetTime "+e+" and range to be pruned ["+u+", "+r+"], using ["+a+", "+r+"] instead"+(a<r?"":" (no actual pruning)"));break}return a<t.end(t.length-1)?{start:a,end:r}:null}(e,r);i&&t.push(i),s&&t.push(s)}return t}function ie(){(!P||W===r.default.TEXT&&G.isTextEnabled())&&le()}function oe(){ue()}function se(){ue(),D=NaN}function ae(e,t){var n,r,i=S.getAllBufferRanges(),o=0,s=0,a=null,l=null,c=0,u=isNaN(t)?.15:t;if(null!=i){for(r=0,n=i.length;r<n;r++)if(o=i.start(r),s=i.end(r),null===a)c=Math.abs(o-e),(e>=o&&e<s||c<=u)&&(a=o,l=s);else{if(!((c=o-l)<=u))break;l=s}if(null!==a)return{start:a,end:l}}return null}function le(){if(V){var e=K.get().streaming.gaps.jumpGaps&&!isNaN(K.get().streaming.gaps.smallGapLimit)?K.get().streaming.gaps.smallGapLimit:NaN;b=Math.max(function(e,t){var n;return K.get().streaming.gaps.jumpGaps&&(t=K.get().streaming.gaps.smallGapLimit),null===(n=ae(e,t))?0:n.end-e}(V.getTime()||0,e),0),Te(c.default.BUFFER_LEVEL_UPDATED,{mediaType:W,bufferLevel:b}),ue()}}function ce(){var e=_>=w-1,t=V.getTimeToStreamEnd(z)-b<1e-5;!e&&!t||u||(Ee(!0),n.debug("checkIfBufferingCompleted trigger BUFFERING_COMPLETED for stream id ".concat(z.id," and type ").concat(W)))}function ue(){W!==r.default.AUDIO&&W!==r.default.VIDEO||((!V.getLowLatencyModeEnabled()&&b<K.get().streaming.buffer.stallThreshold||0===b)&&!u?de(i.default.BUFFER_EMPTY):(u||b>=K.get().streaming.buffer.stallThreshold||V.getLowLatencyModeEnabled()&&b>0)&&de(i.default.BUFFER_LOADED))}function de(e){C===e||e===i.default.BUFFER_EMPTY&&0===V.getTime()||W===r.default.TEXT&&!G.isTextEnabled()||(C=e,Te(c.default.BUFFER_LEVEL_STATE_CHANGED,{state:e}),Te(e===i.default.BUFFER_LOADED?c.default.BUFFER_LOADED:c.default.BUFFER_EMPTY),n.debug(e===i.default.BUFFER_LOADED?"Got enough buffer to start":"Waiting for more buffer before starting playback"))}function pe(){S&&W!==r.default.TEXT&&(u||fe(he()))}function he(){var e=[],t=S.getAllBufferRanges();if(!t||0===t.length)return e;var n=V.getTime(),r=Math.max(0,n-K.get().streaming.buffer.bufferToKeep),i=F.getRequests({state:o.default.FRAGMENT_MODEL_EXECUTED,time:n,threshold:v})[0];if(i)r=Math.min(i.startTime,r);else if(0===n&&V.getIsDynamic())return[];if(t.start(0)<=r){for(var s={start:0,end:r},a=0;a<t.length&&t.end(a)<=r;a++)s.end=t.end(a);s.start<s.end&&e.push(s)}return e}function fe(e){return new Promise((function(t,n){if(e&&S&&0!==e.length){var r=[];e.forEach((function(e){r.push(function(e){return new Promise((function(t,n){e.resolve=t,e.reject=n,R.push(e)}))}(e))})),I||ge(),Promise.all(r).then((function(){t()})).catch((function(e){n(e)}))}else t()}))}function ge(){try{if(0===R.length||!S)return n.debug("Nothing to prune, halt pruning"),R=[],void(I=!1);var e=S.getBuffer();if(!e||!e.buffered||0===e.buffered.length)return n.debug("SourceBuffer is empty (or does not exist), halt pruning"),R=[],void(I=!1);var t=R.shift();n.debug("".concat(W,": Removing buffer from: ").concat(t.start," to ").concat(t.end)),I=!0,V.getTime()<t.end&&Ee(!1),S.remove(t).then((function(e){me(e)})).catch((function(e){me(e)}))}catch(e){I=!1}}function me(e){n.debug("onRemoved buffer from:",e.from,"to",e.to),ee(S.getAllBufferRanges()),0===R.length&&(I=!1,le()),e.unintended&&(n.warn("Detected unintended removal from:",e.from,"to",e.to,"setting streamprocessor time to",e.from),Te(c.default.SEEK_TARGET,{time:e.from})),I?ge():(P?P=!1:le(),Te(c.default.BUFFER_CLEARED,{from:e.from,to:e.to,unintended:e.unintended,hasEnoughSpaceToAppend:Se(),quotaExceeded:O}))}function ve(e){return new Promise((function(t){e&&void 0!==e.MSETimeOffset&&S&&S.updateTimestampOffset?S.updateTimestampOffset(e.MSETimeOffset).then((function(){t()})).catch((function(){t()})):t()}))}function ye(){return S&&!u?S.updateAppendWindow(z):Promise.resolve()}function be(){++j*(K.get().streaming.wallclockTimeUpdateInterval/1e3)>=K.get().streaming.buffer.bufferPruningInterval&&(j=0,pe())}function xe(){ue()}function Ee(e){u!==e&&((u=e)?Te(c.default.BUFFERING_COMPLETED):w=Number.POSITIVE_INFINITY)}function _e(){try{var e,t,n=S.getAllBufferRanges(),r=0;if(!n)return r;for(t=0,e=n.length;t<e;t++)r+=n.end(t)-n.start(t);return r}catch(e){return 0}}function we(e){try{var t=e,n=S.getAllBufferRanges();if(!n||0===n.length)return NaN;for(var r=0;t===e&&r<n.length;){var i=n.start(r),o=n.end(r);t>=i&&t<=o&&(t=o),r+=1}return t===e?NaN:t}catch(e){}}function Se(){var e=_e();return isNaN(e)||e<x}function Te(e,t){var n=t||{};L.trigger(e,n,{streamId:z.id,mediaType:W})}function ke(e,t){if(x=Number.POSITIVE_INFINITY,C=void 0,w=Number.POSITIVE_INFINITY,_=0,A=null,u=!1,I=!1,O=!1,b=0,j=0,R=[],D=NaN,S){var n=S;S=null,e||t||n.abort().then((function(){n.reset(t),n=null}))}P=!1}return t={initialize:function(e){$(e),L.on(c.default.INIT_FRAGMENT_LOADED,J,t),L.on(c.default.MEDIA_FRAGMENT_LOADED,Q,t),L.on(c.default.WALLCLOCK_TIME_UPDATED,be,t),L.on(m.default.PLAYBACK_PLAYING,se,t),L.on(m.default.PLAYBACK_PROGRESS,ie,t),L.on(m.default.PLAYBACK_TIME_UPDATED,ie,t),L.on(m.default.PLAYBACK_RATE_CHANGED,xe,t),L.on(m.default.PLAYBACK_STALLED,oe,t)},getStreamId:function(){return z.id},getType:function(){return W},getBufferControllerType:function(){return y},createBufferSink:X,dischargePreBuffer:function(){if(S&&T&&"function"==typeof T.discharge){var e=T.getAllBufferRanges();if(e.length>0){for(var t="Beginning "+W+"PreBuffer discharge, adding buffer for:",r=0;r<e.length;r++)t+=" start: "+e.start(r)+", end: "+e.end(r)+";";n.debug(t)}else n.debug("PreBuffer discharge requested, but there were no media segments in the PreBuffer.");k=[];for(var i=T.discharge(),o=null,s=0;s<i.length;s++){var a=i[s];if(a.segmentType!==g.HTTPRequest.INIT_SEGMENT_TYPE){var l=N.extract(a.streamId,a.representationId);l&&o!==l&&(k.push(l),S.append(l),o=l)}k.push(a),S.append(a)}T.reset(),T=null}},getBuffer:function(){return S},getBufferLevel:function(){return b},getRangeAt:ae,hasBufferAtTime:function(e){try{var t=S.getAllBufferRanges();if(!t||0===t.length)return!1;for(var r=0;r<t.length;){var i=t.start(r),o=t.end(r);if(e>=i&&e<=o)return!0;r+=1}return!1}catch(e){return n.error(e),!1}},pruneBuffer:pe,setMediaSource:$,getMediaSource:function(){return E},appendInitSegmentFromCache:function(e){var t=N.extract(z.id,e);return!!t&&(n.info("Append Init fragment",W," with representationId:",t.representationId," and quality:",t.quality,", data size:",t.bytes.byteLength),Z(t),!0)},getIsBufferingCompleted:function(){return u},setIsBufferingCompleted:Ee,getIsPruningInProgress:function(){return I},reset:function(e,t){L.off(c.default.INIT_FRAGMENT_LOADED,J,this),L.off(c.default.MEDIA_FRAGMENT_LOADED,Q,this),L.off(c.default.WALLCLOCK_TIME_UPDATED,be,this),L.off(m.default.PLAYBACK_PLAYING,se,this),L.off(m.default.PLAYBACK_PROGRESS,ie,this),L.off(m.default.PLAYBACK_TIME_UPDATED,ie,this),L.off(m.default.PLAYBACK_RATE_CHANGED,xe,this),L.off(m.default.PLAYBACK_STALLED,oe,this),ke(e,t)},prepareForPlaybackSeek:function(){return u&&Ee(!1),S.abort()},prepareForReplacementTrackSwitch:function(e){return new Promise((function(t,n){S.abort().then((function(){return ye()})).then((function(){return K.get().streaming.buffer.useChangeTypeForTrackSwitch?S.changeType(e):Promise.resolve()})).then((function(){return ne()})).then((function(){Ee(!1),t()})).catch((function(e){n(e)}))}))},prepareForNonReplacementTrackSwitch:function(e){return new Promise((function(t,n){ye().then((function(){return K.get().streaming.buffer.useChangeTypeForTrackSwitch?S.changeType(e):Promise.resolve()})).then((function(){t()})).catch((function(e){n(e)}))}))},prepareForReplacementQualitySwitch:function(){return new Promise((function(e,t){S.abort().then((function(){return ye()})).then((function(){return ne()})).then((function(){Ee(!1),e()})).catch((function(e){t(e)}))}))},updateAppendWindow:ye,getAllRangesWithSafetyFactor:re,getContinuousBufferTimeForTargetTime:we,clearBuffers:fe,pruneAllSafely:ne,updateBufferTimestampOffset:ve,setSeekTarget:function(e){D=e},segmentRequestingCompleted:function(e){isNaN(e)||(w=e,ce())}},n=(0,d.default)(M).getInstance().getLogger(t),N=(0,p.default)(M).getInstance(),ke(),t}b.__dashjs_factory_name=y;const x=u.default.getClassFactory(b)},"./src/streaming/controllers/CatchupController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});var r=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js"),o=n("./src/core/EventBus.js"),s=n("./src/streaming/constants/Constants.js"),a=n("./src/streaming/MediaPlayerEvents.js"),l=n("./src/core/events/Events.js"),c=n("./src/streaming/constants/MetricsConstants.js"),u=n("./src/core/Utils.js");function d(){var e,t,n,r,d,p,h,f,g,m,v=this.context,y=(0,o.default)(v).getInstance();function b(){t=!1;var e=u.default.parseUserAgent();n=e&&e.browser&&e.browser.name&&"safari"===e.browser.name.toLowerCase()}function x(){t=!1}function E(e){if(e.streamId===p.getActiveStreamInfo().id&&g){var t=h.getLiveDelay();h.getBufferLevel()>t/2&&(g=!1)}}function _(e){e.streamId===p.getActiveStreamInfo().id&&(g=e.state===c.default.BUFFER_EMPTY)}function w(){f.getCatchupModeEnabled()||r.setPlaybackRate(1)}function S(){h.getIsDynamic()&&f.getCatchupModeEnabled()&&(f.getCatchupPlaybackRates().max>0||f.getCatchupPlaybackRates().min<0)&&!h.isPaused()&&!h.isSeeking()&&function(){try{return!(!h.getTime()>0||t)&&(k()===s.default.LIVE_CATCHUP_MODE_LOLP?function(e,t){try{return Math.abs(T())>0||e<t}catch(e){return!1}}(h.getBufferLevel(),d.get().streaming.liveCatchup.playbackBufferMin):function(){try{return Math.abs(T())>0}catch(e){return!1}}())}catch(e){return!1}}()&&function(){if(!t&&r){var e,i=r.getPlaybackRate(),o=f.getCatchupPlaybackRates(),a=h.getBufferLevel(),l=T(),c=f.getCatchupMaxDrift();if(!isNaN(c)&&c>0&&l>c)m.info("[CatchupController]: Low Latency catchup mechanism. Latency too high, doing a seek to live point"),t=!0,h.seekToCurrentLive(!0,!1);else{var u=h.getCurrentLiveLatency(),p=h.getLiveDelay();e=k()===s.default.LIVE_CATCHUP_MODE_LOLP?function(e,t,n,r,i){var o;if(i<r){var s=Math.abs(e.min),a=5*(i-r);o=1-s+2*s/(1+Math.pow(Math.E,-a)),m.debug("[LoL+ playback control_buffer-based] bufferLevel: "+i+", newRate: "+o)}else{var l=e.max;if(Math.abs(t-n)<=.02*n)o=1;else{var c=5*(t-n);o=1-l+2*l/(1+Math.pow(Math.E,-c))}m.debug("[LoL+ playback control_latency-based] latency: "+t+", newRate: "+o)}return o}(o,u,p,d.get().streaming.liveCatchup.playbackBufferMin,a):function(e,t,n,r){if(g)return 1;var i=t-n,o=i<0?Math.abs(e.min):e.max,s=5*i,a=1-o+2*o/(1+Math.pow(Math.E,-s));return h.getPlaybackStalled()&&r<=n/2&&i>0&&(a=1),a}(o,u,p,a);var v=n?.25:.02/(.5/o.max);e&&Math.abs(i-e)>=v&&(m.debug("[CatchupController]: Setting playback rate to ".concat(e)),r.setPlaybackRate(e))}}}()}function T(){return h.getCurrentLiveLatency()-h.getLiveDelay()}function k(){var e=d.get().streaming.liveCatchup.playbackBufferMin;return d.get().streaming.liveCatchup.mode!==s.default.LIVE_CATCHUP_MODE_LOLP||null===e||isNaN(e)?s.default.LIVE_CATCHUP_MODE_DEFAULT:s.default.LIVE_CATCHUP_MODE_LOLP}function C(){f.getCatchupPlaybackRates(!0)}return e={reset:function(){y.off(a.default.BUFFER_LEVEL_UPDATED,E,e),y.off(a.default.BUFFER_LEVEL_STATE_CHANGED,_,e),y.off(a.default.PLAYBACK_PROGRESS,S,e),y.off(a.default.PLAYBACK_TIME_UPDATED,S,e),y.off(a.default.PLAYBACK_SEEKED,S,e),y.off(l.default.SETTING_UPDATED_CATCHUP_ENABLED,w,e),y.off(l.default.SETTING_UPDATED_PLAYBACK_RATE_MIN,C,e),y.off(l.default.SETTING_UPDATED_PLAYBACK_RATE_MAX,C,e),y.off(a.default.STREAM_INITIALIZED,C,e),b(),r.setPlaybackRate(1,!0)},setConfig:function(e){e&&(e.settings&&(d=e.settings),e.videoModel&&(r=e.videoModel),e.streamController&&(p=e.streamController),e.playbackController&&(h=e.playbackController),e.mediaPlayerModel&&(f=e.mediaPlayerModel))},initialize:function(){y.on(a.default.BUFFER_LEVEL_UPDATED,E,e),y.on(a.default.BUFFER_LEVEL_STATE_CHANGED,_,e),y.on(a.default.PLAYBACK_PROGRESS,S,e),y.on(a.default.PLAYBACK_TIME_UPDATED,S,e),y.on(a.default.PLAYBACK_SEEKED,x,e),y.on(l.default.SETTING_UPDATED_CATCHUP_ENABLED,w,e),y.on(l.default.SETTING_UPDATED_PLAYBACK_RATE_MIN,C,e),y.on(l.default.SETTING_UPDATED_PLAYBACK_RATE_MAX,C,e),y.on(a.default.STREAM_INITIALIZED,C,e),C()}},m=(0,i.default)(v).getInstance().getLogger(e),b(),e}d.__dashjs_factory_name="CatchupController";const p=r.default.getSingletonFactory(d)},"./src/streaming/controllers/EventController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var r=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js"),o=n("./src/core/EventBus.js"),s=n("./src/streaming/MediaPlayerEvents.js"),a=n("./src/streaming/net/XHRLoader.js");function l(){var e,t,n,r,l,c,u,d,p,h,f,g="urn:mpeg:dash:event:2012",m="discarded",v="updated",y="added",b=this.context,x=(0,o.default)(b).getInstance();function E(){if(!u||!d)throw new Error("setConfig function has to be called previously")}function _(){f=!1,n={},r={},l=null,h=!1,c=Date.now()/1e3}function w(){try{if(!h){h=!0;var e=d.getTime(),i=e-c;i=c>0?Math.max(0,i):0,S(r,i,e),S(n,i,e),T(r),T(n),c=e,h=!1}}catch(e){h=!1,t.error(e)}}function S(e,n,r){try{j(e,(function(i){if(void 0!==i){var o=isNaN(i.duration)?0:i.duration;i.calculatedPresentationTime<=r&&i.calculatedPresentationTime+n+o>=r?O(i,s.default.EVENT_MODE_ON_START):(I(r,o+n,i.calculatedPresentationTime)||function(e){try{var n=e.eventStream.period.start+e.eventStream.period.duration;return e.calculatedPresentationTime>n}catch(e){return t.error(e),!1}}(i))&&(t.debug("Removing event ".concat(i.id," from period ").concat(i.eventStream.period.id," as it is expired or invalid")),function(e,n){try{var r=n.eventStream.schemeIdUri,i=n.eventStream.period.id,o=n.eventStream.value,s=n.id;e[i][r]=e[i][r].filter((function(e){return o&&e.eventStream.value&&e.eventStream.value!==o||e.id!==s})),0===e[i][r].length&&delete e[i][r]}catch(e){t.error(e)}}(e,i))}}))}catch(e){t.error(e)}}function T(e){try{for(var n in e)e.hasOwnProperty(n)&&0===Object.keys(e[n]).length&&delete e[n]}catch(e){t.error(e)}}function k(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.eventStream.schemeIdUri,i=e.eventStream.value,o=e.id,s=m;t[r]||(t[r]=[]);var a=t[r].findIndex((function(e){return(!i||e.eventStream.value&&e.eventStream.value===i)&&e.id===o}));if(-1===a)t[r].push(e),e.triggeredReceivedEvent=!1,e.triggeredStartEvent=!1,s=y;else if(n){var l=t[r][a];e.triggeredReceivedEvent=l.triggeredReceivedEvent,e.triggeredStartEvent=l.triggeredStartEvent,t[r][a]=e,s=v}return s}function C(e){try{if(1==e.eventStream.value){var n,r=e.calculatedPresentationTime;n=4294967295==e.calculatedPresentationTime?NaN:e.calculatedPresentationTime+e.duration,x.trigger(s.default.MANIFEST_VALIDITY_CHANGED,{id:e.id,validUntil:r,newDuration:n,newManifestValidAfter:NaN},{mode:s.default.EVENT_MODE_ON_START})}}catch(e){t.error(e)}}function A(e){try{var n=d.getTime();j(e,(function(e){var t=e.eventStream&&e.eventStream.period&&!isNaN(e.eventStream.period.duration)?e.eventStream.period.duration:NaN,r=e.eventStream&&e.eventStream.period&&!isNaN(e.eventStream.period.start)?e.eventStream.period.start:NaN;if(!isNaN(t)&&!isNaN(r)){var i=e.calculatedPresentationTime;Math.abs(i-n)<300&&O(e,s.default.EVENT_MODE_ON_START)}}))}catch(e){t.error(e)}}function j(e,n){try{if(e)for(var r=Object.keys(e),i=0;i<r.length;i++)for(var o=e[r[i]],s=Object.keys(o),a=0;a<s.length;a++)o[s[a]].forEach((function(e){void 0!==e&&n(e)}))}catch(e){t.error(e)}}function I(e,n,r){try{return e-n>r}catch(e){return t.error(e),!1}}function O(e,n){try{var r=d.getTime(),i=e.id;if(n===s.default.EVENT_MODE_ON_RECEIVE&&!e.triggeredReceivedEvent)return t.debug("Received event ".concat(i)),e.triggeredReceivedEvent=!0,void x.trigger(e.eventStream.schemeIdUri,{event:e},{mode:n});e.triggeredStartEvent||(e.eventStream.schemeIdUri===g&&1==e.eventStream.value?0===e.duration&&0===e.presentationTimeDelta||(t.debug("Starting manifest refresh event ".concat(i," at ").concat(r)),function(){try{E(),u.refreshManifest()}catch(e){t.error(e)}}()):"urn:mpeg:dash:event:callback:2015"===e.eventStream.schemeIdUri&&1==e.eventStream.value?(t.debug("Starting callback event ".concat(i," at ").concat(r)),function(e){try{(0,a.default)(b).create({}).load({method:"get",url:e,request:{responseType:"arraybuffer"}})}catch(e){t.error(e)}}(e.messageData)):(t.debug("Starting event ".concat(i," from period ").concat(e.eventStream.period.id," at ").concat(r)),x.trigger(e.eventStream.schemeIdUri,{event:e},{mode:n})),e.triggeredStartEvent=!0)}catch(e){t.error(e)}}return e={addInlineEvents:function(e,r){try{if(E(),n[r]||(n[r]={}),e)for(var i=0;i<e.length;i++){var o=e[i];if(!I(d.getTime(),isNaN(o.duration)?0:o.duration,o.calculatedPresentationTime)){var a=k(o,n[r],!0);a===y?(t.debug("Added inline event with id ".concat(o.id," from period ").concat(r)),O(o,s.default.EVENT_MODE_ON_RECEIVE)):a===v&&t.debug("Updated inline event with id ".concat(o.id," from period ").concat(r))}}}catch(e){throw e}},addInbandEvents:function(e,n){try{E(),r[n]||(r[n]={});for(var i=0;i<e.length;i++){var o=e[i];I(d.getTime(),isNaN(o.duration)?0:o.duration,o.calculatedPresentationTime)||(k(o,r[n],!1)===y?(o.eventStream.schemeIdUri===g&&C(o),t.debug("Added inband event with id ".concat(o.id," from period ").concat(n)),O(o,s.default.EVENT_MODE_ON_RECEIVE)):t.debug("Inband event with scheme_id_uri ".concat(o.eventStream.schemeIdUri,", value ").concat(o.eventStream.value,", period id ").concat(n," and event id ").concat(o.id," was ignored because it has been added before.")))}w()}catch(e){throw e}},getInbandEvents:function(){return r},getInlineEvents:function(){return n},start:function(){try{E(),t.debug("Start Event Controller");var e=p.get().streaming.eventControllerRefreshDelay;f||isNaN(e)||(f=!0,l=setInterval(w,e))}catch(e){throw e}},setConfig:function(e){try{if(!e)return;e.manifestUpdater&&(u=e.manifestUpdater),e.playbackController&&(d=e.playbackController),e.settings&&(p=e.settings)}catch(e){throw e}},reset:function(){(function(){try{null!==l&&f&&(clearInterval(l),l=null,f=!1,function(){try{A(r),A(n)}catch(e){t.error(e)}}())}catch(e){throw e}})(),_()}},t=(0,i.default)(b).getInstance().getLogger(e),_(),e}l.__dashjs_factory_name="EventController";const c=r.default.getSingletonFactory(l)},"./src/streaming/controllers/FragmentController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/streaming/vo/DataChunk.js"),o=n("./src/streaming/models/FragmentModel.js"),s=n("./src/streaming/FragmentLoader.js"),a=n("./src/streaming/utils/RequestModifier.js"),l=n("./src/core/EventBus.js"),c=n("./src/core/events/Events.js"),u=n("./src/streaming/MediaPlayerEvents.js"),d=n("./src/core/errors/Errors.js"),p=n("./src/core/FactoryMaker.js"),h=n("./src/core/Debug.js"),f=n("./src/streaming/utils/SegmentResponseModifier.js");function g(e){e=e||{};var t,n,p,g=this.context,m=(0,l.default)(g).getInstance(),v=e.errHandler,y=e.mediaPlayerModel,b=e.dashMetrics,x=(0,h.default)(g).getInstance(),E=(0,f.default)(g).getInstance(),_=e.streamInfo;function w(){return _.id}function S(){for(var e in p)p[e].reset();p={}}function T(e){if(e.sender){var t=e.request,o=e.response,s=t.isInitializationRequest(),a=t.mediaInfo.streamInfo;if(e.error&&(t.mediaType===r.default.AUDIO||t.mediaType===r.default.VIDEO||t.mediaType===r.default.TEXT&&t.mediaInfo.isFragmented)&&m.trigger(c.default.SERVICE_LOCATION_BLACKLIST_ADD,{entry:e.request.serviceLocation}),o&&a){var l=function(e,t,n,r){var o=new i.default;return o.streamId=n,o.mediaInfo=t.mediaInfo,o.segmentType=t.type,o.start=t.startTime,o.duration=t.duration,o.end=o.start+o.duration,o.bytes=e,o.index=t.index,o.quality=t.quality,o.representationId=t.representationId,o.endFragment=r,o}(o,t,_.id,e.type!==c.default.FRAGMENT_LOADING_PROGRESS);E.modifyResponseAsync(l).then((function(e){m.trigger(s?c.default.INIT_FRAGMENT_LOADED:c.default.MEDIA_FRAGMENT_LOADED,{chunk:e,request:t},{streamId:a.id,mediaType:t.mediaType})})).catch((function(e){n.error(e),m.trigger(s?c.default.INIT_FRAGMENT_LOADED:c.default.MEDIA_FRAGMENT_LOADED,{chunk:l,request:t},{streamId:a.id,mediaType:t.mediaType})}))}else n.warn("No "+t.mediaType+" bytes to push or stream is inactive.")}}return t={getStreamId:w,getModel:function(t){var n=p[t];return n||(n=(0,o.default)(g).create({streamInfo:_,type:t,dashMetrics:b,fragmentLoader:(0,s.default)(g).create({dashMetrics:b,mediaPlayerModel:y,errHandler:v,requestModifier:(0,a.default)(g).getInstance(),settings:e.settings,boxParser:e.boxParser,eventBus:m,events:c.default,errors:d.default,dashConstants:e.dashConstants,urlUtils:e.urlUtils,streamId:w()}),debug:x,eventBus:m,events:c.default}),p[t]=n),n},reset:function(){m.off(u.default.FRAGMENT_LOADING_COMPLETED,T,this),m.off(u.default.FRAGMENT_LOADING_PROGRESS,T,this),S()}},n=x.getLogger(t),S(),m.on(u.default.FRAGMENT_LOADING_COMPLETED,T,t),m.on(u.default.FRAGMENT_LOADING_PROGRESS,T,t),t}g.__dashjs_factory_name="FragmentController";const m=p.default.getClassFactory(g)},"./src/streaming/controllers/GapController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var r=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js"),o=n("./src/core/events/Events.js"),s=n("./src/core/EventBus.js"),a=n("./src/streaming/constants/Constants.js");function l(){var e,t,n,r,l,c,u,d,p,h,f,g,m=this.context,v=(0,s.default)(m).getInstance();function y(){g.debug("Stopping the gap controller"),l&&(clearInterval(l),l=null),function(){v.off(o.default.WALLCLOCK_TIME_UPDATED,w,this),v.off(o.default.INITIAL_STREAM_SWITCH,_,this),v.off(o.default.PLAYBACK_SEEKING,b,this),v.off(o.default.BUFFER_REPLACEMENT_STARTED,x,e),v.off(o.default.TRACK_CHANGE_RENDERED,E,e)}(),l=null,c=NaN,r=0,h=null,f={}}function b(){h&&(clearTimeout(h),h=null)}function x(e){try{if(e.streamId!==d.getActiveStreamInfo().id||e.mediaType!==a.default.VIDEO&&e.mediaType!==a.default.AUDIO)return;e.streamId===d.getActiveStreamInfo().id&&(f[e.mediaType]=!0)}catch(e){g.error(e)}}function E(e){e&&e.mediaType&&(f[e.mediaType]=!1)}function _(){l||function(){try{l||(g.debug("Starting the gap controller"),l=setInterval((function(){S()&&T(u.getTime())}),100))}catch(e){}}()}function w(){if(S(n.get().streaming.gaps.enableSeekFix)&&++r>=10){var e=u.getTime();t===e?T(e,!0):(t=e,c=NaN),r=0}}function S(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!d.getActiveStream())return!1;var t,r,i=Object.keys(f).some((function(e){return f[e]})),o=!!e&&(t=d.getActiveStream(),r=parseFloat((t.getStartTime()+t.getDuration()).toFixed(5)),u.getTime()+n.get().streaming.gaps.threshold>=r);return!i&&n.get().streaming.gaps.jumpGaps&&d.getActiveStreamProcessors().length>0&&(!u.isSeeking()||o)&&!u.isPaused()&&!d.getIsStreamSwitchInProgress()&&!d.getHasMediaOrInitialisationError()}function T(e){var t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=n.get().streaming.gaps.enableStallFix,o=n.get().streaming.gaps.stallSeek,s=n.get().streaming.gaps.smallGapLimit,a=n.get().streaming.gaps.jumpLargeGaps,l=p.getBufferRange(),f=NaN,m=!1;if(t=function(e,t){try{if(!e||e.length<=1&&t>0)return NaN;for(var r=NaN,i=0;isNaN(r)&&i<e.length;){var o=i>0?e.end(i-1):0;t<e.start(i)&&o-t<n.get().streaming.gaps.threshold&&(r=i),i+=1}return r}catch(e){return null}}(l,e),!isNaN(t)){var v=l.start(t),y=v-e;y>0&&(y<=s||a)&&(f=v)}var b=u.getTimeToStreamEnd();if(isNaN(f)&&r&&isFinite(b)&&!isNaN(b)&&b<s&&(f=parseFloat(u.getStreamEndTime().toFixed(5)),m=!0),i&&isNaN(f)&&r&&isNaN(t)&&function(e,t){for(var n=0,r=e.length;n<r;n++)if(t>=e.start(n)&&t<=e.end(n))return!0;return!1}(l,e)&&(0===o?(g.warn("Toggle play pause to break stall"),p.pause(),p.play()):(g.warn("Jumping ".concat(o,"s to break stall")),f=e+o)),f>0&&c!==f&&f>e&&!h){var x=f-e;if(m){var E=d.getStreamForTime(f),_=E&&!!E.getPreloaded();g.warn("Jumping to end of stream because of gap from ".concat(e," to ").concat(f,". Gap duration: ").concat(x)),u.seek(f,!0,_)}else{var w=u.getIsDynamic(),S=t>0?l.end(t-1):e,T=w?1e3*Math.max(0,x-.1):0;h=window.setTimeout((function(){u.seek(f,!0,!0),g.warn("Jumping gap occuring in period ".concat(d.getActiveStream().getStreamId()," starting at ").concat(S," and ending at ").concat(f,". Jumping by: ").concat(f-S)),h=null}),T)}c=f}}return e={reset:y,setConfig:function(e){e&&(e.settings&&(n=e.settings),e.playbackController&&(u=e.playbackController),e.streamController&&(d=e.streamController),e.videoModel&&(p=e.videoModel))},initialize:function(){!function(){v.on(o.default.WALLCLOCK_TIME_UPDATED,w,this),v.on(o.default.INITIAL_STREAM_SWITCH,_,this),v.on(o.default.PLAYBACK_SEEKING,b,this),v.on(o.default.BUFFER_REPLACEMENT_STARTED,x,e),v.on(o.default.TRACK_CHANGE_RENDERED,E,e)}()}},g=(0,i.default)(m).getInstance().getLogger(e),y(),e}l.__dashjs_factory_name="GapController";const c=r.default.getSingletonFactory(l)},"./src/streaming/controllers/MediaController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>h});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/core/events/Events.js"),o=n("./src/core/EventBus.js"),s=n("./src/core/FactoryMaker.js"),a=n("./src/core/Debug.js"),l=n("./node_modules/bcp-47-normalize/index.js"),c=n.n(l),u=n("./node_modules/bcp-47-match/index.js");function d(){var e,t,n,s,l,d,p,h,f=this.context,g=(0,o.default)(f).getInstance();function m(e,t){return e&&n[t]&&n[t][e]?n[t][e].list:[]}function v(e,t){return e&&n[t]&&n[t][e]?n[t][e].current:null}function y(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e&&e.streamInfo){var o=e.type,a=e.streamInfo.id,l=v(o,a);if(n[a]&&n[a][o]&&(n[a][o].current=e,n[a][o].current&&(o!==r.default.TEXT&&!E(e,l)||o===r.default.TEXT&&e.isFragmented)&&g.trigger(i.default.CURRENT_TRACK_CHANGED,{oldMediaInfo:l,newMediaInfo:e,switchMode:s.get().streaming.trackSwitchMode[o]},{streamId:a}),!t)){var c=function(e){var t={lang:e.lang,viewpoint:e.viewpoint,roles:e.roles,accessibility:e.accessibility,audioChannelConfiguration:e.audioChannelConfiguration};return t.lang||t.viewpoint||t.role&&t.role.length>0||t.accessibility&&t.accessibility.length>0||t.audioChannelConfiguration&&t.audioChannelConfiguration.length>0?t:null}(e);if(!c||!n[a][o].storeLastSettings)return;c.roles&&(c.role=c.roles[0],delete c.roles),c.accessibility&&(c.accessibility=c.accessibility[0]),c.audioChannelConfiguration&&(c.audioChannelConfiguration=c.audioChannelConfiguration[0]),d[o]=c,h.setSavedMediaSettings(o,c)}}}function b(e,t){e&&t&&(l[e]=t)}function x(e){return e?l[e]:null}function E(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;var n=e.id===t.id,r=e.viewpoint===t.viewpoint,i=e.lang===t.lang,o=e.codec===t.codec,s=e.roles.toString()===t.roles.toString(),a=e.accessibility.toString()===t.accessibility.toString(),l=e.audioChannelConfiguration.toString()===t.audioChannelConfiguration.toString();return n&&o&&r&&i&&s&&a&&l}function _(){n={},d={},l={audio:null,video:null,text:null}}function w(e,t,n){var r=[];return e.forEach((function(e){t(n,e)&&r.push(e)})),0!==r.length?r:e}function S(e,t){return!e.lang||e.lang instanceof RegExp?t.lang.match(e.lang):""!==t.lang&&(0,u.extendedFilter)(t.lang,c()(e.lang)).length>0}function T(e,t){return void 0===e.index||null===e.index||t.index===e.index}function k(e,t){return!e.viewpoint||e.viewpoint===t.viewpoint}function C(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!e.role||!!t.roles.filter((function(t){return t===e.role}))[0]||t.type===r.default.AUDIO&&n}function A(e,t){return e.accessibility?!!t.accessibility.filter((function(t){return t===e.accessibility}))[0]:!t.accessibility.length}function j(e,t){return!e.audioChannelConfiguration||!!t.audioChannelConfiguration.filter((function(t){return t===e.audioChannelConfiguration}))[0]}function I(e){var t,n=0,r=[];return e.forEach((function(e){(t=Math.max.apply(Math,e.bitrateList.map((function(e){return e.bandwidth}))))>n?(n=t,r=[e]):t===n&&r.push(e)})),r}function O(e){var t,n=1/0,r=[];return e.forEach((function(e){var i=e.bitrateList.reduce((function(e,t){var n=Math.max(1,t.width*t.height);return e+t.bandwidth/n}),0);(t=i/e.bitrateList.length)<n?(n=t,r=[e]):t===n&&r.push(e)})),r}function N(e){var t,n=0,r=[];return e.forEach((function(e){(t=e.representationCount)>n?(n=t,r=[e]):t===n&&r.push(e)})),r}function R(e,n){if(e===r.default.TEXT)return n[0];var i,o=s.get().streaming.selectionModeForInitialTrack,a=p.getCustomInitialTrackSelectionFunction();if(a&&"function"==typeof a)i=a(n);else switch(o){case r.default.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY:i=function(e){var t,n,r=(t=0,n=[],e.forEach((function(e){isNaN(e.selectionPriority)||(e.selectionPriority>t?(t=e.selectionPriority,n=[e]):e.selectionPriority===t&&n.push(e))})),n);return r.length>1&&(r=I(r)),r.length>1&&(r=N(r)),r}(n);break;case r.default.TRACK_SELECTION_MODE_HIGHEST_BITRATE:i=function(e){var t=I(e);return t.length>1&&(t=N(t)),t}(n);break;case r.default.TRACK_SELECTION_MODE_FIRST_TRACK:i=P(n);break;case r.default.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY:i=function(e){var t=O(e);return t.length>1&&(t=I(t)),t}(n);break;case r.default.TRACK_SELECTION_MODE_WIDEST_RANGE:i=function(e){var t=N(e);return t.length>1&&(t=I(e)),t}(n);break;default:t.warn("Track selection mode ".concat(o," is not supported. Falling back to TRACK_SELECTION_MODE_FIRST_TRACK")),i=P(n)}return i.length>0?i[0]:n[0]}function P(e){return e[0]}return e={setInitialMediaSettingsForType:function(e,t){var n=d[e]||x(e),i=m(e,t.id),o=[];n||b(e,n=h.getSavedMediaSettings(e)),i&&0!==i.length&&(n&&(o=w(o=Array.from(i),S,n),o=w(o,T,n),o=w(o,k,n),e===r.default.AUDIO&&d[e]||(o=w(o,C,n)),o=w(o,A,n),o=w(o,j,n)),0===o.length?y(R(e,i),!0):o.length>1?y(R(e,o,d[e])):y(o[0]))},addTrack:function(e){if(e){var t=e.type;if((i=t)===r.default.AUDIO||i===r.default.VIDEO||i===r.default.TEXT||i===r.default.IMAGE){var i,o=e.streamInfo.id;n[o]||(n[o]={audio:{list:[],storeLastSettings:!0,current:null},video:{list:[],storeLastSettings:!0,current:null},text:{list:[],storeLastSettings:!0,current:null},image:{list:[],storeLastSettings:!0,current:null}});for(var s=n[o][t].list,a=0,l=s.length;a<l;++a)if(E(s[a],e))return;s.push(e)}}},getTracksFor:m,getCurrentTrackFor:v,isCurrentTrack:function(e){if(!e)return!1;var t=e.type,r=e.streamInfo.id;return n[r]&&n[r][t]&&E(n[r][t].current,e)},setTrack:y,selectInitialTrack:R,setInitialSettings:b,getInitialSettings:x,getTracksWithHighestBitrate:I,getTracksWithHighestEfficiency:O,getTracksWithWidestRange:N,isTracksEqual:E,matchSettings:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{var i=!1;if(e.lang){if(e.lang instanceof RegExp)i=t.lang.match(e.lang);else if(""!==t.lang){var o=c()(e.lang);o&&(i=(0,u.extendedFilter)(t.lang,o).length>0)}}else i=!0;var s=void 0===e.index||null===e.index||t.index===e.index,a=!e.viewpoint||e.viewpoint===t.viewpoint,l=!e.role||!!t.roles.filter((function(t){return t===e.role}))[0],d=!e.accessibility||!!t.accessibility.filter((function(t){return t===e.accessibility}))[0],p=!e.audioChannelConfiguration||!!t.audioChannelConfiguration.filter((function(t){return t===e.audioChannelConfiguration}))[0];return i&&s&&a&&(l||t.type===r.default.AUDIO&&n)&&d&&p}catch(e){return!1}},matchSettingsLang:S,matchSettingsIndex:T,matchSettingsViewPoint:k,matchSettingsRole:C,matchSettingsAccessibility:A,matchSettingsAudioChannelConfig:j,saveTextSettingsDisabled:function(){h.setSavedMediaSettings(r.default.TEXT,null)},setConfig:function(e){e&&(e.domStorage&&(h=e.domStorage),e.settings&&(s=e.settings),e.customParametersModel&&(p=e.customParametersModel))},reset:_},t=(0,a.default)(f).getInstance().getLogger(e),_(),e}d.__dashjs_factory_name="MediaController";var p=s.default.getSingletonFactory(d);s.default.updateSingletonFactory(d.__dashjs_factory_name,p);const h=p},"./src/streaming/controllers/MediaSourceController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js");function o(){var e,t,n,r=this.context;return e={createMediaSource:function(){var e="WebKitMediaSource"in window;return"MediaSource"in window?t=new MediaSource:e&&(t=new WebKitMediaSource),t},attachMediaSource:function(e){var n=window.URL.createObjectURL(t);return e.setSource(n),n},detachMediaSource:function(e){e.setSource(null)},setDuration:function e(r){t&&"open"===t.readyState&&(null===r&&isNaN(r)||t.duration!==r&&(function(e){for(var t=e.sourceBuffers,n=0;n<t.length;n++)if(t[n].updating)return!0;return!1}(t)?setTimeout(e.bind(null,r),50):(n.info("Set MediaSource duration:"+r),t.duration=r)))},setSeekable:function(e,n){t&&"function"==typeof t.setLiveSeekableRange&&"function"==typeof t.clearLiveSeekableRange&&"open"===t.readyState&&e>=0&&e<n&&(t.clearLiveSeekableRange(),t.setLiveSeekableRange(e,n))},signalEndOfStream:function(e){if(e&&"open"===e.readyState){for(var t=e.sourceBuffers,r=0;r<t.length;r++){if(t[r].updating)return;if(0===t[r].buffered.length)return}n.info("call to mediaSource endOfStream"),e.endOfStream()}}},n=(0,i.default)(r).getInstance().getLogger(e),e}o.__dashjs_factory_name="MediaSourceController";const s=r.default.getSingletonFactory(o)},"./src/streaming/controllers/PlaybackController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/core/EventBus.js"),o=n("./src/core/events/Events.js"),s=n("./src/core/FactoryMaker.js"),a=n("./src/core/Debug.js"),l=n("./src/streaming/MediaPlayerEvents.js"),c=n("./src/streaming/constants/MetricsConstants.js");function u(){var e,t,n,s,u,d,p,h,f,g,m,v,y,b,x,E,_,w,S,T,k,C,A,j,I=this.context,O=(0,i.default)(I).getInstance();function N(){M(),b=!1,g=0,m=0,E=0,C=!1,_=!0,w=!1,A=!1,S=NaN,p&&(O.off(o.default.DATA_UPDATE_COMPLETED,X,e),O.off(o.default.LOADING_PROGRESS,ge,e),O.off(o.default.MANIFEST_UPDATED,be,e),O.off(o.default.STREAMS_COMPOSED,xe,e),O.off(l.default.PLAYBACK_ENDED,he,e),O.off(l.default.STREAM_INITIALIZING,ve,e),O.off(l.default.REPRESENTATION_SWITCH,ye,e),O.off(l.default.BUFFER_LEVEL_STATE_CHANGED,Z,e),Y(),p.removeEventListener("canplay",J),p.removeEventListener("canplaythrough",Q),p.removeEventListener("play",ee),p.removeEventListener("waiting",te),p.removeEventListener("playing",ne),p.removeEventListener("pause",re),p.removeEventListener("error",fe),p.removeEventListener("seeking",ie),p.removeEventListener("seeked",oe),p.removeEventListener("timeupdate",se),p.removeEventListener("progress",ae),p.removeEventListener("ratechange",le),p.removeEventListener("loadedmetadata",ce),p.removeEventListener("loadeddata",ue),p.removeEventListener("stalled",me),p.removeEventListener("ended",de),p.removeEventListener("volumechange",pe)),f=null,p=null,v=null,y=null}function R(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return parseFloat((P(e)-U()).toFixed(5))}function P(e){var t=e||v;return t.start+t.duration}function D(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];v&&p&&p.getElement()?(e&&y&&F(U()),p.play()):b=!0}function M(){v&&p&&p.pause()}function L(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];v&&p&&e!==(isNaN(S)?p.getTime():S)&&((T=!0===r)||(S=e),t.info("Requesting seek to time: "+e+(T?" (internal)":"")),y&&i&&F(e),p.setCurrentTime(e,n))}function B(){if(v&&p&&y){var e=n&&n.hasVideoTrack()?r.default.VIDEO:r.default.AUDIO,t=u.getCurrentDVRInfo(e);return t&&t.range?t.range.end:0}}function F(e){var t=new Date(h.getClientReferenceTime()),n=d.getRegularPeriods()[0],r=h.calcPresentationTimeFromWallTime(t,n);g=r-e}function U(){return v&&p?p.getTime():null}function H(){return v&&p?p.isPaused():null}function G(){return v&&p?p.isSeeking():null}function q(){return v&&p?p.isStalled():null}function V(){return v&&p?p.getPlaybackRate():null}function z(){return v&&p?p.getEnded():null}function W(){return y}function K(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!H()&&y&&0!==p.getReadyState()&&!G()&&!C){e||(e=n.hasVideoTrack()?r.default.VIDEO:r.default.AUDIO);var i=U(),o=function(e,t){var n=u.getCurrentDVRInfo(t),r=n?n.range:null;return r?e>r.end?Math.max(r.end-g,r.start):e>0&&e+.25<r.start&&Math.abs(e-r.start)<31536e4?w?Math.max(r.end-g,r.start):r.start:e:NaN}(i,e);!isNaN(o)&&o!==i&&!G()&&(q()||k||1===p.getReadyState())&&(t.debug("UpdateCurrentTime: Seek to actual time: ".concat(o," from currentTime: ").concat(i)),L(o,!1,!1))}}function $(){null===f&&(f=setInterval((function(){var e;O.trigger(o.default.WALLCLOCK_TIME_UPDATED,{isDynamic:y,time:new Date}),W()&&(n.addDVRMetric(),H()?(e=Date.now(),(!x||e>x+500)&&(x=e,se())):K())}),j.get().streaming.wallclockTimeUpdateInterval))}function Y(){clearInterval(f),f=null}function X(e){var t=d.convertRepresentationToRepresentationInfo(e.currentRepresentation),n=t?t.mediaInfo.streamInfo:null;null!==n&&v.id===n.id&&(v=n)}function J(){O.trigger(o.default.CAN_PLAY)}function Q(){O.trigger(o.default.CAN_PLAY_THROUGH)}function Z(e){e.streamId===n.getActiveStreamInfo().id&&(k=e.state===c.default.BUFFER_EMPTY,j.get().streaming.buffer.setStallState&&p.setStallState(e.mediaType,e.state===c.default.BUFFER_EMPTY))}function ee(){t.info("Native video element event: play"),K(),$(),O.trigger(o.default.PLAYBACK_STARTED,{startTime:U()})}function te(){t.info("Native video element event: waiting"),O.trigger(o.default.PLAYBACK_WAITING,{playingTime:U()})}function ne(){t.info("Native video element event: playing"),T=!1,O.trigger(o.default.PLAYBACK_PLAYING,{playingTime:U()})}function re(){t.info("Native video element event: pause"),O.trigger(o.default.PLAYBACK_PAUSED,{ended:z()})}function ie(){if(!T){var e=U();isNaN(S)||S===e||(e=S),S=NaN,t.info("Seeking to: "+e),$(),O.trigger(o.default.PLAYBACK_SEEKING,{seekTime:e,streamId:v.id})}}function oe(){t.info("Native video element event: seeked"),T=!1,O.trigger(o.default.PLAYBACK_SEEKED)}function se(){v&&O.trigger(o.default.PLAYBACK_TIME_UPDATED,{timeToEnd:R(),time:U(),streamId:v.id})}function ae(){O.trigger(o.default.PLAYBACK_PROGRESS,{streamId:v.id})}function le(){var e=V();t.info("Native video element event: ratechange: ",e),O.trigger(o.default.PLAYBACK_RATE_CHANGED,{playbackRate:e})}function ce(){t.info("Native video element event: loadedmetadata"),O.trigger(o.default.PLAYBACK_METADATA_LOADED),$()}function ue(){t.info("Native video element event: loadeddata"),O.trigger(o.default.PLAYBACK_LOADED_DATA)}function de(){t.info("Native video element event: ended"),M(),Y();var e=n?n.getActiveStreamInfo():null;e&&O.trigger(o.default.PLAYBACK_ENDED,{isLast:e.isLast})}function pe(){O.trigger(o.default.PLAYBACK_VOLUME_CHANGED)}function he(e){if(f&&e.isLast){t.info("onPlaybackEnded -- PLAYBACK_ENDED but native video element didn't fire ended");var n=e.seekTime?e.seekTime:P();p.setCurrentTime(n),M(),Y()}}function fe(e){var t=e.target||e.srcElement;O.trigger(o.default.PLAYBACK_ERROR,{error:t.error})}function ge(e){if(!1===e.stream&&w&&!isNaN(e.request.duration)){var n=1.2*e.request.duration;n>g&&(t.warn("Browser does not support fetch API with StreamReader. Increasing live delay to be 20% higher than segment duration:",n.toFixed(2)),g=n,m=n)}}function me(e){O.trigger(o.default.PLAYBACK_STALLED,{e:e})}function ve(e){var n;(n=e.mediaInfo)&&n.supplementalProperties&&"true"===n.supplementalProperties[r.default.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME]&&(t.debug("Low Latency critical SupplementalProperty set: Enabling low Latency"),w=!0)}function ye(e){var t=n.getActiveStreamInfo();e&&t&&e.currentRepresentation&&e.streamId&&e.streamId===t.id&&e.mediaType&&(e.mediaType===r.default.VIDEO||e.mediaType===r.default.AUDIO)&&(_=e.currentRepresentation.availabilityTimeComplete,(w=!_)&&!A&&(A=!0))}function be(){C=!0}function xe(){C=!1}return e={initialize:function(t,n){v=t,!0!==n&&(p.addEventListener("canplay",J),p.addEventListener("canplaythrough",Q),p.addEventListener("play",ee),p.addEventListener("waiting",te),p.addEventListener("playing",ne),p.addEventListener("pause",re),p.addEventListener("error",fe),p.addEventListener("seeking",ie),p.addEventListener("seeked",oe),p.addEventListener("timeupdate",se),p.addEventListener("progress",ae),p.addEventListener("ratechange",le),p.addEventListener("loadedmetadata",ce),p.addEventListener("loadeddata",ue),p.addEventListener("stalled",me),p.addEventListener("ended",de),p.addEventListener("volumechange",pe),y=v.manifestInfo.isDynamic,k=!1,T=!1,O.on(o.default.DATA_UPDATE_COMPLETED,X,e),O.on(o.default.LOADING_PROGRESS,ge,e),O.on(o.default.MANIFEST_UPDATED,be,e),O.on(o.default.STREAMS_COMPOSED,xe,e),O.on(l.default.PLAYBACK_ENDED,he,e,{priority:i.default.EVENT_PRIORITY_HIGH}),O.on(l.default.STREAM_INITIALIZING,ve,e),O.on(l.default.REPRESENTATION_SWITCH,ye,e),O.on(l.default.BUFFER_LEVEL_STATE_CHANGED,Z,e),b&&(b=!1,D()))},setConfig:function(e){e&&(e.streamController&&(n=e.streamController),e.serviceDescriptionController&&(s=e.serviceDescriptionController),e.dashMetrics&&(u=e.dashMetrics),e.adapter&&(d=e.adapter),e.videoModel&&(p=e.videoModel),e.timelineConverter&&(h=e.timelineConverter),e.settings&&(j=e.settings))},getTimeToStreamEnd:R,getBufferLevel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null;return n.getActiveStreamProcessors().forEach((function(n){if(!e||0===e.length||-1===e.indexOf(n.getType())){var r=n.getBufferLevel();t=null===t?r:Math.min(t,r)}})),t},getPlaybackStalled:function(){return k},getTime:U,getLowLatencyModeEnabled:function(){return w},getInitialCatchupModeActivated:function(){return A},getIsManifestUpdateInProgress:function(){return C},getPlaybackRate:V,getPlayedRanges:function(){return v&&p?p.getPlayedRanges():null},getEnded:z,getIsDynamic:W,getStreamController:function(){return n},computeAndSetLiveDelay:function(e,t){var n,r,i,o=!isNaN(e)&&isFinite(e)?e:NaN,a=d.getSuggestedPresentationDelay(),l=s.getServiceDescriptionSettings();return n=isNaN(j.get().streaming.delay.liveDelay)?null===j.get().streaming.delay.liveDelayFragmentCount||isNaN(j.get().streaming.delay.liveDelayFragmentCount)||isNaN(o)?l&&!isNaN(l.liveDelay)&&l.liveDelay>0?l.liveDelay:!0===j.get().streaming.delay.useSuggestedPresentationDelay&&null!==a&&!isNaN(a)&&a>0?a:isNaN(o)?t&&!isNaN(t.minBufferTime)?4*t.minBufferTime:4*v.manifestInfo.minBufferTime:4*o:o*j.get().streaming.delay.liveDelayFragmentCount:j.get().streaming.delay.liveDelay,null!==(i=d.getAvailabilityStartTime())&&(E=i),r=t&&t.dvrWindowSize>0?Math.min(n,t.dvrWindowSize):n,g=r,m=r,r},getLiveDelay:function(){return g},getOriginalLiveDelay:function(){return m},getCurrentLiveLatency:function(){if(!y||isNaN(E))return NaN;var e=U();if(isNaN(e)||0===e)return 0;var t=(new Date).getTime()+1e3*h.getClientTimeOffset();return Math.max(((t-E-1e3*e)/1e3).toFixed(3),0)},play:D,isPaused:H,isStalled:q,pause:M,isSeeking:G,getStreamEndTime:P,seek:L,seekToOriginalLive:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=B();0!==r&&L(r-(g=m),e,t,n)},seekToCurrentLive:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=B();0!==r&&L(r-g,e,t,n)},reset:N,updateCurrentTime:K,getAvailabilityStartTime:function(){return E}},t=(0,a.default)(I).getInstance().getLogger(e),N(),e}u.__dashjs_factory_name="PlaybackController";const d=s.default.getSingletonFactory(u)},"./src/streaming/controllers/ScheduleController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/streaming/models/FragmentModel.js"),o=n("./src/core/EventBus.js"),s=n("./src/core/events/Events.js"),a=n("./src/core/FactoryMaker.js"),l=n("./src/core/Debug.js"),c=n("./src/streaming/constants/MetricsConstants.js"),u=n("./src/streaming/MediaPlayerEvents.js");function d(e){e=e||{};var t,n,a,d,p,h,f,g,m,v,y,b,x,E=this.context,_=(0,o.default)(E).getInstance(),w=e.dashMetrics,S=e.mediaPlayerModel,T=e.fragmentModel,k=e.abrController,C=e.playbackController,A=e.textController,j=e.type,I=e.bufferController,O=e.settings;function N(e){if(!I.getIsBufferingCompleted()){R();var t=isNaN(e)?0:e;h=setTimeout(P,t)}}function R(){h&&(clearTimeout(h),h=null)}function P(){try{if(function(){try{return j===r.default.TEXT&&!A.isTextEnabled()||C.isPaused()&&(!C.getStreamController().getInitialPlayback()||!C.getStreamController().getAutoPlay())&&!O.get().streaming.scheduling.scheduleWhilePaused}catch(e){return!1}}())return void R();if(function(){try{return d&&(isNaN(v)||y||(e=n.id,t=k.getMaxAllowedIndexFor(j,e),!(!isNaN(m)&&m==t||(a.info("Top quality "+j+" index has changed from "+m+" to "+t),m=t,0)))||!j||!d||w.getCurrentBufferLevel(j)<D())}catch(e){return!1}var e,t}()){var e=!1;x&&(e=k.checkPlaybackQuality(j,n.id)),e||(b||d.quality!==v||y?(y?(a.debug("Switch track for "+j+", representation id = "+d.id),y=!1):a.debug("Quality has changed, get init request for representationid = "+d.id),_.trigger(s.default.INIT_FRAGMENT_NEEDED,{representationId:d.id,sender:t},{streamId:n.id,mediaType:j}),x=!1,b=!1):(a.debug("Media segment needed for ".concat(j," and stream id ").concat(n.id)),_.trigger(s.default.MEDIA_FRAGMENT_NEEDED,{},{streamId:n.id,mediaType:j}),x=!0))}else N(C.getLowLatencyModeEnabled()?O.get().streaming.scheduling.lowLatencyTimeout:O.get().streaming.scheduling.defaultTimeout)}catch(e){N(C.getLowLatencyModeEnabled()?O.get().streaming.scheduling.lowLatencyTimeout:O.get().streaming.scheduling.defaultTimeout)}}function D(){var e=NaN;return j&&d?e=j===r.default.TEXT?function(){try{if(A.isTextEnabled()){if(isNaN(d.fragmentDuration)){var e=w.getCurrentSchedulingInfo(c.default.SCHEDULING_INFO);return e?e.duration:0}return d.fragmentDuration}return 0}catch(e){return 0}}():j===r.default.AUDIO&&f?function(){try{var e=w.getCurrentBufferLevel(r.default.VIDEO);return isNaN(d.fragmentDuration)?e+1:Math.max(e+1,d.fragmentDuration)}catch(e){return 0}}():function(){try{var e=d.mediaInfo.streamInfo;return k.isPlayingAtTopQuality(e)?e.manifestInfo.duration>=O.get().streaming.buffer.longFormContentDurationThreshold?O.get().streaming.buffer.bufferTimeAtTopQualityLongForm:O.get().streaming.buffer.bufferTimeAtTopQuality:S.getStableBufferTime()}catch(e){return S.getStableBufferTime()}}():e}function M(){L(!0)}function L(e){if(C&&T){var t=T.getRequests({state:i.default.FRAGMENT_MODEL_EXECUTED,time:C.getTime(),threshold:0})[0];t&&C.getTime()>=t.startTime&&((!g.mediaInfo||t.mediaInfo.type===g.mediaInfo.type&&t.mediaInfo.id!==g.mediaInfo.id)&&e&&_.trigger(s.default.TRACK_CHANGE_RENDERED,{mediaType:j,oldMediaInfo:g.mediaInfo,newMediaInfo:t.mediaInfo,streamId:n.id}),t.quality===g.quality&&t.adaptationIndex===g.adaptationIndex||!e||(a.debug("Quality change rendered for streamId ".concat(n.id," and type ").concat(j)),_.trigger(s.default.QUALITY_CHANGE_RENDERED,{mediaType:j,oldQuality:g.quality,newQuality:t.quality,streamId:n.id})),g={mediaInfo:t.mediaInfo,quality:t.quality,adaptationIndex:t.adaptationIndex})}}function B(e){a.debug("Appended bytes for ".concat(e.mediaType," and stream id ").concat(n.id)),(isNaN(e.index)||isNaN(v))&&(v=e.quality,a.info("["+j+"] lastInitializedRepresentationInfo changed to "+e.quality)),N(0)}function F(){T.abortRequests(),R()}function U(){O.get().streaming.scheduling.scheduleWhilePaused||N()}function H(e){w.updatePlayListTraceMetrics({playbackspeed:e.playbackRate.toString()})}function G(){x=!0,p=0,v=NaN,g={mediaInfo:void 0,quality:NaN,adaptationIndex:NaN},m=NaN,y=!1,b=!1}return t={initialize:function(e){f=e,_.on(s.default.BYTES_APPENDED_END_FRAGMENT,B,t),_.on(s.default.URL_RESOLUTION_FAILED,F,t),_.on(u.default.PLAYBACK_STARTED,U,t),_.on(u.default.PLAYBACK_RATE_CHANGED,H,t),_.on(u.default.PLAYBACK_TIME_UPDATED,M,t)},getType:function(){return j},getStreamId:function(){return n.id},setCurrentRepresentation:function(e){d=e},setTimeToLoadDelay:function(e){p=e},getTimeToLoadDelay:function(){return p},setSwitchTrack:function(e){y=e},getSwitchStrack:function(){return y},startScheduleTimer:N,clearScheduleTimer:R,reset:function(){_.off(s.default.BYTES_APPENDED_END_FRAGMENT,B,t),_.off(s.default.URL_RESOLUTION_FAILED,F,t),_.off(u.default.PLAYBACK_STARTED,U,t),_.off(u.default.PLAYBACK_RATE_CHANGED,H,t),_.off(u.default.PLAYBACK_TIME_UPDATED,M,t),R(),L(!1),G(),n=null},getBufferTarget:D,getPlaybackController:function(){return C},setCheckPlaybackQuality:function(e){x=e},setInitSegmentRequired:function(e){b=e}},a=(0,l.default)(E).getInstance().getLogger(t),G(),n=e.streamInfo,t}d.__dashjs_factory_name="ScheduleController";const p=a.default.getClassFactory(d)},"./src/streaming/controllers/StreamController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>w});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/streaming/constants/MetricsConstants.js"),o=n("./src/streaming/Stream.js"),s=n("./src/streaming/ManifestUpdater.js"),a=n("./src/core/EventBus.js"),l=n("./src/core/events/Events.js"),c=n("./src/core/FactoryMaker.js"),u=n("./src/streaming/vo/metrics/PlayList.js"),d=n("./src/core/Debug.js"),p=n("./src/streaming/utils/InitCache.js"),h=n("./src/streaming/MediaPlayerEvents.js"),f=n("./src/streaming/controllers/TimeSyncController.js"),g=n("./src/streaming/controllers/MediaSourceController.js"),m=n("./src/streaming/vo/DashJSError.js"),v=n("./src/core/errors/Errors.js"),y=n("./src/streaming/controllers/EventController.js"),b=n("./src/streaming/constants/ConformanceViolationConstants.js");function x(e){return function(e){if(Array.isArray(e))return E(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _(){var e,t,n,c,E,_,w,S,T,k,C,A,j,I,O,N,R,P,D,M,L,B,F,U,H,G,q,V,z,W,K,$,Y,X,J,Q,Z,ee,te,ne,re,ie,oe,se,ae,le,ce,ue,de=this.context,pe=(0,a.default)(de).getInstance();function he(){if(!(_&&_.hasOwnProperty("load")&&L&&L.hasOwnProperty("initialize")&&L.hasOwnProperty("reset")&&L.hasOwnProperty("getClientTimeOffset")&&w&&M&&T&&Y))throw new Error(r.default.MISSING_CONFIG_ERROR)}function fe(){!function(){try{var e=S.getStreamsInfo();if(!F&&0===e.length)throw new Error("There are no periods in the MPD");F&&e.length>0&&T.updateManifestUpdateInfo({currentTime:Y.getTime(),buffered:$.getBufferRange(),presentationStartTime:e[0].start,clientTimeOffset:L.getClientTimeOffset()}),B.length>0&&function(e){0!==e.length?B=B.filter((function(n){var r=e.filter((function(e){return e.id===n.getId()})).length>0||n.getId()===F.getId();return r||(t.debug("Removing stream ".concat(n.getId())),n.reset(!0)),r})):t.warn("No periods included in the current manifest. Skipping the filtering of outdated stream objects.")}(e);for(var n=[],r=0,i=e.length;r<i;r++){var o=e[r];n.push(me(o)),T.addManifestUpdateStreamInfo(o)}Promise.all(n).then((function(){return se.get().streaming.applyContentSteering&&!F&&A.shouldQueryBeforeStart()?A.loadSteeringData():Promise.resolve()})).then((function(){F||function e(n){Ce();var r=T.getCurrentDVRInfo().range;if(r.end<r.start){le&&clearTimeout(le);var i=Math.min(1e3*(-1*(r.end-r.start)+2),2147483647);return t.debug("Waiting for ".concat(i," ms before playback can start")),pe.trigger(l.default.AST_IN_FUTURE,{delay:i}),void(le=setTimeout((function(){e(n)}),i))}se.get().streaming.applyProducerReferenceTime&&X.calculateProducerReferenceTimeOffsets(n);var o=n[0].manifestInfo;if(se.get().streaming.applyServiceDescription&&X.applyServiceDescription(o),S.getIsDynamic()){var s=qe(n,o);Y.computeAndSetLiveDelay(s,o)}var a=function(){var e;if(S.getIsDynamic()){var n=T.getCurrentDVRInfo();e=(n&&n.range?n.range.end:0)-Y.getOriginalLiveDelay();var r=n?n.range:null;if(r){if(isNaN(ce)&&-1===ce.toString().indexOf("posix:")){var i=Ue(!0);isNaN(i)||(t.info("Start time from URI parameters: ".concat(i)),e=Math.min(e,i))}else{t.info("Start time provided by the app: ".concat(ce));var o=He(!0,ce);isNaN(o)||(e=Math.min(e,o))}var s=se.get().streaming.timeShiftBuffer.calcFromSegmentTimeline?.1:0;e=Math.max(e,r.start+s)}}else if(e=nt()[0].getStreamInfo().start,isNaN(ce)){var a=Ue(!1);isNaN(a)||(t.info("Start time from URI parameters: ".concat(a)),e=Math.max(e,a))}else{t.info("Start time provided by the app: ".concat(ce));var l=He(!1,ce);isNaN(l)||(e=Math.max(e,l))}return e}(),c=ke(a),u=null!==c?c:B[0];pe.trigger(l.default.INITIAL_STREAM_SWITCH,{startTime:a}),ve(u,null,a),ne||(ne=setInterval((function(){!V&&Y.getTimeToStreamEnd()<=0&&!Y.isSeeking()&&pe.trigger(l.default.PLAYBACK_ENDED,{isLast:Xe().isLast})}),200))}(e),pe.trigger(l.default.STREAMS_COMPOSED),De()})).catch((function(e){throw e}))}catch(e){M.error(new m.default(v.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,e.message+" nostreamscomposed",w.getValue())),W=!0,et()}}()}function ge(){ae=!0}function me(e){var t=Je(e.id);return t?t.updateData(e):(t=(0,o.default)(de).create({manifestModel:w,mediaPlayerModel:J,dashMetrics:T,manifestUpdater:E,adapter:S,timelineConverter:L,capabilities:n,capabilitiesFilter:c,errHandler:M,baseURLController:j,segmentBaseController:I,textController:H,abrController:N,playbackController:Y,eventController:P,mediaController:R,protectionController:U,videoModel:$,streamInfo:e,settings:se}),B.push(t),t.initialize(),Promise.resolve())}function ve(e,n,r){try{if(V||!e||n===e&&e.getIsActive())return;V=!0,pe.trigger(l.default.PERIOD_SWITCH_STARTED,{fromStreamInfo:n?n.getStreamInfo():null,toStreamInfo:e.getStreamInfo()});var i=!1;F=e,n&&(i=Se(e,n),n.deactivate(i)),r=isNaN(r)?!i&&n?e.getStreamInfo().start:NaN:r,t.info("Switch to stream ".concat(e.getId(),". Seektime is ").concat(r,", current playback time is ").concat(Y.getTime(),". Seamless period switch is set to ").concat(i)),ie=ie.filter((function(e){return e.getId()!==F.getId()})),Y.initialize(Xe(),!!n),$.getElement()?ye(r,i,!1):be(r,i)}catch(e){V=!1}}function ye(e,n){var r,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];function o(){if(K&&"open"===K.readyState){t.debug("MediaSource is open!"),window.URL.revokeObjectURL(r),K.removeEventListener("sourceopen",o),K.removeEventListener("webkitsourceopen",o),Fe();var s=T.getCurrentDVRInfo();k.setSeekable(s.range.start,s.range.end),i?F.setMediaSource(K).then((function(){F.initializeForTextWithMediaSource(K)})):be(e,n)}}function s(){K.addEventListener("sourceopen",o,!1),K.addEventListener("webkitsourceopen",o,!1),r=k.attachMediaSource($),t.debug("MediaSource attached to element.  Waiting on open...")}K?n?be(e,n):(k.detachMediaSource($),s()):(K=k.createMediaSource(),s())}function be(e,t){F.activate(K,t?re:void 0,e).then((function(t){if(t){var n=Object.keys(t);n.length>0&&t[n[0]].getBuffer().changeType&&(oe=!0),re=t}isNaN(e)||(pe.trigger(l.default.SEEK_TARGET,{time:e},{streamId:F.getId()}),Y.seek(e,!1,!0),F.startScheduleControllers()),V=!1,pe.trigger(l.default.PERIOD_SWITCH_COMPLETED,{toStreamInfo:Xe()})}))}function xe(e){var t=ke(e.seekTime);t&&t!==F?t&&t!==F&&(Ee(t),function(e,t){var n=e&&!isNaN(e.seekTime)?e.seekTime:NaN,r=F.getProcessors().map((function(t){return t.prepareOuterPeriodPlaybackSeeking(e)}));Promise.all(r).then((function(){ve(t,F,n)})).catch((function(e){M.error(e)}))}(e,t)):(Ee(),function(e){F.getProcessors().forEach((function(t){return t.prepareInnerPeriodPlaybackSeeking(e)})),Ke(u.PlayListTrace.USER_REQUEST_STOP_REASON)}(e)),$e(u.PlayList.SEEK_START_REASON)}function Ee(){_e()}function _e(){ie&&ie.length>0&&(ie.forEach((function(e){e.deactivate(!0)})),ie=[])}function we(e){e.newMediaInfo.streamInfo.id===F.getId()&&(_e(),F.prepareTrackChange(e))}function Se(e,t){try{return se.get().streaming.buffer.reuseExistingSourceBuffers&&(t.isProtectionCompatible(e)||ae)&&(oe||t.isMediaCodecCompatible(e,t))}catch(e){return!1}}function Te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;K&&!e.getPreloaded()&&Se(e,t)&&e.startPreloading(K,re).then((function(){ie.push(e)}))}function ke(e){if(isNaN(e))return null;for(var t=B.length,n=0;n<t;n++){var r=B[n];if(e<parseFloat((r.getStartTime()+r.getDuration()).toFixed(5)))return r}return null}function Ce(){try{var e=S.getIsDynamic(),t=S.getStreamsInfo()[0].manifestInfo,n=Y.getTime(),i=L.calcTimeShiftBufferWindow(B,e),o=Le();if(void 0===i.start||void 0===i.end)return;o&&0!==o.length?o.forEach((function(e){T.addDVRInfo(e.getType(),n,t,i)})):T.addDVRInfo(r.default.VIDEO,n,t,i)}catch(e){}}function Ae(e){if(ee&&q){var t=J.getInitialBufferLevel(),n=[r.default.TEXT];(isNaN(t)||t<=Y.getBufferLevel(n)||S.getIsDynamic()&&t>Y.getLiveDelay())&&(ee=!1,$e(u.PlayList.INITIAL_PLAYOUT_START_REASON),Y.play())}e&&e.mediaType&&T.addBufferLevel(e.mediaType,new Date,1e3*e.bufferLevel)}function je(e){e.streamInfo.id===F.getId()&&e.reason&&e.reason.forceReplace&&_e(),Je(e.streamInfo.id).prepareQualityChange(e)}function Ie(){if(S.getIsDynamic()&&0!==Y.getOriginalLiveDelay()&&F){var e=S.getStreamsInfo();if(e.length>0){var t=e[0].manifestInfo,n=qe(e,t);Y.computeAndSetLiveDelay(n,t)}}}function Oe(){if(ze()){var e=$.getPlaybackQuality();e&&T.addDroppedFrames(e)}}function Ne(){t.debug("[onPlaybackStarted]"),!ee&&Z&&$e(u.PlayList.RESUME_FROM_PAUSE_START_REASON),ee&&(ee=!1),te&&(te=!1,se.get().streaming.applyContentSteering&&!A.shouldQueryBeforeStart()&&A.loadSteeringData()),Z=!1}function Re(e){t.debug("[onPlaybackPaused]"),e.ended||(Z=!0,Ke(u.PlayListTrace.USER_REQUEST_STOP_REASON))}function Pe(e){t.debug("Stream with id ".concat(e.streamInfo.id," finished buffering"));var n=e.streamInfo.isLast;K&&n?(t.info("[onStreamBufferingCompleted] calls signalEndOfStream of mediaSourceController."),k.signalEndOfStream(K)):De()}function De(){if(F&&F.getHasFinishedBuffering())for(var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{var t=e||F||null;if(t){var n=t.getStreamInfo();return B.filter((function(e){var t=e.getStreamInfo();return t.start>n.start&&n.id!==t.id}))}}catch(e){return[]}}(F),t=0;t<e.length;){var n=e[t],r=0===t?F:e[t-1];!n.getPreloaded()&&r.getHasFinishedBuffering()&&K&&Te(n,r),t+=1}}function Me(){ne&&(clearInterval(ne),ne=null)}function Le(){return F?F.getProcessors():[]}function Be(e){if(F&&!F.getIsEndedEventSignaled()){F.setIsEndedEventSignaled(!0);var n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=e||F||null;if(!t)return null;for(var n=t.getStreamInfo(),r=n.start,i=0,o=-1,s=NaN;i<B.length;){var a=B[i],l=a.getStreamInfo(),c=l.start-r;c>0&&(isNaN(s)||c<s)&&n.id!==l.id&&(s=c,o=i),i+=1}return o>=0?B[o]:null}();n?(t.debug("StreamController onEnded, found next stream with id ".concat(n.getStreamInfo().id,". Switching from ").concat(F.getStreamInfo().id," to ").concat(n.getStreamInfo().id)),ve(n,F,NaN)):(t.debug("StreamController no next stream found"),F.setIsEndedEventSignaled(!1)),Ke(n?u.PlayListTrace.END_OF_PERIOD_STOP_REASON:u.PlayListTrace.END_OF_CONTENT_STOP_REASON)}e&&e.isLast&&(Me(),A.stopSteeringRequestTimer())}function Fe(e){var t=e||Xe().manifestInfo.duration;k.setDuration(t)}function Ue(e){var t=O.getURIFragmentData();if(!t||!t.t)return NaN;var n=nt()[0].getStreamInfo().start;return t.t=t.t.split(",")[0],Ge(e,t.t,n)}function He(e,t){var n=0;return e||(n=nt()[0].getStreamInfo().start),Ge(e,t,n)}function Ge(e,t,n){var r=S.getRegularPeriods()[0],i=t.toString(),o=-1!==i.indexOf("posix:")?"now"===i.substring(6)?Date.now()/1e3:parseFloat(i.substring(6)):NaN;return e&&!isNaN(o)?L.calcPresentationTimeFromWallTime(new Date(1e3*o),r):parseFloat(i)+n}function qe(e,t){try{var n=NaN;if(t&&!isNaN(t.maxFragmentDuration)&&isFinite(t.maxFragmentDuration))return t.maxFragmentDuration;if(e&&1===e.length){var i=e[0],o=[r.default.VIDEO,r.default.AUDIO,r.default.TEXT].reduce((function(e,t){var n=S.getMediaInfoForType(i,t);return n&&!1!==n.isFragmented&&e.push(n),e}),[]).reduce((function(e,t){var n=S.getVoRepresentations(t);return n&&n.length>0&&n.forEach((function(t){t&&e.push(t)})),e}),[]).reduce((function(e,t){var n=S.convertRepresentationToRepresentationInfo(t);return n&&n.fragmentDuration&&!isNaN(n.fragmentDuration)&&e.push(n.fragmentDuration),e}),[]);n=Math.max.apply(Math,x(o))}return isFinite(n)?n:NaN}catch(e){return NaN}}function Ve(e){if(e.error)W=!0,et();else{t.info("Manifest updated... updating data system wide.");var n=e.manifest;S.updatePeriods(n);var r=S.getUTCTimingSources();!S.getIsDynamic()||r&&0!==r.length||pe.trigger(h.default.CONFORMANCE_VIOLATION,{level:b.default.LEVELS.WARNING,event:b.default.EVENTS.NO_UTC_TIMING_ELEMENT});var i=S.getIsDynamic()?r.concat(Q.getUTCTimingSources()):r;c.filterUnsupportedFeatures(n).then((function(){j.initialize(n),C.attemptSync(i,S.getIsDynamic())}))}}function ze(){return!!F&&F.getHasVideoTrack()}function We(){return!!F&&F.getHasAudioTrack()}function Ke(e,t){t=t||new Date,Le().forEach((function(n){n.finalisePlayList(t,e)})),T.addPlayList()}function $e(e){T.createPlaylistMetrics(1e3*Y.getTime(),e)}function Ye(e){if(e.error){var n="";switch(e.error.code){case 1:n="MEDIA_ERR_ABORTED";break;case 2:n="MEDIA_ERR_NETWORK";break;case 3:n="MEDIA_ERR_DECODE",ue.counts.mediaErrorDecode+=1;break;case 4:n="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:n="MEDIA_ERR_ENCRYPTED";break;default:n="UNKNOWN"}"MEDIA_ERR_DECODE"===n&&se.get().errors.recoverAttempts.mediaErrorDecode>=ue.counts.mediaErrorDecode?function(){t.warn("A MEDIA_ERR_DECODE occured: Resetting the MediaSource");var e=Y.getTime();F.deactivate(!1),t.warn("MediaSource has been resetted. Resuming playback from time ".concat(e)),ye(e,!1,!1)}():(z=!0,e.error.message&&(n+=" ("+e.error.message+")"),e.error.msExtendedCode&&(n+=" (0x"+(e.error.msExtendedCode>>>0).toString(16).toUpperCase()+")"),t.fatal("Video Element Error: "+n),e.error&&t.fatal(e.error),M.error(new m.default(e.error.code,n)),et())}}function Xe(){return F?F.getStreamInfo():null}function Je(e){for(var t=0,n=B.length;t<n;t++)if(B[t].getId()===e)return B[t];return null}function Qe(e){isNaN(e.newDuration)||Fe(e.newDuration)}function Ze(){B=[],ce=NaN,U=null,V=!1,F=null,z=!1,W=!1,ee=!0,te=!0,Z=!1,q=!0,ne=null,ae=!1,oe=!1,ie=[],le=null,ue={counts:{mediaErrorDecode:0}}}function et(){he(),C.reset(),Ke(z||W?u.PlayListTrace.FAILURE_STOP_REASON:u.PlayListTrace.USER_REQUEST_STOP_REASON);for(var t=0,n=B?B.length:0;t<n;t++)B[t].reset(z);pe.off(h.default.PLAYBACK_TIME_UPDATED,Oe,e),pe.off(h.default.PLAYBACK_SEEKING,xe,e),pe.off(h.default.PLAYBACK_ERROR,Ye,e),pe.off(h.default.PLAYBACK_STARTED,Ne,e),pe.off(h.default.PLAYBACK_PAUSED,Re,e),pe.off(h.default.PLAYBACK_ENDED,Be,e),pe.off(h.default.METRIC_ADDED,tt,e),pe.off(h.default.MANIFEST_VALIDITY_CHANGED,Qe,e),pe.off(h.default.BUFFER_LEVEL_UPDATED,Ae,e),pe.off(h.default.QUALITY_CHANGE_REQUESTED,je,e),l.default.KEY_SESSION_UPDATED&&pe.off(l.default.KEY_SESSION_UPDATED,ge,e),pe.off(l.default.MANIFEST_UPDATED,Ve,e),pe.off(l.default.STREAM_BUFFERING_COMPLETED,Pe,e),pe.off(l.default.TIME_SYNCHRONIZATION_COMPLETED,fe,e),pe.off(l.default.CURRENT_TRACK_CHANGED,we,e),pe.off(l.default.SETTING_UPDATED_LIVE_DELAY,Ie,e),pe.off(l.default.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,Ie,e),j.reset(),E.reset(),P.reset(),T.clearAllCurrentMetrics(),w.setValue(null),_.reset(),L.reset(),D.reset(),K&&(k.detachMediaSource($),K=null),$=null,U&&(U=null,G=null,w.getValue()&&pe.trigger(l.default.PROTECTION_DESTROYED,{data:w.getValue().url})),Me(),pe.trigger(l.default.STREAM_TEARDOWN_COMPLETE),Ze()}function tt(e){if(e.metric===i.default.DVR_INFO){var t=We()?r.default.AUDIO:r.default.VIDEO;e.mediaType===t&&k.setSeekable(e.value.range.start,e.value.range.end)}}function nt(){return B}return e={initialize:function(t,n){he(),q=t,G=n,L.initialize(),(E=(0,s.default)(de).create()).setConfig({manifestModel:w,adapter:S,manifestLoader:_,errHandler:M,settings:se}),E.initialize(),(P=(0,y.default)(de).getInstance()).setConfig({manifestUpdater:E,playbackController:Y,settings:se}),P.start(),C.setConfig({dashMetrics:T,baseURLController:j,errHandler:M,settings:se}),C.initialize(),U&&(pe.trigger(l.default.PROTECTION_CREATED,{controller:U}),U.setMediaElement($.getElement()),G&&U.setProtectionData(G)),pe.on(h.default.PLAYBACK_TIME_UPDATED,Oe,e),pe.on(h.default.PLAYBACK_SEEKING,xe,e),pe.on(h.default.PLAYBACK_ERROR,Ye,e),pe.on(h.default.PLAYBACK_STARTED,Ne,e),pe.on(h.default.PLAYBACK_PAUSED,Re,e),pe.on(h.default.PLAYBACK_ENDED,Be,e),pe.on(h.default.METRIC_ADDED,tt,e),pe.on(h.default.MANIFEST_VALIDITY_CHANGED,Qe,e),pe.on(h.default.BUFFER_LEVEL_UPDATED,Ae,e),pe.on(h.default.QUALITY_CHANGE_REQUESTED,je,e),l.default.KEY_SESSION_UPDATED&&pe.on(l.default.KEY_SESSION_UPDATED,ge,e),pe.on(l.default.MANIFEST_UPDATED,Ve,e),pe.on(l.default.STREAM_BUFFERING_COMPLETED,Pe,e),pe.on(l.default.TIME_SYNCHRONIZATION_COMPLETED,fe,e),pe.on(l.default.CURRENT_TRACK_CHANGED,we,e),pe.on(l.default.SETTING_UPDATED_LIVE_DELAY,Ie,e),pe.on(l.default.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,Ie,e)},getActiveStreamInfo:Xe,addDVRMetric:Ce,hasVideoTrack:ze,hasAudioTrack:We,getStreamById:Je,getStreamForTime:ke,getTimeRelativeToStreamId:function(e,t){for(var n=null,r=0,i=0,o=null,s=0;s<B.length;s++){if(i=(n=B[s]).getStartTime(),o=n.getDuration(),Number.isFinite(i)&&(r=i),n.getId()===t)return e-r;Number.isFinite(o)&&(r+=o)}return null},load:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;he(),ce=t,_.load(e)},loadWithManifest:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;!function(){if(!E||!E.hasOwnProperty("setManifest"))throw new Error("initialize function has to be called previously")}(),ce=t,E.setManifest(e)},getActiveStreamProcessors:Le,setConfig:function(e){e&&(e.capabilities&&(n=e.capabilities),e.capabilitiesFilter&&(c=e.capabilitiesFilter),e.manifestLoader&&(_=e.manifestLoader),e.manifestModel&&(w=e.manifestModel),e.mediaPlayerModel&&(J=e.mediaPlayerModel),e.customParametersModel&&(Q=e.customParametersModel),e.protectionController&&(U=e.protectionController),e.adapter&&(S=e.adapter),e.dashMetrics&&(T=e.dashMetrics),e.errHandler&&(M=e.errHandler),e.timelineConverter&&(L=e.timelineConverter),e.videoModel&&($=e.videoModel),e.playbackController&&(Y=e.playbackController),e.serviceDescriptionController&&(X=e.serviceDescriptionController),e.contentSteeringController&&(A=e.contentSteeringController),e.textController&&(H=e.textController),e.abrController&&(N=e.abrController),e.mediaController&&(R=e.mediaController),e.settings&&(se=e.settings),e.baseURLController&&(j=e.baseURLController),e.uriFragmentModel&&(O=e.uriFragmentModel),e.segmentBaseController&&(I=e.segmentBaseController))},setProtectionData:function(e){G=e,U&&U.setProtectionData(G)},getIsStreamSwitchInProgress:function(){return V},switchToVideoElement:function(e){F&&(Y.initialize(Xe()),ye(e,!1,!0))},getHasMediaOrInitialisationError:function(){return z||W},getStreams:nt,getActiveStream:function(){return F},getInitialPlayback:function(){return ee},getAutoPlay:function(){return q},reset:et},t=(0,d.default)(de).getInstance().getLogger(e),C=(0,f.default)(de).getInstance(),k=(0,g.default)(de).getInstance(),D=(0,p.default)(de).getInstance(),Ze(),e}_.__dashjs_factory_name="StreamController";const w=c.default.getSingletonFactory(_)},"./src/streaming/controllers/TimeSyncController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>h});var r=n("./src/streaming/vo/DashJSError.js"),i=n("./src/streaming/vo/metrics/HTTPRequest.js"),o=n("./src/core/EventBus.js"),s=n("./src/core/events/Events.js"),a=n("./src/core/errors/Errors.js"),l=n("./src/core/FactoryMaker.js"),c=n("./src/core/Debug.js"),u=n("./src/streaming/utils/URLUtils.js");function d(){var e,t,n,l,d,p,h,f,g,m,v,y,b,x,E,_,w=this.context,S=(0,o.default)(w).getInstance(),T=(0,u.default)(w).getInstance();function k(){f=[],g=[],m=null,v=null,b=null,y=NaN,n=!1,l=!1,x=d.get().streaming.utcSynchronization.timeBetweenSyncAttempts}function C(){d.get().streaming.utcSynchronization.enabled&&!n&&!l&&b&&b.value&&b.schemeIdUri&&!isNaN(y)&&!isNaN(d.get().streaming.utcSynchronization.backgroundAttempts)&&(v&&(Date.now()-v)/1e3<30||(f=[],l=!0,function e(t){try{if(t<=0)return void B();var n=Date.now();p[b.schemeIdUri](b.value,(function(r){var i=Date.now(),o=A(n,i,r);f.push(o),e(t-1)}),(function(){B()}))}catch(e){B()}}(isNaN(d.get().streaming.utcSynchronization.backgroundAttempts)?2:d.get().streaming.utcSynchronization.backgroundAttempts)))}function A(e,t,n){return n-(t-(t-e)/2)}function j(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,t=isNaN(e);t&&d.get().streaming.utcSynchronization.useManifestDateHeaderTimeSource?function(){var e=h.getLatestMPDRequestHeaderValueByID("Date"),t=null!==e?new Date(e).getTime():Number.NaN;isNaN(t)?L(!0):L(!1,t-Date.now())}():L(t,e)}function I(e){var t=Date.parse(e);return isNaN(t)&&(t=function(e){var t,n,r=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/.exec(e);return t=Date.UTC(parseInt(r[1],10),parseInt(r[2],10)-1,parseInt(r[3],10),parseInt(r[4],10),parseInt(r[5],10),r[6]&&(parseInt(r[6],10)||0),r[7]&&1e3*parseFloat(r[7])||0),r[9]&&r[10]&&(n=60*parseInt(r[9],10)+parseInt(r[10],10),t+=("+"===r[8]?-1:1)*n*60*1e3),new Date(t).getTime()}(e)),t}function O(e){return Date.parse(e)}function N(e){return Date.parse(e)}function R(e,t,n){n()}function P(e,t,n){var r=I(e);isNaN(r)?n():t(r)}function D(e,t,n,r,o){var s,a,l=!1,c=new XMLHttpRequest,u=o?i.HTTPRequest.HEAD:i.HTTPRequest.GET,d=t.match(/\S+/g);if(t=d.shift(),s=function(){l||(l=!0,d.length?D(e,d.join(" "),n,r,o):r())},a=function(){var t,r;200===c.status&&(t=o?c.getResponseHeader("Date"):c.response,r=e(t),isNaN(r)||(n(r),l=!0))},T.isRelative(t)){var p=_.resolve();p&&(t=T.resolve(t,p.url))}c.open(u,t),c.timeout=5e3,c.onload=a,c.onloadend=s,c.send()}function M(e,t,n){D(N,e,t,n,!0)}function L(e,i){if(isNaN(y)||isNaN(i)||e||function(e){try{var n,r=F(e),i=isNaN(x)?30:x,o=isNaN(d.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor)?2:d.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor,s=isNaN(d.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts)?600:d.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts,a=isNaN(d.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts)?2:d.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts;r?(n=Math.min(i*o,s),t.debug("Increasing timeBetweenSyncAttempts to ".concat(n))):(n=Math.max(i/o,a),t.debug("Decreasing timeBetweenSyncAttempts to ".concat(n))),x=n}catch(e){}}(i),!e&&!isNaN(i)){m=Date.now(),n=!1;var o=isNaN(y);y=i,o&&C(),t.debug("Completed UTC sync. Setting client - server offset to ".concat(i))}e&&(b=null,n=!1,E.error(new r.default(a.default.TIME_SYNC_FAILED_ERROR_CODE,a.default.TIME_SYNC_FAILED_ERROR_MESSAGE))),S.trigger(s.default.UPDATE_TIME_SYNC_OFFSET,{offset:i}),S.trigger(s.default.TIME_SYNCHRONIZATION_COMPLETED)}function B(){if(f&&0!==f.length){var e=f.reduce((function(e,t){return e+t}),0)/f.length;F(e)?t.debug("Completed background UTC sync. Offset is within allowed threshold and is not adjusted."):(t.debug("Completed background UTC sync. Setting client - server offset to ".concat(e)),y=e,S.trigger(s.default.UPDATE_TIME_SYNC_OFFSET,{offset:y})),l=!1,v=Date.now()}}function F(e){try{if(isNaN(y))return!0;var t=d.get().streaming.utcSynchronization.maximumAllowedDrift&&!isNaN(d.get().streaming.utcSynchronization.maximumAllowedDrift)?d.get().streaming.utcSynchronization.maximumAllowedDrift:100;return e>=y-t&&e<=y+t}catch(e){return!0}}return e={initialize:function(){k(),p={"urn:mpeg:dash:utc:http-head:2014":M,"urn:mpeg:dash:utc:http-xsdate:2014":D.bind(null,I),"urn:mpeg:dash:utc:http-iso:2014":D.bind(null,O),"urn:mpeg:dash:utc:direct:2014":P,"urn:mpeg:dash:utc:http-head:2012":M,"urn:mpeg:dash:utc:http-xsdate:2012":D.bind(null,I),"urn:mpeg:dash:utc:http-iso:2012":D.bind(null,O),"urn:mpeg:dash:utc:direct:2012":P,"urn:mpeg:dash:utc:http-ntp:2014":R,"urn:mpeg:dash:utc:ntp:2014":R,"urn:mpeg:dash:utc:sntp:2014":R}},attemptSync:function(e,t){g=e,n||(function(e){try{if(!e||!d.get().streaming.utcSynchronization.enabled)return!1;var t=isNaN(x)?30:x;return!(m&&t&&!isNaN(t))||(Date.now()-m)/1e3>=t}catch(e){return!0}}(t)?(n=!0,function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=t||0;if(!g||0===g.length||n>=g.length)j();else{var r=g[n];if(r)if(p.hasOwnProperty(r.schemeIdUri)){var i=(new Date).getTime();p[r.schemeIdUri](r.value,(function(e){var t=(new Date).getTime(),n=A(i,t,e);b=r,j(n)}),(function(){e(n+1)}))}else e(n+1);else j()}}()):S.trigger(s.default.TIME_SYNCHRONIZATION_COMPLETED))},setConfig:function(e){e&&(e.dashMetrics&&(h=e.dashMetrics),e.baseURLController&&(_=e.baseURLController),e.errHandler&&(E=e.errHandler),e.settings&&(d=e.settings))},reset:function(){k(),S.off(s.default.ATTEMPT_BACKGROUND_SYNC,C,e)}},t=(0,c.default)(w).getInstance().getLogger(e),S.on(s.default.ATTEMPT_BACKGROUND_SYNC,C,e),e}d.__dashjs_factory_name="TimeSyncController";var p=l.default.getSingletonFactory(d);p.HTTP_TIMEOUT_MS=5e3,l.default.updateSingletonFactory(d.__dashjs_factory_name,p);const h=p},"./src/streaming/controllers/XlinkController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});var r=n("./src/streaming/XlinkLoader.js"),i=n("./src/core/EventBus.js"),o=n("./src/core/events/Events.js"),s=n("./src/core/FactoryMaker.js"),a=n("./externals/xml2json.js"),l=n("./src/streaming/utils/URLUtils.js"),c=n("./src/dash/constants/DashConstants.js"),u="onLoad";function d(e){e=e||{};var t,n,s,d,p,h,f=this.context,g=(0,i.default)(f).getInstance(),m=(0,l.default)(f).getInstance();function v(e,t,n){var r,i,o={};o.elements=e,o.type=t,o.resolveType=n,0===o.elements.length&&b(o);for(var s=0;s<o.elements.length;s++)r=o.elements[s],i=m.isHTTPURL(r.url)?r.url:r.originalContent.BaseURL+r.url,h.load(i,r,o)}function y(e){var t,n,r="";if(t=e.element,n=e.resolveObject,t.resolvedContent){var i=0;0===t.resolvedContent.indexOf("<?xml")&&(i=t.resolvedContent.indexOf("?>")+2),r=t.resolvedContent.substr(0,i)+"<response>"+t.resolvedContent.substr(i)+"</response>",t.resolvedContent=p.xml_str2json(r)}(function(e){var t;for(t=0;t<e.elements.length;t++)if(!1===e.elements[t].resolved)return!1;return!0})(n)&&b(n)}function b(e){var t,n,r=[];if(function(e){var t,n,r,i,o,a,l=[];for(i=e.elements.length-1;i>=0;i--){if(n=(t=e.elements[i]).type+"_asArray",t.resolvedContent){if(t.resolvedContent)for(o=0;o<t.resolvedContent[n].length;o++)r=t.resolvedContent[n][o],l.push(r)}else delete t.originalContent["xlink:actuate"],delete t.originalContent["xlink:href"],l.push(t.originalContent);for(t.parentElement[n].splice(t.index,1),a=0;a<l.length;a++)t.parentElement[n].splice(t.index+a,0,l[a]);l=[]}e.elements.length>0&&s.run(d)}(e),"onActuate"===e.resolveType&&g.trigger(o.default.XLINK_READY,{manifest:d}),e.resolveType===u)switch(e.type){case c.default.PERIOD:for(t=0;t<d[c.default.PERIOD+"_asArray"].length;t++)(n=d[c.default.PERIOD+"_asArray"][t]).hasOwnProperty(c.default.ADAPTATION_SET+"_asArray")&&(r=r.concat(x(n[c.default.ADAPTATION_SET+"_asArray"],n,c.default.ADAPTATION_SET,u))),n.hasOwnProperty(c.default.EVENT_STREAM+"_asArray")&&(r=r.concat(x(n[c.default.EVENT_STREAM+"_asArray"],n,c.default.EVENT_STREAM,u)));v(r,c.default.ADAPTATION_SET,u);break;case c.default.ADAPTATION_SET:g.trigger(o.default.XLINK_READY,{manifest:d})}}function x(e,t,n,r){var i,o,s,a=[];for(o=e.length-1;o>=0;o--)(i=e[o]).hasOwnProperty("xlink:href")&&"urn:mpeg:dash:resolve-to-zero:2013"===i["xlink:href"]&&e.splice(o,1);for(o=0;o<e.length;o++)(i=e[o]).hasOwnProperty("xlink:href")&&i.hasOwnProperty("xlink:actuate")&&i["xlink:actuate"]===r&&(s=E(i["xlink:href"],t,n,o,r,i),a.push(s));return a}function E(e,t,n,r,i,o){return{url:e,parentElement:t,type:n,index:r,resolveType:i,originalContent:o,resolvedContent:null,resolved:!1}}return t={resolveManifestOnLoad:function(e){p=new a.default({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:n}),(d=e).Period_asArray?v(x(d.Period_asArray,d,c.default.PERIOD,u),c.default.PERIOD,u):g.trigger(o.default.XLINK_READY,{manifest:d})},setMatchers:function(e){e&&(n=e)},setIron:function(e){e&&(s=e)},reset:function(){g.off(o.default.XLINK_ELEMENT_LOADED,y,t),h&&(h.reset(),h=null)}},g.on(o.default.XLINK_ELEMENT_LOADED,y,t),h=(0,r.default)(f).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,settings:e.settings}),t}d.__dashjs_factory_name="XlinkController";const p=s.default.getClassFactory(d)},"./src/streaming/metrics/MetricsReporting.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var r=n("./src/streaming/metrics/utils/DVBErrorsTranslator.js"),i=n("./src/streaming/metrics/MetricsReportingEvents.js"),o=n("./src/streaming/metrics/controllers/MetricsCollectionController.js"),s=n("./src/streaming/metrics/metrics/MetricsHandlerFactory.js"),a=n("./src/streaming/metrics/reporting/ReportingFactory.js");function l(){var e=this.context;return{createMetricsReporting:function(t){return(0,r.default)(e).getInstance({eventBus:t.eventBus,dashMetrics:t.dashMetrics,metricsConstants:t.metricsConstants,events:t.events}).initialise(),(0,o.default)(e).create(t)},getReportingFactory:function(){return(0,a.default)(e).getInstance()},getMetricsHandlerFactory:function(){return(0,s.default)(e).getInstance()}}}l.__dashjs_factory_name="MetricsReporting";var c=dashjs.FactoryMaker.getClassFactory(l);c.events=i.default,dashjs.FactoryMaker.updateClassFactory(l.__dashjs_factory_name,c);const u=c},"./src/streaming/metrics/MetricsReportingEvents.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/core/events/EventsBase.js");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const a=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(n,r.default);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var o=s(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,n)}}(n);function n(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(e=t.call(this)).METRICS_INITIALISATION_COMPLETE="internal_metricsReportingInitialized",e.BECAME_REPORTING_PLAYER="internal_becameReportingPlayer",e.CMCD_DATA_GENERATED="cmcdDataGenerated",e}return n}())},"./src/streaming/metrics/controllers/MetricsCollectionController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/streaming/metrics/controllers/MetricsController.js"),i=n("./src/streaming/metrics/utils/ManifestParsing.js"),o=n("./src/streaming/metrics/MetricsReportingEvents.js");function s(e){var t;e=e||{};var n={},s=this.context,a=e.eventBus,l=e.events;function c(t){if(!t.error){var l=Object.keys(n);(0,i.default)(s).getInstance({adapter:e.adapter,constants:e.constants}).getMetrics(t.manifest).forEach((function(t){var i=JSON.stringify(t);if(n.hasOwnProperty(i))l.splice(i,1);else try{var o=(0,r.default)(s).create(e);o.initialize(t),n[i]=o}catch(e){}})),l.forEach((function(e){n[e].reset(),delete n[e]})),a.trigger(o.default.METRICS_INITIALISATION_COMPLETE)}}function u(){Object.keys(n).forEach((function(e){n[e].reset()})),n={}}return t={reset:function(){a.off(l.MANIFEST_UPDATED,c,t),a.off(l.STREAM_TEARDOWN_COMPLETE,u,t)}},a.on(l.MANIFEST_UPDATED,c,t),a.on(l.STREAM_TEARDOWN_COMPLETE,u,t),t}s.__dashjs_factory_name="MetricsCollectionController";const a=dashjs.FactoryMaker.getClassFactory(s)},"./src/streaming/metrics/controllers/MetricsController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/streaming/metrics/controllers/RangeController.js"),i=n("./src/streaming/metrics/controllers/ReportingController.js"),o=n("./src/streaming/metrics/controllers/MetricsHandlersController.js");function s(e){var t,n,s;e=e||{};var a=this.context;function l(){t&&t.reset(),n&&n.reset(),s&&s.reset()}return{initialize:function(c){try{(s=(0,r.default)(a).create({mediaElement:e.mediaElement})).initialize(c.Range),(n=(0,i.default)(a).create({debug:e.debug,metricsConstants:e.metricsConstants,mediaPlayerModel:e.mediaPlayerModel})).initialize(c.Reporting,s),(t=(0,o.default)(a).create({debug:e.debug,eventBus:e.eventBus,metricsConstants:e.metricsConstants,events:e.events})).initialize(c.metrics,n)}catch(e){throw l(),e}},reset:l}}s.__dashjs_factory_name="MetricsController";const a=dashjs.FactoryMaker.getClassFactory(s)},"./src/streaming/metrics/controllers/MetricsHandlersController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/streaming/metrics/metrics/MetricsHandlerFactory.js");function i(e){e=e||{};var t,n=[],i=this.context,o=e.eventBus,s=e.events,a=(0,r.default)(i).getInstance({debug:e.debug,eventBus:e.eventBus,metricsConstants:e.metricsConstants});function l(e){n.forEach((function(t){t.handleNewMetric(e.metric,e.value,e.mediaType)}))}return t={initialize:function(e,r){e.split(",").forEach((function(e,t,i){var o;if(-1!==e.indexOf("(")&&-1===e.indexOf(")")){var s=i[t+1];s&&-1===s.indexOf("(")&&-1!==s.indexOf(")")&&(e+=","+s,delete i[t+1])}(o=a.create(e,r))&&n.push(o)})),o.on(s.METRIC_ADDED,l,t),o.on(s.METRIC_UPDATED,l,t)},reset:function(){o.off(s.METRIC_ADDED,l,t),o.off(s.METRIC_UPDATED,l,t),n.forEach((function(e){return e.reset()})),n=[]}}}i.__dashjs_factory_name="MetricsHandlersController";const o=dashjs.FactoryMaker.getClassFactory(i)},"./src/streaming/metrics/controllers/RangeController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/streaming/utils/CustomTimeRanges.js");function i(e){e=e||{};var t,n,i=!1,o=this.context,s=e.mediaElement;return t={initialize:function(e){e&&e.length&&(e.forEach((function(e){var t=e.starttime,r=t+e.duration;n.add(t,r)})),i=!!e[0]._useWallClockTime)},reset:function(){n.clear()},isEnabled:function(){var e,t=n.length;if(!t)return!0;e=i?(new Date).getTime()/1e3:s.currentTime;for(var r=0;r<t;r+=1){var o=n.start(r),a=n.end(r);if(o<=e&&e<a)return!0}return!1}},n=(0,r.default)(o).create(),t}i.__dashjs_factory_name="RangeController";const o=dashjs.FactoryMaker.getClassFactory(i)},"./src/streaming/metrics/controllers/ReportingController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/streaming/metrics/reporting/ReportingFactory.js");function i(e){var t=[],n=(0,r.default)(this.context).getInstance(e);return{initialize:function(e,r){e.some((function(e){var i=n.create(e,r);if(i)return t.push(i),!0}))},reset:function(){t.forEach((function(e){return e.reset()})),t=[]},report:function(e,n){t.forEach((function(t){return t.report(e,n)}))}}}i.__dashjs_factory_name="ReportingController";const o=dashjs.FactoryMaker.getClassFactory(i)},"./src/streaming/metrics/metrics/MetricsHandlerFactory.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var r=n("./src/streaming/metrics/metrics/handlers/BufferLevelHandler.js"),i=n("./src/streaming/metrics/metrics/handlers/DVBErrorsHandler.js"),o=n("./src/streaming/metrics/metrics/handlers/HttpListHandler.js"),s=n("./src/streaming/metrics/metrics/handlers/GenericMetricHandler.js");function a(e){var t,n=(e=e||{}).debug?e.debug.getLogger(t):{},a=/([a-zA-Z]*)(\(([0-9]*)(\,\s*([a-zA-Z]*))?\))?/,l=this.context,c={BufferLevel:r.default,DVBErrors:i.default,HttpList:o.default,PlayList:s.default,RepSwitchList:s.default,TcpList:s.default};return{create:function(t,r){var i,o=t.match(a);if(o){try{(i=c[o[1]](l).create({eventBus:e.eventBus,metricsConstants:e.metricsConstants})).initialize(o[1],r,o[3],o[5])}catch(e){i=null,n.error("MetricsHandlerFactory: Could not create handler for type ".concat(o[1]," with args ").concat(o[3],", ").concat(o[5]," (").concat(e.message,")"))}return i}},register:function(e,t){c[e]=t},unregister:function(e){delete c[e]}}}a.__dashjs_factory_name="MetricsHandlerFactory";const l=dashjs.FactoryMaker.getSingletonFactory(a)},"./src/streaming/metrics/metrics/handlers/BufferLevelHandler.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/streaming/metrics/utils/HandlerHelpers.js");function i(e){var t,n,i,o,s;e=e||{};var a=this.context,l=(0,r.default)(a).getInstance(),c=[],u=e.metricsConstants;function d(){var e=function(){try{return Object.keys(c).map((function(e){return c[e]})).reduce((function(e,t){return e.level<t.level?e:t}))}catch(e){return}}();e&&s!==e.t&&(s=e.t,t.report(i,e))}return{initialize:function(e,r,s){r&&(n=l.validateN(s),t=r,i=l.reconstructFullMetricName(e,s),o=setInterval(d,n))},reset:function(){clearInterval(o),o=null,n=0,t=null,s=null},handleNewMetric:function(e,t,n){e===u.BUFFER_LEVEL&&(c[n]=t)}}}i.__dashjs_factory_name="BufferLevelHandler";const o=dashjs.FactoryMaker.getClassFactory(i)},"./src/streaming/metrics/metrics/handlers/DVBErrorsHandler.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});var r=n("./src/streaming/metrics/MetricsReportingEvents.js");const i=dashjs.FactoryMaker.getClassFactory((function(e){var t,n=(e=e||{}).eventBus,i=e.metricsConstants;function o(){n.off(r.default.METRICS_INITIALISATION_COMPLETE,o,this),n.trigger(r.default.BECAME_REPORTING_PLAYER)}return{initialize:function(e,i){i&&(t=i,n.on(r.default.METRICS_INITIALISATION_COMPLETE,o,this))},reset:function(){t=null},handleNewMetric:function(e,n){e===i.DVB_ERRORS&&t&&t.report(e,n)}}}))},"./src/streaming/metrics/metrics/handlers/GenericMetricHandler.js":(e,t,n)=>{"use strict";function r(){var e,t;return{initialize:function(n,r){e=n,t=r},reset:function(){t=null,e=void 0},handleNewMetric:function(n,r){n===e&&t&&t.report(e,r)}}}n.r(t),n.d(t,{default:()=>i}),r.__dashjs_factory_name="GenericMetricHandler";const i=dashjs.FactoryMaker.getClassFactory(r)},"./src/streaming/metrics/metrics/handlers/HttpListHandler.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/streaming/metrics/utils/HandlerHelpers.js");function i(e){var t,n,i,o,s;e=e||{};var a=[],l=(0,r.default)(this.context).getInstance(),c=e.metricsConstants;function u(){var e=a;e.length&&t&&t.report(o,e),a=[]}return{initialize:function(e,r,a,c){r&&(n=l.validateN(a),t=r,c&&c.length&&(i=c),o=l.reconstructFullMetricName(e,a,c),s=setInterval(u,n))},reset:function(){clearInterval(s),s=null,n=null,i=null,a=[],t=null},handleNewMetric:function(e,t){e===c.HTTP_REQUEST&&(i&&i!==t.type||a.push(t))}}}i.__dashjs_factory_name="HttpListHandler";const o=dashjs.FactoryMaker.getClassFactory(i)},"./src/streaming/metrics/reporting/ReportingFactory.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/streaming/metrics/reporting/reporters/DVBReporting.js");function i(e){e=e||{};var t,n={"urn:dvb:dash:reporting:2014":r.default},i=this.context,o=e.debug?e.debug.getLogger(t):{},s=e.metricsConstants,a=e.mediaPlayerModel||{};return{create:function(e,t){var r;try{(r=n[e.schemeIdUri](i).create({metricsConstants:s,mediaPlayerModel:a})).initialize(e,t)}catch(t){r=null,o.error("ReportingFactory: could not create Reporting with schemeIdUri ".concat(e.schemeIdUri," (").concat(t.message,")"))}return r},register:function(e,t){n[e]=t},unregister:function(e){delete n[e]}}}i.__dashjs_factory_name="ReportingFactory";const o=dashjs.FactoryMaker.getSingletonFactory(i)},"./src/streaming/metrics/reporting/reporters/DVBReporting.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/streaming/metrics/utils/MetricSerialiser.js"),i=n("./src/streaming/metrics/utils/RNG.js"),o=n("./src/streaming/models/CustomParametersModel.js");function s(e){var t;e=e||{};var n,s,a,l,c,u,d,p=this.context,h=[],f=e.metricsConstants;function g(){l=!1,c=!1,u=null,d=null}return t={report:function(e,t){Array.isArray(t)||(t=[t]),c&&d.isEnabled()&&t.forEach((function(t){var r=n.serialise(t);e!==f.DVB_ERRORS&&(r="metricname=".concat(e,"&").concat(r)),function(e,t,n){var r=new XMLHttpRequest;r.withCredentials=s.getXHRWithCredentialsForType(f.HTTP_REQUEST_DVB_REPORTING_TYPE);var i=function(){var e=h.indexOf(r);-1!==e&&(h.splice(e,1),!(r.status>=200&&r.status<300)&&n&&n())};h.push(r);try{r.open("GET",e),r.onloadend=i,r.onerror=i,r.send()}catch(e){r.onerror()}}(r="".concat(u,"?").concat(r),0,(function(){c=!1}))}))},initialize:function(e,t){var n;if(d=t,!(u=e.dvb_reportingUrl))throw new Error("required parameter missing (dvb:reportingUrl)");l||((n=e.dvb_probability)&&(1e3===n||n/1e3>=a.random())&&(c=!0),l=!0)},reset:function(){g()}},n=(0,r.default)(p).getInstance(),a=(0,i.default)(p).getInstance(),s=(0,o.default)(p).getInstance(),g(),t}s.__dashjs_factory_name="DVBReporting";const a=dashjs.FactoryMaker.getClassFactory(s)},"./src/streaming/metrics/utils/DVBErrorsTranslator.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/streaming/metrics/vo/DVBErrors.js"),i=n("./src/streaming/metrics/MetricsReportingEvents.js");function o(e){var t,n,o=(e=e||{}).eventBus,s=e.dashMetrics,a=e.metricsConstants,l=e.events;function c(e){var t=new r.default;if(n){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.mpdurl||(t.mpdurl=n.originalUrl||n.url),t.terror||(t.terror=new Date),s.addDVBErrors(t)}}function u(e){e.error||(n=e.manifest)}function d(e){c({errorcode:r.default.BASE_URL_CHANGED,servicelocation:e.entry})}function p(){c({errorcode:r.default.BECAME_REPORTER})}function h(e){switch(e.metric){case a.HTTP_REQUEST:(0===(t=e.value).responsecode||null==t.responsecode||t.responsecode>=400||t.responsecode<100||t.responsecode>=600)&&c({errorcode:t.responsecode||r.default.CONNECTION_ERROR,url:t.url,terror:t.tresponse,servicelocation:t._serviceLocation})}var t}function f(e){var t;switch(e.error?e.error.code:0){case MediaError.MEDIA_ERR_NETWORK:t=r.default.CONNECTION_ERROR;break;case MediaError.MEDIA_ERR_DECODE:t=r.default.CORRUPT_MEDIA_OTHER;break;default:return}c({errorcode:t})}return t={initialise:function(){o.on(l.MANIFEST_UPDATED,u,t),o.on(l.SERVICE_LOCATION_BLACKLIST_CHANGED,d,t),o.on(l.METRIC_ADDED,h,t),o.on(l.METRIC_UPDATED,h,t),o.on(l.PLAYBACK_ERROR,f,t),o.on(i.default.BECAME_REPORTING_PLAYER,p,t)},reset:function(){o.off(l.MANIFEST_UPDATED,u,t),o.off(l.SERVICE_LOCATION_BLACKLIST_CHANGED,d,t),o.off(l.METRIC_ADDED,h,t),o.off(l.METRIC_UPDATED,h,t),o.off(l.PLAYBACK_ERROR,f,t),o.off(i.default.BECAME_REPORTING_PLAYER,p,t)}}}o.__dashjs_factory_name="DVBErrorsTranslator";const s=dashjs.FactoryMaker.getSingletonFactory(o)},"./src/streaming/metrics/utils/HandlerHelpers.js":(e,t,n)=>{"use strict";function r(){return{reconstructFullMetricName:function(e,t,n){var r=e;return t&&(r+="("+t,n&&n.length&&(r+=","+n),r+=")"),r},validateN:function(e){if(!e)throw new Error("missing n");if(isNaN(e))throw new Error("n is NaN");if(e<0)throw new Error("n must be positive");return e}}}n.r(t),n.d(t,{default:()=>i}),r.__dashjs_factory_name="HandlerHelpers";const i=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/metrics/utils/ManifestParsing.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/streaming/metrics/vo/Metrics.js"),i=n("./src/streaming/metrics/vo/Range.js"),o=n("./src/streaming/metrics/vo/Reporting.js");function s(e){var t=(e=e||{}).adapter,n=e.constants;return{getMetrics:function(e){var s=[];return e&&e.Metrics_asArray&&e.Metrics_asArray.forEach((function(a){var l=new r.default,c=t.getIsDynamic(e);a.hasOwnProperty("metrics")&&(l.metrics=a.metrics,a.Range_asArray&&a.Range_asArray.forEach((function(r){var o=new i.default;o.starttime=function(e,r,i){var o,s,a=0;return r?a=t.getAvailabilityStartTime(e)/1e3:(o=t.getRegularPeriods(e)).length&&(a=o[0].start),s=a,i&&i.hasOwnProperty(n.START_TIME)&&(s+=i.starttime),s}(e,c,r),r.hasOwnProperty("duration")?o.duration=r.duration:o.duration=t.getDuration(e),o._useWallClockTime=c,l.Range.push(o)})),a.Reporting_asArray&&(a.Reporting_asArray.forEach((function(e){var t=new o.default;e.hasOwnProperty(n.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty("value")&&(t.value=e.value),e.hasOwnProperty(n.DVB_REPORTING_URL)&&(t.dvb_reportingUrl=e[n.DVB_REPORTING_URL]),e.hasOwnProperty(n.DVB_PROBABILITY)&&(t.dvb_probability=e[n.DVB_PROBABILITY]),l.Reporting.push(t))})),s.push(l)))})),s}}}s.__dashjs_factory_name="ManifestParsing";const a=dashjs.FactoryMaker.getSingletonFactory(s)},"./src/streaming/metrics/utils/MetricSerialiser.js":(e,t,n)=>{"use strict";function r(){return{serialise:function e(t){var n,r,i=[],o=[];for(n in t)if(t.hasOwnProperty(n)&&0!==n.indexOf("_")){if(null==(r=t[n])&&(r=""),Array.isArray(r)){if(!r.length)continue;o=[],r.forEach((function(t){var n="Object"!==Object.prototype.toString.call(t).slice(8,-1);o.push(n?t:e(t))})),r=o.map(encodeURIComponent).join(",")}else"string"==typeof r?r=encodeURIComponent(r):r instanceof Date?r=r.toISOString():"number"==typeof r&&(r=Math.round(r));i.push(n+"="+r)}return i.join("&")}}}n.r(t),n.d(t,{default:()=>i}),r.__dashjs_factory_name="MetricSerialiser";const i=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/metrics/utils/RNG.js":(e,t,n)=>{"use strict";function r(){var e,t,n,r=window.crypto||window.msCrypto,i=Uint32Array,o=Math.pow(2,8*i.BYTES_PER_ELEMENT)-1;function s(){r&&(e||(e=new i(10)),r.getRandomValues(e),t=0)}return n={random:function(n,i){var a;return n||(n=0),i||(i=1),r?(t===e.length&&s(),a=e[t]/o,t+=1):a=Math.random(),a*(i-n)+n}},s(),n}n.r(t),n.d(t,{default:()=>i}),r.__dashjs_factory_name="RNG";const i=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/metrics/vo/DVBErrors.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});var r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mpdurl=null,this.errorcode=null,this.terror=null,this.url=null,this.ipaddress=null,this.servicelocation=null};r.SSL_CONNECTION_FAILED_PREFIX="SSL",r.DNS_RESOLUTION_FAILED="C00",r.HOST_UNREACHABLE="C01",r.CONNECTION_REFUSED="C02",r.CONNECTION_ERROR="C03",r.CORRUPT_MEDIA_ISOBMFF="M00",r.CORRUPT_MEDIA_OTHER="M01",r.BASE_URL_CHANGED="F00",r.BECAME_REPORTER="S00";const i=r},"./src/streaming/metrics/vo/Metrics.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.metrics="",this.Range=[],this.Reporting=[]}},"./src/streaming/metrics/vo/Range.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.starttime=0,this.duration=1/0,this._useWallClockTime=!1}},"./src/streaming/metrics/vo/Reporting.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri="",this.value="",this.dvb_reportingUrl="",this.dvb_probability=1e3}},"./src/streaming/models/BaseURLTreeModel.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var r=n("./src/streaming/utils/ObjectUtils.js"),i=n("./src/core/FactoryMaker.js"),o=NaN,s=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data={baseUrls:t||null,selectedIdx:n||o},this.children=[]};function a(){var e,t,n,i=this.context,a=(0,r.default)(i).getInstance();function l(e,t,r){var i=n.getBaseURLsFromElement(r);e[t]?a.areEqual(i,e[t].data.baseUrls)||(e[t].data.baseUrls=i,e[t].data.selectedIdx=o):e[t]=new s(i)}function c(){t=new s}return e={reset:c,update:function(e){!function(e){!function(){if(!n||!n.hasOwnProperty("getBaseURLsFromElement")||!n.hasOwnProperty("getRepresentationSortFunction"))throw new Error("setConfig function has to be called previously")}();var r=n.getBaseURLsFromElement(e);a.areEqual(r,t.data.baseUrls)||(t.data.baseUrls=r,t.data.selectedIdx=o),e&&e.Period_asArray&&e.Period_asArray.forEach((function(e,r){l(t.children,r,e),e.AdaptationSet_asArray&&e.AdaptationSet_asArray.forEach((function(e,i){l(t.children[r].children,i,e),e.Representation_asArray&&e.Representation_asArray.sort(n.getRepresentationSortFunction()).forEach((function(e,n){l(t.children[r].children[i].children,n,e)}))}))}))}(e)},getForPath:function(e){var n=t,r=[n.data];return e&&e.forEach((function(e){(n=n.children[e])&&r.push(n.data)})),r.filter((function(e){return e.baseUrls.length}))},invalidateSelectedIndexes:function(e){!function e(n,r){var i=r||t;n(i.data),i.children&&i.children.forEach((function(t){return e(n,t)}))}((function(t){isNaN(t.selectedIdx)||e===t.baseUrls[t.selectedIdx].serviceLocation&&(t.selectedIdx=o)}))},setConfig:function(e){e.adapter&&(n=e.adapter)}},c(),e}a.__dashjs_factory_name="BaseURLTreeModel";const l=i.default.getClassFactory(a)},"./src/streaming/models/CmcdModel.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>C});var r=n("./src/core/EventBus.js"),i=n("./src/streaming/MediaPlayerEvents.js"),o=n("./src/streaming/metrics/MetricsReportingEvents.js"),s=n("./src/core/FactoryMaker.js"),a=n("./src/core/Settings.js"),l=n("./src/streaming/constants/Constants.js"),c=n("./src/streaming/vo/metrics/HTTPRequest.js"),u=n("./src/dash/models/DashManifestModel.js"),d=n("./src/core/Utils.js");function p(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var f="m",g="a",m="v",v="i",y="c",b="tt",x="k",E="o",_="d",w="s",S="v",T="l";function k(){var e,t,n,s,h,k,C,A,j,I,O=this.context,N=(0,r.default)(O).getInstance(),R=(0,a.default)(O).getInstance();function P(){n={pr:1,nor:null,st:null,sf:null,sid:"".concat(d.default.generateUuid()),cid:null},j={},A={},I={},M()}function D(){M()}function M(){if(k){var e=k.getStreamController();if(e&&"function"==typeof e.getActiveStream){var t=e.getActiveStream();t&&(C=t.getProcessors())}}}function L(e,t){var n,r={},i=p(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;e[o]&&(r[o]=e[o])}}catch(e){i.e(e)}finally{i.f()}return r}function B(e){var t=R.get().streaming.cmcd.enabledKeys;return e.filter((function(e){return t.includes(e)}))}function F(e){try{return e.type===c.HTTPRequest.MPD_TYPE?((t=U()).ot=f,t):e.type===c.HTTPRequest.MEDIA_SEGMENT_TYPE?(function(e){I.hasOwnProperty(e)||(I[e]=!1),A.hasOwnProperty(e)||(A[e]=!1),j.hasOwnProperty(e)||(j[e]=!1)}(e.mediaType),function(e){var t,r=U(),i=function(e){try{var t=e.quality,n=e.mediaInfo.bitrateList;return parseInt(n[t].bandwidth/1e3)}catch(e){return null}}(e),o=function(e){try{return isNaN(e.duration)?null:Math.round(1e3*e.duration)}catch(e){return null}}(e),a=function(e){try{return 100*parseInt(s.getThroughputHistory().getSafeAverageThroughput(e)/100)}catch(e){return null}}(e.mediaType),c=function(e){try{var t=n.pr,r=h.getCurrentBufferLevel(e);return isNaN(t)||isNaN(r)?null:100*parseInt(r/t*10)}catch(e){return null}}(e.mediaType),u=H(e.mediaType),f=function(e){try{var t=s.getTopBitrateInfoFor(e);return Math.round(t.bitrate/1e3)}catch(e){return null}}(e.mediaType),v=n.pr,x=function(e){if(C&&0!==C.length){var t,n=p(C);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.getType()===e)return r.probeNextRequest()}}catch(e){n.e(e)}finally{n.f()}}}(e.mediaType);e.mediaType===l.default.VIDEO&&(t=m),e.mediaType===l.default.AUDIO&&(t=g),e.mediaType===l.default.TEXT&&(t="application/mp4"===e.mediaInfo.mimeType?b:y);var E=R.get().streaming.cmcd.rtp;return E||(E=function(e){var t=k.getPlaybackRate();t||(t=1);var n=e.quality,r=e.mediaType,i=e.mediaInfo,o=e.duration,s=H(r);0===s&&(s=500);var a=i.bitrateList[n].bandwidth*o/1e3/(s/t/1e3),l=R.get().streaming.cmcd.rtpSafetyFactor&&!isNaN(R.get().streaming.cmcd.rtpSafetyFactor)?R.get().streaming.cmcd.rtpSafetyFactor:5;return 100*(parseInt(a*l/100)+1)}(e)),r.rtp=E,x&&(e.url!==x.url?r.nor=encodeURIComponent(d.default.getRelativeUrl(e.url,x.url)):x.range&&(r.nrr=x.range)),i&&(r.br=i),t&&(r.ot=t),isNaN(o)||(r.d=o),isNaN(a)||(r.mtp=a),isNaN(c)||(r.dl=c),isNaN(u)||(r.bl=u),isNaN(f)||(r.tb=f),isNaN(v)||1===v||(r.pr=v),j[e.mediaType]&&(r.bs=!0,j[e.mediaType]=!1),!A[e.mediaType]&&I[e.mediaType]||(r.su=!0,A[e.mediaType]=!1,I[e.mediaType]=!0),r}(e)):e.type===c.HTTPRequest.INIT_SEGMENT_TYPE?function(){var e=U();return e.ot=v,e.su=!0,e}():e.type===c.HTTPRequest.OTHER_TYPE||e.type===c.HTTPRequest.XLINK_EXPANSION_TYPE?function(){var e=U();return e.ot=E,e}():e.type===c.HTTPRequest.LICENSE?function(e){var t=U();return t.ot=x,t}():null}catch(e){return null}var t}function U(){var e={},t=R.get().streaming.cmcd.cid?R.get().streaming.cmcd.cid:n.cid;return e.v=1,e.sid=R.get().streaming.cmcd.sid?R.get().streaming.cmcd.sid:n.sid,e.sid="".concat(e.sid),t&&(e.cid="".concat(t)),isNaN(n.pr)||1===n.pr||null===n.pr||(e.pr=n.pr),n.st&&(e.st=n.st),n.sf&&(e.sf=n.sf),e}function H(e){try{var t=h.getCurrentBufferLevel(e);return isNaN(t)?null:100*parseInt(10*t)}catch(e){return null}}function G(e){try{n.pr=e.playbackRate}catch(e){}}function q(t){try{var r=e.getIsDynamic(t.data)?T:S,i=t.protocol&&"MSS"===t.protocol?w:_;n.st="".concat(r),n.sf="".concat(i)}catch(e){}}function V(e){try{e.state&&e.mediaType&&e.state===i.default.BUFFER_EMPTY&&(j[e.mediaType]||(j[e.mediaType]=!0),A[e.mediaType]||(A[e.mediaType]=!0))}catch(e){}}function z(){for(var e in j)j.hasOwnProperty(e)&&(j[e]=!0);for(var t in A)A.hasOwnProperty(t)&&(A[t]=!0)}function W(e){try{if(!e)return null;var t=Object.keys(e).sort((function(e,t){return e.localeCompare(t)})),n=t.length,r=t.reduce((function(t,r,i){return"v"===r&&1===e[r]||("string"==typeof e[r]&&"ot"!==r&&"sf"!==r&&"st"!==r?t+="".concat(r,"=").concat(JSON.stringify(e[r])):t+="".concat(r,"=").concat(e[r]),i<n-1&&(t+=",")),t}),"");return(r=r.replace(/=true/g,"")).replace(/,\s*$/,"")}catch(e){return null}}return t={getQueryParameter:function(e){try{if(R.get().streaming.cmcd&&R.get().streaming.cmcd.enabled){var t=F(e),n=W(function(e){try{var t=R.get().streaming.cmcd.enabledKeys;return Object.keys(e).filter((function(e){return t.includes(e)})).reduce((function(t,n){return t[n]=e[n],t}),{})}catch(t){return e}}(t));return N.trigger(o.default.CMCD_DATA_GENERATED,{url:e.url,mediaType:e.mediaType,cmcdData:t,cmcdString:n}),{key:"CMCD",value:n}}return null}catch(e){return null}},getHeaderParameters:function(e){try{if(R.get().streaming.cmcd&&R.get().streaming.cmcd.enabled){var t=F(e),n=L(t,B(["br","d","ot","tb"])),r=L(t,B(["bl","dl","mtp","nor","nrr","su"])),i=L(t,B(["bs","rtp"])),s=L(t,B(["cid","pr","sf","sid","st","v"])),a={"CMCD-Object":W(n),"CMCD-Request":W(r),"CMCD-Status":W(i),"CMCD-Session":W(s)};return N.trigger(o.default.CMCD_DATA_GENERATED,{url:e.url,mediaType:e.mediaType,cmcdData:t,headers:a}),a}return null}catch(e){return null}},setConfig:function(e){e&&(e.abrController&&(s=e.abrController),e.dashMetrics&&(h=e.dashMetrics),e.playbackController&&(k=e.playbackController))},reset:function(){N.off(i.default.PLAYBACK_RATE_CHANGED,G,this),N.off(i.default.MANIFEST_LOADED,q,this),N.off(i.default.BUFFER_LEVEL_STATE_CHANGED,V,t),N.off(i.default.PLAYBACK_SEEKED,z,t),P()},initialize:function(){N.on(i.default.PLAYBACK_RATE_CHANGED,G,t),N.on(i.default.MANIFEST_LOADED,q,t),N.on(i.default.BUFFER_LEVEL_STATE_CHANGED,V,t),N.on(i.default.PLAYBACK_SEEKED,z,t),N.on(i.default.PERIOD_SWITCH_COMPLETED,D,t)}},e=(0,u.default)(O).getInstance(),P(),t}k.__dashjs_factory_name="CmcdModel";const C=s.default.getSingletonFactory(k)},"./src/streaming/models/CmsdModel.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>k});var r=n("./src/core/FactoryMaker.js"),i=n("./src/core/EventBus.js"),o=n("./src/core/events/Events.js"),s=n("./src/core/Debug.js");function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){l=function(e,t){return new o(e,void 0,t)};var n=c(RegExp),r=RegExp.prototype,i=new WeakMap;function o(e,t,r){var o=n.call(this,e,t);return i.set(o,r||i.get(e)),o}function s(e,t){var n=i.get(t);return Object.keys(n).reduce((function(t,r){return t[r]=e[n[r]],t}),Object.create(null))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(o,n),o.prototype.exec=function(e){var t=r.exec.call(this,e);return t&&(t.groups=s(t,this)),t},o.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var n=i.get(this);return r[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+n[t]})))}if("function"==typeof t){var o=this;return r[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!==a(e[e.length-1])&&e.push(s(e,o)),t.apply(this,e)}))}return r[Symbol.replace].call(this,e,t)},l.apply(this,arguments)}function c(e){var t="function"==typeof Map?new Map:void 0;return(c=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return u(e,arguments,p(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),d(r,e)})(e)}function u(e,t,n){return(u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&d(i,n.prototype),i}).apply(null,arguments)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var h="static",f="dynamic",g="etp",m="mb",v="ot",y="rd",b="rtt",x="o",E="stream",_=[m,"st","sf","v"],w={video:"v",audio:"a",text:"tt",stream:E},S=/^[-0-9]/;function T(){var e,t,n,r,a=this.context,c=(0,i.default)(a).getInstance();function u(){n={},r={}}function d(e){e&&Object.keys(e).forEach((function(t){_.includes(t)||delete e[t]}))}function p(e){return!e||"false"!==e.toLowerCase()&&(S.test(e)?parseInt(e,10):e.replace(/["]+/g,""))}function T(e){try{for(var n={},r=e.split(","),i=0;i<r.length;i++){var o=r[i].split("="),s=o[0],a=p(o[1]);n[s]=a}return n}catch(e){t.error("Failed to parse CMSD-Static response header value:",e)}}function k(e){try{for(var n={},r=e.split(","),i=r[r.length-1].split(";"),o=1;o<i.length;o++){var s=i[o].split("="),a=s[0],l=p(s[1]);n[a]=l}return n}catch(e){return t.error("Failed to parse CMSD-Dynamic response header value:",e),[]}}function C(e){return w[e]||x}function A(e,t,i){var o=e===h?n:r,s=o[t]||{},a=o[E]||{};return s[i]||a[i]}return e={setConfig:function(){},initialize:function(){},reset:function(){u()},parseResponseHeaders:function(e,t){for(var i=null,s=null,a=e.split("\r\n"),u=a.length-1;u>=0;u--){var p=a[u].match(l(/^((?:(?!:)[\s\S])*):[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(.*)$/,{key:1,value:2}));if(p&&p.groups){var h=p.groups.key.toLowerCase(),f=p.groups.value;switch(h){case"cmsd-static":i=T(f),c.trigger(o.default.CMSD_STATIC_HEADER,i);break;case"cmsd-dynamic":s||(s=k(f))}}}var g=E;return i&&i[v]?g=i[v]:t&&(g=C(t)),d(n[g]),d(r[g]),i&&(n[g]=Object.assign(n[g]||{},i)),s&&(r[g]=Object.assign(r[g]||{},s)),{static:i,dynamic:s}},getMaxBitrate:function(e){var t=C(e);return A(f,t,m)||-1},getEstimatedThroughput:function(e){var t=C(e);return A(f,t,g)||null},getResponseDelay:function(e){var t=C(e);return A(f,t,y)||null},getRoundTripTime:function(e){var t=C(e);return A(f,t,b)||null}},t=(0,s.default)(a).getInstance().getLogger(e),u(),e}T.__dashjs_factory_name="CmsdModel";const k=r.default.getSingletonFactory(T)},"./src/streaming/models/CustomParametersModel.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var r=n("./src/dash/vo/UTCTiming.js"),i=n("./src/core/FactoryMaker.js"),o=n("./src/core/Settings.js"),s=n("./src/streaming/utils/SupervisorTools.js"),a=n("./src/streaming/rules/abr/ABRRulesCollection.js"),l=n("./src/streaming/constants/Constants.js");function c(){var e,t,n,i,c,u,d,p,h=this.context,f=(0,o.default)(h).getInstance();function g(){i=[],c=[],u=[],p=[],d=null,t=[]}function m(e,t){var n=-1;e.some((function(e,r){if(e===t)return n=r,!0})),n<0||e.splice(n,1)}function v(e){var t;for(t=0;t<p.length;t++)if(p[t].rulename===e)return t;return-1}function y(e,n){b(e,n);var i=new r.default;i.schemeIdUri=e,i.value=n,t.push(i)}function b(e,n){(0,s.checkParameterType)(e,"string"),(0,s.checkParameterType)(n,"string"),t.forEach((function(r,i){r.schemeIdUri===e&&r.value===n&&t.splice(i,1)}))}return e={getCustomInitialTrackSelectionFunction:function(){return d},setCustomInitialTrackSelectionFunction:function(e){d=e},resetCustomInitialTrackSelectionFunction:function(){d=null},getLicenseResponseFilters:function(){return c},getLicenseRequestFilters:function(){return i},getCustomCapabilitiesFilters:function(){return u},registerCustomCapabilitiesFilter:function(e){u.push(e)},registerLicenseResponseFilter:function(e){c.push(e)},registerLicenseRequestFilter:function(e){i.push(e)},unregisterCustomCapabilitiesFilter:function(e){m(u,e)},unregisterLicenseResponseFilter:function(e){m(c,e)},unregisterLicenseRequestFilter:function(e){m(i,e)},addAbrCustomRule:function(e,t,n){if("string"!=typeof e||e!==a.default.ABANDON_FRAGMENT_RULES&&e!==a.default.QUALITY_SWITCH_RULES||"string"!=typeof t)throw l.default.BAD_ARGUMENT_ERROR;var r=v(t);-1===r?p.push({type:e,rulename:t,rule:n}):(p[r].type=e,p[r].rule=n)},removeAllAbrCustomRule:function(){p=[]},removeAbrCustomRule:function(e){if(e){var t=v(e);-1!==t&&p.splice(t,1)}else p=[]},getAbrCustomRules:function(){return p},addUTCTimingSource:y,removeUTCTimingSource:b,getUTCTimingSources:function(){return t},clearDefaultUTCTimingSources:function(){t=[]},restoreDefaultUTCTimingSources:function(){var e=f.get().streaming.utcSynchronization.defaultTimingSource;y(e.scheme,e.value)},setXHRWithCredentialsForType:function e(t,r){t?n[t]=!!r:Object.keys(n).forEach((function(t){e(t,r)}))},getXHRWithCredentialsForType:function(e){var t=n[e];return void 0===t?n.default:t},setConfig:function(){},reset:function(){g()}},n={default:!1},g(),e}c.__dashjs_factory_name="CustomParametersModel";const u=i.default.getSingletonFactory(c)},"./src/streaming/models/FragmentModel.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var r=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/vo/FragmentRequest.js"),o="loading",s="executed",a="failed";function l(e){var t,n,r,l,c=(e=e||{}).eventBus,u=e.events,d=e.dashMetrics,p=e.fragmentLoader,h=e.debug,f=e.streamInfo,g=e.type;function m(e){var t;return!!e&&(t=!1,r.some((function(n){if(r=e,o=n,!isNaN(r.index)&&r.startTime===o.startTime&&r.adaptationIndex===o.adaptationIndex&&r.type===o.type||function(e,t){return isNaN(e.index)&&isNaN(t.index)&&e.quality===t.quality}(e,n)||function(e,t){return e.action===i.default.ACTION_COMPLETE&&e.action===t.action}(e,n))return t=!0;var r,o})),t)}function v(e){return isNaN(e.duration)?.25:Math.min(e.duration/8,.5)}function y(e){r=r.filter((function(t){var n=v(t);return isNaN(t.startTime)||void 0!==e&&t.startTime>=e-n}))}function b(e,t){t<=e+.5||(r=r.filter((function(n){var r=v(n);return isNaN(n.startTime)||n.startTime>=t-r||isNaN(n.duration)||n.startTime+n.duration<=e+r})))}function x(e,t,n){for(var r=e.length-1;r>=0;r--){var i=e[r],o=i.startTime,s=o+i.duration;if(n=isNaN(n)?v(i):n,!isNaN(o)&&!isNaN(s)&&t+n>=o&&t-n<s||isNaN(o)&&isNaN(t))return i}return null}function E(e,t){d.addSchedulingInfo(e,t),d.addRequestsQueue(e.mediaType,l,r)}function _(e){e.sender===p&&(l.splice(l.indexOf(e.request),1),e.response&&!e.error&&r.push(e.request),E(e.request,e.error?a:s),c.trigger(u.FRAGMENT_LOADING_COMPLETED,{request:e.request,response:e.response,error:e.error,sender:this},{streamId:f.id,mediaType:g}))}function w(e){e.sender===p&&c.trigger(u.FRAGMENT_LOADING_PROGRESS,{request:e.request,response:e.response,error:e.error,sender:this},{streamId:f.id,mediaType:g})}function S(e){e.sender===p&&c.trigger(u.FRAGMENT_LOADING_ABANDONED,{request:e.request},{streamId:f.id,mediaType:g})}function T(){r=[],l=[]}return t={getStreamId:function(){return f.id},getType:function(){return g},getRequests:function(e){var t=e?e.state instanceof Array?e.state:[e.state]:[],n=[];return t.forEach((function(t){var i=function(e){var t;switch(e){case o:t=l;break;case s:t=r;break;default:t=[]}return t}(t);n=n.concat(function(e,t){return t.hasOwnProperty("time")?[x(e,t.time,t.threshold)]:e.filter((function(e){for(var n in t)if("state"!==n&&t.hasOwnProperty(n)&&e[n]!=t[n])return!1;return!0}))}(i,e))})),n},isFragmentLoaded:m,isFragmentLoadedOrPending:function(e){var t,n=!1,r=0;if(!(n=m(e)))for(r=0;r<l.length;r++)t=l[r],e.url===t.url&&e.startTime===t.startTime&&(n=!0);return n},removeExecutedRequestsBeforeTime:y,removeExecutedRequestsAfterTime:function(e){r=r.filter((function(t){return isNaN(t.startTime)||void 0!==e&&t.startTime<e}))},syncExecutedRequestsWithBufferedRange:function(e,t){if(e&&0!==e.length){for(var n=0,r=0,i=e.length;r<i;r++)b(n,e.start(r)),n=e.end(r);t>0&&b(n,t)}else y()},abortRequests:function(){n.debug("abort requests"),p.abort(),l=[]},executeRequest:function(e){switch(e.action){case i.default.ACTION_DOWNLOAD:E(e,o),l.push(e),function(e){c.trigger(u.FRAGMENT_LOADING_STARTED,{request:e},{streamId:f.id,mediaType:g}),p.load(e)}(e);break;default:n.warn("Unknown request action.")}},reset:function(){c.off(u.LOADING_COMPLETED,_,this),c.off(u.LOADING_DATA_PROGRESS,w,this),c.off(u.LOADING_ABANDONED,S,this),p&&p.reset(),T()},resetInitialSettings:T,addExecutedRequest:function(e){r.push(e)}},n=h.getLogger(t),T(),c.on(u.LOADING_COMPLETED,_,t),c.on(u.LOADING_DATA_PROGRESS,w,t),c.on(u.LOADING_ABANDONED,S,t),t}l.__dashjs_factory_name="FragmentModel";var c=r.default.getClassFactory(l);c.FRAGMENT_MODEL_LOADING=o,c.FRAGMENT_MODEL_EXECUTED=s,c.FRAGMENT_MODEL_CANCELED="canceled",c.FRAGMENT_MODEL_FAILED=a,r.default.updateClassFactory(l.__dashjs_factory_name,c);const u=c},"./src/streaming/models/LowLatencyThroughputModel.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/core/Debug.js"),i=n("./src/core/FactoryMaker.js");function o(){var e,t,n=this.context,i={};function o(){t=(0,r.default)(n).getInstance().getLogger(e)}function s(e){for(var t={},n=0,r=0,i=0,o=0,s=e.length,a=0;a<s;++a)n+=e[a].chunkDownloadTimeRelativeMS,r+=e[a].bufferLevel,i+=e[a].chunkDownloadTimeRelativeMS*e[a].bufferLevel,o+=e[a].chunkDownloadTimeRelativeMS*e[a].chunkDownloadTimeRelativeMS;return t.m=(i-n*r/s)/(o-n*n/s),t.b=r/s-t.m*n/s,function(e){return t.m*e+t.b}}function a(e){var t,n=!0,r=e.reduce((function(e,t){return e+t.bufferLevelAtSegmentEnd}),0)/e.length;return e.forEach((function(e){Math.abs(e.bufferLevelAtSegmentEnd/e.bufferLevelAtSegmentStart)<.95&&(n=!1),e.bufferLevelAtSegmentEnd/r<.8&&(n=!1),t?t>e.bitrate&&(n=!1):t=e.bitrate})),n}return e={setup:o,addMeasurement:function(e,t,n,r,o){e&&e.mediaType&&!i[e.mediaType]&&(i[e.mediaType]=[]);var a=e.mediaInfo.bitrateList.find((function(t){return t.id===e.representationId}));i[e.mediaType].push({index:e.index,repId:e.representationId,mediaType:e.mediaType,requestTimeMS:r,adjustedAvailabilityStartTimeMS:e.availabilityStartTime.getTime(),segDurationMS:1e3*e.duration,chunksDurationMS:n.reduce((function(e,t){return e+t.chunkDownloadDurationMS}),0),segmentBytes:n.reduce((function(e,t){return e+t.chunkBytes}),0),bitrate:a&&a.bandwidth,bitrateList:e.mediaInfo.bitrateList,chunkMeasurements:n,fetchDownloadDurationMS:t,throughputCapacityDelayMS:o,getEstimatedBufferLevel:s(n.slice(1))}),i[e.mediaType].length>10&&i[e.mediaType].shift()},getThroughputCapacityDelayMS:function(e,t){var n=i[e.mediaType]&&i[e.mediaType].slice(-3);return!n||n.length<3?0:a(n)?t/4>250?250:t/4:0},getEstimatedDownloadDurationMS:function(e){var n=i[e.mediaType].slice(-1).pop(),r=i[e.mediaType].slice(-3),o=n.chunkMeasurements.slice(-1).pop().chunkDownloadTimeRelativeMS;n.bufferLevelAtSegmentStart=n.getEstimatedBufferLevel(o/2),n.bufferLevelAtSegmentEnd=n.getEstimatedBufferLevel(o);var s=a(r),l=s?.6:.8;if(n.isBufferStable&&1.05*n.segDurationMS<n.fetchDownloadDurationMS)return n.fetchDownloadDurationMS;if(!s||n.segDurationMS<n.fetchDownloadDurationMS)return.8*n.fetchDownloadDurationMS;if(n.adjustedAvailabilityStartTimeMS<=n.requestTimeMS+n.throughputCapacityDelayMS-n.segDurationMS)return.8*n.fetchDownloadDurationMS;for(var c=n.requestTimeMS+n.throughputCapacityDelayMS-n.adjustedAvailabilityStartTimeMS,u=0,d=0,p=0,h=0;h<n.chunkMeasurements.length;h++){var f=n.chunkMeasurements[h];if(c<d+f.chunkDownloadDurationMS)break;d+=f.chunkDownloadDurationMS,u+=f.chunkBytes,p++}if(c<0&&t.warn("request time was before adjusted availibitly start time"),u&&d&&p>.2*n.chunkMeasurements.length){var g=u/d,m=n.segmentBytes/g;return n.fetchDownloadDurationMS<m?n.fetchDownloadDurationMS*l:m*l}var v=n.bitrate;return n.bitrateList.some((function(e){if(e.bandwidth>n.bitrate)return v=e.bandwidth,!0})),v===n.bitrate?n.fetchDownloadDurationMS*l:l*n.segmentBytes*8*1e3/v}},o(),e}o.__dashjs_factory_name="LowLatencyThroughputModel";const s=i.default.getSingletonFactory(o)},"./src/streaming/models/ManifestModel.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/core/EventBus.js"),i=n("./src/core/events/Events.js"),o=n("./src/core/FactoryMaker.js");function s(){var e,t=this.context,n=(0,r.default)(t).getInstance();return{getValue:function(){return e},setValue:function(t){e=t,t&&n.trigger(i.default.MANIFEST_LOADED,{data:t})}}}s.__dashjs_factory_name="ManifestModel";const a=o.default.getSingletonFactory(s)},"./src/streaming/models/MediaPlayerModel.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var r=n("./src/core/Debug.js"),i=n("./src/core/FactoryMaker.js"),o=n("./src/core/Settings.js"),s=-.5;function a(){var e,t,n,i,a=this.context,l=(0,o.default)(a).getInstance();function c(e,n){return isNaN(e)?0:e>0?(n&&t.warn("Supplied minimum playback rate is a positive value when it should be negative or 0. The supplied rate will not be applied and set to 0: 100% playback speed."),0):e<s?(n&&t.warn("Supplied minimum playback rate is out of range and will be limited to ".concat(s,": ").concat(-50,"% playback speed.")),s):e}function u(e,n){return isNaN(e)?0:e<0?(n&&t.warn("Supplied maximum playback rate is a negative value when it should be negative or 0. The supplied rate will not be applied and set to 0: 100% playback speed."),0):e>1?(n&&t.warn("Supplied maximum playback rate is out of range and will be limited to ".concat(1,": ").concat(200,"% playback speed.")),1):e}function d(){var e=l.get().streaming.buffer.stableBufferTime>0?l.get().streaming.buffer.stableBufferTime:l.get().streaming.buffer.fastSwitchEnabled?20:12,t=n.getLiveDelay();return!isNaN(t)&&t>0?Math.min(e,t):e}return e={getCatchupMaxDrift:function(){if(!isNaN(l.get().streaming.liveCatchup.maxDrift)&&l.get().streaming.liveCatchup.maxDrift>0)return l.get().streaming.liveCatchup.maxDrift;var e=i.getServiceDescriptionSettings();return e&&e.liveCatchup&&!isNaN(e.liveCatchup.maxDrift)&&e.liveCatchup.maxDrift>0?e.liveCatchup.maxDrift:12},getCatchupModeEnabled:function(){return null!==l.get().streaming.liveCatchup.enabled?l.get().streaming.liveCatchup.enabled:n.getInitialCatchupModeActivated()},getStableBufferTime:d,getInitialBufferLevel:function(){var e=l.get().streaming.buffer.initialBufferLevel;return isNaN(e)||e<0?0:Math.min(d(),e)},getRetryAttemptsForType:function(e){var t=isNaN(l.get().streaming.retryAttempts.lowLatencyMultiplyFactor)?5:l.get().streaming.retryAttempts.lowLatencyMultiplyFactor;return n.getLowLatencyModeEnabled()?l.get().streaming.retryAttempts[e]*t:l.get().streaming.retryAttempts[e]},getRetryIntervalsForType:function(e){var t=isNaN(l.get().streaming.retryIntervals.lowLatencyReductionFactor)?10:l.get().streaming.retryIntervals.lowLatencyReductionFactor;return n.getLowLatencyModeEnabled()?l.get().streaming.retryIntervals[e]/t:l.get().streaming.retryIntervals[e]},getCatchupPlaybackRates:function(e){var t=l.get().streaming.liveCatchup.playbackRate;if(!isNaN(t.min)||!isNaN(t.max))return{min:c(t.min,e),max:u(t.max,e)};var n=i.getServiceDescriptionSettings();if(n&&n.liveCatchup&&(!isNaN(n.liveCatchup.playbackRate.min)||!isNaN(n.liveCatchup.playbackRate.max))){var r=n.liveCatchup.playbackRate;return{min:c(r.min,e),max:u(r.max,e)}}return{min:-.5,max:.5}},getAbrBitrateParameter:function(e,t){try{var n=l.get().streaming.abr[e][t];if(!isNaN(n)&&-1!==n)return n;var r=i.getServiceDescriptionSettings();return r&&r[e]&&!isNaN(r[e][t])?r[e][t]:-1}catch(e){return-1}},setConfig:function(e){e.playbackController&&(n=e.playbackController),e.serviceDescriptionController&&(i=e.serviceDescriptionController)},reset:function(){}},t=(0,r.default)(a).getInstance().getLogger(e),e}a.__dashjs_factory_name="MediaPlayerModel";const l=i.default.getSingletonFactory(a)},"./src/streaming/models/MetricsModel.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>b});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/streaming/constants/MetricsConstants.js"),o=n("./src/streaming/vo/MetricsList.js"),s=n("./src/streaming/vo/metrics/HTTPRequest.js"),a=n("./src/streaming/vo/metrics/RepresentationSwitch.js"),l=n("./src/streaming/vo/metrics/BufferLevel.js"),c=n("./src/streaming/vo/metrics/BufferState.js"),u=n("./src/streaming/vo/metrics/DVRInfo.js"),d=n("./src/streaming/vo/metrics/DroppedFrames.js"),p=n("./src/streaming/vo/metrics/ManifestUpdate.js"),h=n("./src/streaming/vo/metrics/SchedulingInfo.js"),f=n("./src/core/EventBus.js"),g=n("./src/streaming/vo/metrics/RequestsQueue.js"),m=n("./src/core/events/Events.js"),v=n("./src/core/FactoryMaker.js");function y(e){var t,n,v=(e=e||{}).settings,y=this.context,b=(0,f.default)(y).getInstance();function x(){b.trigger(m.default.METRICS_CHANGED)}function E(e){b.trigger(m.default.METRIC_CHANGED,{mediaType:e}),x()}function _(e,t,n){b.trigger(m.default.METRIC_UPDATED,{mediaType:e,metric:t,value:n}),E(e)}function w(e,t,n){b.trigger(m.default.METRIC_ADDED,{mediaType:e,metric:t,value:n}),E(e)}function S(e,t){var r=null;return e?(n.hasOwnProperty(e)?r=n[e]:t||(r=new o.default,n[e]=r),r):r}function T(e,t,n){var r=S(e);null!==r&&(r[t].push(n),r[t].length>v.get().streaming.metrics.maxListDepth&&r[t].shift())}function k(e,t,n){T(e,t,n),w(e,t,n)}return t={clearCurrentMetricsForType:function(e){delete n[e],E(e)},clearAllCurrentMetrics:function(){n={},x()},getMetricsFor:S,addHttpRequest:function e(t,n,r,o,a,l,c,u,d,p,h,f,g,m,v,y,b){var x=new s.HTTPRequest;l&&l!==o&&(e(t,null,r,o,a,null,null,u,d,null,null,null,g,null,null,y,b),x.actualurl=l),x.tcpid=n,x.type=r,x.url=o,x.range=u,x.trequest=d,x.tresponse=p,x.responsecode=f,x.cmsd=b,x._tfinish=h,x._stream=t,x._mediaduration=g,x._quality=a,x._responseHeaders=m,x._serviceLocation=c,x._fileLoaderType=y,v?v.forEach((function(e){!function(e,t,n,r){var i=new s.HTTPRequestTrace;i.s=t,i.d=n,i.b=r,e.trace.push(i),e.interval||(e.interval=0),e.interval+=n}(x,e.s,e.d,e.b)})):(delete x.interval,delete x.trace),k(t,i.default.HTTP_REQUEST,x)},addRepresentationSwitch:function(e,t,n,r,o){var s=new a.default;s.t=t,s.mt=n,s.to=r,o?s.lto=o:delete s.lto,k(e,i.default.TRACK_SWITCH,s)},addBufferLevel:function(e,t,n){var r=new l.default;r.t=t,r.level=n,k(e,i.default.BUFFER_LEVEL,r)},addBufferState:function(e,t,n){var r=new c.default;r.target=n,r.state=t,k(e,i.default.BUFFER_STATE,r)},addDVRInfo:function(e,t,n,r){var o=new u.default;o.time=t,o.range=r,o.manifestInfo=n,k(e,i.default.DVR_INFO,o)},addDroppedFrames:function(e,t){var n=new d.default,r=S(e).DroppedFrames;t&&(n.time=t.creationTime,n.droppedFrames=t.droppedVideoFrames,r.length>0&&r[r.length-1]==n||k(e,i.default.DROPPED_FRAMES,n))},addSchedulingInfo:function(e,t,n,r,o,s,a,l,c){var u=new h.default;u.mediaType=e,u.t=t,u.type=n,u.startTime=r,u.availabilityStartTime=o,u.duration=s,u.quality=a,u.range=l,u.state=c,k(e,i.default.SCHEDULING_INFO,u)},addRequestsQueue:function(e,t,n){var r=new g.default;r.loadingRequests=t,r.executedRequests=n,S(e).RequestsQueue=r,w(e,i.default.REQUESTS_QUEUE,r)},addManifestUpdate:function(e,t,n,o,s,a,l,c,u,d){var h=new p.ManifestUpdate;h.mediaType=e,h.type=t,h.requestTime=n,h.fetchTime=o,h.availabilityStartTime=s,h.presentationStartTime=a,h.clientTimeOffset=l,h.currentTime=c,h.buffered=u,h.latency=d,T(r.default.STREAM,i.default.MANIFEST_UPDATE,h),w(e,i.default.MANIFEST_UPDATE,h)},updateManifestUpdateInfo:function(e,t){if(e){for(var n in t)e[n]=t[n];_(e.mediaType,i.default.MANIFEST_UPDATE,e)}},addManifestUpdateStreamInfo:function(e,t,n,r,o){if(e){var s=new p.ManifestUpdateStreamInfo;s.id=t,s.index=n,s.start=r,s.duration=o,e.streamInfo.push(s),_(e.mediaType,i.default.MANIFEST_UPDATE_STREAM_INFO,e)}},addManifestUpdateRepresentationInfo:function(e,t,n,r,o,s,a,l){if(e&&e.representationInfo){var c=new p.ManifestUpdateRepresentationInfo;c.id=t,c.index=n,c.streamIndex=r,c.mediaType=o,c.startNumber=a,c.fragmentInfoType=l,c.presentationTimeOffset=s,e.representationInfo.push(c),_(e.mediaType,i.default.MANIFEST_UPDATE_TRACK_INFO,e)}},addPlayList:function(e){e.trace&&Array.isArray(e.trace)?e.trace.forEach((function(e){e.hasOwnProperty("subreplevel")&&!e.subreplevel&&delete e.subreplevel})):delete e.trace,k(r.default.STREAM,i.default.PLAY_LIST,e)},addDVBErrors:function(e){k(r.default.STREAM,i.default.DVB_ERRORS,e)}},n={},t}y.__dashjs_factory_name="MetricsModel";const b=v.default.getSingletonFactory(y)},"./src/streaming/models/URIFragmentModel.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/streaming/vo/URIFragmentData.js"),i=n("./src/core/FactoryMaker.js");function o(){var e;return{initialize:function(t){if(e=new r.default,!t)return null;var n=t.indexOf("#");if(-1!==n)for(var i=t.substr(n+1).split("&"),o=0,s=i.length;o<s;++o){var a=i[o],l=a.indexOf("=");if(-1!==l){var c=a.substring(0,l);e.hasOwnProperty(c)&&(e[c]=a.substr(l+1))}}},getURIFragmentData:function(){return e}}}o.__dashjs_factory_name="URIFragmentModel";const s=i.default.getSingletonFactory(o)},"./src/streaming/models/VideoModel.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var r=n("./src/core/FactoryMaker.js"),i=n("./src/core/EventBus.js"),o=n("./src/core/events/Events.js"),s=n("./src/core/Debug.js"),a=n("./src/streaming/constants/Constants.js"),l=new Map([[a.default.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,"loadedmetadata"],[a.default.VIDEO_ELEMENT_READY_STATES.HAVE_CURRENT_DATA,"loadeddata"],[a.default.VIDEO_ELEMENT_READY_STATES.HAVE_FUTURE_DATA,"canplay"],[a.default.VIDEO_ELEMENT_READY_STATES.HAVE_ENOUGH_DATA,"canplaythrough"]]);function c(){var e,t,n,r,c,u,d=this.context,p=(0,i.default)(d).getInstance(),h=[];function f(){n&&(n.playbackRate=1,n.removeEventListener("canplay",f))}function g(){return h.length>0}function m(){if(n&&g()&&0===n.playbackRate){var e=document.createEvent("Event");e.initEvent("waiting",!0,!1),n.dispatchEvent(e)}}function v(e,t){n&&n.addEventListener(e,t)}function y(e,t){n&&n.removeEventListener(e,t)}function b(){return n?n.readyState:NaN}function x(){return n?n.buffered:null}function E(e,t,r,i,o){if(n)for(var s=0;s<n.textTracks.length;s++)if(n.textTracks[s].kind===e&&(!t||n.textTracks[s].label==t)&&n.textTracks[s].language===r&&n.textTracks[s].isTTML===i&&n.textTracks[s].isEmbedded===o)return n.textTracks[s];return null}function _(e,t){e===a.default.VIDEO_ELEMENT_READY_STATES.HAVE_NOTHING||b()>=e?t():function(e,t){v(e,(function n(){y(e,n),t(e)}))}(l.get(e),t)}return e={initialize:function(){p.on(o.default.PLAYBACK_PLAYING,m,this)},setCurrentTime:function(e,t){n&&(r=e,_(a.default.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,(function(){if(n.currentTime!==r)try{r=t?function(e){var t=x(),n=e,r=9999999999;if(t)for(var i=0;i<t.length;i++){var o=t.start(i),s=t.end(i),a=Math.abs(o-e),l=Math.abs(s-e);if(e>=o&&e<=s)return e;a<r&&(r=a,n=o),l<r&&(r=l,n=s)}return n}(r):r,n.currentTime=r,r=NaN}catch(e){0===n.readyState&&e.code===e.INVALID_STATE_ERR&&setTimeout((function(){n.currentTime=r,r=NaN}),400)}else r=NaN})))},play:function(){if(n){n.autoplay=!0;var e=n.play();e&&e.catch&&"undefined"!=typeof Promise&&e.catch((function(e){"NotAllowedError"===e.name&&p.trigger(o.default.PLAYBACK_NOT_ALLOWED),t.warn("Caught pending play exception - continuing (".concat(e,")"))}))}},isPaused:function(){return n?n.paused:null},pause:function(){n&&(n.pause(),n.autoplay=!1)},isStalled:g,isSeeking:function(){return n?n.seeking||!isNaN(r):null},getTime:function(){return n?isNaN(r)?n.currentTime:r:null},getPlaybackRate:function(){return n?n.playbackRate:null},setPlaybackRate:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n&&(!t&&n.readyState<=2&&e>0?n.addEventListener("canplay",f):n.playbackRate=e)},getPlayedRanges:function(){return n?n.played:null},getEnded:function(){return n?n.ended:null},setStallState:function(e,t){!function(e,t){t?function(e){null!==e&&n&&!n.seeking&&-1===h.indexOf(e)&&h.push(e)}(e):function(e){var t=h.indexOf(e);null!==e&&-1!==t&&h.splice(t,1)}(e)}(e,t)},getElement:function(){return n},setElement:function(e){if(!(null==e||e&&/^(VIDEO|AUDIO)$/i.test(e.nodeName)))throw"element is not video or audio DOM type!";(n=e)&&(n.preload="auto")},setSource:function(e){n&&(e?n.src=e:(n.removeAttribute("src"),n.load()))},getSource:function(){return n?n.src:null},getTTMLRenderingDiv:function(){return c},setTTMLRenderingDiv:function(e){(c=e).style.position="absolute",c.style.display="flex",c.style.overflow="hidden",c.style.pointerEvents="none",c.style.top=0,c.style.left=0},getVttRenderingDiv:function(){return u},setVttRenderingDiv:function(e){u=e},getPlaybackQuality:function(){if(!n)return null;var e="webkitDroppedFrameCount"in n&&"webkitDecodedFrameCount"in n,t=null;return"getVideoPlaybackQuality"in n?t=n.getVideoPlaybackQuality():e&&(t={droppedVideoFrames:n.webkitDroppedFrameCount,totalVideoFrames:n.webkitDroppedFrameCount+n.webkitDecodedFrameCount,creationTime:new Date}),t},addEventListener:v,removeEventListener:y,getReadyState:b,getBufferRange:x,getClientWidth:function(){return n?n.clientWidth:NaN},getClientHeight:function(){return n?n.clientHeight:NaN},getTextTracks:function(){return n?n.textTracks:[]},getTextTrack:E,addTextTrack:function(e,t,r,i,o){if(!n)return null;var s=E(e,t,r,i,o);return s||((s=n.addTextTrack(e,t,r)).isEmbedded=o,s.isTTML=i),s},appendChild:function(e){n&&(n.appendChild(e),void 0!==e.isTTML&&(n.textTracks[n.textTracks.length-1].isTTML=e.isTTML,n.textTracks[n.textTracks.length-1].isEmbedded=e.isEmbedded))},removeChild:function(e){n&&n.removeChild(e)},getVideoWidth:function(){return n?n.videoWidth:NaN},getVideoHeight:function(){return n?n.videoHeight:NaN},getVideoRelativeOffsetTop:function(){var e=n.parentNode.host||n.parentNode;return e?n.getBoundingClientRect().top-e.getBoundingClientRect().top:NaN},getVideoRelativeOffsetLeft:function(){var e=n.parentNode.host||n.parentNode;return e?n.getBoundingClientRect().left-e.getBoundingClientRect().left:NaN},waitForReadyState:_,reset:function(){p.off(o.default.PLAYBACK_PLAYING,m,this)}},t=(0,s.default)(d).getInstance().getLogger(e),r=NaN,e}c.__dashjs_factory_name="VideoModel";const u=r.default.getSingletonFactory(c)},"./src/streaming/net/FetchLoader.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var r=n("./src/core/FactoryMaker.js"),i=n("./src/core/Settings.js"),o=n("./src/streaming/constants/Constants.js"),s=n("./src/streaming/utils/RequestModifier.js");function a(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e){e=e||{};var t,n=this.context,r=e.requestModifier,l=e.lowLatencyThroughputModel,c=e.boxParser,u=(0,i.default)(n).getInstance();function d(e){var n,i=new Date,s=e.request,d=new Headers;if(s.range&&d.append("Range","bytes="+s.range),e.headers)for(var f in e.headers){var g=e.headers[f];g&&d.append(f,g)}s.requestStartDate||(s.requestStartDate=i),r&&r.modifyRequestHeader&&r.modifyRequestHeader({setRequestHeader:function(e,t){d.append(e,t)}},{url:e.url}),"function"==typeof window.AbortController&&(n=new AbortController,e.abortController=n,n.signal.onabort=e.onabort);var m={method:e.method,headers:d,credentials:e.withCredentials?"include":void 0,signal:n?n.signal:void 0},v=u.get().streaming.abr.fetchThroughputCalculationMode,y=Date.now(),b=0;new Promise((function(e){if(v===o.default.ABR_FETCH_THROUGHPUT_CALCULATION_AAST&&l&&(b=l.getThroughputCapacityDelayMS(s,1e3*t.getCurrentBufferLevel(s.mediaType))))return setTimeout(e,b);e()})).then((function(){var n=Date.now();fetch(e.url,m).then((function(r){e.response||(e.response={}),e.response.status=r.status,e.response.statusText=r.statusText,e.response.responseURL=r.url,r.ok||e.onerror();var i,u="",d=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=a(e))){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}(r.headers.keys());try{for(d.s();!(i=d.n()).done;){var f=i.value;u+=f+": "+r.headers.get(f)+"\r\n"}}catch(e){d.e(e)}finally{d.f()}if(e.response.responseHeaders=u,!r.body)return r.arrayBuffer().then((function(t){e.response.response=t;var n={loaded:t.byteLength,total:t.byteLength,stream:!1};e.progress(n),e.onload(),e.onend()}));var g,m,x=parseInt(r.headers.get("Content-Length"),10),E=0,_=!1,w=new Uint8Array,S=0;if(v===o.default.ABR_FETCH_THROUGHPUT_CALCULATION_AAST&&l){var T=n,k=0,C=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(r.body.tee(),2),A=C[0],j=C[1];g=A.getReader(),m=[],g.read().then((function r(i){var o=i.value,a=i.done;if(k=Date.now(),o&&o.length){var c=k-T,d=o.length;m.push({chunkDownloadTimeRelativeMS:k-n,chunkDownloadDurationMS:c,chunkBytes:d,kbps:Math.round(8*d/(c/1e3)),bufferLevel:t.getCurrentBufferLevel(s.mediaType)})}if(a){var p=k-n,h=m.reduce((function(e,t){return e+t.chunkBytes}),0);return l.addMeasurement(s,p,m,y,b,u),void e.progress({loaded:h,total:h,lengthComputable:!0,time:l.getEstimatedDownloadDurationMS(s),stream:!0})}return T=Date.now(),g.read().then(r)})),e.reader=j.getReader()}else e.reader=r.body.getReader();var I=[],O=[],N=[],R=!0;p(e,(function t(n){var r=n.value;if(n.done){if(w){if(v!==o.default.ABR_FETCH_THROUGHPUT_CALCULATION_AAST){var i=null,s=null;v===o.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING?(i=function(e,t){try{var n,r;n=e.filter((function(t,n){return n<e.length-1})),r=t.filter((function(e,n){return n<t.length-1}));var i=[];if(n.length>1){for(var o=0,s=0,a=0;a<n.length;a++)if(n[a]&&r[a]){var l=r[a].ts-n[a].ts;if(l>1)i.push(8*r[a].bytes/l);else{0===s&&(s=n[a].ts);var c=r[a].ts-s;c>1?(i.push(8*o/c),o=0,s=0):o+=r[a].bytes}}if(i.length>0)return i.reduce((function(e,t){return e+t}),0)/i.length}return null}catch(e){return null}}(O,N))&&(s=8*E/i):v===o.default.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA&&(s=h(I,E)),e.progress({loaded:E,total:isNaN(x)?E:x,lengthComputable:!0,time:s,stream:!0})}e.response.response=w.buffer}return e.onload(),void e.onend()}if(r&&r.length>0){w=function(e,t){if(0===e.length)return t;var n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}(w,r),E+=r.length,I.push({ts:Date.now(),bytes:r.length}),v===o.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING&&R&&c.findLastTopIsoBoxCompleted(["moof"],w,S).found&&(R=!1,O.push({ts:performance.now(),bytes:r.length}));var a=c.findLastTopIsoBoxCompleted(["moov","mdat"],w,S);if(a.found){var l,u=a.lastCompletedOffset+a.size;v!==o.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING||R||(R=!0,N.push({ts:performance.now(),bytes:w.length})),u===w.length?(l=w,w=new Uint8Array):(l=new Uint8Array(w.subarray(0,u)),w=w.subarray(u)),e.progress({data:l.buffer,lengthComputable:!1,noTrace:!0}),S=0}else S=a.lastCompletedOffset,_||(e.progress({lengthComputable:!1,noTrace:!0}),_=!0)}p(e,t)}))})).catch((function(t){e.onerror&&e.onerror(t)}))}))}function p(e,t){e.reader.read().then(t).catch((function(t){e.onerror&&200===e.response.status&&e.onerror(t)}))}function h(e,t){try{if((e=e.filter((function(n){return n.bytes>t/4/e.length}))).length>1){var n=0,r=(e[e.length-1].ts-e[0].ts)/e.length;return e.forEach((function(t,i){var o=e[i+1];if(o){var s=o.ts-t.ts;n+=s<r?s:0}})),n}return null}catch(e){return null}}return{load:function(e){r&&r.modifyRequest?(0,s.modifyRequest)(e,r).then((function(){return d(e)})):d(e)},abort:function(e){if(e.abortController)e.abortController.abort();else if(e.reader)try{e.reader.cancel(),e.onabort()}catch(e){}},calculateDownloadedTime:h,setup:function(e){t=e.dashMetrics}}}c.__dashjs_factory_name="FetchLoader";const u=r.default.getClassFactory(c)},"./src/streaming/net/HTTPLoader.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>x});var r=n("./src/streaming/net/XHRLoader.js"),i=n("./src/streaming/net/FetchLoader.js"),o=n("./src/streaming/vo/metrics/HTTPRequest.js"),s=n("./src/core/FactoryMaker.js"),a=n("./src/streaming/vo/DashJSError.js"),l=n("./src/streaming/models/CmcdModel.js"),c=n("./src/streaming/models/CmsdModel.js"),u=n("./src/core/Utils.js"),d=n("./src/core/Debug.js"),p=n("./src/core/EventBus.js"),h=n("./src/core/events/Events.js"),f=n("./src/core/Settings.js"),g=n("./src/streaming/constants/Constants.js"),m=n("./src/streaming/models/LowLatencyThroughputModel.js"),v=n("./src/streaming/models/CustomParametersModel.js");function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e){e=e||{};var t,n,s,b,x,E,_,w,S,T,k,C=this.context,A=e.errHandler,j=e.dashMetrics,I=e.mediaPlayerModel,O=e.requestModifier,N=e.boxParser,R=e.errors,P=e.requestTimeout||0,D=(0,p.default)(C).getInstance(),M=(0,f.default)(C).getInstance();function L(e,t){var l,c=e.request,d=[],p=!0,f=!0,m=new Date,v=m,y=0,k=null;if(!O||!j||!A)throw new Error("config object is not correct or missing");var R,B=function(e){if(f=!1,c.requestStartDate=m,c.requestEndDate=new Date,c.firstByteDate=c.firstByteDate||m,c.fileLoaderType=k,!c.checkExistenceOnly){var t=l.response?l.response.responseURL:null,n=l.response?l.response.status:null,r=l.response&&l.response.getAllResponseHeaders?l.response.getAllResponseHeaders():l.response?l.response.responseHeaders:null,i=M.get().streaming.cmsd&&M.get().streaming.cmsd.enabled?_.parseResponseHeaders(r,c.mediaType):null;j.addHttpRequest(c,t,n,r,e?d:null,i),c.type===o.HTTPRequest.MPD_TYPE&&j.addManifestUpdate(c)}},F=function(){if(-1!==n.indexOf(l)&&(n.splice(n.indexOf(l),1),f))if(B(!1),t>0){try{M.get().streaming.utcSynchronization.enableBackgroundSyncAfterSegmentDownloadError&&c.type===o.HTTPRequest.MEDIA_SEGMENT_TYPE&&I.getRetryAttemptsForType(o.HTTPRequest.MEDIA_SEGMENT_TYPE)===t&&D.trigger(h.default.ATTEMPT_BACKGROUND_SYNC)}catch(e){}t--;var r={config:e};b.push(r),r.timeout=setTimeout((function(){-1!==b.indexOf(r)&&(b.splice(b.indexOf(r),1),L(e,t))}),I.getRetryIntervalsForType(c.type))}else{if(c.type===o.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE)return;A.error(new a.default(x[c.type],c.url+" is not available",{request:c,response:l.response})),e.error&&e.error(c,"error",l.response.statusText),e.complete&&e.complete(c,l.response.statusText)}};c.hasOwnProperty("availabilityTimeComplete")&&!1===c.availabilityTimeComplete&&window.fetch&&"arraybuffer"===c.responseType&&c.type===o.HTTPRequest.MEDIA_SEGMENT_TYPE?((R=(0,i.default)(C).create({requestModifier:O,lowLatencyThroughputModel:S,boxParser:N})).setup({dashMetrics:j}),k=g.default.FILE_LOADER_TYPES.FETCH):(R=(0,r.default)(C).create({requestModifier:O}),k=g.default.FILE_LOADER_TYPES.XHR);var U=null,H=O.modifyRequestURL?O.modifyRequestURL(c.url):c.url;if(M.get().streaming.cmcd&&M.get().streaming.cmcd.enabled){var G=M.get().streaming.cmcd.mode;if(G===g.default.CMCD_MODE_QUERY){var q=function(e){try{var t=[],n=E.getQueryParameter(e);return n&&t.push(n),t}catch(e){return[]}}(c);H=u.default.addAditionalQueryParameterToUrl(H,q)}else G===g.default.CMCD_MODE_HEADER&&(U=E.getHeaderParameters(c))}c.url=H;var V=c.checkExistenceOnly?o.HTTPRequest.HEAD:o.HTTPRequest.GET,z=w.getXHRWithCredentialsForType(c.type);l={url:H,method:V,withCredentials:z,request:c,onload:function(){l.response.status>=200&&l.response.status<=299&&(B(!0),e.success&&e.success(l.response.response,l.response.statusText,l.response.responseURL),e.complete&&e.complete(c,l.response.statusText))},onend:F,onerror:F,progress:function(t){var n=new Date;p&&(p=!1,(!t.lengthComputable||t.lengthComputable&&t.total!==t.loaded)&&(c.firstByteDate=n)),t.lengthComputable&&(c.bytesLoaded=t.loaded,c.bytesTotal=t.total),t.noTrace||(d.push({s:v,d:t.time?t.time:n.getTime()-v.getTime(),b:[t.loaded?t.loaded-y:0]}),v=n,y=t.loaded),e.progress&&t&&e.progress(t)},onabort:function(){e.abort&&e.abort(c)},ontimeout:function(e){var t;if(e.lengthComputable){var n=e.loaded/e.total*100;t="Request timeout: loaded: "+e.loaded+", out of: "+e.total+" : "+n.toFixed(3)+"% Completed"}else t="Request timeout: non-computable download size";T.warn(t)},loader:R,timeout:P,headers:U};var W=(new Date).getTime();if(isNaN(c.delayLoadingTime)||W>=c.delayLoadingTime)n.push(l),R.load(l);else{var K={httpRequest:l};s.push(K),K.delayTimeout=setTimeout((function(){if(-1!==s.indexOf(K)){s.splice(s.indexOf(K),1);try{m=new Date,v=m,n.push(K.httpRequest),R.load(K.httpRequest)}catch(e){K.httpRequest.onerror()}}}),c.delayLoadingTime-W)}}return t={load:function(e){e.request?L(e,I.getRetryAttemptsForType(e.request.type)):e.error&&e.error(e.request,"error")},abort:function(){b.forEach((function(e){clearTimeout(e.timeout),e.config.request&&e.config.abort&&e.config.abort(e.config.request)})),b=[],s.forEach((function(e){return clearTimeout(e.delayTimeout)})),s=[],n.forEach((function(e){e.request.type!==o.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE&&(e.onloadend=e.onerror=e.onprogress=void 0,e.loader.abort(e))})),n=[]}},T=(0,d.default)(C).getInstance().getLogger(t),n=[],s=[],b=[],E=(0,l.default)(C).getInstance(),_=(0,c.default)(C).getInstance(),S=(0,m.default)(C).getInstance(),w=(0,v.default)(C).getInstance(),y(k={},o.HTTPRequest.MPD_TYPE,R.DOWNLOAD_ERROR_ID_MANIFEST_CODE),y(k,o.HTTPRequest.XLINK_EXPANSION_TYPE,R.DOWNLOAD_ERROR_ID_XLINK_CODE),y(k,o.HTTPRequest.INIT_SEGMENT_TYPE,R.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE),y(k,o.HTTPRequest.MEDIA_SEGMENT_TYPE,R.DOWNLOAD_ERROR_ID_CONTENT_CODE),y(k,o.HTTPRequest.INDEX_SEGMENT_TYPE,R.DOWNLOAD_ERROR_ID_CONTENT_CODE),y(k,o.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,R.DOWNLOAD_ERROR_ID_CONTENT_CODE),y(k,o.HTTPRequest.OTHER_TYPE,R.DOWNLOAD_ERROR_ID_CONTENT_CODE),x=k,t}b.__dashjs_factory_name="HTTPLoader";const x=s.default.getClassFactory(b)},"./src/streaming/net/SchemeLoaderFactory.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/net/HTTPLoader.js");function o(){var e;function t(){e={}}function n(){t()}return n(),{getLoader:function(t){for(var n in e)if(e.hasOwnProperty(n)&&t.startsWith(n))return e[n];return i.default},registerLoader:function(t,n){e[t]=n},unregisterLoader:function(t){e[t]&&delete e[t]},unregisterAllLoader:t,reset:n}}o.__dashjs_factory_name="SchemeLoaderFactory";const s=r.default.getSingletonFactory(o)},"./src/streaming/net/URLLoader.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/net/SchemeLoaderFactory.js");function o(e){e=e||{};var t,n,r=this.context;return t=(0,i.default)(r).getInstance(),{load:function(i){if(!n){var o=t.getLoader(i&&i.request?i.request.url:null);n=o(r).create({errHandler:e.errHandler,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,dashMetrics:e.dashMetrics,boxParser:e.boxParser?e.boxParser:null,constants:e.constants?e.constants:null,dashConstants:e.dashConstants?e.dashConstants:null,urlUtils:e.urlUtils?e.urlUtils:null,requestTimeout:isNaN(e.requestTimeout)?0:e.requestTimeout,errors:e.errors})}n.load(i)},abort:function(){n&&n.abort()}}}o.__dashjs_factory_name="URLLoader";const s=r.default.getClassFactory(o)},"./src/streaming/net/XHRLoader.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/utils/RequestModifier.js");function o(e){var t=(e=e||{}).requestModifier;function n(e){var n=new Date,r=e.request,i=new XMLHttpRequest;if(i.open(e.method,e.url,!0),r.responseType&&(i.responseType=r.responseType),r.range&&i.setRequestHeader("Range","bytes="+r.range),r.requestStartDate||(r.requestStartDate=n),t&&t.modifyRequestHeader&&(i=t.modifyRequestHeader(i,{url:e.url})),e.headers)for(var o in e.headers){var s=e.headers[o];s&&i.setRequestHeader(o,s)}i.withCredentials=e.withCredentials,i.onload=e.onload,i.onloadend=e.onend,i.onerror=e.onerror,i.onprogress=e.progress,i.onabort=e.onabort,i.ontimeout=e.ontimeout,i.timeout=e.timeout,i.send(),e.response=i}return{load:function(e){t&&t.modifyRequest?(0,i.modifyRequest)(e,t).then((function(){return n(e)})):n(e)},abort:function(e){var t=e.response;t.onloadend=t.onerror=t.onprogress=void 0,t.abort()}}}o.__dashjs_factory_name="XHRLoader";const s=r.default.getClassFactory(o)},"./src/streaming/protection/CommonEncryption.js":(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,{default:()=>o});var i={attributes:["Laurl","laurl"],prefixes:["clearkey","dashif"]};const o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"findCencContentProtection",value:function(e){for(var t=null,n=0;n<e.length;++n){var r=e[n];"urn:mpeg:dash:mp4protection:2011"!==r.schemeIdUri.toLowerCase()||"cenc"!==r.value.toLowerCase()&&"cbcs"!==r.value.toLowerCase()||(t=r)}return t}},{key:"getPSSHData",value:function(e){var t=8,n=new DataView(e),r=n.getUint8(t);return t+=20,r>0&&(t+=4+16*n.getUint32(t)),t+=4,e.slice(t)}},{key:"getPSSHForKeySystem",value:function(t,n){var r=e.parsePSSHList(n);return t&&r.hasOwnProperty(t.uuid.toLowerCase())?r[t.uuid.toLowerCase()]:null}},{key:"parseInitDataFromContentProtection",value:function(e,t){return"pssh"in e?(e.pssh.__text=e.pssh.__text.replace(/\r?\n|\r/g,"").replace(/\s+/g,""),t.decodeArray(e.pssh.__text).buffer):null}},{key:"parsePSSHList",value:function(e){if(null==e)return[];for(var t=new DataView(e.buffer||e),n={},r=0;;){var i,o,s=void 0,a=r;if(r>=t.buffer.byteLength)break;if(i=r+t.getUint32(r),r+=4,1886614376===t.getUint32(r))if(r+=4,0===(o=t.getUint8(r))||1===o){r++,r+=3,s="";var l=void 0,c=void 0;for(l=0;l<4;l++)s+=1===(c=t.getUint8(r+l).toString(16)).length?"0"+c:c;for(r+=4,s+="-",l=0;l<2;l++)s+=1===(c=t.getUint8(r+l).toString(16)).length?"0"+c:c;for(r+=2,s+="-",l=0;l<2;l++)s+=1===(c=t.getUint8(r+l).toString(16)).length?"0"+c:c;for(r+=2,s+="-",l=0;l<2;l++)s+=1===(c=t.getUint8(r+l).toString(16)).length?"0"+c:c;for(r+=2,s+="-",l=0;l<6;l++)s+=1===(c=t.getUint8(r+l).toString(16)).length?"0"+c:c;r+=6,r+=4,n[s=s.toLowerCase()]=t.buffer.slice(a,i),r=i}else r=i;else r=i}return n}},{key:"getLicenseServerUrlFromMediaInfo",value:function(e,t){try{if(!e||0===e.length)return null;for(var n=0,r=null;n<e.length&&!r;){var o=e[n];if(o&&o.contentProtection&&o.contentProtection.length>0){var s=o.contentProtection.filter((function(e){return e.schemeIdUri&&e.schemeIdUri===t}));if(s&&s.length>0)for(var a=0;a<s.length&&!r;){for(var l=s[a],c=0;c<i.attributes.length&&!r;){for(var u=0,d=i.attributes[c];u<i.prefixes.length&&!r;){var p=i.prefixes[u];l[d]&&l[d].__prefix&&l[d].__prefix===p&&l[d].__text&&(r=l[d].__text),u+=1}c+=1}a+=1}}n+=1}return r}catch(e){return null}}}])&&r(t,n),e}()},"./src/streaming/protection/Protection.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>f});var r=n("./src/streaming/protection/controllers/ProtectionController.js"),i=n("./src/streaming/protection/controllers/ProtectionKeyController.js"),o=n("./src/streaming/protection/ProtectionEvents.js"),s=n("./src/streaming/protection/errors/ProtectionErrors.js"),a=n("./src/streaming/protection/models/ProtectionModel_21Jan2015.js"),l=n("./src/streaming/protection/models/ProtectionModel_3Feb2014.js"),c=n("./src/streaming/protection/models/ProtectionModel_01b.js"),u=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],d=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];function p(){var e,t=this.context;function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];if("function"==typeof e[r[Object.keys(r)[0]]])return r}return null}return e={createProtectionSystem:function(o){var s=null,p=(0,i.default)(t).getInstance();p.setConfig({debug:o.debug,BASE64:o.BASE64,settings:o.settings}),p.initialize();var h=function(r){var i=r.debug,o=i.getLogger(e),s=r.eventBus,p=r.errHandler,h=r.videoModel?r.videoModel.getElement():null;return h&&void 0===h.onencrypted||h&&void 0===h.mediaKeys?n(h,d)?(o.info("EME detected on this user agent! (ProtectionModel_3Feb2014)"),(0,l.default)(t).create({debug:i,eventBus:s,events:r.events,api:n(h,d)})):n(h,u)?(o.info("EME detected on this user agent! (ProtectionModel_01b)"),(0,c.default)(t).create({debug:i,eventBus:s,errHandler:p,events:r.events,api:n(h,u)})):(o.warn("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null):(o.info("EME detected on this user agent! (ProtectionModel_21Jan2015)"),(0,a.default)(t).create({debug:i,eventBus:s,events:r.events}))}(o);return!s&&h&&(s=(0,r.default)(t).create({protectionModel:h,protectionKeyController:p,eventBus:o.eventBus,debug:o.debug,events:o.events,BASE64:o.BASE64,constants:o.constants,cmcdModel:o.cmcdModel,customParametersModel:o.customParametersModel,settings:o.settings}),o.capabilities.setEncryptedMediaSupported(!0)),s}}}p.__dashjs_factory_name="Protection";var h=dashjs.FactoryMaker.getClassFactory(p);h.events=o.default,h.errors=s.default,dashjs.FactoryMaker.updateClassFactory(p.__dashjs_factory_name,h);const f=h},"./src/streaming/protection/ProtectionEvents.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/core/events/EventsBase.js");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const a=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(n,r.default);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var o=s(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,n)}}(n);function n(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(e=t.call(this)).INTERNAL_KEY_MESSAGE="internalKeyMessage",e.INTERNAL_KEY_STATUS_CHANGED="internalkeyStatusChanged",e.KEY_ADDED="public_keyAdded",e.KEY_ERROR="public_keyError",e.KEY_MESSAGE="public_keyMessage",e.KEY_SESSION_CLOSED="public_keySessionClosed",e.KEY_SESSION_CREATED="public_keySessionCreated",e.KEY_SESSION_REMOVED="public_keySessionRemoved",e.KEY_STATUSES_CHANGED="public_keyStatusesChanged",e.KEY_SYSTEM_ACCESS_COMPLETE="public_keySystemAccessComplete",e.KEY_SYSTEM_SELECTED="public_keySystemSelected",e.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",e.LICENSE_REQUEST_SENDING="public_licenseRequestSending",e.NEED_KEY="needkey",e.PROTECTION_CREATED="public_protectioncreated",e.PROTECTION_DESTROYED="public_protectiondestroyed",e.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",e.TEARDOWN_COMPLETE="protectionTeardownComplete",e.VIDEO_ELEMENT_SELECTED="videoElementSelected",e.KEY_SESSION_UPDATED="public_keySessionUpdated",e}return n}())},"./src/streaming/protection/controllers/ProtectionController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});var r=n("./src/streaming/protection/CommonEncryption.js"),i=n("./src/streaming/protection/vo/MediaCapability.js"),o=n("./src/streaming/protection/vo/KeySystemConfiguration.js"),s=n("./src/streaming/protection/errors/ProtectionErrors.js"),a=n("./src/streaming/vo/DashJSError.js"),l=n("./src/streaming/protection/vo/LicenseRequest.js"),c=n("./src/streaming/protection/vo/LicenseResponse.js"),u=n("./src/streaming/vo/metrics/HTTPRequest.js"),d=n("./src/core/Utils.js"),p=n("./src/streaming/constants/Constants.js"),h=n("./src/core/FactoryMaker.js");function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e){var t,n,h,g,m,v,y,b,x,E,_,w=(e=e||{}).protectionKeyController,S=e.protectionModel,T=e.eventBus,k=e.events,C=e.debug,A=e.BASE64,j=e.constants,I=[],O=e.cmcdModel,N=e.settings,R=e.customParametersModel;function P(){if(!(T&&T.hasOwnProperty("on")&&w&&w.hasOwnProperty("getSupportedKeySystemsFromContentProtection")))throw new Error("Missing config parameter(s)")}function D(e,t){b||x?b&&M():function(e,t){if(!x){x=!0;var r,i=[];e=e.sort((function(t,n){return(m&&m[t.ks.systemString]&&m[t.ks.systemString].priority>=0?m[t.ks.systemString].priority:e.length)-(m&&m[n.ks.systemString]&&m[n.ks.systemString].priority>=0?m[n.ks.systemString].priority:e.length)}));for(var o=0;o<e.length;o++){var l=q(e[o]);i.push({ks:e[o].ks,configs:[l],protData:e[o].protData})}S.requestKeySystemAccess(i).then((function(e){var t=(r=e.data).mksa&&r.mksa.selectedSystemString?r.mksa.selectedSystemString:r.keySystem.systemString;return n.info("DRM: KeySystem Access Granted for system string ("+t+")!  Selecting key system..."),S.selectKeySystem(r)})).then((function(e){if(b=e,x=!1,S){T.trigger(k.KEY_SYSTEM_SELECTED,{data:r});var t=U(b);t&&t.serverCertificate&&t.serverCertificate.length>0&&S.setServerCertificate(A.decodeArray(t.serverCertificate).buffer),M()}})).catch((function(e){b=null,x=!1,t||T.trigger(k.KEY_SYSTEM_SELECTED,{data:null,error:new a.default(s.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,s.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+"Error selecting key system! -- "+e.error)})}))}}(e,t)}function M(){for(var e,t=0;t<h.length;t++)for(e=0;e<h[t].length;e++)if(b===h[t][e].ks){L(h[t][e]);break}h=[]}function L(e){if(w.isClearKey(b)&&e.protData&&e.protData.hasOwnProperty("clearkeys")&&0!==Object.keys(e.protData.clearkeys).length){var t={kids:Object.keys(e.protData.clearkeys)};e.initData=(new TextEncoder).encode(JSON.stringify(t))}e.sessionId?B(e):null!==e.initData&&F(e)}function B(e){P(),S.loadKeySession(e)}function F(e){var t=r.default.getPSSHForKeySystem(b,e?e.initData:null);if(t){if(function(e){if(!e)return!1;try{for(var t=S.getSessions(),n=0;n<t.length;n++)if(t[n].getKeyId()===e)return!0;return!1}catch(e){return!1}}(e.keyId))return;if(H(t))return;try{e.initData=t,S.createKeySession(e)}catch(e){T.trigger(k.KEY_SESSION_CREATED,{data:null,error:new a.default(s.default.KEY_SESSION_CREATED_ERROR_CODE,s.default.KEY_SESSION_CREATED_ERROR_MESSAGE+e.message)})}}else e&&e.initData?S.createKeySession(e):T.trigger(k.KEY_SESSION_CREATED,{data:null,error:new a.default(s.default.KEY_SESSION_CREATED_ERROR_CODE,s.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Selected key system is "+(b?b.systemString:null)+".  needkey/encrypted event contains no initData corresponding to that key system!")})}function U(e){if(e){var t=e.systemString;if(m)return t in m?m[t]:null}return null}function H(e){if(!e)return!1;try{for(var t=S.getAllInitData(),r=0;r<t.length;r++)if(w.initDataEquals(e,t[r]))return n.debug("DRM: Ignoring initData because we have already seen it!"),!0;return!1}catch(e){return!1}}function G(e){P(),e?(S.setMediaElement(e),T.on(k.NEED_KEY,J,t)):null===e&&(S.setMediaElement(e),T.off(k.NEED_KEY,J,t))}function q(e){var t=e.protData,n=[],r=[],s=t&&t.audioRobustness&&t.audioRobustness.length>0?t.audioRobustness:y,a=t&&t.videoRobustness&&t.videoRobustness.length>0?t.videoRobustness:y,l=e.sessionType,c=t&&t.distinctiveIdentifier?t.distinctiveIdentifier:"optional",u=t&&t.persistentState?t.persistentState:"temporary"===l?"optional":"required";return g.forEach((function(e){e.type===j.AUDIO?n.push(new i.default(e.codec,s)):e.type===j.VIDEO&&r.push(new i.default(e.codec,a))})),new o.default(n,r,c,u,[l])}function V(e){e.error?T.trigger(k.KEY_STATUSES_CHANGED,{data:null,error:e.error}):n.debug("DRM: key status = "+e.status)}function z(e){n.debug("DRM: onKeyMessage");var t=e.data;T.trigger(k.KEY_MESSAGE,{data:t});var i=t.messageType?t.messageType:"license-request",o=t.message,h=t.sessionToken,m=U(b),v=w.getLicenseServerModelInstance(b,m,i),y={sessionToken:h,messageType:i};if(o&&0!==o.byteLength){if(!v)return n.debug("DRM: License server request not required for this message (type = "+e.data.messageType+").  Session ID = "+h.getSessionId()),void W(y);if(w.isClearKey(b)){var x=w.processClearKeyLicenseRequest(b,m,o);if(x&&x.keyPairs&&x.keyPairs.length>0)return n.debug("DRM: ClearKey license request handled by application!"),W(y),void S.updateKeySession(h,x)}!function(e,t,i){var o=e.sessionToken,h=e.messageType?e.messageType:"license-request",m={sessionToken:o,messageType:h},v=b?b.systemString:null,y=function(e,t,n,i,o){var s=null,a=i.message;if(e&&e.serverURL){var l=e.serverURL;"string"==typeof l&&""!==l?s=l:"object"===f(l)&&l.hasOwnProperty(t)&&(s=l[t])}else if(e&&e.laURL&&""!==e.laURL)s=e.laURL;else if(!(s=r.default.getLicenseServerUrlFromMediaInfo(g,b.schemeIdURI))&&!w.isClearKey(b)){var c=r.default.getPSSHData(n.initData);(s=b.getLicenseServerURLFromInitData(c))||(s=i.laURL)}return o.getServerURLFromMessage(s,a,t)}(i,h,o,e,t);if(y){var x={},C=!1;i&&$(x,i.httpRequestHeaders);var A=e.message;$(x,b.getRequestHeadersFromMessage(A)),Object.keys(x).forEach((function(e){"authorization"===e.toLowerCase()&&(C=!0)})),i&&"boolean"==typeof i.withCredentials&&(C=i.withCredentials);var j=function(e){if(S)if(e.status>=200&&e.status<=299){var n=d.default.parseHttpHeaders(e.getAllResponseHeaders?e.getAllResponseHeaders():null),r=new c.default(e.responseURL,n,e.response);X(R.getLicenseResponseFilters(),r).then((function(){var n=t.getLicenseMessage(r.data,v,h);null!==n?(W(m),S.updateKeySession(o,n)):Y(e,m,v,h,t)}))}else Y(e,m,v,h,t)},I=function(e){W(m,new a.default(s.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,s.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+v+' update, XHR aborted. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},P=function(e){W(m,new a.default(s.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,s.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+v+' update, XHR error. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},D=b.getLicenseRequestFromMessage(A),M=t.getHTTPMethod(h),L=t.getResponseType(v,h),B=i&&!isNaN(i.httpTimeout)?i.httpTimeout:8e3,F=o.getSessionId()||null,U=new l.default(y,M,L,x,C,h,F,D),H=isNaN(N.get().streaming.retryAttempts[u.HTTPRequest.LICENSE])?3:N.get().streaming.retryAttempts[u.HTTPRequest.LICENSE];X(R.getLicenseRequestFilters(),U).then((function(){!function e(t,r,i,o,s,a){var l=new XMLHttpRequest;if(N.get().streaming.cmcd&&N.get().streaming.cmcd.enabled&&N.get().streaming.cmcd.mode===p.default.CMCD_MODE_QUERY){var c=O.getQueryParameter({url:t.url,type:u.HTTPRequest.LICENSE});c&&(t.url=d.default.addAditionalQueryParameterToUrl(t.url,[c]))}for(var h in l.open(t.method,t.url,!0),l.responseType=t.responseType,l.withCredentials=t.withCredentials,i>0&&(l.timeout=i),t.headers)l.setRequestHeader(h,t.headers[h]);if(N.get().streaming.cmcd&&N.get().streaming.cmcd.enabled&&N.get().streaming.cmcd.mode===p.default.CMCD_MODE_HEADER){var f=O.getHeaderParameters({url:t.url,type:u.HTTPRequest.LICENSE});if(f)for(var g in f){var m=f[g];m&&l.setRequestHeader(g,m)}}var v=function(){r--;var n=isNaN(N.get().streaming.retryIntervals[u.HTTPRequest.LICENSE])?1e3:N.get().streaming.retryIntervals[u.HTTPRequest.LICENSE];_=setTimeout((function(){e(t,r,i,o,s,a)}),n)};l.onload=function(){E=null,this.status>=200&&this.status<=299||r<=0?o(this):(n.warn("License request failed ("+this.status+"). Retrying it... Pending retries: "+r),v())},l.ontimeout=l.onerror=function(){E=null,r<=0?a(this):(n.warn("License request network request failed . Retrying it... Pending retries: "+r),v())},l.onabort=function(){s(this)},T.trigger(k.LICENSE_REQUEST_SENDING,{url:t.url,headers:t.headers,payload:t.data,sessionId:t.sessionId}),E=l,l.send(t.data)}(U,H,B,j,I,P)}))}else W(m,new a.default(s.default.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE,s.default.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE))}(t,v,m)}else W(y,new a.default(s.default.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE,s.default.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE))}function W(e,t){T.trigger(k.LICENSE_REQUEST_COMPLETE,{data:e,error:t})}function K(){E&&(E.onloadend=E.onerror=E.onprogress=void 0,E.abort(),E=null),_&&(clearTimeout(_),_=null)}function $(e,t){if(t)for(var n in t)e[n]=t[n]}function Y(e,t,n,r,i){var o="NONE",l=null;e.response&&(o=i.getErrorResponse(e.response,n,r),l={serverResponse:e.response||null,responseCode:e.status||null,responseText:e.statusText||null}),W(t,new a.default(s.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,s.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+n+' update, XHR complete. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState+".  Response is "+o,l))}function X(e,t){return e?e.reduce((function(e,n){return e.then((function(){return n(t)}))}),Promise.resolve()):Promise.resolve()}function J(e,t){if(!N.get().streaming.protection.ignoreEmeEncryptedEvent){if(n.debug("DRM: onNeedKey"),"cenc"!==e.key.initDataType)return void n.warn("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+e.key.initDataType);if(0===g.length&&(n.warn("DRM: onNeedKey called before initializeForMedia, wait until initialized"),(t=void 0===t?1:t+1)<5))return void I.push(setTimeout((function(){J(e,t)}),500));var i=e.key.initData;if(ArrayBuffer.isView(i)&&(i=i.buffer),b){var o=r.default.getPSSHForKeySystem(b,i);if(o&&H(o))return}n.debug("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(i)));var s=w.getSupportedKeySystemsFromSegmentPssh(i,m,v);if(0===s.length)return void n.debug("DRM: Received needkey event with initData, but we don't support any of the key systems!");!function(e){h.push(e),D(e,!1)}(s)}}return t={initializeForMedia:function(e){if(!e)throw new Error("mediaInfo can not be null or undefined");P(),g.push(e)},clearMediaInfoArray:function(){g=[]},handleKeySystemFromManifest:function(){if(g&&0!==g.length){var e=[];g.forEach((function(t){var n=w.getSupportedKeySystemsFromContentProtection(t.contentProtection,m,v);n.length>0&&(0===e.length&&(e=n),h.push(n))})),e&&e.length>0&&D(e,!0)}},createKeySession:F,loadKeySession:B,removeKeySession:function(e){P(),S.removeKeySession(e)},closeKeySession:function(e){P(),S.closeKeySession(e)},setServerCertificate:function(e){P(),S.setServerCertificate(e)},setMediaElement:G,setSessionType:function(e){v=e},setRobustnessLevel:function(e){y=e},setProtectionData:function(e){m=e,w.setProtectionData(e)},getSupportedKeySystemsFromContentProtection:function(e){return P(),w.getSupportedKeySystemsFromContentProtection(e,m,v)},getKeySystems:function(){return w?w.getKeySystems():[]},setKeySystems:function(e){w&&w.setKeySystems(e)},stop:function(){K(),S&&S.stop()},reset:function(){T.off(k.INTERNAL_KEY_MESSAGE,z,t),T.off(k.INTERNAL_KEY_STATUS_CHANGED,V,t),P(),K(),G(null),b=null,x=!1,S&&(S.reset(),S=null),I.forEach((function(e){return clearTimeout(e)})),I=[],g=[],h=[]}},n=C.getLogger(t),h=[],g=[],v="temporary",y="",E=null,_=null,T.on(k.INTERNAL_KEY_MESSAGE,z,t),T.on(k.INTERNAL_KEY_STATUS_CHANGED,V,t),t}g.__dashjs_factory_name="ProtectionController";const m=h.default.getClassFactory(g)},"./src/streaming/protection/controllers/ProtectionKeyController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>f});var r=n("./src/streaming/protection/CommonEncryption.js"),i=n("./src/streaming/protection/drm/KeySystemClearKey.js"),o=n("./src/streaming/protection/drm/KeySystemW3CClearKey.js"),s=n("./src/streaming/protection/drm/KeySystemWidevine.js"),a=n("./src/streaming/protection/drm/KeySystemPlayReady.js"),l=n("./src/streaming/protection/servers/DRMToday.js"),c=n("./src/streaming/protection/servers/PlayReady.js"),u=n("./src/streaming/protection/servers/Widevine.js"),d=n("./src/streaming/protection/servers/ClearKey.js"),p=n("./src/streaming/constants/ProtectionConstants.js");function h(){var e,t,n,h,f,g,m,v,y=this.context;function b(e,t){return t&&e in t?t[e]:null}function x(e,t){return e&&e.sessionId?e.sessionId:t&&t.sessionId?t.sessionId:null}function E(e,t){return e&&e.sessionType?e.sessionType:t}return e={initialize:function(){var e;h=[],e=(0,a.default)(y).getInstance({BASE64:f,settings:g}),h.push(e),e=(0,s.default)(y).getInstance({BASE64:f}),h.push(e),e=(0,i.default)(y).getInstance({BASE64:f}),h.push(e),m=e,e=(0,o.default)(y).getInstance({BASE64:f,debug:t}),h.push(e),v=e},setProtectionData:function(e){for(var t,n,r=0;r<h.length;r++){var i=h[r];i.hasOwnProperty("init")&&i.init((t=i.systemString,n=void 0,n=null,e&&(n=t in e?e[t]:null),n))}},isClearKey:function(e){return e===m||e===v},initDataEquals:function(e,t){if(e.byteLength===t.byteLength){for(var n=new Uint8Array(e),r=new Uint8Array(t),i=0;i<n.length;i++)if(n[i]!==r[i])return!1;return!0}return!1},getKeySystems:function(){return h},setKeySystems:function(e){h=e},getKeySystemBySystemString:function(e){for(var t=0;t<h.length;t++)if(h[t].systemString===e)return h[t];return null},getSupportedKeySystemsFromContentProtection:function(e,t,n){var i,o,s,a,l=[];if(e){var c=r.default.findCencContentProtection(e);for(s=0;s<h.length;++s){var u=b((o=h[s]).systemString,t);for(a=0;a<e.length;++a)if((i=e[a]).schemeIdUri.toLowerCase()===o.schemeIdURI){var d=o.getInitData(i,c);l.push({ks:h[s],keyId:i.keyId,initData:d,protData:u,cdmData:o.getCDMData(u?u.cdmData:null),sessionId:x(u,i),sessionType:E(u,n)})}}}return l},getSupportedKeySystemsFromSegmentPssh:function(e,t,n){for(var i,o=[],s=r.default.parsePSSHList(e),a=0;a<h.length;++a){var l=b((i=h[a]).systemString,t);i.uuid in s&&o.push({ks:i,initData:s[i.uuid],protData:l,cdmData:i.getCDMData(l?l.cdmData:null),sessionId:x(l),sessionType:E(l,n)})}return o},getLicenseServerModelInstance:function(e,t,n){if("license-release"===n||"individualization-request"===n)return null;var r=null;return t&&t.hasOwnProperty("drmtoday")?r=(0,l.default)(y).getInstance({BASE64:f}):e.systemString===p.default.WIDEVINE_KEYSTEM_STRING?r=(0,u.default)(y).getInstance():e.systemString===p.default.PLAYREADY_KEYSTEM_STRING?r=(0,c.default)(y).getInstance():e.systemString===p.default.CLEARKEY_KEYSTEM_STRING&&(r=(0,d.default)(y).getInstance()),r},processClearKeyLicenseRequest:function(e,t,r){try{return e.getClearKeysFromProtectionData(t,r)}catch(e){return n.error("Failed to retrieve clearkeys from ProtectionData"),null}},setConfig:function(r){r&&(r.debug&&(t=r.debug,n=t.getLogger(e)),r.BASE64&&(f=r.BASE64),r.settings&&(g=r.settings))}}}h.__dashjs_factory_name="ProtectionKeyController";const f=dashjs.FactoryMaker.getSingletonFactory(h)},"./src/streaming/protection/drm/KeySystemClearKey.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var r=n("./src/streaming/protection/vo/KeyPair.js"),i=n("./src/streaming/protection/vo/ClearKeyKeySet.js"),o=n("./src/streaming/protection/CommonEncryption.js"),s=n("./src/streaming/constants/ProtectionConstants.js"),a="e2719d58-a985-b3c9-781a-b030af78d30e",l=s.default.CLEARKEY_KEYSTEM_STRING;function c(e){var t=(e=e||{}).BASE64;return{uuid:a,schemeIdURI:"urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e",systemString:l,getInitData:function(e,n){try{var r=o.default.parseInitDataFromContentProtection(e,t);if(!r&&n){var i={kids:[function(e){try{var t=e.replace(/-/g,"");return(t=btoa(t.match(/\w{2}/g).map((function(e){return String.fromCharCode(parseInt(e,16))})).join(""))).replace(/=/g,"").replace(/\//g,"_").replace(/\+/g,"-")}catch(e){return null}}(n["cenc:default_KID"])]};r=(new TextEncoder).encode(JSON.stringify(i))}return r}catch(e){return null}},getRequestHeadersFromMessage:function(){return{"Content-Type":"application/json"}},getLicenseRequestFromMessage:function(e){return JSON.stringify(JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e))))},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getClearKeysFromProtectionData:function(e,t){var n=null;if(e){for(var o=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),s=[],a=0;a<o.kids.length;a++){var l=o.kids[a],c=e.clearkeys&&e.clearkeys.hasOwnProperty(l)?e.clearkeys[l]:null;if(!c)throw new Error("DRM: ClearKey keyID ("+l+") is not known!");s.push(new r.default(l,c))}n=new i.default(s)}return n}}}c.__dashjs_factory_name="KeySystemClearKey";const u=dashjs.FactoryMaker.getSingletonFactory(c)},"./src/streaming/protection/drm/KeySystemPlayReady.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var r=n("./src/streaming/protection/CommonEncryption.js"),i=n("./src/streaming/constants/ProtectionConstants.js"),o="9a04f079-9840-4286-ab92-e65be0885f95",s=i.default.PLAYREADY_KEYSTEM_STRING;function a(e){var t="utf-16",n=(e=e||{}).BASE64,i=e.settings;function a(){if(!n||!n.hasOwnProperty("decodeArray")||!n.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}return{uuid:o,schemeIdURI:"urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",systemString:s,getInitData:function(e){var t,i,o,s,l,c=new Uint8Array([112,115,115,104,0,0,0,0]),u=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),d=0,p=null;if(a(),!e)return null;if("pssh"in e)return r.default.parseInitDataFromContentProtection(e,n);if("pro"in e)p=n.decodeArray(e.pro.__text);else{if(!("prheader"in e))return null;p=n.decodeArray(e.prheader.__text)}return t=p.length,i=4+c.length+u.length+4+t,o=new ArrayBuffer(i),s=new Uint8Array(o),(l=new DataView(o)).setUint32(d,i),d+=4,s.set(c,d),d+=c.length,s.set(u,d),d+=u.length,l.setUint32(d,t),d+=4,s.set(p,d),d+=t,s.buffer},getRequestHeadersFromMessage:function(e){var n,r,o={},s=new DOMParser;if(i&&i.get().streaming.protection.detectPlayreadyMessageFormat&&"utf-16"===t&&e&&e.byteLength%2==1)return o["Content-Type"]="text/xml; charset=utf-8",o;var a="utf-16"===t?new Uint16Array(e):new Uint8Array(e);n=String.fromCharCode.apply(null,a);for(var l=(r=s.parseFromString(n,"application/xml")).getElementsByTagName("name"),c=r.getElementsByTagName("value"),u=0;u<l.length;u++)o[l[u].childNodes[0].nodeValue]=c[u].childNodes[0].nodeValue;return o.hasOwnProperty("Content")&&(o["Content-Type"]=o.Content,delete o.Content),o.hasOwnProperty("Content-Type")||(o["Content-Type"]="text/xml; charset=utf-8"),o},getLicenseRequestFromMessage:function(e){var r=null,o=new DOMParser;if(i&&i.get().streaming.protection.detectPlayreadyMessageFormat&&"utf-16"===t&&e&&e.byteLength%2==1)return e;var s="utf-16"===t?new Uint16Array(e):new Uint8Array(e);a();var l=String.fromCharCode.apply(null,s),c=o.parseFromString(l,"application/xml");if(!c.getElementsByTagName("PlayReadyKeyMessage")[0])return e;var u=c.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;return u&&(r=n.decode(u)),r},getLicenseServerURLFromInitData:function(e){if(e)for(var t=new DataView(e),n=t.getUint16(4,!0),r=6,i=new DOMParser,o=0;o<n;o++){var s=t.getUint16(r,!0);r+=2;var a=t.getUint16(r,!0);if(r+=2,1===s){var l=e.slice(r,r+a),c=String.fromCharCode.apply(null,new Uint16Array(l)),u=i.parseFromString(c,"application/xml");if(u.getElementsByTagName("LA_URL")[0]){var d=u.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(d)return d}if(u.getElementsByTagName("LUI_URL")[0]){var p=u.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(p)return p}}else r+=a}return null},getCDMData:function(e){var t,r,i,o;if(a(),!e)return null;for(t=[],o=0;o<e.length;++o)t.push(e.charCodeAt(o)),t.push(0);for(t=String.fromCharCode.apply(null,t),t=n.encode(t),r='<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="false"><CustomData encoding="base64encoded">%CUSTOMDATA%</CustomData></LicenseAcquisition></PlayReadyCDMData>'.replace("%CUSTOMDATA%",t),i=[],o=0;o<r.length;++o)i.push(r.charCodeAt(o)),i.push(0);return new Uint8Array(i).buffer},setPlayReadyMessageFormat:function(e){if("utf-8"!==e&&"utf-16"!==e)throw new Error('Specified message format is not one of "utf-8" or "utf-16"');t=e}}}a.__dashjs_factory_name="KeySystemPlayReady";const l=dashjs.FactoryMaker.getSingletonFactory(a)},"./src/streaming/protection/drm/KeySystemW3CClearKey.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var r=n("./src/streaming/protection/vo/KeyPair.js"),i=n("./src/streaming/protection/vo/ClearKeyKeySet.js"),o=n("./src/streaming/protection/CommonEncryption.js"),s=n("./src/streaming/constants/ProtectionConstants.js"),a="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",l=s.default.CLEARKEY_KEYSTEM_STRING;function c(e){var t,n=e.BASE64,s=e.debug.getLogger(t);return{uuid:a,schemeIdURI:"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",systemString:l,getInitData:function(e){return o.default.parseInitDataFromContentProtection(e,n)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getClearKeysFromProtectionData:function(e,t){var n=null;if(e){for(var o=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),a=[],l=0;l<o.kids.length;l++){var c=o.kids[l],u=e.clearkeys&&e.clearkeys.hasOwnProperty(c)?e.clearkeys[c]:null;if(!u)throw new Error("DRM: ClearKey keyID ("+c+") is not known!");a.push(new r.default(c,u))}n=new i.default(a),s.warn("ClearKey schemeIdURI is using W3C Common PSSH systemID (1077efec-c0b2-4d02-ace3-3c1e52e2fb4b) in Content Protection. See DASH-IF IOP v4.1 section 7.6.2.4")}return n}}}c.__dashjs_factory_name="KeySystemW3CClearKey";const u=dashjs.FactoryMaker.getSingletonFactory(c)},"./src/streaming/protection/drm/KeySystemWidevine.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var r=n("./src/streaming/protection/CommonEncryption.js"),i=n("./src/streaming/constants/ProtectionConstants.js"),o="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",s=i.default.WIDEVINE_KEYSTEM_STRING;function a(e){var t=(e=e||{}).BASE64;return{uuid:o,schemeIdURI:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",systemString:s,getInitData:function(e){return r.default.parseInitDataFromContentProtection(e,t)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null}}}a.__dashjs_factory_name="KeySystemWidevine";const l=dashjs.FactoryMaker.getSingletonFactory(a)},"./src/streaming/protection/errors/ProtectionErrors.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/core/errors/ErrorsBase.js");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const a=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(n,r.default);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var o=s(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,n)}}(n);function n(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(e=t.call(this)).MEDIA_KEYERR_CODE=100,e.MEDIA_KEYERR_UNKNOWN_CODE=101,e.MEDIA_KEYERR_CLIENT_CODE=102,e.MEDIA_KEYERR_SERVICE_CODE=103,e.MEDIA_KEYERR_OUTPUT_CODE=104,e.MEDIA_KEYERR_HARDWARECHANGE_CODE=105,e.MEDIA_KEYERR_DOMAIN_CODE=106,e.MEDIA_KEY_MESSAGE_ERROR_CODE=107,e.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE=108,e.SERVER_CERTIFICATE_UPDATED_ERROR_CODE=109,e.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE=110,e.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE=111,e.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE=112,e.KEY_SESSION_CREATED_ERROR_CODE=113,e.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE=114,e.MEDIA_KEYERR_UNKNOWN_MESSAGE="An unspecified error occurred. This value is used for errors that don't match any of the other codes.",e.MEDIA_KEYERR_CLIENT_MESSAGE="The Key System could not be installed or updated.",e.MEDIA_KEYERR_SERVICE_MESSAGE="The message passed into update indicated an error from the license service.",e.MEDIA_KEYERR_OUTPUT_MESSAGE="There is no available output device with the required characteristics for the content protection system.",e.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE="A hardware configuration change caused a content protection error.",e.MEDIA_KEYERR_DOMAIN_MESSAGE="An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain.",e.MEDIA_KEY_MESSAGE_ERROR_MESSAGE="Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!",e.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE="DRM: Empty key message from CDM",e.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE="Error updating server certificate -- ",e.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE="DRM: KeyStatusChange error! -- License has expired",e.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE="DRM: No license server URL specified!",e.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE="DRM: KeySystem Access Denied! -- ",e.KEY_SESSION_CREATED_ERROR_MESSAGE="DRM: unable to create session! --",e.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE="DRM: licenser error! --",e}return n}())},"./src/streaming/protection/models/ProtectionModel_01b.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var r=n("./src/streaming/protection/controllers/ProtectionKeyController.js"),i=n("./src/streaming/protection/vo/NeedKey.js"),o=n("./src/streaming/vo/DashJSError.js"),s=n("./src/streaming/protection/vo/KeyMessage.js"),a=n("./src/streaming/protection/vo/KeySystemConfiguration.js"),l=n("./src/streaming/protection/vo/KeySystemAccess.js"),c=n("./src/streaming/protection/errors/ProtectionErrors.js");function u(e){e=e||{};var t,n,u,d,p,h,f,g,m,v=this.context,y=e.eventBus,b=e.events,x=e.debug,E=e.api,_=e.errHandler;function w(){u&&k();for(var e=0;e<f.length;e++)S(f[e]);y.trigger(b.TEARDOWN_COMPLETE)}function S(e){try{u[E.cancelKeyRequest](d.systemString,e.sessionId)}catch(t){y.trigger(b.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.sessionId+") "+t.message})}}function T(e,t){if(t&&e){for(var n=e.length,r=0;r<n;r++)if(e[r].sessionId==t)return e[r];return null}return null}function k(){u.removeEventListener(E.keyerror,m),u.removeEventListener(E.needkey,m),u.removeEventListener(E.keymessage,m),u.removeEventListener(E.keyadded,m)}return t={getAllInitData:function(){for(var e=[],t=0;t<h.length;t++)e.push(h[t].initData);for(var n=0;n<f.length;n++)e.push(f[n].initData);return e},getSessions:function(){return f.concat(h)},requestKeySystemAccess:function(e){return new Promise((function(t,n){var r=u;r||(r=document.createElement("video"));for(var i=!1,o=0;o<e.length;o++)for(var s=e[o].ks.systemString,c=e[o].configs,d=null,h=0;h<c.length;h++){var f=c[h].videoCapabilities;if(f&&0!==f.length){d=[];for(var g=0;g<f.length;g++)""!==r.canPlayType(f[g].contentType,s)&&d.push(f[g])}if(d&&(!d||0!==d.length)){i=!0;var m=new a.default(null,d),v=p.getKeySystemBySystemString(s),x=new l.default(v,m);y.trigger(b.KEY_SYSTEM_ACCESS_COMPLETE,{data:x}),t({data:x});break}}if(!i){var E="Key system access denied! -- No valid audio/video content configurations detected!";y.trigger(b.KEY_SYSTEM_ACCESS_COMPLETE,{error:E}),n({error:E})}}))},selectKeySystem:function(e){return d=e.keySystem,Promise.resolve(d)},setMediaElement:function(e){if(u!==e){if(u){k();for(var t=0;t<f.length;t++)S(f[t]);f=[]}(u=e)&&(u.addEventListener(E.keyerror,m),u.addEventListener(E.needkey,m),u.addEventListener(E.keymessage,m),u.addEventListener(E.keyadded,m),y.trigger(b.VIDEO_ELEMENT_SELECTED))}},createKeySession:function(e){if(!d)throw new Error("Can not create sessions until you have selected a key system");if(g||0===f.length){var t={sessionId:null,keyId:e.keyId,initData:e.initData,getKeyId:function(){return this.keyId},getSessionId:function(){return this.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return h.push(t),u[E.generateKeyRequest](d.systemString,new Uint8Array(e.initData)),t}throw new Error("Multiple sessions not allowed!")},updateKeySession:function(e,t){var n=e.sessionId;if(p.isClearKey(d))for(var r=0;r<t.keyPairs.length;r++)u[E.addKey](d.systemString,t.keyPairs[r].key,t.keyPairs[r].keyID,n);else u[E.addKey](d.systemString,new Uint8Array(t),new Uint8Array(e.initData),n);y.trigger(b.KEY_SESSION_UPDATED)},closeKeySession:S,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:w,reset:w},n=x.getLogger(t),u=null,d=null,h=[],f=[],p=(0,r.default)(v).getInstance(),m={handleEvent:function(e){var t=null;switch(e.type){case E.needkey:var r=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;y.trigger(b.NEED_KEY,{key:new i.default(r,"cenc")});break;case E.keyerror:if((t=T(f,e.sessionId))||(t=T(h,e.sessionId)),t){var a=c.default.MEDIA_KEYERR_CODE,l="";switch(e.errorCode.code){case 1:a=c.default.MEDIA_KEYERR_UNKNOWN_CODE,l+="MEDIA_KEYERR_UNKNOWN - "+c.default.MEDIA_KEYERR_UNKNOWN_MESSAGE;break;case 2:a=c.default.MEDIA_KEYERR_CLIENT_CODE,l+="MEDIA_KEYERR_CLIENT - "+c.default.MEDIA_KEYERR_CLIENT_MESSAGE;break;case 3:a=c.default.MEDIA_KEYERR_SERVICE_CODE,l+="MEDIA_KEYERR_SERVICE - "+c.default.MEDIA_KEYERR_SERVICE_MESSAGE;break;case 4:a=c.default.MEDIA_KEYERR_OUTPUT_CODE,l+="MEDIA_KEYERR_OUTPUT - "+c.default.MEDIA_KEYERR_OUTPUT_MESSAGE;break;case 5:a=c.default.MEDIA_KEYERR_HARDWARECHANGE_CODE,l+="MEDIA_KEYERR_HARDWARECHANGE - "+c.default.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE;break;case 6:a=c.default.MEDIA_KEYERR_DOMAIN_CODE,l+="MEDIA_KEYERR_DOMAIN - "+c.default.MEDIA_KEYERR_DOMAIN_MESSAGE}l+="  System Code = "+e.systemCode,y.trigger(b.KEY_ERROR,{error:new o.default(a,l,t)})}else n.error("No session token found for key error");break;case E.keyadded:(t=T(f,e.sessionId))||(t=T(h,e.sessionId)),t?(n.debug("DRM: Key added."),y.trigger(b.KEY_ADDED,{data:t})):n.debug("No session token found for key added");break;case E.keymessage:if((g=null!==e.sessionId&&void 0!==e.sessionId)?!(t=T(f,e.sessionId))&&h.length>0&&(t=h.shift(),f.push(t),t.sessionId=e.sessionId,y.trigger(b.KEY_SESSION_CREATED,{data:t})):h.length>0&&(t=h.shift(),f.push(t),0!==h.length&&_.error(new o.default(c.default.MEDIA_KEY_MESSAGE_ERROR_CODE,c.default.MEDIA_KEY_MESSAGE_ERROR_MESSAGE))),t){var u=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;t.keyMessage=u,y.trigger(b.INTERNAL_KEY_MESSAGE,{data:new s.default(t,u,e.defaultURL)})}else n.warn("No session token found for key message")}}},t}u.__dashjs_factory_name="ProtectionModel_01b";const d=dashjs.FactoryMaker.getClassFactory(u)},"./src/streaming/protection/models/ProtectionModel_21Jan2015.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});var r=n("./src/streaming/protection/controllers/ProtectionKeyController.js"),i=n("./src/streaming/protection/vo/NeedKey.js"),o=n("./src/streaming/protection/errors/ProtectionErrors.js"),s=n("./src/streaming/vo/DashJSError.js"),a=n("./src/streaming/protection/vo/KeyMessage.js"),l=n("./src/streaming/protection/vo/KeySystemAccess.js"),c=n("./src/streaming/constants/ProtectionConstants.js"),u={};function d(e){e=e||{};var t,n,d,p,h,f,g,m,v=this.context,y=e.eventBus,b=e.events,x=e.debug;function E(e){var t=e.session;return t.removeEventListener("keystatuseschange",e),t.removeEventListener("message",e),t.close()}function _(e){for(var t=0;t<f.length;t++)if(f[t]===e){f.splice(t,1);break}}function w(e){var t,n;return e&&e.length>0&&(e[0]&&("string"==typeof e[0]?t=e[0]:n=e[0]),e[1]&&("string"==typeof e[1]?t=e[1]:n=e[1])),{status:t,keyId:n}}function S(e,t){var r={session:e,keyId:t.keyId,initData:t.initData,sessionId:t.sessionId,sessionType:t.sessionType,handleEvent:function(e){switch(e.type){case"keystatuseschange":y.trigger(b.KEY_STATUSES_CHANGED,{data:this}),e.target.keyStatuses.forEach((function(){var e=w(arguments);switch(e.status){case"expired":y.trigger(b.INTERNAL_KEY_STATUS_CHANGED,{error:new s.default(o.default.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE,o.default.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE)});break;default:y.trigger(b.INTERNAL_KEY_STATUS_CHANGED,e)}}));break;case"message":var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;y.trigger(b.INTERNAL_KEY_MESSAGE,{data:new a.default(this,t,void 0,e.messageType)})}},getKeyId:function(){return this.keyId},getSessionId:function(){return e.sessionId},getSessionType:function(){return this.sessionType},getExpirationTime:function(){return e.expiration},getKeyStatuses:function(){return e.keyStatuses},getUsable:function(){var t=!1;return e.keyStatuses.forEach((function(){"usable"===w(arguments).status&&(t=!0)})),t}};return e.addEventListener("keystatuseschange",r),e.addEventListener("message",r),e.closed.then((function(){_(r),n.debug("DRM: Session closed.  SessionID = "+r.getSessionId()),y.trigger(b.KEY_SESSION_CLOSED,{data:r.getSessionId()})})),f.push(r),r}return t={getAllInitData:function(){for(var e=[],t=0;t<f.length;t++)f[t].initData&&e.push(f[t].initData);return e},getSessions:function(){return f},requestKeySystemAccess:function(e){return new Promise((function(t,r){!function e(t,r,i,o){if(void 0===navigator.requestMediaKeySystemAccess||"function"!=typeof navigator.requestMediaKeySystemAccess){var s="Insecure origins are not allowed";return y.trigger(b.KEY_SYSTEM_ACCESS_COMPLETE,{error:s}),void o({error:s})}var a=t[r].protData&&t[r].protData.systemStringPriority?t[r].protData.systemStringPriority:null,c=t[r].configs,d=t[r].ks,p=d.systemString;(function(e,t){return new Promise((function(r,i){!function e(t,r,i,o,s){var a=t[i];n.debug("Requesting key system access for system string ".concat(a)),navigator.requestMediaKeySystemAccess(a,r).then((function(e){e.selectedSystemString=a,o(e)})).catch((function(n){i+1<t.length?e(t,r,i+1,o,s):s(n)}))}(e,t,0,r,i)}))})(a||(u[p]?u[p]:[p]),c).then((function(e){var t="function"==typeof e.getConfiguration?e.getConfiguration():null,n=new l.default(d,t);n.mksa=e,y.trigger(b.KEY_SYSTEM_ACCESS_COMPLETE,{data:n}),i({data:n})})).catch((function(n){r+1<t.length?e(t,r+1,i,o):(y.trigger(b.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! "+n.message}),o({error:"Key system access denied! "+n.message}))}))}(e,0,t,r)}))},selectKeySystem:function(e){return new Promise((function(t,n){e.mksa.createMediaKeys().then((function(t){return d=e.keySystem,h=t,p?p.setMediaKeys(h):Promise.resolve()})).then((function(){t(d)})).catch((function(){n({error:"Error selecting keys system ("+e.keySystem.systemString+")! Could not create MediaKeys -- TODO"})}))}))},setMediaElement:function(e){p!==e&&(p&&(p.removeEventListener("encrypted",g),p.setMediaKeys&&p.setMediaKeys(null)),(p=e)&&(p.addEventListener("encrypted",g),p.setMediaKeys&&h&&p.setMediaKeys(h)))},setServerCertificate:function(e){if(!d||!h)throw new Error("Can not set server certificate until you have selected a key system");h.setServerCertificate(e).then((function(){n.info("DRM: License server certificate successfully updated."),y.trigger(b.SERVER_CERTIFICATE_UPDATED)})).catch((function(e){y.trigger(b.SERVER_CERTIFICATE_UPDATED,{error:new s.default(o.default.SERVER_CERTIFICATE_UPDATED_ERROR_CODE,o.default.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE+e.name)})}))},createKeySession:function(e){if(!d||!h)throw new Error("Can not create sessions until you have selected a key system");var t=h.createSession(e.sessionType),r=S(t,e),i=d.systemString===c.default.CLEARKEY_KEYSTEM_STRING&&(e.initData||e.protData&&e.protData.clearkeys)?c.default.INITIALIZATION_DATA_TYPE_KEYIDS:c.default.INITIALIZATION_DATA_TYPE_CENC;t.generateRequest(i,e.initData).then((function(){n.debug("DRM: Session created.  SessionID = "+r.getSessionId()),y.trigger(b.KEY_SESSION_CREATED,{data:r})})).catch((function(e){_(r),y.trigger(b.KEY_SESSION_CREATED,{data:null,error:new s.default(o.default.KEY_SESSION_CREATED_ERROR_CODE,o.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Error generating key request -- "+e.name)})}))},updateKeySession:function(e,t){var n=e.session;m.isClearKey(d)&&(t=t.toJWK()),n.update(t).then((function(){y.trigger(b.KEY_SESSION_UPDATED)})).catch((function(t){y.trigger(b.KEY_ERROR,{error:new s.default(o.default.MEDIA_KEYERR_CODE,"Error sending update() message! "+t.name,e)})}))},loadKeySession:function(e){if(!d||!h)throw new Error("Can not load sessions until you have selected a key system");for(var t=e.sessionId,r=0;r<f.length;r++)if(t===f[r].sessionId)return void n.warn("DRM: Ignoring session ID because we have already seen it!");var i=h.createSession(e.sessionType),a=S(i,e);i.load(t).then((function(e){e?(n.debug("DRM: Session loaded.  SessionID = "+a.getSessionId()),y.trigger(b.KEY_SESSION_CREATED,{data:a})):(_(a),y.trigger(b.KEY_SESSION_CREATED,{data:null,error:new s.default(o.default.KEY_SESSION_CREATED_ERROR_CODE,o.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session! Invalid Session ID ("+t+")")}))})).catch((function(e){_(a),y.trigger(b.KEY_SESSION_CREATED,{data:null,error:new s.default(o.default.KEY_SESSION_CREATED_ERROR_CODE,o.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session ("+t+")! "+e.name)})}))},removeKeySession:function(e){e.session.remove().then((function(){n.debug("DRM: Session removed.  SessionID = "+e.getSessionId()),y.trigger(b.KEY_SESSION_REMOVED,{data:e.getSessionId()})}),(function(t){y.trigger(b.KEY_SESSION_REMOVED,{data:null,error:"Error removing session ("+e.getSessionId()+"). "+t.name})}))},closeKeySession:function(e){E(e).catch((function(t){_(e),y.trigger(b.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.getSessionId()+") "+t.name})}))},stop:function(){for(var e,t=0;t<f.length;t++)(e=f[t]).getUsable()||E(e).catch((function(){_(e)}))},reset:function(){var e,t=f.length;0!==t?function(){for(var n=function(e){_(e),0===f.length&&(p?(p.removeEventListener("encrypted",g),p.setMediaKeys(null).then((function(){y.trigger(b.TEARDOWN_COMPLETE)}))):y.trigger(b.TEARDOWN_COMPLETE))},r=0;r<t;r++)!function(t){e.session.closed.then((function(){n(t)})),E(e).catch((function(){n(t)}))}(e=f[r])}():y.trigger(b.TEARDOWN_COMPLETE)}},n=x.getLogger(t),d=null,p=null,h=null,f=[],m=(0,r.default)(v).getInstance(),g={handleEvent:function(e){switch(e.type){case"encrypted":if(e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;y.trigger(b.NEED_KEY,{key:new i.default(t,e.initDataType)})}}}},t}u[c.default.PLAYREADY_KEYSTEM_STRING]=[c.default.PLAYREADY_KEYSTEM_STRING,c.default.PLAYREADY_RECOMMENDATION_KEYSTEM_STRING],u[c.default.WIDEVINE_KEYSTEM_STRING]=[c.default.WIDEVINE_KEYSTEM_STRING],u[c.default.CLEARKEY_KEYSTEM_STRING]=[c.default.CLEARKEY_KEYSTEM_STRING],d.__dashjs_factory_name="ProtectionModel_21Jan2015";const p=dashjs.FactoryMaker.getClassFactory(d)},"./src/streaming/protection/models/ProtectionModel_3Feb2014.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var r=n("./src/streaming/protection/controllers/ProtectionKeyController.js"),i=n("./src/streaming/protection/vo/NeedKey.js"),o=n("./src/streaming/vo/DashJSError.js"),s=n("./src/streaming/protection/errors/ProtectionErrors.js"),a=n("./src/streaming/protection/vo/KeyMessage.js"),l=n("./src/streaming/protection/vo/KeySystemConfiguration.js"),c=n("./src/streaming/protection/vo/KeySystemAccess.js");function u(e){e=e||{};var t,n,u,d,p,h,f,g,m,v=this.context,y=e.eventBus,b=e.events,x=e.debug,E=e.api;function _(){try{for(var e=0;e<f.length;e++)w(f[e]);u&&u.removeEventListener(E.needkey,g),y.trigger(b.TEARDOWN_COMPLETE)}catch(e){y.trigger(b.TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+e.message})}}function w(e){var t=e.session;t.removeEventListener(E.error,e),t.removeEventListener(E.message,e),t.removeEventListener(E.ready,e),t.removeEventListener(E.close,e);for(var n=0;n<f.length;n++)if(f[n]===e){f.splice(n,1);break}t[E.release]()}function S(){var e=null,t=function(){u.removeEventListener("loadedmetadata",e),u[E.setMediaKeys](p),y.trigger(b.VIDEO_ELEMENT_SELECTED)};u.readyState>=1?t():(e=t.bind(this),u.addEventListener("loadedmetadata",e))}return t={getAllInitData:function(){for(var e=[],t=0;t<f.length;t++)e.push(f[t].initData);return e},getSessions:function(){return f},requestKeySystemAccess:function(e){return new Promise((function(t,n){for(var r=!1,i=0;i<e.length;i++)for(var o=e[i].ks.systemString,s=e[i].configs,a=null,u=null,d=0;d<s.length;d++){var p=s[d].audioCapabilities,h=s[d].videoCapabilities;if(p&&0!==p.length){a=[];for(var f=0;f<p.length;f++)window[E.MediaKeys].isTypeSupported(o,p[f].contentType)&&a.push(p[f])}if(h&&0!==h.length){u=[];for(var g=0;g<h.length;g++)window[E.MediaKeys].isTypeSupported(o,h[g].contentType)&&u.push(h[g])}if(!(!a&&!u||a&&0===a.length||u&&0===u.length)){r=!0;var v=new l.default(a,u),x=m.getKeySystemBySystemString(o),_=new c.default(x,v);y.trigger(b.KEY_SYSTEM_ACCESS_COMPLETE,{data:_}),t({data:_});break}}if(!r){var w="Key system access denied! -- No valid audio/video content configurations detected!";y.trigger(b.KEY_SYSTEM_ACCESS_COMPLETE,{error:w}),n({error:w})}}))},selectKeySystem:function(e){return new Promise((function(t,n){try{p=e.mediaKeys=new window[E.MediaKeys](e.keySystem.systemString),d=e.keySystem,h=e,u&&S(),t(d)}catch(e){n({error:"Error selecting keys system ("+d.systemString+")! Could not create MediaKeys -- TODO"})}}))},setMediaElement:function(e){u!==e&&(u&&u.removeEventListener(E.needkey,g),(u=e)&&(u.addEventListener(E.needkey,g),p&&S()))},createKeySession:function(e){if(!d||!p||!h)throw new Error("Can not create sessions until you have selected a key system");var t=null;if(h.ksConfiguration.videoCapabilities&&h.ksConfiguration.videoCapabilities.length>0&&(t=h.ksConfiguration.videoCapabilities[0]),null===t&&h.ksConfiguration.audioCapabilities&&h.ksConfiguration.audioCapabilities.length>0&&(t=h.ksConfiguration.audioCapabilities[0]),null===t)throw new Error("Can not create sessions for unknown content types.");var r=t.contentType,i=p.createSession(r,new Uint8Array(e.initData),e.cdmData?new Uint8Array(e.cdmData):null),l=function(e,t){return{session:e,keyId:t.keyId,initData:t.initData,getKeyId:function(){return this.keyId},getSessionId:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},handleEvent:function(e){switch(e.type){case E.error:y.trigger(b.KEY_ERROR,{error:new o.default(s.default.MEDIA_KEYERR_CODE,"KeyError",this)});break;case E.message:var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;y.trigger(b.INTERNAL_KEY_MESSAGE,{data:new a.default(this,t,e.destinationURL)});break;case E.ready:n.debug("DRM: Key added."),y.trigger(b.KEY_ADDED);break;case E.close:n.debug("DRM: Session closed.  SessionID = "+this.getSessionId()),y.trigger(b.KEY_SESSION_CLOSED,{data:this.getSessionId()})}}}}(i,e);i.addEventListener(E.error,l),i.addEventListener(E.message,l),i.addEventListener(E.ready,l),i.addEventListener(E.close,l),f.push(l),n.debug("DRM: Session created.  SessionID = "+l.getSessionId()),y.trigger(b.KEY_SESSION_CREATED,{data:l})},updateKeySession:function(e,t){var n=e.session;m.isClearKey(d)?n.update(new Uint8Array(t.toJWK())):n.update(new Uint8Array(t)),y.trigger(b.KEY_SESSION_UPDATED)},closeKeySession:w,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:_,reset:_},n=x.getLogger(t),u=null,d=null,p=null,h=null,f=[],m=(0,r.default)(v).getInstance(),g={handleEvent:function(e){switch(e.type){case E.needkey:if(e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;y.trigger(b.NEED_KEY,{key:new i.default(t,"cenc")})}}}},t}u.__dashjs_factory_name="ProtectionModel_3Feb2014";const d=dashjs.FactoryMaker.getClassFactory(u)},"./src/streaming/protection/servers/ClearKey.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/streaming/protection/vo/KeyPair.js"),i=n("./src/streaming/protection/vo/ClearKeyKeySet.js");function o(){return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"json"},getLicenseMessage:function(e){if(!e.hasOwnProperty("keys"))return null;for(var t=[],n=0;n<e.keys.length;n++){var o=e.keys[n],s=o.kid.replace(/=/g,""),a=o.k.replace(/=/g,"");t.push(new r.default(s,a))}return new i.default(t)},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}o.__dashjs_factory_name="ClearKey";const s=dashjs.FactoryMaker.getSingletonFactory(o)},"./src/streaming/protection/servers/DRMToday.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/streaming/constants/ProtectionConstants.js");function i(e){var t=(e=e||{}).BASE64,n={};return n[r.default.WIDEVINE_KEYSTEM_STRING]={responseType:"json",getLicenseMessage:function(e){return t.decodeArray(e.license)},getErrorResponse:function(e){return e}},n[r.default.PLAYREADY_KEYSTEM_STRING]={responseType:"arraybuffer",getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}},{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(e){return n[e].responseType},getLicenseMessage:function(e,r){return function(){if(!t||!t.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}(),n[r].getLicenseMessage(e)},getErrorResponse:function(e,t){return n[t].getErrorResponse(e)}}}i.__dashjs_factory_name="DRMToday";const o=dashjs.FactoryMaker.getSingletonFactory(i)},"./src/streaming/protection/servers/PlayReady.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/core/FactoryMaker.js");function i(){var e="http://schemas.xmlsoap.org/soap/envelope/";function t(e){var t=String.fromCharCode.apply(null,new Uint8Array(e));return decodeURIComponent(escape(t))}return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(n){return function(n){if(window.DOMParser){var r=t(n),i=(new window.DOMParser).parseFromString(r,"text/xml"),o=i?i.getElementsByTagNameNS(e,"Envelope")[0]:null,s=o?o.getElementsByTagNameNS(e,"Body")[0]:null;if(s&&s.getElementsByTagNameNS(e,"Fault")[0])return null}return n}.call(this,n)},getErrorResponse:function(n){return function(n){var r="",i="",o="",s=-1,a=-1;if(window.DOMParser){var l=t(n),c=(new window.DOMParser).parseFromString(l,"text/xml"),u=c?c.getElementsByTagNameNS(e,"Envelope")[0]:null,d=u?u.getElementsByTagNameNS(e,"Body")[0]:null,p=d?d.getElementsByTagNameNS(e,"Fault")[0]:null,h=p?p.getElementsByTagName("detail")[0]:null,f=h?h.getElementsByTagName("Exception")[0]:null,g=null;if(null===p)return l;r=(g=p.getElementsByTagName("faultstring")[0].firstChild)?g.nodeValue:null,null!==f&&(i=(g=f.getElementsByTagName("StatusCode")[0])?g.firstChild.nodeValue:null,s=(o=(g=f.getElementsByTagName("Message")[0])?g.firstChild.nodeValue:null)?o.lastIndexOf("[")+1:-1,a=o?o.indexOf("]"):-1,o=o?o.substring(s,a):"")}var m="code: ".concat(i,", name: ").concat(r);return o&&(m+=", message: ".concat(o)),m}.call(this,n)}}}i.__dashjs_factory_name="PlayReady";const o=r.default.getSingletonFactory(i)},"./src/streaming/protection/servers/Widevine.js":(e,t,n)=>{"use strict";function r(){return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}n.r(t),n.d(t,{default:()=>i}),r.__dashjs_factory_name="Widevine";const i=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/protection/vo/ClearKeyKeySet.js":(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,{default:()=>i});const i=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n&&"persistent"!==n&&"temporary"!==n)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=t,this.type=n}var t,n;return t=e,(n=[{key:"toJWK",value:function(){var e,t=this.keyPairs.length,n={keys:[]};for(e=0;e<t;e++){var r={kty:"oct",alg:"A128KW",kid:this.keyPairs[e].keyID,k:this.keyPairs[e].key};n.keys.push(r)}this.type&&(n.type=this.type);var i=JSON.stringify(n),o=i.length,s=new ArrayBuffer(o),a=new Uint8Array(s);for(e=0;e<o;e++)a[e]=i.charCodeAt(e);return s}}])&&r(t.prototype,n),e}()},"./src/streaming/protection/vo/KeyMessage.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sessionToken=t,this.message=n,this.defaultURL=r,this.messageType=i||"license-request"}},"./src/streaming/protection/vo/KeyPair.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keyID=t,this.key=n}},"./src/streaming/protection/vo/KeySystemAccess.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keySystem=t,this.ksConfiguration=n}},"./src/streaming/protection/vo/KeySystemConfiguration.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(t,n,r,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initDataTypes=["cenc"],t&&t.length&&(this.audioCapabilities=t),n&&n.length&&(this.videoCapabilities=n),this.distinctiveIdentifier=r,this.persistentState=i,this.sessionTypes=o}},"./src/streaming/protection/vo/LicenseRequest.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(t,n,r,i,o,s,a,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.method=n,this.responseType=r,this.headers=i,this.withCredentials=o,this.messageType=s,this.sessionId=a,this.data=l}},"./src/streaming/protection/vo/LicenseResponse.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.headers=n,this.data=r}},"./src/streaming/protection/vo/MediaCapability.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contentType=t,this.robustness=n}},"./src/streaming/protection/vo/NeedKey.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initData=t,this.initDataType=n}},"./src/streaming/rules/DroppedFramesHistory.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/core/FactoryMaker.js");function i(){var e={},t={},n={};return{push:function(r,i,o){if(i){e[r]||(e[r]=[],t[r]=0,n[r]=0);var s=o&&o.droppedVideoFrames?o.droppedVideoFrames:0,a=o&&o.totalVideoFrames?o.totalVideoFrames:0,l=s-t[r];t[r]=s;var c=a-n[r];n[r]=a;var u=e[r];isNaN(i)||(u[i]?(u[i].droppedVideoFrames+=l,u[i].totalVideoFrames+=c):u[i]={droppedVideoFrames:l,totalVideoFrames:c})}},getFrameHistory:function(t){return e[t]},clearForStream:function(r){try{delete e[r],delete t[r],delete n[r]}catch(e){}},reset:function(){e={},t={},n={}}}}i.__dashjs_factory_name="DroppedFramesHistory";const o=r.default.getClassFactory(i)},"./src/streaming/rules/RulesContext.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/core/FactoryMaker.js");function i(e){var t=(e=e||{}).abrController,n=e.switchHistory,r=e.droppedFramesHistory,i=e.currentRequest,o=e.useBufferOccupancyABR,s=e.useL2AABR,a=e.useLoLPABR,l=e.streamProcessor?e.streamProcessor.getScheduleController():null,c=e.streamProcessor?e.streamProcessor.getRepresentationInfo():null,u=e.videoModel?e.videoModel:null;function d(){return c?c.mediaInfo:null}return{getMediaType:function(){var e=d();return e?e.type:null},getMediaInfo:d,getDroppedFramesHistory:function(){return r},getCurrentRequest:function(){return i},getSwitchHistory:function(){return n},getStreamInfo:function(){var e=d();return e?e.streamInfo:null},getScheduleController:function(){return l},getAbrController:function(){return t},getRepresentationInfo:function(){return c},useBufferOccupancyABR:function(){return o},useL2AABR:function(){return s},useLoLPABR:function(){return a},getVideoModel:function(){return u}}}i.__dashjs_factory_name="RulesContext";const o=r.default.getClassFactory(i)},"./src/streaming/rules/SwitchRequest.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/core/FactoryMaker.js"),i={DEFAULT:.5,STRONG:1,WEAK:0};function o(e,t,n){return{quality:void 0===e?-1:e,reason:void 0===t?null:t,priority:function(e){var t=i.DEFAULT;return e!==i.DEFAULT&&e!==i.STRONG&&e!==i.WEAK||(t=e),t}(n)}}o.__dashjs_factory_name="SwitchRequest";var s=r.default.getClassFactory(o);s.NO_CHANGE=-1,s.PRIORITY=i,r.default.updateClassFactory(o.__dashjs_factory_name,s);const a=s},"./src/streaming/rules/SwitchRequestHistory.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/rules/SwitchRequest.js");function o(){var e=[],t=[];return{push:function(n){n.newValue===i.default.NO_CHANGE&&(n.newValue=n.oldValue),e[n.oldValue]||(e[n.oldValue]={noDrops:0,drops:0,dropSize:0});var r=n.newValue-n.oldValue,o=r<0?1:0,s=o?-r:0,a=o?0:1;if(e[n.oldValue].drops+=o,e[n.oldValue].dropSize+=s,e[n.oldValue].noDrops+=a,t.push({idx:n.oldValue,noDrop:a,drop:o,dropSize:s}),t.length>8){var l=t.shift();e[l.idx].drops-=l.drop,e[l.idx].dropSize-=l.dropSize,e[l.idx].noDrops-=l.noDrop}},getSwitchRequests:function(){return e},reset:function(){e=[],t=[]}}}o.__dashjs_factory_name="SwitchRequestHistory";const s=r.default.getClassFactory(o)},"./src/streaming/rules/ThroughputHistory.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/core/FactoryMaker.js");function o(e){var t,n,i,o,s,a=(e=e||{}).settings;function l(e,t,n,r){var i=Math.pow(.5,n/r.fast);e.fastEstimate=(1-i)*t+i*e.fastEstimate;var o=Math.pow(.5,n/r.slow);e.slowEstimate=(1-o)*t+o*e.slowEstimate,e.totalWeight+=n}function c(e,l,c){return a.get().streaming.abr.movingAverageMethod!==r.default.MOVING_AVERAGE_SLIDING_WINDOW?function(e,t){var n=e?s.throughputHalfLife:s.latencyHalfLife,r=e?i[t]:o[t];if(!r||r.totalWeight<=0)return NaN;var a=r.fastEstimate/(1-Math.pow(.5,r.totalWeight/n.fast)),l=r.slowEstimate/(1-Math.pow(.5,r.totalWeight/n.slow));return e?Math.min(a,l):Math.max(a,l)}(e,l):function(e,r,i){var o=function(e,r,i){var o,s;if(e?(o=t[r],s=i?3:4):(o=n[r],s=4),o){if(s>=o.length)s=o.length;else if(e)for(var a=1;a<s;++a){var l=o[o.length-a]/o[o.length-a-1];if((l>=1.3||l<=1/1.3)&&(s+=1)===o.length)break}}else s=0;return s}(e,r,i),s=(e?t:n)[r];return 0!==o&&s&&0!==s.length?(s=s.slice(-o)).reduce((function(e,t){return e+t}))/s.length:NaN}(e,l,c)}function u(e,t){return c(!0,e,t)}function d(e){t[e]=t[e]||[],n[e]=n[e]||[],i[e]=i[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0},o[e]=o[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0}}function p(){t={},n={},i={},o={}}var h={push:function(e,c,u){if(c.trace&&c.trace.length){var p,h=c.tresponse.getTime()-c.trequest.getTime()||1,f=c._tfinish.getTime()-c.tresponse.getTime()||1,g=c.trace.reduce((function(e,t){return e+t.b[0]}),0),m=0;if(0!==(p=c._fileLoaderType&&c._fileLoaderType===r.default.FILE_LOADER_TYPES.FETCH?c.trace.reduce((function(e,t){return e+t.d}),0):u?f:h+f)&&(m=Math.round(8*g/p)),c.cmsd){var v=c.cmsd.dynamic&&c.cmsd.dynamic.etp?c.cmsd.dynamic.etp:null;if(v){var y=a.get().streaming.cmsd.abr.etpWeightRatio;y>0&&y<=1&&(m=m*(1-y)+v*y)}}if(d(e),function(e,t,n){return e===r.default.VIDEO?n<a.get().streaming.cacheLoadThresholds[r.default.VIDEO]:e===r.default.AUDIO?n<a.get().streaming.cacheLoadThresholds[r.default.AUDIO]:void 0}(e,0,f)){if(t[e].length>0&&!t[e].hasCachedEntries)return;t[e].hasCachedEntries=!0}else t[e]&&t[e].hasCachedEntries&&function(e){delete t[e],delete n[e],delete i[e],delete o[e],d(e)}(e);t[e].push(m),t[e].length>20&&t[e].shift(),n[e].push(h),n[e].length>20&&n[e].shift(),l(i[e],m,.001*f,s.throughputHalfLife),l(o[e],h,1,s.latencyHalfLife)}},getAverageThroughput:u,getSafeAverageThroughput:function(e,t){var n=u(e,t);return isNaN(n)||(n*=a.get().streaming.abr.bandwidthSafetyFactor),n},getAverageLatency:function(e){return c(!1,e)},reset:p};return s={throughputHalfLife:{fast:3,slow:8},latencyHalfLife:{fast:1,slow:2}},p(),h}o.__dashjs_factory_name="ThroughputHistory";const s=i.default.getClassFactory(o)},"./src/streaming/rules/abr/ABRRulesCollection.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>y});var r=n("./src/streaming/rules/abr/ThroughputRule.js"),i=n("./src/streaming/rules/abr/InsufficientBufferRule.js"),o=n("./src/streaming/rules/abr/AbandonRequestsRule.js"),s=n("./src/streaming/rules/abr/DroppedFramesRule.js"),a=n("./src/streaming/rules/abr/SwitchHistoryRule.js"),l=n("./src/streaming/rules/abr/BolaRule.js"),c=n("./src/streaming/rules/abr/L2ARule.js"),u=n("./src/streaming/rules/abr/lolp/LoLpRule.js"),d=n("./src/core/FactoryMaker.js"),p=n("./src/streaming/rules/SwitchRequest.js"),h=n("./src/streaming/constants/Constants.js"),f="qualitySwitchRules",g="abandonFragmentRules";function m(e){e=e||{};var t,n,d=this.context,m=e.mediaPlayerModel,v=e.customParametersModel,y=e.dashMetrics,b=e.settings;function x(e){return e.filter((function(e){return e.quality>p.default.NO_CHANGE}))}function E(e){var t,n,r,i,o,s={},a=null;if(0!==e.length){for(s[p.default.PRIORITY.STRONG]={quality:p.default.NO_CHANGE,reason:null},s[p.default.PRIORITY.WEAK]={quality:p.default.NO_CHANGE,reason:null},s[p.default.PRIORITY.DEFAULT]={quality:p.default.NO_CHANGE,reason:null},t=0,n=e.length;t<n;t+=1)(r=e[t]).quality!==p.default.NO_CHANGE&&(s[r.priority].quality===p.default.NO_CHANGE||s[r.priority].quality>r.quality)&&(s[r.priority].quality=r.quality,s[r.priority].reason=r.reason||null);return s[p.default.PRIORITY.WEAK].quality!==p.default.NO_CHANGE&&(a=s[p.default.PRIORITY.WEAK]),s[p.default.PRIORITY.DEFAULT].quality!==p.default.NO_CHANGE&&(a=s[p.default.PRIORITY.DEFAULT]),s[p.default.PRIORITY.STRONG].quality!==p.default.NO_CHANGE&&(a=s[p.default.PRIORITY.STRONG]),a&&(i=a.quality,o=a.reason),(0,p.default)(d).create(i,o)}}return{initialize:function(){t=[],n=[],b.get().streaming.abr.useDefaultABRRules&&(b.get().streaming.abr.ABRStrategy===h.default.ABR_STRATEGY_L2A?t.push((0,c.default)(d).create({dashMetrics:y,settings:b})):b.get().streaming.abr.ABRStrategy===h.default.ABR_STRATEGY_LoLP?t.push((0,u.default)(d).create({dashMetrics:y})):(t.push((0,l.default)(d).create({dashMetrics:y,mediaPlayerModel:m,settings:b})),t.push((0,r.default)(d).create({dashMetrics:y})),b.get().streaming.abr.additionalAbrRules.insufficientBufferRule&&t.push((0,i.default)(d).create({dashMetrics:y,settings:b})),b.get().streaming.abr.additionalAbrRules.switchHistoryRule&&t.push((0,a.default)(d).create()),b.get().streaming.abr.additionalAbrRules.droppedFramesRule&&t.push((0,s.default)(d).create()),b.get().streaming.abr.additionalAbrRules.abandonRequestsRule&&n.push((0,o.default)(d).create({dashMetrics:y,mediaPlayerModel:m,settings:b})))),v.getAbrCustomRules().forEach((function(e){e.type===f&&t.push(e.rule(d).create()),e.type===g&&n.push(e.rule(d).create())}))},reset:function(){[t,n].forEach((function(e){e&&e.length&&e.forEach((function(e){return e.reset&&e.reset()}))})),t=[],n=[]},getMaxQuality:function(e){return E(x(t.map((function(t){return t.getMaxIndex(e)}))))||(0,p.default)(d).create()},getMinSwitchRequest:E,shouldAbandonFragment:function(e,t){return E(x(n.map((function(n){return n.shouldAbandon(e,t)}))))||(0,p.default)(d).create()},getQualitySwitchRules:function(){return t}}}m.__dashjs_factory_name="ABRRulesCollection";var v=d.default.getClassFactory(m);v.QUALITY_SWITCH_RULES=f,v.ABANDON_FRAGMENT_RULES=g,d.default.updateSingletonFactory(m.__dashjs_factory_name,v);const y=v},"./src/streaming/rules/abr/AbandonRequestsRule.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/streaming/rules/SwitchRequest.js"),i=n("./src/core/FactoryMaker.js"),o=n("./src/core/Debug.js");function s(e){e=e||{};var t,n,i,a,l,c=this.context,u=e.mediaPlayerModel,d=e.dashMetrics,p=e.settings;function h(){i={},a={},l=[]}return t={shouldAbandon:function(e){var t=(0,r.default)(c).create(r.default.NO_CHANGE,{name:s.__dashjs_factory_name});if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getCurrentRequest")&&e.hasOwnProperty("getRepresentationInfo")&&e.hasOwnProperty("getAbrController")))return t;var o,h,f=e.getMediaInfo(),g=e.getMediaType(),m=e.getStreamInfo(),v=m?m.id:null,y=e.getCurrentRequest();if(!isNaN(y.index)){o=g,h=y.index,i[o]=i[o]||{},i[o][h]=i[o][h]||{};var b=u.getStableBufferTime();if(d.getCurrentBufferLevel(g)>b)return t;var x=i[g][y.index];if(null===x||null===y.firstByteDate||a.hasOwnProperty(x.id))return t;if(void 0===x.firstByteTime&&(l[g]=[],x.firstByteTime=y.firstByteDate.getTime(),x.segmentDuration=y.duration,x.bytesTotal=y.bytesTotal,x.id=y.index),x.bytesLoaded=y.bytesLoaded,x.elapsedTime=(new Date).getTime()-x.firstByteTime,x.bytesLoaded>0&&x.elapsedTime>0&&function(e,t){l[e]=l[e]||[],l[e].push(t)}(g,Math.round(8*x.bytesLoaded/x.elapsedTime)),l[g].length>=5&&x.elapsedTime>500&&x.bytesLoaded<x.bytesTotal){var E=l[g].reduce((function(e,t){return e+t}),0);if(x.measuredBandwidthInKbps=Math.round(E/l[g].length),x.estimatedTimeOfDownload=+(8*x.bytesTotal/x.measuredBandwidthInKbps/1e3).toFixed(2),x.estimatedTimeOfDownload<1.8*x.segmentDuration||0===e.getRepresentationInfo().quality)return t;if(!a.hasOwnProperty(x.id)){var _=e.getAbrController(),w=x.bytesTotal-x.bytesLoaded,S=_.getBitrateList(f),T=_.getQualityForBitrate(f,x.measuredBandwidthInKbps*p.get().streaming.abr.bandwidthSafetyFactor,v),k=_.getMinAllowedIndexFor(g,v),C=void 0!==k?Math.max(k,T):T;w>x.bytesTotal*S[C].bitrate/S[_.getQualityFor(g,v)].bitrate&&(t.quality=C,t.reason.throughput=x.measuredBandwidthInKbps,t.reason.fragmentID=x.id,a[x.id]=x,n.debug("["+g+"] frag id",x.id," is asking to abandon and switch to quality to ",C," measured bandwidth was",x.measuredBandwidthInKbps),delete i[g][x.id])}}else x.bytesLoaded===x.bytesTotal&&delete i[g][x.id]}return t},reset:h},n=(0,o.default)(c).getInstance().getLogger(t),h(),t}s.__dashjs_factory_name="AbandonRequestsRule";const a=i.default.getClassFactory(s)},"./src/streaming/rules/abr/BolaRule.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>f});var r=n("./src/streaming/constants/MetricsConstants.js"),i=n("./src/streaming/rules/SwitchRequest.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/streaming/vo/metrics/HTTPRequest.js"),a=n("./src/core/EventBus.js"),l=n("./src/core/events/Events.js"),c=n("./src/core/Debug.js"),u=n("./src/streaming/MediaPlayerEvents.js"),d=n("./src/streaming/constants/Constants.js"),p=10;function h(e){e=e||{};var t,n,o,h=this.context,f=e.dashMetrics,g=e.mediaPlayerModel,m=(0,a.default)(h).getInstance();function v(e,t,n){var r=n.reduce((function(e,t,r){return t>n[e]?r:e}),0);if(0===r)return null;var i=Math.max(e,p+2*t.length),o=(n[r]-1)/(i/p-1);return{gp:o,Vp:p/o}}function y(e){var t={},n=e.getMediaInfo().bitrateList.map((function(e){return e.bandwidth})),r=function(e){return e.map((function(e){return Math.log(e)}))}(n);r=r.map((function(e){return e-r[0]+1}));var i=g.getStableBufferTime(),o=v(i,n,r);return o?(t.state=1,t.bitrates=n,t.utilities=r,t.stableBufferTime=i,t.Vp=o.Vp,t.gp=o.gp,t.lastQuality=0,b(t)):t.state=0,t}function b(e){e.placeholderBuffer=0,e.mostAdvancedSegmentStart=NaN,e.lastSegmentWasReplacement=!1,e.lastSegmentStart=NaN,e.lastSegmentDurationS=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN}function x(e,t){var n=g.getStableBufferTime();if(e.stableBufferTime!==n){var r=v(n,e.bitrates,e.utilities);if(r.Vp!==e.Vp||r.gp!==e.gp){var i=f.getCurrentBufferLevel(t),o=i+e.placeholderBuffer;o-=p,o*=r.Vp/e.Vp,o+=p,e.stableBufferTime=n,e.Vp=r.Vp,e.gp=r.gp,e.placeholderBuffer=Math.max(0,o-i)}}}function E(e,t){return e.Vp*(e.utilities[t]+e.gp)}function _(e,t){for(var n=e.bitrates[t],r=e.utilities[t],i=0,o=t-1;o>=0;--o)if(e.utilities[o]<e.utilities[t]){var s=e.bitrates[o],a=e.utilities[o],l=e.Vp*(e.gp+(n*a-s*r)/(n-s));i=Math.max(i,l)}return i}function w(e){var t=e.mediaType===d.default.AUDIO?[d.default.AUDIO]:o;for(var n in t)o.hasOwnProperty(n)&&2===o[n].state&&(o[n].placeholderBuffer=0)}function S(){for(var e in o)if(o.hasOwnProperty(e)){var t=o[e];0!==t.state&&(t.state=1,b(t))}}function T(e){if(e&&e.chunk&&e.chunk.mediaInfo){var t=o[e.chunk.mediaInfo.type];if(t&&0!==t.state){var n=e.chunk.start;isNaN(t.mostAdvancedSegmentStart)||n>t.mostAdvancedSegmentStart?(t.mostAdvancedSegmentStart=n,t.lastSegmentWasReplacement=!1):t.lastSegmentWasReplacement=!0,t.lastSegmentStart=n,t.lastSegmentDurationS=e.chunk.duration,t.lastQuality=e.chunk.quality,C(t,e.chunk.mediaInfo.type)}}}function k(e){if(e&&e.metric===r.default.HTTP_REQUEST&&e.value&&e.value.type===s.HTTPRequest.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){var t=o[e.mediaType];t&&0!==t.state&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),C(t,e.mediaType))}}function C(e,t){if(!isNaN(e.lastSegmentStart)&&!isNaN(e.lastSegmentRequestTimeMs)&&!isNaN(e.placeholderBuffer)){if(e.placeholderBuffer*=.99,!isNaN(e.lastSegmentFinishTimeMs)){var n=f.getCurrentBufferLevel(t)+.001*(e.lastSegmentFinishTimeMs-e.lastSegmentRequestTimeMs),r=E(e,e.lastQuality),i=Math.max(0,r-n);e.placeholderBuffer=Math.min(i,e.placeholderBuffer)}e.lastSegmentWasReplacement&&!isNaN(e.lastSegmentDurationS)&&(e.placeholderBuffer+=e.lastSegmentDurationS),e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN}}function A(e){if(e){var t=o[e.mediaType];t&&0!==t.state&&(t.abrQuality=e.newQuality)}}function j(e){if(e){var t=o[e.mediaType];if(t&&0!==t.state){var n,r=f.getCurrentBufferLevel(e.mediaType);n=t.abrQuality>0?_(t,t.abrQuality):p;var i=Math.max(0,n-r);t.placeholderBuffer=Math.min(t.placeholderBuffer,i)}}}function I(){o={}}return t={getMaxIndex:function(e){var t=(0,i.default)(h).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getScheduleController")&&e.hasOwnProperty("getStreamInfo")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("useBufferOccupancyABR")))return t;var r=e.getMediaInfo(),s=e.getMediaType(),a=e.getScheduleController(),l=e.getStreamInfo(),c=e.getAbrController(),u=c.getThroughputHistory(),d=l?l.id:null,p=l&&l.manifestInfo&&l.manifestInfo.isDynamic,g=e.useBufferOccupancyABR();if(t.reason=t.reason||{},!g)return t;a.setTimeToLoadDelay(0);var m=function(e){var t=e.getMediaType(),n=o[t];return n?0!==n.state&&x(n,t):(n=y(e),o[t]=n),n}(e);if(0===m.state)return t;var v,w=f.getCurrentBufferLevel(s),S=u.getAverageThroughput(s,p),T=u.getSafeAverageThroughput(s,p),k=u.getAverageLatency(s);if(t.reason.state=m.state,t.reason.throughput=S,t.reason.latency=k,isNaN(S))return t;switch(m.state){case 1:v=c.getQualityForBitrate(r,T,d,k),t.quality=v,t.reason.throughput=T,m.placeholderBuffer=Math.max(0,_(m,v)-w),m.lastQuality=v,!isNaN(m.lastSegmentDurationS)&&w>=m.lastSegmentDurationS&&(m.state=2);break;case 2:!function(e,t){var n=Date.now();if(isNaN(e.lastSegmentFinishTimeMs)){if(!isNaN(e.lastCallTimeMs)){var r=.001*(n-e.lastCallTimeMs);e.placeholderBuffer+=Math.max(0,r)}}else{var i=.001*(n-e.lastSegmentFinishTimeMs);e.placeholderBuffer+=Math.max(0,i)}e.lastCallTimeMs=n,e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN,x(e,t)}(m,s),v=function(e,t){for(var n=e.bitrates.length,r=NaN,i=NaN,o=0;o<n;++o){var s=(e.Vp*(e.utilities[o]+e.gp)-t)/e.bitrates[o];(isNaN(i)||s>=i)&&(i=s,r=o)}return r}(m,w+m.placeholderBuffer);var C=c.getQualityForBitrate(r,T,d,k);v>m.lastQuality&&v>C&&(v=Math.max(C,m.lastQuality));var A=Math.max(0,w+m.placeholderBuffer-E(m,v));A<=m.placeholderBuffer?(m.placeholderBuffer-=A,A=0):(A-=m.placeholderBuffer,m.placeholderBuffer=0,v<c.getMaxAllowedIndexFor(s,d)?a.setTimeToLoadDelay(1e3*A):A=0),t.quality=v,t.reason.throughput=S,t.reason.latency=k,t.reason.bufferLevel=w,t.reason.placeholderBuffer=m.placeholderBuffer,t.reason.delay=A,m.lastQuality=v;break;default:n.debug("BOLA ABR rule invoked in bad state."),t.quality=c.getQualityForBitrate(r,T,d,k),t.reason.state=m.state,t.reason.throughput=T,t.reason.latency=k,m.state=1,b(m)}return t},reset:function(){I(),m.off(u.default.BUFFER_EMPTY,w,t),m.off(u.default.PLAYBACK_SEEKING,S,t),m.off(u.default.METRIC_ADDED,k,t),m.off(u.default.QUALITY_CHANGE_REQUESTED,A,t),m.off(u.default.FRAGMENT_LOADING_ABANDONED,j,t),m.off(l.default.MEDIA_FRAGMENT_LOADED,T,t)}},n=(0,c.default)(h).getInstance().getLogger(t),I(),m.on(u.default.BUFFER_EMPTY,w,t),m.on(u.default.PLAYBACK_SEEKING,S,t),m.on(u.default.METRIC_ADDED,k,t),m.on(u.default.QUALITY_CHANGE_REQUESTED,A,t),m.on(u.default.FRAGMENT_LOADING_ABANDONED,j,t),m.on(l.default.MEDIA_FRAGMENT_LOADED,T,t),t}h.__dashjs_factory_name="BolaRule";const f=o.default.getClassFactory(h)},"./src/streaming/rules/abr/DroppedFramesRule.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/rules/SwitchRequest.js"),o=n("./src/core/Debug.js");function s(){var e,t,n=this.context;return e={getMaxIndex:function(e){var r=(0,i.default)(n).create();if(!e||!e.hasOwnProperty("getDroppedFramesHistory"))return r;var o=e.getDroppedFramesHistory(),s=e.getStreamInfo().id;if(o){var a=o.getFrameHistory(s);if(!a||0===a.length)return r;for(var l=0,c=0,u=i.default.NO_CHANGE,d=1;d<a.length;d++)if(a[d]&&(l=a[d].droppedVideoFrames,(c=a[d].totalVideoFrames)>375&&l/c>.15)){u=d-1,t.debug("index: "+u+" Dropped Frames: "+l+" Total Frames: "+c);break}return(0,i.default)(n).create(u,{droppedFrames:l})}return r}},t=(0,o.default)(n).getInstance().getLogger(e),e}s.__dashjs_factory_name="DroppedFramesRule";const a=r.default.getClassFactory(s)},"./src/streaming/rules/abr/InsufficientBufferRule.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});var r=n("./src/core/EventBus.js"),i=n("./src/core/events/Events.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/core/Debug.js"),a=n("./src/streaming/rules/SwitchRequest.js"),l=n("./src/streaming/constants/Constants.js"),c=n("./src/streaming/constants/MetricsConstants.js"),u=n("./src/streaming/MediaPlayerEvents.js");function d(e){e=e||{};var t,n,o,d=this.context,p=(0,r.default)(d).getInstance(),h=e.dashMetrics;function f(){(o={})[l.default.VIDEO]={ignoreCount:2},o[l.default.AUDIO]={ignoreCount:2}}function g(){f()}function m(e){isNaN(e.startTime)||e.mediaType!==l.default.AUDIO&&e.mediaType!==l.default.VIDEO||o[e.mediaType].ignoreCount>0&&o[e.mediaType].ignoreCount--}return t={getMaxIndex:function(e){var t=(0,a.default)(d).create();if(!e||!e.hasOwnProperty("getMediaType"))return t;!function(){if(!h||!h.hasOwnProperty("getCurrentBufferLevel")||!h.hasOwnProperty("getCurrentBufferState"))throw new Error(l.default.MISSING_CONFIG_ERROR)}();var r=e.getMediaType(),i=h.getCurrentBufferState(r),s=e.getRepresentationInfo().fragmentDuration,u=e.getStreamInfo(),p=u?u.id:null,f=e.getScheduleController(),g=u&&u.manifestInfo&&u.manifestInfo.isDynamic;if(function(e,t){return!e&&o[t].ignoreCount>0}(f.getPlaybackController().getLowLatencyModeEnabled(),r)||!s)return t;if(i&&i.state===c.default.BUFFER_EMPTY)n.debug("["+r+"] Switch to index 0; buffer is empty."),t.quality=0,t.reason="InsufficientBufferRule: Buffer is empty";else{var m=e.getMediaInfo(),v=e.getAbrController(),y=v.getThroughputHistory(),b=h.getCurrentBufferLevel(r),x=y.getAverageThroughput(r,g),E=y.getAverageLatency(r),_=x*(b/s)*.5;t.quality=v.getQualityForBitrate(m,_,p,E),t.reason="InsufficientBufferRule: being conservative to avoid immediate rebuffering"}return t},reset:function(){f(),p.off(u.default.PLAYBACK_SEEKING,g,t),p.off(i.default.BYTES_APPENDED_END_FRAGMENT,m,t)}},n=(0,s.default)(d).getInstance().getLogger(t),f(),p.on(u.default.PLAYBACK_SEEKING,g,t),p.on(i.default.BYTES_APPENDED_END_FRAGMENT,m,t),t}d.__dashjs_factory_name="InsufficientBufferRule";const p=o.default.getClassFactory(d)},"./src/streaming/rules/abr/L2ARule.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});var r=n("./src/streaming/constants/MetricsConstants.js"),i=n("./src/streaming/rules/SwitchRequest.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/streaming/vo/metrics/HTTPRequest.js"),a=n("./src/core/EventBus.js"),l=n("./src/core/events/Events.js"),c=n("./src/core/Debug.js"),u=n("./src/streaming/constants/Constants.js");function d(e){e=e||{};var t,n,o,d,p=this.context,h=e.dashMetrics,f=(0,a.default)(p).getInstance();function g(e){e.placeholderBuffer=0,e.mostAdvancedSegmentStart=NaN,e.lastSegmentWasReplacement=!1,e.lastSegmentStart=NaN,e.lastSegmentDurationS=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN}function m(){for(var e in n)if(n.hasOwnProperty(e)){var t=n[e];0!==t.state&&(t.state=1,g(t))}}function v(e){if(e&&e.chunk&&e.chunk.mediaInfo){var t=n[e.chunk.mediaInfo.type],r=o[e.chunk.mediaInfo.type];if(t&&0!==t.state){var i=e.chunk.start;isNaN(t.mostAdvancedSegmentStart)||i>t.mostAdvancedSegmentStart?(t.mostAdvancedSegmentStart=i,t.lastSegmentWasReplacement=!1):t.lastSegmentWasReplacement=!0,t.lastSegmentStart=i,t.lastSegmentDurationS=e.chunk.duration,t.lastQuality=e.chunk.quality,b(t,r)}}}function y(e){if(e&&e.metric===r.default.HTTP_REQUEST&&e.value&&e.value.type===s.HTTPRequest.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){var t=n[e.mediaType],i=o[e.mediaType];t&&0!==t.state&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),b(t,i))}}function b(e,t){isNaN(e.lastSegmentStart)||isNaN(e.lastSegmentRequestTimeMs)||(t.segment_request_start_s=.001*e.lastSegmentRequestTimeMs,t.segment_download_finish_s=.001*e.lastSegmentFinishTimeMs,e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN)}function x(e){if(e&&e.mediaType){var t=n[e.mediaType];t&&0!==t.state&&(t.abrQuality=e.newQuality)}}function E(e,t){if(e.length!==t.length)return-1;for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[r];return n}function _(){n={},o={}}return t={getMaxIndex:function(e){var t,r=(0,i.default)(p).create(),s=Math.pow(4,.99),a=Math.max(Math.pow(4,1),s*Math.sqrt(4)),l=e.getMediaInfo(),c=e.getMediaType(),f=l.bitrateList.map((function(e){return e.bandwidth})),m=f.length,v=e.getScheduleController(),y=e.getStreamInfo(),b=e.getAbrController(),x=b.getThroughputHistory(),_=y&&y.manifestInfo&&y.manifestInfo.isDynamic,w=e.useL2AABR(),S=h.getCurrentBufferLevel(c,!0),T=x.getSafeAverageThroughput(c,_),k=x.getAverageThroughput(c,_),C=x.getAverageLatency(c),A=e.getVideoModel().getPlaybackRate();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getScheduleController")&&e.hasOwnProperty("getStreamInfo")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("useL2AABR")))return r;if(r.reason=r.reason||{},!w||c===u.default.AUDIO)return r;v.setTimeToLoadDelay(0);var j=function(e){var t=e.getMediaType(),r=n[t];return r||(r=function(e){var t={},n=e.getMediaInfo(),r=n.bitrateList.map((function(e){return e.bandwidth/1e3}));return t.state=1,t.bitrates=r,t.lastQuality=0,function(e){e&&e.type&&(o[e.type]={},o[e.type].w=[],o[e.type].prev_w=[],o[e.type].Q=0,o[e.type].segment_request_start_s=0,o[e.type].segment_download_finish_s=0,o[e.type].B_target=1.5)}(n),g(t),t}(e),n[t]=r),r}(e);if(0===j.state)return r;var I=o[c];if(!I)return r;if(r.reason.state=j.state,r.reason.throughput=k,r.reason.latency=C,isNaN(k))return r;switch(j.state){case 1:if(t=b.getQualityForBitrate(l,T,y.id,C),r.quality=t,r.reason.throughput=T,j.lastQuality=t,!isNaN(j.lastSegmentDurationS)&&S>=I.B_target){j.state=2,I.Q=s;for(var O=0;O<m;++O)O===j.lastQuality?I.prev_w[O]=1:I.prev_w[O]=0}break;case 2:var N=[],R=h.getCurrentHttpRequest(c).trace.reduce((function(e,t){return e+t.d}),0),P=h.getCurrentHttpRequest(c).trace.reduce((function(e,t){return e+t.b[0]}),0),D=Math.round(8*P/R);D<1&&(D=1);for(var M=j.lastSegmentDurationS,L=1,B=0;B<m;++B)f[B]=f[B]/1e3,A*f[B]>D&&(L=-1),I.w[B]=I.prev_w[B]+L*(M/(2*a))*((I.Q+s)*(A*f[B]/D));I.w=function(e){for(var t=e.length,n=!1,r=[],i=0;i<t;++i)r[i]=e[i];for(var o=e.sort((function(e,t){return t-e})),s=0,a=0,l=[],c=0;c<t-1;++c)if((a=((s+=o[c])-1)/(c+1))>=o[c+1]){n=!0;break}n||(a=(s+o[t-1]-1)/t);for(var u=0;u<t;++u)l[u]=Math.max(r[u]-a,0);return l}(I.w);for(var F=0;F<m;++F)N[F]=I.w[F]-I.prev_w[F],I.prev_w[F]=I.w[F];I.Q=Math.max(0,I.Q-M+M*A*((E(f,I.prev_w)+E(f,N))/D));for(var U=[],H=0;H<m;++H)U[H]=Math.abs(f[H]-E(I.w,f));(t=U.indexOf(Math.min.apply(Math,U)))>j.lastQuality&&f[j.lastQuality+1]<=D&&(t=j.lastQuality+1),f[t]>=D&&(I.Q=2*Math.max(s,I.Q)),r.quality=t,r.reason.throughput=k,r.reason.latency=C,r.reason.bufferLevel=S,j.lastQuality=r.quality;break;default:d.debug("L2A ABR rule invoked in bad state."),r.quality=b.getQualityForBitrate(l,T,y.id,C),r.reason.state=j.state,r.reason.throughput=T,r.reason.latency=C,j.state=1,g(j)}return r},reset:function(){_(),f.off(l.default.PLAYBACK_SEEKING,m,t),f.off(l.default.MEDIA_FRAGMENT_LOADED,v,t),f.off(l.default.METRIC_ADDED,y,t),f.off(l.default.QUALITY_CHANGE_REQUESTED,x,t)}},d=(0,c.default)(p).getInstance().getLogger(t),_(),f.on(l.default.PLAYBACK_SEEKING,m,t),f.on(l.default.MEDIA_FRAGMENT_LOADED,v,t),f.on(l.default.METRIC_ADDED,y,t),f.on(l.default.QUALITY_CHANGE_REQUESTED,x,t),t}d.__dashjs_factory_name="L2ARule";const p=o.default.getClassFactory(d)},"./src/streaming/rules/abr/SwitchHistoryRule.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js"),o=n("./src/streaming/rules/SwitchRequest.js");function s(){var e,t,n=this.context;return e={getMaxIndex:function(e){for(var r=e?e.getSwitchHistory():null,i=r?r.getSwitchRequests():[],s=0,a=0,l=0,c=(0,o.default)(n).create(),u=0;u<i.length;u++)if(void 0!==i[u]&&(s+=i[u].drops,a+=i[u].noDrops,l+=i[u].dropSize,s+a>=6&&s/a>.075)){c.quality=u>0&&i[u].drops>0?u-1:u,c.reason={index:c.quality,drops:s,noDrops:a,dropSize:l},t.debug("Switch history rule index: "+c.quality+" samples: "+(s+a)+" drops: "+s);break}return c}},t=(0,i.default)(n).getInstance().getLogger(e),e}s.__dashjs_factory_name="SwitchHistoryRule";const a=r.default.getClassFactory(s)},"./src/streaming/rules/abr/ThroughputRule.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var r=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/rules/SwitchRequest.js"),o=n("./src/streaming/constants/Constants.js"),s=n("./src/streaming/constants/MetricsConstants.js");function a(e){e=e||{};var t=this.context,n=e.dashMetrics;return{getMaxIndex:function(e){var r=(0,i.default)(t).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("useBufferOccupancyABR")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("getScheduleController")))return r;!function(){if(!n||!n.hasOwnProperty("getCurrentBufferState"))throw new Error(o.default.MISSING_CONFIG_ERROR)}();var a=e.getMediaInfo(),l=e.getMediaType(),c=n.getCurrentBufferState(l),u=e.getScheduleController(),d=e.getAbrController(),p=e.getStreamInfo(),h=p?p.id:null,f=p&&p.manifestInfo?p.manifestInfo.isDynamic:null,g=d.getThroughputHistory(),m=g.getSafeAverageThroughput(l,f),v=g.getAverageLatency(l),y=e.useBufferOccupancyABR();return isNaN(m)||!c||y||d.getAbandonmentStateFor(h,l)!==s.default.ABANDON_LOAD&&(c.state===s.default.BUFFER_LOADED||f)&&(r.quality=d.getQualityForBitrate(a,m,h,v),u.setTimeToLoadDelay(0),r.reason={throughput:m,latency:v}),r},reset:function(){}}}a.__dashjs_factory_name="ThroughputRule";const l=r.default.getClassFactory(a)},"./src/streaming/rules/abr/lolp/LearningAbrController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var r=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js"),o="manual_weight_selection",s="random_weight_selection",a="dynamic_weight_selection";function l(){var e,t,n,r,l,c,u,d,p,h=this.context;function f(){n=null,r=1,l=100,c=0,u=null,d=null,p=a}function g(){var e=0;if(n)for(var t=0;t<n.length;t++){var r=n[t];r.state.throughput>e&&(e=r.state.throughput)}return e}function m(e,t,n){var r=e.map((function(e,r){return n[r]*Math.pow(e-t[r],2)})).reduce((function(e,t){return e+t}));return(r<0?-1:1)*Math.sqrt(Math.abs(r))}function v(e,t,n){for(var r=0;r<t.length;r++){var i=t[r],o=(a=e,m([(s=i).state.throughput,s.state.latency,s.state.rebuffer,s.state.switch],[a.state.throughput,a.state.latency,a.state.rebuffer,a.state.switch],[1,1,1,1]));y(i,n,Math.exp(-1*Math.pow(o,2)/(2*Math.pow(.1,2))))}var s,a}function y(e,t,n){var r=e.state,i=[.01,.01,.01,.01];r.throughput=r.throughput+(t[0]-r.throughput)*i[0]*n,r.latency=r.latency+(t[1]-r.latency)*i[1]*n,r.rebuffer=r.rebuffer+(t[2]-r.rebuffer)*i[2]*n,r.switch=r.switch+(t[3]-r.switch)*i[3]*n}function b(e,t,n,r,i,o,s){u||(u=d[d.length-1]);var a=e.findWeightVector(t,n,r,i,o,s);null!==a&&-1!==a&&(u=a)}return e={getNextQuality:function(e,i,h,f,y,x,E){var _=h,w=f,S=i,T=function(e){if(!n){n=[];var t=e.bitrateList,i=[];c=t[0].bandwidth,t.forEach((function(e){i.push(e.bandwidth),e.bandwidth<c&&(c=e.bandwidth)})),a=i.map((function(e){return Math.pow(e,2)})).reduce((function(e,t){return e+t})),r=Math.sqrt(a);for(var o=0;o<t.length;o++){var s={qualityIndex:o,bitrate:t[o].bandwidth,state:{throughput:t[o].bandwidth/r,latency:0,rebuffer:0,switch:0}};n.push(s)}d=function(e){var t=[],n=function(e){for(var t=[],n=0;n<e;n++){var r=[Math.random()*g(),Math.random(),Math.random(),Math.random()];t.push(r)}return t}(Math.pow(e.length,2));t.push(n[0]);for(var r=[1,1,1,1],i=1;i<e.length;i++){for(var o=null,s=null,a=0;a<n.length;a++){for(var l=n[a],c=null,u=0;u<t.length;u++){var d=m(l,t[u],r);(null===c||d<c)&&(c=d)}(null===s||c>s)&&(o=l,s=c)}t.push(o)}for(var p=null,h=null,f=0;f<t.length;f++){for(var v=0,y=0;y<t.length;y++)f!==y&&(v+=m(t[f],t[y],r));(null===p||v>p)&&(p=v,h=f)}var b=[];for(b.push(t[h]),t.splice(h,1);t.length>0;){for(var x=null,E=null,_=0;_<t.length;_++){var w=m(b[0],t[_],r);(null===x||w<x)&&(x=w,E=_)}b.push(t[E]),t.splice(E,1)}return b}(n)}var a;return n}(e),k=i/r;k>1&&(k=g()),h/=l,t.debug("getNextQuality called throughput:".concat(k," latency:").concat(h," bufferSize:").concat(f," currentQualityIndex:").concat(x," playbackRate:").concat(y));var C=T[x],A=C.bitrate*E.getSegmentDuration()/S,j=Math.max(0,A-w);if(w-A<E.getMinBuffer())return t.debug("Buffer is low for bitrate= ".concat(C.bitrate," downloadTime=").concat(A," currentBuffer=").concat(w," rebuffer=").concat(j)),function(e,t){var r=0,i=e;if(n)for(var o=0;o<n.length;o++){var s=n[o];s.bitrate<e.bitrate&&s.bitrate>r&&t>s.bitrate&&(r=s.bitrate,i=s)}return i}(C,S).qualityIndex;switch(p){case o:u=[.4,.4,.4,.4];break;case s:!function(e){u=function(e,t){for(var n=[],r=Math.sqrt(2/e),i=0;i<4;i++)n.push(Math.random()*r);return u=n}(e.length)}(T);break;case a:b(E,T,_,w,j,S,y);break;default:b(E,T,_,w,j,S,y)}for(var I=null,O=null,N=null,R=0;R<T.length;R++){var P=T[R],D=P.state,M=[D.throughput,D.latency,D.rebuffer,D.switch],L=u.slice(),B=E.getNextBufferWithBitrate(P.bitrate,w,S),F=B<E.getMinBuffer();F&&t.debug("Buffer is low for bitrate=".concat(P.bitrate," downloadTime=").concat(A," currentBuffer=").concat(w," nextBuffer=").concat(B)),(P.bitrate>i-1e4||F)&&P.bitrate!==c&&(L[0]=100);var U=m(M,[k,0,0,0],L);(null===I||U<I)&&(I=U,O=P.qualityIndex,N=P)}var H=Math.abs(C.bitrate-N.bitrate)/r;return v(C,T,[k,h,j,H]),v(N,T,[k,0,0,H]),O},reset:function(){f()}},t=(0,i.default)(h).getInstance().getLogger(e),f(),e}l.__dashjs_factory_name="LearningAbrController";const c=r.default.getClassFactory(l)},"./src/streaming/rules/abr/lolp/LoLpQoEEvaluator.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/rules/abr/lolp/QoeInfo.js");function o(){var e,t,n,r,o;function s(){t=null,n=null,r=null,o=null}function a(e,t,n,r){var o=new i.default;return o.type=e,o.weights.bitrateReward=t||1,o.weights.bitrateSwitchPenalty=1,o.weights.rebufferPenalty=n||1e3,o.weights.latencyPenalty=[],o.weights.latencyPenalty.push({threshold:1.1,penalty:.05*r}),o.weights.latencyPenalty.push({threshold:1e8,penalty:.1*n}),o.weights.playbackSpeedPenalty=r||200,o}function l(e,t,n,r,i){i.bitrateWSum+=i.weights.bitrateReward*e,i.lastBitrate&&(i.bitrateSwitchWSum+=i.weights.bitrateSwitchPenalty*Math.abs(e-i.lastBitrate)),i.lastBitrate=e,i.rebufferWSum+=i.weights.rebufferPenalty*t;for(var o=0;o<i.weights.latencyPenalty.length;o++){var s=i.weights.latencyPenalty[o];if(n<=s.threshold){i.latencyWSum+=s.penalty*n;break}}i.playbackSpeedWSum+=i.weights.playbackSpeedPenalty*Math.abs(1-r),i.totalQoe=i.bitrateWSum-i.bitrateSwitchWSum-i.rebufferWSum-i.latencyWSum-i.playbackSpeedWSum}return e={setupPerSegmentQoe:function(e,i,s){t=a("segment",e,i,s),n=e,r=i,o=s},logSegmentMetrics:function(e,n,r,i){t&&l(e,n,r,i,t)},getPerSegmentQoe:function(){return t},calculateSingleUseQoe:function(e,t,i,s){var c=null;return n&&r&&o&&(c=a("segment",n,r,o)),c?(l(e,t,i,s,c),c.totalQoe):0},reset:function(){s()}},s(),e}o.__dashjs_factory_name="LoLpQoeEvaluator";const s=r.default.getClassFactory(o)},"./src/streaming/rules/abr/lolp/LoLpRule.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});var r=n("./src/core/Debug.js"),i=n("./src/core/FactoryMaker.js"),o=n("./src/streaming/rules/abr/lolp/LearningAbrController.js"),s=n("./src/streaming/rules/abr/lolp/LoLpQoEEvaluator.js"),a=n("./src/streaming/rules/SwitchRequest.js"),l=n("./src/streaming/constants/MetricsConstants.js"),c=n("./src/streaming/rules/abr/lolp/LoLpWeightSelector.js"),u=n("./src/streaming/constants/Constants.js");function d(e){var t,n,i,d,p=(e=e||{}).dashMetrics,h=this.context;return n={getMaxIndex:function(e){try{var n=(0,a.default)(h).create(),r=e.getMediaInfo().type,o=e.getAbrController(),s=e.getStreamInfo(),f=o.getQualityFor(r,s.id),g=e.getMediaInfo(),m=p.getCurrentBufferState(r),v=e.getScheduleController(),y=p.getCurrentBufferLevel(r,!0),b=s&&s.manifestInfo?s.manifestInfo.isDynamic:null,x=v.getPlaybackController(),E=x.getCurrentLiveLatency();if(!e.useLoLPABR()||r===u.default.AUDIO)return n;E||(E=0);var _=x.getPlaybackRate(),w=o.getThroughputHistory().getSafeAverageThroughput(r,b);if(t.debug("Throughput ".concat(Math.round(w)," kbps")),isNaN(w)||!m)return n;if(o.getAbandonmentStateFor(s.id,r)===l.default.ABANDON_LOAD)return n;for(var S=g.bitrateList,T=e.getRepresentationInfo().fragmentDuration,k=S[0].bandwidth/1e3,C=S[S.length-1].bandwidth/1e3,A=0;A<S.length;A++){var j=S[A].bandwidth/1e3;j>C?C=j:j<k&&(k=j)}var I=S[f].bandwidth/1e3,O=p.getCurrentHttpRequest(r,!0),N=(O.tresponse.getTime()-O.trequest.getTime())/1e3,R=N>T?N-T:0;d.setupPerSegmentQoe(T,C,k),d.logSegmentMetrics(I,R,E,_);var P=(0,c.default)(h).create({targetLatency:1.5,bufferMin:.3,segmentDuration:T,qoeEvaluator:d});return n.quality=i.getNextQuality(g,1e3*w,E,y,_,f,P),n.reason={throughput:w,latency:E},n.priority=a.default.PRIORITY.STRONG,v.setTimeToLoadDelay(0),n.quality!==f&&console.log("[TgcLearningRule]["+r+"] requesting switch to index: ",n.quality,"Average throughput",Math.round(w),"kbps"),n}catch(e){throw e}},reset:function(){i.reset(),d.reset()}},t=(0,r.default)(h).getInstance().getLogger(n),i=(0,o.default)(h).create(),d=(0,s.default)(h).create(),n}d.__dashjs_factory_name="LoLPRule";const p=i.default.getClassFactory(d)},"./src/streaming/rules/abr/lolp/LoLpWeightSelector.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/core/FactoryMaker.js");function i(e){var t,n,r,i,o=e.targetLatency,s=e.bufferMin,a=e.segmentDuration,l=e.qoeEvaluator;function c(){return a}function u(e,t){var n=c();return t>n?e-n:e+n-t}return t={getMinBuffer:function(){return s},getSegmentDuration:c,getNextBufferWithBitrate:function(e,t,n){return u(t,e*a/n)},getNextBuffer:u,findWeightVector:function(e,t,i,c,d,p){var h=null,f=null,g=null,m=Math.abs(t-r);return e.forEach((function(e){n.forEach((function(n){n[0];var r=n[1],c=n[2],v=(n[3],e.bitrate*a/d),y=u(i,v),b=(0===c?10:1/c)*Math.max(1e-5,v-y),x=(0===r?10:1/r)*e.state.latency,E=l.calculateSingleUseQoe(e.bitrate,b,x,p);(null===h||E>h)&&function(e,t,n){return!(e>o+n)&&t>=s}(t,y,m)&&(h=E,f=n,g=e.bitrate)}))})),null===f&&null===g&&(f=-1),r=t,f}},n=function e(t,n,r){if(r===n)return t;for(var o=t.length,s=0;s<o;s++)for(var a=t.shift(),l=0;l<i.length;l++)t.push(a.concat(i[l]));return e(t,n,r+1)}((i=[.2,.4,.6,.8,1]).map((function(e){return[e]})),4,1),r=0,t}i.__dashjs_factory_name="LoLpWeightSelector";const o=r.default.getClassFactory(i)},"./src/streaming/rules/abr/lolp/QoeInfo.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=null,this.lastBitrate=null,this.weights={},this.weights.bitrateReward=null,this.weights.bitrateSwitchPenalty=null,this.weights.rebufferPenalty=null,this.weights.latencyPenalty=null,this.weights.playbackSpeedPenalty=null,this.bitrateWSum=0,this.bitrateSwitchWSum=0,this.rebufferWSum=0,this.latencyWSum=0,this.playbackSpeedWSum=0,this.totalQoe=0}},"./src/streaming/text/EmbeddedTextHtmlRender.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/core/FactoryMaker.js");function i(){var e=0;function t(e){for(var t="",n=0;n<e.length;++n)t+=e[n].uchar;return t.length-t.replace(/^\s+/,"").length}function n(e){return"left: "+3.125*e.x+"%; top: "+6.66*e.y1+"%; width: "+(100-3.125*e.x)+"%; height: "+6.66*Math.max(e.y2-1-e.y1,1)+"%; align-items: flex-start; overflow: visible; -webkit-writing-mode: horizontal-tb;"}function r(e){return"red"===e?"rgb(255, 0, 0)":"green"===e?"rgb(0, 255, 0)":"blue"===e?"rgb(0, 0, 255)":"cyan"===e?"rgb(0, 255, 255)":"magenta"===e?"rgb(255, 0, 255)":"yellow"===e?"rgb(255, 255, 0)":"white"===e?"rgb(255, 255, 255)":"black"===e?"rgb(0, 0, 0)":e}function i(e,t){var n=e.videoHeight/15;return t?"font-size: "+n+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; color: "+(t.foreground?r(t.foreground):"rgb(255, 255, 255)")+"; font-style: "+(t.italics?"italic":"normal")+"; text-decoration: "+(t.underline?"underline":"none")+"; white-space: pre; background-color: "+(t.background?r(t.background):"transparent")+";":"font-size: "+n+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; justify-content: flex-start; text-align: left; color: rgb(255, 255, 255); font-style: normal; white-space: pre; line-height: normal; font-weight: normal; text-decoration: none; width: 100%; display: flex;"}function o(e){return e.replace(/^\s+/g,"")}function s(e){return e.replace(/\s+$/g,"")}return{createHTMLCaptionsFromScreen:function(r,a,l,c){var u,d,p=null,h=!1,f=-1,g={start:a,end:l,spans:[]},m="style_cea608_white_black",v={},y={},b=[];for(u=0;u<15;++u){var x=c.rows[u],E="",_=null;if(!1===x.isEmpty()){var w=t(x.chars);null===p&&(p={x:w,y1:u,y2:u+1,p:[]}),w!==f&&h&&(p.p.push(g),g={start:a,end:l,spans:[]},p.y2=u,p.name="region_"+p.x+"_"+p.y1+"_"+p.y2,!1===v.hasOwnProperty(p.name)?(b.push(p),v[p.name]=p):v[p.name].p.contat(p.p),p={x:w,y1:u,y2:u+1,p:[]});for(var S=0;S<x.chars.length;++S){var T=x.chars[S],k=T.penState;if(null===_||!k.equals(_)){E.trim().length>0&&(g.spans.push({name:m,line:E,row:u}),E="");var C="style_cea608_"+k.foreground+"_"+k.background;k.underline&&(C+="_underline"),k.italics&&(C+="_italics"),y.hasOwnProperty(C)||(y[C]=JSON.parse(JSON.stringify(k))),_=k,m=C}E+=T.uchar}E.trim().length>0&&g.spans.push({name:m,line:E,row:u}),h=!0,f=w}else h=!1,f=-1,p&&(p.p.push(g),g={start:a,end:l,spans:[]},p.y2=u,p.name="region_"+p.x+"_"+p.y1+"_"+p.y2,!1===v.hasOwnProperty(p.name)?(b.push(p),v[p.name]=p):v[p.name].p.contat(p.p),p=null)}p&&(p.p.push(g),p.y2=u+1,p.name="region_"+p.x+"_"+p.y1+"_"+p.y2,!1===v.hasOwnProperty(p.name)?(b.push(p),v[p.name]=p):v[p.name].p.contat(p.p),p=null);var A=[];for(u=0;u<b.length;++u){var j=b[u],I="sub_cea608_"+e++,O=document.createElement("div");O.id=I;var N=n(j);O.style.cssText="position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;"+N;var R=document.createElement("div");R.className="paragraph bodyStyle",R.style.cssText=i(r);var P=document.createElement("div");P.className="cueUniWrapper",P.style.cssText="unicode-bidi: normal; direction: ltr;";for(var D=0;D<j.p.length;++D){var M=j.p[D],L=0;for(d=0;d<M.spans.length;++d){var B=M.spans[d];if(B.line.length>0){if(0!==d&&L!=B.row){var F=document.createElement("br");F.className="lineBreak",P.appendChild(F)}var U=!1;L===B.row&&(U=!0),L=B.row;var H=y[B.name],G=document.createElement("span");G.className="spanPadding "+B.name+" customSpanColor",G.style.cssText=i(r,H),0!==d&&U?d===M.spans.length-1?G.textContent=s(B.line):G.textContent=B.line:M.spans.length>1&&d<M.spans.length-1&&B.row===M.spans[d+1].row?G.textContent=o(B.line):G.textContent=B.line.trim(),P.appendChild(G)}}}R.appendChild(P),O.appendChild(R);var q={bodyStyle:["%",90]};for(var V in y)y.hasOwnProperty(V)&&(q[V]=["%",90]);A.push({type:"html",start:a,end:l,cueHTMLElement:O,cueID:I,cellResolution:[32,15],isFromCEA608:!0,fontSize:q,lineHeight:{},linePadding:{}})}return A}}}i.__dashjs_factory_name="EmbeddedTextHtmlRender";const o=r.default.getSingletonFactory(i)},"./src/streaming/text/NotFragmentedTextBufferController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});var r=n("./src/core/EventBus.js"),i=n("./src/core/events/Events.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/streaming/utils/InitCache.js"),a=n("./src/streaming/SourceBufferSink.js"),l=n("./src/streaming/vo/DashJSError.js"),c=n("./src/core/errors/Errors.js"),u="NotFragmentedTextBufferController";function d(e){e=e||{};var t,n,o,d,p,h,f=this.context,g=(0,r.default)(f).getInstance(),m=e.textController,v=e.errHandler,y=e.streamInfo,b=e.type;function x(e){d=e}function E(e){var t,r;n!==e&&(n=e)&&(t=i.default.BUFFERING_COMPLETED,r={},g.trigger(t,r,{streamId:y.id,mediaType:b}))}function _(e){e.chunk.bytes&&!n&&(h.save(e.chunk),p.append(e.chunk),E(!0))}return t={initialize:function(e){x(e)},getStreamId:function(){return y.id},getType:function(){return b},getBufferControllerType:function(){return u},createBufferSink:function(e){return new Promise((function(t,n){try{(p=(0,a.default)(f).create({mediaSource:d,textController:m,eventBus:g})).initializeForFirstUse(y,e),o||(p.getBuffer()&&"function"==typeof p.getBuffer().initialize&&p.getBuffer().initialize(),o=!0),t(p)}catch(e){v.error(new l.default(c.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,c.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+b)),n(e)}}))},dischargePreBuffer:function(){},getBuffer:function(){return p},getBufferLevel:function(){return 0},getRangeAt:function(){return null},pruneBuffer:function(){},hasBufferAtTime:function(){return!0},getAllRangesWithSafetyFactor:function(){return[]},getContinuousBufferTimeForTargetTime:function(){return Number.POSITIVE_INFINITY},setMediaSource:x,getMediaSource:function(){return d},appendInitSegmentFromCache:function(e){return null!==h.extract(y.id,e)},getIsBufferingCompleted:function(){return n},setIsBufferingCompleted:E,getIsPruningInProgress:function(){return!1},reset:function(e){g.off(i.default.INIT_FRAGMENT_LOADED,_,t),!e&&p&&(p.abort(),p.reset(),p=null)},clearBuffers:function(){return Promise.resolve()},prepareForPlaybackSeek:function(){return Promise.resolve()},prepareForReplacementTrackSwitch:function(){return n=!1,Promise.resolve()},setSeekTarget:function(){},updateAppendWindow:function(){return Promise.resolve()},pruneAllSafely:function(){return Promise.resolve()},updateBufferTimestampOffset:function(){return Promise.resolve()},segmentRequestingCompleted:function(){}},o=!1,d=null,n=!1,h=(0,s.default)(f).getInstance(),g.on(i.default.INIT_FRAGMENT_LOADED,_,t),t}d.__dashjs_factory_name=u;const p=o.default.getClassFactory(d)},"./src/streaming/text/TextController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>g});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/core/FactoryMaker.js"),o=n("./src/streaming/text/TextSourceBuffer.js"),s=n("./src/streaming/text/TextTracks.js"),a=n("./src/streaming/utils/VTTParser.js"),l=n("./src/streaming/utils/VttCustomRenderingParser.js"),c=n("./src/streaming/utils/TTMLParser.js"),u=n("./src/core/EventBus.js"),d=n("./src/core/events/Events.js"),p=n("./src/streaming/MediaPlayerEvents.js"),h=n("./src/streaming/utils/SupervisorTools.js");function f(e){var t,n,i,f,g,m,v,y,b,x,E,_,w=this.context,S=e.adapter,T=e.errHandler,k=e.manifestModel,C=e.mediaController,A=e.videoModel,j=e.settings;function I(e){var t=e.tracks,i=e.index,o=e.streamId;if(!1===j.get().streaming.text.defaultEnabled&&!R()||_)P(o,-1);else{var s=C.getCurrentTrackFor(r.default.TEXT,o);if(s){var a={lang:s.lang,role:s.roles[0],index:s.index,codec:s.codec,accessibility:s.accessibility[0]};t.some((function(e,t){if(C.matchSettings(a,e))return P(o,t),i=t,!0}))}b=!1}n[o].lastEnabledIndex=i,y.trigger(p.default.TEXT_TRACKS_ADDED,{enabled:R(),index:i,tracks:t,streamId:o}),E=!0}function O(e){try{var t=e.streamId;if(!f[t]||isNaN(e.time))return;f[t].manualCueProcessing(e.time)}catch(e){}}function N(e){try{var t=e.streamId;if(!f[t])return;f[t].disableManualTracks()}catch(e){}}function R(){var e=!0;return b&&!x&&(e=!1),e}function P(e,t){(b=-1===t)&&C&&C.saveTextSettingsDisabled();var n=D(e);if(n!==t&&f[e]){f[e].disableManualTracks(),f[e].setModeForTrackIdx(n,r.default.TEXT_HIDDEN),f[e].setCurrentTrackIdx(t),f[e].setModeForTrackIdx(t,r.default.TEXT_SHOWING);var o=f[e].getCurrentTrackInfo();o&&o.isFragmented&&!o.isEmbedded?function(e,t,n){if(i[e])for(var o=i[e].getConfig().fragmentedTracks,s=0;s<o.length;s++){var a=o[s];if(t.lang===a.lang&&(a.id?t.id===a.id:t.index===a.index)){var l=C.getCurrentTrackFor(r.default.TEXT,e);(a.id?l.id!==a.id:l.index!==a.index)?(f[e].deleteCuesFromTrackIdx(n),i[e].setCurrentFragmentedTrackIdx(s)):-1===n&&y.trigger(d.default.SET_FRAGMENTED_TEXT_AFTER_DISABLED,{},{streamId:e,mediaType:r.default.TEXT})}}}(e,o,n):o&&!o.isFragmented&&function(e,t){y.trigger(d.default.SET_NON_FRAGMENTED_TEXT,{currentTrackInfo:t},{streamId:e,mediaType:r.default.TEXT})}(e,o),C.setTrack(o)}}function D(e){return f[e].getCurrentTrackIdx()}function M(){i={},f={},n={},b=!0,E=!1,_=!1}return t={deactivateStream:function(e){if(e){var t=e.id;i[t]&&i[t].resetMediaInfos(),f[t]&&f[t].deleteAllTextTracks()}},initialize:function(){y.on(d.default.TEXT_TRACKS_QUEUE_INITIALIZED,I,t),j.get().streaming.text.webvtt.customRenderingEnabled&&(y.on(d.default.PLAYBACK_TIME_UPDATED,O,t),y.on(d.default.PLAYBACK_SEEKING,N,t))},initializeForStream:function(e){var t=e.id,r=(0,s.default)(w).create({videoModel:A,settings:j,streamInfo:e});r.initialize(),f[t]=r;var a=(0,o.default)(w).create({errHandler:T,adapter:S,manifestModel:k,mediaController:C,videoModel:A,textTracks:r,vttParser:g,vttCustomRenderingParser:m,ttmlParser:v,streamInfo:e,settings:j});a.initialize(),i[t]=a,n[t]={},n[t].lastEnabledIndex=-1},createTracks:function(e){var t=e.id;f[t]&&f[t].createTracks()},getTextSourceBuffer:function(e){var t=e.id;if(i&&i[t])return i[t]},getAllTracksAreDisabled:function(){return b},addEmbeddedTrack:function(e,t){var n=e.id;i[n]&&i[n].addEmbeddedTrack(t)},enableText:function(e,t){(0,h.checkParameterType)(t,"boolean"),R()!==t&&(t&&P(e,n[e].lastEnabledIndex),t||(n[e].lastEnabledIndex=D(e),E?P(e,-1):_=!0))},isTextEnabled:R,setTextTrack:P,getCurrentTrackIdx:D,enableForcedTextStreaming:function(e){(0,h.checkParameterType)(e,"boolean"),x=e},addMediaInfosToBuffer:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=e.id;i[o]&&i[o].addMediaInfos(t,n,r)},reset:function(){M(),y.off(d.default.TEXT_TRACKS_QUEUE_INITIALIZED,I,t),j.get().streaming.text.webvtt.customRenderingEnabled&&(y.off(d.default.PLAYBACK_TIME_UPDATED,O,t),y.off(d.default.PLAYBACK_SEEKING,N,t)),Object.keys(i).forEach((function(e){i[e].resetEmbedded(),i[e].reset()}))}},x=!1,E=!1,_=!1,g=(0,a.default)(w).getInstance(),m=(0,l.default)(w).getInstance(),v=(0,c.default)(w).getInstance(),y=(0,u.default)(w).getInstance(),M(),t}f.__dashjs_factory_name="TextController";const g=i.default.getClassFactory(f)},"./src/streaming/text/TextSourceBuffer.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>b});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/streaming/vo/metrics/HTTPRequest.js"),o=n("./src/streaming/vo/TextTrackInfo.js"),s=n("./src/streaming/utils/BoxParser.js"),a=n("./src/streaming/utils/CustomTimeRanges.js"),l=n("./src/core/FactoryMaker.js"),c=n("./src/core/Debug.js"),u=n("./src/streaming/text/EmbeddedTextHtmlRender.js"),d=n("./node_modules/codem-isoboxer/dist/iso_boxer.js"),p=n("./externals/cea608-parser.js"),h=n.n(p),f=n("./src/core/EventBus.js"),g=n("./src/core/events/Events.js"),m=n("./src/streaming/vo/DashJSError.js"),v=n("./src/core/errors/Errors.js");function y(e){var t,n,l,p,y,b,x,E,_,w,S,T,k,C,A,j,I=e.errHandler,O=e.manifestModel,N=e.mediaController,R=e.videoModel,P=e.textTracks,D=e.vttParser,M=e.vttCustomRenderingParser,L=e.ttmlParser,B=e.streamInfo,F=e.settings,U=this.context,H=(0,f.default)(U).getInstance(),G=!1;function q(){b=null,E=NaN,_=[],w=null,x=!1,y=[],p=null}function V(e){var t=new o.default;for(var n in e)t[n]=e[n];t.labels=e.labels,t.defaultTrack=function(e){var t=!1;return T.length>1&&e.isEmbedded?t=e.id&&e.id===r.default.CC1:1===T.length?e.id&&"string"==typeof e.id&&"CC"===e.id.substring(0,2)&&(t=!0):0===T.length&&(t=e.index===y[0].index),t}(e),t.isFragmented=e.isFragmented,t.isEmbedded=!!e.isEmbedded,t.isTTML=function(e){return e.codec&&e.codec.search(r.default.STPP)>=0||e.mimeType&&e.mimeType.search(r.default.TTML)>=0}(e),t.kind=function(e,t){var n=e.roles&&e.roles.length>0?t[e.roles[0]]:t.caption;return n===t.caption||n===t.subtitle?n:t.caption}(e,{subtitle:"subtitles",caption:"captions"}),P.addTextTrack(t)}function z(e){var t=e.chunk;t.mediaInfo.embeddedCaptions&&K(t.bytes,t)}function W(e){S=e}function K(e,o){var s=o.mediaInfo,a=s.type,c=s.mimeType,u=s.codec||c;u?-1!==s.codec.indexOf("application/mp4")?function(e,i,o){var s;if("InitializationSegment"===i.segmentType)x=!0,E=l.getMediaTimescaleFromMoov(e);else{if(!x)return;(s=l.getSamplesInfo(e).sampleList).length>0&&(w=s[0].cts-i.start*E),o.search(r.default.STPP)>=0?function(e,i,o){var s,a;for(p=null!==p?p:X(o),s=0;s<i.length;s++){var l=i[s],c=l.cts,u=Y(),h=u+c/E,f=h+l.duration/E;t.buffered.add(h,f);var g=new DataView(e,l.offset,l.subSizes[0]),m=d.Utils.dataViewToString(g,r.default.UTF8),v=[],y=l.offset+l.subSizes[0];for(a=1;a<l.subSizes.length;a++){var x=new Uint8Array(e,y,l.subSizes[a]),_=String.fromCharCode.apply(null,x);v.push(_),y+=l.subSizes[a]}try{var w=O.getValue().ttmlTimeIsRelative?c/E:0,T=p.parse(m,w,c/E,(c+l.duration)/E,v);P.addCaptions(S,u,T)}catch(e){b.removeExecutedRequestsBeforeTime(),this.remove(),n.error("TTML parser error: "+e.message)}}}(e,s,o):function(e,r){var i,o,s,a=[];for(i=0;i<r.length;i++){var l=r[i];l.cts-=w;var c=Y()+l.cts/E,u=c+l.duration/E;t.buffered.add(c,u);var p=e.slice(l.offset,l.offset+l.size),h=d.parseBuffer(p);for(o=0;o<h.boxes.length;o++){var f=h.boxes[o];if(n.debug("VTT box1: "+f.type),"vtte"!==f.type&&"vttc"===f.type)for(n.debug("VTT vttc boxes.length = "+f.boxes.length),s=0;s<f.boxes.length;s++){var g=f.boxes[s];if(n.debug("VTT box2: "+g.type),"payl"===g.type){var m=g.cue_text;n.debug("VTT cue_text = "+m);var v=l.cts/E,y=(l.cts+l.duration)/E;a.push({start:v,end:y,data:m,styles:{}}),n.debug("VTT "+v+"-"+y+" : "+m)}}}}a.length>0&&P.addCaptions(S,0,a)}(e,s)}}(e,o,u):a===r.default.VIDEO?function(e,t){var r,o;if(t.segmentType===i.HTTPRequest.INIT_SEGMENT_TYPE)0===k&&(k=l.getMediaTimescaleFromMoov(e));else if(t.segmentType===i.HTTPRequest.MEDIA_SEGMENT_TYPE){if(0===k)return void n.warn("CEA-608: No timescale for embeddedTextTrack yet");var s=(o=l.getSamplesInfo(e)).lastSequenceNumber;if(A[0]||A[1]||function(){for(var e,t=0;t<T.length;t++){if(-1===(e=P.getTrackIdxForId(T[t].id)))return void n.warn("CEA-608: data before track is ready.");var r=$(e);A[t]=new(h().Cea608Parser)(t+1,{newCue:r},null)}}(),k){if(null!==C&&s!==C+o.numSequences)for(r=0;r<A.length;r++)A[r]&&A[r].reset();for(var a=function(e,t){if(0===t.length)return null;for(var n={splits:[],fields:[[],[]]},r=new DataView(e),i=0;i<t.length;i++)for(var o=t[i],s=h().findCea608Nalus(r,o.offset,o.size),a=null,l=0,c=0;c<s.length;c++)for(var u=h().extractCea608DataFromRange(r,s[c]),d=0;d<2;d++)if(u[d].length>0){o.cts!==a?l=0:l+=1;var p=Y();n.fields[d].push([o.cts+p*k,u[d],l]),a=o.cts}return n.fields.forEach((function(e){e.sort((function(e,t){return e[0]===t[0]?e[2]-t[2]:e[0]-t[0]}))})),n}(e,o.sampleList),c=0;c<A.length;c++){var u=a.fields[c],d=A[c];if(d)for(r=0;r<u.length;r++)d.addData(u[r][0]/k,u[r][1])}C=s}}}(e,o):function(e,n,i){var o,s,a=new DataView(e,0,e.byteLength);s=d.Utils.dataViewToString(a,r.default.UTF8);try{o=X(i).parse(s,0),P.addCaptions(P.getCurrentTrackIdx(),0,o),t.buffered&&t.buffered.add(n.start,n.end)}catch(e){I.error(new m.default(v.default.TIMED_TEXT_ERROR_ID_PARSE_CODE,v.default.TIMED_TEXT_ERROR_MESSAGE_PARSE+e.message,s))}}(e,o,u):n.error("No text type defined")}function $(e){return function(t,n,r){var i;(i=R.getTTMLRenderingDiv()?j.createHTMLCaptionsFromScreen(R.getElement(),t,n,r):[{start:t,end:n,data:r.getDisplayText(),styles:{}}])&&P.addCaptions(e,0,i)}}function Y(){return isNaN(t.timestampOffset)?0:t.timestampOffset}function X(e){var t;return e.search(r.default.VTT)>=0?t=F.get().streaming.text.webvtt.customRenderingEnabled&&M?M:D:(e.search(r.default.TTML)>=0||e.search(r.default.STPP)>=0)&&(t=L),t}function J(e){T.forEach((function(t){var n=P.getTrackIdxForId(t.id);n>=0&&P.deleteCuesFromTrackIdx(n,e.from,e.to)}))}return t={initialize:function(){G||(T=[],S=null,k=0,A=[],C=null,G=!0,j=(0,u.default)(U).getInstance(),H.on(g.default.VIDEO_CHUNK_RECEIVED,z,t),H.on(g.default.BUFFER_CLEARED,J,t))},addMediaInfos:function(e,n,i){if(y=y.concat(n),e===r.default.TEXT&&n[0].isFragmented&&!n[0].isEmbedded){b=i,t.buffered=(0,a.default)(U).create(),_=N.getTracksFor(r.default.TEXT,B.id).filter((function(e){return e.isFragmented}));for(var o=N.getCurrentTrackFor(r.default.TEXT,B.id),s=0;s<_.length;s++)if(_[s]===o){W(s);break}}for(var l=0;l<n.length;l++)V(n[l])},resetMediaInfos:function(){y=[]},getStreamId:function(){return B.id},append:K,abort:function(){},addEmbeddedTrack:function(e){if(G&&e)if(e.id===r.default.CC1||e.id===r.default.CC3){for(var t=0;t<T.length;t++)if(T[t].id===e.id)return;T.push(e)}else n.warn("Embedded track "+e.id+" not supported!")},resetEmbedded:function(){H.off(g.default.VIDEO_CHUNK_RECEIVED,z,t),H.off(g.default.BUFFER_CLEARED,J,t),P&&P.deleteAllTextTracks(),G=!1,T=[],A=[null,null],C=null},getConfig:function(){return{fragmentModel:b,fragmentedTracks:_,videoModel:R}},setCurrentFragmentedTrackIdx:W,remove:function(e,n){void 0===e&&e===n&&(e=t.buffered.start(0),n=t.buffered.end(t.buffered.length-1)),t.buffered.remove(e,n),P.deleteCuesFromTrackIdx(S,e,n)},reset:function(){q(),y=[],l=null}},n=(0,c.default)(U).getInstance().getLogger(t),l=(0,s.default)(U).getInstance(),q(),t}y.__dashjs_factory_name="TextSourceBuffer";const b=l.default.getClassFactory(y)},"./src/streaming/text/TextTracks.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>f});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/core/EventBus.js"),o=n("./src/core/events/Events.js"),s=n("./src/streaming/MediaPlayerEvents.js"),a=n("./src/core/FactoryMaker.js"),l=n("./src/core/Debug.js"),c=n("./node_modules/imsc/src/main/js/main.js");function u(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var p=["text","images","embeddedImages","align","fontSize","id","isd","line","lineAlign","lineHeight","linePadding","position","positionAlign","region","size","snapToLines","vertical"];function h(e){var t,n,a,d,h,f,g,m,v,y,b,x,E,_,w,S,T,k,C=this.context,A=(0,i.default)(C).getInstance(),j=e.videoModel,I=e.streamInfo,O=e.settings;function N(e,t){var n=j.getClientWidth(),r=j.getClientHeight(),i=j.getVideoWidth(),o=j.getVideoHeight(),a=j.getVideoRelativeOffsetTop(),l=j.getVideoRelativeOffsetLeft();if(0!==i&&0!==o){var c=i/o,u=!1;e.isFromCEA608&&(c=3.5/3,u=!0);var d=function(e,t,n,r,i,o){var s=0,a=0;e/t>n/r?s=(a=t)/r*n:a=(s=e)/n*r;var l,c,u=0,d=0;return s/a>i?(d=a,u=a*i):(u=s,d=s/i),l=(e-u)/2,c=(t-d)/2,o?{x:l+.1*u,y:c+.1*d,w:.8*u,h:.8*d}:{x:l,y:c,w:u,h:d}}.call(this,n,r,i,o,c,u),p=d.w,h=d.h,f=d.x,x=d.y;if(p!=v||h!=y||f!=g||x!=m||t){if(g=f+l,m=x+a,v=p,y=h,b){var E=b.style;E&&(E.left=g+"px",E.top=m+"px",E.width=v+"px",E.height=y+"px",E.zIndex=_&&document[_]||w?T:null,A.trigger(s.default.CAPTION_CONTAINER_RESIZE))}var S=e.activeCues;if(S)for(var k=S.length,C=0;C<k;++C){var I=S[C];I.scaleCue(I)}}}}function R(e){var t,n,r,i,o,s=v,a=y;if(e.cellResolution){var l=[s/e.cellResolution[0],a/e.cellResolution[1]];if(e.linePadding)for(t in e.linePadding)if(e.linePadding.hasOwnProperty(t)){n=(e.linePadding[t]*l[0]).toString();for(var c=document.getElementsByClassName("spanPadding"),u=0;u<c.length;u++)c[u].style.cssText=c[u].style.cssText.replace(/(padding-left\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n),c[u].style.cssText=c[u].style.cssText.replace(/(padding-right\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n)}if(e.fontSize){for(t in e.fontSize)if(e.fontSize.hasOwnProperty(t)){"%"===e.fontSize[t][0]?r=e.fontSize[t][1]/100:"c"===e.fontSize[t][0]&&(r=e.fontSize[t][1]),n=(r*l[1]).toString(),o="defaultFontSize"!==t?document.getElementsByClassName(t):document.getElementsByClassName("paragraph");for(var d=0;d<o.length;d++)o[d].style.cssText=o[d].style.cssText.replace(/(font-size\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n)}if(e.lineHeight)for(t in e.lineHeight)if(e.lineHeight.hasOwnProperty(t)){"%"===e.lineHeight[t][0]?i=e.lineHeight[t][1]/100:"c"===e.fontSize[t][0]&&(i=e.lineHeight[t][1]),n=(i*l[1]).toString(),o=document.getElementsByClassName(t);for(var p=0;p<o.length;p++)o[p].style.cssText=o[p].style.cssText.replace(/(line-height\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n)}}}if(e.isd){var h=document.getElementById(e.cueID);h&&b.removeChild(h),P(e)}}function P(e){if(b){var t=document.createElement("div");b.appendChild(t),S=(0,c.renderHTML)(e.isd,t,(function(t){var n=/^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/,r=/^#(.*)$/;if(n.test(t)){var i=n.exec(t),o=parseInt(i[4],10)-1;return"data:image/png;base64,"+btoa(e.images[o])}if(r.test(t)){var s=r.exec(t)[1];return"data:image/png;base64,"+e.embeddedImages[s]}return null}),b.clientHeight,b.clientWidth,!1,(function(e){n.info("renderCaption :",e)}),S,!0),t.id=e.cueID,A.trigger(s.default.CAPTION_RENDERED,{captionDiv:t,currentTrackIdx:f})}}function D(e,t){if(!O.get().streaming.text.extendSegmentedCues)return!1;if(!t.cues||0===t.cues.length)return!1;var n=t.cues[t.cues.length-1];return n.endTime===e.startTime&&!!function(e,t,n){for(var r=0;r<n.length;r++){var i=n[r];if(JSON.stringify(e[i])!==JSON.stringify(t[i]))return!1}return!0}(n,e,p)&&(n.endTime=e.endTime,!0)}function M(e,t,r){var i=U(e);if(i&&Array.isArray(r)&&0!==r.length)for(var o=0;o<r.length;o++){var s=void 0,a=r[o];i.cellResolution=a.cellResolution,i.isFromCEA608=a.isFromCEA608,isNaN(a.start)||isNaN(a.end)||(s="html"===a.type&&b?L(a,t,i):a.data?B(a,t,i):null);try{s?G(i,s)||(O.get().streaming.text.webvtt.customRenderingEnabled?(i.manualCueList||(i.manualCueList=[]),i.manualCueList.push(s)):D(s,i)||i.addCue(s)):n.error("Impossible to display subtitles. You might have missed setting a TTML rendering div via player.attachTTMLRenderingDiv(TTMLRenderingDiv)")}catch(e){throw V(i),i.addCue(s),e}}}function L(e,t,i){var o=this,l=new a(e.start+t,e.end+t,"");return l.cueHTMLElement=e.cueHTMLElement,l.isd=e.isd,l.images=e.images,l.embeddedImages=e.embeddedImages,l.cueID=e.cueID,l.scaleCue=R.bind(o),l.cellResolution=e.cellResolution,l.lineHeight=e.lineHeight,l.linePadding=e.linePadding,l.fontSize=e.fontSize,b.style.left=g+"px",b.style.top=m+"px",b.style.width=v+"px",b.style.height=y+"px",l.onenter=function(){i.mode===r.default.TEXT_SHOWING&&(this.isd?(P(this),n.debug("Cue enter id:"+this.cueID)):(b.appendChild(this.cueHTMLElement),R.call(o,this),A.trigger(s.default.CAPTION_RENDERED,{captionDiv:this.cueHTMLElement,currentTrackIdx:f})))},l.onexit=function(){if(b)for(var e=b.childNodes,t=0;t<e.length;++t)e[t].id===this.cueID&&(n.debug("Cue exit id:"+e[t].id),b.removeChild(e[t]),--t)},l}function B(e,t,i){var o=new a(e.start-t,e.end-t,e.data);if(o.cueID="".concat(o.startTime,"_").concat(o.endTime),o.isActive=!1,e.styles)try{void 0!==e.styles.align&&"align"in o&&(o.align=e.styles.align),void 0!==e.styles.line&&"line"in o&&(o.line=e.styles.line),void 0!==e.styles.position&&"position"in o&&(o.position=e.styles.position),void 0!==e.styles.size&&"size"in o&&(o.size=e.styles.size)}catch(e){n.error(e)}return o.onenter=function(){i.mode===r.default.TEXT_SHOWING&&A.trigger(s.default.CAPTION_RENDERED,{currentTrackIdx:f})},o}function F(){var e,t=[],n=u(j.getTextTracks());try{for(n.s();!(e=n.n()).done;){var i=e.value;i.manualMode===r.default.TEXT_SHOWING&&t.push(i)}}catch(e){n.e(e)}finally{n.f()}return t}function U(e){return e>=0&&d[e]?j.getTextTrack(d[e].kind,d[e].id,d[e].lang,d[e].isTTML,d[e].isEmbedded):null}function H(e){var t=this;if(e!==f){var r=U(f=e);(function(e){W.call(this),e&&"html"===e.renderingType?function(){var e=document.getElementById("native-cue-style");if(!e){(e=document.createElement("style")).id="native-cue-style",document.head.appendChild(e);var t=e.sheet,r=j.getElement();try{r&&(r.id?t.insertRule("#"+r.id+"::cue {background: transparent}",0):0!==r.classList.length?t.insertRule("."+r.className+"::cue {background: transparent}",0):t.insertRule("video::cue {background: transparent}",0))}catch(e){n.info(""+e.message)}}}.call(this):z.call(this)}).call(this,r),E&&(clearInterval(E),E=null),r&&"html"===r.renderingType&&(N.call(this,r,!0),window.ResizeObserver?(k=new window.ResizeObserver((function(){N.call(t,r,!0)}))).observe(j.getElement()):E=setInterval(N.bind(this,r),500))}}function G(e,t){if(!e.cues)return!1;for(var n=0;n<e.cues.length;n++)if(e.cues[n].startTime===t.startTime&&e.cues[n].endTime===t.endTime)return!0;return!1}function q(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return(isNaN(t)||(r?e.startTime:e.endTime)>=t)&&(isNaN(n)||(r?e.endTime:e.startTime)<=n)}function V(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e.cues)for(var i=e.cues,o=i.length-1;o>=0;o--)q(i[o],t,n,r)&&(i[o].onexit&&i[o].onexit(),e.removeCue(i[o]))}function z(){var e=document.getElementById("native-cue-style");e&&document.head.removeChild(e)}function W(){if(b)for(;b.firstChild;)b.removeChild(b.firstChild)}return t={initialize:function(){"undefined"!=typeof window&&"undefined"!=typeof navigator&&(a=window.VTTCue||window.TextTrackCue,d=[],h=[],f=-1,g=0,m=0,v=0,y=0,b=null,x=null,E=null,w=!1,T=2147483647,S=null,void 0!==document.fullscreenElement?_="fullscreenElement":void 0!==document.webkitIsFullScreen?_="webkitIsFullScreen":document.msFullscreenElement?_="msFullscreenElement":document.mozFullScreen&&(_="mozFullScreen"))},getStreamId:function(){return I.id},addTextTrack:function(e){d.push(e)},addCaptions:M,createTracks:function(){d.sort((function(e,t){return e.index-t.index})),b=j.getTTMLRenderingDiv(),x=j.getVttRenderingDiv();for(var e,t,n,i,a,l,c=-1,u=0;u<d.length;u++){var p=(t=(e=d[u]).kind,n=void 0!==e.id?e.id:e.lang,i=e.lang,a=e.isTTML,l=e.isEmbedded,j.addTextTrack(t,n,i,a,l));h.push(p),d[u].defaultTrack&&(p.default=!0,c=u);var g=U(u);g&&(g.mode=r.default.TEXT_SHOWING,b&&(d[u].isTTML||d[u].isEmbedded)?g.renderingType="html":g.renderingType="default"),M(u,0,d[u].captionData),A.trigger(s.default.TEXT_TRACK_ADDED)}if(H.call(this,c),c>=0){A.on(s.default.PLAYBACK_METADATA_LOADED,(function e(){var t=U(c);t&&"html"===t.renderingType&&N.call(this,t,!0),A.off(s.default.PLAYBACK_METADATA_LOADED,e,this)}),this);for(var m=0;m<d.length;m++){var v=U(m);v&&(v.mode=m===c?r.default.TEXT_SHOWING:r.default.TEXT_HIDDEN,v.manualMode=m===c?r.default.TEXT_SHOWING:r.default.TEXT_HIDDEN)}}A.trigger(o.default.TEXT_TRACKS_QUEUE_INITIALIZED,{index:f,tracks:d,streamId:I.id})},getCurrentTrackIdx:function(){return f},setCurrentTrackIdx:H,getTrackIdxForId:function(e){for(var t=-1,n=0;n<d.length;n++)if(d[n].id===e){t=n;break}return t},getCurrentTrackInfo:function(){return d[f]},setModeForTrackIdx:function(e,t){var n=U(e);n&&n.mode!==t&&(n.mode=t),n&&n.manualMode!==t&&(n.manualMode=t)},deleteCuesFromTrackIdx:function(e,t,n){var r=U(e);r&&V(r,t,n)},deleteAllTextTracks:function(){for(var e=h?h.length:0,t=0;t<e;t++){var n=U(t);n&&V.call(this,n,I.start,I.start+I.duration,!1)}h=[],d=[],E&&(clearInterval(E),E=null),k&&j&&(k.unobserve(j.getElement()),k=null),f=-1,W.call(this)},deleteTextTrack:function(e){j.removeChild(h[e]),h.splice(e,1)},manualCueProcessing:function(e){var t=F();if(t&&t.length>0){var n=t[0].manualCueList;n&&n.length>0&&n.forEach((function(t){if(t.startTime<=e&&t.endTime>=e&&!t.isActive)t.isActive=!0,WebVTT.processCues(window,[t],x,t.cueID);else if(t.isActive&&(t.startTime>e||t.endTime<e)&&(t.isActive=!1,x))for(var n=x.childNodes,r=0;r<n.length;++r)n[r].id===t.cueID&&(x.removeChild(n[r]),--r)}))}},disableManualTracks:function(){var e=F();if(e&&e.length>0){var t=e[0].manualCueList;t&&t.length>0&&t.forEach((function(e){if(e.isActive&&(e.isActive=!1,x))for(var t=x.childNodes,n=0;n<t.length;++n)t[n].id===e.cueID&&(x.removeChild(t[n]),--n)}))}}},n=(0,l.default)(C).getInstance().getLogger(t),t}h.__dashjs_factory_name="TextTracks";const f=a.default.getClassFactory(h)},"./src/streaming/thumbnail/ThumbnailController.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var r=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/constants/Constants.js"),o=n("./src/streaming/vo/Thumbnail.js"),s=n("./src/streaming/thumbnail/ThumbnailTracks.js"),a=n("./src/streaming/vo/BitrateInfo.js"),l=n("./src/dash/utils/SegmentsUtils.js");function c(e){var t,n,r=this.context,c=e.streamInfo;function u(e){n.setTrackByIndex(e)}function d(){n&&n.reset()}return t={getStreamId:function(){return c.id},initialize:function(){n.addTracks();var e=n.getTracks();e&&e.length>0&&u(0)},provide:function(e,t){if("function"==typeof t){var r,i,s=n.getCurrentTrack();if(!s||s.segmentDuration<=0||null==e)t(null);else{(i=n.getThumbnailRequestForTime(e))&&(s.segmentDuration=i.duration),r=e%s.segmentDuration;var a=Math.floor(r*s.tilesHor*s.tilesVert/s.segmentDuration),c=new o.default;if(c.width=Math.floor(s.widthPerTile),c.height=Math.floor(s.heightPerTile),c.x=Math.floor(a%s.tilesHor)*s.widthPerTile,c.y=Math.floor(a/s.tilesHor)*s.heightPerTile,"readThumbnail"in s)return s.readThumbnail(e,(function(e){c.url=e,t(c)}));if(i)c.url=i.url,s.segmentDuration=NaN;else{var u=Math.floor(e/s.segmentDuration);c.url=function(e,t){var n=t+e.startNumber,r=(0,l.replaceTokenForTemplate)(e.templateUrl,"Number",n);return r=(0,l.replaceTokenForTemplate)(r,"Time",(n-1)*e.segmentDuration*e.timescale),r=(0,l.replaceTokenForTemplate)(r,"Bandwidth",e.bandwidth),(0,l.unescapeDollarsInTemplate)(r)}(s,u)}t(c)}}},setTrackByIndex:u,getCurrentTrackIndex:function(){return n.getCurrentTrackIndex()},getBitrateList:function(){var e=n.getTracks(),t=0;return e.map((function(e){var n=new a.default;return n.mediaType=i.default.IMAGE,n.qualityIndex=t++,n.bitrate=e.bitrate,n.width=e.width,n.height=e.height,n}))},reset:d},d(),n=(0,s.default)(r).create({streamInfo:c,adapter:e.adapter,baseURLController:e.baseURLController,timelineConverter:e.timelineConverter,debug:e.debug,eventBus:e.eventBus,events:e.events,dashConstants:e.dashConstants,dashMetrics:e.dashMetrics,segmentBaseController:e.segmentBaseController}),t}c.__dashjs_factory_name="ThumbnailController";const u=r.default.getClassFactory(c)},"./src/streaming/thumbnail/ThumbnailTracks.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{THUMBNAILS_SCHEME_ID_URIS:()=>h,default:()=>g});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/dash/constants/DashConstants.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/streaming/vo/ThumbnailTrackInfo.js"),a=n("./src/streaming/utils/URLUtils.js"),l=n("./src/dash/utils/SegmentsUtils.js"),c=n("./src/streaming/utils/BoxParser.js"),u=n("./src/streaming/net/XHRLoader.js"),d=n("./src/dash/DashHandler.js"),p=n("./src/dash/controllers/SegmentsController.js"),h=["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"];function f(e){var t,n,o,f,g,m,v,y,b=this.context,x=e.adapter,E=e.baseURLController,_=e.streamInfo,w=e.timelineConverter,S=e.debug,T=e.eventBus,k=e.events,C=e.dashConstants,A=(0,a.default)(b).getInstance();function j(e,t){var r=new s.default;r.id=e.id,r.bitrate=e.bandwidth,r.width=e.width,r.height=e.height,r.tilesHor=1,r.tilesVert=1,e.essentialProperties&&e.essentialProperties.forEach((function(e){if(h.indexOf(e.schemeIdUri)>=0&&e.value){var t=e.value.split("x");2!==t.length||isNaN(t[0])||isNaN(t[1])||(r.tilesHor=parseInt(t[0],10),r.tilesVert=parseInt(t[1],10))}})),t?m.updateSegmentData(e).then((function(t){!function(e,t,n){var r=[],i=function(e,t){var n,r,i,o,s=[],a=0;for(n=0,r=e.segments.length;n<r;n++)i=e.segments[n],(o=(0,l.getTimeBasedSegment)(w,x.getIsDynamic(),t,i.startTime,i.duration,i.timescale,i.media,i.mediaRange,a))&&(s.push(o),o=null,a++);return s}(n,t);t.segments=i,e.segmentDuration=t.segments[0].duration,e.readThumbnail=function(e,n){var i=null;r.some((function(t){if(t.start<=e&&t.end>e)return i=t.url,!0})),i?n(i):t.segments.some((function(i){if(i.mediaStartTime<=e&&i.mediaStartTime+i.duration>e){var o=E.resolve(t.path);return v.load({method:"get",url:o.url,request:{range:i.mediaRange,responseType:"arraybuffer"},onload:function(e){var t=y.getSamplesInfo(e.target.response),o=new Blob([e.target.response.slice(t.sampleList[0].offset,t.sampleList[0].offset+t.sampleList[0].size)],{type:"image/jpeg"}),s=window.URL.createObjectURL(o);r.push({start:i.mediaStartTime,end:i.mediaStartTime+i.duration,url:s}),n&&n(s)}}),!0}}))}}(r,e,t)})):(r.startNumber=e.startNumber,r.segmentDuration=e.segmentDuration,r.timescale=e.timescale,r.templateUrl=function(e){var t=A.isRelative(e.media)?A.resolve(e.media,E.resolve(e.path).url):e.media;return t?(0,l.replaceIDForTemplate)(t,e.id):""}(e)),r.tilesHor>0&&r.tilesVert>0&&(r.widthPerTile=r.width/r.tilesHor,r.heightPerTile=r.height/r.tilesVert,n.push(r))}function I(){n=[],f=-1,g=null}return t={getTracks:function(){return n},addTracks:function(){if(_&&x&&(g=x.getMediaInfoForType(_,r.default.IMAGE))){var e=x.getVoRepresentations(g);e&&e.length>0&&e.forEach((function(e){(e.segmentInfoType===i.default.SEGMENT_TEMPLATE&&e.segmentDuration>0&&e.media||e.segmentInfoType===i.default.SEGMENT_TIMELINE)&&j(e),e.segmentInfoType===i.default.SEGMENT_BASE&&j(e,!0)})),n.length>0&&n.sort((function(e,t){return e.bitrate-t.bitrate}))}},reset:I,setTrackByIndex:function(e){n&&0!==n.length&&(e>=n.length&&(e=n.length-1),f=e)},getCurrentTrack:function(){return f<0?null:n[f]},getCurrentTrackIndex:function(){return f},getThumbnailRequestForTime:function(e){for(var t,r=x.getVoRepresentations(g),i=0;i<r.length;i++)if(n[f].id===r[i].id){t=r[i];break}return o.getSegmentRequestForTime(g,t,e)}},I(),v=(0,u.default)(b).create({}),y=(0,c.default)(b).getInstance(),m=(0,p.default)(b).create({events:k,eventBus:T,streamInfo:_,timelineConverter:w,dashConstants:C,dashMetrics:e.dashMetrics,segmentBaseController:e.segmentBaseController,type:r.default.IMAGE}),(o=(0,d.default)(b).create({streamInfo:_,type:r.default.IMAGE,timelineConverter:w,segmentsController:m,baseURLController:E,debug:S,eventBus:T,events:k,dashConstants:C,urlUtils:A})).initialize(!!x&&x.getIsDynamic()),t}f.__dashjs_factory_name="ThumbnailTracks";const g=o.default.getClassFactory(f)},"./src/streaming/utils/BaseURLSelector.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>g});var r=n("./src/core/errors/Errors.js"),i=n("./src/core/EventBus.js"),o=n("./src/core/events/Events.js"),s=n("./src/streaming/controllers/BlacklistController.js"),a=n("./src/streaming/utils/baseUrlResolution/DVBSelector.js"),l=n("./src/streaming/utils/baseUrlResolution/BasicSelector.js"),c=n("./src/core/FactoryMaker.js"),u=n("./src/streaming/vo/DashJSError.js"),d=n("./src/streaming/utils/SupervisorTools.js"),p=n("./src/streaming/utils/baseUrlResolution/ContentSteeringSelector.js"),h=n("./src/core/Settings.js");function f(){var e,t,n,c,f,g,m=this.context,v=(0,i.default)(m).getInstance(),y=(0,h.default)(m).getInstance();function b(){t.reset()}return e={chooseSelector:function(e){(0,d.checkParameterType)(e,"boolean"),g=e?c:n},select:function(e){if(e){if(y.get().streaming.applyContentSteering){var t=f.selectBaseUrlIndex(e);isNaN(t)||-1===t||(e.selectedIdx=t)}if(!isNaN(e.selectedIdx))return e.baseUrls[e.selectedIdx];var i=g.select(e.baseUrls);return i?(e.selectedIdx=e.baseUrls.indexOf(i),i):(v.trigger(o.default.URL_RESOLUTION_FAILED,{error:new u.default(r.default.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE,r.default.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE)}),void(g===n&&b()))}},reset:b,setConfig:function(e){e.selector&&(g=e.selector),e.contentSteeringSelector&&(f=e.contentSteeringSelector)}},t=(0,s.default)(m).create({updateEventName:o.default.SERVICE_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:o.default.SERVICE_LOCATION_BLACKLIST_ADD}),n=(0,l.default)(m).create({blacklistController:t}),c=(0,a.default)(m).create({blacklistController:t}),(f=(0,p.default)(m).create()).setConfig({blacklistController:t}),g=n,e}f.__dashjs_factory_name="BaseURLSelector";const g=c.default.getClassFactory(f)},"./src/streaming/utils/BoxParser.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var r=n("./src/core/Debug.js"),i=n("./src/streaming/utils/IsoFile.js"),o=n("./src/core/FactoryMaker.js"),s=n("./node_modules/codem-isoboxer/dist/iso_boxer.js"),a=n("./src/streaming/vo/IsoBoxSearchInfo.js");function l(){var e,t,n=this.context;function o(e){if(!e)return null;void 0===e.fileStart&&(e.fileStart=0);var t=s.parseBuffer(e),r=(0,i.default)(n).create();return r.setData(t),r}function l(e,t){return e[t+3]>>>0|e[t+2]<<8>>>0|e[t+1]<<16>>>0|e[t]<<24>>>0}function c(e,t){return String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t])}return t={parse:o,findLastTopIsoBoxCompleted:function(e,t,n){if(void 0===n&&(n=0),!t||n+8>=t.byteLength)return new a.default(0,!1);for(var r,i=t instanceof ArrayBuffer?new Uint8Array(t):t,o=0;n<i.byteLength;){var s=l(i,n),u=c(i,n+4);if(0===s)break;n+s<=i.byteLength&&(e.indexOf(u)>=0?r=new a.default(n,!0,s):o=n+s),n+=s}return r||new a.default(o,!1)},getMediaTimescaleFromMoov:function(e){var t=o(e),n=t?t.getBox("mdhd"):void 0;return n?n.timescale:NaN},getSamplesInfo:function(e){if(!e||0===e.byteLength)return{sampleList:[],lastSequenceNumber:NaN,totalDuration:NaN,numSequences:NaN};var t,n,r,i,s,a,l,c,u,d,p,h,f,g,m,v,y=o(e),b=y.getBoxes("moof"),x=y.getBoxes("mfhd");m=y.getBoxes("moof").length,g=x[x.length-1].sequence_number,n=0,s=[];var E=-1,_=-1;for(d=0;d<b.length;d++){var w=b[d],S=w.getChildBoxes("traf");for(c=0;c<S.length;c++){var T=S[c],k=T.getChildBox("tfhd"),C=T.getChildBox("tfdt");i=C.baseMediaDecodeTime;var A=T.getChildBoxes("trun"),j=T.getChildBoxes("subs");for(u=0;u<A.length;u++){var I=A[u];for(n=I.sample_count,f=(k.base_data_offset||0)+(I.data_offset||0),l=0;l<n;l++){t=void 0!==(a=I.samples[l]).sample_duration?a.sample_duration:k.default_sample_duration,r=void 0!==a.sample_size?a.sample_size:k.default_sample_size;var O={dts:i,cts:i+(void 0!==a.sample_composition_time_offset?a.sample_composition_time_offset:0),duration:t,offset:w.offset+f,size:r,subSizes:[r]};if(j)for(p=0;p<j.length;p++){var N=j[p];if(E<N.entry_count-1&&l>_&&(E++,_+=N.entries[E].sample_delta),l==_){O.subSizes=[];var R=N.entries[E];for(h=0;h<R.subsample_count;h++)O.subSizes.push(R.subsamples[h].subsample_size)}}s.push(O),f+=r,i+=t}}v=i-C.baseMediaDecodeTime}}return{sampleList:s,lastSequenceNumber:g,totalDuration:v,numSequences:m}},findInitRange:function(t){var n=null,r=o(t);if(!r)return n;var i=r.getBox("ftyp"),s=r.getBox("moov");return e.debug("Searching for initialization."),s&&s.isComplete&&(n=(i?i.offset:s.offset)+"-"+(s.offset+s.size-1),e.debug("Found the initialization.  Range: "+n)),n},parsePayload:function(e,t,n){if(void 0===n&&(n=0),!t||n+8>=t.byteLength)return new a.default(0,!1);for(var r,i=t instanceof ArrayBuffer?new Uint8Array(t):t,o=0;n<i.byteLength;){var s=l(i,n),u=c(i,n+4);if(0===s)break;n+s<=i.byteLength&&(e.indexOf(u)>=0?r=new a.default(n,!0,s,u):o=n+s),n+=s}return r||new a.default(o,!1)}},e=(0,r.default)(n).getInstance().getLogger(t),t}l.__dashjs_factory_name="BoxParser";const c=o.default.getSingletonFactory(l)},"./src/streaming/utils/Capabilities.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c,supportsMediaSource:()=>a});var r=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/thumbnail/ThumbnailTracks.js"),o=n("./src/streaming/constants/Constants.js"),s=[{codec:"avc1",compatibleCodecs:["avc3"]},{codec:"avc3",compatibleCodecs:["avc1"]}];function a(){var e="WebKitMediaSource"in window,t="MediaSource"in window;return e||t}function l(){var e,t,n;return e={setConfig:function(e){e&&e.settings&&(t=e.settings)},supportsMediaSource:a,supportsEncryptedMedia:function(){return n},supportsCodec:function(e,n){return n!==o.default.AUDIO&&n!==o.default.VIDEO?Promise.resolve(!0):function(e,n){return t.get().streaming.capabilities.useMediaCapabilitiesApi&&navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo&&(e.codec&&n===o.default.AUDIO||n===o.default.VIDEO&&e.codec&&e.width&&e.height&&e.bitrate&&e.framerate)}(e,n)?function(e,t){return new Promise((function(n){if(e&&e.codec){var r={type:"media-source"};r[t]={},r[t].contentType=e.codec,r[t].width=e.width,r[t].height=e.height,r[t].bitrate=parseInt(e.bitrate),r[t].framerate=parseFloat(e.framerate),navigator.mediaCapabilities.decodingInfo(r).then((function(e){n(e.supported)})).catch((function(){n(!1)}))}else n(!1)}))}(e,n):function(e){return new Promise((function(t){if(e&&e.codec){var n=e.codec;e.width&&e.height&&(n+=';width="'+e.width+'";height="'+e.height+'"'),"MediaSource"in window&&MediaSource.isTypeSupported(n)||"WebKitMediaSource"in window&&WebKitMediaSource.isTypeSupported(n)?t(!0):t(!1)}else t(!1)}))}(e)},setEncryptedMediaSupported:function(e){n=e},supportsEssentialProperty:function(e){try{return-1!==i.THUMBNAILS_SCHEME_ID_URIS.indexOf(e.schemeIdUri)}catch(e){return!0}},codecRootCompatibleWithCodec:function(e,t){for(var n,r=e.split(".")[0],i=0===t.indexOf(r),o=0;o<s.length;o++)if(s[o].codec===r){n=s[o];break}return n?i||n.compatibleCodecs.some((function(e){return 0===t.indexOf(e)})):i}},n=!1,e}l.__dashjs_factory_name="Capabilities";const c=r.default.getSingletonFactory(l)},"./src/streaming/utils/CapabilitiesFilter.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var r=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js"),o=n("./src/streaming/constants/Constants.js"),s=n("./src/core/EventBus.js"),a=n("./src/core/events/Events.js");function l(){var e,t,n,r,l,c,u=this.context,d=(0,s.default)(u).getInstance();function p(e,r){if(!r||!r.Period_asArray||0===r.Period_asArray.length)return Promise.resolve();var i=[];return r.Period_asArray.forEach((function(r){i.push(function(e,r){return new Promise((function(i){if(e&&e.AdaptationSet_asArray&&0!==e.AdaptationSet_asArray.length){var s=[];e.AdaptationSet_asArray.forEach((function(e){t.getIsTypeOf(e,r)&&s.push(function(e,r){return new Promise((function(i){if(e.Representation_asArray&&0!==e.Representation_asArray.length){var s=[],a=[];e.Representation_asArray.forEach((function(i,l){var c=t.getCodec(e,l,!1),u=function(e,t,n){switch(e){case o.default.VIDEO:return function(e,t){return{codec:t,width:e.width||null,height:e.height||null,framerate:e.frameRate||null,bitrate:e.bandwidth||null}}(t,n);case o.default.AUDIO:return function(e,t){var n=e.audioSamplingRate||null;return{codec:t,bitrate:e.bandwidth||null,samplerate:n}}(t,n);default:return null}}(r,i,c);a.push(u),s.push(n.supportsCodec(u,r))})),Promise.all(s).then((function(t){e.Representation_asArray=e.Representation_asArray.filter((function(e,n){return t[n]||c.debug("[Stream] Codec ".concat(a[n].codec," not supported ")),t[n]})),i()})).catch((function(){i()}))}else i()}))}(e,r))})),Promise.all(s).then((function(){e.AdaptationSet_asArray=e.AdaptationSet_asArray.filter((function(e){var t=e.Representation_asArray&&e.Representation_asArray.length>0;return t||(d.trigger(a.default.ADAPTATION_SET_REMOVED_NO_CAPABILITIES,{adaptationSet:e}),c.warn("AdaptationSet has been removed because of no supported Representation")),t})),i()})).catch((function(){i()}))}else i()}))}(r,e))})),Promise.all(i)}return e={setConfig:function(e){e&&(e.adapter&&(t=e.adapter),e.capabilities&&(n=e.capabilities),e.settings&&(r=e.settings),e.customParametersModel&&(l=e.customParametersModel))},filterUnsupportedFeatures:function(e){return new Promise((function(i){var s=[];s.push(p(o.default.VIDEO,e)),s.push(p(o.default.AUDIO,e)),Promise.all(s).then((function(){r.get().streaming.capabilities.filterUnsupportedEssentialProperties&&function(e){e&&e.Period_asArray&&0!==e.Period_asArray.length&&e.Period_asArray.forEach((function(e){e.AdaptationSet_asArray=e.AdaptationSet_asArray.filter((function(e){return!e.Representation_asArray||0===e.Representation_asArray.length||(e.Representation_asArray=e.Representation_asArray.filter((function(e){var r=t.getEssentialPropertiesForRepresentation(e);if(r&&r.length>0)for(var i=0;i<r.length;){if(!n.supportsEssentialProperty(r[i]))return c.debug("[Stream] EssentialProperty not supported: "+r[i].schemeIdUri),!1;i+=1}return!0})),e.Representation_asArray&&e.Representation_asArray.length>0)}))}))}(e),function(e){var t=l.getCustomCapabilitiesFilters();t&&0!==t.length&&e&&e.Period_asArray&&0!==e.Period_asArray.length&&e.Period_asArray.forEach((function(e){e.AdaptationSet_asArray=e.AdaptationSet_asArray.filter((function(e){return!e.Representation_asArray||0===e.Representation_asArray.length||(e.Representation_asArray=e.Representation_asArray.filter((function(e){return!t.some((function(t){return!t(e)}))})),e.Representation_asArray&&e.Representation_asArray.length>0)}))}))}(e),i()})).catch((function(){i()}))}))}},c=(0,i.default)(u).getInstance().getLogger(e),e}l.__dashjs_factory_name="CapabilitiesFilter";const c=r.default.getSingletonFactory(l)},"./src/streaming/utils/CustomTimeRanges.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/utils/SupervisorTools.js");function o(){return{customTimeRangeArray:[],length:0,add:function(e,t){var n=0;for(n=0;n<this.customTimeRangeArray.length&&e>this.customTimeRangeArray[n].start;n++);for(this.customTimeRangeArray.splice(n,0,{start:e,end:t}),n=0;n<this.customTimeRangeArray.length-1;n++)this.mergeRanges(n,n+1)&&n--;this.length=this.customTimeRangeArray.length},clear:function(){this.customTimeRangeArray=[],this.length=0},remove:function(e,t){for(var n=0;n<this.customTimeRangeArray.length;n++)if(e<=this.customTimeRangeArray[n].start&&t>=this.customTimeRangeArray[n].end)this.customTimeRangeArray.splice(n,1),n--;else{if(e>this.customTimeRangeArray[n].start&&t<this.customTimeRangeArray[n].end){this.customTimeRangeArray.splice(n+1,0,{start:t,end:this.customTimeRangeArray[n].end}),this.customTimeRangeArray[n].end=e;break}e>this.customTimeRangeArray[n].start&&e<this.customTimeRangeArray[n].end?this.customTimeRangeArray[n].end=e:t>this.customTimeRangeArray[n].start&&t<this.customTimeRangeArray[n].end&&(this.customTimeRangeArray[n].start=t)}this.length=this.customTimeRangeArray.length},mergeRanges:function(e,t){var n=this.customTimeRangeArray[e],r=this.customTimeRangeArray[t];return n.start<=r.start&&r.start<=n.end&&n.end<=r.end?(n.end=r.end,this.customTimeRangeArray.splice(t,1),!0):r.start<=n.start&&n.start<=r.end&&r.end<=n.end?(n.start=r.start,this.customTimeRangeArray.splice(t,1),!0):r.start<=n.start&&n.start<=r.end&&n.end<=r.end?(this.customTimeRangeArray.splice(e,1),!0):n.start<=r.start&&r.start<=n.end&&r.end<=n.end&&(this.customTimeRangeArray.splice(t,1),!0)},start:function(e){return(0,i.checkInteger)(e),e>=this.customTimeRangeArray.length||e<0?NaN:this.customTimeRangeArray[e].start},end:function(e){return(0,i.checkInteger)(e),e>=this.customTimeRangeArray.length||e<0?NaN:this.customTimeRangeArray[e].end}}}o.__dashjs_factory_name="CustomTimeRanges";const s=r.default.getClassFactory(o)},"./src/streaming/utils/DOMStorage.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>h});var r=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js"),o=n("./src/streaming/constants/Constants.js"),s=[{oldKey:"dashjs_vbitrate",newKey:"dashjs_video_bitrate"},{oldKey:"dashjs_abitrate",newKey:"dashjs_audio_bitrate"},{oldKey:"dashjs_vsettings",newKey:"dashjs_video_settings"},{oldKey:"dashjs_asettings",newKey:"dashjs_audio_settings"}],a="dashjs_?_bitrate",l="dashjs_?_settings",c="localStorage",u="lastBitrate",d="lastMediaSettings";function p(e){e=e||{};var t,n,r,p=this.context,h=e.settings;function f(e){if(void 0!==r)return r;var t;r=!1;try{"undefined"!=typeof window&&(t=window[e])}catch(e){return n.warn("DOMStorage access denied: "+e.message),r}if(!t||e!==c&&"sessionStorage"!==e)return r;try{t.setItem("1","1"),t.removeItem("1"),r=!0}catch(e){n.warn("DOMStorage is supported, but cannot be used: "+e.message)}return r}function g(){return 6e5*Math.round((new Date).getTime()/6e5)}function m(e,t){return f(e)&&h.get().streaming[t+"CachingInfo"].enabled}function v(){if(!h)throw new Error(o.default.MISSING_CONFIG_ERROR)}return t={getSavedBitrateSettings:function(e){if(v(),!h.get().streaming.lastBitrateCachingInfo.enabled)return NaN;var t=NaN;if(m(c,u)){var r=a.replace(/\?/,e);try{var i=JSON.parse(localStorage.getItem(r))||{},o=(new Date).getTime()-parseInt(i.timestamp,10)>=h.get().streaming.lastBitrateCachingInfo.ttl||!1,s=parseFloat(i.bitrate);isNaN(s)||o?o&&localStorage.removeItem(r):(t=s,n.debug("Last saved bitrate for "+e+" was "+s))}catch(e){return null}}return t},setSavedBitrateSettings:function(e,t){if(m(c,u)&&t){var r=a.replace(/\?/,e);try{localStorage.setItem(r,JSON.stringify({bitrate:t.toFixed(3),timestamp:g()}))}catch(e){n.error(e.message)}}},getSavedMediaSettings:function(e){if(v(),!h.get().streaming.lastMediaSettingsCachingInfo.enabled)return null;var t=null;if(m(c,d)){var n=l.replace(/\?/,e);try{var r=JSON.parse(localStorage.getItem(n))||{},i=(new Date).getTime()-parseInt(r.timestamp,10)>=h.get().streaming.lastMediaSettingsCachingInfo.ttl||!1;t=r.settings,i&&(localStorage.removeItem(n),t=null)}catch(e){return null}}return t},setSavedMediaSettings:function(e,t){if(m(c,d)){var r=l.replace(/\?/,e);try{localStorage.setItem(r,JSON.stringify({settings:t,timestamp:g()}))}catch(e){n.error(e.message)}}}},n=(0,i.default)(p).getInstance().getLogger(t),f(c)&&s.forEach((function(e){var t=localStorage.getItem(e.oldKey);if(t){localStorage.removeItem(e.oldKey);try{localStorage.setItem(e.newKey,t)}catch(e){n.error(e.message)}}})),t}p.__dashjs_factory_name="DOMStorage";const h=r.default.getSingletonFactory(p)},"./src/streaming/utils/DefaultURLUtils.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/core/FactoryMaker.js");function i(){var e,t=/^[a-z][a-z0-9+\-_.]*:/i,n=/^https?:\/\//i,r=/^https:\/\//i,i=/^([a-z][a-z0-9+\-_.]*:\/\/[^\/]+)\/?/i,o=function(e,t){try{return new window.URL(e,t).toString()}catch(t){return e}},s=function(e,t){var n=a;if(!t)return e;if(!u(e))return e;d(e)&&(n=l),p(e)&&(n=c);var r=n(t),i="/"!==r.charAt(r.length-1)&&"/"!==e.charAt(0)?"/":"";return[r,e].join(i)};function a(e){var t=e.indexOf("/"),n=e.lastIndexOf("/");return-1!==t?n===t+1?e:(-1!==e.indexOf("?")&&(e=e.substring(0,e.indexOf("?"))),e.substring(0,n+1)):""}function l(e){var t=e.match(i);return t?t[1]:""}function c(e){var n=e.match(t);return n?n[0]:""}function u(e){return!t.test(e)}function d(e){return u(e)&&"/"===e.charAt(0)}function p(e){return 0===e.indexOf("//")}return function(){try{new window.URL("x","http://y"),e=o}catch(e){}finally{e=e||s}}(),{parseBaseUrl:a,parseOrigin:l,parseScheme:c,isRelative:u,isPathAbsolute:d,isSchemeRelative:p,isHTTPURL:function(e){return n.test(e)},isHTTPS:function(e){return r.test(e)},removeHostname:function(e){return/^(?:\w+\:\/\/)?([^\/]+)(.*)$/.exec(e)[2].substring(1)},resolve:function(t,n){return e(t,n)}}}i.__dashjs_factory_name="DefaultURLUtils";const o=r.default.getSingletonFactory(i)},"./src/streaming/utils/EBMLParser.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/core/FactoryMaker.js");function i(e){var t;e=e||{};var n=new DataView(e.data),r=0;function i(e,t){var i=!0,o=0;if(void 0===t&&(t=!1),e.tag>16777215?(n.getUint32(r)!==e.tag&&(i=!1),o=4):e.tag>65535?(256*n.getUint16(r)+n.getUint8(r+2)!==e.tag&&(i=!1),o=3):e.tag>255?(n.getUint16(r)!==e.tag&&(i=!1),o=2):(n.getUint8(r)!==e.tag&&(i=!1),o=1),!i&&e.required&&!t)throw new Error("required tag not found");return i&&(r+=o),i}function o(e){var t=1,i=128,o=-1,s=0,a=n.getUint8(r),l=0;for(l=0;l<8;l+=1){if((a&i)===i){s=void 0===e?a&~i:a,o=l;break}i>>=1}for(l=0;l<o;l+=1,t+=1)s=s<<8|255&n.getUint8(r+t);return r+=t,s}return t={getPos:function(){return r},setPos:function(e){r=e},consumeTag:i,consumeTagAndSize:function(e,t){var n=i(e,t);return n&&o(),n},parseTag:function(e){var n;return i(e),n=o(),t[e.parse](n)},skipOverElement:function(e,t){var n,s=i(e,t);return s&&(n=o(),r+=n),s},getMatroskaCodedNum:o,getMatroskaFloat:function(e){var t;switch(e){case 4:t=n.getFloat32(r),r+=4;break;case 8:t=n.getFloat64(r),r+=8}return t},getMatroskaUint:function(e){for(var t=0,i=0;i<e;i+=1)t<<=8,t|=255&n.getUint8(r+i);return r+=e,t},moreData:function(){return r<n.byteLength}}}i.__dashjs_factory_name="EBMLParser";const o=r.default.getClassFactory(i)},"./src/streaming/utils/ErrorHandler.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/core/EventBus.js"),i=n("./src/core/events/Events.js"),o=n("./src/core/FactoryMaker.js");function s(){var e=this.context,t=(0,r.default)(e).getInstance();return{error:function(e){t.trigger(i.default.ERROR,{error:e})}}}s.__dashjs_factory_name="ErrorHandler";const a=o.default.getSingletonFactory(s)},"./src/streaming/utils/InitCache.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/core/FactoryMaker.js");function i(){var e={};return{save:function(t){var n=t.streamId,r=t.representationId;e[n]=e[n]||{},e[n][r]=t},extract:function(t,n){return e&&e[t]&&e[t][n]?e[t][n]:null},reset:function(){e={}}}}i.__dashjs_factory_name="InitCache";const o=r.default.getSingletonFactory(i)},"./src/streaming/utils/IsoFile.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/streaming/vo/IsoBox.js"),i=n("./src/core/FactoryMaker.js");function o(){var e;function t(t){var r=[];if(!t||!e||"function"!=typeof e.fetchAll)return r;for(var i,o=e.fetchAll(t),s=0,a=o.length;s<a;s++)(i=n(o[s]))&&r.push(i);return r}function n(e){if(!e)return null;var t=new r.default(e);return e.hasOwnProperty("_incomplete")&&(t.isComplete=!e._incomplete),t}return{getBox:function(t){return t&&e&&e.boxes&&0!==e.boxes.length&&"function"==typeof e.fetch?n(e.fetch(t)):null},getBoxes:t,setData:function(t){e=t},getLastBox:function(){if(!e||!e.boxes||!e.boxes.length)return null;var n=t(e.boxes[e.boxes.length-1].type);return n.length>0?n[n.length-1]:null}}}o.__dashjs_factory_name="IsoFile";const s=i.default.getClassFactory(o)},"./src/streaming/utils/ObjectUtils.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/core/FactoryMaker.js"),i=n("./node_modules/fast-deep-equal/index.js"),o=n.n(i);function s(){return{areEqual:function(e,t){return o()(e,t)}}}s.__dashjs_factory_name="ObjectUtils";const a=r.default.getSingletonFactory(s)},"./src/streaming/utils/RequestModifier.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o,modifyRequest:()=>function(e,t){var n={url:e.url,method:e.method,headers:Object.assign({},e.headers),credentials:e.withCredentials?"include":void 0};return Promise.resolve(t.modifyRequest(n)).then((function(){return Object.assign(e,n,{withCredentials:"include"===n.credentials})}))}});var r=n("./src/core/FactoryMaker.js");function i(){return{modifyRequest:null,modifyRequestURL:function(e){return e},modifyRequestHeader:function(e,t){return t.url,e}}}i.__dashjs_factory_name="RequestModifier";const o=r.default.getSingletonFactory(i)},"./src/streaming/utils/SegmentResponseModifier.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/core/FactoryMaker.js");function i(){return{modifyResponseAsync:function(e){return Promise.resolve(e)}}}i.__dashjs_factory_name="SegmentResponseModifier";const o=r.default.getSingletonFactory(i)},"./src/streaming/utils/SupervisorTools.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{checkInteger:()=>function(e){if(null===e||isNaN(e)||e%1!=0)throw r.default.BAD_ARGUMENT_ERROR+" : argument is not an integer"},checkIsVideoOrAudioType:()=>function(e){if("string"!=typeof e||e!==r.default.AUDIO&&e!==r.default.VIDEO)throw r.default.BAD_ARGUMENT_ERROR},checkParameterType:()=>function(e,t){if(i(e)!==t)throw r.default.BAD_ARGUMENT_ERROR},checkRange:()=>function(e,t,n){if(e<t||e>n)throw r.default.BAD_ARGUMENT_ERROR+" : argument out of range"}});var r=n("./src/streaming/constants/Constants.js");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}},"./src/streaming/utils/TTMLParser.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var r=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js"),o=n("./src/core/EventBus.js"),s=n("./src/core/events/Events.js"),a=n("./node_modules/imsc/src/main/js/main.js"),l=n("./src/streaming/MediaPlayerEvents.js"),c=n("./src/streaming/constants/ConformanceViolationConstants.js");function u(){var e,t,n=this.context,r=(0,o.default)(n).getInstance(),u=0;return e={parse:function(e,n,i,o,d){var p,h,f,g="",m=[],v={},y={},b="",x="",E={onOpenTag:function(e,n,i){if(i[" imagetype"]&&!i[" imageType"]&&(r.trigger(l.default.CONFORMANCE_VIOLATION,{level:c.default.LEVELS.ERROR,event:c.default.EVENTS.NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE}),i[" imageType"]=i[" imagetype"]),"image"===n&&("http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt"===e||"http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt"===e)){if(!i[" imageType"]||"PNG"!==i[" imageType"].value)return void t.warn("smpte-tt imageType != PNG. Discarded");b=i["http://www.w3.org/XML/1998/namespace id"].value}},onCloseTag:function(){b&&(y[b]=x.trim()),x="",b=""},onText:function(e){b&&(x+=e)}};if(!e)throw g="no ttml data to parse",new Error(g);v.data=e,r.trigger(s.default.TTML_TO_PARSE,v);var _=(0,a.fromXML)(v.data,(function(e){g=e}),E);r.trigger(s.default.TTML_PARSED,{ttmlString:v.data,ttmlDoc:_});var w,S=_.getMediaTimeEvents();for(f=0;f<S.length;f++){var T=(0,a.generateISD)(_,S[f],(function(e){g=e}));T.contents.some((function(e){return e.contents.length}))&&(p=S[f]+n<i?i:S[f]+n)<(h=S[f+1]+n>o?o:S[f+1]+n)&&m.push({start:p,end:h,type:"html",cueID:(w="cue_TTML_"+u,u++,w),isd:T,images:d,embeddedImages:y})}if(""!==g)throw t.error(g),new Error(g);return m}},t=(0,i.default)(n).getInstance().getLogger(e),e}u.__dashjs_factory_name="TTMLParser";const d=r.default.getSingletonFactory(u)},"./src/streaming/utils/URLUtils.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/utils/DefaultURLUtils.js");function o(){var e,t=[],n=this.context;function r(n,r,i){var o=function(n){var r;for(r=0;r<t.length;r++)if(t[r].regex.test(n))return t[r].utils;return e}(i||r);return o&&"function"==typeof o[n]?o[n](r,i):e[n](r,i)}return e=(0,i.default)(n).getInstance(),{registerUrlRegex:function(e,n){t.push({regex:e,utils:n})},parseBaseUrl:function(e){return r("parseBaseUrl",e)},parseOrigin:function(e){return r("parseOrigin",e)},parseScheme:function(e){return r("parseScheme",e)},isRelative:function(e){return r("isRelative",e)},isPathAbsolute:function(e){return r("isPathAbsolute",e)},isSchemeRelative:function(e){return r("isSchemeRelative",e)},isHTTPURL:function(e){return r("isHTTPURL",e)},isHTTPS:function(e){return r("isHTTPS",e)},removeHostname:function(e){return r("removeHostname",e)},resolve:function(e,t){return r("resolve",e,t)}}}o.__dashjs_factory_name="URLUtils";const s=r.default.getSingletonFactory(o)},"./src/streaming/utils/VTTParser.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js");function o(){var e,t,n,r,o,s,a=this.context;function l(e){var t=e.split(":"),n=t.length-1;return e=60*parseInt(t[n-1],10)+parseFloat(t[n]),2===n&&(e+=3600*parseInt(t[0],10)),e}function c(e){var t=e.split(r),n=t[1].split(s);return n.shift(),t[1]=n[0],n.shift(),{cuePoints:t,styles:u(n)}}function u(e){var t={};return e.forEach((function(e){if(e.split(/:/).length>1){var n=e.split(/:/)[1];n&&-1!=n.search(/%/)&&(n=parseInt(n.replace(/%/,""),10)),(e.match(/align/)||e.match(/A/))&&(t.align=n),(e.match(/line/)||e.match(/L/))&&(t.line=n),(e.match(/position/)||e.match(/P/))&&(t.position=n),(e.match(/size/)||e.match(/S/))&&(t.size=n)}})),t}function d(e,t){for(var n,i=t,o="",s="";""!==e[i]&&i<e.length;)i++;if((n=i-t)>1)for(var a=0;a<n;a++){if((s=e[t+a]).match(r)){o="";break}o+=s,a!==n-1&&(o+="\n")}else(s=e[t]).match(r)||(o=s);return o}return e={parse:function(e){var i,s,a=[];if(!e)return a;i=(e=e.split(n)).length,s=-1;for(var u=0;u<i;u++){var p=e[u];if(p.length>0&&"WEBVTT"!==p&&p.match(r)){var h=c(p),f=h.cuePoints,g=h.styles,m=d(e,u+1),v=l(f[0].replace(o,"")),y=l(f[1].replace(o,""));!isNaN(v)&&!isNaN(y)&&v>=s&&y>v?""!==m?(s=v,a.push({start:v,end:y,data:m,styles:g})):t.error("Skipping cue due to empty/malformed cue text"):t.error("Skipping cue due to incorrect cue timing")}}return a}},t=(0,i.default)(a).getInstance().getLogger(e),n=/(?:\r\n|\r|\n)/gm,r=/-->/,o=/(^[\s]+|[\s]+$)/g,s=/\s\b/g,e}o.__dashjs_factory_name="VTTParser";const s=r.default.getSingletonFactory(o)},"./src/streaming/utils/VttCustomRenderingParser.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/core/FactoryMaker.js");function i(){var e,t;return e={parse:function(e){var n=[];return t.oncue=function(e){e.start=e.startTime,e.end=e.endTime,e.data=e.text,e.styles={align:e.align,line:e.line,position:e.position,size:e.size},n.push(e)},t.parse(e),n}},function(){try{window&&window.WebVTT&&window.WebVTT.Parser&&(t=new window.WebVTT.Parser(window,window.vttjs,window.WebVTT.StringDecoder()))}catch(e){}}(),e}i.__dashjs_factory_name="VttCustomRenderingParser";const o=r.default.getSingletonFactory(i)},"./src/streaming/utils/baseUrlResolution/BasicSelector.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/core/FactoryMaker.js");function i(e){var t=(e=e||{}).blacklistController;return{select:function(e){var n,r=0;return e&&e.some((function(e,n){return r=n,!t.contains(e.serviceLocation)}))&&(n=e[r]),n}}}i.__dashjs_factory_name="BasicSelector";const o=r.default.getClassFactory(i)},"./src/streaming/utils/baseUrlResolution/ContentSteeringSelector.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/core/FactoryMaker.js"),i=n("./src/dash/controllers/ContentSteeringController.js");function o(){var e,t,n,r=this.context;function o(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=0,i=NaN,o=function(){var o=e[r],s=t.findIndex((function(e){return e.serviceLocation&&e.serviceLocation===o}));if(-1!==s&&!n.contains(t[s].serviceLocation))return i=s,"break";r+=1};r<e.length&&"break"!==o(););return i}return e={selectBaseUrlIndex:function(e){var n=NaN;if(isNaN(e.selectedIdx)){var r=t.getSteeringDataFromManifest();r&&r.defaultServiceLocation&&(n=o([r.defaultServiceLocation],e.baseUrls))}var i=t.getCurrentSteeringResponseData();return e.baseUrls&&e.baseUrls.length&&i&&i.serviceLocationPriority&&i.serviceLocationPriority.length&&(n=o(i.serviceLocationPriority,e.baseUrls)),n},setConfig:function(e){e.blacklistController&&(n=e.blacklistController),e.contentSteeringController&&(t=e.contentSteeringController)}},t=(0,i.default)(r).getInstance(),e}o.__dashjs_factory_name="ContentSteeringSelector";const s=r.default.getClassFactory(o)},"./src/streaming/utils/baseUrlResolution/DVBSelector.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n("./src/core/FactoryMaker.js");function i(e){var t=(e=e||{}).blacklistController;return{select:function(e){return e&&function(e){var t,n,r=0,i=[],o=0;if((n=e.sort((function(e,t){var n=e.dvb_priority-t.dvb_priority;return isNaN(n)?0:n})).filter((function(e,t,n){return!t||n[0].dvb_priority&&e.dvb_priority&&n[0].dvb_priority===e.dvb_priority}))).length)return n.length>1&&(n.forEach((function(e){r+=e.dvb_weight,i.push(r)})),t=Math.floor(Math.random()*(r-1)),i.every((function(e,n){return o=n,!(t<e)}))),n[o]}((n=[],e.filter((function(e){return!t.contains(e.serviceLocation)||(e.dvb_priority&&n.push(e.dvb_priority),!1)})).filter((function(e){return!n.length||!e.dvb_priority||-1===n.indexOf(e.dvb_priority)}))));var n}}}i.__dashjs_factory_name="DVBSelector";const o=r.default.getClassFactory(i)},"./src/streaming/vo/BitrateInfo.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaType=null,this.bitrate=null,this.width=null,this.height=null,this.scanType=null,this.qualityIndex=NaN}},"./src/streaming/vo/DashJSError.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.code=t||null,this.message=n||null,this.data=r||null}},"./src/streaming/vo/DataChunk.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.streamId=null,this.mediaInfo=null,this.segmentType=null,this.quality=NaN,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN,this.representationId=null,this.endFragment=null}},"./src/streaming/vo/FragmentRequest.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n("./src/streaming/vo/metrics/HTTPRequest.js");function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.action=e.ACTION_DOWNLOAD,this.startTime=NaN,this.mediaStartTime=NaN,this.mediaType=null,this.mediaInfo=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=t||null,this.serviceLocation=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,this.bytesLoaded=NaN,this.bytesTotal=NaN,this.delayLoadingTime=NaN,this.responseType="arraybuffer",this.representationId=null}var t,n;return t=e,(n=[{key:"isInitializationRequest",value:function(){return this.type&&this.type===r.HTTPRequest.INIT_SEGMENT_TYPE}},{key:"setInfo",value:function(e){this.type=e&&e.init?r.HTTPRequest.INIT_SEGMENT_TYPE:r.HTTPRequest.MEDIA_SEGMENT_TYPE,this.url=e&&e.url?e.url:null,this.range=e&&e.range?e.range.start+"-"+e.range.end:null,this.mediaType=e&&e.mediaType?e.mediaType:null}}])&&i(t.prototype,n),e}();o.ACTION_DOWNLOAD="download",o.ACTION_COMPLETE="complete";const s=o},"./src/streaming/vo/HeadRequest.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/streaming/vo/FragmentRequest.js");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const a=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(n,r.default);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var o=s(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,n)}}(n);function n(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(r=t.call(this,e)).checkForExistenceOnly=!0,r}return n}()},"./src/streaming/vo/IsoBox.js":(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,{default:()=>i});const i=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.offset=t._offset,this.type=t.type,this.size=t.size,this.boxes=[],t.boxes)for(var n=0;n<t.boxes.length;n++)this.boxes.push(new e(t.boxes[n]));switch(this.isComplete=!0,t.type){case"sidx":if(this.timescale=t.timescale,this.earliest_presentation_time=t.earliest_presentation_time,this.first_offset=t.first_offset,this.references=t.references,t.references){this.references=[];for(var r=0;r<t.references.length;r++){var i={reference_type:t.references[r].reference_type,referenced_size:t.references[r].referenced_size,subsegment_duration:t.references[r].subsegment_duration};this.references.push(i)}}break;case"emsg":this.id=t.id,this.version=1===t.version?1:0,this.value=t.value,this.timescale=t.timescale,this.scheme_id_uri=t.scheme_id_uri,this.presentation_time_delta=1===t.version?t.presentation_time:t.presentation_time_delta,this.event_duration=t.event_duration,this.message_data=t.message_data;break;case"mdhd":this.timescale=t.timescale;break;case"mfhd":this.sequence_number=t.sequence_number;break;case"subs":this.entry_count=t.entry_count,this.entries=t.entries;break;case"tfhd":this.base_data_offset=t.base_data_offset,this.sample_description_index=t.sample_description_index,this.default_sample_duration=t.default_sample_duration,this.default_sample_size=t.default_sample_size,this.default_sample_flags=t.default_sample_flags,this.flags=t.flags;break;case"tfdt":this.version=t.version,this.baseMediaDecodeTime=t.baseMediaDecodeTime,this.flags=t.flags;break;case"trun":if(this.sample_count=t.sample_count,this.first_sample_flags=t.first_sample_flags,this.data_offset=t.data_offset,this.flags=t.flags,this.samples=t.samples,t.samples){this.samples=[];for(var o=0,s=t.samples.length;o<s;o++){var a={sample_size:t.samples[o].sample_size,sample_duration:t.samples[o].sample_duration,sample_composition_time_offset:t.samples[o].sample_composition_time_offset};this.samples.push(a)}}}}var t,n;return t=e,(n=[{key:"getChildBox",value:function(e){for(var t=0;t<this.boxes.length;t++)if(this.boxes[t].type===e)return this.boxes[t]}},{key:"getChildBoxes",value:function(e){for(var t=[],n=0;n<this.boxes.length;n++)this.boxes[n].type===e&&t.push(this.boxes[n]);return t}}])&&r(t.prototype,n),e}()},"./src/streaming/vo/IsoBoxSearchInfo.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lastCompletedOffset=t,this.found=n,this.size=r}},"./src/streaming/vo/MetricsList.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TcpList=[],this.HttpList=[],this.RepSwitchList=[],this.BufferLevel=[],this.BufferState=[],this.PlayList=[],this.DroppedFrames=[],this.SchedulingInfo=[],this.DVRInfo=[],this.ManifestUpdate=[],this.RequestsQueue=null,this.DVBErrors=[]}},"./src/streaming/vo/TextRequest.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var r=n("./src/streaming/constants/Constants.js"),i=n("./src/streaming/vo/FragmentRequest.js");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(n,i.default);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=a(e);if(t){var i=a(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,n)}}(n);function n(e,i){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(o=t.call(this)).url=e||null,o.type=i||null,o.mediaType=r.default.STREAM,o.responseType="",o}return n}()},"./src/streaming/vo/TextTrackInfo.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n("./src/dash/vo/MediaInfo.js");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const a=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(n,r.default);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var o=s(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,n)}}(n);function n(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(e=t.call(this)).captionData=null,e.label=null,e.defaultTrack=!1,e.kind=null,e.isFragmented=!1,e.isEmbedded=!1,e.isTTML=null,e}return n}()},"./src/streaming/vo/Thumbnail.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=null,this.width=null,this.height=null,this.x=null,this.y=null}},"./src/streaming/vo/ThumbnailTrackInfo.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.bitrate=0,this.width=0,this.height=0,this.tilesHor=0,this.tilesVert=0,this.widthPerTile=0,this.heightPerTile=0,this.startNumber=0,this.segmentDuration=0,this.timescale=0,this.templateUrl="",this.id=""}},"./src/streaming/vo/URIFragmentData.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null,this.r=null}},"./src/streaming/vo/metrics/BufferLevel.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.level=null}},"./src/streaming/vo/metrics/BufferState.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});var r=n("./src/streaming/constants/MetricsConstants.js");const i=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=null,this.state=r.default.BUFFER_EMPTY}},"./src/streaming/vo/metrics/DVRInfo.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.time=null,this.range=null,this.manifestInfo=null}},"./src/streaming/vo/metrics/DroppedFrames.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.time=null,this.droppedFrames=null}},"./src/streaming/vo/metrics/HTTPRequest.js":(e,t,n)=>{"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t),n.d(t,{HTTPRequest:()=>i,HTTPRequestTrace:()=>o});var i=function e(){r(this,e),this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.responsecode=null,this.interval=null,this.trace=[],this.cmsd=null,this._stream=null,this._tfinish=null,this._mediaduration=null,this._quality=null,this._responseHeaders=null,this._serviceLocation=null,this._fileLoaderType=null},o=function e(){r(this,e),this.s=null,this.d=null,this.b=[]};i.GET="GET",i.HEAD="HEAD",i.MPD_TYPE="MPD",i.XLINK_EXPANSION_TYPE="XLinkExpansion",i.INIT_SEGMENT_TYPE="InitializationSegment",i.INDEX_SEGMENT_TYPE="IndexSegment",i.MEDIA_SEGMENT_TYPE="MediaSegment",i.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",i.MSS_FRAGMENT_INFO_SEGMENT_TYPE="FragmentInfoSegment",i.DVB_REPORTING_TYPE="DVBReporting",i.LICENSE="license",i.CONTENT_STEERING_TYPE="ContentSteering",i.OTHER_TYPE="other"},"./src/streaming/vo/metrics/ManifestUpdate.js":(e,t,n)=>{"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t),n.d(t,{ManifestUpdate:()=>i,ManifestUpdateRepresentationInfo:()=>s,ManifestUpdateStreamInfo:()=>o});var i=function e(){r(this,e),this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.representationInfo=[]},o=function e(){r(this,e),this.id=null,this.index=null,this.start=null,this.duration=null},s=function e(){r(this,e),this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null}},"./src/streaming/vo/metrics/PlayList.js":(e,t,n)=>{"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t),n.d(t,{PlayList:()=>i,PlayListTrace:()=>o});var i=function e(){r(this,e),this.start=null,this.mstart=null,this.starttype=null,this.trace=[]};i.INITIAL_PLAYOUT_START_REASON="initial_playout",i.SEEK_START_REASON="seek",i.RESUME_FROM_PAUSE_START_REASON="resume",i.METRICS_COLLECTION_START_REASON="metrics_collection_start";var o=function e(){r(this,e),this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null};o.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",o.REBUFFERING_REASON="rebuffering",o.USER_REQUEST_STOP_REASON="user_request",o.END_OF_PERIOD_STOP_REASON="end_of_period",o.END_OF_CONTENT_STOP_REASON="end_of_content",o.METRICS_COLLECTION_STOP_REASON="metrics_collection_end",o.FAILURE_STOP_REASON="failure"},"./src/streaming/vo/metrics/RepresentationSwitch.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.mt=null,this.to=null,this.lto=null}},"./src/streaming/vo/metrics/RequestsQueue.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loadingRequests=[],this.executedRequests=[]}},"./src/streaming/vo/metrics/SchedulingInfo.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null}},"./node_modules/bcp-47-match/index.js":(e,t)=>{"use strict";function n(e,t){return function(n,i){for(var o,s,a,l=r(n,"tag"),c=r(null==i?"*":i,"range"),u=[],d=-1;++d<c.length;)if(o=c[d].toLowerCase(),t||"*"!==o){for(s=-1,a=[];++s<l.length;)if(e(l[s].toLowerCase(),o)){if(!t)return l[s];u.push(l[s])}else a.push(l[s]);l=a}return t?u:void 0}}function r(e,t){var n=e&&"string"==typeof e?[e]:e;if(!n||"object"!=typeof n||!("length"in n))throw new Error("Invalid "+t+" `"+n+"`, expected non-empty string");return n}t.basicFilter=n((function(e,t){return"*"===t||e===t||e.indexOf(t+"-")>-1}),!0),t.extendedFilter=n((function(e,t){var n=e.split("-"),r=t.split("-"),i=0,o=0;if("*"!==r[o]&&n[i]!==r[o])return!1;for(i++,o++;o<r.length;)if("*"!==r[o]){if(!n[i])return!1;if(n[i]!==r[o]){if(1===n[i].length)return!1;i++}else i++,o++}else o++;return!0}),!0),t.lookup=n((function(e,t){for(var n,r=t;;){if("*"===r||e===r)return!0;if((n=r.lastIndexOf("-"))<0)return!1;"-"===r.charAt(n-2)&&(n-=2),r=r.slice(0,n)}}))},"./node_modules/bcp-47-normalize/index.js":(e,t,n)=>{"use strict";e.exports=n("./node_modules/bcp-47-normalize/lib/index.js")},"./node_modules/bcp-47-normalize/lib/index.js":(e,t,n)=>{"use strict";var r=n("./node_modules/bcp-47/index.js"),i=n("./node_modules/bcp-47-match/index.js"),o=n("./node_modules/bcp-47-normalize/lib/matches.json"),s=n("./node_modules/bcp-47-normalize/lib/fields.json"),a=n("./node_modules/bcp-47-normalize/lib/defaults.json"),l=n("./node_modules/bcp-47-normalize/lib/many.json");e.exports=function(e,t){var n,u=t||{},m=r.parse(String(e||"").toLowerCase(),u),v=r.stringify(m),y=-1;if(!v)return v;for(;++y<o.length;)i.extendedFilter(v,o[y].from).length&&(p(m,o[y].from,o[y].to),v=r.stringify(m));for(y=-1;++y<s.length;)h(m,s[y].from.field,s[y].from.value)&&f(m,s[y].to.field,s[y].to.value);for(v=r.stringify(Object.assign({},m,d)),y=-1;++y<a.length;)v===a[y]&&(p(m,a[y],a[y].split("-").slice(0,-1).join("-")),v=r.stringify(Object.assign({},m,d)));if(m.extensions.sort(g),u.warning)for(n in l)c.call(l[n],m[n])&&u.warning("Deprecated "+n+" `"+m[n]+"`, expected one of `"+l[n][m[n]].join("`, `")+"`",null,7);return m.script&&(m.script=m.script.charAt(0).toUpperCase()+m.script.slice(1)),m.region&&(m.region=m.region.toUpperCase()),r.stringify(m)};var c={}.hasOwnProperty,u=new Intl.Collator,d={variants:[],extensions:[],privateuse:[],irregular:null,regular:null};function p(e,t,n){var i,o=r.parse(t),s=r.parse(n),a=[];for(i in o)o[i]&&o[i].length&&h(e,i,o[i])&&a.push(i);for(i in s)s[i]&&s[i].length&&(a.indexOf(i)>-1||!e[i]||!e[i].length)&&f(e,i,s[i])}function h(e,t,n){var r,i,o,s,a=!1;if(n){if(i=r=e[t],r&&"object"==typeof r)for(i=[],o=-1;++o<r.length;)s=r[o],n.indexOf(s)<0?i.push(s):a=!0;else r===n&&(i=null,a=!0);e[t]=i}return a}function f(e,t,n){var r,i,o,s=e[t];if(s&&"object"==typeof s)for(r=[].concat(n),i=-1;++i<r.length;)o=r[i],s.indexOf(o)<0&&s.push(o);else e[t]=n}function g(e,t){return u.compare(e.singleton,t.singleton)}},"./node_modules/bcp-47/index.js":(e,t,n)=>{"use strict";t.parse=n("./node_modules/bcp-47/lib/parse.js"),t.stringify=n("./node_modules/bcp-47/lib/stringify.js")},"./node_modules/bcp-47/lib/parse.js":(e,t,n)=>{"use strict";var r=n("./node_modules/is-alphanumerical/index.js"),i=n("./node_modules/is-alphabetical/index.js"),o=n("./node_modules/is-decimal/index.js"),s=n("./node_modules/bcp-47/lib/regular.json"),a=n("./node_modules/bcp-47/lib/normalize.json");e.exports=function e(t,n){var c,u,d,p=n||{},h={language:null,extendedLanguageSubtags:[],script:null,region:null,variants:[],extensions:[],privateuse:[],irregular:null,regular:null},f=String(t),g=f.toLowerCase(),m=0;if(null==t)throw new Error("Expected string, got `"+t+"`");if(l.call(a,g))return(null==p.normalize||p.normalize)&&a[g]?e(a[g]):(h[-1===s.indexOf(g)?"irregular":"regular"]=f,h);for(;i(g.charCodeAt(m))&&m<9;)m++;if(m>1&&m<9){if(h.language=f.slice(0,m),m<4)for(u=0;45===g.charCodeAt(m)&&i(g.charCodeAt(m+1))&&i(g.charCodeAt(m+2))&&i(g.charCodeAt(m+3))&&!i(g.charCodeAt(m+4));){if(u>2)return v(m,3,"Too many extended language subtags, expected at most 3 subtags");h.extendedLanguageSubtags.push(f.slice(m+1,m+4)),m+=4,u++}for(45===g.charCodeAt(m)&&i(g.charCodeAt(m+1))&&i(g.charCodeAt(m+2))&&i(g.charCodeAt(m+3))&&i(g.charCodeAt(m+4))&&!i(g.charCodeAt(m+5))&&(h.script=f.slice(m+1,m+5),m+=5),45===g.charCodeAt(m)&&(i(g.charCodeAt(m+1))&&i(g.charCodeAt(m+2))&&!i(g.charCodeAt(m+3))?(h.region=f.slice(m+1,m+3),m+=3):o(g.charCodeAt(m+1))&&o(g.charCodeAt(m+2))&&o(g.charCodeAt(m+3))&&!o(g.charCodeAt(m+4))&&(h.region=f.slice(m+1,m+4),m+=4));45===g.charCodeAt(m);){for(d=c=m+1;r(g.charCodeAt(d));){if(d-c>7)return v(d,1,"Too long variant, expected at most 8 characters");d++}if(!(d-c>4||d-c>3&&o(g.charCodeAt(c))))break;h.variants.push(f.slice(c,d)),m=d}for(;45===g.charCodeAt(m)&&120!==g.charCodeAt(m+1)&&r(g.charCodeAt(m+1))&&45===g.charCodeAt(m+2)&&r(g.charCodeAt(m+3));){for(d=m+2,u=0;45===g.charCodeAt(d)&&r(g.charCodeAt(d+1))&&r(g.charCodeAt(d+2));)for(d=(c=d+1)+2,u++;r(g.charCodeAt(d));){if(d-c>7)return v(d,2,"Too long extension, expected at most 8 characters");d++}if(!u)return v(d,4,"Empty extension, extensions must have at least 2 characters of content");h.extensions.push({singleton:f.charAt(m+1),extensions:f.slice(m+3,d).split("-")}),m=d}}else m=0;if(0===m&&120===g.charCodeAt(m)||45===g.charCodeAt(m)&&120===g.charCodeAt(m+1))for(d=m=m?m+2:1;45===g.charCodeAt(d)&&r(g.charCodeAt(d+1));){for(d=c=m+1;r(g.charCodeAt(d));){if(d-c>7)return v(d,5,"Too long private-use area, expected at most 8 characters");d++}h.privateuse.push(f.slice(m+1,d)),m=d}return m!==f.length?v(m,6,"Found superfluous content after tag"):h;function v(e,t,n){return p.warning&&p.warning(n,t,e),p.forgiving?h:{language:null,extendedLanguageSubtags:[],script:null,region:null,variants:[],extensions:[],privateuse:[],irregular:null,regular:null}}};var l={}.hasOwnProperty},"./node_modules/bcp-47/lib/stringify.js":e=>{"use strict";e.exports=function(e){var t,n,r,i=e||{},o=[];if(i.irregular||i.regular)return i.irregular||i.regular;if(i.language)for(o=o.concat(i.language,i.extendedLanguageSubtags||[],i.script||[],i.region||[],i.variants||[]),t=i.extensions||[],n=-1;++n<t.length;)(r=t[n]).singleton&&r.extensions&&r.extensions.length&&(o=o.concat(r.singleton,r.extensions));return i.privateuse&&i.privateuse.length&&(o=o.concat("x",i.privateuse)),o.join("-")}},"./node_modules/buffer/index.js":(e,t,n)=>{"use strict";var r=n("./node_modules/buffer/node_modules/base64-js/index.js"),i=n("./node_modules/buffer/node_modules/ieee754/index.js"),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=l,t.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},t.INSPECT_MAX_BYTES=50;var s=2147483647;function a(e){if(e>s)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,l.prototype),t}function l(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return d(e)}return c(e,t,n)}function c(e,t,n){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|g(e,t),r=a(n),i=r.write(e,t);return i!==n&&(r=r.slice(0,i)),r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(U(e,Uint8Array)){var t=new Uint8Array(e);return h(t.buffer,t.byteOffset,t.byteLength)}return p(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(U(e,ArrayBuffer)||e&&U(e.buffer,ArrayBuffer))return h(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(U(e,SharedArrayBuffer)||e&&U(e.buffer,SharedArrayBuffer)))return h(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return l.from(r,t,n);var i=function(e){if(l.isBuffer(e)){var t=0|f(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||H(e.length)?a(0):p(e):"Buffer"===e.type&&Array.isArray(e.data)?p(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return u(e),a(e<0?0:0|f(e))}function p(e){for(var t=e.length<0?0:0|f(e.length),n=a(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function h(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,l.prototype),r}function f(e){if(e>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|e}function g(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||U(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return L(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return B(e).length;default:if(i)return r?-1:L(e).length;t=(""+t).toLowerCase(),i=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function v(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),H(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=l.from(t,r)),l.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){var o,s=1,a=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,l/=2,n/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var u=-1;for(o=n;o<a;o++)if(c(e,o)===c(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===l)return u*s}else-1!==u&&(o-=o-u),u=-1}else for(n+l>a&&(n=a-l),o=n;o>=0;o--){for(var d=!0,p=0;p<l;p++)if(c(e,o+p)!==c(t,p)){d=!1;break}if(d)return o}return-1}function b(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(H(a))return s;e[n+s]=a}return s}function x(e,t,n,r){return F(L(t,e.length-n),e,n,r)}function E(e,t,n,r){return F(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function _(e,t,n,r){return F(B(t),e,n,r)}function w(e,t,n,r){return F(function(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function S(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function T(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,s,a,l,c=e[i],u=null,d=c>239?4:c>223?3:c>191?2:1;if(i+d<=n)switch(d){case 1:c<128&&(u=c);break;case 2:128==(192&(o=e[i+1]))&&(l=(31&c)<<6|63&o)>127&&(u=l);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(l=(15&c)<<12|(63&o)<<6|63&s)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(l=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&l<1114112&&(u=l)}null===u?(u=65533,d=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=d}return function(e){var t=e.length;if(t<=k)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=k));return n}(r)}t.kMaxLength=s,l.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),l.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(e,t,n){return c(e,t,n)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(e,t,n){return function(e,t,n){return u(e),e<=0?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)}(e,t,n)},l.allocUnsafe=function(e){return d(e)},l.allocUnsafeSlow=function(e){return d(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if(U(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),U(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=l.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(U(o,Uint8Array))i+o.length>r.length?l.from(o).copy(r,i):Uint8Array.prototype.set.call(r,o,i);else{if(!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i)}i+=o.length}return r},l.byteLength=g,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},l.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?T(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return j(this,t,n);case"utf8":case"utf-8":return T(this,t,n);case"ascii":return C(this,t,n);case"latin1":case"binary":return A(this,t,n);case"base64":return S(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},o&&(l.prototype[o]=l.prototype.inspect),l.prototype.compare=function(e,t,n,r,i){if(U(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(o,s),c=this.slice(r,i),u=e.slice(t,n),d=0;d<a;++d)if(c[d]!==u[d]){o=c[d],s=u[d];break}return o<s?-1:s<o?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},l.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return x(this,e,t,n);case"ascii":case"latin1":case"binary":return E(this,e,t,n);case"base64":return _(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var k=4096;function C(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function A(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function j(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=G[e[o]];return i}function I(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length-1;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function O(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function N(e,t,n,r,i,o){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function R(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function P(e,t,n,r,o){return t=+t,n>>>=0,o||R(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function D(e,t,n,r,o){return t=+t,n>>>=0,o||R(e,0,n,8),i.write(e,t,n,r,52,8),n+8}l.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,l.prototype),r},l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||O(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||O(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||O(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},l.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||O(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},l.prototype.readInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||O(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){e>>>=0,t||O(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return e>>>=0,t||O(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||O(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||O(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||O(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||N(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||N(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);N(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},l.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);N(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeFloatLE=function(e,t,n){return P(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return P(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return D(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return D(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,r){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},l.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){var i=e.charCodeAt(0);("utf8"===r&&i<128||"latin1"===r)&&(e=i)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=l.isBuffer(e)?e:l.from(e,r),a=s.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-t;++o)this[o+t]=s[o%a]}return this};var M=/[^+/0-9A-Za-z-_]/g;function L(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function B(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(M,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function F(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function U(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function H(e){return e!=e}var G=function(){for(var e=new Array(256),t=0;t<16;++t)for(var n=16*t,r=0;r<16;++r)e[n+r]="0123456789abcdef"[t]+"0123456789abcdef"[r];return e}()},"./node_modules/buffer/node_modules/base64-js/index.js":(e,t)=>{"use strict";t.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,o=l(e),s=o[0],a=o[1],c=new i(function(e,t,n){return 3*(t+n)/4-n}(0,s,a)),u=0,d=a>0?s-4:s;for(n=0;n<d;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===a&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[u++]=255&t),1===a&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],s=0,a=r-i;s<a;s+=16383)o.push(c(e,s,s+16383>a?a:s+16383));return 1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),o.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=o.length;s<a;++s)n[s]=o[s],r[o.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,r){for(var i,o,s=[],a=t;a<r;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},"./node_modules/buffer/node_modules/ieee754/index.js":(e,t)=>{t.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,l=(1<<a)-1,c=l>>1,u=-7,d=n?i-1:0,p=n?-1:1,h=e[t+d];for(d+=p,o=h&(1<<-u)-1,h>>=-u,u+=a;u>0;o=256*o+e[t+d],d+=p,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+e[t+d],d+=p,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,r),o-=c}return(h?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,a,l,c=8*o-i-1,u=(1<<c)-1,d=u>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:o-1,f=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+d>=1?p/l:p*Math.pow(2,1-d))*l>=2&&(s++,l/=2),s+d>=u?(a=0,s=u):s+d>=1?(a=(t*l-1)*Math.pow(2,i),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[n+h]=255&a,h+=f,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[n+h]=255&s,h+=f,s/=256,c-=8);e[n+h-f]|=128*g}},"./node_modules/codem-isoboxer/dist/iso_boxer.js":(e,t)=>{var n={parseBuffer:function(e){return new r(e).parse()},addBoxProcessor:function(e,t){"string"==typeof e&&"function"==typeof t&&(i.prototype._boxProcessors[e]=t)},createFile:function(){return new r},createBox:function(e,t,n){var r=i.create(e);return t&&t.append(r,n),r},createFullBox:function(e,t,r){var i=n.createBox(e,t,r);return i.version=0,i.flags=0,i},Utils:{}};n.Utils.dataViewToString=function(e,t){var n=t||"utf-8";if("undefined"!=typeof TextDecoder)return new TextDecoder(n).decode(e);var r=[],i=0;if("utf-8"===n)for(;i<e.byteLength;){var o=e.getUint8(i++);o<128||(o<224?(o=(31&o)<<6,o|=63&e.getUint8(i++)):o<240?(o=(15&o)<<12,o|=(63&e.getUint8(i++))<<6,o|=63&e.getUint8(i++)):(o=(7&o)<<18,o|=(63&e.getUint8(i++))<<12,o|=(63&e.getUint8(i++))<<6,o|=63&e.getUint8(i++))),r.push(String.fromCharCode(o))}else for(;i<e.byteLength;)r.push(String.fromCharCode(e.getUint8(i++)));return r.join("")},n.Utils.utf8ToByteArray=function(e){var t,n;if("undefined"!=typeof TextEncoder)t=(new TextEncoder).encode(e);else for(t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?(t.push(192|r>>6),t.push(128|63&r)):r<65536?(t.push(224|r>>12),t.push(128|63&r>>6),t.push(128|63&r)):(t.push(240|r>>18),t.push(128|63&r>>12),t.push(128|63&r>>6),t.push(128|63&r))}return t},n.Utils.appendBox=function(e,t,n){if(t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,-1!==n)if(null!=n){var r,i=-1;if("number"==typeof n)i=n;else{if("string"==typeof n)r=n;else{if("object"!=typeof n||!n.type)return void e.boxes.push(t);r=n.type}for(var o=0;o<e.boxes.length;o++)if(r===e.boxes[o].type){i=o+1;break}}e.boxes.splice(i,0,t)}else e.boxes.push(t)},t.parseBuffer=n.parseBuffer,t.addBoxProcessor=n.addBoxProcessor,t.createFile=n.createFile,t.createBox=n.createBox,t.createFullBox=n.createFullBox,t.Utils=n.Utils,n.Cursor=function(e){this.offset=void 0===e?0:e};var r=function(e){this._cursor=new n.Cursor,this.boxes=[],e&&(this._raw=new DataView(e))};r.prototype.fetch=function(e){var t=this.fetchAll(e,!0);return t.length?t[0]:null},r.prototype.fetchAll=function(e,t){var n=[];return r._sweep.call(this,e,n,t),n},r.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var e=i.parse(this);if(void 0===e.type)break;this.boxes.push(e)}return this},r._sweep=function(e,t,n){for(var i in this.type&&this.type==e&&t.push(this),this.boxes){if(t.length&&n)return;r._sweep.call(this.boxes[i],e,t,n)}},r.prototype.write=function(){var e,t=0;for(e=0;e<this.boxes.length;e++)t+=this.boxes[e].getLength(!1);var n=new Uint8Array(t);for(this._rawo=new DataView(n.buffer),this.bytes=n,this._cursor.offset=0,e=0;e<this.boxes.length;e++)this.boxes[e].write();return n.buffer},r.prototype.append=function(e,t){n.Utils.appendBox(this,e,t)};var i=function(){this._cursor=new n.Cursor};i.parse=function(e){var t=new i;return t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,t._parseBox(),e._cursor.offset=t._raw.byteOffset+t._raw.byteLength,t},i.create=function(e){var t=new i;return t.type=e,t.boxes=[],t},i.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc","sinf","schi","encv","enca"],i.prototype._boxProcessors={},i.prototype._procField=function(e,t,n){this._parsing?this[e]=this._readField(t,n):this._writeField(t,n,this[e])},i.prototype._procFieldArray=function(e,t,n,r){var i;if(this._parsing)for(this[e]=[],i=0;i<t;i++)this[e][i]=this._readField(n,r);else for(i=0;i<this[e].length;i++)this._writeField(n,r,this[e][i])},i.prototype._procFullBox=function(){this._procField("version","uint",8),this._procField("flags","uint",24)},i.prototype._procEntries=function(e,t,n){var r;if(this._parsing)for(this[e]=[],r=0;r<t;r++)this[e].push({}),n.call(this,this[e][r]);else for(r=0;r<t;r++)n.call(this,this[e][r])},i.prototype._procSubEntries=function(e,t,n,r){var i;if(this._parsing)for(e[t]=[],i=0;i<n;i++)e[t].push({}),r.call(this,e[t][i]);else for(i=0;i<n;i++)r.call(this,e[t][i])},i.prototype._procEntryField=function(e,t,n,r){this._parsing?e[t]=this._readField(n,r):this._writeField(n,r,e[t])},i.prototype._procSubBoxes=function(e,t){var n;if(this._parsing)for(this[e]=[],n=0;n<t;n++)this[e].push(i.parse(this));else for(n=0;n<t;n++)this._rawo?this[e][n].write():this.size+=this[e][n].getLength()},i.prototype._readField=function(e,t){switch(e){case"uint":return this._readUint(t);case"int":return this._readInt(t);case"template":return this._readTemplate(t);case"string":return-1===t?this._readTerminatedString():this._readString(t);case"data":return this._readData(t);case"utf8":return this._readUTF8String();default:return-1}},i.prototype._readInt=function(e){var t=null,n=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:t=this._raw.getInt8(n);break;case 16:t=this._raw.getInt16(n);break;case 32:t=this._raw.getInt32(n);break;case 64:var r=this._raw.getInt32(n),i=this._raw.getInt32(n+4);t=r*Math.pow(2,32)+i}return this._cursor.offset+=e>>3,t},i.prototype._readUint=function(e){var t,n,r=null,i=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:r=this._raw.getUint8(i);break;case 16:r=this._raw.getUint16(i);break;case 24:r=((t=this._raw.getUint16(i))<<8)+(n=this._raw.getUint8(i+2));break;case 32:r=this._raw.getUint32(i);break;case 64:t=this._raw.getUint32(i),n=this._raw.getUint32(i+4),r=t*Math.pow(2,32)+n}return this._cursor.offset+=e>>3,r},i.prototype._readString=function(e){for(var t="",n=0;n<e;n++){var r=this._readUint(8);t+=String.fromCharCode(r)}return t},i.prototype._readTemplate=function(e){return this._readUint(e/2)+this._readUint(e/2)/Math.pow(2,e/2)},i.prototype._readTerminatedString=function(){for(var e="";this._cursor.offset-this._offset<this._raw.byteLength;){var t=this._readUint(8);if(0===t)break;e+=String.fromCharCode(t)}return e},i.prototype._readData=function(e){var t=e>0?e:this._raw.byteLength-(this._cursor.offset-this._offset);if(t>0){var n=new Uint8Array(this._raw.buffer,this._cursor.offset,t);return this._cursor.offset+=t,n}return null},i.prototype._readUTF8String=function(){var e=this._raw.byteLength-(this._cursor.offset-this._offset),t=null;return e>0&&(t=new DataView(this._raw.buffer,this._cursor.offset,e),this._cursor.offset+=e),t?n.Utils.dataViewToString(t):t},i.prototype._parseBox=function(){if(this._parsing=!0,this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)this._root._incomplete=!0;else{switch(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset,this._raw.byteLength-this._cursor.offset+8);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type)?this._parseContainerBox():this._data=this._readData())}},i.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},i.prototype._parseContainerBox=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(i.parse(this))},i.prototype.append=function(e,t){n.Utils.appendBox(this,e,t)},i.prototype.getLength=function(){if(this._parsing=!1,this._rawo=null,this.size=0,this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.size+=this.boxes[e].getLength();return this._data&&this._writeData(this._data),this.size},i.prototype.write=function(){switch(this._parsing=!1,this._cursor.offset=this._parent._cursor.offset,this.size){case 0:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.parent._rawo.byteLength-this._cursor.offset);break;case 1:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.largesize);break;default:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.size)}if(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.boxes[e].write();return this._data&&this._writeData(this._data),this._parent._cursor.offset+=this.size,this.size},i.prototype._writeInt=function(e,t){if(this._rawo){var n=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setInt8(n,t);break;case 16:this._rawo.setInt16(n,t);break;case 32:this._rawo.setInt32(n,t);break;case 64:var r=Math.floor(t/Math.pow(2,32)),i=t-r*Math.pow(2,32);this._rawo.setUint32(n,r),this._rawo.setUint32(n+4,i)}this._cursor.offset+=e>>3}else this.size+=e>>3},i.prototype._writeUint=function(e,t){if(this._rawo){var n,r,i=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setUint8(i,t);break;case 16:this._rawo.setUint16(i,t);break;case 24:n=(16776960&t)>>8,r=255&t,this._rawo.setUint16(i,n),this._rawo.setUint8(i+2,r);break;case 32:this._rawo.setUint32(i,t);break;case 64:r=t-(n=Math.floor(t/Math.pow(2,32)))*Math.pow(2,32),this._rawo.setUint32(i,n),this._rawo.setUint32(i+4,r)}this._cursor.offset+=e>>3}else this.size+=e>>3},i.prototype._writeString=function(e,t){for(var n=0;n<e;n++)this._writeUint(8,t.charCodeAt(n))},i.prototype._writeTerminatedString=function(e){if(0!==e.length){for(var t=0;t<e.length;t++)this._writeUint(8,e.charCodeAt(t));this._writeUint(8,0)}},i.prototype._writeTemplate=function(e,t){var n=Math.floor(t),r=(t-n)*Math.pow(2,e/2);this._writeUint(e/2,n),this._writeUint(e/2,r)},i.prototype._writeData=function(e){if(e)if(this._rawo){if(e instanceof Array){for(var t=this._cursor.offset-this._rawo.byteOffset,n=0;n<e.length;n++)this._rawo.setInt8(t+n,e[n]);this._cursor.offset+=e.length}e instanceof Uint8Array&&(this._root.bytes.set(e,this._cursor.offset),this._cursor.offset+=e.length)}else this.size+=e.length},i.prototype._writeUTF8String=function(e){var t=n.Utils.utf8ToByteArray(e);if(this._rawo)for(var r=new DataView(this._rawo.buffer,this._cursor.offset,t.length),i=0;i<t.length;i++)r.setUint8(i,t[i]);else this.size+=t.length},i.prototype._writeField=function(e,t,n){switch(e){case"uint":this._writeUint(t,n);break;case"int":this._writeInt(t,n);break;case"template":this._writeTemplate(t,n);break;case"string":-1==t?this._writeTerminatedString(n):this._writeString(t,n);break;case"data":this._writeData(n);break;case"utf8":this._writeUTF8String(n)}},i.prototype._boxProcessors.avc1=i.prototype._boxProcessors.encv=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procField("pre_defined1","uint",16),this._procField("reserved2","uint",16),this._procFieldArray("pre_defined2",3,"uint",32),this._procField("width","uint",16),this._procField("height","uint",16),this._procField("horizresolution","template",32),this._procField("vertresolution","template",32),this._procField("reserved3","uint",32),this._procField("frame_count","uint",16),this._procFieldArray("compressorname",32,"uint",8),this._procField("depth","uint",16),this._procField("pre_defined3","int",16),this._procField("config","data",-1)},i.prototype._boxProcessors.dref=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},i.prototype._boxProcessors.elst=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"segment_duration","uint",1===this.version?64:32),this._procEntryField(e,"media_time","int",1===this.version?64:32),this._procEntryField(e,"media_rate_integer","int",16),this._procEntryField(e,"media_rate_fraction","int",16)}))},i.prototype._boxProcessors.emsg=function(){this._procFullBox(),1==this.version?(this._procField("timescale","uint",32),this._procField("presentation_time","uint",64),this._procField("event_duration","uint",32),this._procField("id","uint",32),this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1)):(this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1),this._procField("timescale","uint",32),this._procField("presentation_time_delta","uint",32),this._procField("event_duration","uint",32),this._procField("id","uint",32)),this._procField("message_data","data",-1)},i.prototype._boxProcessors.free=i.prototype._boxProcessors.skip=function(){this._procField("data","data",-1)},i.prototype._boxProcessors.frma=function(){this._procField("data_format","uint",32)},i.prototype._boxProcessors.ftyp=i.prototype._boxProcessors.styp=function(){this._procField("major_brand","string",4),this._procField("minor_version","uint",32);var e=-1;this._parsing&&(e=(this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset))/4),this._procFieldArray("compatible_brands",e,"string",4)},i.prototype._boxProcessors.hdlr=function(){this._procFullBox(),this._procField("pre_defined","uint",32),this._procField("handler_type","string",4),this._procFieldArray("reserved",3,"uint",32),this._procField("name","string",-1)},i.prototype._boxProcessors.mdat=function(){this._procField("data","data",-1)},i.prototype._boxProcessors.mdhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._parsing||"string"!=typeof this.language||(this.language=this.language.charCodeAt(0)-96<<10|this.language.charCodeAt(1)-96<<5|this.language.charCodeAt(2)-96),this._procField("language","uint",16),this._parsing&&(this.language=String.fromCharCode(96+(this.language>>10&31),96+(this.language>>5&31),96+(31&this.language))),this._procField("pre_defined","uint",16)},i.prototype._boxProcessors.mehd=function(){this._procFullBox(),this._procField("fragment_duration","uint",1==this.version?64:32)},i.prototype._boxProcessors.mfhd=function(){this._procFullBox(),this._procField("sequence_number","uint",32)},i.prototype._boxProcessors.mfro=function(){this._procFullBox(),this._procField("mfra_size","uint",32)},i.prototype._boxProcessors.mp4a=i.prototype._boxProcessors.enca=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procField("channelcount","uint",16),this._procField("samplesize","uint",16),this._procField("pre_defined","uint",16),this._procField("reserved3","uint",16),this._procField("samplerate","template",32),this._procField("esds","data",-1)},i.prototype._boxProcessors.mvhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procField("rate","template",32),this._procField("volume","template",16),this._procField("reserved1","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procFieldArray("matrix",9,"template",32),this._procFieldArray("pre_defined",6,"uint",32),this._procField("next_track_ID","uint",32)},i.prototype._boxProcessors.payl=function(){this._procField("cue_text","utf8")},i.prototype._boxProcessors.pssh=function(){this._procFullBox(),this._procFieldArray("SystemID",16,"uint",8),this._procField("DataSize","uint",32),this._procFieldArray("Data",this.DataSize,"uint",8)},i.prototype._boxProcessors.schm=function(){this._procFullBox(),this._procField("scheme_type","uint",32),this._procField("scheme_version","uint",32),1&this.flags&&this._procField("scheme_uri","string",-1)},i.prototype._boxProcessors.sdtp=function(){this._procFullBox();var e=-1;this._parsing&&(e=this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset)),this._procFieldArray("sample_dependency_table",e,"uint",8)},i.prototype._boxProcessors.sidx=function(){this._procFullBox(),this._procField("reference_ID","uint",32),this._procField("timescale","uint",32),this._procField("earliest_presentation_time","uint",1==this.version?64:32),this._procField("first_offset","uint",1==this.version?64:32),this._procField("reserved","uint",16),this._procField("reference_count","uint",16),this._procEntries("references",this.reference_count,(function(e){this._parsing||(e.reference=(1&e.reference_type)<<31,e.reference|=2147483647&e.referenced_size,e.sap=(1&e.starts_with_SAP)<<31,e.sap|=(3&e.SAP_type)<<28,e.sap|=268435455&e.SAP_delta_time),this._procEntryField(e,"reference","uint",32),this._procEntryField(e,"subsegment_duration","uint",32),this._procEntryField(e,"sap","uint",32),this._parsing&&(e.reference_type=e.reference>>31&1,e.referenced_size=2147483647&e.reference,e.starts_with_SAP=e.sap>>31&1,e.SAP_type=e.sap>>28&7,e.SAP_delta_time=268435455&e.sap)}))},i.prototype._boxProcessors.smhd=function(){this._procFullBox(),this._procField("balance","uint",16),this._procField("reserved","uint",16)},i.prototype._boxProcessors.ssix=function(){this._procFullBox(),this._procField("subsegment_count","uint",32),this._procEntries("subsegments",this.subsegment_count,(function(e){this._procEntryField(e,"ranges_count","uint",32),this._procSubEntries(e,"ranges",e.ranges_count,(function(e){this._procEntryField(e,"level","uint",8),this._procEntryField(e,"range_size","uint",24)}))}))},i.prototype._boxProcessors.stsd=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},i.prototype._boxProcessors.subs=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"sample_delta","uint",32),this._procEntryField(e,"subsample_count","uint",16),this._procSubEntries(e,"subsamples",e.subsample_count,(function(e){this._procEntryField(e,"subsample_size","uint",1===this.version?32:16),this._procEntryField(e,"subsample_priority","uint",8),this._procEntryField(e,"discardable","uint",8),this._procEntryField(e,"codec_specific_parameters","uint",32)}))}))},i.prototype._boxProcessors.tenc=function(){this._procFullBox(),this._procField("default_IsEncrypted","uint",24),this._procField("default_IV_size","uint",8),this._procFieldArray("default_KID",16,"uint",8)},i.prototype._boxProcessors.tfdt=function(){this._procFullBox(),this._procField("baseMediaDecodeTime","uint",1==this.version?64:32)},i.prototype._boxProcessors.tfhd=function(){this._procFullBox(),this._procField("track_ID","uint",32),1&this.flags&&this._procField("base_data_offset","uint",64),2&this.flags&&this._procField("sample_description_offset","uint",32),8&this.flags&&this._procField("default_sample_duration","uint",32),16&this.flags&&this._procField("default_sample_size","uint",32),32&this.flags&&this._procField("default_sample_flags","uint",32)},i.prototype._boxProcessors.tfra=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._parsing||(this.reserved=0,this.reserved|=(48&this.length_size_of_traf_num)<<4,this.reserved|=(12&this.length_size_of_trun_num)<<2,this.reserved|=3&this.length_size_of_sample_num),this._procField("reserved","uint",32),this._parsing&&(this.length_size_of_traf_num=(48&this.reserved)>>4,this.length_size_of_trun_num=(12&this.reserved)>>2,this.length_size_of_sample_num=3&this.reserved),this._procField("number_of_entry","uint",32),this._procEntries("entries",this.number_of_entry,(function(e){this._procEntryField(e,"time","uint",1===this.version?64:32),this._procEntryField(e,"moof_offset","uint",1===this.version?64:32),this._procEntryField(e,"traf_number","uint",8*(this.length_size_of_traf_num+1)),this._procEntryField(e,"trun_number","uint",8*(this.length_size_of_trun_num+1)),this._procEntryField(e,"sample_number","uint",8*(this.length_size_of_sample_num+1))}))},i.prototype._boxProcessors.tkhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("track_ID","uint",32),this._procField("reserved1","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procFieldArray("reserved2",2,"uint",32),this._procField("layer","uint",16),this._procField("alternate_group","uint",16),this._procField("volume","template",16),this._procField("reserved3","uint",16),this._procFieldArray("matrix",9,"template",32),this._procField("width","template",32),this._procField("height","template",32)},i.prototype._boxProcessors.trex=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._procField("default_sample_description_index","uint",32),this._procField("default_sample_duration","uint",32),this._procField("default_sample_size","uint",32),this._procField("default_sample_flags","uint",32)},i.prototype._boxProcessors.trun=function(){this._procFullBox(),this._procField("sample_count","uint",32),1&this.flags&&this._procField("data_offset","int",32),4&this.flags&&this._procField("first_sample_flags","uint",32),this._procEntries("samples",this.sample_count,(function(e){256&this.flags&&this._procEntryField(e,"sample_duration","uint",32),512&this.flags&&this._procEntryField(e,"sample_size","uint",32),1024&this.flags&&this._procEntryField(e,"sample_flags","uint",32),2048&this.flags&&this._procEntryField(e,"sample_composition_time_offset",1===this.version?"int":"uint",32)}))},i.prototype._boxProcessors["url "]=i.prototype._boxProcessors["urn "]=function(){this._procFullBox(),"urn "===this.type&&this._procField("name","string",-1),this._procField("location","string",-1)},i.prototype._boxProcessors.vlab=function(){this._procField("source_label","utf8")},i.prototype._boxProcessors.vmhd=function(){this._procFullBox(),this._procField("graphicsmode","uint",16),this._procFieldArray("opcolor",3,"uint",16)},i.prototype._boxProcessors.vttC=function(){this._procField("config","utf8")},i.prototype._boxProcessors.vtte=function(){}},"./node_modules/es6-promise/auto.js":(e,t,n)=>{"use strict";e.exports=n("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},"./node_modules/es6-promise/dist/es6-promise.js":function(t,n,r){t.exports=function(){"use strict";function t(e){return"function"==typeof e}var n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=0,o=void 0,s=void 0,a=function(e,t){f[i]=e,f[i+1]=t,2===(i+=2)&&(s?s(g):x())},l="undefined"!=typeof window?window:void 0,c=l||{},u=c.MutationObserver||c.WebKitMutationObserver,d="undefined"==typeof self&&void 0!==e&&"[object process]"==={}.toString.call(e),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function h(){var e=setTimeout;return function(){return e(g,1)}}var f=new Array(1e3);function g(){for(var e=0;e<i;e+=2)(0,f[e])(f[e+1]),f[e]=void 0,f[e+1]=void 0;i=0}var m,v,y,b,x=void 0;function E(e,t){var n=this,r=new this.constructor(S);void 0===r[w]&&D(r);var i=n._state;if(i){var o=arguments[i-1];a((function(){return R(i,r,o,n._result)}))}else O(n,r,e,t);return r}function _(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(S);return C(t,e),t}d?x=function(){return e.nextTick(g)}:u?(v=0,y=new u(g),b=document.createTextNode(""),y.observe(b,{characterData:!0}),x=function(){b.data=v=++v%2}):p?((m=new MessageChannel).port1.onmessage=g,x=function(){return m.port2.postMessage(0)}):x=void 0===l?function(){try{var e=Function("return this")().require("vertx");return void 0!==(o=e.runOnLoop||e.runOnContext)?function(){o(g)}:h()}catch(e){return h()}}():h();var w=Math.random().toString(36).substring(2);function S(){}var T=void 0;function k(e,n,r){n.constructor===e.constructor&&r===E&&n.constructor.resolve===_?function(e,t){1===t._state?j(e,t._result):2===t._state?I(e,t._result):O(t,void 0,(function(t){return C(e,t)}),(function(t){return I(e,t)}))}(e,n):void 0===r?j(e,n):t(r)?function(e,t,n){a((function(e){var r=!1,i=function(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}(n,t,(function(n){r||(r=!0,t!==n?C(e,n):j(e,n))}),(function(t){r||(r=!0,I(e,t))}),e._label);!r&&i&&(r=!0,I(e,i))}),e)}(e,n,r):j(e,n)}function C(e,t){if(e===t)I(e,new TypeError("You cannot resolve a promise with itself"));else if(i=typeof(r=t),null===r||"object"!==i&&"function"!==i)j(e,t);else{var n=void 0;try{n=t.then}catch(t){return void I(e,t)}k(e,t,n)}var r,i}function A(e){e._onerror&&e._onerror(e._result),N(e)}function j(e,t){e._state===T&&(e._result=t,e._state=1,0!==e._subscribers.length&&a(N,e))}function I(e,t){e._state===T&&(e._state=2,e._result=t,a(A,e))}function O(e,t,n,r){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+1]=n,i[o+2]=r,0===o&&e._state&&a(N,e)}function N(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,i=void 0,o=e._result,s=0;s<t.length;s+=3)r=t[s],i=t[s+n],r?R(n,r,i,o):i(o);e._subscribers.length=0}}function R(e,n,r,i){var o=t(r),s=void 0,a=void 0,l=!0;if(o){try{s=r(i)}catch(e){l=!1,a=e}if(n===s)return void I(n,new TypeError("A promises callback cannot return that same promise."))}else s=i;n._state!==T||(o&&l?C(n,s):!1===l?I(n,a):1===e?j(n,s):2===e&&I(n,s))}var P=0;function D(e){e[w]=P++,e._state=void 0,e._result=void 0,e._subscribers=[]}var M=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(S),this.promise[w]||D(this.promise),n(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?j(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&j(this.promise,this._result))):I(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===T&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===_){var i=void 0,o=void 0,s=!1;try{i=e.then}catch(e){s=!0,o=e}if(i===E&&e._state!==T)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(n===L){var a=new n(S);s?I(a,o):k(a,e,i),this._willSettleAt(a,t)}else this._willSettleAt(new n((function(t){return t(e)})),t)}else this._willSettleAt(r(e),t)},e.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===T&&(this._remaining--,2===e?I(r,n):this._result[t]=n),0===this._remaining&&j(r,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;O(e,void 0,(function(e){return n._settledAt(1,t,e)}),(function(e){return n._settledAt(2,t,e)}))},e}(),L=function(){function e(t){this[w]=P++,this._result=this._state=void 0,this._subscribers=[],S!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t((function(t){C(e,t)}),(function(t){I(e,t)}))}catch(t){I(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var n=this.constructor;return t(e)?this.then((function(t){return n.resolve(e()).then((function(){return t}))}),(function(t){return n.resolve(e()).then((function(){throw t}))})):this.then(e,e)},e}();return L.prototype.then=E,L.all=function(e){return new M(this,e).promise},L.race=function(e){var t=this;return n(e)?new t((function(n,r){for(var i=e.length,o=0;o<i;o++)t.resolve(e[o]).then(n,r)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},L.resolve=_,L.reject=function(e){var t=new this(S);return I(t,e),t},L._setScheduler=function(e){s=e},L._setAsap=function(e){a=e},L._asap=a,L.polyfill=function(){var e=void 0;if(void 0!==r.g)e=r.g;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=L},L.Promise=L,L}()},"./node_modules/events/events.js":e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}f(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&f(e,"error",t,{once:!0})}(e,i)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,n,r){var i,o,s,c;if(a(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=l(e))>0&&s.length>i&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,c=u,console&&console.warn&&console.warn(c)}return e}function u(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):h(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function h(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function f(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=o[e];if(void 0===l)return!1;if("function"==typeof l)r(l,this,t);else{var c=l.length,u=h(l,c);for(n=0;n<c;++n)r(u[n],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return a(t),this.on(e,u(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,u(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,r,i,o,s;if(a(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return d(this,e,!0)},o.prototype.rawListeners=function(e){return d(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},"./node_modules/fast-deep-equal/index.js":e=>{"use strict";var t=Array.isArray,n=Object.keys,r=Object.prototype.hasOwnProperty;e.exports=function e(i,o){if(i===o)return!0;if(i&&o&&"object"==typeof i&&"object"==typeof o){var s,a,l,c=t(i),u=t(o);if(c&&u){if((a=i.length)!=o.length)return!1;for(s=a;0!=s--;)if(!e(i[s],o[s]))return!1;return!0}if(c!=u)return!1;var d=i instanceof Date,p=o instanceof Date;if(d!=p)return!1;if(d&&p)return i.getTime()==o.getTime();var h=i instanceof RegExp,f=o instanceof RegExp;if(h!=f)return!1;if(h&&f)return i.toString()==o.toString();var g=n(i);if((a=g.length)!==n(o).length)return!1;for(s=a;0!=s--;)if(!r.call(o,g[s]))return!1;for(s=a;0!=s--;)if(!e(i[l=g[s]],o[l]))return!1;return!0}return i!=i&&o!=o}},"./node_modules/imsc/src/main/js/doc.js":(e,t,n)=>{!function(e,t,n,r,i){function o(e,t,n,r){var i=r&&"seq"===r.timeContainer,s=0;r&&(s=i&&n?n.end:r.begin),t.begin=t.explicit_begin?t.explicit_begin+s:s;var a=t.begin,l=null;for(var c in t.sets)o(e,t.sets[c],l,t),a="seq"===t.timeContainer?t.sets[c].end:Math.max(a,t.sets[c].end),l=t.sets[c];if("contents"in t)for(var u in t.contents)o(e,t.contents[u],l,t),a="seq"===t.timeContainer?t.contents[u].end:Math.max(a,t.contents[u].end),l=t.contents[u];else a=i?t.begin:Number.POSITIVE_INFINITY;null!==t.explicit_end&&null!==t.explicit_dur?t.end=Math.min(t.begin+t.explicit_dur,s+t.explicit_end):null===t.explicit_end&&null!==t.explicit_dur?t.end=t.begin+t.explicit_dur:null!==t.explicit_end&&null===t.explicit_dur?t.end=s+t.explicit_end:t.end=a,delete t.explicit_begin,delete t.explicit_dur,delete t.explicit_end,e._registerEvent(t)}function s(e){this.node=e}function a(){this.events=[],this.head=null,this.body=null}function l(){this.styling=null,this.layout=null}function c(){this.styles={}}function u(){this.id=null,this.styleAttrs=null,this.styleRefs=null}function d(){this.regions={}}function p(e){this.kind=e}function h(e){this.id=e}function f(e){this.regionID=e}function g(e){this.styleAttrs=e}function m(e){this.sets=e}function v(e){this.contents=e}function y(e,t,n){this.explicit_begin=e,this.explicit_end=t,this.explicit_dur=n}function b(){p.call(this,"body")}function x(){p.call(this,"div")}function E(){p.call(this,"p")}function _(){p.call(this,"span")}function w(){p.call(this,"span")}function S(){p.call(this,"br")}function T(){}function k(){}function C(e){return e&&"xml:id"in e.attributes&&e.attributes["xml:id"].value||null}function A(e){return e&&"style"in e.attributes?e.attributes.style.value.split(" "):[]}function j(e,t){var n={};if(null!==e)for(var i in e.attributes){var o=e.attributes[i].uri+" "+e.attributes[i].local,s=r.byQName[o];if(void 0!==s){var a=s.parse(e.attributes[i].value);null!==a?(n[o]=a,s===r.byName.zIndex&&D(t,"zIndex attribute present but not used by IMSC1 since regions do not overlap")):M(t,"Cannot parse styling attribute "+o+" --\x3e "+e.attributes[i].value)}}return n}function I(e,t,n){for(var r in e.attributes)if(e.attributes[r].uri===t&&e.attributes[r].local===n)return e.attributes[r].value;return null}function O(e,t,n){var r,i=null;return null!==(r=/^(\d+(?:\.\d+)?)f$/.exec(n))?null!==t&&(i=parseFloat(r[1])/t):null!==(r=/^(\d+(?:\.\d+)?)t$/.exec(n))?null!==e&&(i=parseFloat(r[1])/e):null!==(r=/^(\d+(?:\.\d+)?)ms$/.exec(n))?i=parseFloat(r[1])/1e3:null!==(r=/^(\d+(?:\.\d+)?)s$/.exec(n))?i=parseFloat(r[1]):null!==(r=/^(\d+(?:\.\d+)?)h$/.exec(n))?i=3600*parseFloat(r[1]):null!==(r=/^(\d+(?:\.\d+)?)m$/.exec(n))?i=60*parseFloat(r[1]):null!==(r=/^(\d{2,}):(\d\d):(\d\d(?:\.\d+)?)$/.exec(n))?i=3600*parseInt(r[1])+60*parseInt(r[2])+parseFloat(r[3]):null!==(r=/^(\d{2,}):(\d\d):(\d\d)\:(\d{2,})$/.exec(n))&&null!==t&&(i=3600*parseInt(r[1])+60*parseInt(r[2])+parseInt(r[3])+(null===r[4]?0:parseInt(r[4])/t)),i}function N(e,t,n){for(;t.styleRefs.length>0;){var r=t.styleRefs.pop();r in e.styles?(N(e,e.styles[r],n),P(e.styles[r].styleAttrs,t.styleAttrs)):M(n,"Non-existant style id referenced")}}function R(e,t,n,r){for(var i=t.length-1;i>=0;i--){var o=t[i];o in e.styles?P(e.styles[o].styleAttrs,n):M(r,"Non-existant style id referenced")}}function P(e,t){for(var n in e)n in t||(t[n]=e[n])}function D(e,t){if(e&&e.warn&&e.warn(t))throw t}function M(e,t){if(e&&e.error&&e.error(t))throw t}function L(e,t){throw e&&e.fatal&&e.fatal(t),t}function B(e,t){for(var n,r=0,i=e.length-1;r<=i;){var o=e[n=Math.floor((r+i)/2)];if(o<t)r=n+1;else{if(!(o>t))return{found:!0,index:n};i=n-1}}return{found:!1,index:r}}e.fromXML=function(e,r,i){var p=t.parser(!0,{xmlns:!0}),h=[],f=[],g=[],m=0,v=null;p.onclosetag=function(e){if(h[0]instanceof c)for(var t in h[0].styles)N(h[0],h[0].styles[t],r);else if(h[0]instanceof E||h[0]instanceof _){if(h[0].contents.length>1){var o,a=[h[0].contents[0]];for(o=1;o<h[0].contents.length;o++)h[0].contents[o]instanceof w&&a[a.length-1]instanceof w?a[a.length-1].text+=h[0].contents[o].text:a.push(h[0].contents[o]);h[0].contents=a}h[0]instanceof _&&1===h[0].contents.length&&h[0].contents[0]instanceof w&&(h[0].text=h[0].contents[0].text,delete h[0].contents)}else h[0]instanceof s&&(h[0].node.uri===n.ns_tt&&"metadata"===h[0].node.local?m--:m>0&&i&&"onCloseTag"in i&&i.onCloseTag());g.shift(),f.shift(),h.shift()},p.ontext=function(e){if(void 0===h[0]);else if(h[0]instanceof _||h[0]instanceof E){var t=new w;t.initFromText(v,h[0],e,g[0],r),h[0].contents.push(t)}else h[0]instanceof s&&m>0&&i&&"onText"in i&&i.onText(e)},p.onopentag=function(e){var t=e.attributes["xml:space"];t?g.unshift(t.value):0===g.length?g.unshift("default"):g.unshift(g[0]);var o=e.attributes["xml:lang"];if(o?f.unshift(o.value):0===f.length?f.unshift(""):f.unshift(f[0]),e.uri===n.ns_tt)if("tt"===e.local)null!==v&&L(r,"Two <tt> elements at ("+this.line+","+this.column+")"),(v=new a).initFromNode(e,r),h.unshift(v);else if("head"===e.local)h[0]instanceof a||L(r,"Parent of <head> element is not <tt> at ("+this.line+","+this.column+")"),null!==v.head&&L("Second <head> element at ("+this.line+","+this.column+")"),v.head=new l,h.unshift(v.head);else if("styling"===e.local)h[0]instanceof l||L(r,"Parent of <styling> element is not <head> at ("+this.line+","+this.column+")"),null!==v.head.styling&&L("Second <styling> element at ("+this.line+","+this.column+")"),v.head.styling=new c,h.unshift(v.head.styling);else if("style"===e.local){var p;h[0]instanceof c?((p=new u).initFromNode(e,r),p.id?v.head.styling.styles[p.id]=p:M(r,"<style> element missing @id attribute"),h.unshift(p)):h[0]instanceof T?((p=new u).initFromNode(e,r),P(p.styleAttrs,h[0].styleAttrs),h.unshift(p)):L(r,"Parent of <style> element is not <styling> or <region> at ("+this.line+","+this.column+")")}else if("layout"===e.local)h[0]instanceof l||L(r,"Parent of <layout> element is not <head> at "+this.line+","+this.column+")"),null!==v.head.layout&&L(r,"Second <layout> element at "+this.line+","+this.column+")"),v.head.layout=new d,h.unshift(v.head.layout);else if("region"===e.local){h[0]instanceof d||L(r,"Parent of <region> element is not <layout> at "+this.line+","+this.column+")");var y=new T;y.initFromNode(v,e,r),!y.id||y.id in v.head.layout.regions?M(r,"Ignoring <region> with duplicate or missing @id at "+this.line+","+this.column+")"):v.head.layout.regions[y.id]=y,h.unshift(y)}else if("body"===e.local){h[0]instanceof a||L(r,"Parent of <body> element is not <tt> at "+this.line+","+this.column+")"),null!==v.body&&L(r,"Second <body> element at "+this.line+","+this.column+")");var w=new b;w.initFromNode(v,e,r),v.body=w,h.unshift(w)}else if("div"===e.local){h[0]instanceof x||h[0]instanceof b||L(r,"Parent of <div> element is not <body> or <div> at "+this.line+","+this.column+")");var C=new x;C.initFromNode(v,h[0],e,r),h[0].contents.push(C),h.unshift(C)}else if("p"===e.local){h[0]instanceof x||L(r,"Parent of <p> element is not <div> at "+this.line+","+this.column+")");var A=new E;A.initFromNode(v,h[0],e,r),h[0].contents.push(A),h.unshift(A)}else if("span"===e.local){h[0]instanceof _||h[0]instanceof E||L(r,"Parent of <span> element is not <span> or <p> at "+this.line+","+this.column+")");var j=new _;j.initFromNode(v,h[0],e,g[0],r),h[0].contents.push(j),h.unshift(j)}else if("br"===e.local){h[0]instanceof _||h[0]instanceof E||L(r,"Parent of <br> element is not <span> or <p> at "+this.line+","+this.column+")");var I=new S;I.initFromNode(v,h[0],e,r),h[0].contents.push(I),h.unshift(I)}else if("set"===e.local){h[0]instanceof _||h[0]instanceof E||h[0]instanceof x||h[0]instanceof b||h[0]instanceof T||h[0]instanceof S||L(r,"Parent of <set> element is not a content element or a region at "+this.line+","+this.column+")");var O=new k;O.initFromNode(v,h[0],e,r),h[0].sets.push(O),h.unshift(O)}else h.unshift(new s(e));else h.unshift(new s(e));if(h[0]instanceof s)if(e.uri===n.ns_tt&&"metadata"===e.local)m++;else if(m>0&&i&&"onOpenTag"in i){var N=[];for(var R in e.attributes)N[e.attributes[R].uri+" "+e.attributes[R].local]={uri:e.attributes[R].uri,local:e.attributes[R].local,value:e.attributes[R].value};i.onOpenTag(e.uri,e.local,N)}},p.write(e).close(),null!==v.head?delete v.head.styling:v.head=new l,null===v.head.layout&&(v.head.layout=new d);var y=!1;for(var C in v.head.layout.regions){y=!0;break}if(!y){var A=T.prototype.createDefaultRegion();v.head.layout.regions[A.id]=A}for(var j in v.head.layout.regions)o(v,v.head.layout.regions[j],null,null);return v.body&&o(v,v.body,null,null),v},a.prototype.initFromNode=function(e,t){this.cellResolution=function(e,t){var r=I(e,n.ns_ttp,"cellResolution"),i=15,o=32;if(null!==r){var s=/(\d+) (\d+)/.exec(r);null!==s?(o=parseInt(s[1]),i=parseInt(s[2])):D(t,"Malformed cellResolution value (using initial value instead)")}return{w:o,h:i}}(e,t);var r=function(e,t){var r,i=I(e,n.ns_ttp,"frameRate"),o=30;null!==i&&(null!==(r=/(\d+)/.exec(i))?o=parseInt(r[1]):D(t,"Malformed frame rate attribute (using initial value instead)"));var s=I(e,n.ns_ttp,"frameRateMultiplier"),a=1;null!==s&&(null!==(r=/(\d+) (\d+)/.exec(s))?a=parseInt(r[1])/parseInt(r[2]):D(t,"Malformed frame rate multiplier attribute (using initial value instead)"));var l=a*o,c=1,u=I(e,n.ns_ttp,"tickRate");return null===u?null!==i&&(c=l):null!==(r=/(\d+)/.exec(u))?c=parseInt(r[1]):D(t,"Malformed tick rate attribute (using initial value instead)"),{effectiveFrameRate:l,tickRate:c}}(e,t);this.effectiveFrameRate=r.effectiveFrameRate,this.tickRate=r.tickRate,this.aspectRatio=function(e,t){var r=I(e,n.ns_ittp,"aspectRatio"),i=null;if(null!==r){var o=/(\d+) (\d+)/.exec(r);if(null!==o){var s=parseInt(o[1]),a=parseInt(o[2]);0!==s&&0!==a?i=s/a:M(t,"Illegal aspectRatio values (ignoring)")}else M(t,"Malformed aspectRatio attribute (ignoring)")}return i}(e,t);var o=I(e,n.ns_ttp,"timeBase");null!==o&&"media"!==o&&L(t,"Unsupported time base");var s=function(e,t){var r=I(e,n.ns_tts,"extent");if(null===r)return null;var o=r.split(" ");if(2!==o.length)return D(t,"Malformed extent (ignoring)"),null;var s=i.parseLength(o[0]),a=i.parseLength(o[1]);return a&&s?{h:a,w:s}:(D(t,"Malformed extent values (ignoring)"),null)}(e,t);null===s?this.pxDimensions={h:480,w:640}:("px"===s.h.unit&&"px"===s.w.unit||L(t,"Extent on TT must be in px or absent"),this.pxDimensions={h:s.h.value,w:s.w.value})},a.prototype._registerEvent=function(e){if(!(e.end<=e.begin)){var t=B(this.events,e.begin);if(t.found||this.events.splice(t.index,0,e.begin),e.end!==Number.POSITIVE_INFINITY){var n=B(this.events,e.end);n.found||this.events.splice(n.index,0,e.end)}}},a.prototype.getMediaTimeRange=function(){return[this.events[0],this.events[this.events.length-1]]},a.prototype.getMediaTimeEvents=function(){return this.events},u.prototype.initFromNode=function(e,t){this.id=C(e),this.styleAttrs=j(e,t),this.styleRefs=A(e)},h.prototype.initFromNode=function(e,t,n,r){this.id=C(n)},f.prototype.initFromNode=function(e,t,n,r){this.regionID=function(e){return e&&"region"in e.attributes?e.attributes.region.value:""}(n)},g.prototype.initFromNode=function(e,t,n,r){this.styleAttrs=j(n,r),null!==e.head&&null!==e.head.styling&&R(e.head.styling,A(n),this.styleAttrs,r)},m.prototype.initFromNode=function(e,t,n,r){this.sets=[]},v.prototype.initFromNode=function(e,t,n,r){this.contents=[]},y.prototype.initFromNode=function(e,t,n,r){var i=function(e,t,n,r){var i=null;n&&"begin"in n.attributes&&null===(i=O(e.tickRate,e.effectiveFrameRate,n.attributes.begin.value))&&D(r,"Malformed begin value "+n.attributes.begin.value+" (using 0)");var o=null;n&&"dur"in n.attributes&&null===(o=O(e.tickRate,e.effectiveFrameRate,n.attributes.dur.value))&&D(r,"Malformed dur value "+n.attributes.dur.value+" (ignoring)");var s=null;return n&&"end"in n.attributes&&null===(s=O(e.tickRate,e.effectiveFrameRate,n.attributes.end.value))&&D(r,"Malformed end value (ignoring)"),{explicit_begin:i,explicit_end:s,explicit_dur:o}}(e,0,n,r);this.explicit_begin=i.explicit_begin,this.explicit_end=i.explicit_end,this.explicit_dur=i.explicit_dur,this.timeContainer=function(e,t){var n=e&&"timeContainer"in e.attributes?e.attributes.timeContainer.value:null;return n&&"par"!==n?"seq"===n?"seq":(M(t,"Illegal value of timeContainer (assuming 'par')"),"par"):"par"}(n,r)},b.prototype.initFromNode=function(e,t,n){g.prototype.initFromNode.call(this,e,null,t,n),y.prototype.initFromNode.call(this,e,null,t,n),m.prototype.initFromNode.call(this,e,null,t,n),f.prototype.initFromNode.call(this,e,null,t,n),v.prototype.initFromNode.call(this,e,null,t,n)},x.prototype.initFromNode=function(e,t,n,r){g.prototype.initFromNode.call(this,e,t,n,r),y.prototype.initFromNode.call(this,e,t,n,r),m.prototype.initFromNode.call(this,e,t,n,r),f.prototype.initFromNode.call(this,e,t,n,r),v.prototype.initFromNode.call(this,e,t,n,r)},E.prototype.initFromNode=function(e,t,n,r){g.prototype.initFromNode.call(this,e,t,n,r),y.prototype.initFromNode.call(this,e,t,n,r),m.prototype.initFromNode.call(this,e,t,n,r),f.prototype.initFromNode.call(this,e,t,n,r),v.prototype.initFromNode.call(this,e,t,n,r)},_.prototype.initFromNode=function(e,t,n,r,i){g.prototype.initFromNode.call(this,e,t,n,i),y.prototype.initFromNode.call(this,e,t,n,i),m.prototype.initFromNode.call(this,e,t,n,i),f.prototype.initFromNode.call(this,e,t,n,i),v.prototype.initFromNode.call(this,e,t,n,i),this.space=r},w.prototype.initFromText=function(e,t,n,r,i){y.prototype.initFromNode.call(this,e,t,null,i),this.text=n,this.space=r},S.prototype.initFromNode=function(e,t,n,r){f.prototype.initFromNode.call(this,e,t,n,r),y.prototype.initFromNode.call(this,e,t,n,r)},T.prototype.createDefaultRegion=function(){var e=new T;return h.call(e,""),g.call(e,{}),m.call(e,[]),y.call(e,0,Number.POSITIVE_INFINITY,null),e},T.prototype.initFromNode=function(e,t,n){h.prototype.initFromNode.call(this,e,null,t,n),g.prototype.initFromNode.call(this,e,null,t,n),y.prototype.initFromNode.call(this,e,null,t,n),m.prototype.initFromNode.call(this,e,null,t,n),null!==e.head&&null!==e.head.styling&&R(e.head.styling,A(t),this.styleAttrs,n)},k.prototype.initFromNode=function(e,t,n,r){y.prototype.initFromNode.call(this,e,t,n,r);var i=j(n,r);for(var o in this.qname=null,this.value=null,i){if(this.qname){M(r,"More than one style specified on set");break}this.qname=o,this.value=i[o]}}}(t,"undefined"==typeof sax?n("./node_modules/sax/lib/sax.js"):sax,"undefined"==typeof imscNames?n("./node_modules/imsc/src/main/js/names.js"):imscNames,"undefined"==typeof imscStyles?n("./node_modules/imsc/src/main/js/styles.js"):imscStyles,"undefined"==typeof imscUtils?n("./node_modules/imsc/src/main/js/utils.js"):imscUtils)},"./node_modules/imsc/src/main/js/html.js":(e,t,n)=>{!function(e,t,n){function r(e,t,a){var c;if("region"===a.kind?(c=document.createElement("div")).style.position="absolute":"body"===a.kind||"div"===a.kind?c=document.createElement("div"):"p"===a.kind?c=document.createElement("p"):"span"===a.kind?c=document.createElement("span"):"br"===a.kind&&(c=document.createElement("br")),c){for(var u in c.style.margin="0",l){var d=l[u],p=a.styleAttrs[d.qname];void 0!==p&&null!==d.map&&d.map(e,c,a,p)}var h=c;if("region"===a.kind){var f=a.styleAttrs[n.byName.writingMode.qname];"lrtb"===f||"lr"===f?(e.ipd="lr",e.bpd="tb"):"rltb"===f||"rl"===f?(e.ipd="rl",e.bpd="tb"):"tblr"===f?(e.ipd="tb",e.bpd="lr"):"tbrl"!==f&&"tb"!==f||(e.ipd="tb",e.bpd="rl")}var g=a.styleAttrs[n.byName.linePadding.qname];if(g&&g>0){var m=Math.ceil(g*e.h)+"px";"tb"===e.bpd?(h.style.paddingLeft=m,h.style.paddingRight=m):(h.style.paddingTop=m,h.style.paddingBottom=m),e.lp=g}var v=a.styleAttrs[n.byName.multiRowAlign.qname];if(v&&"auto"!==v){var y=document.createElement("span");y.style.display="inline-block",y.style.textAlign=v,c.appendChild(y),h=y,e.mra=v}if(a.styleAttrs[n.byName.fillLineGap.qname]&&(e.flg=!0),"span"===a.kind&&a.text)if(e.lp||e.mra||e.flg)for(var b="",x=0;x<a.text.length;x++){b+=a.text.charAt(x);var E=a.text.charCodeAt(x);if(E<55296||E>56319||x===a.text.length){var _=document.createElement("span");_.textContent=b,c.appendChild(_),b=""}}else c.textContent=a.text;for(var w in t.appendChild(c),a.contents)r(e,h,a.contents[w]);var S=[];if((e.lp||e.mra||e.flg)&&"p"===a.kind&&(s(e,h,S,null),e.mra&&(function(e){for(var t=0;t<e.length-1;t++){var n=e[t].elements.length;if(0!==n&&!1===e[t].br){var r=document.createElement("br"),i=e[t].elements[n-1].node;i.parentElement.insertBefore(r,i.nextSibling)}}}(S),e.mra=null),e.lp&&(function(e,t,n){for(var r in e){var i=e[r].elements.length,o=e[r].elements[e[r].start_elem],s=e[r].elements[e[r].end_elem],a=Math.ceil(t)+"px",l="-"+Math.ceil(t)+"px";0!==i&&("lr"===n.ipd?(o.node.style.borderLeftColor=o.bgcolor||"#00000000",o.node.style.borderLeftStyle="solid",o.node.style.borderLeftWidth=a,o.node.style.marginLeft=l):"rl"===n.ipd?(o.node.style.borderRightColor=o.bgcolor||"#00000000",o.node.style.borderRightStyle="solid",o.node.style.borderRightWidth=a,o.node.style.marginRight=l):"tb"===n.ipd&&(o.node.style.borderTopColor=o.bgcolor||"#00000000",o.node.style.borderTopStyle="solid",o.node.style.borderTopWidth=a,o.node.style.marginTop=l),"lr"===n.ipd?(s.node.style.borderRightColor=s.bgcolor||"#00000000",s.node.style.borderRightStyle="solid",s.node.style.borderRightWidth=a,s.node.style.marginRight=l):"rl"===n.ipd?(s.node.style.borderLeftColor=s.bgcolor||"#00000000",s.node.style.borderLeftStyle="solid",s.node.style.borderLeftWidth=a,s.node.style.marginLeft=l):"tb"===n.ipd&&(s.node.style.borderBottomColor=s.bgcolor||"#00000000",s.node.style.borderBottomStyle="solid",s.node.style.borderBottomWidth=a,s.node.style.marginBottom=l))}}(S,e.lp*e.h,e),e.lp=null),e.flg)){var T=o(h.getBoundingClientRect(),e);!function(e,t,n,r){for(var i=Math.sign(n-t),o=0;o<=e.length;o++){var s,a,l;if(s=0===o?t:o===e.length?n:(e[o].before+e[o-1].after)/2,o>0)for(var c=0;c<e[o-1].elements.length;c++)null!==e[o-1].elements[c].bgcolor&&i*((l=e[o-1].elements[c]).after-s)<0&&(a=Math.ceil(Math.abs(s-l.after))+"px",l.node.style.backgroundColor=l.bgcolor,"lr"===r.bpd?l.node.style.paddingRight=a:"rl"===r.bpd?l.node.style.paddingLeft=a:"tb"===r.bpd&&(l.node.style.paddingBottom=a));if(o<e.length)for(var u=0;u<e[o].elements.length;u++)null!==(l=e[o].elements[u]).bgcolor&&i*(l.before-s)>0&&(a=Math.ceil(Math.abs(l.before-s))+"px",l.node.style.backgroundColor=l.bgcolor,"lr"===r.bpd?l.node.style.paddingLeft=a:"rl"===r.bpd?l.node.style.paddingRight=a:"tb"===r.bpd&&(l.node.style.paddingTop=a))}}(S,T.before,T.after,e),e.flg=null}if("region"===a.kind&&(s(e,h,S),"tb"===e.bpd&&e.enableRollUp&&a.contents.length>0&&"after"===a.styleAttrs[n.byName.displayAlign.qname])){var k=new i(""===a.id?"_":a.id,S);if(e.currentISDState[k.id]=k,e.previousISDState&&k.id in e.previousISDState&&e.previousISDState[k.id].plist.length>0&&k.plist.length>1&&k.plist[k.plist.length-2].text===e.previousISDState[k.id].plist[e.previousISDState[k.id].plist.length-1].text){var C=c.firstElementChild,A=k.plist[k.plist.length-1].after-k.plist[k.plist.length-1].before;C.style.bottom="-"+A+"px",C.style.transition="transform 0.4s",C.style.position="relative",C.style.transform="translateY(-"+A+"px)"}}}else!function(e,t){if(e&&e.error&&e.error(t))throw t}(e.errorHandler,"Error processing ISD element kind: "+a.kind)}function i(e,t){this.id=e,this.plist=t}function o(e,t){var n={before:null,after:null,start:null,end:null};return"tb"===t.bpd?(n.before=e.top,n.after=e.bottom,"lr"===t.ipd?(n.start=e.left,n.end=e.right):(n.start=e.right,n.end=e.left)):"lr"===t.bpd?(n.before=e.left,n.after=e.right,n.start=e.top,n.end=e.bottom):"rl"===t.bpd&&(n.before=e.right,n.after=e.left,n.start=e.top,n.end=e.bottom),n}function s(e,t,n,r){var i,a,l,c,u=t.style.backgroundColor||r;if(0===t.childElementCount)if("span"===t.localName){var d=t.getBoundingClientRect();if(0===d.height||0===d.width)return;var p=o(d,e);if(0!==n.length&&(i=p.before,a=p.after,l=n[n.length-1].before,a<(c=n[n.length-1].after)&&i>l||c<=a&&l>=i)){var h=Math.sign(p.after-p.before),f=Math.sign(p.end-p.start);h*(p.before-n[n.length-1].before)<0&&(n[n.length-1].before=p.before),h*(p.after-n[n.length-1].after)>0&&(n[n.length-1].after=p.after),f*(p.start-n[n.length-1].start)<0&&(n[n.length-1].start=p.start,n[n.length-1].start_elem=n[n.length-1].elements.length),f*(p.end-n[n.length-1].end)>0&&(n[n.length-1].end=p.end,n[n.length-1].end_elem=n[n.length-1].elements.length)}else n.push({before:p.before,after:p.after,start:p.start,end:p.end,start_elem:0,end_elem:0,elements:[],text:"",br:!1});n[n.length-1].text+=t.textContent,n[n.length-1].elements.push({node:t,bgcolor:u,before:p.before,after:p.after})}else"br"===t.localName&&0!==n.length&&(n[n.length-1].br=!0);else for(var g=t.firstChild;g;)g.nodeType===Node.ELEMENT_NODE&&s(e,g,n,u),g=g.nextSibling}function a(e,t){this.qname=e,this.map=t}e.render=function(e,t,n,i,o,s,a,l,c){var u=i||t.clientHeight,d=o||t.clientWidth;if(null!==e.aspectRatio){var p=u*e.aspectRatio;p>d?u=Math.round(d/e.aspectRatio):d=p}var h=document.createElement("div");h.style.position="relative",h.style.width=d+"px",h.style.height=u+"px",h.style.margin="auto",h.style.top=0,h.style.bottom=0,h.style.left=0,h.style.right=0,h.style.zIndex=0;var f={h:u,w:d,regionH:null,regionW:null,imgResolver:n,displayForcedOnlyMode:s||!1,isd:e,errorHandler:a,previousISDState:l,enableRollUp:c||!1,currentISDState:{},flg:null,lp:null,mra:null,ipd:null,bpd:null};for(var g in t.appendChild(h),e.contents)r(f,h,e.contents[g]);return f.currentISDState};var l=[new a("http://www.w3.org/ns/ttml#styling backgroundColor",(function(e,t,n,r){0!==r[3]&&(t.style.backgroundColor="rgba("+r[0].toString()+","+r[1].toString()+","+r[2].toString()+","+(r[3]/255).toString()+")")})),new a("http://www.w3.org/ns/ttml#styling color",(function(e,t,n,r){t.style.color="rgba("+r[0].toString()+","+r[1].toString()+","+r[2].toString()+","+(r[3]/255).toString()+")"})),new a("http://www.w3.org/ns/ttml#styling direction",(function(e,t,n,r){t.style.direction=r})),new a("http://www.w3.org/ns/ttml#styling display",(function(e,t,n,r){})),new a("http://www.w3.org/ns/ttml#styling displayAlign",(function(e,t,n,r){t.style.display="flex",t.style.flexDirection="column","before"===r?t.style.justifyContent="flex-start":"center"===r?t.style.justifyContent="center":"after"===r&&(t.style.justifyContent="flex-end")})),new a("http://www.w3.org/ns/ttml#styling extent",(function(e,t,n,r){e.regionH=r.h*e.h,e.regionW=r.w*e.w;var i=0,o=0,s=n.styleAttrs["http://www.w3.org/ns/ttml#styling padding"];s&&(i=(s[0]+s[2])*e.h,o=(s[1]+s[3])*e.w),t.style.height=e.regionH-i+"px",t.style.width=e.regionW-o+"px"})),new a("http://www.w3.org/ns/ttml#styling fontFamily",(function(e,t,n,r){var i=[];for(var o in r)"monospaceSerif"===r[o]?(i.push("Courier New"),i.push('"Liberation Mono"'),i.push("Courier"),i.push("monospace")):"proportionalSansSerif"===r[o]?(i.push("Arial"),i.push("Helvetica"),i.push('"Liberation Sans"'),i.push("sans-serif")):"monospace"===r[o]?i.push("monospace"):"sansSerif"===r[o]?i.push("sans-serif"):"serif"===r[o]?i.push("serif"):"monospaceSansSerif"===r[o]?(i.push("Consolas"),i.push("monospace")):"proportionalSerif"===r[o]?i.push("serif"):i.push(r[o]);t.style.fontFamily=i.join(",")})),new a("http://www.w3.org/ns/ttml#styling fontSize",(function(e,t,n,r){t.style.fontSize=r*e.h+"px"})),new a("http://www.w3.org/ns/ttml#styling fontStyle",(function(e,t,n,r){t.style.fontStyle=r})),new a("http://www.w3.org/ns/ttml#styling fontWeight",(function(e,t,n,r){t.style.fontWeight=r})),new a("http://www.w3.org/ns/ttml#styling lineHeight",(function(e,t,n,r){t.style.lineHeight="normal"===r?"normal":r*e.h+"px"})),new a("http://www.w3.org/ns/ttml#styling opacity",(function(e,t,n,r){t.style.opacity=r})),new a("http://www.w3.org/ns/ttml#styling origin",(function(e,t,n,r){t.style.top=r.h*e.h+"px",t.style.left=r.w*e.w+"px"})),new a("http://www.w3.org/ns/ttml#styling overflow",(function(e,t,n,r){t.style.overflow=r})),new a("http://www.w3.org/ns/ttml#styling padding",(function(e,t,n,r){var i=[];i[0]=r[0]*e.h+"px",i[1]=r[3]*e.w+"px",i[2]=r[2]*e.h+"px",i[3]=r[1]*e.w+"px",t.style.padding=i.join(" ")})),new a("http://www.w3.org/ns/ttml#styling showBackground",null),new a("http://www.w3.org/ns/ttml#styling textAlign",(function(e,t,r,i){var o,s=r.styleAttrs[n.byName.direction.qname];o="start"===i?"rtl"===s?"right":"left":"end"===i?"rtl"===s?"left":"right":i,t.style.textAlign=o})),new a("http://www.w3.org/ns/ttml#styling textDecoration",(function(e,t,n,r){t.style.textDecoration=r.join(" ").replace("lineThrough","line-through")})),new a("http://www.w3.org/ns/ttml#styling textOutline",(function(e,t,n,r){t.style.textShadow="none"===r?"":"rgba("+r.color[0].toString()+","+r.color[1].toString()+","+r.color[2].toString()+","+(r.color[3]/255).toString()+") 0px 0px "+r.thickness*e.h+"px"})),new a("http://www.w3.org/ns/ttml#styling unicodeBidi",(function(e,t,n,r){var i;i="bidiOverride"===r?"bidi-override":r,t.style.unicodeBidi=i})),new a("http://www.w3.org/ns/ttml#styling visibility",(function(e,t,n,r){t.style.visibility=r})),new a("http://www.w3.org/ns/ttml#styling wrapOption",(function(e,t,n,r){"wrap"===r?"preserve"===n.space?t.style.whiteSpace="pre-wrap":t.style.whiteSpace="normal":"preserve"===n.space?t.style.whiteSpace="pre":t.style.whiteSpace="noWrap"})),new a("http://www.w3.org/ns/ttml#styling writingMode",(function(e,t,n,r){"lrtb"===r||"lr"===r||"rltb"===r||"rl"===r?t.style.writingMode="horizontal-tb":"tblr"===r?t.style.writingMode="vertical-lr":"tbrl"!==r&&"tb"!==r||(t.style.writingMode="vertical-rl")})),new a("http://www.w3.org/ns/ttml#styling zIndex",(function(e,t,n,r){t.style.zIndex=r})),new a("http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt backgroundImage",(function(e,t,n,r){if(null!==e.imgResolver&&null!==r){var i=document.createElement("img"),o=e.imgResolver(r,i);o&&(i.src=o),i.height=e.regionH,i.width=e.regionW,t.appendChild(i)}})),new a("http://www.w3.org/ns/ttml/profile/imsc1#styling forcedDisplay",(function(e,t,n,r){e.displayForcedOnlyMode&&!1===r&&(t.style.visibility="hidden")}))],c={};for(var u in l)c[l[u].qname]=l[u]}(t,"undefined"==typeof imscNames?n("./node_modules/imsc/src/main/js/names.js"):imscNames,"undefined"==typeof imscStyles?n("./node_modules/imsc/src/main/js/styles.js"):imscStyles)},"./node_modules/imsc/src/main/js/isd.js":(e,t,n)=>{!function(e,t,n){function r(e,t,i,a,l,c,u,d,p){if(t<u.begin||t>=u.end)return null;var h="regionID"in u&&""!==u.regionID?u.regionID:c;if(null!==l&&h!==i.id&&(!("contents"in u)||"contents"in u&&0===u.contents.length||""!==h))return null;var f=new o(u);for(var g in u.sets)t<u.sets[g].begin||t>=u.sets[g].end||(f.styleAttrs[u.sets[g].qname]=u.sets[g].value);var m,v={};for(var y in f.styleAttrs)if(v[y]=!0,y===n.byName.writingMode.qname&&!(n.byName.direction.qname in f.styleAttrs)){var b=f.styleAttrs[y];"lrtb"===b||"lr"===b?f.styleAttrs[n.byName.direction.qname]="ltr":"rltb"!==b&&"rl"!==b||(f.styleAttrs[n.byName.direction.qname]="rtl")}if(null!==l)for(var x in n.all){var E=n.all[x];if(E.qname===n.byName.textDecoration.qname){var _=l.styleAttrs[E.qname],w=f.styleAttrs[E.qname],S=[];void 0===w?S=_:-1===w.indexOf("none")?((-1===w.indexOf("noUnderline")&&-1!==_.indexOf("underline")||-1!==w.indexOf("underline"))&&S.push("underline"),(-1===w.indexOf("noLineThrough")&&-1!==_.indexOf("lineThrough")||-1!==w.indexOf("lineThrough"))&&S.push("lineThrough"),(-1===w.indexOf("noOverline")&&-1!==_.indexOf("overline")||-1!==w.indexOf("overline"))&&S.push("overline")):S.push("none"),f.styleAttrs[E.qname]=S}else E.inherit&&E.qname in l.styleAttrs&&!(E.qname in f.styleAttrs)&&(f.styleAttrs[E.qname]=l.styleAttrs[E.qname])}for(var T in n.all){var k=n.all[T];k.qname in f.styleAttrs||("region"===f.kind||!1===k.inherit&&null!==k.initial)&&(f.styleAttrs[k.qname]=k.parse(k.initial),v[k.qname]=!0)}for(var C in n.all){var A=n.all[C];if(A.qname in v&&null!==A.compute){var j=A.compute(e,l,f,f.styleAttrs[A.qname],p);null!==j?f.styleAttrs[A.qname]=j:s(d,"Style '"+A.qname+"' on element '"+f.kind+"' cannot be computed")}}if("none"===f.styleAttrs[n.byName.display.qname])return null;for(var I in null===l?m=null===a?[]:[a]:"contents"in u&&(m=u.contents),m){var O=r(e,t,i,a,f,h,m[I],d,p);null!==O&&f.contents.push(O.element)}for(var N in f.styleAttrs)-1===n.byQName[N].applies.indexOf(f.kind)&&delete f.styleAttrs[N];if("span"===f.kind&&f.text&&"default"===f.space){var R=f.text.replace(/\s+/g," ");f.text=R}if("p"===f.kind){var P=[];!function e(t,n){if("contents"in t)for(var r in t.contents)e(t.contents[r],n);else n.push(t)}(f,P);for(var D=0,M="after_br",L=0;;)if("after_br"===M)D>=P.length||"br"===P[D].kind?(M="before_br",L=D,D--):("preserve"!==P[D].space&&(P[D].text=P[D].text.replace(/^\s+/g,"")),P[D].text.length>0?(M="looking_br",D++):P.splice(D,1));else if("before_br"===M)if(D<0||"br"===P[D].kind){if(M="after_br",(D=L+1)>=P.length)break}else if("preserve"!==P[D].space&&(P[D].text=P[D].text.replace(/\s+$/g,"")),P[D].text.length>0){if(M="after_br",(D=L+1)>=P.length)break}else P.splice(D,1),D--;else D>=P.length||"br"===P[D].kind?(M="before_br",L=D,D--):D++;!function e(t){if("br"===t.kind)return!1;if("text"in t)return 0===t.text.length;if("contents"in t){for(var n=t.contents.length;n--;)e(t.contents[n])&&t.contents.splice(n,1);return 0===t.contents.length}}(f)}return"div"===f.kind&&n.byName.backgroundImage.qname in f.styleAttrs||"br"===f.kind||"contents"in f&&f.contents.length>0||"span"===f.kind&&null!==f.text||"region"===f.kind&&"always"===f.styleAttrs[n.byName.showBackground.qname]?{region_id:h,element:f}:null}function i(e){this.contents=[],this.aspectRatio=e.aspectRatio}function o(e){for(var t in this.kind=e.kind||"region",e.id&&(this.id=e.id),this.styleAttrs={},e.styleAttrs)this.styleAttrs[t]=e.styleAttrs[t];"text"in e?this.text=e.text:"br"!==e.kind&&(this.contents=[]),"space"in e&&(this.space=e.space)}function s(e,t){if(e&&e.error&&e.error(t))throw t}e.generateISD=function(e,t,n){var o=new i(e),s={};for(var a in e.head.layout.regions){var l=r(e,t,e.head.layout.regions[a],e.body,null,"",e.head.layout.regions[a],n,s);null!==l&&o.contents.push(l.element)}return o}}(t,"undefined"==typeof imscNames?n("./node_modules/imsc/src/main/js/names.js"):imscNames,"undefined"==typeof imscStyles?n("./node_modules/imsc/src/main/js/styles.js"):imscStyles)},"./node_modules/imsc/src/main/js/main.js":(e,t,n)=>{t.generateISD=n("./node_modules/imsc/src/main/js/isd.js").generateISD,t.fromXML=n("./node_modules/imsc/src/main/js/doc.js").fromXML,t.renderHTML=n("./node_modules/imsc/src/main/js/html.js").render},"./node_modules/imsc/src/main/js/names.js":(e,t)=>{!function(e){e.ns_tt="http://www.w3.org/ns/ttml",e.ns_tts="http://www.w3.org/ns/ttml#styling",e.ns_ttp="http://www.w3.org/ns/ttml#parameter",e.ns_xml="http://www.w3.org/XML/1998/namespace",e.ns_itts="http://www.w3.org/ns/ttml/profile/imsc1#styling",e.ns_ittp="http://www.w3.org/ns/ttml/profile/imsc1#parameter",e.ns_smpte="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt",e.ns_ebutts="urn:ebu:tt:style"}(t)},"./node_modules/imsc/src/main/js/styles.js":(e,t,n)=>{!function(e,t,n){function r(e,t,n,r,i,o,s,a){this.name=t,this.ns=e,this.qname=e+" "+t,this.inherit=i,this.animatable=o,this.initial=n,this.applies=r,this.parse=s,this.compute=a}for(var i in e.all=[new r(t.ns_tts,"backgroundColor","transparent",["body","div","p","region","span"],!1,!0,n.parseColor,null),new r(t.ns_tts,"color","white",["span"],!0,!0,n.parseColor,null),new r(t.ns_tts,"direction","ltr",["p","span"],!0,!0,(function(e){return e}),null),new r(t.ns_tts,"display","auto",["body","div","p","region","span"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"displayAlign","before",["region"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"extent","auto",["tt","region"],!1,!0,(function(e){if("auto"===e)return e;var t=e.split(" ");if(2!==t.length)return null;var r=n.parseLength(t[0]),i=n.parseLength(t[1]);return i&&r?{h:i,w:r}:null}),(function(e,t,n,r,i){var o,s;if("auto"===r)o=1;else if("%"===r.h.unit)o=r.h.value/100;else{if("px"!==r.h.unit)return null;o=r.h.value/e.pxDimensions.h}if("auto"===r)s=1;else if("%"===r.w.unit)s=r.w.value/100;else{if("px"!==r.w.unit)return null;s=r.w.value/e.pxDimensions.w}return{h:o,w:s}})),new r(t.ns_tts,"fontFamily","default",["span"],!0,!0,(function(e){var t=e.split(","),n=[];for(var r in t)"'"!==t[r].charAt(0)&&'"'!==t[r].charAt(0)&&"default"===t[r]?n.push("monospaceSerif"):n.push(t[r]);return n}),null),new r(t.ns_tts,"fontSize","1c",["span"],!0,!0,n.parseLength,(function(t,n,r,i,o){var s;if("%"===i.unit)s=null!==n?n.styleAttrs[e.byName.fontSize.qname]*i.value/100:i.value/100/t.cellResolution.h;else if("em"===i.unit)s=null!==n?n.styleAttrs[e.byName.fontSize.qname]*i.value:i.value/t.cellResolution.h;else if("c"===i.unit)s=i.value/t.cellResolution.h;else{if("px"!==i.unit)return null;s=i.value/t.pxDimensions.h}return s})),new r(t.ns_tts,"fontStyle","normal",["span"],!0,!0,(function(e){return e}),null),new r(t.ns_tts,"fontWeight","normal",["span"],!0,!0,(function(e){return e}),null),new r(t.ns_tts,"lineHeight","normal",["p"],!0,!0,(function(e){return"normal"===e?e:n.parseLength(e)}),(function(t,n,r,i,o){var s;if("normal"===i)s=i;else if("%"===i.unit)s=r.styleAttrs[e.byName.fontSize.qname]*i.value/100;else if("em"===i.unit)s=r.styleAttrs[e.byName.fontSize.qname]*i.value;else if("c"===i.unit)s=i.value/t.cellResolution.h;else{if("px"!==i.unit)return null;s=i.value/t.pxDimensions.h}return s})),new r(t.ns_tts,"opacity",1,["region"],!1,!0,parseFloat,null),new r(t.ns_tts,"origin","auto",["region"],!1,!0,(function(e){if("auto"===e)return e;var t=e.split(" ");if(2!==t.length)return null;var r=n.parseLength(t[0]),i=n.parseLength(t[1]);return i&&r?{h:i,w:r}:null}),(function(e,t,n,r,i){var o,s;if("auto"===r)o=0;else if("%"===r.h.unit)o=r.h.value/100;else{if("px"!==r.h.unit)return null;o=r.h.value/e.pxDimensions.h}if("auto"===r)s=0;else if("%"===r.w.unit)s=r.w.value/100;else{if("px"!==r.w.unit)return null;s=r.w.value/e.pxDimensions.w}return{h:o,w:s}})),new r(t.ns_tts,"overflow","hidden",["region"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"padding","0px",["region"],!1,!0,(function(e){var t=e.split(" ");if(t.length>4)return null;var r=[];for(var i in t){var o=n.parseLength(t[i]);if(!o)return null;r.push(o)}return r}),(function(t,n,r,i,o){var s;if(1===i.length)s=[i[0],i[0],i[0],i[0]];else if(2===i.length)s=[i[0],i[1],i[0],i[1]];else if(3===i.length)s=[i[0],i[1],i[2],i[1]];else{if(4!==i.length)return null;s=[i[0],i[1],i[2],i[3]]}var a=r.styleAttrs[e.byName.writingMode.qname];if("lrtb"===a||"lr"===a)s=[s[0],s[3],s[2],s[1]];else if("rltb"===a||"rl"===a)s=[s[0],s[1],s[2],s[3]];else if("tblr"===a)s=[s[3],s[0],s[1],s[2]];else{if("tbrl"!==a&&"tb"!==a)return null;s=[s[3],s[2],s[1],s[0]]}var l=[];for(var c in s)if(0===s[c].value)l[c]=0;else if("%"===s[c].unit)l[c]="0"===c||"2"===c?r.styleAttrs[e.byName.extent.qname].h*s[c].value/100:r.styleAttrs[e.byName.extent.qname].w*s[c].value/100;else if("em"===s[c].unit)l[c]=r.styleAttrs[e.byName.fontSize.qname]*s[c].value;else if("c"===s[c].unit)l[c]=s[c].value/t.cellResolution.h;else{if("px"!==s[c].unit)return null;l[c]="0"===c||"2"===c?s[c].value/t.pxDimensions.h:s[c].value/t.pxDimensions.w}return l})),new r(t.ns_tts,"showBackground","always",["region"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"textAlign","start",["p"],!0,!0,(function(e){return e}),(function(e,t,n,r,i){return"left"===r?"start":"right"===r?"end":r})),new r(t.ns_tts,"textDecoration","none",["span"],!0,!0,(function(e){return e.split(" ")}),null),new r(t.ns_tts,"textOutline","none",["span"],!0,!0,(function(e){if("none"===e)return e;var t={},r=e.split(" ");if(0===r.length||r.length>2)return null;var i=n.parseColor(r[0]);if(t.color=i,null!==i&&r.shift(),1!==r.length)return null;var o=n.parseLength(r[0]);return o?(t.thickness=o,t):null}),(function(t,n,r,i,o){if("none"===i)return i;var s={};if(null===i.color?s.color=r.styleAttrs[e.byName.color.qname]:s.color=i.color,"%"===i.thickness.unit)s.thickness=r.styleAttrs[e.byName.fontSize.qname]*i.thickness.value/100;else if("em"===i.thickness.unit)s.thickness=r.styleAttrs[e.byName.fontSize.qname]*i.thickness.value;else if("c"===i.thickness.unit)s.thickness=i.thickness.value/t.cellResolution.h;else{if("px"!==i.thickness.unit)return null;s.thickness=i.thickness.value/t.pxDimensions.h}return s})),new r(t.ns_tts,"unicodeBidi","normal",["span","p"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"visibility","visible",["body","div","p","region","span"],!0,!0,(function(e){return e}),null),new r(t.ns_tts,"wrapOption","wrap",["span"],!0,!0,(function(e){return e}),null),new r(t.ns_tts,"writingMode","lrtb",["region"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"zIndex","auto",["region"],!1,!0,(function(e){var t;return"auto"===e?t=e:(t=parseInt(e),isNaN(t)&&(t=null)),t}),null),new r(t.ns_ebutts,"linePadding","0c",["p"],!0,!1,n.parseLength,(function(e,t,n,r,i){return"c"===r.unit?r.value/e.cellResolution.h:null})),new r(t.ns_ebutts,"multiRowAlign","auto",["p"],!0,!1,(function(e){return e}),null),new r(t.ns_smpte,"backgroundImage",null,["div"],!1,!1,(function(e){return e}),null),new r(t.ns_itts,"forcedDisplay","false",["body","div","p","region","span"],!0,!0,(function(e){return"true"===e}),null),new r(t.ns_itts,"fillLineGap","false",["p"],!0,!0,(function(e){return"true"===e}),null)],e.byQName={},e.all)e.byQName[e.all[i].qname]=e.all[i];for(var o in e.byName={},e.all)e.byName[e.all[o].name]=e.all[o]}(t,"undefined"==typeof imscNames?n("./node_modules/imsc/src/main/js/names.js"):imscNames,"undefined"==typeof imscUtils?n("./node_modules/imsc/src/main/js/utils.js"):imscUtils)},"./node_modules/imsc/src/main/js/utils.js":(e,t)=>{!function(e){var t=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/,n=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,r=/rgba\(\s*(\d+),\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,i={transparent:[0,0,0,0],black:[0,0,0,255],silver:[192,192,192,255],gray:[128,128,128,255],white:[255,255,255,255],maroon:[128,0,0,255],red:[255,0,0,255],purple:[128,0,128,255],fuchsia:[255,0,255,255],magenta:[255,0,255,255],green:[0,128,0,255],lime:[0,255,0,255],olive:[128,128,0,255],yellow:[255,255,0,255],navy:[0,0,128,255],blue:[0,0,255,255],teal:[0,128,128,255],aqua:[0,255,255,255],cyan:[0,255,255,255]};e.parseColor=function(e){var o,s=null,a=i[e.toLowerCase()];return void 0!==a?s=a:null!==(o=t.exec(e))?s=[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16),void 0!==o[4]?parseInt(o[4],16):255]:null!==(o=n.exec(e))?s=[parseInt(o[1]),parseInt(o[2]),parseInt(o[3]),255]:null!==(o=r.exec(e))&&(s=[parseInt(o[1]),parseInt(o[2]),parseInt(o[3]),parseInt(o[4])]),s};var o=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%)$/;e.parseLength=function(e){var t,n=null;return null!==(t=o.exec(e))&&(n={value:parseFloat(t[1]),unit:t[2]}),n}}(t)},"./node_modules/is-alphabetical/index.js":e=>{"use strict";e.exports=function(e){var t="string"==typeof e?e.charCodeAt(0):e;return t>=97&&t<=122||t>=65&&t<=90}},"./node_modules/is-alphanumerical/index.js":(e,t,n)=>{"use strict";var r=n("./node_modules/is-alphabetical/index.js"),i=n("./node_modules/is-decimal/index.js");e.exports=function(e){return r(e)||i(e)}},"./node_modules/is-decimal/index.js":e=>{"use strict";e.exports=function(e){var t="string"==typeof e?e.charCodeAt(0):e;return t>=48&&t<=57}},"./node_modules/path-browserify/index.js":t=>{"use strict";function n(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function r(e,t){for(var n,r="",i=0,o=-1,s=0,a=0;a<=e.length;++a){if(a<e.length)n=e.charCodeAt(a);else{if(47===n)break;n=47}if(47===n){if(o===a-1||1===s);else if(o!==a-1&&2===s){if(r.length<2||2!==i||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2))if(r.length>2){var l=r.lastIndexOf("/");if(l!==r.length-1){-1===l?(r="",i=0):i=(r=r.slice(0,l)).length-1-r.lastIndexOf("/"),o=a,s=0;continue}}else if(2===r.length||1===r.length){r="",i=0,o=a,s=0;continue}t&&(r.length>0?r+="/..":r="..",i=2)}else r.length>0?r+="/"+e.slice(o+1,a):r=e.slice(o+1,a),i=a-o-1;o=a,s=0}else 46===n&&-1!==s?++s:s=-1}return r}var i={resolve:function(){for(var t,i="",o=!1,s=arguments.length-1;s>=-1&&!o;s--){var a;s>=0?a=arguments[s]:(void 0===t&&(t=e.cwd()),a=t),n(a),0!==a.length&&(i=a+"/"+i,o=47===a.charCodeAt(0))}return i=r(i,!o),o?i.length>0?"/"+i:"/":i.length>0?i:"."},normalize:function(e){if(n(e),0===e.length)return".";var t=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return 0!==(e=r(e,!t)).length||t||(e="."),e.length>0&&i&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return n(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];n(r),r.length>0&&(void 0===e?e=r:e+="/"+r)}return void 0===e?".":i.normalize(e)},relative:function(e,t){if(n(e),n(t),e===t)return"";if((e=i.resolve(e))===(t=i.resolve(t)))return"";for(var r=1;r<e.length&&47===e.charCodeAt(r);++r);for(var o=e.length,s=o-r,a=1;a<t.length&&47===t.charCodeAt(a);++a);for(var l=t.length-a,c=s<l?s:l,u=-1,d=0;d<=c;++d){if(d===c){if(l>c){if(47===t.charCodeAt(a+d))return t.slice(a+d+1);if(0===d)return t.slice(a+d)}else s>c&&(47===e.charCodeAt(r+d)?u=d:0===d&&(u=0));break}var p=e.charCodeAt(r+d);if(p!==t.charCodeAt(a+d))break;47===p&&(u=d)}var h="";for(d=r+u+1;d<=o;++d)d!==o&&47!==e.charCodeAt(d)||(0===h.length?h+="..":h+="/..");return h.length>0?h+t.slice(a+u):(a+=u,47===t.charCodeAt(a)&&++a,t.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(n(e),0===e.length)return".";for(var t=e.charCodeAt(0),r=47===t,i=-1,o=!0,s=e.length-1;s>=1;--s)if(47===(t=e.charCodeAt(s))){if(!o){i=s;break}}else o=!1;return-1===i?r?"/":".":r&&1===i?"//":e.slice(0,i)},basename:function(e,t){if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string');n(e);var r,i=0,o=-1,s=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,l=-1;for(r=e.length-1;r>=0;--r){var c=e.charCodeAt(r);if(47===c){if(!s){i=r+1;break}}else-1===l&&(s=!1,l=r+1),a>=0&&(c===t.charCodeAt(a)?-1==--a&&(o=r):(a=-1,o=l))}return i===o?o=l:-1===o&&(o=e.length),e.slice(i,o)}for(r=e.length-1;r>=0;--r)if(47===e.charCodeAt(r)){if(!s){i=r+1;break}}else-1===o&&(s=!1,o=r+1);return-1===o?"":e.slice(i,o)},extname:function(e){n(e);for(var t=-1,r=0,i=-1,o=!0,s=0,a=e.length-1;a>=0;--a){var l=e.charCodeAt(a);if(47!==l)-1===i&&(o=!1,i=a+1),46===l?-1===t?t=a:1!==s&&(s=1):-1!==t&&(s=-1);else if(!o){r=a+1;break}}return-1===t||-1===i||0===s||1===s&&t===i-1&&t===r+1?"":e.slice(t,i)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var n=t.dir||t.root,r=t.base||(t.name||"")+(t.ext||"");return n?n===t.root?n+r:n+"/"+r:r}(0,e)},parse:function(e){n(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;var r,i=e.charCodeAt(0),o=47===i;o?(t.root="/",r=1):r=0;for(var s=-1,a=0,l=-1,c=!0,u=e.length-1,d=0;u>=r;--u)if(47!==(i=e.charCodeAt(u)))-1===l&&(c=!1,l=u+1),46===i?-1===s?s=u:1!==d&&(d=1):-1!==s&&(d=-1);else if(!c){a=u+1;break}return-1===s||-1===l||0===d||1===d&&s===l-1&&s===a+1?-1!==l&&(t.base=t.name=0===a&&o?e.slice(1,l):e.slice(a,l)):(0===a&&o?(t.name=e.slice(1,s),t.base=e.slice(1,l)):(t.name=e.slice(a,s),t.base=e.slice(a,l)),t.ext=e.slice(s,l)),a>0?t.dir=e.slice(0,a-1):o&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};i.posix=i,t.exports=i},"./node_modules/safe-buffer/index.js":(e,t,n)=>{var r=n("./node_modules/buffer/index.js"),i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(o(r,t),t.Buffer=s),o(i,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},"./node_modules/sax/lib/sax.js":(e,t,n)=>{!function(e){e.parser=function(e,t){return new o(e,t)},e.SAXParser=o,e.SAXStream=a,e.createStream=function(e,t){return new a(e,t)},e.MAX_BUFFER_LENGTH=65536;var t,i=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function o(t,n){if(!(this instanceof o))return new o(t,n);!function(e){for(var t=0,n=i.length;t<n;t++)e[i[t]]=""}(this),this.q=this.c="",this.bufferCheckPosition=e.MAX_BUFFER_LENGTH,this.opt=n||{},this.opt.lowercase=this.opt.lowercase||this.opt.lowercasetags,this.looseCase=this.opt.lowercase?"toLowerCase":"toUpperCase",this.tags=[],this.closed=this.closedRoot=this.sawRoot=!1,this.tag=this.error=null,this.strict=!!t,this.noscript=!(!t&&!this.opt.noscript),this.state=A.BEGIN,this.strictEntities=this.opt.strictEntities,this.ENTITIES=this.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),this.attribList=[],this.opt.xmlns&&(this.ns=Object.create(v)),this.trackPosition=!1!==this.opt.position,this.trackPosition&&(this.position=this.line=this.column=0),I(this,"onready")}e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),o.prototype={end:function(){D(this)},write:function(t){if(this.error)throw this.error;if(this.closed)return P(this,"Cannot write after close. Assign an onready handler.");if(null===t)return D(this);"object"==typeof t&&(t=t.toString());for(var n=0,r="";r=V(t,n++),this.c=r,r;)switch(this.trackPosition&&(this.position++,"\n"===r?(this.line++,this.column=0):this.column++),this.state){case A.BEGIN:if(this.state=A.BEGIN_WHITESPACE,"\ufeff"===r)continue;q(this,r);continue;case A.BEGIN_WHITESPACE:q(this,r);continue;case A.TEXT:if(this.sawRoot&&!this.closedRoot){for(var o=n-1;r&&"<"!==r&&"&"!==r;)(r=V(t,n++))&&this.trackPosition&&(this.position++,"\n"===r?(this.line++,this.column=0):this.column++);this.textNode+=t.substring(o,n-1)}"<"!==r||this.sawRoot&&this.closedRoot&&!this.strict?(!S(l,r)||this.sawRoot&&!this.closedRoot||M(this,"Text data outside of root node."),"&"===r?this.state=A.TEXT_ENTITY:this.textNode+=r):(this.state=A.OPEN_WAKA,this.startTagPosition=this.position);continue;case A.SCRIPT:"<"===r?this.state=A.SCRIPT_ENDING:this.script+=r;continue;case A.SCRIPT_ENDING:"/"===r?this.state=A.CLOSE_TAG:(this.script+="<"+r,this.state=A.SCRIPT);continue;case A.OPEN_WAKA:if("!"===r)this.state=A.SGML_DECL,this.sgmlDecl="";else if(w(l,r));else if(w(y,r))this.state=A.OPEN_TAG,this.tagName=r;else if("/"===r)this.state=A.CLOSE_TAG,this.tagName="";else if("?"===r)this.state=A.PROC_INST,this.procInstName=this.procInstBody="";else{if(M(this,"Unencoded <"),this.startTagPosition+1<this.position){var s=this.position-this.startTagPosition;r=new Array(s).join(" ")+r}this.textNode+="<"+r,this.state=A.TEXT}continue;case A.SGML_DECL:(this.sgmlDecl+r).toUpperCase()===h?(O(this,"onopencdata"),this.state=A.CDATA,this.sgmlDecl="",this.cdata=""):this.sgmlDecl+r==="--"?(this.state=A.COMMENT,this.comment="",this.sgmlDecl=""):(this.sgmlDecl+r).toUpperCase()===f?(this.state=A.DOCTYPE,(this.doctype||this.sawRoot)&&M(this,"Inappropriately located doctype declaration"),this.doctype="",this.sgmlDecl=""):">"===r?(O(this,"onsgmldeclaration",this.sgmlDecl),this.sgmlDecl="",this.state=A.TEXT):w(d,r)?(this.state=A.SGML_DECL_QUOTED,this.sgmlDecl+=r):this.sgmlDecl+=r;continue;case A.SGML_DECL_QUOTED:r===this.q&&(this.state=A.SGML_DECL,this.q=""),this.sgmlDecl+=r;continue;case A.DOCTYPE:">"===r?(this.state=A.TEXT,O(this,"ondoctype",this.doctype),this.doctype=!0):(this.doctype+=r,"["===r?this.state=A.DOCTYPE_DTD:w(d,r)&&(this.state=A.DOCTYPE_QUOTED,this.q=r));continue;case A.DOCTYPE_QUOTED:this.doctype+=r,r===this.q&&(this.q="",this.state=A.DOCTYPE);continue;case A.DOCTYPE_DTD:this.doctype+=r,"]"===r?this.state=A.DOCTYPE:w(d,r)&&(this.state=A.DOCTYPE_DTD_QUOTED,this.q=r);continue;case A.DOCTYPE_DTD_QUOTED:this.doctype+=r,r===this.q&&(this.state=A.DOCTYPE_DTD,this.q="");continue;case A.COMMENT:"-"===r?this.state=A.COMMENT_ENDING:this.comment+=r;continue;case A.COMMENT_ENDING:"-"===r?(this.state=A.COMMENT_ENDED,this.comment=R(this.opt,this.comment),this.comment&&O(this,"oncomment",this.comment),this.comment=""):(this.comment+="-"+r,this.state=A.COMMENT);continue;case A.COMMENT_ENDED:">"!==r?(M(this,"Malformed comment"),this.comment+="--"+r,this.state=A.COMMENT):this.state=A.TEXT;continue;case A.CDATA:"]"===r?this.state=A.CDATA_ENDING:this.cdata+=r;continue;case A.CDATA_ENDING:"]"===r?this.state=A.CDATA_ENDING_2:(this.cdata+="]"+r,this.state=A.CDATA);continue;case A.CDATA_ENDING_2:">"===r?(this.cdata&&O(this,"oncdata",this.cdata),O(this,"onclosecdata"),this.cdata="",this.state=A.TEXT):"]"===r?this.cdata+="]":(this.cdata+="]]"+r,this.state=A.CDATA);continue;case A.PROC_INST:"?"===r?this.state=A.PROC_INST_ENDING:w(l,r)?this.state=A.PROC_INST_BODY:this.procInstName+=r;continue;case A.PROC_INST_BODY:if(!this.procInstBody&&w(l,r))continue;"?"===r?this.state=A.PROC_INST_ENDING:this.procInstBody+=r;continue;case A.PROC_INST_ENDING:">"===r?(O(this,"onprocessinginstruction",{name:this.procInstName,body:this.procInstBody}),this.procInstName=this.procInstBody="",this.state=A.TEXT):(this.procInstBody+="?"+r,this.state=A.PROC_INST_BODY);continue;case A.OPEN_TAG:w(b,r)?this.tagName+=r:(L(this),">"===r?U(this):"/"===r?this.state=A.OPEN_TAG_SLASH:(S(l,r)&&M(this,"Invalid character in tag name"),this.state=A.ATTRIB));continue;case A.OPEN_TAG_SLASH:">"===r?(U(this,!0),H(this)):(M(this,"Forward-slash in opening tag not followed by >"),this.state=A.ATTRIB);continue;case A.ATTRIB:if(w(l,r))continue;">"===r?U(this):"/"===r?this.state=A.OPEN_TAG_SLASH:w(y,r)?(this.attribName=r,this.attribValue="",this.state=A.ATTRIB_NAME):M(this,"Invalid attribute name");continue;case A.ATTRIB_NAME:"="===r?this.state=A.ATTRIB_VALUE:">"===r?(M(this,"Attribute without value"),this.attribValue=this.attribName,F(this),U(this)):w(l,r)?this.state=A.ATTRIB_NAME_SAW_WHITE:w(b,r)?this.attribName+=r:M(this,"Invalid attribute name");continue;case A.ATTRIB_NAME_SAW_WHITE:if("="===r)this.state=A.ATTRIB_VALUE;else{if(w(l,r))continue;M(this,"Attribute without value"),this.tag.attributes[this.attribName]="",this.attribValue="",O(this,"onattribute",{name:this.attribName,value:""}),this.attribName="",">"===r?U(this):w(y,r)?(this.attribName=r,this.state=A.ATTRIB_NAME):(M(this,"Invalid attribute name"),this.state=A.ATTRIB)}continue;case A.ATTRIB_VALUE:if(w(l,r))continue;w(d,r)?(this.q=r,this.state=A.ATTRIB_VALUE_QUOTED):(M(this,"Unquoted attribute value"),this.state=A.ATTRIB_VALUE_UNQUOTED,this.attribValue=r);continue;case A.ATTRIB_VALUE_QUOTED:if(r!==this.q){"&"===r?this.state=A.ATTRIB_VALUE_ENTITY_Q:this.attribValue+=r;continue}F(this),this.q="",this.state=A.ATTRIB_VALUE_CLOSED;continue;case A.ATTRIB_VALUE_CLOSED:w(l,r)?this.state=A.ATTRIB:">"===r?U(this):"/"===r?this.state=A.OPEN_TAG_SLASH:w(y,r)?(M(this,"No whitespace between attributes"),this.attribName=r,this.attribValue="",this.state=A.ATTRIB_NAME):M(this,"Invalid attribute name");continue;case A.ATTRIB_VALUE_UNQUOTED:if(S(p,r)){"&"===r?this.state=A.ATTRIB_VALUE_ENTITY_U:this.attribValue+=r;continue}F(this),">"===r?U(this):this.state=A.ATTRIB;continue;case A.CLOSE_TAG:if(this.tagName)">"===r?H(this):w(b,r)?this.tagName+=r:this.script?(this.script+="</"+this.tagName,this.tagName="",this.state=A.SCRIPT):(S(l,r)&&M(this,"Invalid tagname in closing tag"),this.state=A.CLOSE_TAG_SAW_WHITE);else{if(w(l,r))continue;S(y,r)?this.script?(this.script+="</"+r,this.state=A.SCRIPT):M(this,"Invalid tagname in closing tag."):this.tagName=r}continue;case A.CLOSE_TAG_SAW_WHITE:if(w(l,r))continue;">"===r?H(this):M(this,"Invalid characters in closing tag");continue;case A.TEXT_ENTITY:case A.ATTRIB_VALUE_ENTITY_Q:case A.ATTRIB_VALUE_ENTITY_U:var a,c;switch(this.state){case A.TEXT_ENTITY:a=A.TEXT,c="textNode";break;case A.ATTRIB_VALUE_ENTITY_Q:a=A.ATTRIB_VALUE_QUOTED,c="attribValue";break;case A.ATTRIB_VALUE_ENTITY_U:a=A.ATTRIB_VALUE_UNQUOTED,c="attribValue"}";"===r?(this[c]+=G(this),this.entity="",this.state=a):w(this.entity.length?E:x,r)?this.entity+=r:(M(this,"Invalid character in entity name"),this[c]+="&"+this.entity+r,this.entity="",this.state=a);continue;default:throw new Error(this,"Unknown state: "+this.state)}return this.position>=this.bufferCheckPosition&&function(t){for(var n=Math.max(e.MAX_BUFFER_LENGTH,10),r=0,o=0,s=i.length;o<s;o++){var a=t[i[o]].length;if(a>n)switch(i[o]){case"textNode":N(t);break;case"cdata":O(t,"oncdata",t.cdata),t.cdata="";break;case"script":O(t,"onscript",t.script),t.script="";break;default:P(t,"Max buffer length exceeded: "+i[o])}r=Math.max(r,a)}var l=e.MAX_BUFFER_LENGTH-r;t.bufferCheckPosition=l+t.position}(this),this},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var e;N(e=this),""!==e.cdata&&(O(e,"oncdata",e.cdata),e.cdata=""),""!==e.script&&(O(e,"onscript",e.script),e.script="")}};try{t=n("./node_modules/stream-browserify/index.js").Stream}catch(e){t=function(){}}var s=e.EVENTS.filter((function(e){return"error"!==e&&"end"!==e}));function a(e,n){if(!(this instanceof a))return new a(e,n);t.apply(this),this._parser=new o(e,n),this.writable=!0,this.readable=!0;var r=this;this._parser.onend=function(){r.emit("end")},this._parser.onerror=function(e){r.emit("error",e),r._parser.error=null},this._decoder=null,s.forEach((function(e){Object.defineProperty(r,"on"+e,{get:function(){return r._parser["on"+e]},set:function(t){if(!t)return r.removeAllListeners(e),r._parser["on"+e]=t,t;r.on(e,t)},enumerable:!0,configurable:!1})}))}a.prototype=Object.create(t.prototype,{constructor:{value:a}}),a.prototype.write=function(e){if("function"==typeof r&&"function"==typeof r.isBuffer&&r.isBuffer(e)){if(!this._decoder){var t=n("./node_modules/string_decoder/lib/string_decoder.js").StringDecoder;this._decoder=new t("utf8")}e=this._decoder.write(e)}return this._parser.write(e.toString()),this.emit("data",e),!0},a.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},a.prototype.on=function(e,n){var r=this;return r._parser["on"+e]||-1===s.indexOf(e)||(r._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),r.emit.apply(r,t)}),t.prototype.on.call(r,e,n)};var l="\r\n\t ",c="0124356789",u="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",d="'\"",p=l+">",h="[CDATA[",f="DOCTYPE",g="http://www.w3.org/XML/1998/namespace",m="http://www.w3.org/2000/xmlns/",v={xml:g,xmlns:m};l=_(l),c=_(c),u=_(u);var y=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,b=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/,x=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,E=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;function _(e){return e.split("").reduce((function(e,t){return e[t]=!0,e}),{})}function w(e,t){return function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}(e)?!!t.match(e):e[t]}function S(e,t){return!w(e,t)}d=_(d),p=_(p);var T,k,C,A=0;for(var j in e.STATE={BEGIN:A++,BEGIN_WHITESPACE:A++,TEXT:A++,TEXT_ENTITY:A++,OPEN_WAKA:A++,SGML_DECL:A++,SGML_DECL_QUOTED:A++,DOCTYPE:A++,DOCTYPE_QUOTED:A++,DOCTYPE_DTD:A++,DOCTYPE_DTD_QUOTED:A++,COMMENT_STARTING:A++,COMMENT:A++,COMMENT_ENDING:A++,COMMENT_ENDED:A++,CDATA:A++,CDATA_ENDING:A++,CDATA_ENDING_2:A++,PROC_INST:A++,PROC_INST_BODY:A++,PROC_INST_ENDING:A++,OPEN_TAG:A++,OPEN_TAG_SLASH:A++,ATTRIB:A++,ATTRIB_NAME:A++,ATTRIB_NAME_SAW_WHITE:A++,ATTRIB_VALUE:A++,ATTRIB_VALUE_QUOTED:A++,ATTRIB_VALUE_CLOSED:A++,ATTRIB_VALUE_UNQUOTED:A++,ATTRIB_VALUE_ENTITY_Q:A++,ATTRIB_VALUE_ENTITY_U:A++,CLOSE_TAG:A++,CLOSE_TAG_SAW_WHITE:A++,SCRIPT:A++,SCRIPT_ENDING:A++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach((function(t){var n=e.ENTITIES[t],r="number"==typeof n?String.fromCharCode(n):n;e.ENTITIES[t]=r})),e.STATE)e.STATE[e.STATE[j]]=j;function I(e,t,n){e[t]&&e[t](n)}function O(e,t,n){e.textNode&&N(e),I(e,t,n)}function N(e){e.textNode=R(e.opt,e.textNode),e.textNode&&I(e,"ontext",e.textNode),e.textNode=""}function R(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function P(e,t){return N(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,I(e,"onerror",t),e}function D(e){return e.sawRoot&&!e.closedRoot&&M(e,"Unclosed root tag"),e.state!==A.BEGIN&&e.state!==A.BEGIN_WHITESPACE&&e.state!==A.TEXT&&P(e,"Unexpected end"),N(e),e.c="",e.closed=!0,I(e,"onend"),o.call(e,e.strict,e.opt),e}function M(e,t){if("object"!=typeof e||!(e instanceof o))throw new Error("bad call to strictFail");e.strict&&P(e,t)}function L(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,n=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(n.ns=t.ns),e.attribList.length=0,O(e,"onopentagstart",n)}function B(e,t){var n=e.indexOf(":")<0?["",e]:e.split(":"),r=n[0],i=n[1];return t&&"xmlns"===e&&(r="xmlns",i=""),{prefix:r,local:i}}function F(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName))e.attribName=e.attribValue="";else{if(e.opt.xmlns){var t=B(e.attribName,!0),n=t.prefix,r=t.local;if("xmlns"===n)if("xml"===r&&e.attribValue!==g)M(e,"xml: prefix must be bound to "+g+"\nActual: "+e.attribValue);else if("xmlns"===r&&e.attribValue!==m)M(e,"xmlns: prefix must be bound to "+m+"\nActual: "+e.attribValue);else{var i=e.tag,o=e.tags[e.tags.length-1]||e;i.ns===o.ns&&(i.ns=Object.create(o.ns)),i.ns[r]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,O(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}}function U(e,t){if(e.opt.xmlns){var n=e.tag,r=B(e.tagName);n.prefix=r.prefix,n.local=r.local,n.uri=n.ns[r.prefix]||"",n.prefix&&!n.uri&&(M(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),n.uri=r.prefix);var i=e.tags[e.tags.length-1]||e;n.ns&&i.ns!==n.ns&&Object.keys(n.ns).forEach((function(t){O(e,"onopennamespace",{prefix:t,uri:n.ns[t]})}));for(var o=0,s=e.attribList.length;o<s;o++){var a=e.attribList[o],l=a[0],c=a[1],u=B(l,!0),d=u.prefix,p=u.local,h=""===d?"":n.ns[d]||"",f={name:l,value:c,prefix:d,local:p,uri:h};d&&"xmlns"!==d&&!h&&(M(e,"Unbound namespace prefix: "+JSON.stringify(d)),f.uri=d),e.tag.attributes[l]=f,O(e,"onattribute",f)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),O(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=A.TEXT:e.state=A.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function H(e){if(!e.tagName)return M(e,"Weird empty close tag."),e.textNode+="</>",void(e.state=A.TEXT);if(e.script){if("script"!==e.tagName)return e.script+="</"+e.tagName+">",e.tagName="",void(e.state=A.SCRIPT);O(e,"onscript",e.script),e.script=""}var t=e.tags.length,n=e.tagName;e.strict||(n=n[e.looseCase]());for(var r=n;t--&&e.tags[t].name!==r;)M(e,"Unexpected close tag");if(t<0)return M(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",void(e.state=A.TEXT);e.tagName=n;for(var i=e.tags.length;i-- >t;){var o=e.tag=e.tags.pop();e.tagName=e.tag.name,O(e,"onclosetag",e.tagName);var s={};for(var a in o.ns)s[a]=o.ns[a];var l=e.tags[e.tags.length-1]||e;e.opt.xmlns&&o.ns!==l.ns&&Object.keys(o.ns).forEach((function(t){var n=o.ns[t];O(e,"onclosenamespace",{prefix:t,uri:n})}))}0===t&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=A.TEXT}function G(e){var t,n=e.entity,r=n.toLowerCase(),i="";return e.ENTITIES[n]?e.ENTITIES[n]:e.ENTITIES[r]?e.ENTITIES[r]:("#"===(n=r).charAt(0)&&("x"===n.charAt(1)?(n=n.slice(2),i=(t=parseInt(n,16)).toString(16)):(n=n.slice(1),i=(t=parseInt(n,10)).toString(10))),n=n.replace(/^0+/,""),i.toLowerCase()!==n?(M(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t))}function q(e,t){"<"===t?(e.state=A.OPEN_WAKA,e.startTagPosition=e.position):S(l,t)&&(M(e,"Non-whitespace before first tag."),e.textNode=t,e.state=A.TEXT)}function V(e,t){var n="";return t<e.length&&(n=e.charAt(t)),n}A=e.STATE,String.fromCodePoint||(T=String.fromCharCode,k=Math.floor,C=function(){var e,t,n=[],r=-1,i=arguments.length;if(!i)return"";for(var o="";++r<i;){var s=Number(arguments[r]);if(!isFinite(s)||s<0||s>1114111||k(s)!==s)throw RangeError("Invalid code point: "+s);s<=65535?n.push(s):(e=55296+((s-=65536)>>10),t=s%1024+56320,n.push(e,t)),(r+1===i||n.length>16384)&&(o+=T.apply(null,n),n.length=0)}return o},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:C,configurable:!0,writable:!0}):String.fromCodePoint=C)}(t)},"./node_modules/stream-browserify/index.js":(e,t,n)=>{e.exports=i;var r=n("./node_modules/events/events.js").EventEmitter;function i(){r.call(this)}n("./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js")(i,r),i.Readable=n("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_readable.js"),i.Writable=n("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_writable.js"),i.Duplex=n("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js"),i.Transform=n("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_transform.js"),i.PassThrough=n("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_passthrough.js"),i.finished=n("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/end-of-stream.js"),i.pipeline=n("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/pipeline.js"),i.Stream=i,i.prototype.pipe=function(e,t){var n=this;function i(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function o(){n.readable&&n.resume&&n.resume()}n.on("data",i),e.on("drain",o),e._isStdio||t&&!1===t.end||(n.on("end",a),n.on("close",l));var s=!1;function a(){s||(s=!0,e.end())}function l(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(u(),0===r.listenerCount(this,"error"))throw e}function u(){n.removeListener("data",i),e.removeListener("drain",o),n.removeListener("end",a),n.removeListener("close",l),n.removeListener("error",c),e.removeListener("error",c),n.removeListener("end",u),n.removeListener("close",u),e.removeListener("close",u)}return n.on("error",c),e.on("error",c),n.on("end",u),n.on("close",u),e.on("close",u),e.emit("pipe",n),e}},"./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js":e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},"./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js":e=>{"use strict";var t={};function n(e,n,r){r||(r=Error);var i=function(e){var t,r;function i(t,r,i){return e.call(this,function(e,t,r){return"string"==typeof n?n:n(e,t,r)}(t,r,i))||this}return r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,i}(r);i.prototype.name=r.name,i.prototype.code=e,t[e]=i}function r(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map((function(e){return String(e)})),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}n("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),n("ERR_INVALID_ARG_TYPE",(function(e,t,n){var i,o,s;if("string"==typeof t&&(o="not ",t.substr(0,o.length)===o)?(i="must not be",t=t.replace(/^not /,"")):i="must be",function(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))s="The ".concat(e," ").concat(i," ").concat(r(t,"type"));else{var a=function(e,t,n){return"number"!=typeof n&&(n=0),!(n+".".length>e.length)&&-1!==e.indexOf(".",n)}(e)?"property":"argument";s='The "'.concat(e,'" ').concat(a," ").concat(i," ").concat(r(t,"type"))}return s+". Received type ".concat(typeof n)}),TypeError),n("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),n("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),n("ERR_STREAM_PREMATURE_CLOSE","Premature close"),n("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),n("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),n("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),n("ERR_STREAM_WRITE_AFTER_END","write after end"),n("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),n("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),n("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.codes=t},"./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js":(t,n,r)=>{"use strict";var i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=u;var o=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_readable.js"),s=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_writable.js");r("./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js")(u,o);for(var a=i(s.prototype),l=0;l<a.length;l++){var c=a[l];u.prototype[c]||(u.prototype[c]=s.prototype[c])}function u(e){if(!(this instanceof u))return new u(e);o.call(this,e),s.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",d)))}function d(){this._writableState.ended||e.nextTick(p,this)}function p(e){e.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(u.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(u.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},"./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_passthrough.js":(e,t,n)=>{"use strict";e.exports=i;var r=n("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_transform.js");function i(e){if(!(this instanceof i))return new i(e);r.call(this,e)}n("./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js")(i,r),i.prototype._transform=function(e,t,n){n(null,e)}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_readable.js":(t,n,r)=>{"use strict";var i;t.exports=T,T.ReadableState=S,r("./node_modules/events/events.js").EventEmitter;var o,s=function(e,t){return e.listeners(t).length},a=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/stream-browser.js"),l=r("./node_modules/buffer/index.js").Buffer,c=r.g.Uint8Array||function(){},u=r("?19e6");o=u&&u.debuglog?u.debuglog("stream"):function(){};var d,p,h,f=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/buffer_list.js"),g=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/destroy.js"),m=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/state.js").getHighWaterMark,v=r("./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js").codes,y=v.ERR_INVALID_ARG_TYPE,b=v.ERR_STREAM_PUSH_AFTER_EOF,x=v.ERR_METHOD_NOT_IMPLEMENTED,E=v.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;r("./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js")(T,a);var _=g.errorOrDestroy,w=["error","close","destroy","pause","resume"];function S(e,t,n){i=i||r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js"),e=e||{},"boolean"!=typeof n&&(n=t instanceof i),this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=m(this,e,"readableHighWaterMark",n),this.buffer=new f,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(d||(d=r("./node_modules/string_decoder/lib/string_decoder.js").StringDecoder),this.decoder=new d(e.encoding),this.encoding=e.encoding)}function T(e){if(i=i||r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js"),!(this instanceof T))return new T(e);var t=this instanceof i;this._readableState=new S(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),a.call(this)}function k(e,t,n,r,i){o("readableAddChunk",t);var s,a=e._readableState;if(null===t)a.reading=!1,function(e,t){if(o("onEofChunk"),!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?I(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,O(e)))}}(e,a);else if(i||(s=function(e,t){var n,r;return r=t,l.isBuffer(r)||r instanceof c||"string"==typeof t||void 0===t||e.objectMode||(n=new y("chunk",["string","Buffer","Uint8Array"],t)),n}(a,t)),s)_(e,s);else if(a.objectMode||t&&t.length>0)if("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===l.prototype||(t=function(e){return l.from(e)}(t)),r)a.endEmitted?_(e,new E):C(e,a,t,!0);else if(a.ended)_(e,new b);else{if(a.destroyed)return!1;a.reading=!1,a.decoder&&!n?(t=a.decoder.write(t),a.objectMode||0!==t.length?C(e,a,t,!1):N(e,a)):C(e,a,t,!1)}else r||(a.reading=!1,N(e,a));return!a.ended&&(a.length<a.highWaterMark||0===a.length)}function C(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&I(e)),N(e,t)}Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),T.prototype.destroy=g.destroy,T.prototype._undestroy=g.undestroy,T.prototype._destroy=function(e,t){t(e)},T.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=l.from(e,t),t=""),n=!0),k(this,e,t,!1,n)},T.prototype.unshift=function(e){return k(this,e,null,!0,!1)},T.prototype.isPaused=function(){return!1===this._readableState.flowing},T.prototype.setEncoding=function(e){d||(d=r("./node_modules/string_decoder/lib/string_decoder.js").StringDecoder);var t=new d(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var n=this._readableState.buffer.head,i="";null!==n;)i+=t.write(n.data),n=n.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var A=1073741824;function j(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=A?e=A:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function I(t){var n=t._readableState;o("emitReadable",n.needReadable,n.emittedReadable),n.needReadable=!1,n.emittedReadable||(o("emitReadable",n.flowing),n.emittedReadable=!0,e.nextTick(O,t))}function O(e){var t=e._readableState;o("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,L(e)}function N(t,n){n.readingMore||(n.readingMore=!0,e.nextTick(R,t,n))}function R(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(o("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function P(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function D(e){o("readable nexttick read 0"),e.read(0)}function M(e,t){o("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),L(e),t.flowing&&!t.reading&&e.read(0)}function L(e){var t=e._readableState;for(o("flow",t.flowing);t.flowing&&null!==e.read(););}function B(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function F(t){var n=t._readableState;o("endReadable",n.endEmitted),n.endEmitted||(n.ended=!0,e.nextTick(U,n,t))}function U(e,t){if(o("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function H(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}T.prototype.read=function(e){o("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return o("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?F(this):I(this),null;if(0===(e=j(e,t))&&t.ended)return 0===t.length&&F(this),null;var r,i=t.needReadable;return o("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&o("length less than watermark",i=!0),t.ended||t.reading?o("reading or ended",i=!1):i&&(o("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=j(n,t))),null===(r=e>0?B(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&F(this)),null!==r&&this.emit("data",r),r},T.prototype._read=function(e){_(this,new x("_read()"))},T.prototype.pipe=function(t,n){var r=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=t;break;case 1:i.pipes=[i.pipes,t];break;default:i.pipes.push(t)}i.pipesCount+=1,o("pipe count=%d opts=%j",i.pipesCount,n);var a=n&&!1===n.end||t===e.stdout||t===e.stderr?g:l;function l(){o("onend"),t.end()}i.endEmitted?e.nextTick(a):r.once("end",a),t.on("unpipe",(function e(n,s){o("onunpipe"),n===r&&s&&!1===s.hasUnpiped&&(s.hasUnpiped=!0,o("cleanup"),t.removeListener("close",h),t.removeListener("finish",f),t.removeListener("drain",c),t.removeListener("error",p),t.removeListener("unpipe",e),r.removeListener("end",l),r.removeListener("end",g),r.removeListener("data",d),u=!0,!i.awaitDrain||t._writableState&&!t._writableState.needDrain||c())}));var c=function(e){return function(){var t=e._readableState;o("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,L(e))}}(r);t.on("drain",c);var u=!1;function d(e){o("ondata");var n=t.write(e);o("dest.write",n),!1===n&&((1===i.pipesCount&&i.pipes===t||i.pipesCount>1&&-1!==H(i.pipes,t))&&!u&&(o("false write response, pause",i.awaitDrain),i.awaitDrain++),r.pause())}function p(e){o("onerror",e),g(),t.removeListener("error",p),0===s(t,"error")&&_(t,e)}function h(){t.removeListener("finish",f),g()}function f(){o("onfinish"),t.removeListener("close",h),g()}function g(){o("unpipe"),r.unpipe(t)}return r.on("data",d),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(t,"error",p),t.once("close",h),t.once("finish",f),t.emit("pipe",r),i.flowing||(o("pipe resume"),r.resume()),t},T.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,{hasUnpiped:!1});return this}var s=H(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},T.prototype.on=function(t,n){var r=a.prototype.on.call(this,t,n),i=this._readableState;return"data"===t?(i.readableListening=this.listenerCount("readable")>0,!1!==i.flowing&&this.resume()):"readable"===t&&(i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,o("on readable",i.length,i.reading),i.length?I(this):i.reading||e.nextTick(D,this))),r},T.prototype.addListener=T.prototype.on,T.prototype.removeListener=function(t,n){var r=a.prototype.removeListener.call(this,t,n);return"readable"===t&&e.nextTick(P,this),r},T.prototype.removeAllListeners=function(t){var n=a.prototype.removeAllListeners.apply(this,arguments);return"readable"!==t&&void 0!==t||e.nextTick(P,this),n},T.prototype.resume=function(){var t=this._readableState;return t.flowing||(o("resume"),t.flowing=!t.readableListening,function(t,n){n.resumeScheduled||(n.resumeScheduled=!0,e.nextTick(M,t,n))}(this,t)),t.paused=!1,this},T.prototype.pause=function(){return o("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(o("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},T.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",(function(){if(o("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){o("wrapped data"),n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i||(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var s=0;s<w.length;s++)e.on(w[s],this.emit.bind(this,w[s]));return this._read=function(t){o("wrapped _read",t),r&&(r=!1,e.resume())},this},"function"==typeof Symbol&&(T.prototype[Symbol.asyncIterator]=function(){return void 0===p&&(p=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/async_iterator.js")),p(this)}),Object.defineProperty(T.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(T.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(T.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),T._fromList=B,Object.defineProperty(T.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(T.from=function(e,t){return void 0===h&&(h=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/from-browser.js")),h(T,e,t)})},"./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_transform.js":(e,t,n)=>{"use strict";e.exports=u;var r=n("./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js").codes,i=r.ERR_METHOD_NOT_IMPLEMENTED,o=r.ERR_MULTIPLE_CALLBACK,s=r.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=r.ERR_TRANSFORM_WITH_LENGTH_0,l=n("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js");function c(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(null===r)return this.emit("error",new o);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function u(e){if(!(this instanceof u))return new u(e);l.call(this,e),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?p(this,null,null):this._flush((function(t,n){p(e,t,n)}))}function p(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new a;if(e._transformState.transforming)throw new s;return e.push(null)}n("./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js")(u,l),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,l.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,n){n(new i("_transform()"))},u.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){l.prototype._destroy.call(this,e,(function(e){t(e)}))}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_writable.js":(t,n,r)=>{"use strict";function i(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(void 0),r=r.next}t.corkedRequestsFree.next=e}(t,e)}}var o;t.exports=T,T.WritableState=S;var s,a={deprecate:r("./node_modules/util-deprecate/browser.js")},l=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/stream-browser.js"),c=r("./node_modules/buffer/index.js").Buffer,u=r.g.Uint8Array||function(){},d=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/destroy.js"),p=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/state.js").getHighWaterMark,h=r("./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js").codes,f=h.ERR_INVALID_ARG_TYPE,g=h.ERR_METHOD_NOT_IMPLEMENTED,m=h.ERR_MULTIPLE_CALLBACK,v=h.ERR_STREAM_CANNOT_PIPE,y=h.ERR_STREAM_DESTROYED,b=h.ERR_STREAM_NULL_VALUES,x=h.ERR_STREAM_WRITE_AFTER_END,E=h.ERR_UNKNOWN_ENCODING,_=d.errorOrDestroy;function w(){}function S(t,n,s){o=o||r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js"),t=t||{},"boolean"!=typeof s&&(s=n instanceof o),this.objectMode=!!t.objectMode,s&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=p(this,t,"writableHighWaterMark",s),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=!1===t.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,n){var r=t._writableState,i=r.sync,o=r.writecb;if("function"!=typeof o)throw new m;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),n)!function(t,n,r,i,o){--n.pendingcb,r?(e.nextTick(o,i),e.nextTick(O,t,n),t._writableState.errorEmitted=!0,_(t,i)):(o(i),t._writableState.errorEmitted=!0,_(t,i),O(t,n))}(t,r,i,n,o);else{var s=j(r)||t.destroyed;s||r.corked||r.bufferProcessing||!r.bufferedRequest||A(t,r),i?e.nextTick(C,t,r,s,o):C(t,r,s,o)}}(n,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}function T(e){var t=this instanceof(o=o||r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js"));if(!t&&!s.call(T,this))return new T(e);this._writableState=new S(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),l.call(this)}function k(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new y("write")):n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function C(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),O(e,t)}function A(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,o=new Array(r),s=t.corkedRequestsFree;s.entry=n;for(var a=0,l=!0;n;)o[a]=n,n.isBuf||(l=!1),n=n.next,a+=1;o.allBuffers=l,k(e,t,!0,t.length,o,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new i(t),t.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,u=n.encoding,d=n.callback;if(k(e,t,!1,t.objectMode?1:c.length,c,u,d),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function j(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function I(e,t){e._final((function(n){t.pendingcb--,n&&_(e,n),t.prefinished=!0,e.emit("prefinish"),O(e,t)}))}function O(t,n){var r=j(n);if(r&&(function(t,n){n.prefinished||n.finalCalled||("function"!=typeof t._final||n.destroyed?(n.prefinished=!0,t.emit("prefinish")):(n.pendingcb++,n.finalCalled=!0,e.nextTick(I,t,n)))}(t,n),0===n.pendingcb&&(n.finished=!0,t.emit("finish"),n.autoDestroy))){var i=t._readableState;(!i||i.autoDestroy&&i.endEmitted)&&t.destroy()}return r}r("./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js")(T,l),S.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(S.prototype,"buffer",{get:a.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(s=Function.prototype[Symbol.hasInstance],Object.defineProperty(T,Symbol.hasInstance,{value:function(e){return!!s.call(this,e)||this===T&&e&&e._writableState instanceof S}})):s=function(e){return e instanceof this},T.prototype.pipe=function(){_(this,new v)},T.prototype.write=function(t,n,r){var i,o=this._writableState,s=!1,a=!o.objectMode&&(i=t,c.isBuffer(i)||i instanceof u);return a&&!c.isBuffer(t)&&(t=function(e){return c.from(e)}(t)),"function"==typeof n&&(r=n,n=null),a?n="buffer":n||(n=o.defaultEncoding),"function"!=typeof r&&(r=w),o.ending?function(t,n){var r=new x;_(t,r),e.nextTick(n,r)}(this,r):(a||function(t,n,r,i){var o;return null===r?o=new b:"string"==typeof r||n.objectMode||(o=new f("chunk",["string","Buffer"],r)),!o||(_(t,o),e.nextTick(i,o),!1)}(this,o,t,r))&&(o.pendingcb++,s=function(e,t,n,r,i,o){if(!n){var s=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=c.from(t,n)),t}(t,r,i);r!==s&&(n=!0,i="buffer",r=s)}var a=t.objectMode?1:r.length;t.length+=a;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else k(e,t,!1,a,r,i,o);return l}(this,o,a,t,n,r)),s},T.prototype.cork=function(){this._writableState.corked++},T.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||A(this,e))},T.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new E(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(T.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(T.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),T.prototype._write=function(e,t,n){n(new g("_write()"))},T.prototype._writev=null,T.prototype.end=function(t,n,r){var i=this._writableState;return"function"==typeof t?(r=t,t=null,n=null):"function"==typeof n&&(r=n,n=null),null!=t&&this.write(t,n),i.corked&&(i.corked=1,this.uncork()),i.ending||function(t,n,r){n.ending=!0,O(t,n),r&&(n.finished?e.nextTick(r):t.once("finish",r)),n.ended=!0,t.writable=!1}(this,i,r),this},Object.defineProperty(T.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),T.prototype.destroy=d.destroy,T.prototype._undestroy=d.undestroy,T.prototype._destroy=function(e,t){t(e)}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/async_iterator.js":(t,n,r)=>{"use strict";var i;function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/end-of-stream.js"),a=Symbol("lastResolve"),l=Symbol("lastReject"),c=Symbol("error"),u=Symbol("ended"),d=Symbol("lastPromise"),p=Symbol("handlePromise"),h=Symbol("stream");function f(e,t){return{value:e,done:t}}function g(e){var t=e[a];if(null!==t){var n=e[h].read();null!==n&&(e[d]=null,e[a]=null,e[l]=null,t(f(n,!1)))}}var m=Object.getPrototypeOf((function(){})),v=Object.setPrototypeOf((o(i={get stream(){return this[h]},next:function(){var t=this,n=this[c];if(null!==n)return Promise.reject(n);if(this[u])return Promise.resolve(f(void 0,!0));if(this[h].destroyed)return new Promise((function(n,r){e.nextTick((function(){t[c]?r(t[c]):n(f(void 0,!0))}))}));var r,i=this[d];if(i)r=new Promise(function(e,t){return function(n,r){e.then((function(){t[u]?n(f(void 0,!0)):t[p](n,r)}),r)}}(i,this));else{var o=this[h].read();if(null!==o)return Promise.resolve(f(o,!1));r=new Promise(this[p])}return this[d]=r,r}},Symbol.asyncIterator,(function(){return this})),o(i,"return",(function(){var e=this;return new Promise((function(t,n){e[h].destroy(null,(function(e){e?n(e):t(f(void 0,!0))}))}))})),i),m);t.exports=function(t){var n,r=Object.create(v,(o(n={},h,{value:t,writable:!0}),o(n,a,{value:null,writable:!0}),o(n,l,{value:null,writable:!0}),o(n,c,{value:null,writable:!0}),o(n,u,{value:t._readableState.endEmitted,writable:!0}),o(n,p,{value:function(e,t){var n=r[h].read();n?(r[d]=null,r[a]=null,r[l]=null,e(f(n,!1))):(r[a]=e,r[l]=t)},writable:!0}),n));return r[d]=null,s(t,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[l];return null!==t&&(r[d]=null,r[a]=null,r[l]=null,t(e)),void(r[c]=e)}var n=r[a];null!==n&&(r[d]=null,r[a]=null,r[l]=null,n(f(void 0,!0))),r[u]=!0})),t.on("readable",function(t){e.nextTick(g,t)}.bind(null,r)),r}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/buffer_list.js":(e,t,n)=>{"use strict";function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=n("./node_modules/buffer/index.js").Buffer,a=n("?3e83").inspect,l=a&&a.custom||"inspect";e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,n;return t=e,(n=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return s.alloc(0);for(var t,n,r,i=s.allocUnsafe(e>>>0),o=this.head,a=0;o;)t=o.data,n=i,r=a,s.prototype.copy.call(t,n,r),a+=o.data.length,o=o.next;return i}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,r=t.data;for(e-=r.length;t=t.next;){var i=t.data,o=e>i.length?i.length:e;if(o===i.length?r+=i:r+=i.slice(0,e),0==(e-=o)){o===i.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(o));break}++n}return this.length-=n,r}},{key:"_getBuffer",value:function(e){var t=s.allocUnsafe(e),n=this.head,r=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var i=n.data,o=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,o),0==(e-=o)){o===i.length?(++r,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=i.slice(o));break}++r}return this.length-=r,t}},{key:l,value:function(e,t){return a(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}])&&o(t.prototype,n),e}()},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/destroy.js":t=>{"use strict";function n(e,t){i(e,t),r(e)}function r(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function i(e,t){e.emit("error",t)}t.exports={destroy:function(t,o){var s=this,a=this._readableState&&this._readableState.destroyed,l=this._writableState&&this._writableState.destroyed;return a||l?(o?o(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,e.nextTick(i,this,t)):e.nextTick(i,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!o&&t?s._writableState?s._writableState.errorEmitted?e.nextTick(r,s):(s._writableState.errorEmitted=!0,e.nextTick(n,s,t)):e.nextTick(n,s,t):o?(e.nextTick(r,s),o(t)):e.nextTick(r,s)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,r=e._writableState;n&&n.autoDestroy||r&&r.autoDestroy?e.destroy(t):e.emit("error",t)}}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/end-of-stream.js":(e,t,n)=>{"use strict";var r=n("./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js").codes.ERR_STREAM_PREMATURE_CLOSE;function i(){}e.exports=function e(t,n,o){if("function"==typeof n)return e(t,null,n);n||(n={}),o=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];e.apply(this,r)}}}(o||i);var s=n.readable||!1!==n.readable&&t.readable,a=n.writable||!1!==n.writable&&t.writable,l=function(){t.writable||u()},c=t._writableState&&t._writableState.finished,u=function(){a=!1,c=!0,s||o.call(t)},d=t._readableState&&t._readableState.endEmitted,p=function(){s=!1,d=!0,a||o.call(t)},h=function(e){o.call(t,e)},f=function(){var e;return s&&!d?(t._readableState&&t._readableState.ended||(e=new r),o.call(t,e)):a&&!c?(t._writableState&&t._writableState.ended||(e=new r),o.call(t,e)):void 0},g=function(){t.req.on("finish",u)};return function(e){return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",u),t.on("abort",f),t.req?g():t.on("request",g)):a&&!t._writableState&&(t.on("end",l),t.on("close",l)),t.on("end",p),t.on("finish",u),!1!==n.error&&t.on("error",h),t.on("close",f),function(){t.removeListener("complete",u),t.removeListener("abort",f),t.removeListener("request",g),t.req&&t.req.removeListener("finish",u),t.removeListener("end",l),t.removeListener("close",l),t.removeListener("finish",u),t.removeListener("end",p),t.removeListener("error",h),t.removeListener("close",f)}}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/from-browser.js":e=>{e.exports=function(){throw new Error("Readable.from is not available in the browser")}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/pipeline.js":(e,t,n)=>{"use strict";var r,i=n("./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js").codes,o=i.ERR_MISSING_ARGS,s=i.ERR_STREAM_DESTROYED;function a(e){if(e)throw e}function l(e){e()}function c(e,t){return e.pipe(t)}e.exports=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var u,d=function(e){return e.length?"function"!=typeof e[e.length-1]?a:e.pop():a}(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new o("streams");var p=t.map((function(e,i){var o=i<t.length-1;return function(e,t,i,o){o=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(o);var a=!1;e.on("close",(function(){a=!0})),void 0===r&&(r=n("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/end-of-stream.js")),r(e,{readable:t,writable:i},(function(e){if(e)return o(e);a=!0,o()}));var l=!1;return function(t){if(!a&&!l)return l=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void o(t||new s("pipe"))}}(e,o,i>0,(function(e){u||(u=e),e&&p.forEach(l),o||(p.forEach(l),d(u))}))}));return t.reduce(c)}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/state.js":(e,t,n)=>{"use strict";var r=n("./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js").codes.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,n,i){var o=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,i,n);if(null!=o){if(!isFinite(o)||Math.floor(o)!==o||o<0)throw new r(i?n:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/stream-browser.js":(e,t,n)=>{e.exports=n("./node_modules/events/events.js").EventEmitter},"./node_modules/string_decoder/lib/string_decoder.js":(e,t,n)=>{"use strict";var r=n("./node_modules/safe-buffer/index.js").Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=u,this.end=d,t=3;break;default:return this.write=p,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function u(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function p(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}t.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},o.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=s(t[r]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--r<n||-2===i?0:(i=s(t[r]))>=0?(i>0&&(e.lastNeed=i-2),i):--r<n||-2===i?0:(i=s(t[r]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},"./node_modules/ua-parser-js/src/ua-parser.js":function(e,t,n){var r;!function(i,o){"use strict";var s="model",a="name",l="type",c="vendor",u="version",d="mobile",p="tablet",h="smarttv",f=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},g=function(e,t){return"string"==typeof e&&-1!==m(t).indexOf(m(e))},m=function(e){return e.toLowerCase()},v=function(e,t){if("string"==typeof e)return e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),void 0===t?e:e.substring(0,255)},y=function(e,t){for(var n,r,i,o,s,a,l=0;l<t.length&&!s;){var c=t[l],u=t[l+1];for(n=r=0;n<c.length&&!s;)if(s=c[n++].exec(e))for(i=0;i<u.length;i++)a=s[++r],"object"==typeof(o=u[i])&&o.length>0?2===o.length?"function"==typeof o[1]?this[o[0]]=o[1].call(this,a):this[o[0]]=o[1]:3===o.length?"function"!=typeof o[1]||o[1].exec&&o[1].test?this[o[0]]=a?a.replace(o[1],o[2]):void 0:this[o[0]]=a?o[1].call(this,a,o[2]):void 0:4===o.length&&(this[o[0]]=a?o[3].call(this,a.replace(o[1],o[2])):void 0):this[o]=a||void 0;l+=2}},b=function(e,t){for(var n in t)if("object"==typeof t[n]&&t[n].length>0){for(var r=0;r<t[n].length;r++)if(g(t[n][r],e))return"?"===n?void 0:n}else if(g(t[n],e))return"?"===n?void 0:n;return e},x={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},E={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[u,[a,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[u,[a,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[a,u],[/opios[\/ ]+([\w\.]+)/i],[u,[a,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[u,[a,"Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[a,u],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[u,[a,"UCBrowser"]],[/\bqbcore\/([\w\.]+)/i],[u,[a,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[u,[a,"WeChat"]],[/konqueror\/([\w\.]+)/i],[u,[a,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[u,[a,"IE"]],[/yabrowser\/([\w\.]+)/i],[u,[a,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[a,/(.+)/,"$1 Secure Browser"],u],[/\bfocus\/([\w\.]+)/i],[u,[a,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[u,[a,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[u,[a,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[u,[a,"Dolphin"]],[/coast\/([\w\.]+)/i],[u,[a,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[u,[a,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[u,[a,"Firefox"]],[/\bqihu|(qi?ho?o?|360)browser/i],[[a,"360 Browser"]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[a,/(.+)/,"$1 Browser"],u],[/(comodo_dragon)\/([\w\.]+)/i],[[a,/_/g," "],u],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[a,u],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[a],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[a,"Facebook"],u],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[a,u],[/\bgsa\/([\w\.]+) .*safari\//i],[u,[a,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[u,[a,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[a,"Chrome WebView"],u],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[u,[a,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[a,u],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[u,[a,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[u,a],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[a,[u,b,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[a,u],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[a,"Netscape"],u],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[u,[a,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[a,u]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",m]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[["architecture","arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[["architecture","armhf"]],[/windows (ce|mobile); ppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[["architecture",/ower/,"",m]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[["architecture",m]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[s,[c,"Samsung"],[l,p]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[s,[c,"Samsung"],[l,d]],[/\((ip(?:hone|od)[\w ]*);/i],[s,[c,"Apple"],[l,d]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[s,[c,"Apple"],[l,p]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[s,[c,"Huawei"],[l,p]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[s,[c,"Huawei"],[l,d]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[s,/_/g," "],[c,"Xiaomi"],[l,d]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[s,/_/g," "],[c,"Xiaomi"],[l,p]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[s,[c,"OPPO"],[l,d]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[s,[c,"Vivo"],[l,d]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[s,[c,"Realme"],[l,d]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[s,[c,"Motorola"],[l,d]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[s,[c,"Motorola"],[l,p]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[s,[c,"LG"],[l,p]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[s,[c,"LG"],[l,d]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[s,[c,"Lenovo"],[l,p]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[s,/_/g," "],[c,"Nokia"],[l,d]],[/(pixel c)\b/i],[s,[c,"Google"],[l,p]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[s,[c,"Google"],[l,d]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[s,[c,"Sony"],[l,d]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[s,"Xperia Tablet"],[c,"Sony"],[l,p]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[s,[c,"OnePlus"],[l,d]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[s,[c,"Amazon"],[l,p]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[s,/(.+)/g,"Fire Phone $1"],[c,"Amazon"],[l,d]],[/(playbook);[-\w\),; ]+(rim)/i],[s,c,[l,p]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[s,[c,"BlackBerry"],[l,d]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[s,[c,"ASUS"],[l,p]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[s,[c,"ASUS"],[l,d]],[/(nexus 9)/i],[s,[c,"HTC"],[l,p]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[c,[s,/_/g," "],[l,d]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[s,[c,"Acer"],[l,p]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[s,[c,"Meizu"],[l,d]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[s,[c,"Sharp"],[l,d]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[c,s,[l,d]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[c,s,[l,p]],[/(surface duo)/i],[s,[c,"Microsoft"],[l,p]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[s,[c,"Fairphone"],[l,d]],[/(u304aa)/i],[s,[c,"AT&T"],[l,d]],[/\bsie-(\w*)/i],[s,[c,"Siemens"],[l,d]],[/\b(rct\w+) b/i],[s,[c,"RCA"],[l,p]],[/\b(venue[\d ]{2,7}) b/i],[s,[c,"Dell"],[l,p]],[/\b(q(?:mv|ta)\w+) b/i],[s,[c,"Verizon"],[l,p]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[s,[c,"Barnes & Noble"],[l,p]],[/\b(tm\d{3}\w+) b/i],[s,[c,"NuVision"],[l,p]],[/\b(k88) b/i],[s,[c,"ZTE"],[l,p]],[/\b(nx\d{3}j) b/i],[s,[c,"ZTE"],[l,d]],[/\b(gen\d{3}) b.+49h/i],[s,[c,"Swiss"],[l,d]],[/\b(zur\d{3}) b/i],[s,[c,"Swiss"],[l,p]],[/\b((zeki)?tb.*\b) b/i],[s,[c,"Zeki"],[l,p]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[c,"Dragon Touch"],s,[l,p]],[/\b(ns-?\w{0,9}) b/i],[s,[c,"Insignia"],[l,p]],[/\b((nxa|next)-?\w{0,9}) b/i],[s,[c,"NextBook"],[l,p]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[c,"Voice"],s,[l,d]],[/\b(lvtel\-)?(v1[12]) b/i],[[c,"LvTel"],s,[l,d]],[/\b(ph-1) /i],[s,[c,"Essential"],[l,d]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[s,[c,"Envizen"],[l,p]],[/\b(trio[-\w\. ]+) b/i],[s,[c,"MachSpeed"],[l,p]],[/\btu_(1491) b/i],[s,[c,"Rotor"],[l,p]],[/(shield[\w ]+) b/i],[s,[c,"Nvidia"],[l,p]],[/(sprint) (\w+)/i],[c,s,[l,d]],[/(kin\.[onetw]{3})/i],[[s,/\./g," "],[c,"Microsoft"],[l,d]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[s,[c,"Zebra"],[l,p]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[s,[c,"Zebra"],[l,d]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[c,s,[l,"console"]],[/droid.+; (shield) bui/i],[s,[c,"Nvidia"],[l,"console"]],[/(playstation [345portablevi]+)/i],[s,[c,"Sony"],[l,"console"]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[s,[c,"Microsoft"],[l,"console"]],[/smart-tv.+(samsung)/i],[c,[l,h]],[/hbbtv.+maple;(\d+)/i],[[s,/^/,"SmartTV"],[c,"Samsung"],[l,h]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[c,"LG"],[l,h]],[/(apple) ?tv/i],[c,[s,"Apple TV"],[l,h]],[/crkey/i],[[s,"Chromecast"],[c,"Google"],[l,h]],[/droid.+aft(\w)( bui|\))/i],[s,[c,"Amazon"],[l,h]],[/\(dtv[\);].+(aquos)/i],[s,[c,"Sharp"],[l,h]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[c,v],[s,v],[l,h]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[l,h]],[/((pebble))app/i],[c,s,[l,"wearable"]],[/droid.+; (glass) \d/i],[s,[c,"Google"],[l,"wearable"]],[/droid.+; (wt63?0{2,3})\)/i],[s,[c,"Zebra"],[l,"wearable"]],[/(quest( 2)?)/i],[s,[c,"Facebook"],[l,"wearable"]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[c,[l,"embedded"]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[s,[l,d]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[s,[l,p]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[l,p]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[l,d]],[/(android[-\w\. ]{0,9});.+buil/i],[s,[c,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[u,[a,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[u,[a,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[a,u],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[u,a]],os:[[/microsoft (windows) (vista|xp)/i],[a,u],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[a,[u,b,x]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[a,"Windows"],[u,b,x]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[u,/_/g,"."],[a,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[a,"Mac OS"],[u,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[u,a],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[a,u],[/\(bb(10);/i],[u,[a,"BlackBerry"]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[u,[a,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[u,[a,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[u,[a,"webOS"]],[/crkey\/([\d\.]+)/i],[u,[a,"Chromecast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[a,"Chromium OS"],u],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[a,u],[/(sunos) ?([\w\.\d]*)/i],[[a,"Solaris"],u],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[a,u]]},_=function(e,t){if("object"==typeof e&&(t=e,e=void 0),!(this instanceof _))return new _(e,t).getResult();var n=e||(void 0!==i&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:""),r=t?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(E,t):E;return this.getBrowser=function(){var e,t={name:void 0,version:void 0};return y.call(t,n,r.browser),t.major="string"==typeof(e=t.version)?e.replace(/[^\d\.]/g,"").split(".")[0]:void 0,t},this.getCPU=function(){var e={architecture:void 0};return y.call(e,n,r.cpu),e},this.getDevice=function(){var e={vendor:void 0,model:void 0,type:void 0};return y.call(e,n,r.device),e},this.getEngine=function(){var e={name:void 0,version:void 0};return y.call(e,n,r.engine),e},this.getOS=function(){var e={name:void 0,version:void 0};return y.call(e,n,r.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n="string"==typeof e&&e.length>255?v(e,255):e,this},this.setUA(n),this};_.VERSION="1.0.2",_.BROWSER=f([a,u,"major"]),_.CPU=f(["architecture"]),_.DEVICE=f([s,c,l,"console",d,h,p,"wearable","embedded"]),_.ENGINE=_.OS=f([a,u]),void 0!==t?(e.exports&&(t=e.exports=_),t.UAParser=_):n.amdO?void 0===(r=function(){return _}.call(t,n,t,e))||(e.exports=r):void 0!==i&&(i.UAParser=_);var w=void 0!==i&&(i.jQuery||i.Zepto);if(w&&!w.ua){var S=new _;w.ua=S.getResult(),w.ua.get=function(){return S.getUA()},w.ua.set=function(e){S.setUA(e);var t=S.getResult();for(var n in t)w.ua[n]=t[n]}}}("object"==typeof window?window:this)},"./node_modules/util-deprecate/browser.js":(e,t,n)=>{function r(e){try{if(!n.g.localStorage)return!1}catch(e){return!1}var t=n.g.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}},"?3e83":()=>{},"?19e6":()=>{},"./node_modules/bcp-47-normalize/lib/defaults.json":e=>{"use strict";e.exports=JSON.parse('["mni-beng-in","mni-mtei-in","sat-deva-in","sat-olck-in","shi-latn-ma","shi-tfng-ma","vai-latn-lr","vai-vaii-lr","yue-hans-cn","yue-hant-hk","az-arab-ir","az-cyrl-az","az-latn-az","bm-nkoo-ml","bs-cyrl-ba","bs-latn-ba","en-dsrt-us","ff-adlm-gn","ff-latn-sn","ha-arab-ng","hi-latn-in","iu-latn-ca","ks-arab-in","ks-deva-in","mn-mong-cn","ms-arab-my","pa-arab-pk","pa-guru-in","sd-arab-pk","sd-deva-in","sr-cyrl-rs","sr-latn-rs","su-latn-id","uz-arab-af","uz-cyrl-uz","uz-latn-uz","zh-hans-cn","zh-hant-tw","mni-beng","sat-olck","shi-tfng","vai-vaii","yue-hant","az-latn","bs-latn","ff-latn","jbo-001","ks-arab","pa-guru","prg-001","sd-arab","sr-cyrl","su-latn","uz-latn","zh-hans","agq-cm","ar-001","arn-cl","asa-tz","ast-es","bas-cm","bem-zm","bez-tz","bgn-pk","blt-vn","brx-in","bss-cm","byn-er","cad-us","cch-ng","ccp-bd","ceb-ph","cgg-ug","chr-us","cic-us","ckb-iq","dav-ke","dje-ne","doi-in","dsb-de","dua-cm","dyo-sn","ebu-ke","eo-001","ewo-cm","fil-ph","fur-it","gaa-gh","gez-et","gsw-ch","guz-ke","haw-us","hsb-de","ia-001","ife-tg","io-001","jgo-cm","jmc-tz","kab-dz","kaj-ng","kam-ke","kcg-ng","kde-tz","kea-cv","ken-cm","khq-ml","kkj-cm","kln-ke","kok-in","kpe-lr","ksb-tz","ksf-cm","ksh-de","lag-tz","lkt-us","lrc-ir","luo-ke","luy-ke","mai-in","mas-ke","mer-ke","mfe-mu","mgh-mz","mgo-cm","moh-ca","mua-cm","mus-us","myv-ru","mzn-ir","naq-na","nds-de","nmg-cm","nnh-cm","nqo-gn","nso-za","nus-ss","nyn-ug","osa-us","pcm-ng","quc-gt","rof-tz","rwk-tz","sah-ru","saq-ke","sbp-tz","scn-it","sdh-ir","seh-mz","ses-ml","sid-et","sma-se","smj-se","smn-fi","sms-fi","ssy-er","syr-iq","szl-pl","teo-ug","tig-er","trv-tw","trw-pk","twq-ne","tzm-ma","vo-001","vun-tz","wae-ch","wal-et","wbp-au","xog-ug","yav-cm","yi-001","zgh-ma","aa-et","af-za","ak-gh","am-et","an-es","as-in","ba-ru","be-by","bg-bg","bm-ml","bn-bd","bo-cn","br-fr","ca-es","ce-ru","co-fr","cs-cz","cu-ru","cv-ru","cy-gb","da-dk","de-de","dv-mv","dz-bt","ee-gh","el-gr","en-us","es-es","et-ee","eu-es","fa-ir","fi-fi","fo-fo","fr-fr","fy-nl","ga-ie","gd-gb","gl-es","gn-py","gu-in","gv-im","ha-ng","he-il","hi-in","hr-hr","hu-hu","hy-am","id-id","ig-ng","ii-cn","is-is","it-it","iu-ca","ja-jp","jv-id","ka-ge","ki-ke","kk-kz","kl-gl","km-kh","kn-in","ko-kr","ku-tr","kw-gb","ky-kg","lb-lu","lg-ug","ln-cd","lo-la","lt-lt","lu-cd","lv-lv","mg-mg","mi-nz","mk-mk","ml-in","mn-mn","mr-in","ms-my","mt-mt","my-mm","nb-no","nd-zw","ne-np","nl-nl","nn-no","nr-za","nv-us","ny-mw","oc-fr","om-et","or-in","os-ge","pl-pl","ps-af","pt-br","qu-pe","rm-ch","rn-bi","ro-ro","ru-ru","rw-rw","sa-in","sc-it","se-no","sg-cf","si-lk","sk-sk","sl-si","sn-zw","so-so","sq-al","ss-za","st-za","sv-se","sw-tz","ta-in","te-in","tg-tj","th-th","ti-et","tk-tm","tn-za","to-to","tr-tr","ts-za","tt-ru","ug-cn","uk-ua","ur-pk","ve-za","vi-vn","wa-be","wo-sn","xh-za","yo-ng","zu-za"]')},"./node_modules/bcp-47-normalize/lib/fields.json":e=>{"use strict";e.exports=JSON.parse('[{"from":{"field":"script","value":"qaai"},"to":{"field":"script","value":"zinh"}},{"from":{"field":"region","value":"bu"},"to":{"field":"region","value":"mm"}},{"from":{"field":"region","value":"ct"},"to":{"field":"region","value":"ki"}},{"from":{"field":"region","value":"dd"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"dy"},"to":{"field":"region","value":"bj"}},{"from":{"field":"region","value":"fx"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"hv"},"to":{"field":"region","value":"bf"}},{"from":{"field":"region","value":"jt"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"mi"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"nh"},"to":{"field":"region","value":"vu"}},{"from":{"field":"region","value":"nq"},"to":{"field":"region","value":"aq"}},{"from":{"field":"region","value":"pu"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"pz"},"to":{"field":"region","value":"pa"}},{"from":{"field":"region","value":"qu"},"to":{"field":"region","value":"eu"}},{"from":{"field":"region","value":"rh"},"to":{"field":"region","value":"zw"}},{"from":{"field":"region","value":"tp"},"to":{"field":"region","value":"tl"}},{"from":{"field":"region","value":"uk"},"to":{"field":"region","value":"gb"}},{"from":{"field":"region","value":"vd"},"to":{"field":"region","value":"vn"}},{"from":{"field":"region","value":"wk"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"yd"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"zr"},"to":{"field":"region","value":"cd"}},{"from":{"field":"region","value":"230"},"to":{"field":"region","value":"et"}},{"from":{"field":"region","value":"280"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"736"},"to":{"field":"region","value":"sd"}},{"from":{"field":"region","value":"886"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"958"},"to":{"field":"region","value":"aa"}},{"from":{"field":"region","value":"020"},"to":{"field":"region","value":"ad"}},{"from":{"field":"region","value":"784"},"to":{"field":"region","value":"ae"}},{"from":{"field":"region","value":"004"},"to":{"field":"region","value":"af"}},{"from":{"field":"region","value":"028"},"to":{"field":"region","value":"ag"}},{"from":{"field":"region","value":"660"},"to":{"field":"region","value":"ai"}},{"from":{"field":"region","value":"008"},"to":{"field":"region","value":"al"}},{"from":{"field":"region","value":"051"},"to":{"field":"region","value":"am"}},{"from":{"field":"region","value":"024"},"to":{"field":"region","value":"ao"}},{"from":{"field":"region","value":"010"},"to":{"field":"region","value":"aq"}},{"from":{"field":"region","value":"032"},"to":{"field":"region","value":"ar"}},{"from":{"field":"region","value":"016"},"to":{"field":"region","value":"as"}},{"from":{"field":"region","value":"040"},"to":{"field":"region","value":"at"}},{"from":{"field":"region","value":"036"},"to":{"field":"region","value":"au"}},{"from":{"field":"region","value":"533"},"to":{"field":"region","value":"aw"}},{"from":{"field":"region","value":"248"},"to":{"field":"region","value":"ax"}},{"from":{"field":"region","value":"031"},"to":{"field":"region","value":"az"}},{"from":{"field":"region","value":"070"},"to":{"field":"region","value":"ba"}},{"from":{"field":"region","value":"052"},"to":{"field":"region","value":"bb"}},{"from":{"field":"region","value":"050"},"to":{"field":"region","value":"bd"}},{"from":{"field":"region","value":"056"},"to":{"field":"region","value":"be"}},{"from":{"field":"region","value":"854"},"to":{"field":"region","value":"bf"}},{"from":{"field":"region","value":"100"},"to":{"field":"region","value":"bg"}},{"from":{"field":"region","value":"048"},"to":{"field":"region","value":"bh"}},{"from":{"field":"region","value":"108"},"to":{"field":"region","value":"bi"}},{"from":{"field":"region","value":"204"},"to":{"field":"region","value":"bj"}},{"from":{"field":"region","value":"652"},"to":{"field":"region","value":"bl"}},{"from":{"field":"region","value":"060"},"to":{"field":"region","value":"bm"}},{"from":{"field":"region","value":"096"},"to":{"field":"region","value":"bn"}},{"from":{"field":"region","value":"068"},"to":{"field":"region","value":"bo"}},{"from":{"field":"region","value":"535"},"to":{"field":"region","value":"bq"}},{"from":{"field":"region","value":"076"},"to":{"field":"region","value":"br"}},{"from":{"field":"region","value":"044"},"to":{"field":"region","value":"bs"}},{"from":{"field":"region","value":"064"},"to":{"field":"region","value":"bt"}},{"from":{"field":"region","value":"104"},"to":{"field":"region","value":"mm"}},{"from":{"field":"region","value":"074"},"to":{"field":"region","value":"bv"}},{"from":{"field":"region","value":"072"},"to":{"field":"region","value":"bw"}},{"from":{"field":"region","value":"112"},"to":{"field":"region","value":"by"}},{"from":{"field":"region","value":"084"},"to":{"field":"region","value":"bz"}},{"from":{"field":"region","value":"124"},"to":{"field":"region","value":"ca"}},{"from":{"field":"region","value":"166"},"to":{"field":"region","value":"cc"}},{"from":{"field":"region","value":"180"},"to":{"field":"region","value":"cd"}},{"from":{"field":"region","value":"140"},"to":{"field":"region","value":"cf"}},{"from":{"field":"region","value":"178"},"to":{"field":"region","value":"cg"}},{"from":{"field":"region","value":"756"},"to":{"field":"region","value":"ch"}},{"from":{"field":"region","value":"384"},"to":{"field":"region","value":"ci"}},{"from":{"field":"region","value":"184"},"to":{"field":"region","value":"ck"}},{"from":{"field":"region","value":"152"},"to":{"field":"region","value":"cl"}},{"from":{"field":"region","value":"120"},"to":{"field":"region","value":"cm"}},{"from":{"field":"region","value":"156"},"to":{"field":"region","value":"cn"}},{"from":{"field":"region","value":"170"},"to":{"field":"region","value":"co"}},{"from":{"field":"region","value":"188"},"to":{"field":"region","value":"cr"}},{"from":{"field":"region","value":"192"},"to":{"field":"region","value":"cu"}},{"from":{"field":"region","value":"132"},"to":{"field":"region","value":"cv"}},{"from":{"field":"region","value":"531"},"to":{"field":"region","value":"cw"}},{"from":{"field":"region","value":"162"},"to":{"field":"region","value":"cx"}},{"from":{"field":"region","value":"196"},"to":{"field":"region","value":"cy"}},{"from":{"field":"region","value":"203"},"to":{"field":"region","value":"cz"}},{"from":{"field":"region","value":"278"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"276"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"262"},"to":{"field":"region","value":"dj"}},{"from":{"field":"region","value":"208"},"to":{"field":"region","value":"dk"}},{"from":{"field":"region","value":"212"},"to":{"field":"region","value":"dm"}},{"from":{"field":"region","value":"214"},"to":{"field":"region","value":"do"}},{"from":{"field":"region","value":"012"},"to":{"field":"region","value":"dz"}},{"from":{"field":"region","value":"218"},"to":{"field":"region","value":"ec"}},{"from":{"field":"region","value":"233"},"to":{"field":"region","value":"ee"}},{"from":{"field":"region","value":"818"},"to":{"field":"region","value":"eg"}},{"from":{"field":"region","value":"732"},"to":{"field":"region","value":"eh"}},{"from":{"field":"region","value":"232"},"to":{"field":"region","value":"er"}},{"from":{"field":"region","value":"724"},"to":{"field":"region","value":"es"}},{"from":{"field":"region","value":"231"},"to":{"field":"region","value":"et"}},{"from":{"field":"region","value":"246"},"to":{"field":"region","value":"fi"}},{"from":{"field":"region","value":"242"},"to":{"field":"region","value":"fj"}},{"from":{"field":"region","value":"238"},"to":{"field":"region","value":"fk"}},{"from":{"field":"region","value":"583"},"to":{"field":"region","value":"fm"}},{"from":{"field":"region","value":"234"},"to":{"field":"region","value":"fo"}},{"from":{"field":"region","value":"250"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"249"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"266"},"to":{"field":"region","value":"ga"}},{"from":{"field":"region","value":"826"},"to":{"field":"region","value":"gb"}},{"from":{"field":"region","value":"308"},"to":{"field":"region","value":"gd"}},{"from":{"field":"region","value":"268"},"to":{"field":"region","value":"ge"}},{"from":{"field":"region","value":"254"},"to":{"field":"region","value":"gf"}},{"from":{"field":"region","value":"831"},"to":{"field":"region","value":"gg"}},{"from":{"field":"region","value":"288"},"to":{"field":"region","value":"gh"}},{"from":{"field":"region","value":"292"},"to":{"field":"region","value":"gi"}},{"from":{"field":"region","value":"304"},"to":{"field":"region","value":"gl"}},{"from":{"field":"region","value":"270"},"to":{"field":"region","value":"gm"}},{"from":{"field":"region","value":"324"},"to":{"field":"region","value":"gn"}},{"from":{"field":"region","value":"312"},"to":{"field":"region","value":"gp"}},{"from":{"field":"region","value":"226"},"to":{"field":"region","value":"gq"}},{"from":{"field":"region","value":"300"},"to":{"field":"region","value":"gr"}},{"from":{"field":"region","value":"239"},"to":{"field":"region","value":"gs"}},{"from":{"field":"region","value":"320"},"to":{"field":"region","value":"gt"}},{"from":{"field":"region","value":"316"},"to":{"field":"region","value":"gu"}},{"from":{"field":"region","value":"624"},"to":{"field":"region","value":"gw"}},{"from":{"field":"region","value":"328"},"to":{"field":"region","value":"gy"}},{"from":{"field":"region","value":"344"},"to":{"field":"region","value":"hk"}},{"from":{"field":"region","value":"334"},"to":{"field":"region","value":"hm"}},{"from":{"field":"region","value":"340"},"to":{"field":"region","value":"hn"}},{"from":{"field":"region","value":"191"},"to":{"field":"region","value":"hr"}},{"from":{"field":"region","value":"332"},"to":{"field":"region","value":"ht"}},{"from":{"field":"region","value":"348"},"to":{"field":"region","value":"hu"}},{"from":{"field":"region","value":"360"},"to":{"field":"region","value":"id"}},{"from":{"field":"region","value":"372"},"to":{"field":"region","value":"ie"}},{"from":{"field":"region","value":"376"},"to":{"field":"region","value":"il"}},{"from":{"field":"region","value":"833"},"to":{"field":"region","value":"im"}},{"from":{"field":"region","value":"356"},"to":{"field":"region","value":"in"}},{"from":{"field":"region","value":"086"},"to":{"field":"region","value":"io"}},{"from":{"field":"region","value":"368"},"to":{"field":"region","value":"iq"}},{"from":{"field":"region","value":"364"},"to":{"field":"region","value":"ir"}},{"from":{"field":"region","value":"352"},"to":{"field":"region","value":"is"}},{"from":{"field":"region","value":"380"},"to":{"field":"region","value":"it"}},{"from":{"field":"region","value":"832"},"to":{"field":"region","value":"je"}},{"from":{"field":"region","value":"388"},"to":{"field":"region","value":"jm"}},{"from":{"field":"region","value":"400"},"to":{"field":"region","value":"jo"}},{"from":{"field":"region","value":"392"},"to":{"field":"region","value":"jp"}},{"from":{"field":"region","value":"404"},"to":{"field":"region","value":"ke"}},{"from":{"field":"region","value":"417"},"to":{"field":"region","value":"kg"}},{"from":{"field":"region","value":"116"},"to":{"field":"region","value":"kh"}},{"from":{"field":"region","value":"296"},"to":{"field":"region","value":"ki"}},{"from":{"field":"region","value":"174"},"to":{"field":"region","value":"km"}},{"from":{"field":"region","value":"659"},"to":{"field":"region","value":"kn"}},{"from":{"field":"region","value":"408"},"to":{"field":"region","value":"kp"}},{"from":{"field":"region","value":"410"},"to":{"field":"region","value":"kr"}},{"from":{"field":"region","value":"414"},"to":{"field":"region","value":"kw"}},{"from":{"field":"region","value":"136"},"to":{"field":"region","value":"ky"}},{"from":{"field":"region","value":"398"},"to":{"field":"region","value":"kz"}},{"from":{"field":"region","value":"418"},"to":{"field":"region","value":"la"}},{"from":{"field":"region","value":"422"},"to":{"field":"region","value":"lb"}},{"from":{"field":"region","value":"662"},"to":{"field":"region","value":"lc"}},{"from":{"field":"region","value":"438"},"to":{"field":"region","value":"li"}},{"from":{"field":"region","value":"144"},"to":{"field":"region","value":"lk"}},{"from":{"field":"region","value":"430"},"to":{"field":"region","value":"lr"}},{"from":{"field":"region","value":"426"},"to":{"field":"region","value":"ls"}},{"from":{"field":"region","value":"440"},"to":{"field":"region","value":"lt"}},{"from":{"field":"region","value":"442"},"to":{"field":"region","value":"lu"}},{"from":{"field":"region","value":"428"},"to":{"field":"region","value":"lv"}},{"from":{"field":"region","value":"434"},"to":{"field":"region","value":"ly"}},{"from":{"field":"region","value":"504"},"to":{"field":"region","value":"ma"}},{"from":{"field":"region","value":"492"},"to":{"field":"region","value":"mc"}},{"from":{"field":"region","value":"498"},"to":{"field":"region","value":"md"}},{"from":{"field":"region","value":"499"},"to":{"field":"region","value":"me"}},{"from":{"field":"region","value":"663"},"to":{"field":"region","value":"mf"}},{"from":{"field":"region","value":"450"},"to":{"field":"region","value":"mg"}},{"from":{"field":"region","value":"584"},"to":{"field":"region","value":"mh"}},{"from":{"field":"region","value":"807"},"to":{"field":"region","value":"mk"}},{"from":{"field":"region","value":"466"},"to":{"field":"region","value":"ml"}},{"from":{"field":"region","value":"496"},"to":{"field":"region","value":"mn"}},{"from":{"field":"region","value":"446"},"to":{"field":"region","value":"mo"}},{"from":{"field":"region","value":"580"},"to":{"field":"region","value":"mp"}},{"from":{"field":"region","value":"474"},"to":{"field":"region","value":"mq"}},{"from":{"field":"region","value":"478"},"to":{"field":"region","value":"mr"}},{"from":{"field":"region","value":"500"},"to":{"field":"region","value":"ms"}},{"from":{"field":"region","value":"470"},"to":{"field":"region","value":"mt"}},{"from":{"field":"region","value":"480"},"to":{"field":"region","value":"mu"}},{"from":{"field":"region","value":"462"},"to":{"field":"region","value":"mv"}},{"from":{"field":"region","value":"454"},"to":{"field":"region","value":"mw"}},{"from":{"field":"region","value":"484"},"to":{"field":"region","value":"mx"}},{"from":{"field":"region","value":"458"},"to":{"field":"region","value":"my"}},{"from":{"field":"region","value":"508"},"to":{"field":"region","value":"mz"}},{"from":{"field":"region","value":"516"},"to":{"field":"region","value":"na"}},{"from":{"field":"region","value":"540"},"to":{"field":"region","value":"nc"}},{"from":{"field":"region","value":"562"},"to":{"field":"region","value":"ne"}},{"from":{"field":"region","value":"574"},"to":{"field":"region","value":"nf"}},{"from":{"field":"region","value":"566"},"to":{"field":"region","value":"ng"}},{"from":{"field":"region","value":"558"},"to":{"field":"region","value":"ni"}},{"from":{"field":"region","value":"528"},"to":{"field":"region","value":"nl"}},{"from":{"field":"region","value":"578"},"to":{"field":"region","value":"no"}},{"from":{"field":"region","value":"524"},"to":{"field":"region","value":"np"}},{"from":{"field":"region","value":"520"},"to":{"field":"region","value":"nr"}},{"from":{"field":"region","value":"570"},"to":{"field":"region","value":"nu"}},{"from":{"field":"region","value":"554"},"to":{"field":"region","value":"nz"}},{"from":{"field":"region","value":"512"},"to":{"field":"region","value":"om"}},{"from":{"field":"region","value":"591"},"to":{"field":"region","value":"pa"}},{"from":{"field":"region","value":"604"},"to":{"field":"region","value":"pe"}},{"from":{"field":"region","value":"258"},"to":{"field":"region","value":"pf"}},{"from":{"field":"region","value":"598"},"to":{"field":"region","value":"pg"}},{"from":{"field":"region","value":"608"},"to":{"field":"region","value":"ph"}},{"from":{"field":"region","value":"586"},"to":{"field":"region","value":"pk"}},{"from":{"field":"region","value":"616"},"to":{"field":"region","value":"pl"}},{"from":{"field":"region","value":"666"},"to":{"field":"region","value":"pm"}},{"from":{"field":"region","value":"612"},"to":{"field":"region","value":"pn"}},{"from":{"field":"region","value":"630"},"to":{"field":"region","value":"pr"}},{"from":{"field":"region","value":"275"},"to":{"field":"region","value":"ps"}},{"from":{"field":"region","value":"620"},"to":{"field":"region","value":"pt"}},{"from":{"field":"region","value":"585"},"to":{"field":"region","value":"pw"}},{"from":{"field":"region","value":"600"},"to":{"field":"region","value":"py"}},{"from":{"field":"region","value":"634"},"to":{"field":"region","value":"qa"}},{"from":{"field":"region","value":"959"},"to":{"field":"region","value":"qm"}},{"from":{"field":"region","value":"960"},"to":{"field":"region","value":"qn"}},{"from":{"field":"region","value":"962"},"to":{"field":"region","value":"qp"}},{"from":{"field":"region","value":"963"},"to":{"field":"region","value":"qq"}},{"from":{"field":"region","value":"964"},"to":{"field":"region","value":"qr"}},{"from":{"field":"region","value":"965"},"to":{"field":"region","value":"qs"}},{"from":{"field":"region","value":"966"},"to":{"field":"region","value":"qt"}},{"from":{"field":"region","value":"967"},"to":{"field":"region","value":"eu"}},{"from":{"field":"region","value":"968"},"to":{"field":"region","value":"qv"}},{"from":{"field":"region","value":"969"},"to":{"field":"region","value":"qw"}},{"from":{"field":"region","value":"970"},"to":{"field":"region","value":"qx"}},{"from":{"field":"region","value":"971"},"to":{"field":"region","value":"qy"}},{"from":{"field":"region","value":"972"},"to":{"field":"region","value":"qz"}},{"from":{"field":"region","value":"638"},"to":{"field":"region","value":"re"}},{"from":{"field":"region","value":"642"},"to":{"field":"region","value":"ro"}},{"from":{"field":"region","value":"688"},"to":{"field":"region","value":"rs"}},{"from":{"field":"region","value":"643"},"to":{"field":"region","value":"ru"}},{"from":{"field":"region","value":"646"},"to":{"field":"region","value":"rw"}},{"from":{"field":"region","value":"682"},"to":{"field":"region","value":"sa"}},{"from":{"field":"region","value":"090"},"to":{"field":"region","value":"sb"}},{"from":{"field":"region","value":"690"},"to":{"field":"region","value":"sc"}},{"from":{"field":"region","value":"729"},"to":{"field":"region","value":"sd"}},{"from":{"field":"region","value":"752"},"to":{"field":"region","value":"se"}},{"from":{"field":"region","value":"702"},"to":{"field":"region","value":"sg"}},{"from":{"field":"region","value":"654"},"to":{"field":"region","value":"sh"}},{"from":{"field":"region","value":"705"},"to":{"field":"region","value":"si"}},{"from":{"field":"region","value":"744"},"to":{"field":"region","value":"sj"}},{"from":{"field":"region","value":"703"},"to":{"field":"region","value":"sk"}},{"from":{"field":"region","value":"694"},"to":{"field":"region","value":"sl"}},{"from":{"field":"region","value":"674"},"to":{"field":"region","value":"sm"}},{"from":{"field":"region","value":"686"},"to":{"field":"region","value":"sn"}},{"from":{"field":"region","value":"706"},"to":{"field":"region","value":"so"}},{"from":{"field":"region","value":"740"},"to":{"field":"region","value":"sr"}},{"from":{"field":"region","value":"728"},"to":{"field":"region","value":"ss"}},{"from":{"field":"region","value":"678"},"to":{"field":"region","value":"st"}},{"from":{"field":"region","value":"222"},"to":{"field":"region","value":"sv"}},{"from":{"field":"region","value":"534"},"to":{"field":"region","value":"sx"}},{"from":{"field":"region","value":"760"},"to":{"field":"region","value":"sy"}},{"from":{"field":"region","value":"748"},"to":{"field":"region","value":"sz"}},{"from":{"field":"region","value":"796"},"to":{"field":"region","value":"tc"}},{"from":{"field":"region","value":"148"},"to":{"field":"region","value":"td"}},{"from":{"field":"region","value":"260"},"to":{"field":"region","value":"tf"}},{"from":{"field":"region","value":"768"},"to":{"field":"region","value":"tg"}},{"from":{"field":"region","value":"764"},"to":{"field":"region","value":"th"}},{"from":{"field":"region","value":"762"},"to":{"field":"region","value":"tj"}},{"from":{"field":"region","value":"772"},"to":{"field":"region","value":"tk"}},{"from":{"field":"region","value":"626"},"to":{"field":"region","value":"tl"}},{"from":{"field":"region","value":"795"},"to":{"field":"region","value":"tm"}},{"from":{"field":"region","value":"788"},"to":{"field":"region","value":"tn"}},{"from":{"field":"region","value":"776"},"to":{"field":"region","value":"to"}},{"from":{"field":"region","value":"792"},"to":{"field":"region","value":"tr"}},{"from":{"field":"region","value":"780"},"to":{"field":"region","value":"tt"}},{"from":{"field":"region","value":"798"},"to":{"field":"region","value":"tv"}},{"from":{"field":"region","value":"158"},"to":{"field":"region","value":"tw"}},{"from":{"field":"region","value":"834"},"to":{"field":"region","value":"tz"}},{"from":{"field":"region","value":"804"},"to":{"field":"region","value":"ua"}},{"from":{"field":"region","value":"800"},"to":{"field":"region","value":"ug"}},{"from":{"field":"region","value":"581"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"840"},"to":{"field":"region","value":"us"}},{"from":{"field":"region","value":"858"},"to":{"field":"region","value":"uy"}},{"from":{"field":"region","value":"860"},"to":{"field":"region","value":"uz"}},{"from":{"field":"region","value":"336"},"to":{"field":"region","value":"va"}},{"from":{"field":"region","value":"670"},"to":{"field":"region","value":"vc"}},{"from":{"field":"region","value":"862"},"to":{"field":"region","value":"ve"}},{"from":{"field":"region","value":"092"},"to":{"field":"region","value":"vg"}},{"from":{"field":"region","value":"850"},"to":{"field":"region","value":"vi"}},{"from":{"field":"region","value":"704"},"to":{"field":"region","value":"vn"}},{"from":{"field":"region","value":"548"},"to":{"field":"region","value":"vu"}},{"from":{"field":"region","value":"876"},"to":{"field":"region","value":"wf"}},{"from":{"field":"region","value":"882"},"to":{"field":"region","value":"ws"}},{"from":{"field":"region","value":"973"},"to":{"field":"region","value":"xa"}},{"from":{"field":"region","value":"974"},"to":{"field":"region","value":"xb"}},{"from":{"field":"region","value":"975"},"to":{"field":"region","value":"xc"}},{"from":{"field":"region","value":"976"},"to":{"field":"region","value":"xd"}},{"from":{"field":"region","value":"977"},"to":{"field":"region","value":"xe"}},{"from":{"field":"region","value":"978"},"to":{"field":"region","value":"xf"}},{"from":{"field":"region","value":"979"},"to":{"field":"region","value":"xg"}},{"from":{"field":"region","value":"980"},"to":{"field":"region","value":"xh"}},{"from":{"field":"region","value":"981"},"to":{"field":"region","value":"xi"}},{"from":{"field":"region","value":"982"},"to":{"field":"region","value":"xj"}},{"from":{"field":"region","value":"983"},"to":{"field":"region","value":"xk"}},{"from":{"field":"region","value":"984"},"to":{"field":"region","value":"xl"}},{"from":{"field":"region","value":"985"},"to":{"field":"region","value":"xm"}},{"from":{"field":"region","value":"986"},"to":{"field":"region","value":"xn"}},{"from":{"field":"region","value":"987"},"to":{"field":"region","value":"xo"}},{"from":{"field":"region","value":"988"},"to":{"field":"region","value":"xp"}},{"from":{"field":"region","value":"989"},"to":{"field":"region","value":"xq"}},{"from":{"field":"region","value":"990"},"to":{"field":"region","value":"xr"}},{"from":{"field":"region","value":"991"},"to":{"field":"region","value":"xs"}},{"from":{"field":"region","value":"992"},"to":{"field":"region","value":"xt"}},{"from":{"field":"region","value":"993"},"to":{"field":"region","value":"xu"}},{"from":{"field":"region","value":"994"},"to":{"field":"region","value":"xv"}},{"from":{"field":"region","value":"995"},"to":{"field":"region","value":"xw"}},{"from":{"field":"region","value":"996"},"to":{"field":"region","value":"xx"}},{"from":{"field":"region","value":"997"},"to":{"field":"region","value":"xy"}},{"from":{"field":"region","value":"998"},"to":{"field":"region","value":"xz"}},{"from":{"field":"region","value":"720"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"887"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"175"},"to":{"field":"region","value":"yt"}},{"from":{"field":"region","value":"710"},"to":{"field":"region","value":"za"}},{"from":{"field":"region","value":"894"},"to":{"field":"region","value":"zm"}},{"from":{"field":"region","value":"716"},"to":{"field":"region","value":"zw"}},{"from":{"field":"region","value":"999"},"to":{"field":"region","value":"zz"}},{"from":{"field":"variants","value":"aaland"},"to":{"field":"region","value":"ax"}},{"from":{"field":"variants","value":"polytoni"},"to":{"field":"variants","value":"polyton"}},{"from":{"field":"variants","value":"heploc"},"to":{"field":"variants","value":"alalc97"}},{"from":{"field":"variants","value":"arevela"},"to":{"field":"language","value":"hy"}},{"from":{"field":"variants","value":"arevmda"},"to":{"field":"language","value":"hyw"}}]')},"./node_modules/bcp-47-normalize/lib/many.json":e=>{"use strict";e.exports=JSON.parse('{"region":{"172":["ru","am","az","by","ge","kg","kz","md","tj","tm","ua","uz"],"200":["cz","sk"],"530":["cw","sx","bq"],"532":["cw","sx","bq"],"536":["sa","iq"],"582":["fm","mh","mp","pw"],"810":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"830":["je","gg"],"890":["rs","me","si","hr","mk","ba"],"891":["rs","me"],"an":["cw","sx","bq"],"cs":["rs","me"],"fq":["aq","tf"],"nt":["sa","iq"],"pc":["fm","mh","mp","pw"],"su":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"yu":["rs","me"],"062":["034","143"],"ant":["cw","sx","bq"],"scg":["rs","me"],"ntz":["sa","iq"],"sun":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"yug":["rs","me"]}}')},"./node_modules/bcp-47-normalize/lib/matches.json":e=>{"use strict";e.exports=JSON.parse('[{"from":"in","to":"id"},{"from":"iw","to":"he"},{"from":"ji","to":"yi"},{"from":"jw","to":"jv"},{"from":"mo","to":"ro"},{"from":"scc","to":"sr"},{"from":"scr","to":"hr"},{"from":"aam","to":"aas"},{"from":"adp","to":"dz"},{"from":"aue","to":"ktz"},{"from":"ayx","to":"nun"},{"from":"bgm","to":"bcg"},{"from":"bjd","to":"drl"},{"from":"ccq","to":"rki"},{"from":"cjr","to":"mom"},{"from":"cka","to":"cmr"},{"from":"cmk","to":"xch"},{"from":"coy","to":"pij"},{"from":"cqu","to":"quh"},{"from":"drh","to":"mn"},{"from":"drw","to":"fa-af"},{"from":"gav","to":"dev"},{"from":"gfx","to":"vaj"},{"from":"ggn","to":"gvr"},{"from":"gti","to":"nyc"},{"from":"guv","to":"duz"},{"from":"hrr","to":"jal"},{"from":"ibi","to":"opa"},{"from":"ilw","to":"gal"},{"from":"jeg","to":"oyb"},{"from":"kgc","to":"tdf"},{"from":"kgh","to":"kml"},{"from":"koj","to":"kwv"},{"from":"krm","to":"bmf"},{"from":"ktr","to":"dtp"},{"from":"kvs","to":"gdj"},{"from":"kwq","to":"yam"},{"from":"kxe","to":"tvd"},{"from":"kzj","to":"dtp"},{"from":"kzt","to":"dtp"},{"from":"lii","to":"raq"},{"from":"lmm","to":"rmx"},{"from":"meg","to":"cir"},{"from":"mst","to":"mry"},{"from":"mwj","to":"vaj"},{"from":"myt","to":"mry"},{"from":"nad","to":"xny"},{"from":"ncp","to":"kdz"},{"from":"nnx","to":"ngv"},{"from":"nts","to":"pij"},{"from":"oun","to":"vaj"},{"from":"pcr","to":"adx"},{"from":"pmc","to":"huw"},{"from":"pmu","to":"phr"},{"from":"ppa","to":"bfy"},{"from":"ppr","to":"lcq"},{"from":"pry","to":"prt"},{"from":"puz","to":"pub"},{"from":"sca","to":"hle"},{"from":"skk","to":"oyb"},{"from":"tdu","to":"dtp"},{"from":"thc","to":"tpo"},{"from":"thx","to":"oyb"},{"from":"tie","to":"ras"},{"from":"tkk","to":"twm"},{"from":"tlw","to":"weo"},{"from":"tmp","to":"tyj"},{"from":"tne","to":"kak"},{"from":"tnf","to":"fa-af"},{"from":"tsf","to":"taj"},{"from":"uok","to":"ema"},{"from":"xba","to":"cax"},{"from":"xia","to":"acn"},{"from":"xkh","to":"waw"},{"from":"xsj","to":"suj"},{"from":"ybd","to":"rki"},{"from":"yma","to":"lrr"},{"from":"ymt","to":"mtm"},{"from":"yos","to":"zom"},{"from":"yuu","to":"yug"},{"from":"asd","to":"snz"},{"from":"dit","to":"dif"},{"from":"llo","to":"ngt"},{"from":"myd","to":"aog"},{"from":"nns","to":"nbr"},{"from":"sgn-br","to":"bzs"},{"from":"sgn-co","to":"csn"},{"from":"sgn-de","to":"gsg"},{"from":"sgn-dk","to":"dsl"},{"from":"sgn-fr","to":"fsl"},{"from":"sgn-gb","to":"bfi"},{"from":"sgn-gr","to":"gss"},{"from":"sgn-ie","to":"isg"},{"from":"sgn-it","to":"ise"},{"from":"sgn-jp","to":"jsl"},{"from":"sgn-mx","to":"mfs"},{"from":"sgn-ni","to":"ncs"},{"from":"sgn-nl","to":"dse"},{"from":"sgn-no","to":"nsi"},{"from":"sgn-pt","to":"psr"},{"from":"sgn-se","to":"swl"},{"from":"sgn-us","to":"ase"},{"from":"sgn-za","to":"sfs"},{"from":"no-bokmal","to":"nb"},{"from":"no-nynorsk","to":"nn"},{"from":"aa-saaho","to":"ssy"},{"from":"sh","to":"sr-latn"},{"from":"cnr","to":"sr-me"},{"from":"no","to":"nb"},{"from":"tl","to":"fil"},{"from":"az-az","to":"az-latn-az"},{"from":"bs-ba","to":"bs-latn-ba"},{"from":"ha-latn-gh","to":"ha-gh"},{"from":"ha-latn-ne","to":"ha-ne"},{"from":"ha-latn-ng","to":"ha-ng"},{"from":"kk-cyrl-kz","to":"kk-kz"},{"from":"ky-cyrl-kg","to":"ky-kg"},{"from":"ks-arab-in","to":"ks-in"},{"from":"mn-cyrl-mn","to":"mn-mn"},{"from":"ms-latn-bn","to":"ms-bn"},{"from":"ms-latn-my","to":"ms-my"},{"from":"ms-latn-sg","to":"ms-sg"},{"from":"pa-in","to":"pa-guru-in"},{"from":"pa-pk","to":"pa-arab-pk"},{"from":"shi-ma","to":"shi-tfng-ma"},{"from":"sr-ba","to":"sr-cyrl-ba"},{"from":"sr-me","to":"sr-latn-me"},{"from":"sr-rs","to":"sr-cyrl-rs"},{"from":"sr-xk","to":"sr-cyrl-xk"},{"from":"tzm-latn-ma","to":"tzm-ma"},{"from":"ug-arab-cn","to":"ug-cn"},{"from":"uz-af","to":"uz-arab-af"},{"from":"uz-uz","to":"uz-latn-uz"},{"from":"vai-lr","to":"vai-vaii-lr"},{"from":"yue-cn","to":"yue-hans-cn"},{"from":"yue-hk","to":"yue-hant-hk"},{"from":"zh-cn","to":"zh-hans-cn"},{"from":"zh-hk","to":"zh-hant-hk"},{"from":"zh-mo","to":"zh-hant-mo"},{"from":"zh-sg","to":"zh-hans-sg"},{"from":"zh-tw","to":"zh-hant-tw"},{"from":"aju","to":"jrb"},{"from":"als","to":"sq"},{"from":"arb","to":"ar"},{"from":"ayr","to":"ay"},{"from":"azj","to":"az"},{"from":"bcc","to":"bal"},{"from":"bcl","to":"bik"},{"from":"bxk","to":"luy"},{"from":"bxr","to":"bua"},{"from":"cld","to":"syr"},{"from":"cmn","to":"zh"},{"from":"cwd","to":"cr"},{"from":"dgo","to":"doi"},{"from":"dhd","to":"mwr"},{"from":"dik","to":"din"},{"from":"diq","to":"zza"},{"from":"lbk","to":"bnc"},{"from":"ekk","to":"et"},{"from":"emk","to":"man"},{"from":"esk","to":"ik"},{"from":"fat","to":"ak"},{"from":"fuc","to":"ff"},{"from":"gaz","to":"om"},{"from":"gbo","to":"grb"},{"from":"gno","to":"gon"},{"from":"gug","to":"gn"},{"from":"gya","to":"gba"},{"from":"hdn","to":"hai"},{"from":"hea","to":"hmn"},{"from":"ike","to":"iu"},{"from":"kmr","to":"ku"},{"from":"knc","to":"kr"},{"from":"kng","to":"kg"},{"from":"knn","to":"kok"},{"from":"kpv","to":"kv"},{"from":"lvs","to":"lv"},{"from":"mhr","to":"chm"},{"from":"mup","to":"raj"},{"from":"khk","to":"mn"},{"from":"npi","to":"ne"},{"from":"ojg","to":"oj"},{"from":"ory","to":"or"},{"from":"pbu","to":"ps"},{"from":"pes","to":"fa"},{"from":"plt","to":"mg"},{"from":"pnb","to":"lah"},{"from":"quz","to":"qu"},{"from":"rmy","to":"rom"},{"from":"spy","to":"kln"},{"from":"src","to":"sc"},{"from":"swh","to":"sw"},{"from":"ttq","to":"tmh"},{"from":"tw","to":"ak"},{"from":"umu","to":"del"},{"from":"uzn","to":"uz"},{"from":"xpe","to":"kpe"},{"from":"xsl","to":"den"},{"from":"ydd","to":"yi"},{"from":"zai","to":"zap"},{"from":"zsm","to":"ms"},{"from":"zyb","to":"za"},{"from":"him","to":"srx"},{"from":"mnk","to":"man"},{"from":"bh","to":"bho"},{"from":"prs","to":"fa-af"},{"from":"swc","to":"sw-cd"},{"from":"aar","to":"aa"},{"from":"abk","to":"ab"},{"from":"ave","to":"ae"},{"from":"afr","to":"af"},{"from":"aka","to":"ak"},{"from":"amh","to":"am"},{"from":"arg","to":"an"},{"from":"ara","to":"ar"},{"from":"asm","to":"as"},{"from":"ava","to":"av"},{"from":"aym","to":"ay"},{"from":"aze","to":"az"},{"from":"bak","to":"ba"},{"from":"bel","to":"be"},{"from":"bul","to":"bg"},{"from":"bih","to":"bho"},{"from":"bis","to":"bi"},{"from":"bam","to":"bm"},{"from":"ben","to":"bn"},{"from":"bod","to":"bo"},{"from":"bre","to":"br"},{"from":"bos","to":"bs"},{"from":"cat","to":"ca"},{"from":"che","to":"ce"},{"from":"cha","to":"ch"},{"from":"cos","to":"co"},{"from":"cre","to":"cr"},{"from":"ces","to":"cs"},{"from":"chu","to":"cu"},{"from":"chv","to":"cv"},{"from":"cym","to":"cy"},{"from":"dan","to":"da"},{"from":"deu","to":"de"},{"from":"div","to":"dv"},{"from":"dzo","to":"dz"},{"from":"ewe","to":"ee"},{"from":"ell","to":"el"},{"from":"eng","to":"en"},{"from":"epo","to":"eo"},{"from":"spa","to":"es"},{"from":"est","to":"et"},{"from":"eus","to":"eu"},{"from":"fas","to":"fa"},{"from":"ful","to":"ff"},{"from":"fin","to":"fi"},{"from":"fij","to":"fj"},{"from":"fao","to":"fo"},{"from":"fra","to":"fr"},{"from":"fry","to":"fy"},{"from":"gle","to":"ga"},{"from":"gla","to":"gd"},{"from":"glg","to":"gl"},{"from":"grn","to":"gn"},{"from":"guj","to":"gu"},{"from":"glv","to":"gv"},{"from":"hau","to":"ha"},{"from":"heb","to":"he"},{"from":"hin","to":"hi"},{"from":"hmo","to":"ho"},{"from":"hrv","to":"hr"},{"from":"hat","to":"ht"},{"from":"hun","to":"hu"},{"from":"hye","to":"hy"},{"from":"her","to":"hz"},{"from":"ina","to":"ia"},{"from":"ind","to":"id"},{"from":"ile","to":"ie"},{"from":"ibo","to":"ig"},{"from":"iii","to":"ii"},{"from":"ipk","to":"ik"},{"from":"ido","to":"io"},{"from":"isl","to":"is"},{"from":"ita","to":"it"},{"from":"iku","to":"iu"},{"from":"jpn","to":"ja"},{"from":"jav","to":"jv"},{"from":"kat","to":"ka"},{"from":"kon","to":"kg"},{"from":"kik","to":"ki"},{"from":"kua","to":"kj"},{"from":"kaz","to":"kk"},{"from":"kal","to":"kl"},{"from":"khm","to":"km"},{"from":"kan","to":"kn"},{"from":"kor","to":"ko"},{"from":"kau","to":"kr"},{"from":"kas","to":"ks"},{"from":"kur","to":"ku"},{"from":"kom","to":"kv"},{"from":"cor","to":"kw"},{"from":"kir","to":"ky"},{"from":"lat","to":"la"},{"from":"ltz","to":"lb"},{"from":"lug","to":"lg"},{"from":"lim","to":"li"},{"from":"lin","to":"ln"},{"from":"lao","to":"lo"},{"from":"lit","to":"lt"},{"from":"lub","to":"lu"},{"from":"lav","to":"lv"},{"from":"mlg","to":"mg"},{"from":"mah","to":"mh"},{"from":"mri","to":"mi"},{"from":"mkd","to":"mk"},{"from":"mal","to":"ml"},{"from":"mon","to":"mn"},{"from":"mol","to":"ro"},{"from":"mar","to":"mr"},{"from":"msa","to":"ms"},{"from":"mlt","to":"mt"},{"from":"mya","to":"my"},{"from":"nau","to":"na"},{"from":"nob","to":"nb"},{"from":"nde","to":"nd"},{"from":"nep","to":"ne"},{"from":"ndo","to":"ng"},{"from":"nld","to":"nl"},{"from":"nno","to":"nn"},{"from":"nor","to":"nb"},{"from":"nbl","to":"nr"},{"from":"nav","to":"nv"},{"from":"nya","to":"ny"},{"from":"oci","to":"oc"},{"from":"oji","to":"oj"},{"from":"orm","to":"om"},{"from":"ori","to":"or"},{"from":"oss","to":"os"},{"from":"pan","to":"pa"},{"from":"pli","to":"pi"},{"from":"pol","to":"pl"},{"from":"pus","to":"ps"},{"from":"por","to":"pt"},{"from":"que","to":"qu"},{"from":"roh","to":"rm"},{"from":"run","to":"rn"},{"from":"ron","to":"ro"},{"from":"rus","to":"ru"},{"from":"kin","to":"rw"},{"from":"san","to":"sa"},{"from":"srd","to":"sc"},{"from":"snd","to":"sd"},{"from":"sme","to":"se"},{"from":"sag","to":"sg"},{"from":"hbs","to":"sr-latn"},{"from":"sin","to":"si"},{"from":"slk","to":"sk"},{"from":"slv","to":"sl"},{"from":"smo","to":"sm"},{"from":"sna","to":"sn"},{"from":"som","to":"so"},{"from":"sqi","to":"sq"},{"from":"srp","to":"sr"},{"from":"ssw","to":"ss"},{"from":"sot","to":"st"},{"from":"sun","to":"su"},{"from":"swe","to":"sv"},{"from":"swa","to":"sw"},{"from":"tam","to":"ta"},{"from":"tel","to":"te"},{"from":"tgk","to":"tg"},{"from":"tha","to":"th"},{"from":"tir","to":"ti"},{"from":"tuk","to":"tk"},{"from":"tgl","to":"fil"},{"from":"tsn","to":"tn"},{"from":"ton","to":"to"},{"from":"tur","to":"tr"},{"from":"tso","to":"ts"},{"from":"tat","to":"tt"},{"from":"twi","to":"ak"},{"from":"tah","to":"ty"},{"from":"uig","to":"ug"},{"from":"ukr","to":"uk"},{"from":"urd","to":"ur"},{"from":"uzb","to":"uz"},{"from":"ven","to":"ve"},{"from":"vie","to":"vi"},{"from":"vol","to":"vo"},{"from":"wln","to":"wa"},{"from":"wol","to":"wo"},{"from":"xho","to":"xh"},{"from":"yid","to":"yi"},{"from":"yor","to":"yo"},{"from":"zha","to":"za"},{"from":"zho","to":"zh"},{"from":"zul","to":"zu"},{"from":"alb","to":"sq"},{"from":"arm","to":"hy"},{"from":"baq","to":"eu"},{"from":"bur","to":"my"},{"from":"chi","to":"zh"},{"from":"cze","to":"cs"},{"from":"dut","to":"nl"},{"from":"fre","to":"fr"},{"from":"geo","to":"ka"},{"from":"ger","to":"de"},{"from":"gre","to":"el"},{"from":"ice","to":"is"},{"from":"mac","to":"mk"},{"from":"mao","to":"mi"},{"from":"may","to":"ms"},{"from":"per","to":"fa"},{"from":"rum","to":"ro"},{"from":"slo","to":"sk"},{"from":"tib","to":"bo"},{"from":"wel","to":"cy"}]')},"./node_modules/bcp-47/lib/normalize.json":e=>{"use strict";e.exports=JSON.parse('{"en-gb-oed":"en-GB-oxendict","i-ami":"ami","i-bnn":"bnn","i-default":null,"i-enochian":null,"i-hak":"hak","i-klingon":"tlh","i-lux":"lb","i-mingo":null,"i-navajo":"nv","i-pwn":"pwn","i-tao":"tao","i-tay":"tay","i-tsu":"tsu","sgn-be-fr":"sfb","sgn-be-nl":"vgt","sgn-ch-de":"sgg","art-lojban":"jbo","cel-gaulish":null,"no-bok":"nb","no-nyn":"nn","zh-guoyu":"cmn","zh-hakka":"hak","zh-min":null,"zh-min-nan":"nan","zh-xiang":"hsn"}')},"./node_modules/bcp-47/lib/regular.json":e=>{"use strict";e.exports=JSON.parse('["art-lojban","cel-gaulish","no-bok","no-nyn","zh-guoyu","zh-hakka","zh-min","zh-min-nan","zh-xiang"]')}},n={};function i(e){var r=n[e];if(void 0!==r)return r.exports;var o=n[e]={exports:{}};return t[e].call(o.exports,o,o.exports,i),o.exports}i.amdO={},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return(()=>{"use strict";i.r(o),i.d(o,{Debug:()=>a.default,MediaPlayer:()=>e.MediaPlayer,MediaPlayerFactory:()=>s.default,MetricsReporting:()=>n.default,Protection:()=>r.default,default:()=>l,supportsMediaSource:()=>t.supportsMediaSource});var e=i("./index_mediaplayerOnly.js"),t=i("./src/streaming/utils/Capabilities.js"),n=i("./src/streaming/metrics/MetricsReporting.js"),r=i("./src/streaming/protection/Protection.js"),s=i("./src/streaming/MediaPlayerFactory.js"),a=i("./src/core/Debug.js");dashjs.Protection=r.default,dashjs.MetricsReporting=n.default,dashjs.MediaPlayerFactory=s.default,dashjs.Debug=a.default,dashjs.supportsMediaSource=t.supportsMediaSource;const l=dashjs})(),o.default})(),"object"==typeof n&&"object"==typeof t?t.exports=o():"function"==typeof define&&define.amd?define([],o):"object"==typeof n?n.dashjs=o():i.dashjs=o()}).call(this)}).call(this,e("_process"),e("buffer").Buffer)},{_process:303,buffer:226}],232:[function(e,t,n){var r=e("abstract-leveldown").AbstractIterator;function i(e){r.call(this,e),this._options=e,this._iterator=null,this._operations=[]}e("inherits")(i,r),i.prototype.setDb=function(e){var t=this._iterator=e.iterator(this._options);this._operations.forEach((function(e){t[e.method].apply(t,e.args)}))},i.prototype._operation=function(e,t){if(this._iterator)return this._iterator[e].apply(this._iterator,t);this._operations.push({method:e,args:t})},"next end".split(" ").forEach((function(e){i.prototype["_"+e]=function(){this._operation(e,arguments)}})),i.prototype.seek=function(){this._operation("seek",arguments)},t.exports=i},{"abstract-leveldown":237,inherits:247}],233:[function(e,t,n){var r=e("abstract-leveldown").AbstractLevelDOWN,i=e("inherits"),o=e("./deferred-iterator"),s="put get del batch".split(" ");function a(e){r.call(this,""),this._db=e,this._operations=[],this._iterators=[],l(this)}function l(e){s.forEach((function(t){e["_"+t]=function(){this._operations.push({method:t,args:arguments})}})),"function"==typeof e._db.approximateSize&&(e.approximateSize=function(){this._operations.push({method:"approximateSize",args:arguments})}),e._iterator=function(e){var t=new o(e);return this._iterators.push(t),t}}i(a,r),a.prototype._open=function(e,t){var n=this;this._db.open(e,(function(e){if(e)return t(e);n._operations.forEach((function(e){n._db[e.method].apply(n._db,e.args)})),n._operations=[],n._iterators.forEach((function(e){e.setDb(n._db)})),n._iterators=[],function(e){s.concat("iterator").forEach((function(t){e["_"+t]=function(){return this._db[t].apply(this._db,arguments)}})),e._db.approximateSize&&(e.approximateSize=function(){return this._db.approximateSize.apply(this._db,arguments)})}(n),t()}))},a.prototype._close=function(e){var t=this;this._db.close((function(n){if(n)return e(n);l(t),e()}))},a.prototype._serializeKey=function(e){return e},a.prototype._serializeValue=function(e){return e},t.exports=a,t.exports.DeferredIterator=o},{"./deferred-iterator":232,"abstract-leveldown":237,inherits:247}],234:[function(e,t,n){function r(e){if("object"!=typeof e||null===e)throw new TypeError("First argument must be an abstract-leveldown compliant store");this.db=e,this._operations=[],this._written=!1}r.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},r.prototype.put=function(e,t){this._checkWritten();var n=this.db._checkKey(e)||this.db._checkValue(t);if(n)throw n;return e=this.db._serializeKey(e),t=this.db._serializeValue(t),this._put(e,t),this},r.prototype._put=function(e,t){this._operations.push({type:"put",key:e,value:t})},r.prototype.del=function(e){this._checkWritten();var t=this.db._checkKey(e);if(t)throw t;return e=this.db._serializeKey(e),this._del(e),this},r.prototype._del=function(e){this._operations.push({type:"del",key:e})},r.prototype.clear=function(){return this._checkWritten(),this._clear(),this},r.prototype._clear=function(){this._operations=[]},r.prototype.write=function(e,t){if(this._checkWritten(),"function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("write() requires a callback argument");"object"==typeof e&&null!==e||(e={}),this._written=!0,this._write(e,t)},r.prototype._write=function(e,t){this.db._batch(this._operations,e,t)},t.exports=r},{}],235:[function(e,t,n){(function(e){(function(){function n(e){if("object"!=typeof e||null===e)throw new TypeError("First argument must be an abstract-leveldown compliant store");this.db=e,this._ended=!1,this._nexting=!1}n.prototype.next=function(t){var n=this;if("function"!=typeof t)throw new Error("next() requires a callback argument");return n._ended?(e.nextTick(t,new Error("cannot call next() after end()")),n):n._nexting?(e.nextTick(t,new Error("cannot call next() before previous next() has completed")),n):(n._nexting=!0,n._next((function(){n._nexting=!1,t.apply(null,arguments)})),n)},n.prototype._next=function(t){e.nextTick(t)},n.prototype.seek=function(e){if(this._ended)throw new Error("cannot call seek() after end()");if(this._nexting)throw new Error("cannot call seek() before next() has completed");e=this.db._serializeKey(e),this._seek(e)},n.prototype._seek=function(e){},n.prototype.end=function(t){if("function"!=typeof t)throw new Error("end() requires a callback argument");if(this._ended)return e.nextTick(t,new Error("end() already called on iterator"));this._ended=!0,this._end(t)},n.prototype._end=function(t){e.nextTick(t)},t.exports=n}).call(this)}).call(this,e("_process"))},{_process:303}],236:[function(e,t,n){(function(n,r){(function(){var i=e("xtend"),o=e("./abstract-iterator"),s=e("./abstract-chained-batch"),a=Object.prototype.hasOwnProperty,l="start end gt gte lt lte".split(" ");function c(){this.status="new"}function u(e){return-1!==l.indexOf(e)}c.prototype.open=function(e,t){var n=this,r=this.status;if("function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("open() requires a callback argument");"object"==typeof e&&null!==e||(e={}),e.createIfMissing=!1!==e.createIfMissing,e.errorIfExists=!!e.errorIfExists,this.status="opening",this._open(e,(function(e){if(e)return n.status=r,t(e);n.status="open",t()}))},c.prototype._open=function(e,t){r.nextTick(t)},c.prototype.close=function(e){var t=this,n=this.status;if("function"!=typeof e)throw new Error("close() requires a callback argument");this.status="closing",this._close((function(r){if(r)return t.status=n,e(r);t.status="closed",e()}))},c.prototype._close=function(e){r.nextTick(e)},c.prototype.get=function(e,t,n){if("function"==typeof t&&(n=t),"function"!=typeof n)throw new Error("get() requires a callback argument");var i=this._checkKey(e);if(i)return r.nextTick(n,i);e=this._serializeKey(e),"object"==typeof t&&null!==t||(t={}),t.asBuffer=!1!==t.asBuffer,this._get(e,t,n)},c.prototype._get=function(e,t,n){r.nextTick((function(){n(new Error("NotFound"))}))},c.prototype.put=function(e,t,n,i){if("function"==typeof n&&(i=n),"function"!=typeof i)throw new Error("put() requires a callback argument");var o=this._checkKey(e)||this._checkValue(t);if(o)return r.nextTick(i,o);e=this._serializeKey(e),t=this._serializeValue(t),"object"==typeof n&&null!==n||(n={}),this._put(e,t,n,i)},c.prototype._put=function(e,t,n,i){r.nextTick(i)},c.prototype.del=function(e,t,n){if("function"==typeof t&&(n=t),"function"!=typeof n)throw new Error("del() requires a callback argument");var i=this._checkKey(e);if(i)return r.nextTick(n,i);e=this._serializeKey(e),"object"==typeof t&&null!==t||(t={}),this._del(e,t,n)},c.prototype._del=function(e,t,n){r.nextTick(n)},c.prototype.batch=function(e,t,n){if(!arguments.length)return this._chainedBatch();if("function"==typeof t&&(n=t),"function"==typeof e&&(n=e),"function"!=typeof n)throw new Error("batch(array) requires a callback argument");if(!Array.isArray(e))return r.nextTick(n,new Error("batch(array) requires an array argument"));if(0===e.length)return r.nextTick(n);"object"==typeof t&&null!==t||(t={});for(var o=new Array(e.length),s=0;s<e.length;s++){if("object"!=typeof e[s]||null===e[s])return r.nextTick(n,new Error("batch(array) element must be an object and not `null`"));var a=i(e[s]);if("put"!==a.type&&"del"!==a.type)return r.nextTick(n,new Error("`type` must be 'put' or 'del'"));var l=this._checkKey(a.key);if(l)return r.nextTick(n,l);if(a.key=this._serializeKey(a.key),"put"===a.type){var c=this._checkValue(a.value);if(c)return r.nextTick(n,c);a.value=this._serializeValue(a.value)}o[s]=a}this._batch(o,t,n)},c.prototype._batch=function(e,t,n){r.nextTick(n)},c.prototype._setupIteratorOptions=function(e){return(e=function(e,t){var n={};for(var r in t)if(a.call(t,r)){var i=t[r];u(r)&&(i=e._serializeKey(i)),n[r]=i}return n}(this,e)).reverse=!!e.reverse,e.keys=!1!==e.keys,e.values=!1!==e.values,e.limit="limit"in e?e.limit:-1,e.keyAsBuffer=!1!==e.keyAsBuffer,e.valueAsBuffer=!1!==e.valueAsBuffer,e},c.prototype.iterator=function(e){return"object"==typeof e&&null!==e||(e={}),e=this._setupIteratorOptions(e),this._iterator(e)},c.prototype._iterator=function(e){return new o(this)},c.prototype._chainedBatch=function(){return new s(this)},c.prototype._serializeKey=function(e){return e},c.prototype._serializeValue=function(e){return e},c.prototype._checkKey=function(e){return null==e?new Error("key cannot be `null` or `undefined`"):n.isBuffer(e)&&0===e.length?new Error("key cannot be an empty Buffer"):""===e?new Error("key cannot be an empty String"):Array.isArray(e)&&0===e.length?new Error("key cannot be an empty Array"):void 0},c.prototype._checkValue=function(e){if(null==e)return new Error("value cannot be `null` or `undefined`")},t.exports=c}).call(this)}).call(this,{isBuffer:e("../../../is-buffer/index.js")},e("_process"))},{"../../../is-buffer/index.js":248,"./abstract-chained-batch":234,"./abstract-iterator":235,_process:303,xtend:450}],237:[function(e,t,n){n.AbstractLevelDOWN=e("./abstract-leveldown"),n.AbstractIterator=e("./abstract-iterator"),n.AbstractChainedBatch=e("./abstract-chained-batch")},{"./abstract-chained-batch":234,"./abstract-iterator":235,"./abstract-leveldown":236}],238:[function(e,t,n){"use strict";function r(e){if(this._capacity=o(e),this._length=0,this._front=0,i(e)){for(var t=e.length,n=0;n<t;++n)this[n]=e[n];this._length=t}}r.prototype.toArray=function(){for(var e=this._length,t=new Array(e),n=this._front,r=this._capacity,i=0;i<e;++i)t[i]=this[n+i&r-1];return t},r.prototype.push=function(e){var t=arguments.length,n=this._length;if(t>1){var r=this._capacity;if(n+t>r){for(var i=0;i<t;++i)this._checkCapacity(n+1),this[o=this._front+n&this._capacity-1]=arguments[i],n++,this._length=n;return n}var o=this._front;for(i=0;i<t;++i)this[o+n&r-1]=arguments[i],o++;return this._length=n+t,n+t}return 0===t?n:(this._checkCapacity(n+1),this[i=this._front+n&this._capacity-1]=e,this._length=n+1,n+1)},r.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,n=this[t];return this[t]=void 0,this._length=e-1,n}},r.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,n=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,n}},r.prototype.unshift=function(e){var t=this._length,n=arguments.length;if(n>1){if(t+n>(i=this._capacity)){for(var r=n-1;r>=0;r--){this._checkCapacity(t+1);var i=this._capacity;this[s=(this._front-1&i-1^i)-i]=arguments[r],t++,this._length=t,this._front=s}return t}var o=this._front;for(r=n-1;r>=0;r--){var s;this[s=(o-1&i-1^i)-i]=arguments[r],o=s}return this._front=o,this._length=t+n,t+n}return 0===n?t:(this._checkCapacity(t+1),i=this._capacity,this[r=(this._front-1&i-1^i)-i]=e,this._length=t+1,this._front=r,t+1)},r.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},r.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},r.prototype.get=function(e){var t=e;if(t===(0|t)){var n=this._length;if(t<0&&(t+=n),!(t<0||t>=n))return this[this._front+t&this._capacity-1]}},r.prototype.isEmpty=function(){return 0===this._length},r.prototype.clear=function(){for(var e=this._length,t=this._front,n=this._capacity,r=0;r<e;++r)this[t+r&n-1]=void 0;this._length=0,this._front=0},r.prototype.toString=function(){return this.toArray().toString()},r.prototype.valueOf=r.prototype.toString,r.prototype.removeFront=r.prototype.shift,r.prototype.removeBack=r.prototype.pop,r.prototype.insertFront=r.prototype.unshift,r.prototype.insertBack=r.prototype.push,r.prototype.enqueue=r.prototype.push,r.prototype.dequeue=r.prototype.shift,r.prototype.toJSON=r.prototype.toArray,Object.defineProperty(r.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),r.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(o(1.5*this._capacity+16))},r.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var n=this._front,r=this._length;n+r>t&&function(e,t,n,r,i){for(var o=0;o<i;++o)n[o+r]=e[o+t],e[o+t]=void 0}(this,0,this,t,n+r&t-1)};var i=Array.isArray;function o(e){if("number"!=typeof e){if(!i(e))return 16;e=e.length}return function(e){return e>>>=0,e-=1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,1+(e|e>>16)}(Math.min(Math.max(16,e),1073741824))}t.exports=r},{}],239:[function(e,t,n){var r=e("prr");function i(e,t,n){t&&"string"!=typeof t&&(t=t.message||t.name),r(this,{type:e,name:e,cause:"string"!=typeof t?t:n,message:t},"ewr")}function o(e,t){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),i.call(this,"CustomError",e,t)}o.prototype=new Error,t.exports=function(e){var t=function(t,n){return function(e,t,n){var r=function(n,o){i.call(this,t,n,o),"FilesystemError"==t&&(this.code=this.cause.code,this.path=this.cause.path,this.errno=this.cause.errno,this.message=(e.errno[this.cause.errno]?e.errno[this.cause.errno].description:this.cause.message)+(this.cause.path?" ["+this.cause.path+"]":"")),Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,r)};return r.prototype=n?new n:new o,r}(e,t,n)};return{CustomError:o,FilesystemError:t("FilesystemError"),createError:t}}},{prr:307}],240:[function(e,t,n){var r=t.exports.all=[{errno:-2,code:"ENOENT",description:"no such file or directory"},{errno:-1,code:"UNKNOWN",description:"unknown error"},{errno:0,code:"OK",description:"success"},{errno:1,code:"EOF",description:"end of file"},{errno:2,code:"EADDRINFO",description:"getaddrinfo error"},{errno:3,code:"EACCES",description:"permission denied"},{errno:4,code:"EAGAIN",description:"resource temporarily unavailable"},{errno:5,code:"EADDRINUSE",description:"address already in use"},{errno:6,code:"EADDRNOTAVAIL",description:"address not available"},{errno:7,code:"EAFNOSUPPORT",description:"address family not supported"},{errno:8,code:"EALREADY",description:"connection already in progress"},{errno:9,code:"EBADF",description:"bad file descriptor"},{errno:10,code:"EBUSY",description:"resource busy or locked"},{errno:11,code:"ECONNABORTED",description:"software caused connection abort"},{errno:12,code:"ECONNREFUSED",description:"connection refused"},{errno:13,code:"ECONNRESET",description:"connection reset by peer"},{errno:14,code:"EDESTADDRREQ",description:"destination address required"},{errno:15,code:"EFAULT",description:"bad address in system call argument"},{errno:16,code:"EHOSTUNREACH",description:"host is unreachable"},{errno:17,code:"EINTR",description:"interrupted system call"},{errno:18,code:"EINVAL",description:"invalid argument"},{errno:19,code:"EISCONN",description:"socket is already connected"},{errno:20,code:"EMFILE",description:"too many open files"},{errno:21,code:"EMSGSIZE",description:"message too long"},{errno:22,code:"ENETDOWN",description:"network is down"},{errno:23,code:"ENETUNREACH",description:"network is unreachable"},{errno:24,code:"ENFILE",description:"file table overflow"},{errno:25,code:"ENOBUFS",description:"no buffer space available"},{errno:26,code:"ENOMEM",description:"not enough memory"},{errno:27,code:"ENOTDIR",description:"not a directory"},{errno:28,code:"EISDIR",description:"illegal operation on a directory"},{errno:29,code:"ENONET",description:"machine is not on the network"},{errno:31,code:"ENOTCONN",description:"socket is not connected"},{errno:32,code:"ENOTSOCK",description:"socket operation on non-socket"},{errno:33,code:"ENOTSUP",description:"operation not supported on socket"},{errno:34,code:"ENOENT",description:"no such file or directory"},{errno:35,code:"ENOSYS",description:"function not implemented"},{errno:36,code:"EPIPE",description:"broken pipe"},{errno:37,code:"EPROTO",description:"protocol error"},{errno:38,code:"EPROTONOSUPPORT",description:"protocol not supported"},{errno:39,code:"EPROTOTYPE",description:"protocol wrong type for socket"},{errno:40,code:"ETIMEDOUT",description:"connection timed out"},{errno:41,code:"ECHARSET",description:"invalid Unicode character"},{errno:42,code:"EAIFAMNOSUPPORT",description:"address family for hostname not supported"},{errno:44,code:"EAISERVICE",description:"servname not supported for ai_socktype"},{errno:45,code:"EAISOCKTYPE",description:"ai_socktype not supported"},{errno:46,code:"ESHUTDOWN",description:"cannot send after transport endpoint shutdown"},{errno:47,code:"EEXIST",description:"file already exists"},{errno:48,code:"ESRCH",description:"no such process"},{errno:49,code:"ENAMETOOLONG",description:"name too long"},{errno:50,code:"EPERM",description:"operation not permitted"},{errno:51,code:"ELOOP",description:"too many symbolic links encountered"},{errno:52,code:"EXDEV",description:"cross-device link not permitted"},{errno:53,code:"ENOTEMPTY",description:"directory not empty"},{errno:54,code:"ENOSPC",description:"no space left on device"},{errno:55,code:"EIO",description:"i/o error"},{errno:56,code:"EROFS",description:"read-only file system"},{errno:57,code:"ENODEV",description:"no such device"},{errno:58,code:"ESPIPE",description:"invalid seek"},{errno:59,code:"ECANCELED",description:"operation canceled"}];t.exports.errno={},t.exports.code={},r.forEach((function(e){t.exports.errno[e.errno]=e,t.exports.code[e.code]=e})),t.exports.custom=e("./custom")(t.exports),t.exports.create=t.exports.custom.createError},{"./custom":239}],241:[function(e,t,n){var r=Object.create||function(e){var t=function(){};return t.prototype=e,new t},i=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n},o=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function s(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=r(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}t.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0;var a,l=10;try{var c={};Object.defineProperty&&Object.defineProperty(c,"x",{value:0}),a=0===c.x}catch(e){a=!1}function u(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function d(e,t,n){if(t)e.call(n);else for(var r=e.length,i=E(e,r),o=0;o<r;++o)i[o].call(n)}function p(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,o=E(e,i),s=0;s<i;++s)o[s].call(n,r)}function h(e,t,n,r,i){if(t)e.call(n,r,i);else for(var o=e.length,s=E(e,o),a=0;a<o;++a)s[a].call(n,r,i)}function f(e,t,n,r,i,o){if(t)e.call(n,r,i,o);else for(var s=e.length,a=E(e,s),l=0;l<s;++l)a[l].call(n,r,i,o)}function g(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,o=E(e,i),s=0;s<i;++s)o[s].apply(n,r)}function m(e,t,n,i){var o,s,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),a=s[t]):(s=e._events=r(null),e._eventsCount=0),a){if("function"==typeof a?a=s[t]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),!a.warned&&(o=u(e))&&o>0&&a.length>o){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",l.name,l.message)}}else a=s[t]=n,++e._eventsCount;return e}function v(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function y(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=o.call(v,r);return i.listener=n,r.wrapFn=i,i}function b(e,t,n){var r=e._events;if(!r)return[];var i=r[t];return i?"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):E(i,i.length):[]}function x(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function E(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}a?Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');l=e}}):s.defaultMaxListeners=l,s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(e){var t,n,r,i,o,s,a="error"===e;if(s=this._events)a=a&&null==s.error;else if(!a)return!1;if(a){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var l=new Error('Unhandled "error" event. ('+t+")");throw l.context=t,l}if(!(n=s[e]))return!1;var c="function"==typeof n;switch(r=arguments.length){case 1:d(n,c,this);break;case 2:p(n,c,this,arguments[1]);break;case 3:h(n,c,this,arguments[1],arguments[2]);break;case 4:f(n,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];g(n,c,this,i)}return!0},s.prototype.addListener=function(e,t){return m(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return m(this,e,t,!0)},s.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,y(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,y(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,i,o,s,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=r(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){a=n[s].listener,o=s;break}if(o<0)return this;0===o?n.shift():function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,o),1===n.length&&(i[e]=n[0]),i.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.removeAllListeners=function(e){var t,n,o;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=r(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=r(null):delete n[e]),this;if(0===arguments.length){var s,a=i(n);for(o=0;o<a.length;++o)"removeListener"!==(s=a[o])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=r(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(o=t.length-1;o>=0;o--)this.removeListener(e,t[o]);return this},s.prototype.listeners=function(e){return b(this,e,!0)},s.prototype.rawListeners=function(e){return b(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):x.call(e,t)},s.prototype.listenerCount=x,s.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],242:[function(e,t,n){!function(){"use strict";var e=!("undefined"==typeof window||!window.document||!window.document.createElement),n={canUseDOM:e,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:e&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:e&&!!window.screen};"function"==typeof define&&"object"==typeof define.amd&&define.amd?define((function(){return n})):void 0!==t&&t.exports?t.exports=n:window.ExecutionEnvironment=n}()},{}],243:[function(e,t,n){"use strict";t.exports=function(e){return new a(e||g,null)};function r(e,t,n,r,i,o){this._color=e,this.key=t,this.value=n,this.left=r,this.right=i,this._count=o}function i(e){return new r(e._color,e.key,e.value,e.left,e.right,e._count)}function o(e,t){return new r(e,t.key,t.value,t.left,t.right,t._count)}function s(e){e._count=1+(e.left?e.left._count:0)+(e.right?e.right._count:0)}function a(e,t){this._compare=e,this.root=t}var l=a.prototype;function c(e,t){var n;return t.left&&(n=c(e,t.left))?n:(n=e(t.key,t.value))||(t.right?c(e,t.right):void 0)}function u(e,t,n,r){if(t(e,r.key)<=0){var i;if(r.left&&(i=u(e,t,n,r.left)))return i;if(i=n(r.key,r.value))return i}if(r.right)return u(e,t,n,r.right)}function d(e,t,n,r,i){var o,s=n(e,i.key),a=n(t,i.key);if(s<=0){if(i.left&&(o=d(e,t,n,r,i.left)))return o;if(a>0&&(o=r(i.key,i.value)))return o}if(a>0&&i.right)return d(e,t,n,r,i.right)}function p(e,t){this.tree=e,this._stack=t}Object.defineProperty(l,"keys",{get:function(){var e=[];return this.forEach((function(t,n){e.push(t)})),e}}),Object.defineProperty(l,"values",{get:function(){var e=[];return this.forEach((function(t,n){e.push(n)})),e}}),Object.defineProperty(l,"length",{get:function(){return this.root?this.root._count:0}}),l.insert=function(e,t){for(var n=this._compare,i=this.root,l=[],c=[];i;){var u=n(e,i.key);l.push(i),c.push(u),i=u<=0?i.left:i.right}l.push(new r(0,e,t,null,null,1));for(var d=l.length-2;d>=0;--d)i=l[d],c[d]<=0?l[d]=new r(i._color,i.key,i.value,l[d+1],i.right,i._count+1):l[d]=new r(i._color,i.key,i.value,i.left,l[d+1],i._count+1);for(d=l.length-1;d>1;--d){var p=l[d-1];if(i=l[d],1===p._color||1===i._color)break;var h=l[d-2];if(h.left===p)if(p.left===i){if(!(f=h.right)||0!==f._color){h._color=0,h.left=p.right,p._color=1,p.right=h,l[d-2]=p,l[d-1]=i,s(h),s(p),d>=3&&((g=l[d-3]).left===h?g.left=p:g.right=p);break}p._color=1,h.right=o(1,f),h._color=0,d-=1}else{if(!(f=h.right)||0!==f._color){p.right=i.left,h._color=0,h.left=i.right,i._color=1,i.left=p,i.right=h,l[d-2]=i,l[d-1]=p,s(h),s(p),s(i),d>=3&&((g=l[d-3]).left===h?g.left=i:g.right=i);break}p._color=1,h.right=o(1,f),h._color=0,d-=1}else if(p.right===i){if(!(f=h.left)||0!==f._color){h._color=0,h.right=p.left,p._color=1,p.left=h,l[d-2]=p,l[d-1]=i,s(h),s(p),d>=3&&((g=l[d-3]).right===h?g.right=p:g.left=p);break}p._color=1,h.left=o(1,f),h._color=0,d-=1}else{var f;if(!(f=h.left)||0!==f._color){var g;p.left=i.right,h._color=0,h.right=i.left,i._color=1,i.right=p,i.left=h,l[d-2]=i,l[d-1]=p,s(h),s(p),s(i),d>=3&&((g=l[d-3]).right===h?g.right=i:g.left=i);break}p._color=1,h.left=o(1,f),h._color=0,d-=1}}return l[0]._color=1,new a(n,l[0])},l.forEach=function(e,t,n){if(this.root)switch(arguments.length){case 1:return c(e,this.root);case 2:return u(t,this._compare,e,this.root);case 3:if(this._compare(t,n)>=0)return;return d(t,n,this._compare,e,this.root)}},Object.defineProperty(l,"begin",{get:function(){for(var e=[],t=this.root;t;)e.push(t),t=t.left;return new p(this,e)}}),Object.defineProperty(l,"end",{get:function(){for(var e=[],t=this.root;t;)e.push(t),t=t.right;return new p(this,e)}}),l.at=function(e){if(e<0)return new p(this,[]);for(var t=this.root,n=[];;){if(n.push(t),t.left){if(e<t.left._count){t=t.left;continue}e-=t.left._count}if(!e)return new p(this,n);if(e-=1,!t.right)break;if(e>=t.right._count)break;t=t.right}return new p(this,[])},l.ge=function(e){for(var t=this._compare,n=this.root,r=[],i=0;n;){var o=t(e,n.key);r.push(n),o<=0&&(i=r.length),n=o<=0?n.left:n.right}return r.length=i,new p(this,r)},l.gt=function(e){for(var t=this._compare,n=this.root,r=[],i=0;n;){var o=t(e,n.key);r.push(n),o<0&&(i=r.length),n=o<0?n.left:n.right}return r.length=i,new p(this,r)},l.lt=function(e){for(var t=this._compare,n=this.root,r=[],i=0;n;){var o=t(e,n.key);r.push(n),o>0&&(i=r.length),n=o<=0?n.left:n.right}return r.length=i,new p(this,r)},l.le=function(e){for(var t=this._compare,n=this.root,r=[],i=0;n;){var o=t(e,n.key);r.push(n),o>=0&&(i=r.length),n=o<0?n.left:n.right}return r.length=i,new p(this,r)},l.find=function(e){for(var t=this._compare,n=this.root,r=[];n;){var i=t(e,n.key);if(r.push(n),0===i)return new p(this,r);n=i<=0?n.left:n.right}return new p(this,[])},l.remove=function(e){var t=this.find(e);return t?t.remove():this},l.get=function(e){for(var t=this._compare,n=this.root;n;){var r=t(e,n.key);if(0===r)return n.value;n=r<=0?n.left:n.right}};var h=p.prototype;function f(e,t){e.key=t.key,e.value=t.value,e.left=t.left,e.right=t.right,e._color=t._color,e._count=t._count}function g(e,t){return e<t?-1:e>t?1:0}Object.defineProperty(h,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(h,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),h.clone=function(){return new p(this.tree,this._stack.slice())},h.remove=function(){var e=this._stack;if(0===e.length)return this.tree;var t=new Array(e.length),n=e[e.length-1];t[t.length-1]=new r(n._color,n.key,n.value,n.left,n.right,n._count);for(var l=e.length-2;l>=0;--l)(n=e[l]).left===e[l+1]?t[l]=new r(n._color,n.key,n.value,t[l+1],n.right,n._count):t[l]=new r(n._color,n.key,n.value,n.left,t[l+1],n._count);if((n=t[t.length-1]).left&&n.right){var c=t.length;for(n=n.left;n.right;)t.push(n),n=n.right;var u=t[c-1];for(t.push(new r(n._color,u.key,u.value,n.left,n.right,n._count)),t[c-1].key=n.key,t[c-1].value=n.value,l=t.length-2;l>=c;--l)n=t[l],t[l]=new r(n._color,n.key,n.value,n.left,t[l+1],n._count);t[c-1].left=t[c]}if(0===(n=t[t.length-1])._color){var d=t[t.length-2];for(d.left===n?d.left=null:d.right===n&&(d.right=null),t.pop(),l=0;l<t.length;++l)t[l]._count--;return new a(this.tree._compare,t[0])}if(n.left||n.right){for(n.left?f(n,n.left):n.right&&f(n,n.right),n._color=1,l=0;l<t.length-1;++l)t[l]._count--;return new a(this.tree._compare,t[0])}if(1===t.length)return new a(this.tree._compare,null);for(l=0;l<t.length;++l)t[l]._count--;var p=t[t.length-2];return function(e){for(var t,n,r,a,l=e.length-1;l>=0;--l){if(t=e[l],0===l)return void(t._color=1);if((n=e[l-1]).left===t){if((r=n.right).right&&0===r.right._color)return a=(r=n.right=i(r)).right=i(r.right),n.right=r.left,r.left=n,r.right=a,r._color=n._color,t._color=1,n._color=1,a._color=1,s(n),s(r),l>1&&((c=e[l-2]).left===n?c.left=r:c.right=r),void(e[l-1]=r);if(r.left&&0===r.left._color)return a=(r=n.right=i(r)).left=i(r.left),n.right=a.left,r.left=a.right,a.left=n,a.right=r,a._color=n._color,n._color=1,r._color=1,t._color=1,s(n),s(r),s(a),l>1&&((c=e[l-2]).left===n?c.left=a:c.right=a),void(e[l-1]=a);if(1===r._color){if(0===n._color)return n._color=1,void(n.right=o(0,r));n.right=o(0,r);continue}r=i(r),n.right=r.left,r.left=n,r._color=n._color,n._color=0,s(n),s(r),l>1&&((c=e[l-2]).left===n?c.left=r:c.right=r),e[l-1]=r,e[l]=n,l+1<e.length?e[l+1]=t:e.push(t),l+=2}else{if((r=n.left).left&&0===r.left._color)return a=(r=n.left=i(r)).left=i(r.left),n.left=r.right,r.right=n,r.left=a,r._color=n._color,t._color=1,n._color=1,a._color=1,s(n),s(r),l>1&&((c=e[l-2]).right===n?c.right=r:c.left=r),void(e[l-1]=r);if(r.right&&0===r.right._color)return a=(r=n.left=i(r)).right=i(r.right),n.left=a.right,r.right=a.left,a.right=n,a.left=r,a._color=n._color,n._color=1,r._color=1,t._color=1,s(n),s(r),s(a),l>1&&((c=e[l-2]).right===n?c.right=a:c.left=a),void(e[l-1]=a);if(1===r._color){if(0===n._color)return n._color=1,void(n.left=o(0,r));n.left=o(0,r);continue}var c;r=i(r),n.left=r.right,r.right=n,r._color=n._color,n._color=0,s(n),s(r),l>1&&((c=e[l-2]).right===n?c.right=r:c.left=r),e[l-1]=r,e[l]=n,l+1<e.length?e[l+1]=t:e.push(t),l+=2}}}(t),p.left===n?p.left=null:p.right=null,new a(this.tree._compare,t[0])},Object.defineProperty(h,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(h,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(h,"index",{get:function(){var e=0,t=this._stack;if(0===t.length){var n=this.tree.root;return n?n._count:0}t[t.length-1].left&&(e=t[t.length-1].left._count);for(var r=t.length-2;r>=0;--r)t[r+1]===t[r].right&&(++e,t[r].left&&(e+=t[r].left._count));return e},enumerable:!0}),h.next=function(){var e=this._stack;if(0!==e.length){var t=e[e.length-1];if(t.right)for(t=t.right;t;)e.push(t),t=t.left;else for(e.pop();e.length>0&&e[e.length-1].right===t;)t=e[e.length-1],e.pop()}},Object.defineProperty(h,"hasNext",{get:function(){var e=this._stack;if(0===e.length)return!1;if(e[e.length-1].right)return!0;for(var t=e.length-1;t>0;--t)if(e[t-1].left===e[t])return!0;return!1}}),h.update=function(e){var t=this._stack;if(0===t.length)throw new Error("Can't update empty node!");var n=new Array(t.length),i=t[t.length-1];n[n.length-1]=new r(i._color,i.key,e,i.left,i.right,i._count);for(var o=t.length-2;o>=0;--o)(i=t[o]).left===t[o+1]?n[o]=new r(i._color,i.key,i.value,n[o+1],i.right,i._count):n[o]=new r(i._color,i.key,i.value,i.left,n[o+1],i._count);return new a(this.tree._compare,n[0])},h.prev=function(){var e=this._stack;if(0!==e.length){var t=e[e.length-1];if(t.left)for(t=t.left;t;)e.push(t),t=t.right;else for(e.pop();e.length>0&&e[e.length-1].left===t;)t=e[e.length-1],e.pop()}},Object.defineProperty(h,"hasPrev",{get:function(){var e=this._stack;if(0===e.length)return!1;if(e[e.length-1].left)return!0;for(var t=e.length-1;t>0;--t)if(e[t-1].right===e[t])return!0;return!1}})},{}],244:[function(e,t,n){"use strict";var r=e("react-is"),i={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},s={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};function l(e){return r.isMemo(e)?s:a[e.$$typeof]||i}a[r.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a[r.Memo]=s;var c=Object.defineProperty,u=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,p=Object.getOwnPropertyDescriptor,h=Object.getPrototypeOf,f=Object.prototype;t.exports=function e(t,n,r){if("string"!=typeof n){if(f){var i=h(n);i&&i!==f&&e(t,i,r)}var s=u(n);d&&(s=s.concat(d(n)));for(var a=l(t),g=l(n),m=0;m<s.length;++m){var v=s[m];if(!(o[v]||r&&r[v]||g&&g[v]||a&&a[v])){var y=p(n,v);try{c(t,v,y)}catch(t){}}}}return t}},{"react-is":311}],245:[function(e,t,n){n.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,l=(1<<a)-1,c=l>>1,u=-7,d=n?i-1:0,p=n?-1:1,h=e[t+d];for(d+=p,o=h&(1<<-u)-1,h>>=-u,u+=a;u>0;o=256*o+e[t+d],d+=p,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+e[t+d],d+=p,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,r),o-=c}return(h?-1:1)*s*Math.pow(2,o-r)},n.write=function(e,t,n,r,i,o){var s,a,l,c=8*o-i-1,u=(1<<c)-1,d=u>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:o-1,f=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+d>=1?p/l:p*Math.pow(2,1-d))*l>=2&&(s++,l/=2),s+d>=u?(a=0,s=u):s+d>=1?(a=(t*l-1)*Math.pow(2,i),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[n+h]=255&a,h+=f,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[n+h]=255&s,h+=f,s/=256,c-=8);e[n+h-f]|=128*g}},{}],246:[function(e,t,n){(function(e){(function(){"use strict";var n,r,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,s=new i(u),a=e.document.createTextNode("");s.observe(a,{characterData:!0}),n=function(){a.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var l=new e.MessageChannel;l.port1.onmessage=u,n=function(){l.port2.postMessage(0)}}var c=[];function u(){var e,t;r=!0;for(var n=c.length;n;){for(t=c,c=[],e=-1;++e<n;)t[e]();n=c.length}r=!1}t.exports=function(e){1!==c.push(e)||r||n()}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],247:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},{}],248:[function(e,t,n){function r(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}t.exports=function(e){return null!=e&&(r(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&r(e.slice(0,0))}(e)||!!e._isBuffer)}},{}],249:[function(e,t,n){var r=e("./lib/encodings");function i(e){if(!(this instanceof i))return new i(e);this.opts=e||{},this.encodings=r}t.exports=i,i.prototype._encoding=function(e){return"string"==typeof e&&(e=r[e]),e||(e=r.id),e},i.prototype._keyEncoding=function(e,t){return this._encoding(t&&t.keyEncoding||e&&e.keyEncoding||this.opts.keyEncoding)},i.prototype._valueEncoding=function(e,t){return this._encoding(t&&(t.valueEncoding||t.encoding)||e&&(e.valueEncoding||e.encoding)||this.opts.valueEncoding||this.opts.encoding)},i.prototype.encodeKey=function(e,t,n){return this._keyEncoding(t,n).encode(e)},i.prototype.encodeValue=function(e,t,n){return this._valueEncoding(t,n).encode(e)},i.prototype.decodeKey=function(e,t){return this._keyEncoding(t).decode(e)},i.prototype.decodeValue=function(e,t){return this._valueEncoding(t).decode(e)},i.prototype.encodeBatch=function(e,t){var n=this;return e.map((function(e){var r={type:e.type,key:n.encodeKey(e.key,t,e)};return n.keyAsBuffer(t,e)&&(r.keyEncoding="binary"),e.prefix&&(r.prefix=e.prefix),"value"in e&&(r.value=n.encodeValue(e.value,t,e),n.valueAsBuffer(t,e)&&(r.valueEncoding="binary")),r}))};var o=["lt","gt","lte","gte","start","end"];i.prototype.encodeLtgt=function(e){var t=this,n={};return Object.keys(e).forEach((function(r){n[r]=o.indexOf(r)>-1?t.encodeKey(e[r],e):e[r]})),n},i.prototype.createStreamDecoder=function(e){var t=this;return e.keys&&e.values?function(n,r){return{key:t.decodeKey(n,e),value:t.decodeValue(r,e)}}:e.keys?function(n){return t.decodeKey(n,e)}:e.values?function(n,r){return t.decodeValue(r,e)}:function(){}},i.prototype.keyAsBuffer=function(e){return this._keyEncoding(e).buffer},i.prototype.valueAsBuffer=function(e){return this._valueEncoding(e).buffer}},{"./lib/encodings":250}],250:[function(e,t,n){(function(e){(function(){n.utf8=n["utf-8"]={encode:function(e){return r(e)?e:String(e)},decode:t,buffer:!1,type:"utf8"},n.json={encode:JSON.stringify,decode:JSON.parse,buffer:!1,type:"json"},n.binary={encode:function(t){return r(t)?t:e.from(t)},decode:t,buffer:!0,type:"binary"},n.none={encode:t,decode:t,buffer:!1,type:"id"},n.id=n.none;function t(e){return e}function r(t){return null==t||e.isBuffer(t)}["hex","ascii","base64","ucs2","ucs-2","utf16le","utf-16le"].forEach((function(t){n[t]={encode:function(n){return r(n)?n:e.from(n,t)},decode:function(e){return e.toString(t)},buffer:!0,type:t}}))}).call(this)}).call(this,e("buffer").Buffer)},{buffer:226}],251:[function(e,t,n){var r=e("errno").create,i=r("LevelUPError"),o=r("NotFoundError",i);o.prototype.notFound=!0,o.prototype.status=404,t.exports={LevelUPError:i,InitializationError:r("InitializationError",i),OpenError:r("OpenError",i),ReadError:r("ReadError",i),WriteError:r("WriteError",i),NotFoundError:o,EncodingError:r("EncodingError",i)}},{errno:240}],252:[function(e,t,n){var r=e("inherits"),i=e("readable-stream").Readable,o=e("xtend");function s(e,t){if(!(this instanceof s))return new s(e,t);t=t||{},i.call(this,o(t,{objectMode:!0})),this._iterator=e,this._options=t,this.on("end",this.destroy.bind(this,null,null))}t.exports=s,r(s,i),s.prototype._read=function(){var e=this,t=this._options;this.destroyed||this._iterator.next((function(n,r,i){if(!e.destroyed)return n?e.destroy(n):void(void 0===r&&void 0===i?e.push(null):!1!==t.keys&&!1===t.values?e.push(r):!1===t.keys&&!1!==t.values?e.push(i):e.push({key:r,value:i}))}))},s.prototype._destroy=function(e,t){this._iterator.end((function(n){t(e||n)}))}},{inherits:247,"readable-stream":267,xtend:450}],253:[function(e,t,n){"use strict";var r={};function i(e,t,n){n||(n=Error);var i=function(e){function n(n,r,i){return e.call(this,function(e,n,r){return"string"==typeof t?t:t(e,n,r)}(n,r,i))||this}return function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(n,e),n}(n);i.prototype.name=n.name,i.prototype.code=e,r[e]=i}function o(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map((function(e){return String(e)})),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}i("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),i("ERR_INVALID_ARG_TYPE",(function(e,t,n){var r,i;if("string"==typeof t&&function(e,t,n){return e.substr(!n||n<0?0:+n,t.length)===t}(t,"not ")?(r="must not be",t=t.replace(/^not /,"")):r="must be",function(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))i="The ".concat(e," ").concat(r," ").concat(o(t,"type"));else{var s=function(e,t,n){return"number"!=typeof n&&(n=0),!(n+t.length>e.length)&&-1!==e.indexOf(t,n)}(e,".")?"property":"argument";i='The "'.concat(e,'" ').concat(s," ").concat(r," ").concat(o(t,"type"))}return i+". Received type ".concat(typeof n)}),TypeError),i("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),i("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),i("ERR_STREAM_PREMATURE_CLOSE","Premature close"),i("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),i("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),i("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),i("ERR_STREAM_WRITE_AFTER_END","write after end"),i("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),i("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),i("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),t.exports.codes=r},{}],254:[function(e,t,n){(function(n){(function(){"use strict";var r=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=c;var i=e("./_stream_readable"),o=e("./_stream_writable");e("inherits")(c,i);for(var s=r(o.prototype),a=0;a<s.length;a++){var l=s[a];c.prototype[l]||(c.prototype[l]=o.prototype[l])}function c(e){if(!(this instanceof c))return new c(e);i.call(this,e),o.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",u)))}function u(){this._writableState.ended||n.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this)}).call(this,e("_process"))},{"./_stream_readable":256,"./_stream_writable":258,_process:303,inherits:247}],255:[function(e,t,n){"use strict";t.exports=i;var r=e("./_stream_transform");function i(e){if(!(this instanceof i))return new i(e);r.call(this,e)}e("inherits")(i,r),i.prototype._transform=function(e,t,n){n(null,e)}},{"./_stream_transform":257,inherits:247}],256:[function(e,t,n){(function(n,r){(function(){"use strict";var i;t.exports=T,T.ReadableState=S;e("events").EventEmitter;var o=function(e,t){return e.listeners(t).length},s=e("./internal/streams/stream"),a=e("buffer").Buffer,l=(void 0!==r?r:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var c,u=e("util");c=u&&u.debuglog?u.debuglog("stream"):function(){};var d,p,h,f=e("./internal/streams/buffer_list"),g=e("./internal/streams/destroy"),m=e("./internal/streams/state").getHighWaterMark,v=e("../errors").codes,y=v.ERR_INVALID_ARG_TYPE,b=v.ERR_STREAM_PUSH_AFTER_EOF,x=v.ERR_METHOD_NOT_IMPLEMENTED,E=v.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;e("inherits")(T,s);var _=g.errorOrDestroy,w=["error","close","destroy","pause","resume"];function S(t,n,r){i=i||e("./_stream_duplex"),t=t||{},"boolean"!=typeof r&&(r=n instanceof i),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=m(this,t,"readableHighWaterMark",r),this.buffer=new f,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(d||(d=e("string_decoder/").StringDecoder),this.decoder=new d(t.encoding),this.encoding=t.encoding)}function T(t){if(i=i||e("./_stream_duplex"),!(this instanceof T))return new T(t);var n=this instanceof i;this._readableState=new S(t,this,n),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),s.call(this)}function k(e,t,n,r,i){c("readableAddChunk",t);var o,s=e._readableState;if(null===t)s.reading=!1,function(e,t){if(c("onEofChunk"),!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?I(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,O(e)))}}(e,s);else if(i||(o=function(e,t){var n;return function(e){return a.isBuffer(e)||e instanceof l}(t)||"string"==typeof t||void 0===t||e.objectMode||(n=new y("chunk",["string","Buffer","Uint8Array"],t)),n}(s,t)),o)_(e,o);else if(s.objectMode||t&&t.length>0)if("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===a.prototype||(t=function(e){return a.from(e)}(t)),r)s.endEmitted?_(e,new E):C(e,s,t,!0);else if(s.ended)_(e,new b);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!n?(t=s.decoder.write(t),s.objectMode||0!==t.length?C(e,s,t,!1):N(e,s)):C(e,s,t,!1)}else r||(s.reading=!1,N(e,s));return!s.ended&&(s.length<s.highWaterMark||0===s.length)}function C(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&I(e)),N(e,t)}Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),T.prototype.destroy=g.destroy,T.prototype._undestroy=g.undestroy,T.prototype._destroy=function(e,t){t(e)},T.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=a.from(e,t),t=""),n=!0),k(this,e,t,!1,n)},T.prototype.unshift=function(e){return k(this,e,null,!0,!1)},T.prototype.isPaused=function(){return!1===this._readableState.flowing},T.prototype.setEncoding=function(t){d||(d=e("string_decoder/").StringDecoder);var n=new d(t);this._readableState.decoder=n,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,i="";null!==r;)i+=n.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var A=1073741824;function j(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=A?e=A:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function I(e){var t=e._readableState;c("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(c("emitReadable",t.flowing),t.emittedReadable=!0,n.nextTick(O,e))}function O(e){var t=e._readableState;c("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,L(e)}function N(e,t){t.readingMore||(t.readingMore=!0,n.nextTick(R,e,t))}function R(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(c("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function P(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function D(e){c("readable nexttick read 0"),e.read(0)}function M(e,t){c("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),L(e),t.flowing&&!t.reading&&e.read(0)}function L(e){var t=e._readableState;for(c("flow",t.flowing);t.flowing&&null!==e.read(););}function B(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function F(e){var t=e._readableState;c("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,n.nextTick(U,t,e))}function U(e,t){if(c("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function H(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}T.prototype.read=function(e){c("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return c("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?F(this):I(this),null;if(0===(e=j(e,t))&&t.ended)return 0===t.length&&F(this),null;var r,i=t.needReadable;return c("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&c("length less than watermark",i=!0),t.ended||t.reading?c("reading or ended",i=!1):i&&(c("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=j(n,t))),null===(r=e>0?B(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&F(this)),null!==r&&this.emit("data",r),r},T.prototype._read=function(e){_(this,new x("_read()"))},T.prototype.pipe=function(e,t){var r=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,c("pipe count=%d opts=%j",i.pipesCount,t);var s=t&&!1===t.end||e===n.stdout||e===n.stderr?g:a;function a(){c("onend"),e.end()}i.endEmitted?n.nextTick(s):r.once("end",s),e.on("unpipe",(function t(n,o){c("onunpipe"),n===r&&o&&!1===o.hasUnpiped&&(o.hasUnpiped=!0,c("cleanup"),e.removeListener("close",h),e.removeListener("finish",f),e.removeListener("drain",l),e.removeListener("error",p),e.removeListener("unpipe",t),r.removeListener("end",a),r.removeListener("end",g),r.removeListener("data",d),u=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||l())}));var l=function(e){return function(){var t=e._readableState;c("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&o(e,"data")&&(t.flowing=!0,L(e))}}(r);e.on("drain",l);var u=!1;function d(t){c("ondata");var n=e.write(t);c("dest.write",n),!1===n&&((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==H(i.pipes,e))&&!u&&(c("false write response, pause",i.awaitDrain),i.awaitDrain++),r.pause())}function p(t){c("onerror",t),g(),e.removeListener("error",p),0===o(e,"error")&&_(e,t)}function h(){e.removeListener("finish",f),g()}function f(){c("onfinish"),e.removeListener("close",h),g()}function g(){c("unpipe"),r.unpipe(e)}return r.on("data",d),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",p),e.once("close",h),e.once("finish",f),e.emit("pipe",r),i.flowing||(c("pipe resume"),r.resume()),e},T.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,{hasUnpiped:!1});return this}var s=H(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},T.prototype.on=function(e,t){var r=s.prototype.on.call(this,e,t),i=this._readableState;return"data"===e?(i.readableListening=this.listenerCount("readable")>0,!1!==i.flowing&&this.resume()):"readable"===e&&(i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,c("on readable",i.length,i.reading),i.length?I(this):i.reading||n.nextTick(D,this))),r},T.prototype.addListener=T.prototype.on,T.prototype.removeListener=function(e,t){var r=s.prototype.removeListener.call(this,e,t);return"readable"===e&&n.nextTick(P,this),r},T.prototype.removeAllListeners=function(e){var t=s.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||n.nextTick(P,this),t},T.prototype.resume=function(){var e=this._readableState;return e.flowing||(c("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.nextTick(M,e,t))}(this,e)),e.paused=!1,this},T.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},T.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",(function(){if(c("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){c("wrapped data"),n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i||(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<w.length;o++)e.on(w[o],this.emit.bind(this,w[o]));return this._read=function(t){c("wrapped _read",t),r&&(r=!1,e.resume())},this},"function"==typeof Symbol&&(T.prototype[Symbol.asyncIterator]=function(){return void 0===p&&(p=e("./internal/streams/async_iterator")),p(this)}),Object.defineProperty(T.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(T.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(T.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),T._fromList=B,Object.defineProperty(T.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(T.from=function(t,n){return void 0===h&&(h=e("./internal/streams/from")),h(T,t,n)})}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../errors":253,"./_stream_duplex":254,"./internal/streams/async_iterator":259,"./internal/streams/buffer_list":260,"./internal/streams/destroy":261,"./internal/streams/from":263,"./internal/streams/state":265,"./internal/streams/stream":266,_process:303,buffer:226,events:241,inherits:247,"string_decoder/":428,util:225}],257:[function(e,t,n){"use strict";t.exports=u;var r=e("../errors").codes,i=r.ERR_METHOD_NOT_IMPLEMENTED,o=r.ERR_MULTIPLE_CALLBACK,s=r.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=r.ERR_TRANSFORM_WITH_LENGTH_0,l=e("./_stream_duplex");function c(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(null===r)return this.emit("error",new o);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function u(e){if(!(this instanceof u))return new u(e);l.call(this,e),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?p(this,null,null):this._flush((function(t,n){p(e,t,n)}))}function p(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new a;if(e._transformState.transforming)throw new s;return e.push(null)}e("inherits")(u,l),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,l.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,n){n(new i("_transform()"))},u.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){l.prototype._destroy.call(this,e,(function(e){t(e)}))}},{"../errors":253,"./_stream_duplex":254,inherits:247}],258:[function(e,t,n){(function(n,r){(function(){"use strict";function i(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree.next=e}(t,e)}}var o;t.exports=T,T.WritableState=S;var s={deprecate:e("util-deprecate")},a=e("./internal/streams/stream"),l=e("buffer").Buffer,c=(void 0!==r?r:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var u,d=e("./internal/streams/destroy"),p=e("./internal/streams/state").getHighWaterMark,h=e("../errors").codes,f=h.ERR_INVALID_ARG_TYPE,g=h.ERR_METHOD_NOT_IMPLEMENTED,m=h.ERR_MULTIPLE_CALLBACK,v=h.ERR_STREAM_CANNOT_PIPE,y=h.ERR_STREAM_DESTROYED,b=h.ERR_STREAM_NULL_VALUES,x=h.ERR_STREAM_WRITE_AFTER_END,E=h.ERR_UNKNOWN_ENCODING,_=d.errorOrDestroy;function w(){}function S(t,r,s){o=o||e("./_stream_duplex"),t=t||{},"boolean"!=typeof s&&(s=r instanceof o),this.objectMode=!!t.objectMode,s&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=p(this,t,"writableHighWaterMark",s),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=!1===t.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,i=r.sync,o=r.writecb;if("function"!=typeof o)throw new m;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,i,o){--t.pendingcb,r?(n.nextTick(o,i),n.nextTick(N,e,t),e._writableState.errorEmitted=!0,_(e,i)):(o(i),e._writableState.errorEmitted=!0,_(e,i),N(e,t))}(e,r,i,t,o);else{var s=I(r)||e.destroyed;s||r.corked||r.bufferProcessing||!r.bufferedRequest||j(e,r),i?n.nextTick(A,e,r,s,o):A(e,r,s,o)}}(r,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}function T(t){var n=this instanceof(o=o||e("./_stream_duplex"));if(!n&&!u.call(T,this))return new T(t);this._writableState=new S(t,this,n),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),a.call(this)}function k(e,t,n,r,i,o){if(!n){var s=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=l.from(t,n)),t}(t,r,i);r!==s&&(n=!0,i="buffer",r=s)}var a=t.objectMode?1:r.length;t.length+=a;var c=t.length<t.highWaterMark;if(c||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else C(e,t,!1,a,r,i,o);return c}function C(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new y("write")):n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function A(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),N(e,t)}function j(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,o=new Array(r),s=t.corkedRequestsFree;s.entry=n;for(var a=0,l=!0;n;)o[a]=n,n.isBuf||(l=!1),n=n.next,a+=1;o.allBuffers=l,C(e,t,!0,t.length,o,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new i(t),t.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,u=n.encoding,d=n.callback;if(C(e,t,!1,t.objectMode?1:c.length,c,u,d),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function I(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function O(e,t){e._final((function(n){t.pendingcb--,n&&_(e,n),t.prefinished=!0,e.emit("prefinish"),N(e,t)}))}function N(e,t){var r=I(t);if(r&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,n.nextTick(O,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var i=e._readableState;(!i||i.autoDestroy&&i.endEmitted)&&e.destroy()}return r}e("inherits")(T,a),S.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(S.prototype,"buffer",{get:s.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(u=Function.prototype[Symbol.hasInstance],Object.defineProperty(T,Symbol.hasInstance,{value:function(e){return!!u.call(this,e)||this===T&&e&&e._writableState instanceof S}})):u=function(e){return e instanceof this},T.prototype.pipe=function(){_(this,new v)},T.prototype.write=function(e,t,r){var i=this._writableState,o=!1,s=!i.objectMode&&function(e){return l.isBuffer(e)||e instanceof c}(e);return s&&!l.isBuffer(e)&&(e=function(e){return l.from(e)}(e)),"function"==typeof t&&(r=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof r&&(r=w),i.ending?function(e,t){var r=new x;_(e,r),n.nextTick(t,r)}(this,r):(s||function(e,t,r,i){var o;return null===r?o=new b:"string"==typeof r||t.objectMode||(o=new f("chunk",["string","Buffer"],r)),!o||(_(e,o),n.nextTick(i,o),!1)}(this,i,e,r))&&(i.pendingcb++,o=k(this,i,s,e,t,r)),o},T.prototype.cork=function(){this._writableState.corked++},T.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||j(this,e))},T.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new E(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(T.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(T.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),T.prototype._write=function(e,t,n){n(new g("_write()"))},T.prototype._writev=null,T.prototype.end=function(e,t,r){var i=this._writableState;return"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||function(e,t,r){t.ending=!0,N(e,t),r&&(t.finished?n.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}(this,i,r),this},Object.defineProperty(T.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),T.prototype.destroy=d.destroy,T.prototype._undestroy=d.undestroy,T.prototype._destroy=function(e,t){t(e)}}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../errors":253,"./_stream_duplex":254,"./internal/streams/destroy":261,"./internal/streams/state":265,"./internal/streams/stream":266,_process:303,buffer:226,inherits:247,"util-deprecate":439}],259:[function(e,t,n){(function(n){(function(){"use strict";var r;function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=e("./end-of-stream"),s=Symbol("lastResolve"),a=Symbol("lastReject"),l=Symbol("error"),c=Symbol("ended"),u=Symbol("lastPromise"),d=Symbol("handlePromise"),p=Symbol("stream");function h(e,t){return{value:e,done:t}}function f(e){var t=e[s];if(null!==t){var n=e[p].read();null!==n&&(e[u]=null,e[s]=null,e[a]=null,t(h(n,!1)))}}function g(e){n.nextTick(f,e)}var m=Object.getPrototypeOf((function(){})),v=Object.setPrototypeOf((i(r={get stream(){return this[p]},next:function(){var e=this,t=this[l];if(null!==t)return Promise.reject(t);if(this[c])return Promise.resolve(h(void 0,!0));if(this[p].destroyed)return new Promise((function(t,r){n.nextTick((function(){e[l]?r(e[l]):t(h(void 0,!0))}))}));var r,i=this[u];if(i)r=new Promise(function(e,t){return function(n,r){e.then((function(){t[c]?n(h(void 0,!0)):t[d](n,r)}),r)}}(i,this));else{var o=this[p].read();if(null!==o)return Promise.resolve(h(o,!1));r=new Promise(this[d])}return this[u]=r,r}},Symbol.asyncIterator,(function(){return this})),i(r,"return",(function(){var e=this;return new Promise((function(t,n){e[p].destroy(null,(function(e){e?n(e):t(h(void 0,!0))}))}))})),r),m);t.exports=function(e){var t,n=Object.create(v,(i(t={},p,{value:e,writable:!0}),i(t,s,{value:null,writable:!0}),i(t,a,{value:null,writable:!0}),i(t,l,{value:null,writable:!0}),i(t,c,{value:e._readableState.endEmitted,writable:!0}),i(t,d,{value:function(e,t){var r=n[p].read();r?(n[u]=null,n[s]=null,n[a]=null,e(h(r,!1))):(n[s]=e,n[a]=t)},writable:!0}),t));return n[u]=null,o(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=n[a];return null!==t&&(n[u]=null,n[s]=null,n[a]=null,t(e)),void(n[l]=e)}var r=n[s];null!==r&&(n[u]=null,n[s]=null,n[a]=null,r(h(void 0,!0))),n[c]=!0})),e.on("readable",g.bind(null,n)),n}}).call(this)}).call(this,e("_process"))},{"./end-of-stream":262,_process:303}],260:[function(e,t,n){"use strict";function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t,n){return(t=a(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function a(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var l=e("buffer").Buffer,c=e("util").inspect,u=c&&c.custom||"inspect";function d(e,t,n){l.prototype.copy.call(e,t,n)}t.exports=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.head=null,this.tail=null,this.length=0}return function(e,t,n){t&&s(e.prototype,t),n&&s(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return l.alloc(0);for(var t=l.allocUnsafe(e>>>0),n=this.head,r=0;n;)d(n.data,t,r),r+=n.data.length,n=n.next;return t}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,r=t.data;for(e-=r.length;t=t.next;){var i=t.data,o=e>i.length?i.length:e;if(o===i.length?r+=i:r+=i.slice(0,e),0==(e-=o)){o===i.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(o));break}++n}return this.length-=n,r}},{key:"_getBuffer",value:function(e){var t=l.allocUnsafe(e),n=this.head,r=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var i=n.data,o=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,o),0==(e-=o)){o===i.length?(++r,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=i.slice(o));break}++r}return this.length-=r,t}},{key:u,value:function(e,t){return c(this,i(i({},t),{},{depth:0,customInspect:!1}))}}]),e}()},{buffer:226,util:225}],261:[function(e,t,n){(function(e){(function(){"use strict";function n(e,t){i(e,t),r(e)}function r(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function i(e,t){e.emit("error",t)}t.exports={destroy:function(t,o){var s=this,a=this._readableState&&this._readableState.destroyed,l=this._writableState&&this._writableState.destroyed;return a||l?(o?o(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,e.nextTick(i,this,t)):e.nextTick(i,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!o&&t?s._writableState?s._writableState.errorEmitted?e.nextTick(r,s):(s._writableState.errorEmitted=!0,e.nextTick(n,s,t)):e.nextTick(n,s,t):o?(e.nextTick(r,s),o(t)):e.nextTick(r,s)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,r=e._writableState;n&&n.autoDestroy||r&&r.autoDestroy?e.destroy(t):e.emit("error",t)}}}).call(this)}).call(this,e("_process"))},{_process:303}],262:[function(e,t,n){"use strict";var r=e("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function i(){}t.exports=function e(t,n,o){if("function"==typeof n)return e(t,null,n);n||(n={}),o=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];e.apply(this,r)}}}(o||i);var s=n.readable||!1!==n.readable&&t.readable,a=n.writable||!1!==n.writable&&t.writable,l=function(){t.writable||u()},c=t._writableState&&t._writableState.finished,u=function(){a=!1,c=!0,s||o.call(t)},d=t._readableState&&t._readableState.endEmitted,p=function(){s=!1,d=!0,a||o.call(t)},h=function(e){o.call(t,e)},f=function(){var e;return s&&!d?(t._readableState&&t._readableState.ended||(e=new r),o.call(t,e)):a&&!c?(t._writableState&&t._writableState.ended||(e=new r),o.call(t,e)):void 0},g=function(){t.req.on("finish",u)};return function(e){return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",u),t.on("abort",f),t.req?g():t.on("request",g)):a&&!t._writableState&&(t.on("end",l),t.on("close",l)),t.on("end",p),t.on("finish",u),!1!==n.error&&t.on("error",h),t.on("close",f),function(){t.removeListener("complete",u),t.removeListener("abort",f),t.removeListener("request",g),t.req&&t.req.removeListener("finish",u),t.removeListener("end",l),t.removeListener("close",l),t.removeListener("finish",u),t.removeListener("end",p),t.removeListener("error",h),t.removeListener("close",f)}}},{"../../../errors":253}],263:[function(e,t,n){t.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],264:[function(e,t,n){"use strict";var r;var i=e("../../../errors").codes,o=i.ERR_MISSING_ARGS,s=i.ERR_STREAM_DESTROYED;function a(e){if(e)throw e}function l(t,n,i,o){o=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(o);var a=!1;t.on("close",(function(){a=!0})),void 0===r&&(r=e("./end-of-stream")),r(t,{readable:n,writable:i},(function(e){if(e)return o(e);a=!0,o()}));var l=!1;return function(e){if(!a&&!l)return l=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(t)?t.abort():"function"==typeof t.destroy?t.destroy():void o(e||new s("pipe"))}}function c(e){e()}function u(e,t){return e.pipe(t)}function d(e){return e.length?"function"!=typeof e[e.length-1]?a:e.pop():a}t.exports=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r,i=d(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new o("streams");var s=t.map((function(e,n){var o=n<t.length-1;return l(e,o,n>0,(function(e){r||(r=e),e&&s.forEach(c),o||(s.forEach(c),i(r))}))}));return t.reduce(u)}},{"../../../errors":253,"./end-of-stream":262}],265:[function(e,t,n){"use strict";var r=e("../../../errors").codes.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function(e,t,n,i){var o=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,i,n);if(null!=o){if(!isFinite(o)||Math.floor(o)!==o||o<0)throw new r(i?n:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}},{"../../../errors":253}],266:[function(e,t,n){t.exports=e("events").EventEmitter},{events:241}],267:[function(e,t,n){(n=t.exports=e("./lib/_stream_readable.js")).Stream=n,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js"),n.finished=e("./lib/internal/streams/end-of-stream.js"),n.pipeline=e("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":254,"./lib/_stream_passthrough.js":255,"./lib/_stream_readable.js":256,"./lib/_stream_transform.js":257,"./lib/_stream_writable.js":258,"./lib/internal/streams/end-of-stream.js":262,"./lib/internal/streams/pipeline.js":264}],268:[function(e,t,n){var r=e("level-errors").WriteError,i=e("./promisify"),o=e("./common").getCallback,s=e("./common").getOptions;function a(e){this._levelup=e,this.batch=e.db.batch(),this.ops=[],this.length=0}a.prototype.put=function(e,t){try{this.batch.put(e,t)}catch(e){throw new r(e)}return this.ops.push({type:"put",key:e,value:t}),this.length++,this},a.prototype.del=function(e){try{this.batch.del(e)}catch(e){throw new r(e)}return this.ops.push({type:"del",key:e}),this.length++,this},a.prototype.clear=function(){try{this.batch.clear()}catch(e){throw new r(e)}return this.ops=[],this.length=0,this},a.prototype.write=function(e,t){var n,a=this._levelup,l=this.ops;(t=o(e,t))||(n=(t=i()).promise),e=s(e);try{this.batch.write(e,(function(e){if(e)return t(new r(e));a.emit("batch",l),t()}))}catch(e){throw new r(e)}return n},t.exports=a},{"./common":269,"./promisify":271,"level-errors":251}],269:[function(e,t,n){n.getCallback=function(e,t){return"function"==typeof e?e:t},n.getOptions=function(e){return"object"==typeof e&&null!==e?e:{}}},{}],270:[function(e,t,n){(function(n){(function(){var r=e("events").EventEmitter,i=e("util").inherits,o=e("xtend"),s=e("deferred-leveldown"),a=e("level-iterator-stream"),l=e("./batch"),c=e("level-errors"),u=e("assert"),d=e("./promisify"),p=e("./common").getCallback,h=e("./common").getOptions,f=c.WriteError,g=c.ReadError,m=c.NotFoundError,v=c.OpenError,y=c.InitializationError;function b(e,t,i){if(!(this instanceof b))return new b(e,t,i);var o;if(r.call(this),this.setMaxListeners(1/0),"function"==typeof t&&(i=t,t={}),t=t||{},!e||"object"!=typeof e){if(o=new y("First argument must be an abstract-leveldown compliant store"),"function"==typeof i)return n.nextTick(i,o);throw o}u.strictEqual(typeof e.status,"string",".status required, old abstract-leveldown"),this.options=h(t),this._db=e,this.db=new s(e),this.open(i)}function x(e,t){if(!e._isOpening()&&!e.isOpen())return n.nextTick(t,new g("Database is not open")),!0}b.prototype.emit=r.prototype.emit,b.prototype.once=r.prototype.once,i(b,r),b.prototype.open=function(e,t){var r,i=this;return"function"==typeof e&&(t=e,e=null),t||(r=(t=d()).promise),e||(e=this.options),this.isOpen()?(n.nextTick(t,null,i),r):this._isOpening()?(this.once("open",(function(){t(null,i)})),r):(this.emit("opening"),this.db.open(e,(function(e){if(e)return t(new v(e));i.db=i._db,t(null,i),i.emit("open"),i.emit("ready")})),r)},b.prototype.close=function(e){var t,r=this;return e||(t=(e=d()).promise),this.isOpen()?(this.db.close((function(){r.emit("closed"),e.apply(null,arguments)})),this.emit("closing"),this.db=new s(this._db)):this.isClosed()?n.nextTick(e):"closing"===this.db.status?this.once("closed",e):this._isOpening()&&this.once("open",(function(){r.close(e)})),t},b.prototype.isOpen=function(){return"open"===this.db.status},b.prototype._isOpening=function(){return"opening"===this.db.status},b.prototype.isClosed=function(){return/^clos|new/.test(this.db.status)},b.prototype.get=function(e,t,n){if(null==e)throw new g("get() requires a key argument");var r;return(n=p(t,n))||(r=(n=d()).promise),x(this,n)||(t=h(t),this.db.get(e,t,(function(t,r){if(t)return t=/notfound/i.test(t)||t.notFound?new m("Key not found in database ["+e+"]",t):new g(t),n(t);n(null,r)}))),r},b.prototype.put=function(e,t,n,r){if(null==e)throw new f("put() requires a key argument");var i,o=this;return(r=p(n,r))||(i=(r=d()).promise),x(this,r)||(n=h(n),this.db.put(e,t,n,(function(n){if(n)return r(new f(n));o.emit("put",e,t),r()}))),i},b.prototype.del=function(e,t,n){if(null==e)throw new f("del() requires a key argument");var r,i=this;return(n=p(t,n))||(r=(n=d()).promise),x(this,n)||(t=h(t),this.db.del(e,t,(function(t){if(t)return n(new f(t));i.emit("del",e),n()}))),r},b.prototype.batch=function(e,t,n){if(!arguments.length)return new l(this);if(!Array.isArray(e))throw new f("batch() requires an array argument");var r,i=this;return(n=p(t,n))||(r=(n=d()).promise),x(this,n)||(t=h(t),this.db.batch(e,t,(function(t){if(t)return n(new f(t));i.emit("batch",e),n()}))),r},b.prototype.iterator=function(e){return this.db.iterator(e)},b.prototype.readStream=b.prototype.createReadStream=function(e){return"number"!=typeof(e=o({keys:!0,values:!0},e)).limit&&(e.limit=-1),new a(this.db.iterator(e),e)},b.prototype.keyStream=b.prototype.createKeyStream=function(e){return this.createReadStream(o(e,{keys:!0,values:!1}))},b.prototype.valueStream=b.prototype.createValueStream=function(e){return this.createReadStream(o(e,{keys:!1,values:!0}))},b.prototype.toString=function(){return"LevelUP"},b.errors=c,t.exports=b.default=b}).call(this)}).call(this,e("_process"))},{"./batch":268,"./common":269,"./promisify":271,_process:303,assert:220,"deferred-leveldown":233,events:241,"level-errors":251,"level-iterator-stream":252,util:442,xtend:450}],271:[function(e,t,n){t.exports=function(){var e,t=new Promise((function(t,n){e=function(e,r){e?n(e):t(r)}}));return e.promise=t,e}},{}],272:[function(e,t,n){(function(e){(function(){function t(e){return void 0!==e&&""!==e}function r(e,t){return Object.hasOwnProperty.call(e,t)}function i(e,t){return Object.hasOwnProperty.call(e,t)&&t}n.compare=function(t,n){if(e.isBuffer(t)){for(var r=Math.min(t.length,n.length),i=0;i<r;i++){var o=t[i]-n[i];if(o)return o}return t.length-n.length}return t<n?-1:t>n?1:0};var o=n.lowerBoundKey=function(e){return i(e,"gt")||i(e,"gte")||i(e,"min")||(e.reverse?i(e,"end"):i(e,"start"))||void 0},s=n.lowerBound=function(e,t){var n=o(e);return n?e[n]:t},a=n.lowerBoundInclusive=function(e){return!r(e,"gt")},l=n.upperBoundInclusive=function(e){return!r(e,"lt")},c=n.lowerBoundExclusive=function(e){return!a(e)},u=n.upperBoundExclusive=function(e){return!l(e)},d=n.upperBoundKey=function(e){return i(e,"lt")||i(e,"lte")||i(e,"max")||(e.reverse?i(e,"start"):i(e,"end"))||void 0},p=n.upperBound=function(e,t){var n=d(e);return n?e[n]:t};function h(e){return e}n.start=function(e,t){return e.reverse?p(e,t):s(e,t)},n.end=function(e,t){return e.reverse?s(e,t):p(e,t)},n.startInclusive=function(e){return e.reverse?l(e):a(e)},n.endInclusive=function(e){return e.reverse?a(e):l(e)},n.toLtgt=function(e,t,i,o,s){t=t||{},i=i||h;var a=arguments.length>3,l=n.lowerBoundKey(e),c=n.upperBoundKey(e);return l?"gt"===l?t.gt=i(e.gt,!1):t.gte=i(e[l],!1):a&&(t.gte=i(o,!1)),c?"lt"===c?t.lt=i(e.lt,!0):t.lte=i(e[c],!0):a&&(t.lte=i(s,!0)),null!=e.reverse&&(t.reverse=!!e.reverse),r(t,"max")&&delete t.max,r(t,"min")&&delete t.min,r(t,"start")&&delete t.start,r(t,"end")&&delete t.end,t},n.contains=function(e,r,i){i=i||n.compare;var o=s(e);if(t(o)&&((a=i(r,o))<0||0===a&&c(e)))return!1;var a,l=p(e);return!t(l)||!((a=i(r,l))>0||0===a&&u(e))},n.filter=function(e,t){return function(r){return n.contains(e,r,t)}}}).call(this)}).call(this,{isBuffer:e("../is-buffer/index.js")})},{"../is-buffer/index.js":248}],273:[function(e,t,n){(function(e){(function(){!function(e){"use strict";var r={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:m,hr:/^ {0,3}((?:- *){3,}|(?:_ *){3,}|(?:\* *){3,})(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:m,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment *(?:\n|\s*$)|closed *(?:\n{2,}|\s*$)|closing *(?:\n{2,}|\s*$))/,def:/^ {0,3}\[(label)\]: *\n? *<?([^\s>]+)>?(?:(?: +\n? *| *\n *)(title))? *(?:\n+|$)/,table:m,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,paragraph:/^([^\n]+(?:\n?(?!hr|heading|lheading| {0,3}>|tag)[^\n]+)+)/,text:/^[^\n]+/};function i(e){this.tokens=[],this.tokens.links={},this.options=e||y.defaults,this.rules=r.normal,this.options.gfm&&(this.options.tables?this.rules=r.tables:this.rules=r.gfm)}r._label=/(?:\\[\[\]]|[^\[\]])+/,r._title=/(?:"(?:\\"|[^"]|"[^"\n]*")*"|'\n?(?:[^'\n]+\n?)*'|\([^()]*\))/,r.def=p(r.def).replace("label",r._label).replace("title",r._title).getRegex(),r.bullet=/(?:[*+-]|\d+\.)/,r.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,r.item=p(r.item,"gm").replace(/bull/g,r.bullet).getRegex(),r.list=p(r.list).replace(/bull/g,r.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+r.def.source+")").getRegex(),r._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b",r.html=p(r.html).replace("comment",/<!--[\s\S]*?-->/).replace("closed",/<(tag)[\s\S]+?<\/\1>/).replace("closing",/<tag(?:"[^"]*"|'[^']*'|\s[^'"\/>\s]*)*?\/?>/).replace(/tag/g,r._tag).getRegex(),r.paragraph=p(r.paragraph).replace("hr",r.hr).replace("heading",r.heading).replace("lheading",r.lheading).replace("tag","<"+r._tag).getRegex(),r.blockquote=p(r.blockquote).replace("paragraph",r.paragraph).getRegex(),r.normal=v({},r),r.gfm=v({},r.normal,{fences:/^ *(`{3,}|~{3,})[ \.]*(\S+)? *\n([\s\S]*?)\n? *\1 *(?:\n+|$)/,paragraph:/^/,heading:/^ *(#{1,6}) +([^\n]+?) *#* *(?:\n+|$)/}),r.gfm.paragraph=p(r.paragraph).replace("(?!","(?!"+r.gfm.fences.source.replace("\\1","\\2")+"|"+r.list.source.replace("\\1","\\3")+"|").getRegex(),r.tables=v({},r.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),i.rules=r,i.lex=function(e,t){return new i(t).lex(e)},i.prototype.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(e,!0)},i.prototype.token=function(e,t){var n,i,o,s,a,l,c,u,d,p,h;for(e=e.replace(/^ +$/gm,"");e;)if((o=this.rules.newline.exec(e))&&(e=e.substring(o[0].length),o[0].length>1&&this.tokens.push({type:"space"})),o=this.rules.code.exec(e))e=e.substring(o[0].length),o=o[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?o:o.replace(/\n+$/,"")});else if(o=this.rules.fences.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"code",lang:o[2],text:o[3]||""});else if(o=this.rules.heading.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"heading",depth:o[1].length,text:o[2]});else if(t&&(o=this.rules.nptable.exec(e))){for(e=e.substring(o[0].length),l={type:"table",header:o[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:o[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:o[3].replace(/\n$/,"").split("\n")},u=0;u<l.align.length;u++)/^ *-+: *$/.test(l.align[u])?l.align[u]="right":/^ *:-+: *$/.test(l.align[u])?l.align[u]="center":/^ *:-+ *$/.test(l.align[u])?l.align[u]="left":l.align[u]=null;for(u=0;u<l.cells.length;u++)l.cells[u]=l.cells[u].split(/ *\| */);this.tokens.push(l)}else if(o=this.rules.hr.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"hr"});else if(o=this.rules.blockquote.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"blockquote_start"}),o=o[0].replace(/^ *> ?/gm,""),this.token(o,t),this.tokens.push({type:"blockquote_end"});else if(o=this.rules.list.exec(e)){for(e=e.substring(o[0].length),h=(s=o[2]).length>1,this.tokens.push({type:"list_start",ordered:h,start:h?+s:""}),n=!1,p=(o=o[0].match(this.rules.item)).length,u=0;u<p;u++)c=(l=o[u]).length,~(l=l.replace(/^ *([*+-]|\d+\.) +/,"")).indexOf("\n ")&&(c-=l.length,l=this.options.pedantic?l.replace(/^ {1,4}/gm,""):l.replace(new RegExp("^ {1,"+c+"}","gm"),"")),this.options.smartLists&&u!==p-1&&(s===(a=r.bullet.exec(o[u+1])[0])||s.length>1&&a.length>1||(e=o.slice(u+1).join("\n")+e,u=p-1)),i=n||/\n\n(?!\s*$)/.test(l),u!==p-1&&(n="\n"===l.charAt(l.length-1),i||(i=n)),this.tokens.push({type:i?"loose_item_start":"list_item_start"}),this.token(l,!1),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(o=this.rules.html.exec(e))e=e.substring(o[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:!this.options.sanitizer&&("pre"===o[1]||"script"===o[1]||"style"===o[1]),text:o[0]});else if(t&&(o=this.rules.def.exec(e)))e=e.substring(o[0].length),o[3]&&(o[3]=o[3].substring(1,o[3].length-1)),d=o[1].toLowerCase(),this.tokens.links[d]||(this.tokens.links[d]={href:o[2],title:o[3]});else if(t&&(o=this.rules.table.exec(e))){for(e=e.substring(o[0].length),l={type:"table",header:o[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:o[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:o[3].replace(/(?: *\| *)?\n$/,"").split("\n")},u=0;u<l.align.length;u++)/^ *-+: *$/.test(l.align[u])?l.align[u]="right":/^ *:-+: *$/.test(l.align[u])?l.align[u]="center":/^ *:-+ *$/.test(l.align[u])?l.align[u]="left":l.align[u]=null;for(u=0;u<l.cells.length;u++)l.cells[u]=l.cells[u].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(l)}else if(o=this.rules.lheading.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"heading",depth:"="===o[2]?1:2,text:o[1]});else if(t&&(o=this.rules.paragraph.exec(e)))e=e.substring(o[0].length),this.tokens.push({type:"paragraph",text:"\n"===o[1].charAt(o[1].length-1)?o[1].slice(0,-1):o[1]});else if(o=this.rules.text.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"text",text:o[0]});else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return this.tokens};var o={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:m,tag:/^<!--[\s\S]*?-->|^<\/?[a-zA-Z0-9\-]+(?:"[^"]*"|'[^']*'|\s[^<'">\/\s]*)*?\/?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\[\]]*\]|\\[\[\]]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^_([^\s_](?:[^_]|__)+?[^\s_])_\b|^\*((?:\*\*|[^*])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`]?)\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:m,text:/^[\s\S]+?(?=[\\<!\[`*]|\b_| {2,}\n|$)/};function s(e,t){if(this.options=t||y.defaults,this.links=e,this.rules=o.normal,this.renderer=this.options.renderer||new a,this.renderer.options=this.options,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.options.breaks?this.rules=o.breaks:this.rules=o.gfm:this.options.pedantic&&(this.rules=o.pedantic)}function a(e){this.options=e||{}}function l(){}function c(e){this.tokens=[],this.token=null,this.options=e||y.defaults,this.options.renderer=this.options.renderer||new a,this.renderer=this.options.renderer,this.renderer.options=this.options}function u(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function d(e){return e.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,(function(e,t){return"colon"===(t=t.toLowerCase())?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""}))}function p(e,t){return e=e.source,t=t||"",{replace:function(t,n){return n=(n=n.source||n).replace(/(^|[^\[])\^/g,"$1"),e=e.replace(t,n),this},getRegex:function(){return new RegExp(e,t)}}}function h(e,t){return f[" "+e]||(/^[^:]+:\/*[^/]*$/.test(e)?f[" "+e]=e+"/":f[" "+e]=e.replace(/[^/]*$/,"")),e=f[" "+e],"//"===t.slice(0,2)?e.replace(/:[\s\S]*/,":")+t:"/"===t.charAt(0)?e.replace(/(:\/*[^/]*)[\s\S]*/,"$1")+t:e+t}o._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,o._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,o.autolink=p(o.autolink).replace("scheme",o._scheme).replace("email",o._email).getRegex(),o._inside=/(?:\[[^\[\]]*\]|\\[\[\]]|[^\[\]]|\](?=[^\[]*\]))*/,o._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,o.link=p(o.link).replace("inside",o._inside).replace("href",o._href).getRegex(),o.reflink=p(o.reflink).replace("inside",o._inside).getRegex(),o.normal=v({},o),o.pedantic=v({},o.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),o.gfm=v({},o.normal,{escape:p(o.escape).replace("])","~|])").getRegex(),url:p(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("email",o._email).getRegex(),_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:p(o.text).replace("]|","~]|").replace("|","|https?://|ftp://|www\\.|[a-zA-Z0-9.!#$%&'*+/=?^_`{\\|}~-]+@|").getRegex()}),o.breaks=v({},o.gfm,{br:p(o.br).replace("{2,}","*").getRegex(),text:p(o.gfm.text).replace("{2,}","*").getRegex()}),s.rules=o,s.output=function(e,t,n){return new s(t,n).output(e)},s.prototype.output=function(e){for(var t,n,r,i,o="";e;)if(i=this.rules.escape.exec(e))e=e.substring(i[0].length),o+=i[1];else if(i=this.rules.autolink.exec(e))e=e.substring(i[0].length),r="@"===i[2]?"mailto:"+(n=u(this.mangle(i[1]))):n=u(i[1]),o+=this.renderer.link(r,null,n);else if(this.inLink||!(i=this.rules.url.exec(e))){if(i=this.rules.tag.exec(e))!this.inLink&&/^<a /i.test(i[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(i[0])&&(this.inLink=!1),e=e.substring(i[0].length),o+=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(i[0]):u(i[0]):i[0];else if(i=this.rules.link.exec(e))e=e.substring(i[0].length),this.inLink=!0,o+=this.outputLink(i,{href:i[2],title:i[3]}),this.inLink=!1;else if((i=this.rules.reflink.exec(e))||(i=this.rules.nolink.exec(e))){if(e=e.substring(i[0].length),t=(i[2]||i[1]).replace(/\s+/g," "),!(t=this.links[t.toLowerCase()])||!t.href){o+=i[0].charAt(0),e=i[0].substring(1)+e;continue}this.inLink=!0,o+=this.outputLink(i,t),this.inLink=!1}else if(i=this.rules.strong.exec(e))e=e.substring(i[0].length),o+=this.renderer.strong(this.output(i[2]||i[1]));else if(i=this.rules.em.exec(e))e=e.substring(i[0].length),o+=this.renderer.em(this.output(i[2]||i[1]));else if(i=this.rules.code.exec(e))e=e.substring(i[0].length),o+=this.renderer.codespan(u(i[2].trim(),!0));else if(i=this.rules.br.exec(e))e=e.substring(i[0].length),o+=this.renderer.br();else if(i=this.rules.del.exec(e))e=e.substring(i[0].length),o+=this.renderer.del(this.output(i[1]));else if(i=this.rules.text.exec(e))e=e.substring(i[0].length),o+=this.renderer.text(u(this.smartypants(i[0])));else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}else i[0]=this.rules._backpedal.exec(i[0])[0],e=e.substring(i[0].length),"@"===i[2]?r="mailto:"+(n=u(i[0])):(n=u(i[0]),r="www."===i[1]?"http://"+n:n),o+=this.renderer.link(r,null,n);return o},s.prototype.outputLink=function(e,t){var n=u(t.href),r=t.title?u(t.title):null;return"!"!==e[0].charAt(0)?this.renderer.link(n,r,this.output(e[1])):this.renderer.image(n,r,u(e[1]))},s.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/---/g,"").replace(/--/g,"").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1").replace(/'/g,"").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1").replace(/"/g,"").replace(/\.{3}/g,""):e},s.prototype.mangle=function(e){if(!this.options.mangle)return e;for(var t,n="",r=e.length,i=0;i<r;i++)t=e.charCodeAt(i),Math.random()>.5&&(t="x"+t.toString(16)),n+="&#"+t+";";return n},a.prototype.code=function(e,t,n){if(this.options.highlight){var r=this.options.highlight(e,t);null!=r&&r!==e&&(n=!0,e=r)}return t?'<pre><code class="'+this.options.langPrefix+u(t,!0)+'">'+(n?e:u(e,!0))+"\n</code></pre>\n":"<pre><code>"+(n?e:u(e,!0))+"\n</code></pre>"},a.prototype.blockquote=function(e){return"<blockquote>\n"+e+"</blockquote>\n"},a.prototype.html=function(e){return e},a.prototype.heading=function(e,t,n){return"<h"+t+' id="'+this.options.headerPrefix+n.toLowerCase().replace(/[^\w]+/g,"-")+'">'+e+"</h"+t+">\n"},a.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},a.prototype.list=function(e,t,n){var r=t?"ol":"ul";return"<"+r+(t&&1!==n?' start="'+n+'"':"")+">\n"+e+"</"+r+">\n"},a.prototype.listitem=function(e){return"<li>"+e+"</li>\n"},a.prototype.paragraph=function(e){return"<p>"+e+"</p>\n"},a.prototype.table=function(e,t){return"<table>\n<thead>\n"+e+"</thead>\n<tbody>\n"+t+"</tbody>\n</table>\n"},a.prototype.tablerow=function(e){return"<tr>\n"+e+"</tr>\n"},a.prototype.tablecell=function(e,t){var n=t.header?"th":"td";return(t.align?"<"+n+' style="text-align:'+t.align+'">':"<"+n+">")+e+"</"+n+">\n"},a.prototype.strong=function(e){return"<strong>"+e+"</strong>"},a.prototype.em=function(e){return"<em>"+e+"</em>"},a.prototype.codespan=function(e){return"<code>"+e+"</code>"},a.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"},a.prototype.del=function(e){return"<del>"+e+"</del>"},a.prototype.link=function(e,t,n){if(this.options.sanitize){try{var r=decodeURIComponent(d(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return n}if(0===r.indexOf("javascript:")||0===r.indexOf("vbscript:")||0===r.indexOf("data:"))return n}this.options.baseUrl&&!g.test(e)&&(e=h(this.options.baseUrl,e));var i='<a href="'+e+'"';return t&&(i+=' title="'+t+'"'),i+">"+n+"</a>"},a.prototype.image=function(e,t,n){this.options.baseUrl&&!g.test(e)&&(e=h(this.options.baseUrl,e));var r='<img src="'+e+'" alt="'+n+'"';return t&&(r+=' title="'+t+'"'),r+(this.options.xhtml?"/>":">")},a.prototype.text=function(e){return e},l.prototype.strong=l.prototype.em=l.prototype.codespan=l.prototype.del=l.prototype.text=function(e){return e},l.prototype.link=l.prototype.image=function(e,t,n){return""+n},l.prototype.br=function(){return""},c.parse=function(e,t){return new c(t).parse(e)},c.prototype.parse=function(e){this.inline=new s(e.links,this.options),this.inlineText=new s(e.links,v({},this.options,{renderer:new l})),this.tokens=e.reverse();for(var t="";this.next();)t+=this.tok();return t},c.prototype.next=function(){return this.token=this.tokens.pop()},c.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},c.prototype.parseText=function(){for(var e=this.token.text;"text"===this.peek().type;)e+="\n"+this.next().text;return this.inline.output(e)},c.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,d(this.inlineText.output(this.token.text)));case"code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"table":var e,t,n,r,i="",o="";for(n="",e=0;e<this.token.header.length;e++)n+=this.renderer.tablecell(this.inline.output(this.token.header[e]),{header:!0,align:this.token.align[e]});for(i+=this.renderer.tablerow(n),e=0;e<this.token.cells.length;e++){for(t=this.token.cells[e],n="",r=0;r<t.length;r++)n+=this.renderer.tablecell(this.inline.output(t[r]),{header:!1,align:this.token.align[r]});o+=this.renderer.tablerow(n)}return this.renderer.table(i,o);case"blockquote_start":for(o="";"blockquote_end"!==this.next().type;)o+=this.tok();return this.renderer.blockquote(o);case"list_start":o="";for(var s=this.token.ordered,a=this.token.start;"list_end"!==this.next().type;)o+=this.tok();return this.renderer.list(o,s,a);case"list_item_start":for(o="";"list_item_end"!==this.next().type;)o+="text"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(o);case"loose_item_start":for(o="";"list_item_end"!==this.next().type;)o+=this.tok();return this.renderer.listitem(o);case"html":var l=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);return this.renderer.html(l);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case"text":return this.renderer.paragraph(this.parseText())}};var f={},g=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function m(){}function v(e){for(var t,n,r=1;r<arguments.length;r++)for(n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}function y(e,t,n){if(null==e)throw new Error("marked(): input parameter is undefined or null");if("string"!=typeof e)throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected");if(n||"function"==typeof t){n||(n=t,t=null);var r,o,s=(t=v({},y.defaults,t||{})).highlight,a=0;try{r=i.lex(e,t)}catch(e){return n(e)}o=r.length;var l=function(e){if(e)return t.highlight=s,n(e);var i;try{i=c.parse(r,t)}catch(t){e=t}return t.highlight=s,e?n(e):n(null,i)};if(!s||s.length<3)return l();if(delete t.highlight,!o)return l();for(;a<r.length;a++)!function(e){"code"!==e.type?--o||l():s(e.text,e.lang,(function(t,n){return t?l(t):null==n||n===e.text?--o||l():(e.text=n,e.escaped=!0,void(--o||l()))}))}(r[a])}else try{return t&&(t=v({},y.defaults,t)),c.parse(i.lex(e,t),t)}catch(e){if(e.message+="\nPlease report this to https://github.com/markedjs/marked.",(t||y.defaults).silent)return"<p>An error occurred:</p><pre>"+u(e.message+"",!0)+"</pre>";throw e}}m.exec=m,y.options=y.setOptions=function(e){return v(y.defaults,e),y},y.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,sanitizer:null,mangle:!0,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1,headerPrefix:"",renderer:new a,xhtml:!1,baseUrl:null},y.Parser=c,y.parser=c.parse,y.Renderer=a,y.TextRenderer=l,y.Lexer=i,y.lexer=i.lex,y.InlineLexer=s,y.inlineLexer=s.output,y.parse=y,void 0!==t&&"object"==typeof n?t.exports=y:"function"==typeof define&&define.amd?define((function(){return y})):e.marked=y}(this||("undefined"!=typeof window?window:e))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],274:[function(e,t,n){t.exports=e("immediate")},{immediate:281}],275:[function(e,t,n){(function(n){(function(){var r=e("inherits"),i=e("abstract-leveldown").AbstractLevelDOWN,o=e("abstract-leveldown").AbstractIterator,s=e("ltgt"),a=e("functional-red-black-tree"),l={},c=e("./immediate");function u(e){return s.compare(e,this._end)>0}function d(e){return s.compare(e,this._end)>=0}function p(e){return s.compare(e,this._end)<0}function h(e){return s.compare(e,this._end)<=0}function f(e,t){o.call(this,e),this._limit=t.limit,-1===this._limit&&(this._limit=1/0);var n=e._store[e._location];this.keyAsBuffer=!1!==t.keyAsBuffer,this.valueAsBuffer=!1!==t.valueAsBuffer,this._reverse=t.reverse,this._options=t,this._done=0,this._reverse?(this._incr="prev",this._start=s.upperBound(t),this._end=s.lowerBound(t),void 0===this._start?this._tree=n.end:s.upperBoundInclusive(t)?this._tree=n.le(this._start):this._tree=n.lt(this._start),this._end&&(s.lowerBoundInclusive(t)?this._test=d:this._test=u)):(this._incr="next",this._start=s.lowerBound(t),this._end=s.upperBound(t),void 0===this._start?this._tree=n.begin:s.lowerBoundInclusive(t)?this._tree=n.ge(this._start):this._tree=n.gt(this._start),this._end&&(s.upperBoundInclusive(t)?this._test=h:this._test=p))}function g(e){if(!(this instanceof g))return new g(e);i.call(this,"string"==typeof e?e:""),this._location=this.location?"$"+this.location:"_tree",this._store=this.location?l:this,this._store[this._location]=this._store[this._location]||a(s.compare)}r(f,o),f.prototype._next=function(e){var t,r;return this._done++>=this._limit?c(e):this._tree.valid?(t=this._tree.key,r=this._tree.value,this._test(t)?(this.keyAsBuffer&&(t=new n(t)),this.valueAsBuffer&&(r=new n(r)),this._tree[this._incr](),void c((function(){e(null,t,r)}))):c(e)):c(e)},f.prototype._test=function(){return!0},g.clearGlobalStore=function(e){e?Object.keys(l).forEach((function(e){delete l[e]})):l={}},r(g,i),g.prototype._open=function(e,t){var n=this;c((function(){t(null,n)}))},g.prototype._put=function(e,t,n,r){null==t&&(t="");var i=this._store[this._location].find(e);i.valid?this._store[this._location]=i.update(t):this._store[this._location]=this._store[this._location].insert(e,t),c(r)},g.prototype._get=function(e,t,r){var i=this._store[this._location].get(e);if(void 0===i)return c((function(){r(new Error("NotFound"))}));!1===t.asBuffer||this._isBuffer(i)||(i=new n(String(i))),c((function(){r(null,i)}))},g.prototype._del=function(e,t,n){this._store[this._location]=this._store[this._location].remove(e),c(n)},g.prototype._batch=function(e,t,n){for(var r,i,o,s=-1,a=e.length,l=this._store[this._location];++s<a;)e[s]&&(r=this._isBuffer(e[s].key)?e[s].key:String(e[s].key),o=l.find(r),"put"===e[s].type?(i=this._isBuffer(e[s].value)?e[s].value:String(e[s].value),l=o.valid?o.update(i):l.insert(r,i)):l=o.remove());this._store[this._location]=l,c(n)},g.prototype._iterator=function(e){return new f(this,e)},g.prototype._isBuffer=function(e){return n.isBuffer(e)},g.destroy=function(e,t){var n="$"+e;n in l&&delete l[n],c(t)},t.exports=g}).call(this)}).call(this,e("buffer").Buffer)},{"./immediate":274,"abstract-leveldown":279,buffer:226,"functional-red-black-tree":243,inherits:247,ltgt:287}],276:[function(e,t,n){(function(e){(function(){function n(e){this._db=e,this._operations=[],this._written=!1}n.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},n.prototype.put=function(e,t){this._checkWritten();var n=this._db._checkKey(e,"key",this._db._isBuffer);if(n)throw n;return this._db._isBuffer(e)||(e=String(e)),this._db._isBuffer(t)||(t=String(t)),"function"==typeof this._put?this._put(e,t):this._operations.push({type:"put",key:e,value:t}),this},n.prototype.del=function(e){this._checkWritten();var t=this._db._checkKey(e,"key",this._db._isBuffer);if(t)throw t;return this._db._isBuffer(e)||(e=String(e)),"function"==typeof this._del?this._del(e):this._operations.push({type:"del",key:e}),this},n.prototype.clear=function(){return this._checkWritten(),this._operations=[],"function"==typeof this._clear&&this._clear(),this},n.prototype.write=function(t,n){if(this._checkWritten(),"function"==typeof t&&(n=t),"function"!=typeof n)throw new Error("write() requires a callback argument");return"object"!=typeof t&&(t={}),this._written=!0,"function"==typeof this._write?this._write(n):"function"==typeof this._db._batch?this._db._batch(this._operations,t,n):void e.nextTick(n)},t.exports=n}).call(this)}).call(this,e("_process"))},{_process:303}],277:[function(e,t,n){(function(e){(function(){function n(e){this.db=e,this._ended=!1,this._nexting=!1}n.prototype.next=function(t){var n=this;if("function"!=typeof t)throw new Error("next() requires a callback argument");return n._ended?t(new Error("cannot call next() after end()")):n._nexting?t(new Error("cannot call next() before previous next() has completed")):(n._nexting=!0,"function"==typeof n._next?n._next((function(){n._nexting=!1,t.apply(null,arguments)})):void e.nextTick((function(){n._nexting=!1,t()})))},n.prototype.end=function(t){if("function"!=typeof t)throw new Error("end() requires a callback argument");return this._ended?t(new Error("end() already called on iterator")):(this._ended=!0,"function"==typeof this._end?this._end(t):void e.nextTick(t))},t.exports=n}).call(this)}).call(this,e("_process"))},{_process:303}],278:[function(e,t,n){(function(n,r){(function(){var i=e("xtend"),o=e("./abstract-iterator"),s=e("./abstract-chained-batch");function a(e){if(!arguments.length||void 0===e)throw new Error("constructor requires at least a location argument");if("string"!=typeof e)throw new Error("constructor requires a location string argument");this.location=e,this.status="new"}a.prototype.open=function(e,t){var n=this,i=this.status;if("function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("open() requires a callback argument");"object"!=typeof e&&(e={}),e.createIfMissing=0!=e.createIfMissing,e.errorIfExists=!!e.errorIfExists,"function"==typeof this._open?(this.status="opening",this._open(e,(function(e){if(e)return n.status=i,t(e);n.status="open",t()}))):(this.status="open",r.nextTick(t))},a.prototype.close=function(e){var t=this,n=this.status;if("function"!=typeof e)throw new Error("close() requires a callback argument");"function"==typeof this._close?(this.status="closing",this._close((function(r){if(r)return t.status=n,e(r);t.status="closed",e()}))):(this.status="closed",r.nextTick(e))},a.prototype.get=function(e,t,n){var i;if("function"==typeof t&&(n=t),"function"!=typeof n)throw new Error("get() requires a callback argument");return(i=this._checkKey(e,"key",this._isBuffer))?n(i):(this._isBuffer(e)||(e=String(e)),"object"!=typeof t&&(t={}),t.asBuffer=0!=t.asBuffer,"function"==typeof this._get?this._get(e,t,n):void r.nextTick((function(){n(new Error("NotFound"))})))},a.prototype.put=function(e,t,n,i){var o;if("function"==typeof n&&(i=n),"function"!=typeof i)throw new Error("put() requires a callback argument");return(o=this._checkKey(e,"key",this._isBuffer))?i(o):(this._isBuffer(e)||(e=String(e)),null==t||this._isBuffer(t)||r.browser||(t=String(t)),"object"!=typeof n&&(n={}),"function"==typeof this._put?this._put(e,t,n,i):void r.nextTick(i))},a.prototype.del=function(e,t,n){var i;if("function"==typeof t&&(n=t),"function"!=typeof n)throw new Error("del() requires a callback argument");return(i=this._checkKey(e,"key",this._isBuffer))?n(i):(this._isBuffer(e)||(e=String(e)),"object"!=typeof t&&(t={}),"function"==typeof this._del?this._del(e,t,n):void r.nextTick(n))},a.prototype.batch=function(e,t,n){if(!arguments.length)return this._chainedBatch();if("function"==typeof t&&(n=t),"function"==typeof e&&(n=e),"function"!=typeof n)throw new Error("batch(array) requires a callback argument");if(!Array.isArray(e))return n(new Error("batch(array) requires an array argument"));t&&"object"==typeof t||(t={});for(var i,o,s=0,a=e.length;s<a;s++)if("object"==typeof(i=e[s])){if(o=this._checkKey(i.type,"type",this._isBuffer))return n(o);if(o=this._checkKey(i.key,"key",this._isBuffer))return n(o)}if("function"==typeof this._batch)return this._batch(e,t,n);r.nextTick(n)},a.prototype.approximateSize=function(e,t,n){if(null==e||null==t||"function"==typeof e||"function"==typeof t)throw new Error("approximateSize() requires valid `start`, `end` and `callback` arguments");if("function"!=typeof n)throw new Error("approximateSize() requires a callback argument");if(this._isBuffer(e)||(e=String(e)),this._isBuffer(t)||(t=String(t)),"function"==typeof this._approximateSize)return this._approximateSize(e,t,n);r.nextTick((function(){n(null,0)}))},a.prototype._setupIteratorOptions=function(e){var t=this;return e=i(e),["start","end","gt","gte","lt","lte"].forEach((function(n){e[n]&&t._isBuffer(e[n])&&0===e[n].length&&delete e[n]})),e.reverse=!!e.reverse,e.keys=0!=e.keys,e.values=0!=e.values,e.limit="limit"in e?e.limit:-1,e.keyAsBuffer=0!=e.keyAsBuffer,e.valueAsBuffer=0!=e.valueAsBuffer,e},a.prototype.iterator=function(e){return"object"!=typeof e&&(e={}),e=this._setupIteratorOptions(e),"function"==typeof this._iterator?this._iterator(e):new o(this)},a.prototype._chainedBatch=function(){return new s(this)},a.prototype._isBuffer=function(e){return n.isBuffer(e)},a.prototype._checkKey=function(e,t){if(null==e)return new Error(t+" cannot be `null` or `undefined`");if(this._isBuffer(e)){if(0===e.length)return new Error(t+" cannot be an empty Buffer")}else if(""===String(e))return new Error(t+" cannot be an empty String")},t.exports=a}).call(this)}).call(this,{isBuffer:e("../../../is-buffer/index.js")},e("_process"))},{"../../../is-buffer/index.js":248,"./abstract-chained-batch":276,"./abstract-iterator":277,_process:303,xtend:450}],279:[function(e,t,n){n.AbstractLevelDOWN=e("./abstract-leveldown"),n.AbstractIterator=e("./abstract-iterator"),n.AbstractChainedBatch=e("./abstract-chained-batch"),n.isLevelDOWN=e("./is-leveldown")},{"./abstract-chained-batch":276,"./abstract-iterator":277,"./abstract-leveldown":278,"./is-leveldown":280}],280:[function(e,t,n){var r=e("./abstract-leveldown");t.exports=function(e){return!(!e||"object"!=typeof e)&&Object.keys(r.prototype).filter((function(e){return"_"!=e[0]&&"approximateSize"!=e})).every((function(t){return"function"==typeof e[t]}))}},{"./abstract-leveldown":278}],281:[function(e,t,n){"use strict";var r,i,o,s=[e("./nextTick"),e("./queueMicrotask"),e("./mutation.js"),e("./messageChannel"),e("./stateChange"),e("./timeout")],a=-1,l=[],c=!1;function u(){r&&i&&(r=!1,i.length?l=i.concat(l):a=-1,l.length&&d())}function d(){if(!r){c=!1,r=!0;for(var e=l.length,t=setTimeout(u);e;){for(i=l,l=[];i&&++a<e;)i[a].run();a=-1,e=l.length}i=null,a=-1,r=!1,clearTimeout(t)}}for(var p=-1,h=s.length;++p<h;)if(s[p]&&s[p].test&&s[p].test()){o=s[p].install(d);break}function f(e,t){this.fun=e,this.array=t}f.prototype.run=function(){var e=this.fun,t=this.array;switch(t.length){case 0:return e();case 1:return e(t[0]);case 2:return e(t[0],t[1]);case 3:return e(t[0],t[1],t[2]);default:return e.apply(null,t)}},t.exports=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new f(e,t)),c||r||(c=!0,o())}},{"./messageChannel":282,"./mutation.js":283,"./nextTick":225,"./queueMicrotask":284,"./stateChange":285,"./timeout":286}],282:[function(e,t,n){(function(e){(function(){"use strict";n.test=function(){return!e.setImmediate&&void 0!==e.MessageChannel},n.install=function(t){var n=new e.MessageChannel;return n.port1.onmessage=t,function(){n.port2.postMessage(0)}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],283:[function(e,t,n){(function(e){(function(){"use strict";var t=e.MutationObserver||e.WebKitMutationObserver;n.test=function(){return t},n.install=function(n){var r=0,i=new t(n),o=e.document.createTextNode("");return i.observe(o,{characterData:!0}),function(){o.data=r=++r%2}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],284:[function(e,t,n){(function(e){(function(){"use strict";n.test=function(){return"function"==typeof e.queueMicrotask},n.install=function(t){return function(){e.queueMicrotask(t)}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],285:[function(e,t,n){(function(e){(function(){"use strict";n.test=function(){return"document"in e&&"onreadystatechange"in e.document.createElement("script")},n.install=function(t){return function(){var n=e.document.createElement("script");return n.onreadystatechange=function(){t(),n.onreadystatechange=null,n.parentNode.removeChild(n),n=null},e.document.documentElement.appendChild(n),t}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],286:[function(e,t,n){"use strict";n.test=function(){return!0},n.install=function(e){return function(){setTimeout(e,0)}}},{}],287:[function(e,t,n){(function(e){(function(){function t(e,t){return Object.hasOwnProperty.call(e,t)}function r(e){return void 0!==e&&""!==e}function t(e,t){return Object.hasOwnProperty.call(e,t)}function i(e,t){return Object.hasOwnProperty.call(e,t)&&t}n.compare=function(t,n){if(e.isBuffer(t)){for(var r=Math.min(t.length,n.length),i=0;i<r;i++){var o=t[i]-n[i];if(o)return o}return t.length-n.length}return t<n?-1:t>n?1:0};var o=n.lowerBoundKey=function(e){return i(e,"gt")||i(e,"gte")||i(e,"min")||(e.reverse?i(e,"end"):i(e,"start"))||void 0},s=n.lowerBound=function(e){var t=o(e);return t&&e[t]},a=n.lowerBoundInclusive=function(e){return!t(e,"gt")},l=n.upperBoundInclusive=function(e){return!t(e,"lt")},c=n.lowerBoundExclusive=function(e){return!a(e)},u=n.upperBoundExclusive=function(e){return!l(e)},d=n.upperBoundKey=function(e){return i(e,"lt")||i(e,"lte")||i(e,"max")||(e.reverse?i(e,"start"):i(e,"end"))||void 0},p=n.upperBound=function(e){var t=d(e);return t&&e[t]};function h(e){return e}n.toLtgt=function(e,r,i,o,s){r=r||{},i=i||h;var a=arguments.length>3,l=n.lowerBoundKey(e),c=n.upperBoundKey(e);return l?"gt"===l?r.gt=i(e.gt,!1):r.gte=i(e[l],!1):a&&(r.gte=i(o,!1)),c?"lt"===c?r.lt=i(e.lt,!0):r.lte=i(e[c],!0):a&&(r.lte=i(s,!0)),null!=e.reverse&&(r.reverse=!!e.reverse),t(r,"max")&&delete r.max,t(r,"min")&&delete r.min,t(r,"start")&&delete r.start,t(r,"end")&&delete r.end,r},n.contains=function(e,t,i){i=i||n.compare;var o=s(e);if(r(o)&&((a=i(t,o))<0||0===a&&c(e)))return!1;var a,l=p(e);return!r(l)||!((a=i(t,l))>0||0===a&&u(e))},n.filter=function(e,t){return function(r){return n.contains(e,r,t)}}}).call(this)}).call(this,{isBuffer:e("../../../is-buffer/index.js")})},{"../../../is-buffer/index.js":248}],288:[function(e,t,n){"use strict";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function s(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}t.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,a,l=s(e),c=1;c<arguments.length;c++){for(var u in n=Object(arguments[c]))i.call(n,u)&&(l[u]=n[u]);if(r){a=r(n);for(var d=0;d<a.length;d++)o.call(n,a[d])&&(l[a[d]]=n[a[d]])}}return l}},{}],289:[function(e,t,n){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var i=r(e("levelup")),o=r(e("sublevel-pouchdb")),s=e("through2"),a=r(e("argsarray")),l=r(e("double-ended-queue")),c=r(e("buffer-from")),u=e("pouchdb-adapter-utils"),d=e("pouchdb-merge"),p=e("pouchdb-json"),h=e("pouchdb-md5"),f=e("pouchdb-binary-utils"),g=e("pouchdb-collections"),m=e("pouchdb-utils"),v=e("pouchdb-errors");function y(e,t){var n=new Uint8Array(e);return f.blob([n],{type:t})}function b(e,t){f.readAsBinaryString(e,t)}function x(e,t){var n=t.prefix()[0],r=e._cache,i=r.get(n);return i||(i=new g.Map,r.set(n,i)),i}function E(){this._batch=[],this._cache=new g.Map}E.prototype.get=function(e,t,n){var r=x(this,e),i=r.get(t);return i?m.nextTick((function(){n(null,i)})):null===i?m.nextTick((function(){n({name:"NotFoundError"})})):void e.get(t,(function(e,i){if(e)return"NotFoundError"===e.name&&r.set(t,null),n(e);r.set(t,i),n(null,i)}))},E.prototype.batch=function(e){for(var t=0,n=e.length;t<n;t++){var r=e[t],i=x(this,r.prefix);"put"===r.type?i.set(r.key,r.value):i.set(r.key,null)}this._batch=this._batch.concat(e)},E.prototype.execute=function(e,t){for(var n=new g.Set,r=[],i=this._batch.length-1;i>=0;i--){var o=this._batch[i],s=o.prefix.prefix()[0]+""+o.key;n.has(s)||(n.add(s),r.push(o))}e.batch(r,t)};var _=new g.Map,w="_local_last_update_seq",S="_local_doc_count",T="_local_uuid",k={encode:p.safeJsonStringify,decode:p.safeJsonParse,buffer:!1,type:"cheap-json"},C=new m.changesHandler;function A(e){return"winningRev"in e?e.winningRev:d.winningRev(e)}function j(e,t){return"deleted"in e?e.deleted:u.isDeleted(e,t)}function I(e,t,n){var r=[];return e.forEach((function(e){e.doc&&e.doc._attachments&&Object.keys(e.doc._attachments).forEach((function(t){var n=e.doc._attachments[t];"data"in n||r.push(n)}))})),Promise.all(r.map((function(e){return function(e,t,n){var r=e.content_type;return new Promise((function(i,o){t.binaryStore.get(e.digest,(function(t,s){var a;if(t){if("NotFoundError"!==t.name)return o(t);a=n.binary?f.binaryStringToBlobOrBuffer("",r):""}else a=n.binary?y(s,r):s.toString("base64");delete e.stub,delete e.length,e.data=a,i()}))}))}(e,t,n)})))}t.exports=function(e,t){e=m.clone(e);var n,r,p=this,x={},O=e.revs_limit,N=e.name;void 0===e.createIfMissing&&(e.createIfMissing=!0);var R,P=e.db,D=m.functionName(P);function M(){x.docStore=r.sublevel("document-store",{valueEncoding:k}),x.bySeqStore=r.sublevel("by-sequence",{valueEncoding:"json"}),x.attachmentStore=r.sublevel("attach-store",{valueEncoding:"json"}),x.binaryStore=r.sublevel("attach-binary-store",{valueEncoding:"binary"}),x.localStore=r.sublevel("local-store",{valueEncoding:"json"}),x.metaStore=r.sublevel("meta-store",{valueEncoding:"json"}),"object"==typeof e.migrate?e.migrate.doMigrationTwo(r,x,L):L()}function L(){x.metaStore.get(w,(function(e,i){void 0===r._updateSeq&&(r._updateSeq=i||0),x.metaStore.get(S,(function(e,i){r._docCount=e?0:i,x.metaStore.get(T,(function(e,r){n=e?m.uuid():r,x.metaStore.put(T,n,(function(){m.nextTick((function(){t(null,p)}))}))}))}))}))}function B(e,t){try{e.apply(null,t)}catch(e){t[t.length-1](e)}}function F(){var e=r._queue.peekFront();"read"===e.type?function(e){for(var t=[e],n=1,i=r._queue.get(n);void 0!==i&&"read"===i.type;)t.push(i),n++,i=r._queue.get(n);var o=0;t.forEach((function(e){var n=e.args,i=n[n.length-1];n[n.length-1]=a((function(e){i.apply(null,e),++o===t.length&&m.nextTick((function(){t.forEach((function(){r._queue.shift()})),r._queue.length&&F()}))})),B(e.fun,n)}))}(e):function(e){var t=e.args,n=t[t.length-1];t[t.length-1]=a((function(e){n.apply(null,e),m.nextTick((function(){r._queue.shift(),r._queue.length&&F()}))})),B(e.fun,t)}(e)}function U(e){return a((function(t){r._queue.push({fun:e,args:t,type:"write"}),1===r._queue.length&&m.nextTick(F)}))}function H(e){return a((function(t){r._queue.push({fun:e,args:t,type:"read"}),1===r._queue.length&&m.nextTick(F)}))}function G(e){return("0000000000000000"+e).slice(-16)}function q(e,t){"destroy"in P?P.destroy(e,t):t(null)}_.has(D)?R=_.get(D):(R=new g.Map,_.set(D,R)),R.has(N)?(r=R.get(N),M()):R.set(N,o(i(P(N),e,(function(n){if(n)return R.delete(N),t(n);(r=R.get(N))._docCount=-1,r._queue=new l,"object"==typeof e.migrate?e.migrate.doMigrationOne(N,r,M):M()})))),p._remote=!1,p.type=function(){return"leveldb"},p._id=function(e){e(null,n)},p._info=function(e){var t={doc_count:r._docCount,update_seq:r._updateSeq,backend_adapter:m.functionName(P)};return m.nextTick((function(){e(null,t)}))},p._get=H((function(e,t,n){t=m.clone(t),x.docStore.get(e,(function(e,r){if(e||!r)return n(v.createError(v.MISSING_DOC,"missing"));var i;if(t.rev)i=t.latest?d.latest(t.rev,r):t.rev;else if(i=A(r),j(r,i))return n(v.createError(v.MISSING_DOC,"deleted"));var o=r.rev_map[i];x.bySeqStore.get(G(o),(function(e,t){if(!t)return n(v.createError(v.MISSING_DOC));if("_id"in t&&t._id!==r.id)return n(new Error("wrong doc returned"));if(t._id=r.id,"_rev"in t){if(t._rev!==i)return n(new Error("wrong doc returned"))}else t._rev=i;return n(null,{doc:t,metadata:r})}))}))})),p._getAttachment=function(e,t,n,r,i){var o=n.digest,s=n.content_type;x.binaryStore.get(o,(function(e,t){if(e)return"NotFoundError"!==e.name?i(e):i(null,r.binary?function(e){return f.blob([""],{type:e})}(s):"");r.binary?i(null,y(t,s)):i(null,t.toString("base64"))}))},p._bulkDocs=U((function(e,t,n){var i=t.new_edits,o=new Array(e.docs.length),s=new g.Map,a=new g.Map,l=new E,y=0,_=r._updateSeq,T=e.docs,k=T.map((function(e){if(e._id&&u.isLocalId(e._id))return e;var t=u.parseDoc(e,i,p.__opts);return t.metadata&&!t.metadata.rev_map&&(t.metadata.rev_map={}),t})),A=k.filter((function(e){return e.error}));if(A.length)return n(A[0]);function j(e,t){var n=Promise.resolve();e.forEach((function(e,t){n=n.then((function(){return new Promise((function(n,r){p._doCompactionNoLock(t,e,{ctx:l},(function(e){if(e)return r(e);n()}))}))}))})),n.then((function(){t()}),t)}function I(){j(a,(function(e){if(e&&M(e),p.auto_compaction)return t=M,n=new g.Map,s.forEach((function(e,t){n.set(t,d.compactTree(e))})),void j(n,t);var t,n;M()}))}function R(e,t,r,i,u,d,p,g){y+=d;var m=null,E=0;e.metadata.winningRev=t,e.metadata.deleted=r,e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,i&&(e.data._deleted=!0),e.stemmedRevs.length&&a.set(e.metadata.id,e.stemmedRevs);var w=e.data._attachments?Object.keys(e.data._attachments):[];function S(e){E++,m||(e?g(m=e):E===w.length&&I())}function T(e,t,n){return function(r){h.binaryMd5(r,function(e,t,n,r){return function(i){!function(e,t,n,r,i){var o=e.data._attachments[n];delete o.data,o.digest=t,o.length=r.length;var s=e.metadata.id,a=e.metadata.rev;o.revpos=parseInt(a,10),D(s,a,t,(function(e,n){return e||0===r.length?i(e):n?(l.batch([{type:"put",prefix:x.binaryStore,key:t,value:c(r,"binary")}]),void i()):i(e)}))}(e,"md5-"+i,t,n,r)}}(e,t,r,n))}}for(var k=0;k<w.length;k++){var C,A=w[k],j=e.data._attachments[A];if(j.stub)D(e.data._id,e.data._rev,j.digest,S);else if("string"==typeof j.data){try{C=f.atob(j.data)}catch(e){return void n(v.createError(v.BAD_ARG,"Attachment is not a valid base64 string"))}T(e,A,S)(C)}else b(j.data,T(e,A,S))}function I(){var t=e.metadata.rev_map[e.metadata.rev];if(t)return g();t=++_,e.metadata.rev_map[e.metadata.rev]=e.metadata.seq=t;var n=[{key:G(t),value:e.data,prefix:x.bySeqStore,type:"put"},{key:e.metadata.id,value:e.metadata,prefix:x.docStore,type:"put"}];l.batch(n),o[p]={ok:!0,id:e.metadata.id,rev:e.metadata.rev},s.set(e.metadata.id,e.metadata),g()}w.length||I()}var P={};function D(e,t,n,r){function i(r){var i=[e,t].join("@"),o={};return r?r.refs&&(o.refs=r.refs,o.refs[i]=!0):(o.refs={},o.refs[i]=!0),new Promise((function(e){l.batch([{type:"put",prefix:x.attachmentStore,key:n,value:o}]),e(!r)}))}var o=P[n]||Promise.resolve();P[n]=o.then((function(){return new Promise((function(e,t){l.get(x.attachmentStore,n,(function(n,r){if(n&&"NotFoundError"!==n.name)return t(n);e(r)}))})).then(i).then((function(e){r(null,e)}),r)}))}function M(e){if(e)return m.nextTick((function(){n(e)}));l.batch([{prefix:x.metaStore,type:"put",key:w,value:_},{prefix:x.metaStore,type:"put",key:S,value:r._docCount+y}]),l.execute(r,(function(e){if(e)return n(e);r._docCount+=y,r._updateSeq=_,C.notify(N),m.nextTick((function(){n(null,o)}))}))}if(!k.length)return n(null,[]);!function(e){var t=[];if(T.forEach((function(e){e&&e._attachments&&Object.keys(e._attachments).forEach((function(n){var r=e._attachments[n];r.stub&&t.push(r.digest)}))})),!t.length)return e();var n,r=0;t.forEach((function(i){!function(e,t){l.get(x.attachmentStore,e,(function(n){if(n){var r=v.createError(v.MISSING_STUB,"unknown stub attachment with digest "+e);t(r)}else t()}))}(i,(function(i){i&&!n&&(n=i),++r===t.length&&e(n)}))}))}((function(e){if(e)return n(e);!function(e){var t,n=0;function r(){if(++n===T.length)return e(t)}T.forEach((function(e){if(e._id&&u.isLocalId(e._id))return r();l.get(x.docStore,e._id,(function(n,i){n?"NotFoundError"!==n.name&&(t=n):s.set(e._id,i),r()}))}))}((function(e){if(e)return n(e);u.processDocs(O,k,p,s,l,o,R,t,I)}))}))})),p._allDocs=function(e,t){return"keys"in e?u.allDocsKeysQuery(this,e):H((function(e,t){e=m.clone(e),function(e){r.isClosed()?e(new Error("database is closed")):e(null,r._docCount)}((function(n,i){if(n)return t(n);var o,a={},l=e.skip||0;if(e.startkey&&(a.gte=e.startkey),e.endkey&&(a.lte=e.endkey),e.key&&(a.gte=a.lte=e.key),e.descending){a.reverse=!0;var c=a.lte;a.lte=a.gte,a.gte=c}if("number"==typeof e.limit&&(o=e.limit),0===o||"gte"in a&&"lte"in a&&a.gte>a.lte){var u={total_rows:i,offset:e.skip,rows:[]};return e.update_seq&&(u.update_seq=r._updateSeq),t(null,u)}var p=[],h=x.docStore.readStream(a),f=s.obj((function(t,n,r){var i=t.value,s=A(i),a=j(i,s);if(a){if("ok"!==e.deleted)return void r()}else{if(l-- >0)return void r();if("number"==typeof o&&o--<=0)return h.unpipe(),h.destroy(),void r()}function c(t){var n={id:i.id,key:i.id,value:{rev:s}};if(e.include_docs){if(n.doc=t,n.doc._rev=n.value.rev,e.conflicts){var o=d.collectConflicts(i);o.length&&(n.doc._conflicts=o)}for(var l in n.doc._attachments)n.doc._attachments.hasOwnProperty(l)&&(n.doc._attachments[l].stub=!0)}if(!1===e.inclusive_end&&i.id===e.endkey)return r();if(a){if("ok"!==e.deleted)return r();n.value.deleted=!0,n.doc=null}p.push(n),r()}if(e.include_docs){var u=i.rev_map[s];x.bySeqStore.get(G(u),(function(e,t){c(t)}))}else c()}),(function(n){Promise.resolve().then((function(){if(e.include_docs&&e.attachments)return I(p,x,e)})).then((function(){var n={total_rows:i,offset:e.skip,rows:p};e.update_seq&&(n.update_seq=r._updateSeq),t(null,n)}),t),n()})).on("unpipe",(function(){f.end()}));h.on("error",t),h.pipe(f)}))}))(e,t)},p._changes=function(e){if((e=m.clone(e)).continuous){var t=N+":"+m.uuid();return C.addListener(N,t,p,e),C.notify(N),{cancel:function(){C.removeListener(N,t)}}}var n,i=e.descending,o=[],a=e.since||0,l=0,c={reverse:i};"limit"in e&&e.limit>0&&(n=e.limit),c.reverse||(c.start=G(e.since||0));var d=e.doc_ids&&new g.Set(e.doc_ids),h=m.filterChange(e),f=new g.Map;function v(){e.done=!0,e.return_docs&&e.limit&&e.limit<o.length&&(o.length=e.limit),y.unpipe(b),y.destroy(),e.continuous||e.cancelled||(e.include_docs&&e.attachments&&e.return_docs?I(o,x,e).then((function(){e.complete(null,{results:o,last_seq:a})})):e.complete(null,{results:o,last_seq:a}))}var y=x.bySeqStore.readStream(c),b=s.obj((function(t,s,c){if(n&&l>=n)return v(),c();if(e.cancelled||e.done)return c();var p,g,m=(p=t.key,parseInt(p,10)),y=t.value;if(m===e.since&&!i)return c();if(d&&!d.has(y._id))return c();function b(t){var n=A(t);function r(n){var r=e.processChange(n,t,e);r.seq=t.seq;var i=h(r);if("object"==typeof i)return e.complete(i);i&&(l++,e.attachments&&e.include_docs?I([r],x,e).then((function(){e.onChange(r)})):e.onChange(r),e.return_docs&&o.push(r)),c()}if(t.seq!==m)return c();if(a=m,n===y._rev)return r(y);var i=t.rev_map[n];x.bySeqStore.get(G(i),(function(e,t){r(t)}))}if(g=f.get(y._id))return b(g);x.docStore.get(y._id,(function(t,n){if(e.cancelled||e.done||r.isClosed()||u.isLocalId(n.id))return c();f.set(y._id,n),b(n)}))}),(function(t){if(e.cancelled)return t();e.return_docs&&e.limit&&e.limit<o.length&&(o.length=e.limit),t()})).on("unpipe",(function(){b.end(),v()}));return y.pipe(b),{cancel:function(){e.cancelled=!0,v()}}},p._close=function(e){if(r.isClosed())return e(v.createError(v.NOT_OPEN));r.close((function(t){t?e(t):(R.delete(N),e())}))},p._getRevisionTree=function(e,t){x.docStore.get(e,(function(e,n){e?t(v.createError(v.MISSING_DOC)):t(null,n.rev_tree)}))},p._doCompaction=U((function(e,t,n,r){p._doCompactionNoLock(e,t,n,r)})),p._doCompactionNoLock=function(e,t,n,i){if("function"==typeof n&&(i=n,n={}),!t.length)return i();var o=n.ctx||new E;o.get(x.docStore,e,(function(s,a){if(s)return i(s);var l=t.map((function(e){var t=a.rev_map[e];return delete a.rev_map[e],t}));d.traverseRevTree(a.rev_tree,(function(e,n,r,i,o){var s=n+"-"+r;-1!==t.indexOf(s)&&(o.status="missing")}));var c=[];c.push({key:a.id,value:a,type:"put",prefix:x.docStore});var u,p={},h=0;function f(n){if(n&&(u=n),++h===t.length){if(u)return i(u);!function(){var n=Object.keys(p);if(!n.length)return m();var r,i=0;function s(e){e&&(r=e),++i===n.length&&m(r)}var a=new g.Map;t.forEach((function(t){a.set(e+"@"+t,!0)})),n.forEach((function(e){o.get(x.attachmentStore,e,(function(t,n){if(t)return"NotFoundError"===t.name?s():s(t);var r=Object.keys(n.refs||{}).filter((function(e){return!a.has(e)})),i={};r.forEach((function(e){i[e]=!0})),r.length?c.push({key:e,type:"put",value:{refs:i},prefix:x.attachmentStore}):c=c.concat([{key:e,type:"del",prefix:x.attachmentStore},{key:e,type:"del",prefix:x.binaryStore}]),s()}))}))}()}}function m(e){return e?i(e):(o.batch(c),n.ctx?i():void o.execute(r,i))}l.forEach((function(e){c.push({key:G(e),type:"del",prefix:x.bySeqStore}),o.get(x.bySeqStore,G(e),(function(e,t){if(e)return"NotFoundError"===e.name?f():f(e);Object.keys(t._attachments||{}).forEach((function(e){var n=t._attachments[e].digest;p[n]=!0})),f()}))}))}))},p._getLocal=function(e,t){x.localStore.get(e,(function(e,n){e?t(v.createError(v.MISSING_DOC)):t(null,n)}))},p._putLocal=function(e,t,n){"function"==typeof t&&(n=t,t={}),t.ctx?p._putLocalNoLock(e,t,n):p._putLocalWithLock(e,t,n)},p._putLocalWithLock=U((function(e,t,n){p._putLocalNoLock(e,t,n)})),p._putLocalNoLock=function(e,t,n){delete e._revisions;var i=e._rev,o=e._id,s=t.ctx||new E;s.get(x.localStore,o,(function(a,l){if(a&&i)return n(v.createError(v.REV_CONFLICT));if(l&&l._rev!==i)return n(v.createError(v.REV_CONFLICT));e._rev=i?"0-"+(parseInt(i.split("-")[1],10)+1):"0-1";var c=[{type:"put",prefix:x.localStore,key:o,value:e}];s.batch(c);var u={ok:!0,id:e._id,rev:e._rev};if(t.ctx)return n(null,u);s.execute(r,(function(e){if(e)return n(e);n(null,u)}))}))},p._removeLocal=function(e,t,n){"function"==typeof t&&(n=t,t={}),t.ctx?p._removeLocalNoLock(e,t,n):p._removeLocalWithLock(e,t,n)},p._removeLocalWithLock=U((function(e,t,n){p._removeLocalNoLock(e,t,n)})),p._removeLocalNoLock=function(e,t,n){var i=t.ctx||new E;i.get(x.localStore,e._id,(function(o,s){if(o)return"NotFoundError"!==o.name?n(o):n(v.createError(v.MISSING_DOC));if(s._rev!==e._rev)return n(v.createError(v.REV_CONFLICT));i.batch([{prefix:x.localStore,type:"del",key:e._id}]);var a={ok:!0,id:e._id,rev:"0-0"};if(t.ctx)return n(null,a);i.execute(r,(function(e){if(e)return n(e);n(null,a)}))}))},p._destroy=function(e,t){var n,r=m.functionName(P);if(!_.has(r))return q(N,t);(n=_.get(r)).has(N)?(C.removeAllListeners(N),n.get(N).close((function(){n.delete(N),q(N,t)}))):q(N,t)}}},{argsarray:219,"buffer-from":290,"double-ended-queue":238,levelup:270,"pouchdb-adapter-utils":293,"pouchdb-binary-utils":294,"pouchdb-collections":295,"pouchdb-errors":296,"pouchdb-json":297,"pouchdb-md5":298,"pouchdb-merge":299,"pouchdb-utils":300,"sublevel-pouchdb":429,through2:291}],290:[function(e,t,n){(function(e){(function(){var n=Object.prototype.toString,r="function"==typeof e.alloc&&"function"==typeof e.allocUnsafe&&"function"==typeof e.from;t.exports=function(t,i,o){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return function(e){return"ArrayBuffer"===n.call(e).slice(8,-1)}(t)?function(t,n,i){n>>>=0;var o=t.byteLength-n;if(o<0)throw new RangeError("'offset' is out of bounds");if(void 0===i)i=o;else if((i>>>=0)>o)throw new RangeError("'length' is out of bounds");return r?e.from(t.slice(n,n+i)):new e(new Uint8Array(t.slice(n,n+i)))}(t,i,o):"string"==typeof t?function(t,n){if("string"==typeof n&&""!==n||(n="utf8"),!e.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');return r?e.from(t,n):new e(t,n)}(t,i):r?e.from(t):new e(t)}}).call(this)}).call(this,e("buffer").Buffer)},{buffer:226}],291:[function(e,t,n){(function(n){(function(){var r=e("readable-stream").Transform,i=e("util").inherits;function o(e){r.call(this,e),this._destroyed=!1}function s(e,t,n){n(null,e)}function a(e){return function(t,n,r){return"function"==typeof t&&(r=n,n=t,t={}),"function"!=typeof n&&(n=s),"function"!=typeof r&&(r=null),e(t,n,r)}}i(o,r),o.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;n.nextTick((function(){e&&t.emit("error",e),t.emit("close")}))}},t.exports=a((function(e,t,n){var r=new o(e);return r._transform=t,n&&(r._flush=n),r})),t.exports.ctor=a((function(e,t,n){function r(t){if(!(this instanceof r))return new r(t);this.options=Object.assign({},e,t),o.call(this,this.options)}return i(r,o),r.prototype._transform=t,n&&(r.prototype._flush=n),r})),t.exports.obj=a((function(e,t,n){var r=new o(Object.assign({objectMode:!0,highWaterMark:16},e));return r._transform=t,n&&(r._flush=n),r}))}).call(this)}).call(this,e("_process"))},{_process:303,"readable-stream":381,util:442}],292:[function(e,t,n){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var i=e("pouchdb-utils"),o=r(e("pouchdb-adapter-leveldb-core")),s=r(e("memdown"));function a(e,t){var n=i.assign({db:s},e);o.call(this,n,t)}a.valid=function(){return!0},a.use_prefix=!1,t.exports=function(e){e.adapter("memory",a,!0)}},{memdown:275,"pouchdb-adapter-leveldb-core":289,"pouchdb-utils":300}],293:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("pouchdb-utils"),i=e("pouchdb-binary-utils"),o=e("pouchdb-md5"),s=e("pouchdb-collections"),a=e("pouchdb-errors"),l=e("pouchdb-merge");function c(e){return e.reduce((function(e,t){return e[t]=!0,e}),{})}var u=c(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),d=c(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function p(e){if(!/^\d+-/.test(e))return a.createError(a.INVALID_REV);var t=e.indexOf("-"),n=e.substring(0,t),r=e.substring(t+1);return{prefix:parseInt(n,10),id:r}}function h(e,t,n){var i,o,s;n||(n={deterministic_revs:!0});var l={status:"available"};if(e._deleted&&(l.deleted=!0),t)if(e._id||(e._id=r.uuid()),o=r.rev(e,n.deterministic_revs),e._rev){if((s=p(e._rev)).error)return s;e._rev_tree=[{pos:s.prefix,ids:[s.id,{status:"missing"},[[o,l,[]]]]}],i=s.prefix+1}else e._rev_tree=[{pos:1,ids:[o,l,[]]}],i=1;else if(e._revisions&&(e._rev_tree=function(e,t){for(var n=e.start-e.ids.length+1,r=e.ids,i=[r[0],t,[]],o=1,s=r.length;o<s;o++)i=[r[o],{status:"missing"},[i]];return[{pos:n,ids:i}]}(e._revisions,l),i=e._revisions.start,o=e._revisions.ids[0]),!e._rev_tree){if((s=p(e._rev)).error)return s;i=s.prefix,o=s.id,e._rev_tree=[{pos:i,ids:[o,l,[]]}]}r.invalidIdError(e._id),e._rev=i+"-"+o;var c={metadata:{},data:{}};for(var h in e)if(Object.prototype.hasOwnProperty.call(e,h)){var f="_"===h[0];if(f&&!u[h]){var g=a.createError(a.DOC_VALIDATION,h);throw g.message=a.DOC_VALIDATION.message+": "+h,g}f&&!d[h]?c.metadata[h.slice(1)]=e[h]:c.data[h]=e[h]}return c}function f(e,t,n){var r=function(e){try{return i.atob(e)}catch(e){return{error:a.createError(a.BAD_ARG,"Attachment is not a valid base64 string")}}}(e.data);if(r.error)return n(r.error);e.length=r.length,e.data="blob"===t?i.binaryStringToBlobOrBuffer(r,e.content_type):"base64"===t?i.btoa(r):r,o.binaryMd5(r,(function(t){e.digest="md5-"+t,n()}))}function g(e,t,n){if(e.stub)return n();"string"==typeof e.data?f(e,t,n):function(e,t,n){o.binaryMd5(e.data,(function(r){e.digest="md5-"+r,e.length=e.data.size||e.data.length||0,"binary"===t?i.blobOrBufferToBinaryString(e.data,(function(t){e.data=t,n()})):"base64"===t?i.blobOrBufferToBase64(e.data,(function(t){e.data=t,n()})):n()}))}(e,t,n)}function m(e,t,n,r,i,o,s,c){if(l.revExists(t.rev_tree,n.metadata.rev)&&!c)return r[i]=n,o();var u=t.winningRev||l.winningRev(t),d="deleted"in t?t.deleted:l.isDeleted(t,u),p="deleted"in n.metadata?n.metadata.deleted:l.isDeleted(n.metadata),f=/^1-/.test(n.metadata.rev);if(d&&!p&&c&&f){var g=n.data;g._rev=u,g._id=n.metadata.id,n=h(g,c)}var m=l.merge(t.rev_tree,n.metadata.rev_tree[0],e);if(c&&(d&&p&&"new_leaf"!==m.conflicts||!d&&"new_leaf"!==m.conflicts||d&&!p&&"new_branch"===m.conflicts)){var v=a.createError(a.REV_CONFLICT);return r[i]=v,o()}var y=n.metadata.rev;n.metadata.rev_tree=m.tree,n.stemmedRevs=m.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);var b=l.winningRev(n.metadata),x=l.isDeleted(n.metadata,b),E=d===x?0:d<x?-1:1;s(n,b,x,y===b?x:l.isDeleted(n.metadata,y),!0,E,i,o)}n.invalidIdError=r.invalidIdError,n.normalizeDdocFunctionName=r.normalizeDdocFunctionName,n.parseDdocFunctionName=r.parseDdocFunctionName,n.isDeleted=l.isDeleted,n.isLocalId=l.isLocalId,n.allDocsKeysQuery=function(e,t){var n=t.keys,i={offset:t.skip};return Promise.all(n.map((function(n){var o=r.assign({key:n,deleted:"ok"},t);return["limit","skip","keys"].forEach((function(e){delete o[e]})),new Promise((function(r,s){e._allDocs(o,(function(e,o){if(e)return s(e);t.update_seq&&void 0!==o.update_seq&&(i.update_seq=o.update_seq),i.total_rows=o.total_rows,r(o.rows[0]||{key:n,error:"not_found"})}))}))}))).then((function(e){return i.rows=e,i}))},n.parseDoc=h,n.preprocessAttachments=function(e,t,n){if(!e.length)return n();var r,i=0;function o(){i++,e.length===i&&(r?n(r):n())}e.forEach((function(e){var n=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],i=0;if(!n.length)return o();function s(e){r=e,++i===n.length&&o()}for(var a in e.data._attachments)e.data._attachments.hasOwnProperty(a)&&g(e.data._attachments[a],t,s)}))},n.processDocs=function(e,t,n,r,i,o,c,u,d){e=e||1e3;var p=u.new_edits,h=new s.Map,f=0,g=t.length;function v(){++f===g&&d&&d()}t.forEach((function(e,t){if(e._id&&l.isLocalId(e._id)){var r=e._deleted?"_removeLocal":"_putLocal";n[r](e,{ctx:i},(function(e,n){o[t]=e||n,v()}))}else{var s=e.metadata.id;h.has(s)?(g--,h.get(s).push([e,t])):h.set(s,[[e,t]])}})),h.forEach((function(t,n){var i=0;function s(){++i<t.length?d():v()}function d(){var d=t[i],h=d[0],f=d[1];if(r.has(n))m(e,r.get(n),h,o,f,s,c,p);else{var g=l.merge([],h.metadata.rev_tree[0],e);h.metadata.rev_tree=g.tree,h.stemmedRevs=g.stemmedRevs||[],function(e,t,n){var r=l.winningRev(e.metadata),i=l.isDeleted(e.metadata,r);if("was_delete"in u&&i)return o[t]=a.createError(a.MISSING_DOC,"deleted"),n();if(p&&function(e){return"missing"===e.metadata.rev_tree[0].ids[1].status}(e)){var s=a.createError(a.REV_CONFLICT);return o[t]=s,n()}c(e,r,i,i,!1,i?0:1,t,n)}(h,f,s)}}d()}))},n.updateDoc=m},{"pouchdb-binary-utils":294,"pouchdb-collections":295,"pouchdb-errors":296,"pouchdb-md5":298,"pouchdb-merge":299,"pouchdb-utils":300}],294:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){return atob(e)},i=function(e){return btoa(e)};function o(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}function s(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function a(e,t){return o([s(e)],{type:t})}function l(e,t){var n=new FileReader,r="function"==typeof n.readAsBinaryString;n.onloadend=function(e){var n=e.target.result||"";if(r)return t(n);t(function(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return t}(n))},r?n.readAsBinaryString(e):n.readAsArrayBuffer(e)}function c(e,t){l(e,(function(e){t(e)}))}n.atob=r,n.btoa=i,n.base64StringToBlobOrBuffer=function(e,t){return a(r(e),t)},n.binaryStringToArrayBuffer=s,n.binaryStringToBlobOrBuffer=a,n.blob=o,n.blobOrBufferToBase64=function(e,t){c(e,(function(e){t(i(e))}))},n.blobOrBufferToBinaryString=c,n.readAsArrayBuffer=function(e,t){var n=new FileReader;n.onloadend=function(e){var n=e.target.result||new ArrayBuffer(0);t(n)},n.readAsArrayBuffer(e)},n.readAsBinaryString=l,n.typedBuffer=function(){}},{}],295:[function(e,t,n){"use strict";function r(e){return"$"+e}function i(e){return e.substring(1)}function o(){this._store={}}function s(e){if(this._store=new o,e&&Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.add(e[t])}Object.defineProperty(n,"__esModule",{value:!0}),o.prototype.get=function(e){var t=r(e);return this._store[t]},o.prototype.set=function(e,t){var n=r(e);return this._store[n]=t,!0},o.prototype.has=function(e){return r(e)in this._store},o.prototype.delete=function(e){var t=r(e),n=t in this._store;return delete this._store[t],n},o.prototype.forEach=function(e){for(var t=Object.keys(this._store),n=0,r=t.length;n<r;n++){var o=t[n];e(this._store[o],o=i(o))}},Object.defineProperty(o.prototype,"size",{get:function(){return Object.keys(this._store).length}}),s.prototype.add=function(e){return this._store.set(e,!0)},s.prototype.has=function(e){return this._store.has(e)},s.prototype.forEach=function(e){this._store.forEach((function(t,n){e(n)}))},Object.defineProperty(s.prototype,"size",{get:function(){return this._store.size}}),function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}()?(n.Set=Set,n.Map=Map):(n.Set=s,n.Map=o)},{}],296:[function(e,t,n){"use strict";var r;function i(e,t,n){Error.call(this,n),this.status=e,this.name=t,this.message=n,this.error=!0}Object.defineProperty(n,"__esModule",{value:!0}),((r=e("inherits"))&&"object"==typeof r&&"default"in r?r.default:r)(i,Error),i.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var o=new i(401,"unauthorized","Name or password is incorrect."),s=new i(400,"bad_request","Missing JSON list of 'docs'"),a=new i(404,"not_found","missing"),l=new i(409,"conflict","Document update conflict"),c=new i(400,"bad_request","_id field must contain a string"),u=new i(412,"missing_id","_id is required for puts"),d=new i(400,"bad_request","Only reserved document ids may start with underscore."),p=new i(412,"precondition_failed","Database not open"),h=new i(500,"unknown_error","Database encountered an unknown error"),f=new i(500,"badarg","Some query argument is invalid"),g=new i(400,"invalid_request","Request was invalid"),m=new i(400,"query_parse_error","Some query parameter is invalid"),v=new i(500,"doc_validation","Bad special document member"),y=new i(400,"bad_request","Something wrong with the request"),b=new i(400,"bad_request","Document must be a JSON object"),x=new i(404,"not_found","Database not found"),E=new i(500,"indexed_db_went_bad","unknown"),_=new i(500,"web_sql_went_bad","unknown"),w=new i(500,"levelDB_went_went_bad","unknown"),S=new i(403,"forbidden","Forbidden by design doc validate_doc_update function"),T=new i(400,"bad_request","Invalid rev format"),k=new i(412,"file_exists","The database could not be created, the file already exists."),C=new i(412,"missing_stub","A pre-existing attachment stub wasn't found"),A=new i(413,"invalid_url","Provided URL is invalid");n.UNAUTHORIZED=o,n.MISSING_BULK_DOCS=s,n.MISSING_DOC=a,n.REV_CONFLICT=l,n.INVALID_ID=c,n.MISSING_ID=u,n.RESERVED_ID=d,n.NOT_OPEN=p,n.UNKNOWN_ERROR=h,n.BAD_ARG=f,n.INVALID_REQUEST=g,n.QUERY_PARSE_ERROR=m,n.DOC_VALIDATION=v,n.BAD_REQUEST=y,n.NOT_AN_OBJECT=b,n.DB_MISSING=x,n.WSQ_ERROR=_,n.LDB_ERROR=w,n.FORBIDDEN=S,n.INVALID_REV=T,n.FILE_EXISTS=k,n.MISSING_STUB=C,n.IDB_ERROR=E,n.INVALID_URL=A,n.createError=function(e,t){function n(t){for(var n in e)"function"!=typeof e[n]&&(this[n]=e[n]);void 0!==t&&(this.reason=t)}return n.prototype=i.prototype,new n(t)},n.generateErrorFromResponse=function(e){if("object"!=typeof e){var t=e;(e=h).data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}},{inherits:247}],297:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i=(r=e("vuvuzela"))&&"object"==typeof r&&"default"in r?r.default:r;n.safeJsonParse=function(e){try{return JSON.parse(e)}catch(t){return i.parse(e)}},n.safeJsonStringify=function(e){try{return JSON.stringify(e)}catch(t){return i.stringify(e)}}},{vuvuzela:448}],298:[function(e,t,n){(function(t){(function(){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i=e("pouchdb-binary-utils"),o=(r=e("spark-md5"))&&"object"==typeof r&&"default"in r?r.default:r,s=t.setImmediate||t.setTimeout;function a(e,t,n,r,o){(n>0||r<t.size)&&(t=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.slice(t,n)}(t,n,r)),i.readAsArrayBuffer(t,(function(t){e.append(t),o()}))}function l(e,t,n,r,i){(n>0||r<t.length)&&(t=t.substring(n,r)),e.appendBinary(t),i()}n.binaryMd5=function(e,t){var n="string"==typeof e,r=n?e.length:e.size,c=Math.min(32768,r),u=Math.ceil(r/c),d=0,p=n?new o:new o.ArrayBuffer,h=n?l:a;function f(){s(m)}function g(){var e=function(e){return i.btoa(e)}(p.end(!0));t(e),p.destroy()}function m(){var t=d*c;h(p,e,t,t+c,++d<u?f:g)}m()},n.stringMd5=function(e){return o.hash(e)}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"pouchdb-binary-utils":294,"spark-md5":426}],299:[function(e,t,n){"use strict";function r(e){for(var t,n,r,i,o=e.rev_tree.slice();i=o.pop();){var s=i.ids,a=s[2],l=i.pos;if(a.length)for(var c=0,u=a.length;c<u;c++)o.push({pos:l+1,ids:a[c]});else{var d=!!s[1].deleted,p=s[0];t&&!(r!==d?r:n!==l?n<l:t<p)||(t=p,n=l,r=d)}}return n+"-"+t}function i(e,t){for(var n,r=e.slice();n=r.pop();)for(var i=n.pos,o=n.ids,s=o[2],a=t(0===s.length,i,o[0],n.ctx,o[1]),l=0,c=s.length;l<c;l++)r.push({pos:i+1,ids:s[l],ctx:a})}function o(e,t){return e.pos-t.pos}function s(e){var t=[];i(e,(function(e,n,r,i,o){e&&t.push({rev:n+"-"+r,pos:n,opts:o})})),t.sort(o).reverse();for(var n=0,r=t.length;n<r;n++)delete t[n].pos;return t}function a(e){for(var t,n=[],r=e.slice();t=r.pop();){var i=t.pos,o=t.ids,s=o[0],a=o[1],l=o[2],c=0===l.length,u=t.history?t.history.slice():[];u.push({id:s,opts:a}),c&&n.push({pos:i+1-u.length,ids:u});for(var d=0,p=l.length;d<p;d++)r.push({pos:i+1,ids:l[d],history:u})}return n.reverse()}function l(e,t){return e.pos-t.pos}function c(e,t,n){var r=function(e,t,n){for(var r,i=0,o=e.length;i<o;)n(e[r=i+o>>>1],t)<0?i=r+1:o=r;return i}(e,t,n);e.splice(r,0,t)}function u(e,t){for(var n,r,i=t,o=e.length;i<o;i++){var s=e[i],a=[s.id,s.opts,[]];r?(r[2].push(a),r=a):n=r=a}return n}function d(e,t){return e[0]<t[0]?-1:1}function p(e,t){for(var n=[{tree1:e,tree2:t}],r=!1;n.length>0;){var i=n.pop(),o=i.tree1,s=i.tree2;(o[1].status||s[1].status)&&(o[1].status="available"===o[1].status||"available"===s[1].status?"available":"missing");for(var a=0;a<s[2].length;a++)if(o[2][0]){for(var l=!1,u=0;u<o[2].length;u++)o[2][u][0]===s[2][a][0]&&(n.push({tree1:o[2][u],tree2:s[2][a]}),l=!0);l||(r="new_branch",c(o[2],s[2][a],d))}else r="new_leaf",o[2][0]=s[2][a]}return{conflicts:r,tree:e}}function h(e,t,n){var r,i=[],o=!1,s=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var a=0,c=e.length;a<c;a++){var u=e[a];if(u.pos===t.pos&&u.ids[0]===t.ids[0])r=p(u.ids,t.ids),i.push({pos:u.pos,ids:r.tree}),o=o||r.conflicts,s=!0;else if(!0!==n){var d=u.pos<t.pos?u:t,h=u.pos<t.pos?t:u,f=h.pos-d.pos,g=[],m=[];for(m.push({ids:d.ids,diff:f,parent:null,parentIdx:null});m.length>0;){var v=m.pop();if(0!==v.diff)for(var y=v.ids[2],b=0,x=y.length;b<x;b++)m.push({ids:y[b],diff:v.diff-1,parent:v.ids,parentIdx:b});else v.ids[0]===h.ids[0]&&g.push(v)}var E=g[0];E?(r=p(E.ids,h.ids),E.parent[2][E.parentIdx]=r.tree,i.push({pos:d.pos,ids:d.ids}),o=o||r.conflicts,s=!0):i.push(u)}else i.push(u)}return s||i.push(t),i.sort(l),{tree:i,conflicts:o||"internal_node"}}function f(e){return e.ids}Object.defineProperty(n,"__esModule",{value:!0}),n.collectConflicts=function(e){for(var t=r(e),n=s(e.rev_tree),i=[],o=0,a=n.length;o<a;o++){var l=n[o];l.rev===t||l.opts.deleted||i.push(l.rev)}return i},n.collectLeaves=s,n.compactTree=function(e){var t=[];return i(e.rev_tree,(function(e,n,r,i,o){"available"!==o.status||e||(t.push(n+"-"+r),o.status="missing")})),t},n.isDeleted=function(e,t){t||(t=r(e));for(var n,i=t.substring(t.indexOf("-")+1),o=e.rev_tree.map(f);n=o.pop();){if(n[0]===i)return!!n[1].deleted;o=o.concat(n[2])}},n.isLocalId=function(e){return/^_local/.test(e)},n.merge=function(e,t,n){var r=h(e,t),o=function(e,t){for(var n,r,o=a(e),s=0,l=o.length;s<l;s++){var c,d=o[s],p=d.ids;if(p.length>t){n||(n={});var f=p.length-t;c={pos:d.pos+f,ids:u(p,f)};for(var g=0;g<f;g++){var m=d.pos+g+"-"+p[g].id;n[m]=!0}}else c={pos:d.pos,ids:u(p,0)};r=r?h(r,c,!0).tree:[c]}return n&&i(r,(function(e,t,r){delete n[t+"-"+r]})),{tree:r,revs:n?Object.keys(n):[]}}(r.tree,n);return{tree:o.tree,stemmedRevs:o.revs,conflicts:r.conflicts}},n.revExists=function(e,t){for(var n,r=e.slice(),i=t.split("-"),o=parseInt(i[0],10),s=i[1];n=r.pop();){if(n.pos===o&&n.ids[0]===s)return!0;for(var a=n.ids[2],l=0,c=a.length;l<c;l++)r.push({pos:n.pos+1,ids:a[l]})}return!1},n.rootToLeaf=a,n.traverseRevTree=i,n.winningRev=r,n.latest=function(e,t){for(var n,r=t.rev_tree.slice();n=r.pop();){var i=n.pos,o=n.ids,s=o[0],a=o[1],l=o[2],c=0===l.length,u=n.history?n.history.slice():[];if(u.push({id:s,pos:i,opts:a}),c)for(var d=0,p=u.length;d<p;d++){var h=u[d];if(h.pos+"-"+h.id===e)return i+"-"+s}for(var f=0,g=l.length;f<g;f++)r.push({pos:i+1,ids:l[f],history:u})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}},{}],300:[function(e,t,n){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("argsarray")),o=e("pouchdb-collections"),s=r(e("inherits")),a=r(e("immediate")),l=e("pouchdb-errors"),c=e("events"),u=r(e("uuid")),d=e("pouchdb-md5");function p(e){if(e instanceof ArrayBuffer)return function(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),r=new Uint8Array(e);return n.set(r),t}(e);var t=e.size,n=e.type;return"function"==typeof e.slice?e.slice(0,t,n):e.webkitSlice(0,t,n)}var h=Function.prototype.toString,f=h.call(Object);function g(e){var t,n,r;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],n=0,r=e.length;n<r;n++)t[n]=g(e[n]);return t}if(e instanceof Date)return e.toISOString();if(function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer||"undefined"!=typeof Blob&&e instanceof Blob}(e))return p(e);if(!function(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=t.constructor;return"function"==typeof n&&n instanceof n&&h.call(n)==f}(e))return e;for(n in t={},e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=g(e[n]);void 0!==i&&(t[n]=i)}return t}function m(e){var t=!1;return i((function(n){if(t)throw new Error("once called more than once");t=!0,e.apply(this,n)}))}function v(e){return i((function(t){t=g(t);var n=this,r="function"==typeof t[t.length-1]&&t.pop(),i=new Promise((function(r,i){var o;try{var s=m((function(e,t){e?i(e):r(t)}));t.push(s),(o=e.apply(n,t))&&"function"==typeof o.then&&r(o)}catch(e){i(e)}}));return r&&i.then((function(e){r(null,e)}),r),i}))}function y(e,t){for(var n={},r=0,i=t.length;r<i;r++){var o=t[r];o in e&&(n[o]=e[o])}return n}var b;function x(e){return e}function E(e){return[{ok:e}]}try{localStorage.setItem("_pouch_check_localstorage",1),b=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){b=!1}function _(){return b}function w(){var e;c.EventEmitter.call(this),this._listeners={},e=this,_()&&addEventListener("storage",(function(t){e.emit(t.key)}))}function S(e){if("undefined"!=typeof console&&"function"==typeof console[e]){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}s(w,c.EventEmitter),w.prototype.addListener=function(e,t,n,r){if(!this._listeners[t]){var i=this,o=!1;this._listeners[t]=s,this.on(e,s)}function s(){if(i._listeners[t])if(o)o="waiting";else{o=!0;var e=y(r,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);n.changes(e).on("change",(function(e){e.seq>r.since&&!r.cancelled&&(r.since=e.seq,r.onChange(e))})).on("complete",(function(){"waiting"===o&&a(s),o=!1})).on("error",(function(){o=!1}))}}},w.prototype.removeListener=function(e,t){t in this._listeners&&(c.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},w.prototype.notifyLocalWindows=function(e){_()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},w.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var T="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t};var k=function(){}.name?function(e){return e.name}:function(e){var t=e.toString().match(/^\s*function\s*(?:(\S+)\s*)?\(/);return t&&t[1]?t[1]:""};function C(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}var A=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],j="queryKey",I=/(?:^|&)([^&=]*)=?([^&]*)/g,O=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function N(e,t,n){return new Promise((function(r,i){e.get(t,(function(o,s){if(o){if(404!==o.status)return i(o);s={}}var a=s._rev,l=n(s);if(!l)return r({updated:!1,rev:a});l._id=t,l._rev=a,r(function(e,t,n){return e.put(t).then((function(e){return{updated:!0,rev:e.rev}}),(function(r){if(409!==r.status)throw r;return N(e,t._id,n)}))}(e,l,n))}))}))}var R=u.v4;n.adapterFun=function(e,t){return v(i((function(n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this;return function(e,t,n){if(e.constructor.listeners("debug").length){for(var r=["api",e.name,t],i=0;i<n.length-1;i++)r.push(n[i]);e.constructor.emit("debug",r);var o=n[n.length-1];n[n.length-1]=function(n,r){var i=["api",e.name,t];i=i.concat(n?["error",n]:["success",r]),e.constructor.emit("debug",i),o(n,r)}}}(r,e,n),this.taskqueue.isReady?t.apply(this,n):new Promise((function(t,i){r.taskqueue.addTask((function(o){o?i(o):t(r[e].apply(r,n))}))}))})))},n.assign=T,n.bulkGetShim=function(e,t,n){var r=t.docs,i=new o.Map;r.forEach((function(e){i.has(e.id)?i.get(e.id).push(e):i.set(e.id,[e])}));var s=i.size,a=0,l=new Array(s);function c(){var e;++a===s&&(e=[],l.forEach((function(t){t.docs.forEach((function(n){e.push({id:t.id,docs:[n]})}))})),n(null,{results:e}))}var u=[];i.forEach((function(e,t){u.push(t)}));var d=0;!function n(){if(!(d>=u.length)){var r=Math.min(d+6,u.length),o=u.slice(d,r);!function(r,o){r.forEach((function(r,s){var a=o+s,u=i.get(r),d=y(u[0],["atts_since","attachments"]);d.open_revs=u.map((function(e){return e.rev})),d.open_revs=d.open_revs.filter(x);var p=x;0===d.open_revs.length&&(delete d.open_revs,p=E),["revs","attachments","binary","ajax","latest"].forEach((function(e){e in t&&(d[e]=t[e])})),e.get(r,d,(function(e,t){var i,o,s;i=e?[{error:e}]:p(t),o=r,s=i,l[a]={id:o,docs:s},c(),n()}))}))}(o,d),d+=o.length}}()},n.changesHandler=w,n.clone=g,n.defaultBackOff=function(e){var t=0;return e||(t=2e3),function(e,t){return e=parseInt(e,10)||0,(t=parseInt(t,10))!=t||t<=e?t=(e||1)<<1:t+=1,t>6e5&&(e=3e5,t=6e5),~~((t-e)*Math.random()+e)}(e,t)},n.explainError=function(e,t){S("info","The above "+e+" is totally normal. "+t)},n.filterChange=function(e){var t={},n=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(r){r.doc||(r.doc={});var i=n&&function(e,t,n){try{return!e(t,n)}catch(e){var r="Filter function threw: "+e.toString();return l.createError(l.BAD_REQUEST,r)}}(e.filter,r.doc,t);if("object"==typeof i)return i;if(i)return!1;if(e.include_docs){if(!e.attachments)for(var o in r.doc._attachments)r.doc._attachments.hasOwnProperty(o)&&(r.doc._attachments[o].stub=!0)}else delete r.doc;return!0}},n.flatten=function(e){for(var t=[],n=0,r=e.length;n<r;n++)t=t.concat(e[n]);return t},n.functionName=k,n.guardedConsole=S,n.hasLocalStorage=_,n.invalidIdError=function(e){var t;if(e?"string"!=typeof e?t=l.createError(l.INVALID_ID):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=l.createError(l.RESERVED_ID)):t=l.createError(l.MISSING_ID),t)throw t},n.isRemote=function(e){return"boolean"==typeof e._remote?e._remote:"function"==typeof e.type&&(S("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===e.type())},n.listenerCount=function(e,t){return"listenerCount"in e?e.listenerCount(t):c.EventEmitter.listenerCount(e,t)},n.nextTick=a,n.normalizeDdocFunctionName=function(e){var t=C(e);return t?t.join("/"):null},n.once=m,n.parseDdocFunctionName=C,n.parseUri=function(e){for(var t=O.exec(e),n={},r=14;r--;){var i=A[r],o=t[r]||"",s=-1!==["user","password"].indexOf(i);n[i]=s?decodeURIComponent(o):o}return n[j]={},n[A[12]].replace(I,(function(e,t,r){t&&(n[j][t]=r)})),n},n.pick=y,n.rev=function(e,t){var n=g(e);return t?(delete n._rev_tree,d.stringMd5(JSON.stringify(n))):u.v4().replace(/-/g,"").toLowerCase()},n.scopeEval=function(e,t){var n=[],r=[];for(var i in t)t.hasOwnProperty(i)&&(n.push(i),r.push(t[i]));return n.push(e),Function.apply(null,n).apply(null,r)},n.toPromise=v,n.upsert=N,n.uuid=R},{argsarray:219,events:241,immediate:246,inherits:247,"pouchdb-collections":295,"pouchdb-errors":296,"pouchdb-md5":298,uuid:443}],301:[function(e,t,n){(function(n,r){(function(){"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var o,s,a=i(e("immediate")),l=i(e("uuid")),c=i(e("spark-md5")),u=i(e("vuvuzela")),d=i(e("argsarray")),p=i(e("inherits")),h=e("events");function f(e){return"$"+e}function g(e){return e.substring(1)}function m(){this._store={}}function v(e){if(this._store=new m,e&&Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.add(e[t])}function y(e){if(e instanceof ArrayBuffer)return function(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),r=new Uint8Array(e);return n.set(r),t}(e);var t=e.size,n=e.type;return"function"==typeof e.slice?e.slice(0,t,n):e.webkitSlice(0,t,n)}m.prototype.get=function(e){var t=f(e);return this._store[t]},m.prototype.set=function(e,t){var n=f(e);return this._store[n]=t,!0},m.prototype.has=function(e){return f(e)in this._store},m.prototype.delete=function(e){var t=f(e),n=t in this._store;return delete this._store[t],n},m.prototype.forEach=function(e){for(var t=Object.keys(this._store),n=0,r=t.length;n<r;n++){var i=t[n];e(this._store[i],i=g(i))}},Object.defineProperty(m.prototype,"size",{get:function(){return Object.keys(this._store).length}}),v.prototype.add=function(e){return this._store.set(e,!0)},v.prototype.has=function(e){return this._store.has(e)},v.prototype.forEach=function(e){this._store.forEach((function(t,n){e(n)}))},Object.defineProperty(v.prototype,"size",{get:function(){return this._store.size}}),function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}()?(o=Set,s=Map):(o=v,s=m);var b=Function.prototype.toString,x=b.call(Object);function E(e){var t,n,r;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],n=0,r=e.length;n<r;n++)t[n]=E(e[n]);return t}if(e instanceof Date)return e.toISOString();if(function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer||"undefined"!=typeof Blob&&e instanceof Blob}(e))return y(e);if(!function(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=t.constructor;return"function"==typeof n&&n instanceof n&&b.call(n)==x}(e))return e;for(n in t={},e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=E(e[n]);void 0!==i&&(t[n]=i)}return t}function _(e){var t=!1;return d((function(n){if(t)throw new Error("once called more than once");t=!0,e.apply(this,n)}))}function w(e){return d((function(t){t=E(t);var n=this,r="function"==typeof t[t.length-1]&&t.pop(),i=new Promise((function(r,i){var o;try{var s=_((function(e,t){e?i(e):r(t)}));t.push(s),(o=e.apply(n,t))&&"function"==typeof o.then&&r(o)}catch(e){i(e)}}));return r&&i.then((function(e){r(null,e)}),r),i}))}function S(e,t){return w(d((function(n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this;return function(e,t,n){if(e.constructor.listeners("debug").length){for(var r=["api",e.name,t],i=0;i<n.length-1;i++)r.push(n[i]);e.constructor.emit("debug",r);var o=n[n.length-1];n[n.length-1]=function(n,r){var i=["api",e.name,t];i=i.concat(n?["error",n]:["success",r]),e.constructor.emit("debug",i),o(n,r)}}}(r,e,n),this.taskqueue.isReady?t.apply(this,n):new Promise((function(t,i){r.taskqueue.addTask((function(o){o?i(o):t(r[e].apply(r,n))}))}))})))}function T(e,t){for(var n={},r=0,i=t.length;r<i;r++){var o=t[r];o in e&&(n[o]=e[o])}return n}var k;function C(e){return e}function A(e){return[{ok:e}]}function j(e,t,n){var r=t.docs,i=new s;r.forEach((function(e){i.has(e.id)?i.get(e.id).push(e):i.set(e.id,[e])}));var o=i.size,a=0,l=new Array(o);function c(){var e;++a===o&&(e=[],l.forEach((function(t){t.docs.forEach((function(n){e.push({id:t.id,docs:[n]})}))})),n(null,{results:e}))}var u=[];i.forEach((function(e,t){u.push(t)}));var d=0;!function n(){if(!(d>=u.length)){var r=Math.min(d+6,u.length),o=u.slice(d,r);!function(r,o){r.forEach((function(r,s){var a=o+s,u=i.get(r),d=T(u[0],["atts_since","attachments"]);d.open_revs=u.map((function(e){return e.rev})),d.open_revs=d.open_revs.filter(C);var p=C;0===d.open_revs.length&&(delete d.open_revs,p=A),["revs","attachments","binary","ajax","latest"].forEach((function(e){e in t&&(d[e]=t[e])})),e.get(r,d,(function(e,t){var i,o,s;i=e?[{error:e}]:p(t),o=r,s=i,l[a]={id:o,docs:s},c(),n()}))}))}(o,d),d+=o.length}}()}try{localStorage.setItem("_pouch_check_localstorage",1),k=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){k=!1}function I(){return k}function O(){var e;h.EventEmitter.call(this),this._listeners={},e=this,I()&&addEventListener("storage",(function(t){e.emit(t.key)}))}function N(e){if("undefined"!=typeof console&&"function"==typeof console[e]){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function R(e){var t=0;return e||(t=2e3),function(e,t){return e=parseInt(e,10)||0,(t=parseInt(t,10))!=t||t<=e?t=(e||1)<<1:t+=1,t>6e5&&(e=3e5,t=6e5),~~((t-e)*Math.random()+e)}(e,t)}function P(e,t){N("info","The above "+e+" is totally normal. "+t)}p(O,h.EventEmitter),O.prototype.addListener=function(e,t,n,r){if(!this._listeners[t]){var i=this,o=!1;this._listeners[t]=s,this.on(e,s)}function s(){if(i._listeners[t])if(o)o="waiting";else{o=!0;var e=T(r,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);n.changes(e).on("change",(function(e){e.seq>r.since&&!r.cancelled&&(r.since=e.seq,r.onChange(e))})).on("complete",(function(){"waiting"===o&&a(s),o=!1})).on("error",(function(){o=!1}))}}},O.prototype.removeListener=function(e,t){t in this._listeners&&(h.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},O.prototype.notifyLocalWindows=function(e){I()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},O.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var D="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t};function M(e,t,n){Error.call(this,n),this.status=e,this.name=t,this.message=n,this.error=!0}p(M,Error),M.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};new M(401,"unauthorized","Name or password is incorrect.");var L=new M(400,"bad_request","Missing JSON list of 'docs'"),B=new M(404,"not_found","missing"),F=new M(409,"conflict","Document update conflict"),U=new M(400,"bad_request","_id field must contain a string"),H=new M(412,"missing_id","_id is required for puts"),G=new M(400,"bad_request","Only reserved document ids may start with underscore."),q=(new M(412,"precondition_failed","Database not open"),new M(500,"unknown_error","Database encountered an unknown error")),V=new M(500,"badarg","Some query argument is invalid"),z=(new M(400,"invalid_request","Request was invalid"),new M(400,"query_parse_error","Some query parameter is invalid")),W=new M(500,"doc_validation","Bad special document member"),K=new M(400,"bad_request","Something wrong with the request"),$=new M(400,"bad_request","Document must be a JSON object"),Y=(new M(404,"not_found","Database not found"),new M(500,"indexed_db_went_bad","unknown")),X=(new M(500,"web_sql_went_bad","unknown"),new M(500,"levelDB_went_went_bad","unknown"),new M(403,"forbidden","Forbidden by design doc validate_doc_update function"),new M(400,"bad_request","Invalid rev format")),J=(new M(412,"file_exists","The database could not be created, the file already exists."),new M(412,"missing_stub","A pre-existing attachment stub wasn't found"));new M(413,"invalid_url","Provided URL is invalid");function Q(e,t){function n(t){for(var n in e)"function"!=typeof e[n]&&(this[n]=e[n]);void 0!==t&&(this.reason=t)}return n.prototype=M.prototype,new n(t)}function Z(e){if("object"!=typeof e){var t=e;(e=q).data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}function ee(e){var t={},n=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(r){r.doc||(r.doc={});var i=n&&function(e,t,n){try{return!e(t,n)}catch(e){var r="Filter function threw: "+e.toString();return Q(K,r)}}(e.filter,r.doc,t);if("object"==typeof i)return i;if(i)return!1;if(e.include_docs){if(!e.attachments)for(var o in r.doc._attachments)r.doc._attachments.hasOwnProperty(o)&&(r.doc._attachments[o].stub=!0)}else delete r.doc;return!0}}function te(e){for(var t=[],n=0,r=e.length;n<r;n++)t=t.concat(e[n]);return t}function ne(e){var t;if(e?"string"!=typeof e?t=Q(U):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=Q(G)):t=Q(H),t)throw t}function re(e){return"boolean"==typeof e._remote?e._remote:"function"==typeof e.type&&(N("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===e.type())}function ie(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}function oe(e){var t=ie(e);return t?t.join("/"):null}var se=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],ae="queryKey",le=/(?:^|&)([^&=]*)=?([^&]*)/g,ce=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function ue(e){for(var t=ce.exec(e),n={},r=14;r--;){var i=se[r],o=t[r]||"",s=-1!==["user","password"].indexOf(i);n[i]=s?decodeURIComponent(o):o}return n[ae]={},n[se[12]].replace(le,(function(e,t,r){t&&(n[ae][t]=r)})),n}function de(e,t){var n=[],r=[];for(var i in t)t.hasOwnProperty(i)&&(n.push(i),r.push(t[i]));return n.push(e),Function.apply(null,n).apply(null,r)}function pe(e,t,n){return new Promise((function(r,i){e.get(t,(function(o,s){if(o){if(404!==o.status)return i(o);s={}}var a=s._rev,l=n(s);if(!l)return r({updated:!1,rev:a});l._id=t,l._rev=a,r(function(e,t,n){return e.put(t).then((function(e){return{updated:!0,rev:e.rev}}),(function(r){if(409!==r.status)throw r;return pe(e,t._id,n)}))}(e,l,n))}))}))}var he=function(e){return atob(e)},fe=function(e){return btoa(e)};function ge(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}function me(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function ve(e,t){return ge([me(e)],{type:t})}function ye(e,t){return ve(he(e),t)}function be(e,t){var n=new FileReader,r="function"==typeof n.readAsBinaryString;n.onloadend=function(e){var n=e.target.result||"";if(r)return t(n);t(function(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return t}(n))},r?n.readAsBinaryString(e):n.readAsArrayBuffer(e)}function xe(e,t){be(e,(function(e){t(e)}))}function Ee(e,t){xe(e,(function(e){t(fe(e))}))}var _e=r.setImmediate||r.setTimeout;function we(e,t,n,r,i){(n>0||r<t.size)&&(t=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.slice(t,n)}(t,n,r)),function(e,t){var n=new FileReader;n.onloadend=function(e){var n=e.target.result||new ArrayBuffer(0);t(n)},n.readAsArrayBuffer(e)}(t,(function(t){e.append(t),i()}))}function Se(e,t,n,r,i){(n>0||r<t.length)&&(t=t.substring(n,r)),e.appendBinary(t),i()}function Te(e,t){var n="string"==typeof e,r=n?e.length:e.size,i=Math.min(32768,r),o=Math.ceil(r/i),s=0,a=n?new c:new c.ArrayBuffer,l=n?Se:we;function u(){_e(p)}function d(){var e=function(e){return fe(e)}(a.end(!0));t(e),a.destroy()}function p(){var t=s*i;l(a,e,t,t+i,++s<o?u:d)}p()}function ke(e){return c.hash(e)}function Ce(e,t){var n=E(e);return t?(delete n._rev_tree,ke(JSON.stringify(n))):l.v4().replace(/-/g,"").toLowerCase()}var Ae=l.v4;function je(e){for(var t,n,r,i,o=e.rev_tree.slice();i=o.pop();){var s=i.ids,a=s[2],l=i.pos;if(a.length)for(var c=0,u=a.length;c<u;c++)o.push({pos:l+1,ids:a[c]});else{var d=!!s[1].deleted,p=s[0];t&&!(r!==d?r:n!==l?n<l:t<p)||(t=p,n=l,r=d)}}return n+"-"+t}function Ie(e,t){for(var n,r=e.slice();n=r.pop();)for(var i=n.pos,o=n.ids,s=o[2],a=t(0===s.length,i,o[0],n.ctx,o[1]),l=0,c=s.length;l<c;l++)r.push({pos:i+1,ids:s[l],ctx:a})}function Oe(e,t){return e.pos-t.pos}function Ne(e){var t=[];Ie(e,(function(e,n,r,i,o){e&&t.push({rev:n+"-"+r,pos:n,opts:o})})),t.sort(Oe).reverse();for(var n=0,r=t.length;n<r;n++)delete t[n].pos;return t}function Re(e){for(var t=je(e),n=Ne(e.rev_tree),r=[],i=0,o=n.length;i<o;i++){var s=n[i];s.rev===t||s.opts.deleted||r.push(s.rev)}return r}function Pe(e){for(var t,n=[],r=e.slice();t=r.pop();){var i=t.pos,o=t.ids,s=o[0],a=o[1],l=o[2],c=0===l.length,u=t.history?t.history.slice():[];u.push({id:s,opts:a}),c&&n.push({pos:i+1-u.length,ids:u});for(var d=0,p=l.length;d<p;d++)r.push({pos:i+1,ids:l[d],history:u})}return n.reverse()}function De(e,t){return e.pos-t.pos}function Me(e,t,n){var r=function(e,t,n){for(var r,i=0,o=e.length;i<o;)n(e[r=i+o>>>1],t)<0?i=r+1:o=r;return i}(e,t,n);e.splice(r,0,t)}function Le(e,t){for(var n,r,i=t,o=e.length;i<o;i++){var s=e[i],a=[s.id,s.opts,[]];r?(r[2].push(a),r=a):n=r=a}return n}function Be(e,t){return e[0]<t[0]?-1:1}function Fe(e,t){for(var n=[{tree1:e,tree2:t}],r=!1;n.length>0;){var i=n.pop(),o=i.tree1,s=i.tree2;(o[1].status||s[1].status)&&(o[1].status="available"===o[1].status||"available"===s[1].status?"available":"missing");for(var a=0;a<s[2].length;a++)if(o[2][0]){for(var l=!1,c=0;c<o[2].length;c++)o[2][c][0]===s[2][a][0]&&(n.push({tree1:o[2][c],tree2:s[2][a]}),l=!0);l||(r="new_branch",Me(o[2],s[2][a],Be))}else r="new_leaf",o[2][0]=s[2][a]}return{conflicts:r,tree:e}}function Ue(e,t,n){var r,i=[],o=!1,s=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var a=0,l=e.length;a<l;a++){var c=e[a];if(c.pos===t.pos&&c.ids[0]===t.ids[0])r=Fe(c.ids,t.ids),i.push({pos:c.pos,ids:r.tree}),o=o||r.conflicts,s=!0;else if(!0!==n){var u=c.pos<t.pos?c:t,d=c.pos<t.pos?t:c,p=d.pos-u.pos,h=[],f=[];for(f.push({ids:u.ids,diff:p,parent:null,parentIdx:null});f.length>0;){var g=f.pop();if(0!==g.diff)for(var m=g.ids[2],v=0,y=m.length;v<y;v++)f.push({ids:m[v],diff:g.diff-1,parent:g.ids,parentIdx:v});else g.ids[0]===d.ids[0]&&h.push(g)}var b=h[0];b?(r=Fe(b.ids,d.ids),b.parent[2][b.parentIdx]=r.tree,i.push({pos:u.pos,ids:u.ids}),o=o||r.conflicts,s=!0):i.push(c)}else i.push(c)}return s||i.push(t),i.sort(De),{tree:i,conflicts:o||"internal_node"}}function He(e,t,n){var r=Ue(e,t),i=function(e,t){for(var n,r,i=Pe(e),o=0,s=i.length;o<s;o++){var a,l=i[o],c=l.ids;if(c.length>t){n||(n={});var u=c.length-t;a={pos:l.pos+u,ids:Le(c,u)};for(var d=0;d<u;d++){var p=l.pos+d+"-"+c[d].id;n[p]=!0}}else a={pos:l.pos,ids:Le(c,0)};r=r?Ue(r,a,!0).tree:[a]}return n&&Ie(r,(function(e,t,r){delete n[t+"-"+r]})),{tree:r,revs:n?Object.keys(n):[]}}(r.tree,n);return{tree:i.tree,stemmedRevs:i.revs,conflicts:r.conflicts}}function Ge(e){return e.ids}function qe(e,t){t||(t=je(e));for(var n,r=t.substring(t.indexOf("-")+1),i=e.rev_tree.map(Ge);n=i.pop();){if(n[0]===r)return!!n[1].deleted;i=i.concat(n[2])}}function Ve(e){return/^_local/.test(e)}function ze(e,t,n){h.EventEmitter.call(this);var r=this;this.db=e;var i=(t=t?E(t):{}).complete=_((function(t,n){t?function(e,t){return"listenerCount"in e?e.listenerCount(t):h.EventEmitter.listenerCount(e,t)}(r,"error")>0&&r.emit("error",t):r.emit("complete",n),r.removeAllListeners(),e.removeListener("destroyed",o)}));function o(){r.cancel()}n&&(r.on("complete",(function(e){n(null,e)})),r.on("error",n)),e.once("destroyed",o),t.onChange=function(e,t,n){r.isCancelled||function(e,t,n,r){try{e.emit("change",t,n,r)}catch(e){N("error",'Error in .on("change", function):',e)}}(r,e,t,n)};var s=new Promise((function(e,n){t.complete=function(t,r){t?n(t):e(r)}}));r.once("cancel",(function(){e.removeListener("destroyed",o),t.complete(null,{status:"cancelled"})})),this.then=s.then.bind(s),this.catch=s.catch.bind(s),this.then((function(e){i(null,e)}),i),e.taskqueue.isReady?r.validateChanges(t):e.taskqueue.addTask((function(e){e?t.complete(e):r.isCancelled?r.emit("cancel"):r.validateChanges(t)}))}function We(e,t,n){var r=[{rev:e._rev}];"all_docs"===n.style&&(r=Ne(t.rev_tree).map((function(e){return{rev:e.rev}})));var i={id:t.id,changes:r,doc:e};return qe(t,e._rev)&&(i.deleted=!0),n.conflicts&&(i.doc._conflicts=Re(t),i.doc._conflicts.length||delete i.doc._conflicts),i}function Ke(e,t){return e<t?-1:e>t?1:0}function $e(e,t){return function(n,r){n||r[0]&&r[0].error?((n=n||r[0]).docId=t,e(n)):e(null,r.length?r[0]:r)}}function Ye(e,t){var n=Ke(e._id,t._id);return 0!==n?n:Ke(e._revisions?e._revisions.start:0,t._revisions?t._revisions.start:0)}function Xe(e){var t=e._compactionQueue[0],n=t.opts,r=t.callback;e.get("_local/compaction").catch((function(){return!1})).then((function(t){t&&t.last_seq&&(n.last_seq=t.last_seq),e._compact(n,(function(t,n){t?r(t):r(null,n),a((function(){e._compactionQueue.shift(),e._compactionQueue.length&&Xe(e)}))}))}))}function Je(){for(var e in h.EventEmitter.call(this),Je.prototype)"function"==typeof this[e]&&(this[e]=this[e].bind(this))}function Qe(){this.isReady=!1,this.failed=!1,this.queue=[]}function Ze(e,t){if(!(this instanceof Ze))return new Ze(e,t);var n=this;if(t=t||{},e&&"object"==typeof e&&(e=(t=e).name,delete t.name),void 0===t.deterministic_revs&&(t.deterministic_revs=!0),this.__opts=t=E(t),n.auto_compaction=t.auto_compaction,n.prefix=Ze.prefix,"string"!=typeof e)throw new Error("Missing/invalid DB name");var r=function(e,t){var n=e.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var r=Ze.adapters,i=Ze.preferredAdapters,o=Ze.prefix,s=t.adapter;if(!s)for(var a=0;a<i.length&&"idb"===(s=i[a])&&"websql"in r&&I()&&localStorage["_pouch__websqldb_"+o+e];++a)N("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');var l=r[s];return{name:l&&"use_prefix"in l&&!l.use_prefix?e:o+e,adapter:s}}((t.prefix||"")+e,t);if(t.name=r.name,t.adapter=t.adapter||r.adapter,n.name=e,n._adapter=t.adapter,Ze.emit("debug",["adapter","Picked adapter: ",t.adapter]),!Ze.adapters[t.adapter]||!Ze.adapters[t.adapter].valid())throw new Error("Invalid Adapter: "+t.adapter);Je.call(n),n.taskqueue=new Qe,n.adapter=t.adapter,Ze.adapters[t.adapter].call(n,t,(function(e){if(e)return n.taskqueue.fail(e);(function(e){function t(t){e.removeListener("closed",n),t||e.constructor.emit("destroyed",e.name)}function n(){e.removeListener("destroyed",t),e.constructor.emit("unref",e)}e.once("destroyed",t),e.once("closed",n),e.constructor.emit("ref",e)})(n),n.emit("created",n),Ze.emit("created",n.name),n.taskqueue.ready(n)}))}p(ze,h.EventEmitter),ze.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},ze.prototype.validateChanges=function(e){var t=e.complete,n=this;Ze._changesFilterPlugin?Ze._changesFilterPlugin.validate(e,(function(r){if(r)return t(r);n.doChanges(e)})):n.doChanges(e)},ze.prototype.doChanges=function(e){var t=this,n=e.complete;if("live"in(e=E(e))&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=We,"latest"===e.since&&(e.since="now"),e.since||(e.since=0),"now"!==e.since){if(Ze._changesFilterPlugin){if(Ze._changesFilterPlugin.normalize(e),Ze._changesFilterPlugin.shouldFilter(this,e))return Ze._changesFilterPlugin.filter(this,e)}else["doc_ids","filter","selector","view"].forEach((function(t){t in e&&N("warn",'The "'+t+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')}));"descending"in e||(e.descending=!1),e.limit=0===e.limit?1:e.limit,e.complete=n;var r=this.db._changes(e);if(r&&"function"==typeof r.cancel){var i=t.cancel;t.cancel=d((function(e){r.cancel(),i.apply(this,e)}))}}else this.db.info().then((function(r){t.isCancelled?n(null,{status:"cancelled"}):(e.since=r.update_seq,t.doChanges(e))}),n)},p(Je,h.EventEmitter),Je.prototype.post=S("post",(function(e,t,n){if("function"==typeof t&&(n=t,t={}),"object"!=typeof e||Array.isArray(e))return n(Q($));this.bulkDocs({docs:[e]},t,$e(n,e._id))})),Je.prototype.put=S("put",(function(e,t,n){if("function"==typeof t&&(n=t,t={}),"object"!=typeof e||Array.isArray(e))return n(Q($));if(ne(e._id),Ve(e._id)&&"function"==typeof this._putLocal)return e._deleted?this._removeLocal(e,n):this._putLocal(e,n);var r,i,o,s,a=this;function l(n){"function"==typeof a._put&&!1!==t.new_edits?a._put(e,t,n):a.bulkDocs({docs:[e]},t,$e(n,e._id))}t.force&&e._rev?(i=(r=e._rev.split("-"))[1],o=parseInt(r[0],10)+1,s=Ce(),e._revisions={start:o,ids:[s,i]},e._rev=o+"-"+s,t.new_edits=!1,l((function(t){var r=t?null:{ok:!0,id:e._id,rev:e._rev};n(t,r)}))):l(n)})),Je.prototype.putAttachment=S("putAttachment",(function(e,t,n,r,i){var o=this;function s(e){var n="_rev"in e?parseInt(e._rev,10):0;return e._attachments=e._attachments||{},e._attachments[t]={content_type:i,data:r,revpos:++n},o.put(e)}return"function"==typeof i&&(i=r,r=n,n=null),void 0===i&&(i=r,r=n,n=null),i||N("warn","Attachment",t,"on document",e,"is missing content_type"),o.get(e).then((function(e){if(e._rev!==n)throw Q(F);return s(e)}),(function(t){if(t.reason===B.message)return s({_id:e});throw t}))})),Je.prototype.removeAttachment=S("removeAttachment",(function(e,t,n,r){var i=this;i.get(e,(function(e,o){if(e)r(e);else if(o._rev===n){if(!o._attachments)return r();delete o._attachments[t],0===Object.keys(o._attachments).length&&delete o._attachments,i.put(o,r)}else r(Q(F))}))})),Je.prototype.remove=S("remove",(function(e,t,n,r){var i;"string"==typeof t?(i={_id:e,_rev:t},"function"==typeof n&&(r=n,n={})):(i=e,"function"==typeof t?(r=t,n={}):(r=n,n=t)),(n=n||{}).was_delete=!0;var o={_id:i._id,_rev:i._rev||n.rev,_deleted:!0};if(Ve(o._id)&&"function"==typeof this._removeLocal)return this._removeLocal(i,r);this.bulkDocs({docs:[o]},n,$e(r,o._id))})),Je.prototype.revsDiff=S("revsDiff",(function(e,t,n){"function"==typeof t&&(n=t,t={});var r=Object.keys(e);if(!r.length)return n(null,{});var i=0,o=new s;function a(e,t){o.has(e)||o.set(e,{missing:[]}),o.get(e).missing.push(t)}r.map((function(t){this._getRevisionTree(t,(function(s,l){if(s&&404===s.status&&"missing"===s.message)o.set(t,{missing:e[t]});else{if(s)return n(s);!function(t,n){var r=e[t].slice(0);Ie(n,(function(e,n,i,o,s){var l=n+"-"+i,c=r.indexOf(l);-1!==c&&(r.splice(c,1),"available"!==s.status&&a(t,l))})),r.forEach((function(e){a(t,e)}))}(t,l)}if(++i===r.length){var c={};return o.forEach((function(e,t){c[t]=e})),n(null,c)}}))}),this)})),Je.prototype.bulkGet=S("bulkGet",(function(e,t){j(this,e,t)})),Je.prototype.compactDocument=S("compactDocument",(function(e,t,n){var r=this;this._getRevisionTree(e,(function(i,o){if(i)return n(i);var s=function(e){var t={},n=[];return Ie(e,(function(e,r,i,o){var s=r+"-"+i;return e&&(t[s]=0),void 0!==o&&n.push({from:o,to:s}),s})),n.reverse(),n.forEach((function(e){void 0===t[e.from]?t[e.from]=1+t[e.to]:t[e.from]=Math.min(t[e.from],1+t[e.to])})),t}(o),a=[],l=[];Object.keys(s).forEach((function(e){s[e]>t&&a.push(e)})),Ie(o,(function(e,t,n,r,i){var o=t+"-"+n;"available"===i.status&&-1!==a.indexOf(o)&&l.push(o)})),r._doCompaction(e,l,n)}))})),Je.prototype.compact=S("compact",(function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:e,callback:t}),1===this._compactionQueue.length&&Xe(this)})),Je.prototype._compact=function(e,t){var n=this,r={return_docs:!1,last_seq:e.last_seq||0},i=[];n.changes(r).on("change",(function(e){i.push(n.compactDocument(e.id,0))})).on("complete",(function(e){var r=e.last_seq;Promise.all(i).then((function(){return pe(n,"_local/compaction",(function(e){return(!e.last_seq||e.last_seq<r)&&(e.last_seq=r,e)}))})).then((function(){t(null,{ok:!0})})).catch(t)})).on("error",t)},Je.prototype.get=S("get",(function(e,t,n){if("function"==typeof t&&(n=t,t={}),"string"!=typeof e)return n(Q(U));if(Ve(e)&&"function"==typeof this._getLocal)return this._getLocal(e,n);var r=[],i=this;function o(){var o=[],s=r.length;if(!s)return n(null,o);r.forEach((function(r){i.get(e,{rev:r,revs:t.revs,latest:t.latest,attachments:t.attachments,binary:t.binary},(function(e,t){if(e)o.push({missing:r});else{for(var i,a=0,l=o.length;a<l;a++)if(o[a].ok&&o[a].ok._rev===t._rev){i=!0;break}i||o.push({ok:t})}--s||n(null,o)}))}))}if(!t.open_revs)return this._get(e,t,(function(r,o){if(r)return r.docId=e,n(r);var s=o.doc,a=o.metadata,l=o.ctx;if(t.conflicts){var c=Re(a);c.length&&(s._conflicts=c)}if(qe(a,s._rev)&&(s._deleted=!0),t.revs||t.revs_info){for(var u=s._rev.split("-"),d=parseInt(u[0],10),p=u[1],h=Pe(a.rev_tree),f=null,g=0;g<h.length;g++){var m=h[g],v=m.ids.map((function(e){return e.id})).indexOf(p);(v===d-1||!f&&-1!==v)&&(f=m)}if(!f)return(r=new Error("invalid rev tree")).docId=e,n(r);var y=f.ids.map((function(e){return e.id})).indexOf(s._rev.split("-")[1])+1,b=f.ids.length-y;if(f.ids.splice(y,b),f.ids.reverse(),t.revs&&(s._revisions={start:f.pos+f.ids.length-1,ids:f.ids.map((function(e){return e.id}))}),t.revs_info){var x=f.pos+f.ids.length;s._revs_info=f.ids.map((function(e){return{rev:--x+"-"+e.id,status:e.opts.status}}))}}if(t.attachments&&s._attachments){var E=s._attachments,_=Object.keys(E).length;if(0===_)return n(null,s);Object.keys(E).forEach((function(e){this._getAttachment(s._id,e,E[e],{rev:s._rev,binary:t.binary,ctx:l},(function(t,r){var i=s._attachments[e];i.data=r,delete i.stub,delete i.length,--_||n(null,s)}))}),i)}else{if(s._attachments)for(var w in s._attachments)s._attachments.hasOwnProperty(w)&&(s._attachments[w].stub=!0);n(null,s)}}));if("all"===t.open_revs)this._getRevisionTree(e,(function(e,t){if(e)return n(e);r=Ne(t).map((function(e){return e.rev})),o()}));else{if(!Array.isArray(t.open_revs))return n(Q(q,"function_clause"));r=t.open_revs;for(var s=0;s<r.length;s++){var a=r[s];if("string"!=typeof a||!/^\d+-/.test(a))return n(Q(X))}o()}})),Je.prototype.getAttachment=S("getAttachment",(function(e,t,n,r){var i=this;n instanceof Function&&(r=n,n={}),this._get(e,n,(function(o,s){return o?r(o):s.doc._attachments&&s.doc._attachments[t]?(n.ctx=s.ctx,n.binary=!0,void i._getAttachment(e,t,s.doc._attachments[t],n,r)):r(Q(B))}))})),Je.prototype.allDocs=S("allDocs",(function(e,t){if("function"==typeof e&&(t=e,e={}),e.skip=void 0!==e.skip?e.skip:0,e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"keys"in e){if(!Array.isArray(e.keys))return t(new TypeError("options.keys must be an array"));var n=["startkey","endkey","key"].filter((function(t){return t in e}))[0];if(n)return void t(Q(z,"Query parameter `"+n+"` is not compatible with multi-get"));if(!re(this)&&(function(e){var t="limit"in e?e.keys.slice(e.skip,e.limit+e.skip):e.skip>0?e.keys.slice(e.skip):e.keys;e.keys=t,e.skip=0,delete e.limit,e.descending&&(t.reverse(),e.descending=!1)}(e),0===e.keys.length))return this._allDocs({limit:0},t)}return this._allDocs(e,t)})),Je.prototype.changes=function(e,t){return"function"==typeof e&&(t=e,e={}),(e=e||{}).return_docs="return_docs"in e?e.return_docs:!e.live,new ze(this,e,t)},Je.prototype.close=S("close",(function(e){return this._closed=!0,this.emit("closed"),this._close(e)})),Je.prototype.info=S("info",(function(e){var t=this;this._info((function(n,r){if(n)return e(n);r.db_name=r.db_name||t.name,r.auto_compaction=!(!t.auto_compaction||re(t)),r.adapter=t.adapter,e(null,r)}))})),Je.prototype.id=S("id",(function(e){return this._id(e)})),Je.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},Je.prototype.bulkDocs=S("bulkDocs",(function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{},Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return n(Q(L));for(var r=0;r<e.docs.length;++r)if("object"!=typeof e.docs[r]||Array.isArray(e.docs[r]))return n(Q($));var i;if(e.docs.forEach((function(e){e._attachments&&Object.keys(e._attachments).forEach((function(t){i=i||function(e){return"_"===e.charAt(0)&&e+" is not a valid attachment name, attachment names cannot start with '_'"}(t),e._attachments[t].content_type||N("warn","Attachment",t,"on document",e._id,"is missing content_type")}))})),i)return n(Q(K,i));"new_edits"in t||(t.new_edits=!("new_edits"in e)||e.new_edits);var o=this;t.new_edits||re(o)||e.docs.sort(Ye),function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),i=0;i<r.length;i++){var o=r[i];n._attachments[o]=T(n._attachments[o],["data","digest","content_type","length","revpos","stub"])}}}(e.docs);var s=e.docs.map((function(e){return e._id}));return this._bulkDocs(e,t,(function(e,r){if(e)return n(e);if(t.new_edits||(r=r.filter((function(e){return e.error}))),!re(o))for(var i=0,a=r.length;i<a;i++)r[i].id=r[i].id||s[i];n(null,r)}))})),Je.prototype.registerDependentDatabase=S("registerDependentDatabase",(function(e,t){var n=new this.constructor(e,this.__opts);pe(this,"_local/_pouch_dependentDbs",(function(t){return t.dependentDbs=t.dependentDbs||{},!t.dependentDbs[e]&&(t.dependentDbs[e]=!0,t)})).then((function(){t(null,{db:n})})).catch(t)})),Je.prototype.destroy=S("destroy",(function(e,t){"function"==typeof e&&(t=e,e={});var n=this,r=!("use_prefix"in n)||n.use_prefix;function i(){n._destroy(e,(function(e,r){if(e)return t(e);n._destroyed=!0,n.emit("destroyed"),t(null,r||{ok:!0})}))}if(re(n))return i();n.get("_local/_pouch_dependentDbs",(function(e,o){if(e)return 404!==e.status?t(e):i();var s=o.dependentDbs,a=n.constructor,l=Object.keys(s).map((function(e){var t=r?e.replace(new RegExp("^"+a.prefix),""):e;return new a(t,n.__opts).destroy()}));Promise.all(l).then(i,t)}))})),Qe.prototype.execute=function(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()},Qe.prototype.fail=function(e){this.failed=e,this.execute()},Qe.prototype.ready=function(e){this.isReady=!0,this.db=e,this.execute()},Qe.prototype.addTask=function(e){this.queue.push(e),this.failed&&this.execute()},p(Ze,Je);var et="undefined"!=typeof AbortController?AbortController:function(){return{abort:function(){}}},tt=fetch,nt=Headers;Ze.adapters={},Ze.preferredAdapters=[],Ze.prefix="_pouch_";var rt=new h.EventEmitter;(function(e){Object.keys(h.EventEmitter.prototype).forEach((function(t){"function"==typeof h.EventEmitter.prototype[t]&&(e[t]=rt[t].bind(rt))}));var t=e._destructionListeners=new s;e.on("ref",(function(e){t.has(e.name)||t.set(e.name,[]),t.get(e.name).push(e)})),e.on("unref",(function(e){if(t.has(e.name)){var n=t.get(e.name),r=n.indexOf(e);r<0||(n.splice(r,1),n.length>1?t.set(e.name,n):t.delete(e.name))}})),e.on("destroyed",(function(e){if(t.has(e)){var n=t.get(e);t.delete(e),n.forEach((function(e){e.emit("destroyed",!0)}))}}))})(Ze),Ze.adapter=function(e,t,n){t.valid()&&(Ze.adapters[e]=t,n&&Ze.preferredAdapters.push(e))},Ze.plugin=function(e){if("function"==typeof e)e(Ze);else{if("object"!=typeof e||0===Object.keys(e).length)throw new Error('Invalid plugin: got "'+e+'", expected an object or a function');Object.keys(e).forEach((function(t){Ze.prototype[t]=e[t]}))}return this.__defaults&&(Ze.__defaults=D({},this.__defaults)),Ze},Ze.defaults=function(e){function t(e,n){if(!(this instanceof t))return new t(e,n);n=n||{},e&&"object"==typeof e&&(e=(n=e).name,delete n.name),n=D({},t.__defaults,n),Ze.call(this,e,n)}return p(t,Ze),t.preferredAdapters=Ze.preferredAdapters.slice(),Object.keys(Ze).forEach((function(e){e in t||(t[e]=Ze[e])})),t.__defaults=D({},this.__defaults,e),t},Ze.fetch=function(e,t){return tt(e,t)};function it(e,t){for(var n=e,r=0,i=t.length;r<i&&(n=n[t[r]]);r++);return n}function ot(e){for(var t=[],n="",r=0,i=e.length;r<i;r++){var o=e[r];"."===o?r>0&&"\\"===e[r-1]?n=n.substring(0,n.length-1)+".":(t.push(n),n=""):n+=o}return t.push(n),t}var st=["$or","$nor","$not"];function at(e){return st.indexOf(e)>-1}function lt(e){return Object.keys(e)[0]}function ct(e){var t={};return e.forEach((function(e){Object.keys(e).forEach((function(n){var r=e[n];if("object"!=typeof r&&(r={$eq:r}),at(n))t[n]=r instanceof Array?r.map((function(e){return ct([e])})):ct([r]);else{var i=t[n]=t[n]||{};Object.keys(r).forEach((function(e){var t=r[e];return"$gt"===e||"$gte"===e?function(e,t,n){void 0===n.$eq&&(void 0!==n.$gte?"$gte"===e?t>n.$gte&&(n.$gte=t):t>=n.$gte&&(delete n.$gte,n.$gt=t):void 0!==n.$gt?"$gte"===e?t>n.$gt&&(delete n.$gt,n.$gte=t):t>n.$gt&&(n.$gt=t):n[e]=t)}(e,t,i):"$lt"===e||"$lte"===e?function(e,t,n){void 0===n.$eq&&(void 0!==n.$lte?"$lte"===e?t<n.$lte&&(n.$lte=t):t<=n.$lte&&(delete n.$lte,n.$lt=t):void 0!==n.$lt?"$lte"===e?t<n.$lt&&(delete n.$lt,n.$lte=t):t<n.$lt&&(n.$lt=t):n[e]=t)}(e,t,i):"$ne"===e?function(e,t){"$ne"in t?t.$ne.push(e):t.$ne=[e]}(t,i):"$eq"===e?function(e,t){delete t.$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,t.$eq=e}(t,i):void(i[e]=t)}))}}))})),t}function ut(e){for(var t in e){if(Array.isArray(e))for(var n in e)e[n].$and&&(e[n]=ct(e[n].$and));var r=e[t];"object"==typeof r&&ut(r)}return e}function dt(e,t){for(var n in e){"$and"===n&&(t=!0);var r=e[n];"object"==typeof r&&(t=dt(r,t))}return t}function pt(e){var t=E(e),n=!1;dt(t,!1)&&("$and"in(t=ut(t))&&(t=ct(t.$and)),n=!0),["$or","$nor"].forEach((function(e){e in t&&t[e].forEach((function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var r=t[n],i=e[r];"object"==typeof i&&null!==i||(e[r]={$eq:i})}}))})),"$not"in t&&(t.$not=ct([t.$not]));for(var r=Object.keys(t),i=0;i<r.length;i++){var o=r[i],s=t[o];"object"!=typeof s||null===s?s={$eq:s}:"$ne"in s&&!n&&(s.$ne=[s.$ne]),t[o]=s}return t}var ht=-324;function ft(e,t){if(e===t)return 0;e=gt(e),t=gt(t);var n=xt(e),r=xt(t);if(n-r!=0)return n-r;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return function(e,t){return e===t?0:e>t?1:-1}(e,t)}return Array.isArray(e)?function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=ft(e[r],t[r]);if(0!==i)return i}return e.length===t.length?0:e.length>t.length?1:-1}(e,t):function(e,t){for(var n=Object.keys(e),r=Object.keys(t),i=Math.min(n.length,r.length),o=0;o<i;o++){var s=ft(n[o],r[o]);if(0!==s)return s;if(0!==(s=ft(e[n[o]],t[r[o]])))return s}return n.length===r.length?0:n.length>r.length?1:-1}(e,t)}function gt(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var n=e.length;e=new Array(n);for(var r=0;r<n;r++)e[r]=gt(t[r])}else{if(e instanceof Date)return e.toJSON();if(null!==e)for(var i in e={},t)if(t.hasOwnProperty(i)){var o=t[i];void 0!==o&&(e[i]=gt(o))}}}return e}function mt(e){if(null!==e)switch(typeof e){case"boolean":return e?1:0;case"number":return function(e){if(0===e)return"1";var t=e.toExponential().split(/e\+?/),n=parseInt(t[1],10),r=e<0,i=r?"0":"2",o=function(e,t,n){return function(e,t,n){for(var r="",i=n-e.length;r.length<i;)r+=t;return r}(e,t,n)+e}(((r?-n:n)-ht).toString(),"0",3);i+=""+o;var s=Math.abs(parseFloat(t[0]));r&&(s=10-s);var a=s.toFixed(20);return a=a.replace(/\.?0+$/,""),i+""+a}(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),n=t?e:Object.keys(e),r=-1,i=n.length,o="";if(t)for(;++r<i;)o+=vt(n[r]);else for(;++r<i;){var s=n[r];o+=vt(s)+vt(e[s])}return o}return""}function vt(e){return xt(e=gt(e))+""+mt(e)+"\0"}function yt(e,t){var n,r=t;if("1"===e[t])n=0,t++;else{var i="0"===e[t];t++;var o="",s=e.substring(t,t+3),a=parseInt(s,10)+ht;for(i&&(a=-a),t+=3;;){var l=e[t];if("\0"===l)break;o+=l,t++}n=1===(o=o.split(".")).length?parseInt(o,10):parseFloat(o[0]+"."+o[1]),i&&(n-=10),0!==a&&(n=parseFloat(n+"e"+a))}return{num:n,length:t-r}}function bt(e,t){var n=e.pop();if(t.length){var r=t[t.length-1];n===r.element&&(t.pop(),r=t[t.length-1]);var i=r.element,o=r.index;Array.isArray(i)?i.push(n):o===e.length-2?i[e.pop()]=n:e.push(n)}}function xt(e){var t=["boolean","number","string","object"].indexOf(typeof e);return~t?null===e?1:Array.isArray(e)?5:t<3?t+2:t+3:Array.isArray(e)?5:void 0}function Et(e,t,n){if(e=e.filter((function(e){return _t(e.doc,t.selector,n)})),t.sort){var r=function(e){function t(t){return e.map((function(e){var n=ot(lt(e));return it(t,n)}))}return function(e,n){var r=ft(t(e.doc),t(n.doc));return 0!==r?r:function(e,t){return e<t?-1:e>t?1:0}(e.doc._id,n.doc._id)}}(t.sort);e=e.sort(r),"string"!=typeof t.sort[0]&&"desc"===function(e){return e[lt(e)]}(t.sort[0])&&(e=e.reverse())}if("limit"in t||"skip"in t){var i=t.skip||0,o=("limit"in t?t.limit:e.length)+i;e=e.slice(i,o)}return e}function _t(e,t,n){return n.every((function(n){var r=t[n],i=ot(n),o=it(e,i);return at(n)?function(e,t,n){return"$or"===e?t.some((function(e){return _t(n,e,Object.keys(e))})):"$not"===e?!_t(n,t,Object.keys(t)):!t.find((function(e){return _t(n,e,Object.keys(e))}))}(n,r,e):wt(r,e,i,o)}))}function wt(e,t,n,r){return!e||("object"==typeof e?Object.keys(e).every((function(i){var o=e[i];return function(e,t,n,r,i){if(!Ct[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return Ct[e](t,n,r,i)}(i,t,o,n,r)})):e===r)}function St(e){return null!=e}function Tt(e){return void 0!==e}function kt(e,t){return t.some((function(t){return e instanceof Array?e.indexOf(t)>-1:e===t}))}var Ct={$elemMatch:function(e,t,n,r){return!!Array.isArray(r)&&0!==r.length&&("object"==typeof r[0]?r.some((function(e){return _t(e,t,Object.keys(t))})):r.some((function(r){return wt(t,e,n,r)})))},$allMatch:function(e,t,n,r){return!!Array.isArray(r)&&0!==r.length&&("object"==typeof r[0]?r.every((function(e){return _t(e,t,Object.keys(t))})):r.every((function(r){return wt(t,e,n,r)})))},$eq:function(e,t,n,r){return Tt(r)&&0===ft(r,t)},$gte:function(e,t,n,r){return Tt(r)&&ft(r,t)>=0},$gt:function(e,t,n,r){return Tt(r)&&ft(r,t)>0},$lte:function(e,t,n,r){return Tt(r)&&ft(r,t)<=0},$lt:function(e,t,n,r){return Tt(r)&&ft(r,t)<0},$exists:function(e,t,n,r){return t?Tt(r):!Tt(r)},$mod:function(e,t,n,r){return St(r)&&function(e,t){var n=t[0],r=t[1];if(0===n)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(n,10)!==n)throw new Error("Divisor is not an integer");if(parseInt(r,10)!==r)throw new Error("Modulus is not an integer");return parseInt(e,10)===e&&e%n===r}(r,t)},$ne:function(e,t,n,r){return t.every((function(e){return 0!==ft(r,e)}))},$in:function(e,t,n,r){return St(r)&&kt(r,t)},$nin:function(e,t,n,r){return St(r)&&!kt(r,t)},$size:function(e,t,n,r){return St(r)&&function(e,t){return e.length===t}(r,t)},$all:function(e,t,n,r){return Array.isArray(r)&&function(e,t){return t.every((function(t){return e.indexOf(t)>-1}))}(r,t)},$regex:function(e,t,n,r){return St(r)&&function(e,t){return new RegExp(t).test(e)}(r,t)},$type:function(e,t,n,r){return function(e,t){switch(t){case"null":return null===e;case"boolean":return"boolean"==typeof e;case"number":return"number"==typeof e;case"string":return"string"==typeof e;case"array":return e instanceof Array;case"object":return"[object Object]"==={}.toString.call(e)}throw new Error(t+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}(r,t)}};function At(e,t){if(e.selector&&e.filter&&"_selector"!==e.filter){var n="string"==typeof e.filter?e.filter:"function";return t(new Error('selector invalid for filter "'+n+'"'))}t()}function jt(e){e.view&&!e.filter&&(e.filter="_view"),e.selector&&!e.filter&&(e.filter="_selector"),e.filter&&"string"==typeof e.filter&&("_view"===e.filter?e.view=oe(e.view):e.filter=oe(e.filter))}function It(e,t){return t.filter&&"string"==typeof t.filter&&!t.doc_ids&&!re(e.db)}function Ot(e,t){var n=t.complete;if("_view"===t.filter){if(!t.view||"string"!=typeof t.view){var r=Q(K,"`view` filter parameter not found or invalid.");return n(r)}var i=ie(t.view);e.db.get("_design/"+i[0],(function(r,o){if(e.isCancelled)return n(null,{status:"cancelled"});if(r)return n(Z(r));var s=o&&o.views&&o.views[i[1]]&&o.views[i[1]].map;if(!s)return n(Q(B,o.views?"missing json key: "+i[1]:"missing json key: views"));t.filter=function(e){return de(["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+e+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n"),{})}(s),e.doChanges(t)}))}else if(t.selector)t.filter=function(e){return function(e,t){if("object"!=typeof t)throw new Error("Selector error: expected a JSON object");var n=Et([{doc:e}],{selector:t=pt(t)},Object.keys(t));return n&&1===n.length}(e,t.selector)},e.doChanges(t);else{var o=ie(t.filter);e.db.get("_design/"+o[0],(function(r,i){if(e.isCancelled)return n(null,{status:"cancelled"});if(r)return n(Z(r));var s=i&&i.filters&&i.filters[o[1]];if(!s)return n(Q(B,i&&i.filters?"missing json key: "+o[1]:"missing json key: filters"));t.filter=function(e){return de('"use strict";\nreturn '+e+";",{})}(s),e.doChanges(t)}))}}function Nt(e){return e.reduce((function(e,t){return e[t]=!0,e}),{})}Ze.plugin((function(e){e._changesFilterPlugin={validate:At,normalize:jt,shouldFilter:It,filter:Ot}})),Ze.version="7.2.1";var Rt=Nt(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),Pt=Nt(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function Dt(e){if(!/^\d+-/.test(e))return Q(X);var t=e.indexOf("-"),n=e.substring(0,t),r=e.substring(t+1);return{prefix:parseInt(n,10),id:r}}function Mt(e,t,n){var r,i,o;n||(n={deterministic_revs:!0});var s={status:"available"};if(e._deleted&&(s.deleted=!0),t)if(e._id||(e._id=Ae()),i=Ce(e,n.deterministic_revs),e._rev){if((o=Dt(e._rev)).error)return o;e._rev_tree=[{pos:o.prefix,ids:[o.id,{status:"missing"},[[i,s,[]]]]}],r=o.prefix+1}else e._rev_tree=[{pos:1,ids:[i,s,[]]}],r=1;else if(e._revisions&&(e._rev_tree=function(e,t){for(var n=e.start-e.ids.length+1,r=e.ids,i=[r[0],t,[]],o=1,s=r.length;o<s;o++)i=[r[o],{status:"missing"},[i]];return[{pos:n,ids:i}]}(e._revisions,s),r=e._revisions.start,i=e._revisions.ids[0]),!e._rev_tree){if((o=Dt(e._rev)).error)return o;r=o.prefix,i=o.id,e._rev_tree=[{pos:r,ids:[i,s,[]]}]}ne(e._id),e._rev=r+"-"+i;var a={metadata:{},data:{}};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){var c="_"===l[0];if(c&&!Rt[l]){var u=Q(W,l);throw u.message=W.message+": "+l,u}c&&!Pt[l]?a.metadata[l.slice(1)]=e[l]:a.data[l]=e[l]}return a}function Lt(e,t,n){var r=function(e){try{return he(e)}catch(e){return{error:Q(V,"Attachment is not a valid base64 string")}}}(e.data);if(r.error)return n(r.error);e.length=r.length,e.data="blob"===t?ve(r,e.content_type):"base64"===t?fe(r):r,Te(r,(function(t){e.digest="md5-"+t,n()}))}function Bt(e,t,n){if(e.stub)return n();"string"==typeof e.data?Lt(e,t,n):function(e,t,n){Te(e.data,(function(r){e.digest="md5-"+r,e.length=e.data.size||e.data.length||0,"binary"===t?xe(e.data,(function(t){e.data=t,n()})):"base64"===t?Ee(e.data,(function(t){e.data=t,n()})):n()}))}(e,t,n)}function Ft(e,t,n,r,i,o,s,a){if(function(e,t){for(var n,r=e.slice(),i=t.split("-"),o=parseInt(i[0],10),s=i[1];n=r.pop();){if(n.pos===o&&n.ids[0]===s)return!0;for(var a=n.ids[2],l=0,c=a.length;l<c;l++)r.push({pos:n.pos+1,ids:a[l]})}return!1}(t.rev_tree,n.metadata.rev)&&!a)return r[i]=n,o();var l=t.winningRev||je(t),c="deleted"in t?t.deleted:qe(t,l),u="deleted"in n.metadata?n.metadata.deleted:qe(n.metadata),d=/^1-/.test(n.metadata.rev);if(c&&!u&&a&&d){var p=n.data;p._rev=l,p._id=n.metadata.id,n=Mt(p,a)}var h=He(t.rev_tree,n.metadata.rev_tree[0],e);if(a&&(c&&u&&"new_leaf"!==h.conflicts||!c&&"new_leaf"!==h.conflicts||c&&!u&&"new_branch"===h.conflicts)){var f=Q(F);return r[i]=f,o()}var g=n.metadata.rev;n.metadata.rev_tree=h.tree,n.stemmedRevs=h.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);var m=je(n.metadata),v=qe(n.metadata,m),y=c===v?0:c<v?-1:1;s(n,m,v,g===m?v:qe(n.metadata,g),!0,y,i,o)}var Ut="document-store",Ht="by-sequence",Gt="attach-store",qt="attach-seq-store",Vt="meta-store",zt="local-store",Wt="detect-blob-support";function Kt(e){try{return JSON.stringify(e)}catch(t){return u.stringify(e)}}function $t(e){return function(t){var n="unknown_error";t.target&&t.target.error&&(n=t.target.error.name||t.target.error.message),e(Q(Y,n,t.type))}}function Yt(e,t,n){return{data:Kt(e),winningRev:t,deletedOrLocal:n?"1":"0",seq:e.seq,id:e.id}}function Xt(e){if(!e)return null;var t=function(e){try{return JSON.parse(e)}catch(t){return u.parse(e)}}(e.data);return t.winningRev=e.winningRev,t.deleted="1"===e.deletedOrLocal,t.seq=e.seq,t}function Jt(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function Qt(e,t,n,r){n?r(e?"string"!=typeof e?e:ye(e,t):ge([""],{type:t})):e?"string"!=typeof e?be(e,(function(e){r(fe(e))})):r(e):r("")}function Zt(e,t,n,r){var i=Object.keys(e._attachments||{});if(!i.length)return r&&r();var o=0;function s(){++o===i.length&&r&&r()}i.forEach((function(r){t.attachments&&t.include_docs?function(e,t){var r=e._attachments[t],i=r.digest;n.objectStore(Gt).get(i).onsuccess=function(e){r.body=e.target.result.body,s()}}(e,r):(e._attachments[r].stub=!0,s())}))}function en(e,t){return Promise.all(e.map((function(e){if(e.doc&&e.doc._attachments){var n=Object.keys(e.doc._attachments);return Promise.all(n.map((function(n){var r=e.doc._attachments[n];if("body"in r){var i=r.body,o=r.content_type;return new Promise((function(s){Qt(i,o,t,(function(t){e.doc._attachments[n]=D(T(r,["digest","content_type"]),{data:t}),s()}))}))}})))}})))}function tn(e,t,n){var r=[],i=n.objectStore(Ht),o=n.objectStore(Gt),s=n.objectStore(qt),a=e.length;function l(){--a||r.length&&r.forEach((function(e){s.index("digestSeq").count(IDBKeyRange.bound(e+"::",e+"::",!1,!1)).onsuccess=function(t){t.target.result||o.delete(e)}}))}e.forEach((function(e){var n=i.index("_doc_id_rev"),o=t+"::"+e;n.getKey(o).onsuccess=function(e){var t=e.target.result;if("number"!=typeof t)return l();i.delete(t),s.index("seq").openCursor(IDBKeyRange.only(t)).onsuccess=function(e){var t=e.target.result;if(t){var n=t.value.digestSeq.split("::")[0];r.push(n),s.delete(t.primaryKey),t.continue()}else l()}}}))}function nn(e,t,n){try{return{txn:e.transaction(t,n)}}catch(e){return{error:e}}}var rn=new O;function on(e,t,n,r,i,o){for(var a,l,c,u,d,p,h,f,g=t.docs,m=0,v=g.length;m<v;m++){var y=g[m];y._id&&Ve(y._id)||(y=g[m]=Mt(y,n.new_edits,e)).error&&!h&&(h=y)}if(h)return o(h);var b=!1,x=0,E=new Array(g.length),_=new s,w=!1,S=r._meta.blobSupport?"blob":"base64";function T(){b=!0,k()}function k(){f&&b&&(f.docCount+=x,p.put(f))}function C(){w||(rn.notify(r._meta.name),o(null,E))}function A(e,t,n,r,i,o,s,a){e.metadata.winningRev=t,e.metadata.deleted=n;var l=e.data;if(l._id=e.metadata.id,l._rev=e.metadata.rev,r&&(l._deleted=!0),l._attachments&&Object.keys(l._attachments).length)return function(e,t,n,r,i,o){var s=e.data,a=0,l=Object.keys(s._attachments);function c(){a===l.length&&j(e,t,n,r,i,o)}function d(){a++,c()}l.forEach((function(n){var r=e.data._attachments[n];if(r.stub)a++,c();else{var i=r.data;delete r.data,r.revpos=parseInt(t,10),function(e,t,n){u.count(e).onsuccess=function(r){if(r.target.result)return n();var i={digest:e,body:t};u.put(i).onsuccess=n}}(r.digest,i,d)}}))}(e,t,n,i,s,a);x+=o,k(),j(e,t,n,i,s,a)}function j(e,t,n,i,o,s){var u=e.data,p=e.metadata;function h(o){var s=e.stemmedRevs||[];i&&r.auto_compaction&&(s=s.concat(function(e){var t=[];return Ie(e.rev_tree,(function(e,n,r,i,o){"available"!==o.status||e||(t.push(n+"-"+r),o.status="missing")})),t}(e.metadata))),s&&s.length&&tn(s,e.metadata.id,a),p.seq=o.target.result;var c=Yt(p,t,n);l.put(c).onsuccess=f}function f(){E[o]={ok:!0,id:p.id,rev:p.rev},_.set(e.metadata.id,e.metadata),function(e,t,n){var r=0,i=Object.keys(e.data._attachments||{});if(!i.length)return n();function o(){++r===i.length&&n()}function s(n){var r=e.data._attachments[n].digest,i=d.put({seq:t,digestSeq:r+"::"+t});i.onsuccess=o,i.onerror=function(e){e.preventDefault(),e.stopPropagation(),o()}}for(var a=0;a<i.length;a++)s(i[a])}(e,p.seq,s)}u._doc_id_rev=p.id+"::"+p.rev,delete u._id,delete u._rev;var g=c.put(u);g.onsuccess=h,g.onerror=function(e){e.preventDefault(),e.stopPropagation(),c.index("_doc_id_rev").getKey(u._doc_id_rev).onsuccess=function(e){c.put(u,e.target.result).onsuccess=h}}}!function(e,t,n){if(!e.length)return n();var r,i=0;function o(){i++,e.length===i&&(r?n(r):n())}e.forEach((function(e){var n=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],i=0;if(!n.length)return o();function s(e){r=e,++i===n.length&&o()}for(var a in e.data._attachments)e.data._attachments.hasOwnProperty(a)&&Bt(e.data._attachments[a],t,s)}))}(g,S,(function(t){if(t)return o(t);!function(){var t=nn(i,[Ut,Ht,Gt,zt,qt,Vt],"readwrite");if(t.error)return o(t.error);(a=t.txn).onabort=$t(o),a.ontimeout=$t(o),a.oncomplete=C,l=a.objectStore(Ut),c=a.objectStore(Ht),u=a.objectStore(Gt),d=a.objectStore(qt),(p=a.objectStore(Vt)).get(Vt).onsuccess=function(e){f=e.target.result,k()},function(e){var t=[];if(g.forEach((function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach((function(n){var r=e.data._attachments[n];r.stub&&t.push(r.digest)}))})),!t.length)return e();var n,r=0;t.forEach((function(i){!function(e,t){u.get(e).onsuccess=function(n){if(n.target.result)t();else{var r=Q(J,"unknown stub attachment with digest "+e);r.status=412,t(r)}}}(i,(function(i){i&&!n&&(n=i),++r===t.length&&e(n)}))}))}((function(t){if(t)return w=!0,o(t);!function(){if(g.length)for(var t=0,i=0,o=g.length;i<o;i++){var c=g[i];if(c._id&&Ve(c._id))u();else l.get(c.metadata.id).onsuccess=d}function u(){++t===g.length&&function(e,t,n,r,i,o,a,l,c){e=e||1e3;var u=l.new_edits,d=new s,p=0,h=t.length;function f(){++p===h&&c&&c()}t.forEach((function(e,t){if(e._id&&Ve(e._id)){var r=e._deleted?"_removeLocal":"_putLocal";n[r](e,{ctx:i},(function(e,n){o[t]=e||n,f()}))}else{var s=e.metadata.id;d.has(s)?(h--,d.get(s).push([e,t])):d.set(s,[[e,t]])}})),d.forEach((function(t,n){var i=0;function s(){++i<t.length?c():f()}function c(){var c=t[i],d=c[0],p=c[1];if(r.has(n))Ft(e,r.get(n),d,o,p,s,a,u);else{var h=He([],d.metadata.rev_tree[0],e);d.metadata.rev_tree=h.tree,d.stemmedRevs=h.stemmedRevs||[],function(e,t,n){var r=je(e.metadata),i=qe(e.metadata,r);if("was_delete"in l&&i)return o[t]=Q(B,"deleted"),n();if(u&&function(e){return"missing"===e.metadata.rev_tree[0].ids[1].status}(e)){var s=Q(F);return o[t]=s,n()}a(e,r,i,i,!1,i?0:1,t,n)}(d,p,s)}}c()}))}(e.revs_limit,g,r,_,a,E,A,n,T)}function d(e){var t=Xt(e.target.result);t&&_.set(t.id,t),u()}}()}))}()}))}function sn(e,t,n,r,i){var o,s,a;function l(e){s=e.target.result,o&&i(o,s,a)}function c(e){o=e.target.result,s&&i(o,s,a)}function u(e){var t=e.target.result;if(!t)return i();i([t.key],[t.value],t)}-1===r&&(r=1e3),"function"==typeof e.getAll&&"function"==typeof e.getAllKeys&&r>1&&!n?(a={continue:function(){if(!o.length)return i();var n,a=o[o.length-1];if(t&&t.upper)try{n=IDBKeyRange.bound(a,t.upper,!0,t.upperOpen)}catch(e){if("DataError"===e.name&&0===e.code)return i()}else n=IDBKeyRange.lowerBound(a,!0);t=n,o=null,s=null,e.getAll(t,r).onsuccess=l,e.getAllKeys(t,r).onsuccess=c}},e.getAll(t,r).onsuccess=l,e.getAllKeys(t,r).onsuccess=c):n?e.openCursor(t,"prev").onsuccess=u:e.openCursor(t).onsuccess=u}function an(e,t,n){var r,i,o="startkey"in e&&e.startkey,s="endkey"in e&&e.endkey,a="key"in e&&e.key,l="keys"in e&&e.keys,c=e.skip||0,u="number"==typeof e.limit?e.limit:-1,d=!1!==e.inclusive_end;if(!l&&(i=(r=function(e,t,n,r,i){try{if(e&&t)return i?IDBKeyRange.bound(t,e,!n,!1):IDBKeyRange.bound(e,t,!1,!n);if(e)return i?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return i?IDBKeyRange.lowerBound(t,!n):IDBKeyRange.upperBound(t,!n);if(r)return IDBKeyRange.only(r)}catch(e){return{error:e}}return null}(o,s,d,a,e.descending))&&r.error)&&("DataError"!==i.name||0!==i.code))return n(Q(Y,i.name,i.message));var p=[Ut,Ht,Vt];e.attachments&&p.push(Gt);var h=nn(t,p,"readonly");if(h.error)return n(h.error);var f=h.txn;f.oncomplete=function(){e.attachments?en(E,e.binary).then(T):T()},f.onabort=$t(n);var g,m,v=f.objectStore(Ut),y=f.objectStore(Ht),b=f.objectStore(Vt),x=y.index("_doc_id_rev"),E=[];function _(t,n){var r={id:n.id,key:n.id,value:{rev:t}};n.deleted?l&&(E.push(r),r.value.deleted=!0,r.doc=null):c--<=0&&(E.push(r),e.include_docs&&function(t,n,r){var i=t.id+"::"+r;x.get(i).onsuccess=function(r){if(n.doc=Jt(r.target.result)||{},e.conflicts){var i=Re(t);i.length&&(n.doc._conflicts=i)}Zt(n.doc,e,f)}}(n,r,t))}function w(e){for(var t=0,n=e.length;t<n&&E.length!==u;t++){var r=e[t];if(r.error&&l)E.push(r);else{var i=Xt(r);_(i.winningRev,i)}}}function S(e,t,n){n&&(w(t),E.length<u&&n.continue())}function T(){var t={total_rows:g,offset:e.skip,rows:E};e.update_seq&&void 0!==m&&(t.update_seq=m),n(null,t)}return b.get(Vt).onsuccess=function(e){g=e.target.result.docCount},e.update_seq&&function(e,t){e.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result,n=void 0;return t&&t.key&&(n=t.key),function(e){e.target.result&&e.target.result.length>0&&(m=e.target.result[0])}({target:{result:[n]}})}}(y),i||0===u?void 0:l?function(e,t,n){var r=new Array(e.length),i=0;e.forEach((function(o,s){t.get(o).onsuccess=function(t){t.target.result?r[s]=t.target.result:r[s]={key:o,error:"not_found"},++i===e.length&&n(e,r,{})}}))}(e.keys,v,S):-1===u?function(e,t,n){if("function"!=typeof e.getAll){var r=[];e.openCursor(t).onsuccess=function(e){var t=e.target.result;t?(r.push(t.value),t.continue()):n({target:{result:r}})}}else e.getAll(t).onsuccess=n}(v,r,(function(t){var n=t.target.result;e.descending&&(n=n.reverse()),w(n)})):void sn(v,r,e.descending,u+c,S)}var ln=!1,cn=[];function un(){!ln&&cn.length&&(ln=!0,cn.shift()())}var dn,pn=new s,hn=new s;function fn(e,t){var n=this;!function(e,t,n){cn.push((function(){e((function(e,r){(function(e,t,n,r){try{e(t,n)}catch(t){r.emit("error",t)}})(t,e,r,n),ln=!1,a((function(){un()}))}))})),un()}((function(t){!function(e,t,n){var r=t.name,i=null;function l(e,t){var n=e.objectStore(Ut);n.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),n.openCursor().onsuccess=function(e){var r=e.target.result;if(r){var i=r.value,o=qe(i);i.deletedOrLocal=o?"1":"0",n.put(i),r.continue()}else t()}}function c(e,t){var n=e.objectStore(zt),r=e.objectStore(Ut),i=e.objectStore(Ht);r.openCursor().onsuccess=function(e){var o=e.target.result;if(o){var s=o.value,a=s.id,l=Ve(a),c=je(s);if(l){var u=a+"::"+c,d=a+"::",p=a+"::~",h=i.index("_doc_id_rev"),f=IDBKeyRange.bound(d,p,!1,!1),g=h.openCursor(f);g.onsuccess=function(e){if(g=e.target.result){var t=g.value;t._doc_id_rev===u&&n.put(t),i.delete(g.primaryKey),g.continue()}else r.delete(o.primaryKey),o.continue()}}else o.continue()}else t&&t()}}function u(e,t){var n=e.objectStore(Ht),r=e.objectStore(Gt),i=e.objectStore(qt);r.count().onsuccess=function(e){if(!e.target.result)return t();n.openCursor().onsuccess=function(e){var n=e.target.result;if(!n)return t();for(var r=n.value,o=n.primaryKey,s=Object.keys(r._attachments||{}),a={},l=0;l<s.length;l++)a[r._attachments[s[l]].digest]=!0;var c=Object.keys(a);for(l=0;l<c.length;l++){var u=c[l];i.put({seq:o,digestSeq:u+"::"+o})}n.continue()}}}function d(e){var t=e.objectStore(Ht),n=e.objectStore(Ut);n.openCursor().onsuccess=function(e){var r=e.target.result;if(r){var i,o,s,a,l,c=(i=r.value).data?Xt(i):(i.deleted="1"===i.deletedOrLocal,i);if(c.winningRev=c.winningRev||je(c),c.seq)return u();o=c.id+"::",s=c.id+"::",a=t.index("_doc_id_rev").openCursor(IDBKeyRange.bound(o,s)),l=0,a.onsuccess=function(e){var t=e.target.result;if(!t)return c.seq=l,u();var n=t.primaryKey;n>l&&(l=n),t.continue()}}function u(){var e=Yt(c,c.winningRev,c.deleted);n.put(e).onsuccess=function(){r.continue()}}}}e._meta=null,e._remote=!1,e.type=function(){return"idb"},e._id=w((function(t){t(null,e._meta.instanceId)})),e._bulkDocs=function(n,r,o){on(t,n,r,e,i,o)},e._get=function(e,t,n){var r,o,s,a=t.ctx;if(!a){var l=nn(i,[Ut,Ht,Gt],"readonly");if(l.error)return n(l.error);a=l.txn}function c(){n(s,{doc:r,metadata:o,ctx:a})}a.objectStore(Ut).get(e).onsuccess=function(e){if(!(o=Xt(e.target.result)))return s=Q(B,"missing"),c();var n;if(t.rev)n=t.latest?function(e,t){for(var n,r=t.rev_tree.slice();n=r.pop();){var i=n.pos,o=n.ids,s=o[0],a=o[1],l=o[2],c=0===l.length,u=n.history?n.history.slice():[];if(u.push({id:s,pos:i,opts:a}),c)for(var d=0,p=u.length;d<p;d++){var h=u[d];if(h.pos+"-"+h.id===e)return i+"-"+s}for(var f=0,g=l.length;f<g;f++)r.push({pos:i+1,ids:l[f],history:u})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}(t.rev,o):t.rev;else if(n=o.winningRev,qe(o))return s=Q(B,"deleted"),c();var i=a.objectStore(Ht),l=o.id+"::"+n;i.index("_doc_id_rev").get(l).onsuccess=function(e){if((r=e.target.result)&&(r=Jt(r)),!r)return s=Q(B,"missing"),c();c()}}},e._getAttachment=function(e,t,n,r,o){var s;if(r.ctx)s=r.ctx;else{var a=nn(i,[Ut,Ht,Gt],"readonly");if(a.error)return o(a.error);s=a.txn}var l=n.digest,c=n.content_type;s.objectStore(Gt).get(l).onsuccess=function(e){Qt(e.target.result.body,c,r.binary,(function(e){o(null,e)}))}},e._info=function(t){var n,r,o=nn(i,[Vt,Ht],"readonly");if(o.error)return t(o.error);var s=o.txn;s.objectStore(Vt).get(Vt).onsuccess=function(e){r=e.target.result.docCount},s.objectStore(Ht).openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;n=t?t.key:0},s.oncomplete=function(){t(null,{doc_count:r,update_seq:n,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(e,t){an(e,i,t)},e._changes=function(t){return function(e,t,n,r){if((e=E(e)).continuous){var i=n+":"+Ae();return rn.addListener(n,i,t,e),rn.notify(n),{cancel:function(){rn.removeListener(n,i)}}}var a=e.doc_ids&&new o(e.doc_ids);e.since=e.since||0;var l=e.since,c="limit"in e?e.limit:-1;0===c&&(c=1);var u,d,p,h,f=[],g=0,m=ee(e),v=new s;function y(e,t,n,r){if(n.seq!==t)return r();if(n.winningRev===e._rev)return r(n,e);var i=e._id+"::"+n.winningRev;h.get(i).onsuccess=function(e){r(n,Jt(e.target.result))}}function b(){e.complete(null,{results:f,last_seq:l})}var x=[Ut,Ht];e.attachments&&x.push(Gt);var _=nn(r,x,"readonly");if(_.error)return e.complete(_.error);(u=_.txn).onabort=$t(e.complete),u.oncomplete=function(){!e.continuous&&e.attachments?en(f).then(b):b()},d=u.objectStore(Ht),p=u.objectStore(Ut),h=d.index("_doc_id_rev"),sn(d,e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null,e.descending,c,(function(t,n,r){if(r&&t.length){var i=new Array(t.length),o=new Array(t.length),s=0;n.forEach((function(n,l){!function(e,t,n){if(a&&!a.has(e._id))return n();var r=v.get(e._id);if(r)return y(e,t,r,n);p.get(e._id).onsuccess=function(i){r=Xt(i.target.result),v.set(e._id,r),y(e,t,r,n)}}(Jt(n),t[l],(function(n,a){o[l]=n,i[l]=a,++s===t.length&&function(){for(var t=[],n=0,s=i.length;n<s&&g!==c;n++){var a=i[n];if(a){var l=o[n];t.push(d(l,a))}}Promise.all(t).then((function(t){for(var n=0,r=t.length;n<r;n++)t[n]&&e.onChange(t[n])})).catch(e.complete),g!==c&&r.continue()}()}))}))}function d(t,n){var r=e.processChange(n,t,e);l=r.seq=t.seq;var i=m(r);return"object"==typeof i?Promise.reject(i):i?(g++,e.return_docs&&f.push(r),e.attachments&&e.include_docs?new Promise((function(t){Zt(n,e,u,(function(){en([r],e.binary).then((function(){t(r)}))}))})):Promise.resolve(r)):Promise.resolve()}}))}(t,e,r,i)},e._close=function(e){i.close(),pn.delete(r),e()},e._getRevisionTree=function(e,t){var n=nn(i,[Ut],"readonly");if(n.error)return t(n.error);n.txn.objectStore(Ut).get(e).onsuccess=function(e){var n=Xt(e.target.result);n?t(null,n.rev_tree):t(Q(B))}},e._doCompaction=function(e,t,n){var r=nn(i,[Ut,Ht,Gt,qt],"readwrite");if(r.error)return n(r.error);var o=r.txn;o.objectStore(Ut).get(e).onsuccess=function(n){var r=Xt(n.target.result);Ie(r.rev_tree,(function(e,n,r,i,o){var s=n+"-"+r;-1!==t.indexOf(s)&&(o.status="missing")})),tn(t,e,o);var i=r.winningRev,s=r.deleted;o.objectStore(Ut).put(Yt(r,i,s))},o.onabort=$t(n),o.oncomplete=function(){n()}},e._getLocal=function(e,t){var n=nn(i,[zt],"readonly");if(n.error)return t(n.error);var r=n.txn.objectStore(zt).get(e);r.onerror=$t(t),r.onsuccess=function(e){var n=e.target.result;n?(delete n._doc_id_rev,t(null,n)):t(Q(B))}},e._putLocal=function(e,t,n){"function"==typeof t&&(n=t,t={}),delete e._revisions;var r=e._rev,o=e._id;e._rev=r?"0-"+(parseInt(r.split("-")[1],10)+1):"0-1";var s,a=t.ctx;if(!a){var l=nn(i,[zt],"readwrite");if(l.error)return n(l.error);(a=l.txn).onerror=$t(n),a.oncomplete=function(){s&&n(null,s)}}var c,u=a.objectStore(zt);r?(c=u.get(o)).onsuccess=function(i){var o=i.target.result;o&&o._rev===r?u.put(e).onsuccess=function(){s={ok:!0,id:e._id,rev:e._rev},t.ctx&&n(null,s)}:n(Q(F))}:((c=u.add(e)).onerror=function(e){n(Q(F)),e.preventDefault(),e.stopPropagation()},c.onsuccess=function(){s={ok:!0,id:e._id,rev:e._rev},t.ctx&&n(null,s)})},e._removeLocal=function(e,t,n){"function"==typeof t&&(n=t,t={});var r,o=t.ctx;if(!o){var s=nn(i,[zt],"readwrite");if(s.error)return n(s.error);(o=s.txn).oncomplete=function(){r&&n(null,r)}}var a=e._id,l=o.objectStore(zt),c=l.get(a);c.onerror=$t(n),c.onsuccess=function(i){var o=i.target.result;o&&o._rev===e._rev?(l.delete(a),r={ok:!0,id:a,rev:"0-0"},t.ctx&&n(null,r)):n(Q(B))}},e._destroy=function(e,t){rn.removeAllListeners(r);var n=hn.get(r);n&&n.result&&(n.result.close(),pn.delete(r));var i=indexedDB.deleteDatabase(r);i.onsuccess=function(){hn.delete(r),I()&&r in localStorage&&delete localStorage[r],t(null,{ok:!0})},i.onerror=$t(t)};var p=pn.get(r);if(p)return i=p.idb,e._meta=p.global,a((function(){n(null,e)}));var h=indexedDB.open(r,5);hn.set(r,h),h.onupgradeneeded=function(e){var t=e.target.result;if(e.oldVersion<1)return function(e){var t=e.createObjectStore(Ut,{keyPath:"id"});e.createObjectStore(Ht,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.createObjectStore(Gt,{keyPath:"digest"}),e.createObjectStore(Vt,{keyPath:"id",autoIncrement:!1}),e.createObjectStore(Wt),t.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),e.createObjectStore(zt,{keyPath:"_id"});var n=e.createObjectStore(qt,{autoIncrement:!0});n.createIndex("seq","seq"),n.createIndex("digestSeq","digestSeq",{unique:!0})}(t);var n=e.currentTarget.transaction;e.oldVersion<3&&function(e){e.createObjectStore(zt,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}(t),e.oldVersion<4&&function(e){var t=e.createObjectStore(qt,{autoIncrement:!0});t.createIndex("seq","seq"),t.createIndex("digestSeq","digestSeq",{unique:!0})}(t);var r=[l,c,u,d],i=e.oldVersion;!function e(){var t=r[i-1];i++,t&&t(n,e)}()},h.onsuccess=function(t){(i=t.target.result).onversionchange=function(){i.close(),pn.delete(r)},i.onabort=function(e){N("error","Database has a global failure",e.target.error),i.close(),pn.delete(r)};var o,s,a,l,c=i.transaction([Vt,Wt,Ut],"readwrite"),u=!1;function d(){void 0!==a&&u&&(e._meta={name:r,instanceId:l,blobSupport:a},pn.set(r,{idb:i,global:e._meta}),n(null,e))}function p(){if(void 0!==s&&void 0!==o){var e=r+"_id";e in o?l=o[e]:o[e]=l=Ae(),o.docCount=s,c.objectStore(Vt).put(o)}}c.objectStore(Vt).get(Vt).onsuccess=function(e){o=e.target.result||{id:Vt},p()},function(e,t){e.objectStore(Ut).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(e){t(e.target.result)}}(c,(function(e){s=e,p()})),dn||(dn=function(e){return new Promise((function(t){var n=ge([""]),r=e.objectStore(Wt).put(n,"key");r.onsuccess=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)},r.onerror=e.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)}})).catch((function(){return!1}))}(c)),dn.then((function(e){a=e,d()})),c.oncomplete=function(){u=!0,d()},c.onabort=$t(n)},h.onerror=function(e){var t=e.target.error&&e.target.error.message;t?-1!==t.indexOf("stored database is a higher version")&&(t=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):t="Failed to open indexedDB, are you in private browsing mode?",N("error",t),n(Q(Y,t))}}(n,e,t)}),t,n.constructor)}fn.valid=function(){try{return"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}};var gn=5e3,mn={};function vn(e){var t=e.doc||e.ok,n=t&&t._attachments;n&&Object.keys(n).forEach((function(e){var t=n[e];t.data=ye(t.data,t.content_type)}))}function yn(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function bn(e){return e._attachments&&Object.keys(e._attachments)?Promise.all(Object.keys(e._attachments).map((function(t){var n=e._attachments[t];if(n.data&&"string"!=typeof n.data)return new Promise((function(e){Ee(n.data,e)})).then((function(e){n.data=e}))}))):Promise.resolve()}function xn(e,t){if(function(e){if(!e.prefix)return!1;var t=ue(e.prefix).protocol;return"http"===t||"https"===t}(t)){var n=t.name.substr(t.prefix.length);e=t.prefix.replace(/\/?$/,"/")+encodeURIComponent(n)}var r=ue(e);(r.user||r.password)&&(r.auth={username:r.user,password:r.password});var i=r.path.replace(/(^\/|\/$)/g,"").split("/");return r.db=i.pop(),-1===r.db.indexOf("%")&&(r.db=encodeURIComponent(r.db)),r.path=i.join("/"),r}function En(e,t){return _n(e,e.db+"/"+t)}function _n(e,t){var n=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+n+t}function wn(e){return"?"+Object.keys(e).map((function(t){return t+"="+encodeURIComponent(e[t])})).join("&")}function Sn(e,t){var r=this,i=xn(e.name,e),o=En(i,"");e=E(e);var s,l=function(t,n){if((n=n||{}).headers=n.headers||new nt,n.credentials="include",e.auth||i.auth){var r=e.auth||i.auth,o=r.username+":"+r.password,s=fe(unescape(encodeURIComponent(o)));n.headers.set("Authorization","Basic "+s)}var a=e.headers||{};return Object.keys(a).forEach((function(e){n.headers.append(e,a[e])})),function(e){var t="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=-1!==t.indexOf("msie"),r=-1!==t.indexOf("trident"),i=-1!==t.indexOf("edge"),o=!("method"in e)||"GET"===e.method;return(n||r||i)&&o}(n)&&(t+=(-1===t.indexOf("?")?"?":"&")+"_nonce="+Date.now()),(e.fetch||tt)(t,n)};function c(e,t){return S(e,d((function(e){p().then((function(){return t.apply(this,e)})).catch((function(t){e.pop()(t)}))}))).bind(r)}function u(e,t,n){var r={};return(t=t||{}).headers=t.headers||new nt,t.headers.get("Content-Type")||t.headers.set("Content-Type","application/json"),t.headers.get("Accept")||t.headers.set("Accept","application/json"),l(e,t).then((function(e){return r.ok=e.ok,r.status=e.status,e.json()})).then((function(e){if(r.data=e,!r.ok){r.data.status=r.status;var t=Z(r.data);if(n)return n(t);throw t}if(Array.isArray(r.data)&&(r.data=r.data.map((function(e){return e.error||e.missing?Z(e):e}))),!n)return r;n(null,r.data)}))}function p(){return e.skip_setup?Promise.resolve():s||((s=u(o).catch((function(e){return e&&e.status&&404===e.status?(P(404,"PouchDB is just detecting if the remote exists."),u(o,{method:"PUT"})):Promise.reject(e)})).catch((function(e){return!(!e||!e.status||412!==e.status)||Promise.reject(e)}))).catch((function(){s=null})),s)}function h(e){return e.split("/").map(encodeURIComponent).join("/")}a((function(){t(null,r)})),r._remote=!0,r.type=function(){return"http"},r.id=c("id",(function(e){l(_n(i,"")).then((function(e){return e.json()})).catch((function(){return{}})).then((function(t){var n=t&&t.uuid?t.uuid+i.db:En(i,"");e(null,n)}))})),r.compact=c("compact",(function(e,t){"function"==typeof e&&(t=e,e={}),e=E(e),u(En(i,"_compact"),{method:"POST"}).then((function(){!function n(){r.info((function(r,i){i&&!i.compact_running?t(null,{ok:!0}):setTimeout(n,e.interval||200)}))}()}))})),r.bulkGet=S("bulkGet",(function(e,t){var n=this;function r(t){var n={};e.revs&&(n.revs=!0),e.attachments&&(n.attachments=!0),e.latest&&(n.latest=!0),u(En(i,"_bulk_get"+wn(n)),{method:"POST",body:JSON.stringify({docs:e.docs})}).then((function(n){e.attachments&&e.binary&&n.data.results.forEach((function(e){e.docs.forEach(vn)})),t(null,n.data)})).catch(t)}function o(){var r=Math.ceil(e.docs.length/50),i=0,o=new Array(r);function s(e){return function(n,s){o[e]=s.results,++i===r&&t(null,{results:te(o)})}}for(var a=0;a<r;a++){var l=T(e,["revs","attachments","binary","latest"]);l.docs=e.docs.slice(50*a,Math.min(e.docs.length,50*(a+1))),j(n,l,s(a))}}var s=_n(i,""),a=mn[s];"boolean"!=typeof a?r((function(e,n){e?(mn[s]=!1,P(e.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),o()):(mn[s]=!0,t(null,n))})):a?r(t):o()})),r._info=function(e){p().then((function(){return l(En(i,""))})).then((function(e){return e.json()})).then((function(t){t.host=En(i,""),e(null,t)})).catch(e)},r.fetch=function(e,t){return p().then((function(){var n="/"===e.substring(0,1)?_n(i,e.substring(1)):En(i,e);return l(n,t)}))},r.get=c("get",(function(e,t,n){"function"==typeof t&&(n=t,t={});var r={};function o(e){var n=e._attachments,r=n&&Object.keys(n);if(n&&r.length)return function(e,t){return new Promise((function(n,r){var i,o=0,s=0,a=0,l=e.length;function c(){++a===l?i?r(i):n():p()}function u(){o--,c()}function d(e){o--,i=i||e,c()}function p(){for(;o<t&&s<l;)o++,e[s++]().then(u,d)}p()}))}(r.map((function(r){return function(){return function(r){var o=n[r],s=yn(e._id)+"/"+h(r)+"?rev="+e._rev;return l(En(i,s)).then((function(e){return"buffer"in e?e.buffer():e.blob()})).then((function(e){if(t.binary){var n=Object.getOwnPropertyDescriptor(e.__proto__,"type");return n&&!n.set||(e.type=o.content_type),e}return new Promise((function(t){Ee(e,t)}))})).then((function(e){delete o.stub,delete o.length,o.data=e}))}(r)}})),5)}(t=E(t)).revs&&(r.revs=!0),t.revs_info&&(r.revs_info=!0),t.latest&&(r.latest=!0),t.open_revs&&("all"!==t.open_revs&&(t.open_revs=JSON.stringify(t.open_revs)),r.open_revs=t.open_revs),t.rev&&(r.rev=t.rev),t.conflicts&&(r.conflicts=t.conflicts),t.update_seq&&(r.update_seq=t.update_seq),e=yn(e),u(En(i,e+wn(r))).then((function(e){return Promise.resolve().then((function(){if(t.attachments)return n=e.data,Array.isArray(n)?Promise.all(n.map((function(e){if(e.ok)return o(e.ok)}))):o(n);var n})).then((function(){n(null,e.data)}))})).catch((function(t){t.docId=e,n(t)}))})),r.remove=c("remove",(function(e,t,n,r){var o;"string"==typeof t?(o={_id:e,_rev:t},"function"==typeof n&&(r=n,n={})):(o=e,"function"==typeof t?(r=t,n={}):(r=n,n=t));var s=o._rev||n.rev;u(En(i,yn(o._id))+"?rev="+s,{method:"DELETE"},r).catch(r)})),r.getAttachment=c("getAttachment",(function(e,t,r,o){"function"==typeof r&&(o=r,r={});var s,a=r.rev?"?rev="+r.rev:"",c=En(i,yn(e))+"/"+h(t)+a;l(c,{method:"GET"}).then((function(e){if(s=e.headers.get("content-type"),e.ok)return void 0===n||n.browser||"function"!=typeof e.buffer?e.blob():e.buffer();throw e})).then((function(e){void 0===n||n.browser||(e.type=s),o(null,e)})).catch((function(e){o(e)}))})),r.removeAttachment=c("removeAttachment",(function(e,t,n,r){u(En(i,yn(e)+"/"+h(t))+"?rev="+n,{method:"DELETE"},r).catch(r)})),r.putAttachment=c("putAttachment",(function(e,t,n,r,o,s){"function"==typeof o&&(s=o,o=r,r=n,n=null);var a=yn(e)+"/"+h(t),l=En(i,a);if(n&&(l+="?rev="+n),"string"==typeof r){var c;try{c=he(r)}catch(e){return s(Q(V,"Attachment is not a valid base64 string"))}r=c?ve(c,o):""}u(l,{headers:new nt({"Content-Type":o}),method:"PUT",body:r},s).catch(s)})),r._bulkDocs=function(e,t,n){e.new_edits=t.new_edits,p().then((function(){return Promise.all(e.docs.map(bn))})).then((function(){return u(En(i,"_bulk_docs"),{method:"POST",body:JSON.stringify(e)},n)})).catch(n)},r._put=function(e,t,n){p().then((function(){return bn(e)})).then((function(){return u(En(i,yn(e._id)),{method:"PUT",body:JSON.stringify(e)})})).then((function(e){n(null,e.data)})).catch((function(t){t.docId=e&&e._id,n(t)}))},r.allDocs=c("allDocs",(function(e,t){"function"==typeof e&&(t=e,e={});var n,r={},o="GET";(e=E(e)).conflicts&&(r.conflicts=!0),e.update_seq&&(r.update_seq=!0),e.descending&&(r.descending=!0),e.include_docs&&(r.include_docs=!0),e.attachments&&(r.attachments=!0),e.key&&(r.key=JSON.stringify(e.key)),e.start_key&&(e.startkey=e.start_key),e.startkey&&(r.startkey=JSON.stringify(e.startkey)),e.end_key&&(e.endkey=e.end_key),e.endkey&&(r.endkey=JSON.stringify(e.endkey)),void 0!==e.inclusive_end&&(r.inclusive_end=!!e.inclusive_end),void 0!==e.limit&&(r.limit=e.limit),void 0!==e.skip&&(r.skip=e.skip);var s=wn(r);void 0!==e.keys&&(o="POST",n={keys:e.keys}),u(En(i,"_all_docs"+s),{method:o,body:JSON.stringify(n)}).then((function(n){e.include_docs&&e.attachments&&e.binary&&n.data.rows.forEach(vn),t(null,n.data)})).catch(t)})),r._changes=function(e){var t="batch_size"in e?e.batch_size:25;!(e=E(e)).continuous||"heartbeat"in e||(e.heartbeat=1e4);var n="timeout"in e?e.timeout:3e4;"timeout"in e&&e.timeout&&n-e.timeout<gn&&(n=e.timeout+gn),"heartbeat"in e&&e.heartbeat&&n-e.heartbeat<gn&&(n=e.heartbeat+gn);var r={};"timeout"in e&&e.timeout&&(r.timeout=e.timeout);var o=void 0!==e.limit&&e.limit,s=o;if(e.style&&(r.style=e.style),(e.include_docs||e.filter&&"function"==typeof e.filter)&&(r.include_docs=!0),e.attachments&&(r.attachments=!0),e.continuous&&(r.feed="longpoll"),e.seq_interval&&(r.seq_interval=e.seq_interval),e.conflicts&&(r.conflicts=!0),e.descending&&(r.descending=!0),e.update_seq&&(r.update_seq=!0),"heartbeat"in e&&e.heartbeat&&(r.heartbeat=e.heartbeat),e.filter&&"string"==typeof e.filter&&(r.filter=e.filter),e.view&&"string"==typeof e.view&&(r.filter="_view",r.view=e.view),e.query_params&&"object"==typeof e.query_params)for(var l in e.query_params)e.query_params.hasOwnProperty(l)&&(r[l]=e.query_params[l]);var c,d="GET";e.doc_ids?(r.filter="_doc_ids",d="POST",c={doc_ids:e.doc_ids}):e.selector&&(r.filter="_selector",d="POST",c={selector:e.selector});var h,f=new et,g=function(n,a){if(!e.aborted){r.since=n,"object"==typeof r.since&&(r.since=JSON.stringify(r.since)),e.descending?o&&(r.limit=s):r.limit=!o||s>t?t:s;var l=En(i,"_changes"+wn(r)),g={signal:f.signal,method:d,body:JSON.stringify(c)};h=n,e.aborted||p().then((function(){return u(l,g,a)})).catch(a)}},m={results:[]},v=function(n,r){if(!e.aborted){var i=0;if(r&&r.results){i=r.results.length,m.last_seq=r.last_seq;var l=null,c=null;"number"==typeof r.pending&&(l=r.pending),"string"!=typeof m.last_seq&&"number"!=typeof m.last_seq||(c=m.last_seq),e.query_params,r.results=r.results.filter((function(t){s--;var n=ee(e)(t);return n&&(e.include_docs&&e.attachments&&e.binary&&vn(t),e.return_docs&&m.results.push(t),e.onChange(t,l,c)),n}))}else if(n)return e.aborted=!0,void e.complete(n);r&&r.last_seq&&(h=r.last_seq);var u=o&&s<=0||r&&i<t||e.descending;(!e.continuous||o&&s<=0)&&u?e.complete(null,m):a((function(){g(h,v)}))}};return g(e.since||0,v),{cancel:function(){e.aborted=!0,f.abort()}}},r.revsDiff=c("revsDiff",(function(e,t,n){"function"==typeof t&&(n=t,t={}),u(En(i,"_revs_diff"),{method:"POST",body:JSON.stringify(e)},n).catch(n)})),r._close=function(e){e()},r._destroy=function(e,t){u(En(i,""),{method:"DELETE"}).then((function(e){t(null,e)})).catch((function(e){404===e.status?t(null,{ok:!0}):t(e)}))}}function Tn(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Tn)}catch(e){}}function kn(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,kn)}catch(e){}}function Cn(e){this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Cn)}catch(e){}}function An(e,t){return t&&e.then((function(e){a((function(){t(null,e)}))}),(function(e){a((function(){t(e)}))})),e}function jn(e){return d((function(t){var n=t.pop(),r=e.apply(this,t);return"function"==typeof n&&An(r,n),r}))}function In(e,t){return function(){var n=arguments,r=this;return e.add((function(){return t.apply(r,n)}))}}function On(e){var t=new o(e),n=new Array(t.size),r=-1;return t.forEach((function(e){n[++r]=e})),n}function Nn(e){var t=new Array(e.size),n=-1;return e.forEach((function(e,r){t[++n]=r})),t}function Rn(e){return new Cn("builtin "+e+" function requires map values to be numbers or number arrays")}function Pn(e){for(var t=0,n=0,r=e.length;n<r;n++){var i=e[n];if("number"!=typeof i){if(!Array.isArray(i))throw Rn("_sum");t="number"==typeof t?[t]:t;for(var o=0,s=i.length;o<s;o++){var a=i[o];if("number"!=typeof a)throw Rn("_sum");void 0===t[o]?t.push(a):t[o]+=a}}else"number"==typeof t?t+=i:t[0]+=i}return t}Sn.valid=function(){return!0},p(Tn,Error),p(kn,Error),p(Cn,Error);var Dn=N.bind(null,"log"),Mn=Array.isArray,Ln=JSON.parse;function Bn(e,t){return de("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:Pn,log:Dn,isArray:Mn,toJSON:Ln})}function Fn(){this.promise=new Promise((function(e){e()}))}function Un(e){if(!e)return"undefined";switch(typeof e){case"function":case"string":return e.toString();default:return JSON.stringify(e)}}function Hn(e,t,n,r,i,o){var s,a=function(e,t){return Un(e)+Un(t)+"undefined"}(n,r);if(!i&&(s=e._cachedViews=e._cachedViews||{})[a])return s[a];var l=e.info().then((function(l){var c=l.db_name+"-mrview-"+(i?"temp":ke(a));return pe(e,"_local/"+o,(function(e){e.views=e.views||{};var n=t;-1===n.indexOf("/")&&(n=t+"/"+t);var r=e.views[n]=e.views[n]||{};if(!r[c])return r[c]=!0,e})).then((function(){return e.registerDependentDatabase(c).then((function(t){var i=t.db;i.auto_compaction=!0;var o={name:c,db:i,sourceDB:e,adapter:e.adapter,mapFun:n,reduceFun:r};return o.db.get("_local/lastSeq").catch((function(e){if(404!==e.status)throw e})).then((function(e){return o.seq=e?e.seq:0,s&&o.db.once("destroyed",(function(){delete s[a]})),o}))}))}))}));return s&&(s[a]=l),l}Fn.prototype.add=function(e){return this.promise=this.promise.catch((function(){})).then((function(){return e()})),this.promise},Fn.prototype.finish=function(){return this.promise};var Gn={},qn=new Fn;function Vn(e){return-1===e.indexOf("/")?[e,e]:e.split("/")}function zn(e,t){try{e.emit("error",t)}catch(e){N("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),N("error",t)}}var Wn=function(e,t){return Pn(t)},Kn=function(e,t){return t.length},$n=function(e,t){return{sum:Pn(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:function(e){for(var t=0,n=0,r=e.length;n<r;n++){var i=e[n];t+=i*i}return t}(t)}};var Yn=function(e,t,n,r){function i(e,t,n){try{t(n)}catch(t){zn(e,t)}}function l(e,t,n,r,i){try{return{output:t(n,r,i)}}catch(t){return zn(e,t),{error:t}}}function c(e,t){var n=ft(e.key,t.key);return 0!==n?n:ft(e.value,t.value)}function u(e,t,n){return n=n||0,"number"==typeof t?e.slice(n,t+n):n>0?e.slice(n):e}function d(e){var t=e.value;return t&&"object"==typeof t&&t._id||e.id}function p(e){return function(t){return e.include_docs&&e.attachments&&e.binary&&function(e){e.rows.forEach((function(e){var t=e.doc&&e.doc._attachments;t&&Object.keys(t).forEach((function(e){var n=t[e];t[e].data=ye(n.data,n.content_type)}))}))}(t),t}}function h(e,t,n,r){var i=t[e];void 0!==i&&(r&&(i=encodeURIComponent(JSON.stringify(i))),n.push(e+"="+i))}function f(e){if(void 0!==e){var t=Number(e);return isNaN(t)||t!==parseInt(e,10)?e:t}}function g(e,t){var n=e.descending?"endkey":"startkey",r=e.descending?"startkey":"endkey";if(void 0!==e[n]&&void 0!==e[r]&&ft(e[n],e[r])>0)throw new Tn("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(t.reduce&&!1!==e.reduce){if(e.include_docs)throw new Tn("{include_docs:true} is invalid for reduce");if(e.keys&&e.keys.length>1&&!e.group&&!e.group_level)throw new Tn("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach((function(t){var n=function(e){if(e){if("number"!=typeof e)return new Tn('Invalid value for integer: "'+e+'"');if(e<0)return new Tn('Invalid value for positive integer: "'+e+'"')}}(e[t]);if(n)throw n}))}function m(e){return function(t){if(404===t.status)return e;throw t}}function v(e){var t="string"==typeof e?e:e.name,n=Gn[t];return n||(n=Gn[t]=new Fn),n}function y(e){return In(v(e),(function(){return function(e){var n,r,a=t(e.mapFun,(function(e,t){var i={id:r._id,key:gt(e)};null!=t&&(i.value=gt(t)),n.push(i)})),l=e.seq||0;function u(t,n){return function(){return function(e,t,n){return e.db.get("_local/lastSeq").catch(m({_id:"_local/lastSeq",seq:0})).then((function(r){var i=Nn(t);return Promise.all(i.map((function(n){return function(e,t,n){var r="_local/doc_"+e,i={_id:r,keys:[]},s=n.get(e),a=s[0];return(function(e){return 1===e.length&&/^1-/.test(e[0].rev)}(s[1])?Promise.resolve(i):t.db.get(r).catch(m(i))).then((function(e){return function(e){return e.keys.length?t.db.allDocs({keys:e.keys,include_docs:!0}):Promise.resolve({rows:[]})}(e).then((function(t){return function(e,t){for(var n=[],r=new o,i=0,s=t.rows.length;i<s;i++){var l=t.rows[i].doc;if(l&&(n.push(l),r.add(l._id),l._deleted=!a.has(l._id),!l._deleted)){var c=a.get(l._id);"value"in c&&(l.value=c.value)}}var u=Nn(a);return u.forEach((function(e){if(!r.has(e)){var t={_id:e},i=a.get(e);"value"in i&&(t.value=i.value),n.push(t)}})),e.keys=On(u.concat(e.keys)),n.push(e),n}(e,t)}))}))}(n,e,t)}))).then((function(t){var i=te(t);return r.seq=n,i.push(r),e.db.bulkDocs({docs:i})}))}))}(e,t,n)}}var d=new Fn;function p(){return e.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:l,limit:50}).then(h)}function h(t){var o=t.results;if(o.length){var h=function(t){for(var o=new s,u=0,d=t.length;u<d;u++){var p=t[u];if("_"!==p.doc._id[0]){n=[],(r=p.doc)._deleted||i(e.sourceDB,a,r),n.sort(c);var h=f(n);o.set(p.doc._id,[h,p.changes])}l=p.seq}return o}(o);if(d.add(u(h,l)),!(o.length<50))return p()}}function f(e){for(var t,n=new s,r=0,i=e.length;r<i;r++){var o=e[r],a=[o.key,o.id];r>0&&0===ft(o.key,t)&&a.push(r),n.set(vt(a),o),t=o.key}return n}return p().then((function(){return d.finish()})).then((function(){e.seq=l}))}(e)}))()}function b(e,t){return In(v(e),(function(){return function(e,t){var r,i=e.reduceFun&&!1!==t.reduce,o=t.skip||0;function a(t){return t.include_docs=!0,e.db.allDocs(t).then((function(e){return r=e.total_rows,e.rows.map((function(e){if("value"in e.doc&&"object"==typeof e.doc.value&&null!==e.doc.value){var t=Object.keys(e.doc.value).sort(),n=["id","key","value"];if(!(t<n||t>n))return e.doc.value}var r=function(e){for(var t=[],n=[],r=0;;){var i=e[r++];if("\0"!==i)switch(i){case"1":t.push(null);break;case"2":t.push("1"===e[r]),r++;break;case"3":var o=yt(e,r);t.push(o.num),r+=o.length;break;case"4":for(var s="";;){var a=e[r];if("\0"===a)break;s+=a,r++}s=s.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(s);break;case"5":var l={element:[],index:t.length};t.push(l.element),n.push(l);break;case"6":var c={element:{},index:t.length};t.push(c.element),n.push(c);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}else{if(1===t.length)return t.pop();bt(t,n)}}}(e.doc._id);return{key:r[0],id:r[1],value:"value"in e.doc?e.doc.value:null}}))}))}function c(a){var c;if(c=i?function(e,t,r){0===r.group_level&&delete r.group_level;var i=r.group||r.group_level,o=n(e.reduceFun),s=[],a=isNaN(r.group_level)?Number.POSITIVE_INFINITY:r.group_level;t.forEach((function(e){var t=s[s.length-1],n=i?e.key:null;if(i&&Array.isArray(n)&&(n=n.slice(0,a)),t&&0===ft(t.groupKey,n))return t.keys.push([e.key,e.id]),void t.values.push(e.value);s.push({keys:[[e.key,e.id]],values:[e.value],groupKey:n})})),t=[];for(var c=0,d=s.length;c<d;c++){var p=s[c],h=l(e.sourceDB,o,p.keys,p.values,!1);if(h.error&&h.error instanceof Cn)throw h.error;t.push({value:h.error?null:h.output,key:p.groupKey})}return{rows:u(t,r.limit,r.skip)}}(e,a,t):{total_rows:r,offset:o,rows:a},t.update_seq&&(c.update_seq=e.seq),t.include_docs){var p=On(a.map(d));return e.sourceDB.allDocs({keys:p,include_docs:!0,conflicts:t.conflicts,attachments:t.attachments,binary:t.binary}).then((function(e){var t=new s;return e.rows.forEach((function(e){t.set(e.id,e.doc)})),a.forEach((function(e){var n=d(e),r=t.get(n);r&&(e.doc=r)})),c}))}return c}if(void 0===t.keys||t.keys.length||(t.limit=0,delete t.keys),void 0!==t.keys){var p=t.keys.map((function(e){var n={startkey:vt([e]),endkey:vt([e,{}])};return t.update_seq&&(n.update_seq=!0),a(n)}));return Promise.all(p).then(te).then(c)}var h,f,g={descending:t.descending};if(t.update_seq&&(g.update_seq=!0),"start_key"in t&&(h=t.start_key),"startkey"in t&&(h=t.startkey),"end_key"in t&&(f=t.end_key),"endkey"in t&&(f=t.endkey),void 0!==h&&(g.startkey=t.descending?vt([h,{}]):vt([h])),void 0!==f){var m=!1!==t.inclusive_end;t.descending&&(m=!m),g.endkey=vt(m?[f,{}]:[f])}if(void 0!==t.key){var v=vt([t.key]),y=vt([t.key,{}]);g.descending?(g.endkey=v,g.startkey=y):(g.startkey=v,g.endkey=y)}return i||("number"==typeof t.limit&&(g.limit=t.limit),g.skip=o),a(g).then(c)}(e,t)}))()}function x(t,n,i){if("function"==typeof t._query)return function(e,t,n){return new Promise((function(r,i){e._query(t,n,(function(e,t){if(e)return i(e);r(t)}))}))}(t,n,i);if(re(t))return function(e,t,n){var r,i,o,s=[],a="GET";if(h("reduce",n,s),h("include_docs",n,s),h("attachments",n,s),h("limit",n,s),h("descending",n,s),h("group",n,s),h("group_level",n,s),h("skip",n,s),h("stale",n,s),h("conflicts",n,s),h("startkey",n,s,!0),h("start_key",n,s,!0),h("endkey",n,s,!0),h("end_key",n,s,!0),h("inclusive_end",n,s),h("key",n,s,!0),h("update_seq",n,s),s=""===(s=s.join("&"))?"":"?"+s,void 0!==n.keys){var l="keys="+encodeURIComponent(JSON.stringify(n.keys));l.length+s.length+1<=2e3?s+=("?"===s[0]?"&":"?")+l:(a="POST","string"==typeof t?r={keys:n.keys}:t.keys=n.keys)}if("string"==typeof t){var c=Vn(t);return e.fetch("_design/"+c[0]+"/_view/"+c[1]+s,{headers:new nt({"Content-Type":"application/json"}),method:a,body:JSON.stringify(r)}).then((function(e){return i=e.ok,o=e.status,e.json()})).then((function(e){if(!i)throw e.status=o,Z(e);return e.rows.forEach((function(e){if(e.value&&e.value.error&&"builtin_reduce_error"===e.value.error)throw new Error(e.reason)})),e})).then(p(n))}return r=r||{},Object.keys(t).forEach((function(e){Array.isArray(t[e])?r[e]=t[e]:r[e]=t[e].toString()})),e.fetch("_temp_view"+s,{headers:new nt({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(r)}).then((function(e){return i=e.ok,o=e.status,e.json()})).then((function(e){if(!i)throw e.status=o,Z(e);return e})).then(p(n))}(t,n,i);if("string"!=typeof n)return g(i,n),qn.add((function(){return Hn(t,"temp_view/temp_view",n.map,n.reduce,!0,e).then((function(e){return function(e,t){return e.then((function(e){return t().then((function(){return e}))}),(function(e){return t().then((function(){throw e}))}))}(y(e).then((function(){return b(e,i)})),(function(){return e.db.destroy()}))}))})),qn.finish();var o=n,s=Vn(o),l=s[0],c=s[1];return t.get("_design/"+l).then((function(n){var s=n.views&&n.views[c];if(!s)throw new kn("ddoc "+n._id+" has no view named "+c);return r(n,c),g(i,s),Hn(t,o,s.map,s.reduce,!1,e).then((function(e){return"ok"===i.stale||"update_after"===i.stale?("update_after"===i.stale&&a((function(){y(e)})),b(e,i)):y(e).then((function(){return b(e,i)}))}))}))}return{query:function(e,t,n){var r=this;"function"==typeof t&&(n=t,t={}),t=t?function(e){return e.group_level=f(e.group_level),e.limit=f(e.limit),e.skip=f(e.skip),e}(t):{},"function"==typeof e&&(e={map:e});var i=Promise.resolve().then((function(){return x(r,e,t)}));return An(i,n),i},viewCleanup:jn((function(){var t=this;return"function"==typeof t._viewCleanup?function(e){return new Promise((function(t,n){e._viewCleanup((function(e,r){if(e)return n(e);t(r)}))}))}(t):re(t)?function(e){return e.fetch("_view_cleanup",{headers:new nt({"Content-Type":"application/json"}),method:"POST"}).then((function(e){return e.json()}))}(t):function(t){return t.get("_local/"+e).then((function(e){var n=new s;Object.keys(e.views).forEach((function(e){var t=Vn(e),r="_design/"+t[0],i=t[1],s=n.get(r);s||(s=new o,n.set(r,s)),s.add(i)}));var r={keys:Nn(n),include_docs:!0};return t.allDocs(r).then((function(r){var i={};r.rows.forEach((function(t){var r=t.key.substring(8);n.get(t.key).forEach((function(n){var o=r+"/"+n;e.views[o]||(o=n);var s=Object.keys(e.views[o]),a=t.doc&&t.doc.views&&t.doc.views[n];s.forEach((function(e){i[e]=i[e]||a}))}))}));var o=Object.keys(i).filter((function(e){return!i[e]})).map((function(e){return In(v(e),(function(){return new t.constructor(e,t.__opts).destroy()}))()}));return Promise.all(o).then((function(){return{ok:!0}}))}))}),m({ok:!0}))}(t)}))}}("mrviews",(function(e,t){if("function"==typeof e&&2===e.length){var n=e;return function(e){return n(e,t)}}return Bn(e.toString(),t)}),(function(e){var t=e.toString();return function(e){if(/^_sum/.test(e))return Wn;if(/^_count/.test(e))return Kn;if(/^_stats/.test(e))return $n;if(/^_/.test(e))throw new Error(e+" is not a supported reduce function.")}(t)||Bn(t)}),(function(e,t){var n=e.views&&e.views[t];if("string"!=typeof n.map)throw new kn("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof n.map)}));var Xn={query:function(e,t,n){return Yn.query.call(this,e,t,n)},viewCleanup:function(e){return Yn.viewCleanup.call(this,e)}};function Jn(e){return/^1-/.test(e)}function Qn(e,t){var n=Object.keys(t._attachments);return Promise.all(n.map((function(n){return e.getAttachment(t._id,n,{rev:t._rev})})))}function Zn(e,t,n,r){n=E(n);var i=[],o=!0;function s(t){return e.allDocs({keys:t,include_docs:!0,conflicts:!0}).then((function(e){if(r.cancelled)throw new Error("cancelled");e.rows.forEach((function(e){var t;e.deleted||!e.doc||!Jn(e.value.rev)||(t=e.doc)._attachments&&Object.keys(t._attachments).length>0||function(e){return e._conflicts&&e._conflicts.length>0}(e.doc)||(e.doc._conflicts&&delete e.doc._conflicts,i.push(e.doc),delete n[e.id])}))}))}return Promise.resolve().then((function(){var e=Object.keys(n).filter((function(e){var t=n[e].missing;return 1===t.length&&Jn(t[0])}));if(e.length>0)return s(e)})).then((function(){var s=function(e){var t=[];return Object.keys(e).forEach((function(n){e[n].missing.forEach((function(e){t.push({id:n,rev:e})}))})),{docs:t,revs:!0,latest:!0}}(n);if(s.docs.length)return e.bulkGet(s).then((function(n){if(r.cancelled)throw new Error("cancelled");return Promise.all(n.results.map((function(n){return Promise.all(n.docs.map((function(n){var r=n.ok;return n.error&&(o=!1),r&&r._attachments?function(e,t,n){var r=re(t)&&!re(e),i=Object.keys(n._attachments);return r?e.get(n._id).then((function(r){return Promise.all(i.map((function(i){return function(e,t,n){return!e._attachments||!e._attachments[n]||e._attachments[n].digest!==t._attachments[n].digest}(r,n,i)?t.getAttachment(n._id,i):e.getAttachment(r._id,i)})))})).catch((function(e){if(404!==e.status)throw e;return Qn(t,n)})):Qn(t,n)}(t,e,r).then((function(e){var t=Object.keys(r._attachments);return e.forEach((function(e,n){var i=r._attachments[t[n]];delete i.stub,delete i.length,i.data=e})),r})):r})))}))).then((function(e){i=i.concat(te(e).filter(Boolean))}))}))})).then((function(){return{ok:o,docs:i}}))}var er="pouchdb";function tr(e,t,n,r,i){return e.get(t).catch((function(n){if(404===n.status)return"http"!==e.adapter&&"https"!==e.adapter||P(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:t,history:[],replicator:er,version:1};throw n})).then((function(o){if(!i.cancelled&&o.last_seq!==n)return o.history=(o.history||[]).filter((function(e){return e.session_id!==r})),o.history.unshift({last_seq:n,session_id:r}),o.history=o.history.slice(0,5),o.version=1,o.replicator=er,o.session_id=r,o.last_seq=n,e.put(o).catch((function(o){if(409===o.status)return tr(e,t,n,r,i);throw o}))}))}function nr(e,t,n,r,i){this.src=e,this.target=t,this.id=n,this.returnValue=r,this.opts=i||{}}nr.prototype.writeCheckpoint=function(e,t){var n=this;return this.updateTarget(e,t).then((function(){return n.updateSource(e,t)}))},nr.prototype.updateTarget=function(e,t){return this.opts.writeTargetCheckpoint?tr(this.target,this.id,e,t,this.returnValue):Promise.resolve(!0)},nr.prototype.updateSource=function(e,t){if(this.opts.writeSourceCheckpoint){var n=this;return tr(this.src,this.id,e,t,this.returnValue).catch((function(e){if(sr(e))return n.opts.writeSourceCheckpoint=!1,!0;throw e}))}return Promise.resolve(!0)};var rr={undefined:function(e,t){return 0===ft(e.last_seq,t.last_seq)?t.last_seq:0},1:function(e,t){return function(e,t){return e.session_id===t.session_id?{last_seq:e.last_seq,history:e.history}:ir(e.history,t.history)}(t,e).last_seq}};function ir(e,t){var n=e[0],r=e.slice(1),i=t[0],o=t.slice(1);return n&&0!==t.length?or(n.session_id,t)?{last_seq:n.last_seq,history:e}:or(i.session_id,r)?{last_seq:i.last_seq,history:o}:ir(r,o):{last_seq:0,history:[]}}function or(e,t){var n=t[0],r=t.slice(1);return!(!e||0===t.length)&&(e===n.session_id||or(e,r))}function sr(e){return"number"==typeof e.status&&4===Math.floor(e.status/100)}nr.prototype.getCheckpoint=function(){var e=this;return e.opts&&e.opts.writeSourceCheckpoint&&!e.opts.writeTargetCheckpoint?e.src.get(e.id).then((function(e){return e.last_seq||0})).catch((function(e){if(404!==e.status)throw e;return 0})):e.target.get(e.id).then((function(t){return e.opts&&e.opts.writeTargetCheckpoint&&!e.opts.writeSourceCheckpoint?t.last_seq||0:e.src.get(e.id).then((function(e){return t.version!==e.version?0:(n=t.version?t.version.toString():"undefined")in rr?rr[n](t,e):0;var n}),(function(n){if(404===n.status&&t.last_seq)return e.src.put({_id:e.id,last_seq:0}).then((function(){return 0}),(function(n){return sr(n)?(e.opts.writeSourceCheckpoint=!1,t.last_seq):0}));throw n}))})).catch((function(e){if(404!==e.status)throw e;return 0}))};function ar(e,t,n){var r=n.doc_ids?n.doc_ids.sort(ft):"",i=n.filter?n.filter.toString():"",o="",s="",a="";return n.selector&&(a=JSON.stringify(n.selector)),n.filter&&n.query_params&&(o=JSON.stringify(function(e){return Object.keys(e).sort(ft).reduce((function(t,n){return t[n]=e[n],t}),{})}(n.query_params))),n.filter&&"_view"===n.filter&&(s=n.view.toString()),Promise.all([e.id(),t.id()]).then((function(e){var t=e[0]+e[1]+i+s+o+r+a;return new Promise((function(e){Te(t,e)}))})).then((function(e){return"_local/"+e.replace(/\//g,".").replace(/\+/g,"_")}))}function lr(e,t,n,r,i){var o,s,l,c=[],u={seq:0,changes:[],docs:[]},d=!1,p=!1,h=!1,f=0,g=n.continuous||n.live||!1,m=n.batch_size||100,v=n.batches_limit||10,y=!1,b=n.doc_ids,x=n.selector,_=[],w=Ae();i=i||{ok:!0,start_time:(new Date).toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var S={};function T(){return l?Promise.resolve():ar(e,t,n).then((function(i){s=i;var o;o=!1===n.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===n.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===n.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},l=new nr(e,t,s,r,o)}))}function k(){if(_=[],0!==o.docs.length){var e=o.docs,s={timeout:n.timeout};return t.bulkDocs({docs:e,new_edits:!1},s).then((function(t){if(r.cancelled)throw N(),new Error("cancelled");var n=Object.create(null);t.forEach((function(e){e.error&&(n[e.id]=e)}));var o=Object.keys(n).length;i.doc_write_failures+=o,i.docs_written+=e.length-o,e.forEach((function(e){var t=n[e._id];if(t){i.errors.push(t);var o=(t.name||"").toLowerCase();if("unauthorized"!==o&&"forbidden"!==o)throw t;r.emit("denied",E(t))}else _.push(e)}))}),(function(t){throw i.doc_write_failures+=e.length,t}))}}function C(){if(o.error)throw new Error("There was a problem getting docs.");i.last_seq=f=o.seq;var e=E(i);return _.length&&(e.docs=_,"number"==typeof o.pending&&(e.pending=o.pending,delete o.pending),r.emit("change",e)),d=!0,l.writeCheckpoint(o.seq,w).then((function(){if(d=!1,r.cancelled)throw N(),new Error("cancelled");o=void 0,L()})).catch((function(e){throw F(e),e}))}function A(){return Zn(e,t,o.diffs,r).then((function(e){o.error=!e.ok,e.docs.forEach((function(e){delete o.diffs[e._id],i.docs_read++,o.docs.push(e)}))}))}function j(){var e;r.cancelled||o||(0!==c.length?(o=c.shift(),(e={},o.changes.forEach((function(t){"_user/"!==t.id&&(e[t.id]=t.changes.map((function(e){return e.rev})))})),t.revsDiff(e).then((function(e){if(r.cancelled)throw N(),new Error("cancelled");o.diffs=e}))).then(A).then(k).then(C).then(j).catch((function(e){O("batch processing terminated with error",e)}))):I(!0))}function I(e){0!==u.changes.length?(e||p||u.changes.length>=m)&&(c.push(u),u={seq:0,changes:[],docs:[]},"pending"!==r.state&&"stopped"!==r.state||(r.state="active",r.emit("active")),j()):0!==c.length||o||((g&&S.live||p)&&(r.state="pending",r.emit("paused")),p&&N())}function O(e,t){h||(t.message||(t.message=e),i.ok=!1,i.status="aborting",c=[],u={seq:0,changes:[],docs:[]},N(t))}function N(o){if(!(h||r.cancelled&&(i.status="cancelled",d)))if(i.status=i.status||"complete",i.end_time=(new Date).toISOString(),i.last_seq=f,h=!0,o){(o=Q(o)).result=i;var s=(o.name||"").toLowerCase();"unauthorized"===s||"forbidden"===s?(r.emit("error",o),r.removeAllListeners()):function(e,t,n,r){if(!1===e.retry)return t.emit("error",n),void t.removeAllListeners();if("function"!=typeof e.back_off_function&&(e.back_off_function=R),t.emit("requestError",n),"active"===t.state||"pending"===t.state){t.emit("paused",n),t.state="stopped";var i=function(){e.current_back_off=0};t.once("paused",(function(){t.removeListener("active",i)})),t.once("active",i)}e.current_back_off=e.current_back_off||0,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(r,e.current_back_off)}(n,r,o,(function(){lr(e,t,n,r)}))}else r.emit("complete",i),r.removeAllListeners()}function P(e,t,i){if(r.cancelled)return N();"number"==typeof t&&(u.pending=t),ee(n)(e)&&(u.seq=e.seq||i,u.changes.push(e),a((function(){I(0===c.length&&S.live)})))}function D(e){if(y=!1,r.cancelled)return N();if(e.results.length>0)S.since=e.results[e.results.length-1].seq,L(),I(!0);else{var t=function(){g?(S.live=!0,L()):p=!0,I(!0)};o||0!==e.results.length?t():(d=!0,l.writeCheckpoint(e.last_seq,w).then((function(){d=!1,i.last_seq=f=e.last_seq,t()})).catch(F))}}function M(e){if(y=!1,r.cancelled)return N();O("changes rejected",e)}function L(){if(!y&&!p&&c.length<v){y=!0,r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",i);var t=e.changes(S).on("change",P);t.then(o,o),t.then(D).catch(M),n.retry&&(r._changes=t,r._abortChanges=i)}function i(){t.cancel()}function o(){r.removeListener("cancel",i)}}function B(){T().then((function(){if(!r.cancelled)return l.getCheckpoint().then((function(e){S={since:f=e,limit:m,batch_size:m,style:"all_docs",doc_ids:b,selector:x,return_docs:!0},n.filter&&("string"!=typeof n.filter?S.include_docs=!0:S.filter=n.filter),"heartbeat"in n&&(S.heartbeat=n.heartbeat),"timeout"in n&&(S.timeout=n.timeout),n.query_params&&(S.query_params=n.query_params),n.view&&(S.view=n.view),L()}));N()})).catch((function(e){O("getCheckpoint rejected with ",e)}))}function F(e){d=!1,O("writeCheckpoint completed with error",e)}r.ready(e,t),r.cancelled?N():(r._addedListeners||(r.once("cancel",N),"function"==typeof n.complete&&(r.once("error",n.complete),r.once("complete",(function(e){n.complete(null,e)}))),r._addedListeners=!0),void 0===n.since?B():T().then((function(){return d=!0,l.writeCheckpoint(n.since,w)})).then((function(){d=!1,r.cancelled?N():(f=n.since,B())})).catch(F))}function cr(){h.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var e=this,t=new Promise((function(t,n){e.once("complete",t),e.once("error",n)}));e.then=function(e,n){return t.then(e,n)},e.catch=function(e){return t.catch(e)},e.catch((function(){}))}function ur(e,t){var n=t.PouchConstructor;return"string"==typeof e?new n(e,t):e}function dr(e,t,n,r){if("function"==typeof n&&(r=n,n={}),void 0===n&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw Q(K,"`doc_ids` filter parameter is not a list.");n.complete=r,(n=E(n)).continuous=n.continuous||n.live,n.retry="retry"in n&&n.retry,n.PouchConstructor=n.PouchConstructor||this;var i=new cr(n);return lr(ur(e,n),ur(t,n),n,i),i}function pr(e,t,n,r){return"function"==typeof n&&(r=n,n={}),void 0===n&&(n={}),(n=E(n)).PouchConstructor=n.PouchConstructor||this,new hr(e=ur(e,n),t=ur(t,n),n,r)}function hr(e,t,n,r){var i=this;this.canceled=!1;var o=n.push?D({},n,n.push):n,s=n.pull?D({},n,n.pull):n;function a(e){i.emit("change",{direction:"pull",change:e})}function l(e){i.emit("change",{direction:"push",change:e})}function c(e){i.emit("denied",{direction:"push",doc:e})}function u(e){i.emit("denied",{direction:"pull",doc:e})}function d(){i.pushPaused=!0,i.pullPaused&&i.emit("paused")}function p(){i.pullPaused=!0,i.pushPaused&&i.emit("paused")}function h(){i.pushPaused=!1,i.pullPaused&&i.emit("active",{direction:"push"})}function f(){i.pullPaused=!1,i.pushPaused&&i.emit("active",{direction:"pull"})}this.push=dr(e,t,o),this.pull=dr(t,e,s),this.pushPaused=!0,this.pullPaused=!0;var g={};function m(e){return function(t,n){("change"===t&&(n===a||n===l)||"denied"===t&&(n===u||n===c)||"paused"===t&&(n===p||n===d)||"active"===t&&(n===f||n===h))&&(t in g||(g[t]={}),g[t][e]=!0,2===Object.keys(g[t]).length&&i.removeAllListeners(t))}}function v(e,t,n){-1==e.listeners(t).indexOf(n)&&e.on(t,n)}n.live&&(this.push.on("complete",i.pull.cancel.bind(i.pull)),this.pull.on("complete",i.push.cancel.bind(i.push))),this.on("newListener",(function(e){"change"===e?(v(i.pull,"change",a),v(i.push,"change",l)):"denied"===e?(v(i.pull,"denied",u),v(i.push,"denied",c)):"active"===e?(v(i.pull,"active",f),v(i.push,"active",h)):"paused"===e&&(v(i.pull,"paused",p),v(i.push,"paused",d))})),this.on("removeListener",(function(e){"change"===e?(i.pull.removeListener("change",a),i.push.removeListener("change",l)):"denied"===e?(i.pull.removeListener("denied",u),i.push.removeListener("denied",c)):"active"===e?(i.pull.removeListener("active",f),i.push.removeListener("active",h)):"paused"===e&&(i.pull.removeListener("paused",p),i.push.removeListener("paused",d))})),this.pull.on("removeListener",m("pull")),this.push.on("removeListener",m("push"));var y=Promise.all([this.push,this.pull]).then((function(e){var t={push:e[0],pull:e[1]};return i.emit("complete",t),r&&r(null,t),i.removeAllListeners(),t}),(function(e){if(i.cancel(),r?r(e):i.emit("error",e),i.removeAllListeners(),r)throw e}));this.then=function(e,t){return y.then(e,t)},this.catch=function(e){return y.catch(e)}}p(cr,h.EventEmitter),cr.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},cr.prototype.ready=function(e,t){var n=this;function r(){n.cancel()}n._readyCalled||(n._readyCalled=!0,e.once("destroyed",r),t.once("destroyed",r),n.once("complete",(function(){e.removeListener("destroyed",r),t.removeListener("destroyed",r)})))},p(hr,h.EventEmitter),hr.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},Ze.plugin((function(e){e.adapter("idb",fn,!0)})).plugin((function(e){e.adapter("http",Sn,!1),e.adapter("https",Sn,!1)})).plugin(Xn).plugin((function(e){e.replicate=dr,e.sync=pr,Object.defineProperty(e.prototype,"replicate",{get:function(){var e=this;return void 0===this.replicateMethods&&(this.replicateMethods={from:function(t,n,r){return e.constructor.replicate(t,e,n,r)},to:function(t,n,r){return e.constructor.replicate(e,t,n,r)}}),this.replicateMethods}}),e.prototype.sync=function(e,t,n){return this.constructor.sync(this,e,t,n)}})),t.exports=Ze}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:303,argsarray:219,events:241,immediate:246,inherits:247,"spark-md5":426,uuid:443,vuvuzela:448}],302:[function(e,t,n){(function(e){(function(){"use strict";void 0===e||!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports={nextTick:function(t,n,r,i){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var o,s,a=arguments.length;switch(a){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick((function(){t.call(null,n)}));case 3:return e.nextTick((function(){t.call(null,n,r)}));case 4:return e.nextTick((function(){t.call(null,n,r,i)}));default:for(o=new Array(a-1),s=0;s<o.length;)o[s++]=arguments[s];return e.nextTick((function(){t.apply(null,o)}))}}}:t.exports=e}).call(this)}).call(this,e("_process"))},{_process:303}],303:[function(e,t,n){var r,i,o=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function l(e){if(r===setTimeout)return setTimeout(e,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(e){r=s}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var c,u=[],d=!1,p=-1;function h(){d&&c&&(d=!1,c.length?u=c.concat(u):p=-1,u.length&&f())}function f(){if(!d){var e=l(h);d=!0;for(var t=u.length;t;){for(c=u,u=[];++p<t;)c&&c[p].run();p=-1,t=u.length}c=null,d=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new g(e,t)),1!==u.length||d||l(f)},g.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],304:[function(e,t,n){"use strict";var r=e("./lib/ReactPropTypesSecret");function i(){}function o(){}o.resetWarningCache=i,t.exports=function(){function e(e,t,n,i,o,s){if(s!==r){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:i};return n.PropTypes=n,n}},{"./lib/ReactPropTypesSecret":306}],305:[function(e,t,n){t.exports=e("./factoryWithThrowingShims")()},{"./factoryWithThrowingShims":304}],306:[function(e,t,n){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},{}],307:[function(e,t,n){var r,i;r=this,i=function(){var e="function"==typeof Object.defineProperty?function(e,t,n){return Object.defineProperty(e,t,n),e}:function(e,t,n){return e[t]=n.value,e};return function(t,n,r,i){var o;if(i=function(e,t){var n="object"==typeof t,r=!n&&"string"==typeof t,i=function(e){return n?!!t[e]:!!r&&t.indexOf(e[0])>-1};return{enumerable:i("enumerable"),configurable:i("configurable"),writable:i("writable"),value:e}}(r,i),"object"==typeof n){for(o in n)Object.hasOwnProperty.call(n,o)&&(i.value=n[o],e(t,o,i));return t}return e(t,n,i)}},void 0!==t&&t.exports?t.exports=i():r.prr=i()},{}],308:[function(e,t,n){"use strict";var r=e("react"),i=e("object-assign"),o=e("scheduler");function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!r)throw Error(s(227));var a=new Set,l={};function c(e,t){u(e,t),u(e+"Capture",t)}function u(e,t){for(l[e]=t,e=0;e<t.length;e++)a.add(t[e])}var d=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),p=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h=Object.prototype.hasOwnProperty,f={},g={};function m(e,t,n,r,i,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){v[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];v[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){v[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){v[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){v[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){v[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){v[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){v[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){v[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function b(e){return e[1].toUpperCase()}function x(e,t,n,r){var i=v.hasOwnProperty(t)?v[t]:null;(null!==i?0===i.type:!r&&2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1]))||(function(e,t,n,r){if(null==t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!h.call(g,e)||!h.call(f,e)&&(p.test(e)?g[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,b);v[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,b);v[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,b);v[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){v[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),v.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){v[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var E=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_=60103,w=60106,S=60107,T=60108,k=60114,C=60109,A=60110,j=60112,I=60113,O=60120,N=60115,R=60116,P=60121,D=60128,M=60129,L=60130,B=60131;if("function"==typeof Symbol&&Symbol.for){var F=Symbol.for;_=F("react.element"),w=F("react.portal"),S=F("react.fragment"),T=F("react.strict_mode"),k=F("react.profiler"),C=F("react.provider"),A=F("react.context"),j=F("react.forward_ref"),I=F("react.suspense"),O=F("react.suspense_list"),N=F("react.memo"),R=F("react.lazy"),P=F("react.block"),F("react.scope"),D=F("react.opaque.id"),M=F("react.debug_trace_mode"),L=F("react.offscreen"),B=F("react.legacy_hidden")}var U,H="function"==typeof Symbol&&Symbol.iterator;function G(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=H&&e[H]||e["@@iterator"])?e:null}function q(e){if(void 0===U)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);U=t&&t[1]||""}return"\n"+U+e}var V=!1;function z(e,t){if(!e||V)return"";V=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var r=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){r=e}e.call(t.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(e){if(e&&r&&"string"==typeof e.stack){for(var i=e.stack.split("\n"),o=r.stack.split("\n"),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(1!==s||1!==a)do{if(s--,0>--a||i[s]!==o[a])return"\n"+i[s].replace(" at new "," at ")}while(1<=s&&0<=a);break}}}finally{V=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?q(e):""}function W(e){switch(e.tag){case 5:return q(e.type);case 16:return q("Lazy");case 13:return q("Suspense");case 19:return q("SuspenseList");case 0:case 2:case 15:return z(e.type,!1);case 11:return z(e.type.render,!1);case 22:return z(e.type._render,!1);case 1:return z(e.type,!0);default:return""}}function K(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case S:return"Fragment";case w:return"Portal";case k:return"Profiler";case T:return"StrictMode";case I:return"Suspense";case O:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case A:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case j:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case N:return K(e.type);case P:return K(e._render);case R:t=e._payload,e=e._init;try{return K(e(t))}catch(e){}}return null}function $(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function Y(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function X(e){e._valueTracker||(e._valueTracker=function(e){var t=Y(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function J(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Y(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Q(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Z(e,t){var n=t.checked;return i({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function ee(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=$(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function te(e,t){null!=(t=t.checked)&&x(e,"checked",t,!1)}function ne(e,t){te(e,t);var n=$(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ie(e,t.type,n):t.hasOwnProperty("defaultValue")&&ie(e,t.type,$(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function re(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ie(e,t,n){"number"===t&&Q(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function oe(e,t){return e=i({children:void 0},t),(t=function(e){var t="";return r.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function se(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+$(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function ae(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return i({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function le(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(s(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(s(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:$(n)}}function ce(e,t){var n=$(t.value),r=$(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ue(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var de="http://www.w3.org/1999/xhtml",pe="http://www.w3.org/2000/svg";function he(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function fe(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?he(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ge,me,ve=(me=function(e,t){if(e.namespaceURI!==pe||"innerHTML"in e)e.innerHTML=t;else{for((ge=ge||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ge.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return me(e,t)}))}:me);function ye(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var be={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},xe=["Webkit","ms","Moz","O"];function Ee(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||be.hasOwnProperty(e)&&be[e]?(""+t).trim():t+"px"}function _e(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=Ee(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(be).forEach((function(e){xe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),be[t]=be[e]}))}));var we=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Se(e,t){if(t){if(we[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(s(62))}}function Te(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function ke(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ce=null,Ae=null,je=null;function Ie(e){if(e=ei(e)){if("function"!=typeof Ce)throw Error(s(280));var t=e.stateNode;t&&(t=ni(t),Ce(e.stateNode,e.type,t))}}function Oe(e){Ae?je?je.push(e):je=[e]:Ae=e}function Ne(){if(Ae){var e=Ae,t=je;if(je=Ae=null,Ie(e),t)for(e=0;e<t.length;e++)Ie(t[e])}}function Re(e,t){return e(t)}function Pe(e,t,n,r,i){return e(t,n,r,i)}function De(){}var Me=Re,Le=!1,Be=!1;function Fe(){null===Ae&&null===je||(De(),Ne())}function Ue(e,t){var n=e.stateNode;if(null===n)return null;var r=ni(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(s(231,t,typeof n));return n}var He=!1;if(d)try{var Ge={};Object.defineProperty(Ge,"passive",{get:function(){He=!0}}),window.addEventListener("test",Ge,Ge),window.removeEventListener("test",Ge,Ge)}catch(me){He=!1}function qe(e,t,n,r,i,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(e){this.onError(e)}}var Ve=!1,ze=null,We=!1,Ke=null,$e={onError:function(e){Ve=!0,ze=e}};function Ye(e,t,n,r,i,o,s,a,l){Ve=!1,ze=null,qe.apply($e,arguments)}function Xe(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(1026&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Je(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function Qe(e){if(Xe(e)!==e)throw Error(s(188))}function Ze(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=Xe(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return Qe(i),e;if(o===r)return Qe(i),t;o=o.sibling}throw Error(s(188))}if(n.return!==r.return)n=i,r=o;else{for(var a=!1,l=i.child;l;){if(l===n){a=!0,n=i,r=o;break}if(l===r){a=!0,r=i,n=o;break}l=l.sibling}if(!a){for(l=o.child;l;){if(l===n){a=!0,n=o,r=i;break}if(l===r){a=!0,r=o,n=i;break}l=l.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==r)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function et(e,t){for(var n=e.alternate;null!==t;){if(t===e||t===n)return!0;t=t.return}return!1}var tt,nt,rt,it,ot=!1,st=[],at=null,lt=null,ct=null,ut=new Map,dt=new Map,pt=[],ht="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ft(e,t,n,r,i){return{blockedOn:e,domEventName:t,eventSystemFlags:16|n,nativeEvent:i,targetContainers:[r]}}function gt(e,t){switch(e){case"focusin":case"focusout":at=null;break;case"dragenter":case"dragleave":lt=null;break;case"mouseover":case"mouseout":ct=null;break;case"pointerover":case"pointerout":ut.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":dt.delete(t.pointerId)}}function mt(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e=ft(t,n,r,i,o),null!==t&&null!==(t=ei(t))&&nt(t),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function vt(e){var t=Zr(e.target);if(null!==t){var n=Xe(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Je(n)))return e.blockedOn=t,void it(e.lanePriority,(function(){o.unstable_runWithPriority(e.priority,(function(){rt(n)}))}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function yt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Zt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ei(n))&&nt(t),e.blockedOn=n,!1;t.shift()}return!0}function bt(e,t,n){yt(e)&&n.delete(t)}function xt(){for(ot=!1;0<st.length;){var e=st[0];if(null!==e.blockedOn){null!==(e=ei(e.blockedOn))&&tt(e);break}for(var t=e.targetContainers;0<t.length;){var n=Zt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n){e.blockedOn=n;break}t.shift()}null===e.blockedOn&&st.shift()}null!==at&&yt(at)&&(at=null),null!==lt&&yt(lt)&&(lt=null),null!==ct&&yt(ct)&&(ct=null),ut.forEach(bt),dt.forEach(bt)}function Et(e,t){e.blockedOn===t&&(e.blockedOn=null,ot||(ot=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,xt)))}function _t(e){function t(t){return Et(t,e)}if(0<st.length){Et(st[0],e);for(var n=1;n<st.length;n++){var r=st[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==at&&Et(at,e),null!==lt&&Et(lt,e),null!==ct&&Et(ct,e),ut.forEach(t),dt.forEach(t),n=0;n<pt.length;n++)(r=pt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<pt.length&&null===(n=pt[0]).blockedOn;)vt(n),null===n.blockedOn&&pt.shift()}function wt(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var St={animationend:wt("Animation","AnimationEnd"),animationiteration:wt("Animation","AnimationIteration"),animationstart:wt("Animation","AnimationStart"),transitionend:wt("Transition","TransitionEnd")},Tt={},kt={};function Ct(e){if(Tt[e])return Tt[e];if(!St[e])return e;var t,n=St[e];for(t in n)if(n.hasOwnProperty(t)&&t in kt)return Tt[e]=n[t];return e}d&&(kt=document.createElement("div").style,"AnimationEvent"in window||(delete St.animationend.animation,delete St.animationiteration.animation,delete St.animationstart.animation),"TransitionEvent"in window||delete St.transitionend.transition);var At=Ct("animationend"),jt=Ct("animationiteration"),It=Ct("animationstart"),Ot=Ct("transitionend"),Nt=new Map,Rt=new Map,Pt=["abort","abort",At,"animationEnd",jt,"animationIteration",It,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Ot,"transitionEnd","waiting","waiting"];function Dt(e,t){for(var n=0;n<e.length;n+=2){var r=e[n],i=e[n+1];i="on"+(i[0].toUpperCase()+i.slice(1)),Rt.set(r,t),Nt.set(r,i),c(i,[r])}}(0,o.unstable_now)();var Mt=8;function Lt(e){if(0!=(1&e))return Mt=15,1;if(0!=(2&e))return Mt=14,2;if(0!=(4&e))return Mt=13,4;var t=24&e;return 0!==t?(Mt=12,t):0!=(32&e)?(Mt=11,32):0!=(t=192&e)?(Mt=10,t):0!=(256&e)?(Mt=9,256):0!=(t=3584&e)?(Mt=8,t):0!=(4096&e)?(Mt=7,4096):0!=(t=4186112&e)?(Mt=6,t):0!=(t=62914560&e)?(Mt=5,t):67108864&e?(Mt=4,67108864):0!=(134217728&e)?(Mt=3,134217728):0!=(t=805306368&e)?(Mt=2,t):0!=(1073741824&e)?(Mt=1,1073741824):(Mt=8,e)}function Bt(e,t){var n=e.pendingLanes;if(0===n)return Mt=0;var r=0,i=0,o=e.expiredLanes,s=e.suspendedLanes,a=e.pingedLanes;if(0!==o)r=o,i=Mt=15;else if(0!=(o=134217727&n)){var l=o&~s;0!==l?(r=Lt(l),i=Mt):0!=(a&=o)&&(r=Lt(a),i=Mt)}else 0!=(o=n&~s)?(r=Lt(o),i=Mt):0!==a&&(r=Lt(a),i=Mt);if(0===r)return 0;if(r=n&((0>(r=31-Vt(r))?0:1<<r)<<1)-1,0!==t&&t!==r&&0==(t&s)){if(Lt(t),i<=Mt)return t;Mt=i}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-Vt(t)),r|=e[n],t&=~i;return r}function Ft(e){return 0!=(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Ut(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=Ht(24&~t))?Ut(10,t):e;case 10:return 0===(e=Ht(192&~t))?Ut(8,t):e;case 8:return 0===(e=Ht(3584&~t))&&0===(e=Ht(4186112&~t))&&(e=512),e;case 2:return 0===(t=Ht(805306368&~t))&&(t=268435456),t}throw Error(s(358,e))}function Ht(e){return e&-e}function Gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function qt(e,t,n){e.pendingLanes|=t;var r=t-1;e.suspendedLanes&=r,e.pingedLanes&=r,(e=e.eventTimes)[t=31-Vt(t)]=n}var Vt=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(zt(e)/Wt|0)|0},zt=Math.log,Wt=Math.LN2;var Kt=o.unstable_UserBlockingPriority,$t=o.unstable_runWithPriority,Yt=!0;function Xt(e,t,n,r){Le||De();var i=Qt,o=Le;Le=!0;try{Pe(i,e,t,n,r)}finally{(Le=o)||Fe()}}function Jt(e,t,n,r){$t(Kt,Qt.bind(null,e,t,n,r))}function Qt(e,t,n,r){var i;if(Yt)if((i=0==(4&t))&&0<st.length&&-1<ht.indexOf(e))e=ft(null,e,t,n,r),st.push(e);else{var o=Zt(e,t,n,r);if(null===o)i&&gt(e,r);else{if(i){if(-1<ht.indexOf(e))return e=ft(o,e,t,n,r),void st.push(e);if(function(e,t,n,r,i){switch(t){case"focusin":return at=mt(at,e,t,n,r,i),!0;case"dragenter":return lt=mt(lt,e,t,n,r,i),!0;case"mouseover":return ct=mt(ct,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return ut.set(o,mt(ut.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,dt.set(o,mt(dt.get(o)||null,e,t,n,r,i)),!0}return!1}(o,e,t,n,r))return;gt(e,r)}Nr(e,t,r,null,n)}}}function Zt(e,t,n,r){var i=ke(r);if(null!==(i=Zr(i))){var o=Xe(i);if(null===o)i=null;else{var s=o.tag;if(13===s){if(null!==(i=Je(o)))return i;i=null}else if(3===s){if(o.stateNode.hydrate)return 3===o.tag?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null)}}return Nr(e,t,r,i,n),null}var en=null,tn=null,nn=null;function rn(){if(nn)return nn;var e,t,n=tn,r=n.length,i="value"in en?en.value:en.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===i[o-t];t++);return nn=i.slice(e,1<t?1-t:void 0)}function on(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function sn(){return!0}function an(){return!1}function ln(e){function t(t,n,r,i,o){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(i):i[s]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?sn:an,this.isPropagationStopped=an,this}return i(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=sn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=sn)},persist:function(){},isPersistent:sn}),t}var cn,un,dn,pn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hn=ln(pn),fn=i({},pn,{view:0,detail:0}),gn=ln(fn),mn=i({},fn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==dn&&(dn&&"mousemove"===e.type?(cn=e.screenX-dn.screenX,un=e.screenY-dn.screenY):un=cn=0,dn=e),cn)},movementY:function(e){return"movementY"in e?e.movementY:un}}),vn=ln(mn),yn=ln(i({},mn,{dataTransfer:0})),bn=ln(i({},fn,{relatedTarget:0})),xn=ln(i({},pn,{animationName:0,elapsedTime:0,pseudoElement:0})),En=ln(i({},pn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),_n=ln(i({},pn,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Tn[e])&&!!t[e]}function Cn(){return kn}var An=ln(i({},fn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=on(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cn,charCode:function(e){return"keypress"===e.type?on(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?on(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),jn=ln(i({},mn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=ln(i({},fn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cn})),On=ln(i({},pn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Nn=ln(i({},mn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Rn=[9,13,27,32],Pn=d&&"CompositionEvent"in window,Dn=null;d&&"documentMode"in document&&(Dn=document.documentMode);var Mn=d&&"TextEvent"in window&&!Dn,Ln=d&&(!Pn||Dn&&8<Dn&&11>=Dn),Bn=String.fromCharCode(32),Fn=!1;function Un(e,t){switch(e){case"keyup":return-1!==Rn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hn(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Gn=!1;var qn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!qn[e.type]:"textarea"===t}function zn(e,t,n,r){Oe(r),0<(t=Pr(t,"onChange")).length&&(n=new hn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Wn=null,Kn=null;function $n(e){kr(e,0)}function Yn(e){if(J(ti(e)))return e}function Xn(e,t){if("change"===e)return t}var Jn=!1;if(d){var Qn;if(d){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"==typeof er.oninput}Qn=Zn}else Qn=!1;Jn=Qn&&(!document.documentMode||9<document.documentMode)}function tr(){Wn&&(Wn.detachEvent("onpropertychange",nr),Kn=Wn=null)}function nr(e){if("value"===e.propertyName&&Yn(Kn)){var t=[];if(zn(t,Kn,e,ke(e)),e=$n,Le)e(t);else{Le=!0;try{Re(e,t)}finally{Le=!1,Fe()}}}}function rr(e,t,n){"focusin"===e?(tr(),Kn=n,(Wn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Kn)}function or(e,t){if("click"===e)return Yn(t)}function sr(e,t){if("input"===e||"change"===e)return Yn(t)}var ar="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},lr=Object.prototype.hasOwnProperty;function cr(e,t){if(ar(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!lr.call(t,n[r])||!ar(e[n[r]],t[n[r]]))return!1;return!0}function ur(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function dr(e,t){var n,r=ur(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=ur(r)}}function pr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?pr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=Q();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=Q((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var gr=d&&"documentMode"in document&&11>=document.documentMode,mr=null,vr=null,yr=null,br=!1;function xr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==mr||mr!==Q(r)||(r="selectionStart"in(r=mr)&&fr(r)?{start:r.selectionStart,end:r.selectionEnd}:{anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&cr(yr,r)||(yr=r,0<(r=Pr(vr,"onSelect")).length&&(t=new hn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=mr)))}Dt("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Dt("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Dt(Pt,2);for(var Er="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),_r=0;_r<Er.length;_r++)Rt.set(Er[_r],0);u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Sr=new Set("cancel close invalid load scroll toggle".split(" ").concat(wr));function Tr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,o,a,l,c){if(Ye.apply(this,arguments),Ve){if(!Ve)throw Error(s(198));var u=ze;Ve=!1,ze=null,We||(We=!0,Ke=u)}}(r,t,void 0,e),e.currentTarget=null}function kr(e,t){t=0!=(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var s=r.length-1;0<=s;s--){var a=r[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&i.isPropagationStopped())break e;Tr(i,a,c),o=l}else for(s=0;s<r.length;s++){if(l=(a=r[s]).instance,c=a.currentTarget,a=a.listener,l!==o&&i.isPropagationStopped())break e;Tr(i,a,c),o=l}}}if(We)throw e=Ke,We=!1,Ke=null,e}function Cr(e,t){var n=ri(t),r=e+"__bubble";n.has(r)||(Or(t,e,2,!1),n.add(r))}var Ar="_reactListening"+Math.random().toString(36).slice(2);function jr(e){e[Ar]||(e[Ar]=!0,a.forEach((function(t){Sr.has(t)||Ir(t,!1,e,null),Ir(t,!0,e,null)})))}function Ir(e,t,n,r){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=n;if("selectionchange"===e&&9!==n.nodeType&&(o=n.ownerDocument),null!==r&&!t&&Sr.has(e)){if("scroll"!==e)return;i|=2,o=r}var s=ri(o),a=e+"__"+(t?"capture":"bubble");s.has(a)||(t&&(i|=4),Or(o,e,i,t),s.add(a))}function Or(e,t,n,r){var i=Rt.get(t);switch(void 0===i?2:i){case 0:i=Xt;break;case 1:i=Jt;break;default:i=Qt}n=i.bind(null,t,n,e),i=void 0,!He||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Nr(e,t,n,r,i){var o=r;if(0==(1&t)&&0==(2&t)&&null!==r)e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var a=r.stateNode.containerInfo;if(a===i||8===a.nodeType&&a.parentNode===i)break;if(4===s)for(s=r.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;s=s.return}for(;null!==a;){if(null===(s=Zr(a)))return;if(5===(l=s.tag)||6===l){r=o=s;continue e}a=a.parentNode}}r=r.return}!function(e,t,n){if(Be)return e(t,n);Be=!0;try{Me(e,t,n)}finally{Be=!1,Fe()}}((function(){var r=o,i=ke(n),s=[];e:{var a=Nt.get(e);if(void 0!==a){var l=hn,c=e;switch(e){case"keypress":if(0===on(n))break e;case"keydown":case"keyup":l=An;break;case"focusin":c="focus",l=bn;break;case"focusout":c="blur",l=bn;break;case"beforeblur":case"afterblur":l=bn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=vn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=yn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=In;break;case At:case jt:case It:l=xn;break;case Ot:l=On;break;case"scroll":l=gn;break;case"wheel":l=Nn;break;case"copy":case"cut":case"paste":l=En;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=jn}var u=0!=(4&t),d=!u&&"scroll"===e,p=u?null!==a?a+"Capture":null:a;u=[];for(var h,f=r;null!==f;){var g=(h=f).stateNode;if(5===h.tag&&null!==g&&(h=g,null!==p&&null!=(g=Ue(f,p))&&u.push(Rr(f,g,h))),d)break;f=f.return}0<u.length&&(a=new l(a,c,null,n,i),s.push({event:a,listeners:u}))}}if(0==(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||0!=(16&t)||!(c=n.relatedTarget||n.fromElement)||!Zr(c)&&!c[Jr])&&(l||a)&&(a=i.window===i?i:(a=i.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?Zr(c):null)&&(c!==(d=Xe(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=vn,g="onMouseLeave",p="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=jn,g="onPointerLeave",p="onPointerEnter",f="pointer"),d=null==l?a:ti(l),h=null==c?a:ti(c),(a=new u(g,f+"leave",l,n,i)).target=d,a.relatedTarget=h,g=null,Zr(i)===r&&((u=new u(p,f+"enter",c,n,i)).target=h,u.relatedTarget=d,g=u),d=g,l&&c)e:{for(p=c,f=0,h=u=l;h;h=Dr(h))f++;for(h=0,g=p;g;g=Dr(g))h++;for(;0<f-h;)u=Dr(u),f--;for(;0<h-f;)p=Dr(p),h--;for(;f--;){if(u===p||null!==p&&u===p.alternate)break e;u=Dr(u),p=Dr(p)}u=null}else u=null;null!==l&&Mr(s,a,l,u,!1),null!==c&&null!==d&&Mr(s,d,c,u,!0)}if("select"===(l=(a=r?ti(r):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var m=Xn;else if(Vn(a))if(Jn)m=sr;else{m=ir;var v=rr}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(m=or);switch(m&&(m=m(e,r))?zn(s,m,n,i):(v&&v(e,a,r),"focusout"===e&&(v=a._wrapperState)&&v.controlled&&"number"===a.type&&ie(a,"number",a.value)),v=r?ti(r):window,e){case"focusin":(Vn(v)||"true"===v.contentEditable)&&(mr=v,vr=r,yr=null);break;case"focusout":yr=vr=mr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,xr(s,n,i);break;case"selectionchange":if(gr)break;case"keydown":case"keyup":xr(s,n,i)}var y;if(Pn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Gn?Un(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Ln&&"ko"!==n.locale&&(Gn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Gn&&(y=rn()):(tn="value"in(en=i)?en.value:en.textContent,Gn=!0)),0<(v=Pr(r,b)).length&&(b=new _n(b,e,null,n,i),s.push({event:b,listeners:v}),(y||null!==(y=Hn(n)))&&(b.data=y))),(y=Mn?function(e,t){switch(e){case"compositionend":return Hn(t);case"keypress":return 32!==t.which?null:(Fn=!0,Bn);case"textInput":return(e=t.data)===Bn&&Fn?null:e;default:return null}}(e,n):function(e,t){if(Gn)return"compositionend"===e||!Pn&&Un(e,t)?(e=rn(),nn=tn=en=null,Gn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ln&&"ko"!==t.locale?null:t.data;default:return null}}(e,n))&&0<(r=Pr(r,"onBeforeInput")).length&&(i=new _n("onBeforeInput","beforeinput",null,n,i),s.push({event:i,listeners:r}),i.data=y)}kr(s,t)}))}function Rr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Pr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=Ue(e,n))&&r.unshift(Rr(e,o,i)),null!=(o=Ue(e,t))&&r.push(Rr(e,o,i))),e=e.return}return r}function Dr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Mr(e,t,n,r,i){for(var o=t._reactName,s=[];null!==n&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(null!==l&&l===r)break;5===a.tag&&null!==c&&(a=c,i?null!=(l=Ue(n,o))&&s.unshift(Rr(n,l,a)):i||null!=(l=Ue(n,o))&&s.push(Rr(n,l,a))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}function Lr(){}var Br=null,Fr=null;function Ur(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Hr(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Gr="function"==typeof setTimeout?setTimeout:void 0,qr="function"==typeof clearTimeout?clearTimeout:void 0;function Vr(e){(1===e.nodeType||9===e.nodeType&&null!=(e=e.body))&&(e.textContent="")}function zr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function Wr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var Kr=0;var $r=Math.random().toString(36).slice(2),Yr="__reactFiber$"+$r,Xr="__reactProps$"+$r,Jr="__reactContainer$"+$r,Qr="__reactEvents$"+$r;function Zr(e){var t=e[Yr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Jr]||n[Yr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Wr(e);null!==e;){if(n=e[Yr])return n;e=Wr(e)}return t}n=(e=n).parentNode}return null}function ei(e){return!(e=e[Yr]||e[Jr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ti(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function ni(e){return e[Xr]||null}function ri(e){var t=e[Qr];return void 0===t&&(t=e[Qr]=new Set),t}var ii=[],oi=-1;function si(e){return{current:e}}function ai(e){0>oi||(e.current=ii[oi],ii[oi]=null,oi--)}function li(e,t){ii[++oi]=e.current,e.current=t}var ci={},ui=si(ci),di=si(!1),pi=ci;function hi(e,t){var n=e.type.contextTypes;if(!n)return ci;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function fi(e){return null!=e.childContextTypes}function gi(){ai(di),ai(ui)}function mi(e,t,n){if(ui.current!==ci)throw Error(s(168));li(ui,t),li(di,n)}function vi(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var o in r=r.getChildContext())if(!(o in e))throw Error(s(108,K(t)||"Unknown",o));return i({},n,r)}function yi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ci,pi=ui.current,li(ui,e),li(di,di.current),!0}function bi(e,t,n){var r=e.stateNode;if(!r)throw Error(s(169));n?(e=vi(e,t,pi),r.__reactInternalMemoizedMergedChildContext=e,ai(di),ai(ui),li(ui,e)):ai(di),li(di,n)}var xi=null,Ei=null,_i=o.unstable_runWithPriority,wi=o.unstable_scheduleCallback,Si=o.unstable_cancelCallback,Ti=o.unstable_shouldYield,ki=o.unstable_requestPaint,Ci=o.unstable_now,Ai=o.unstable_getCurrentPriorityLevel,ji=o.unstable_ImmediatePriority,Ii=o.unstable_UserBlockingPriority,Oi=o.unstable_NormalPriority,Ni=o.unstable_LowPriority,Ri=o.unstable_IdlePriority,Pi={},Di=void 0!==ki?ki:function(){},Mi=null,Li=null,Bi=!1,Fi=Ci(),Ui=1e4>Fi?Ci:function(){return Ci()-Fi};function Hi(){switch(Ai()){case ji:return 99;case Ii:return 98;case Oi:return 97;case Ni:return 96;case Ri:return 95;default:throw Error(s(332))}}function Gi(e){switch(e){case 99:return ji;case 98:return Ii;case 97:return Oi;case 96:return Ni;case 95:return Ri;default:throw Error(s(332))}}function qi(e,t){return e=Gi(e),_i(e,t)}function Vi(e,t,n){return e=Gi(e),wi(e,t,n)}function zi(){if(null!==Li){var e=Li;Li=null,Si(e)}Wi()}function Wi(){if(!Bi&&null!==Mi){Bi=!0;var e=0;try{var t=Mi;qi(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),Mi=null}catch(t){throw null!==Mi&&(Mi=Mi.slice(e+1)),wi(ji,zi),t}finally{Bi=!1}}}var Ki=E.ReactCurrentBatchConfig;function $i(e,t){if(e&&e.defaultProps){for(var n in t=i({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var Yi=si(null),Xi=null,Ji=null,Qi=null;function Zi(){Qi=Ji=Xi=null}function eo(e){var t=Yi.current;ai(Yi),e.type._context._currentValue=t}function to(e,t){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)===t){if(null===n||(n.childLanes&t)===t)break;n.childLanes|=t}else e.childLanes|=t,null!==n&&(n.childLanes|=t);e=e.return}}function no(e,t){Xi=e,Qi=Ji=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!=(e.lanes&t)&&(Ps=!0),e.firstContext=null)}function ro(e,t){if(Qi!==e&&!1!==t&&0!==t)if("number"==typeof t&&1073741823!==t||(Qi=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Ji){if(null===Xi)throw Error(s(308));Ji=t,Xi.dependencies={lanes:0,firstContext:t,responders:null}}else Ji=Ji.next=t;return e._currentValue}var io=!1;function oo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function so(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ao(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function lo(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function co(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?i=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function uo(e,t,n,r){var o=e.updateQueue;io=!1;var s=o.firstBaseUpdate,a=o.lastBaseUpdate,l=o.shared.pending;if(null!==l){o.shared.pending=null;var c=l,u=c.next;c.next=null,null===a?s=u:a.next=u,a=c;var d=e.alternate;if(null!==d){var p=(d=d.updateQueue).lastBaseUpdate;p!==a&&(null===p?d.firstBaseUpdate=u:p.next=u,d.lastBaseUpdate=c)}}if(null!==s){for(p=o.baseState,a=0,d=u=c=null;;){l=s.lane;var h=s.eventTime;if((r&l)===l){null!==d&&(d=d.next={eventTime:h,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var f=e,g=s;switch(l=t,h=n,g.tag){case 1:if("function"==typeof(f=g.payload)){p=f.call(h,p,l);break e}p=f;break e;case 3:f.flags=-4097&f.flags|64;case 0:if(null==(l="function"==typeof(f=g.payload)?f.call(h,p,l):f))break e;p=i({},p,l);break e;case 2:io=!0}}null!==s.callback&&(e.flags|=32,null===(l=o.effects)?o.effects=[s]:l.push(s))}else h={eventTime:h,lane:l,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===d?(u=d=h,c=p):d=d.next=h,a|=l;if(null===(s=s.next)){if(null===(l=o.shared.pending))break;s=l.next,l.next=null,o.lastBaseUpdate=l,o.shared.pending=null}}null===d&&(c=p),o.baseState=c,o.firstBaseUpdate=u,o.lastBaseUpdate=d,La|=a,e.lanes=a,e.memoizedState=p}}function po(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!=typeof i)throw Error(s(191,i));i.call(r)}}}var ho=(new r.Component).refs;function fo(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:i({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var go={isMounted:function(e){return!!(e=e._reactInternals)&&Xe(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ll(),i=cl(e),o=ao(r,i);o.payload=t,null!=n&&(o.callback=n),lo(e,o),ul(e,i,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ll(),i=cl(e),o=ao(r,i);o.tag=1,o.payload=t,null!=n&&(o.callback=n),lo(e,o),ul(e,i,r)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ll(),r=cl(e),i=ao(n,r);i.tag=2,null!=t&&(i.callback=t),lo(e,i),ul(e,r,n)}};function mo(e,t,n,r,i,o,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,s):!(t.prototype&&t.prototype.isPureReactComponent&&cr(n,r)&&cr(i,o))}function vo(e,t,n){var r=!1,i=ci,o=t.contextType;return"object"==typeof o&&null!==o?o=ro(o):(i=fi(t)?pi:ui.current,o=(r=null!=(r=t.contextTypes))?hi(e,i):ci),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=go,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function yo(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&go.enqueueReplaceState(t,t.state,null)}function bo(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=ho,oo(e);var o=t.contextType;"object"==typeof o&&null!==o?i.context=ro(o):(o=fi(t)?pi:ui.current,i.context=hi(e,o)),uo(e,n,i,r),i.state=e.memoizedState,"function"==typeof(o=t.getDerivedStateFromProps)&&(fo(e,t,o,n),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(t=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&go.enqueueReplaceState(i,i.state,null),uo(e,n,i,r),i.state=e.memoizedState),"function"==typeof i.componentDidMount&&(e.flags|=4)}var xo=Array.isArray;function Eo(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var r=n.stateNode}if(!r)throw Error(s(147,e));var i=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===i?t.ref:((t=function(e){var t=r.refs;t===ho&&(t=r.refs={}),null===e?delete t[i]:t[i]=e})._stringRef=i,t)}if("string"!=typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function _o(e,t){if("textarea"!==e.type)throw Error(s(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function wo(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.flags=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Gl(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags=2,n):r:(t.flags=2,n):n}function a(t){return e&&null===t.alternate&&(t.flags=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Wl(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){return null!==t&&t.elementType===n.type?((r=i(t,n.props)).ref=Eo(e,t,n),r.return=e,r):((r=ql(n.type,n.key,n.props,null,e.mode,r)).ref=Eo(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Kl(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,o){return null===t||7!==t.tag?((t=Vl(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function p(e,t,n){if("string"==typeof t||"number"==typeof t)return(t=Wl(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case _:return(n=ql(t.type,t.key,t.props,null,e.mode,n)).ref=Eo(e,null,t),n.return=e,n;case w:return(t=Kl(t,e.mode,n)).return=e,t}if(xo(t)||G(t))return(t=Vl(t,e.mode,n,null)).return=e,t;_o(e,t)}return null}function h(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n||"number"==typeof n)return null!==i?null:l(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case _:return n.key===i?n.type===S?d(e,t,n.props.children,r,i):c(e,t,n,r):null;case w:return n.key===i?u(e,t,n,r):null}if(xo(n)||G(n))return null!==i?null:d(e,t,n,r,null);_o(e,n)}return null}function f(e,t,n,r,i){if("string"==typeof r||"number"==typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case _:return e=e.get(null===r.key?n:r.key)||null,r.type===S?d(t,e,r.props.children,i,r.key):c(t,e,r,i);case w:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i)}if(xo(r)||G(r))return d(t,e=e.get(n)||null,r,i,null);_o(t,r)}return null}function g(i,s,a,l){for(var c=null,u=null,d=s,g=s=0,m=null;null!==d&&g<a.length;g++){d.index>g?(m=d,d=null):m=d.sibling;var v=h(i,d,a[g],l);if(null===v){null===d&&(d=m);break}e&&d&&null===v.alternate&&t(i,d),s=o(v,s,g),null===u?c=v:u.sibling=v,u=v,d=m}if(g===a.length)return n(i,d),c;if(null===d){for(;g<a.length;g++)null!==(d=p(i,a[g],l))&&(s=o(d,s,g),null===u?c=d:u.sibling=d,u=d);return c}for(d=r(i,d);g<a.length;g++)null!==(m=f(d,i,g,a[g],l))&&(e&&null!==m.alternate&&d.delete(null===m.key?g:m.key),s=o(m,s,g),null===u?c=m:u.sibling=m,u=m);return e&&d.forEach((function(e){return t(i,e)})),c}function m(i,a,l,c){var u=G(l);if("function"!=typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var d=u=null,g=a,m=a=0,v=null,y=l.next();null!==g&&!y.done;m++,y=l.next()){g.index>m?(v=g,g=null):v=g.sibling;var b=h(i,g,y.value,c);if(null===b){null===g&&(g=v);break}e&&g&&null===b.alternate&&t(i,g),a=o(b,a,m),null===d?u=b:d.sibling=b,d=b,g=v}if(y.done)return n(i,g),u;if(null===g){for(;!y.done;m++,y=l.next())null!==(y=p(i,y.value,c))&&(a=o(y,a,m),null===d?u=y:d.sibling=y,d=y);return u}for(g=r(i,g);!y.done;m++,y=l.next())null!==(y=f(g,i,m,y.value,c))&&(e&&null!==y.alternate&&g.delete(null===y.key?m:y.key),a=o(y,a,m),null===d?u=y:d.sibling=y,d=y);return e&&g.forEach((function(e){return t(i,e)})),u}return function(e,r,o,l){var c="object"==typeof o&&null!==o&&o.type===S&&null===o.key;c&&(o=o.props.children);var u="object"==typeof o&&null!==o;if(u)switch(o.$$typeof){case _:e:{for(u=o.key,c=r;null!==c;){if(c.key===u){switch(c.tag){case 7:if(o.type===S){n(e,c.sibling),(r=i(c,o.props.children)).return=e,e=r;break e}break;default:if(c.elementType===o.type){n(e,c.sibling),(r=i(c,o.props)).ref=Eo(e,c,o),r.return=e,e=r;break e}}n(e,c);break}t(e,c),c=c.sibling}o.type===S?((r=Vl(o.props.children,e.mode,l,o.key)).return=e,e=r):((l=ql(o.type,o.key,o.props,null,e.mode,l)).ref=Eo(e,r,o),l.return=e,e=l)}return a(e);case w:e:{for(c=o.key;null!==r;){if(r.key===c){if(4===r.tag&&r.stateNode.containerInfo===o.containerInfo&&r.stateNode.implementation===o.implementation){n(e,r.sibling),(r=i(r,o.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=Kl(o,e.mode,l)).return=e,e=r}return a(e)}if("string"==typeof o||"number"==typeof o)return o=""+o,null!==r&&6===r.tag?(n(e,r.sibling),(r=i(r,o)).return=e,e=r):(n(e,r),(r=Wl(o,e.mode,l)).return=e,e=r),a(e);if(xo(o))return g(e,r,o,l);if(G(o))return m(e,r,o,l);if(u&&_o(e,o),void 0===o&&!c)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(s(152,K(e.type)||"Component"))}return n(e,r)}}var So=wo(!0),To=wo(!1),ko={},Co=si(ko),Ao=si(ko),jo=si(ko);function Io(e){if(e===ko)throw Error(s(174));return e}function Oo(e,t){switch(li(jo,t),li(Ao,e),li(Co,ko),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:fe(null,"");break;default:t=fe(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}ai(Co),li(Co,t)}function No(){ai(Co),ai(Ao),ai(jo)}function Ro(e){Io(jo.current);var t=Io(Co.current),n=fe(t,e.type);t!==n&&(li(Ao,e),li(Co,n))}function Po(e){Ao.current===e&&(ai(Co),ai(Ao))}var Do=si(0);function Mo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Lo=null,Bo=null,Fo=!1;function Uo(e,t){var n=Ul(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Ho(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function Go(e){if(Fo){var t=Bo;if(t){var n=t;if(!Ho(e,t)){if(!(t=zr(n.nextSibling))||!Ho(e,t))return e.flags=-1025&e.flags|2,Fo=!1,void(Lo=e);Uo(Lo,n)}Lo=e,Bo=zr(t.firstChild)}else e.flags=-1025&e.flags|2,Fo=!1,Lo=e}}function qo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Lo=e}function Vo(e){if(e!==Lo)return!1;if(!Fo)return qo(e),Fo=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!Hr(t,e.memoizedProps))for(t=Bo;t;)Uo(e,t),t=zr(t.nextSibling);if(qo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){Bo=zr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}Bo=null}}else Bo=Lo?zr(e.stateNode.nextSibling):null;return!0}function zo(){Bo=Lo=null,Fo=!1}var Wo=[];function Ko(){for(var e=0;e<Wo.length;e++)Wo[e]._workInProgressVersionPrimary=null;Wo.length=0}var $o=E.ReactCurrentDispatcher,Yo=E.ReactCurrentBatchConfig,Xo=0,Jo=null,Qo=null,Zo=null,es=!1,ts=!1;function ns(){throw Error(s(321))}function rs(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ar(e[n],t[n]))return!1;return!0}function is(e,t,n,r,i,o){if(Xo=o,Jo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,$o.current=null===e||null===e.memoizedState?Is:Os,e=n(r,i),ts){o=0;do{if(ts=!1,!(25>o))throw Error(s(301));o+=1,Zo=Qo=null,t.updateQueue=null,$o.current=Ns,e=n(r,i)}while(ts)}if($o.current=js,t=null!==Qo&&null!==Qo.next,Xo=0,Zo=Qo=Jo=null,es=!1,t)throw Error(s(300));return e}function os(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Zo?Jo.memoizedState=Zo=e:Zo=Zo.next=e,Zo}function ss(){if(null===Qo){var e=Jo.alternate;e=null!==e?e.memoizedState:null}else e=Qo.next;var t=null===Zo?Jo.memoizedState:Zo.next;if(null!==t)Zo=t,Qo=e;else{if(null===e)throw Error(s(310));e={memoizedState:(Qo=e).memoizedState,baseState:Qo.baseState,baseQueue:Qo.baseQueue,queue:Qo.queue,next:null},null===Zo?Jo.memoizedState=Zo=e:Zo=Zo.next=e}return Zo}function as(e,t){return"function"==typeof t?t(e):t}function ls(e){var t=ss(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=Qo,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var a=i.next;i.next=o.next,o.next=a}r.baseQueue=i=o,n.pending=null}if(null!==i){i=i.next,r=r.baseState;var l=a=o=null,c=i;do{var u=c.lane;if((Xo&u)===u)null!==l&&(l=l.next={lane:0,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),r=c.eagerReducer===e?c.eagerState:e(r,c.action);else{var d={lane:u,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===l?(a=l=d,o=r):l=l.next=d,Jo.lanes|=u,La|=u}c=c.next}while(null!==c&&c!==i);null===l?o=r:l.next=a,ar(r,t.memoizedState)||(Ps=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=l,n.lastRenderedState=r}return[t.memoizedState,n.dispatch]}function cs(e){var t=ss(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var a=i=i.next;do{o=e(o,a.action),a=a.next}while(a!==i);ar(o,t.memoizedState)||(Ps=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function us(e,t,n){var r=t._getVersion;r=r(t._source);var i=t._workInProgressVersionPrimary;if(null!==i?e=i===r:(e=e.mutableReadLanes,(e=(Xo&e)===e)&&(t._workInProgressVersionPrimary=r,Wo.push(t))),e)return n(t._source);throw Wo.push(t),Error(s(350))}function ds(e,t,n,r){var i=ja;if(null===i)throw Error(s(349));var o=t._getVersion,a=o(t._source),l=$o.current,c=l.useState((function(){return us(i,t,n)})),u=c[1],d=c[0];c=Zo;var p=e.memoizedState,h=p.refs,f=h.getSnapshot,g=p.source;p=p.subscribe;var m=Jo;return e.memoizedState={refs:h,source:t,subscribe:r},l.useEffect((function(){h.getSnapshot=n,h.setSnapshot=u;var e=o(t._source);if(!ar(a,e)){e=n(t._source),ar(d,e)||(u(e),e=cl(m),i.mutableReadLanes|=e&i.pendingLanes),e=i.mutableReadLanes,i.entangledLanes|=e;for(var r=i.entanglements,s=e;0<s;){var l=31-Vt(s),c=1<<l;r[l]|=e,s&=~c}}}),[n,t,r]),l.useEffect((function(){return r(t._source,(function(){var e=h.getSnapshot,n=h.setSnapshot;try{n(e(t._source));var r=cl(m);i.mutableReadLanes|=r&i.pendingLanes}catch(e){n((function(){throw e}))}}))}),[t,r]),ar(f,n)&&ar(g,t)&&ar(p,r)||((e={pending:null,dispatch:null,lastRenderedReducer:as,lastRenderedState:d}).dispatch=u=As.bind(null,Jo,e),c.queue=e,c.baseQueue=null,d=us(i,t,n),c.memoizedState=c.baseState=d),d}function ps(e,t,n){return ds(ss(),e,t,n)}function hs(e){var t=os();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:as,lastRenderedState:e}).dispatch=As.bind(null,Jo,e),[t.memoizedState,e]}function fs(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=Jo.updateQueue)?(t={lastEffect:null},Jo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function gs(e){return e={current:e},os().memoizedState=e}function ms(){return ss().memoizedState}function vs(e,t,n,r){var i=os();Jo.flags|=e,i.memoizedState=fs(1|t,n,void 0,void 0===r?null:r)}function ys(e,t,n,r){var i=ss();r=void 0===r?null:r;var o=void 0;if(null!==Qo){var s=Qo.memoizedState;if(o=s.destroy,null!==r&&rs(r,s.deps))return void fs(t,n,o,r)}Jo.flags|=e,i.memoizedState=fs(1|t,n,o,r)}function bs(e,t){return vs(516,4,e,t)}function xs(e,t){return ys(516,4,e,t)}function Es(e,t){return ys(4,2,e,t)}function _s(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function ws(e,t,n){return n=null!=n?n.concat([e]):null,ys(4,2,_s.bind(null,t,e),n)}function Ss(){}function Ts(e,t){var n=ss();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&rs(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function ks(e,t){var n=ss();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&rs(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Cs(e,t){var n=Hi();qi(98>n?98:n,(function(){e(!0)})),qi(97<n?97:n,(function(){var n=Yo.transition;Yo.transition=1;try{e(!1),t()}finally{Yo.transition=n}}))}function As(e,t,n){var r=ll(),i=cl(e),o={lane:i,action:n,eagerReducer:null,eagerState:null,next:null},s=t.pending;if(null===s?o.next=o:(o.next=s.next,s.next=o),t.pending=o,s=e.alternate,e===Jo||null!==s&&s===Jo)ts=es=!0;else{if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var a=t.lastRenderedState,l=s(a,n);if(o.eagerReducer=s,o.eagerState=l,ar(l,a))return}catch(e){}ul(e,i,r)}}var js={readContext:ro,useCallback:ns,useContext:ns,useEffect:ns,useImperativeHandle:ns,useLayoutEffect:ns,useMemo:ns,useReducer:ns,useRef:ns,useState:ns,useDebugValue:ns,useDeferredValue:ns,useTransition:ns,useMutableSource:ns,useOpaqueIdentifier:ns,unstable_isNewReconciler:!1},Is={readContext:ro,useCallback:function(e,t){return os().memoizedState=[e,void 0===t?null:t],e},useContext:ro,useEffect:bs,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,vs(4,2,_s.bind(null,t,e),n)},useLayoutEffect:function(e,t){return vs(4,2,e,t)},useMemo:function(e,t){var n=os();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=os();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=As.bind(null,Jo,e),[r.memoizedState,e]},useRef:gs,useState:hs,useDebugValue:Ss,useDeferredValue:function(e){var t=hs(e),n=t[0],r=t[1];return bs((function(){var t=Yo.transition;Yo.transition=1;try{r(e)}finally{Yo.transition=t}}),[e]),n},useTransition:function(){var e=hs(!1),t=e[0];return gs(e=Cs.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,n){var r=os();return r.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:n},ds(r,e,t,n)},useOpaqueIdentifier:function(){if(Fo){var e=!1,t=function(e){return{$$typeof:D,toString:e,valueOf:e}}((function(){throw e||(e=!0,n("r:"+(Kr++).toString(36))),Error(s(355))})),n=hs(t)[1];return 0==(2&Jo.mode)&&(Jo.flags|=516,fs(5,(function(){n("r:"+(Kr++).toString(36))}),void 0,null)),t}return hs(t="r:"+(Kr++).toString(36)),t},unstable_isNewReconciler:!1},Os={readContext:ro,useCallback:Ts,useContext:ro,useEffect:xs,useImperativeHandle:ws,useLayoutEffect:Es,useMemo:ks,useReducer:ls,useRef:ms,useState:function(){return ls(as)},useDebugValue:Ss,useDeferredValue:function(e){var t=ls(as),n=t[0],r=t[1];return xs((function(){var t=Yo.transition;Yo.transition=1;try{r(e)}finally{Yo.transition=t}}),[e]),n},useTransition:function(){var e=ls(as)[0];return[ms().current,e]},useMutableSource:ps,useOpaqueIdentifier:function(){return ls(as)[0]},unstable_isNewReconciler:!1},Ns={readContext:ro,useCallback:Ts,useContext:ro,useEffect:xs,useImperativeHandle:ws,useLayoutEffect:Es,useMemo:ks,useReducer:cs,useRef:ms,useState:function(){return cs(as)},useDebugValue:Ss,useDeferredValue:function(e){var t=cs(as),n=t[0],r=t[1];return xs((function(){var t=Yo.transition;Yo.transition=1;try{r(e)}finally{Yo.transition=t}}),[e]),n},useTransition:function(){var e=cs(as)[0];return[ms().current,e]},useMutableSource:ps,useOpaqueIdentifier:function(){return cs(as)[0]},unstable_isNewReconciler:!1},Rs=E.ReactCurrentOwner,Ps=!1;function Ds(e,t,n,r){t.child=null===e?To(t,null,n,r):So(t,e.child,n,r)}function Ms(e,t,n,r,i){n=n.render;var o=t.ref;return no(t,i),r=is(e,t,n,r,o,i),null===e||Ps?(t.flags|=1,Ds(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,ta(e,t,i))}function Ls(e,t,n,r,i,o){if(null===e){var s=n.type;return"function"!=typeof s||Hl(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=ql(n.type,null,r,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,Bs(e,t,s,r,i,o))}return s=e.child,0==(i&o)&&(i=s.memoizedProps,(n=null!==(n=n.compare)?n:cr)(i,r)&&e.ref===t.ref)?ta(e,t,o):(t.flags|=1,(e=Gl(s,r)).ref=t.ref,e.return=t,t.child=e)}function Bs(e,t,n,r,i,o){if(null!==e&&cr(e.memoizedProps,r)&&e.ref===t.ref){if(Ps=!1,0==(o&i))return t.lanes=e.lanes,ta(e,t,o);0!=(16384&e.flags)&&(Ps=!0)}return Hs(e,t,n,r,o)}function Fs(e,t,n){var r=t.pendingProps,i=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode||"unstable-defer-without-hiding"===r.mode)if(0==(4&t.mode))t.memoizedState={baseLanes:0},yl(t,n);else{if(0==(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},yl(t,e),null;t.memoizedState={baseLanes:0},yl(t,null!==o?o.baseLanes:n)}else null!==o?(r=o.baseLanes|n,t.memoizedState=null):r=n,yl(t,r);return Ds(e,t,i,n),t.child}function Us(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=128)}function Hs(e,t,n,r,i){var o=fi(n)?pi:ui.current;return o=hi(t,o),no(t,i),n=is(e,t,n,r,o,i),null===e||Ps?(t.flags|=1,Ds(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,ta(e,t,i))}function Gs(e,t,n,r,i){if(fi(n)){var o=!0;yi(t)}else o=!1;if(no(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),vo(t,n,r),bo(t,n,r,i),r=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var l=s.context,c=n.contextType;c="object"==typeof c&&null!==c?ro(c):hi(t,c=fi(n)?pi:ui.current);var u=n.getDerivedStateFromProps,d="function"==typeof u||"function"==typeof s.getSnapshotBeforeUpdate;d||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a!==r||l!==c)&&yo(t,s,r,c),io=!1;var p=t.memoizedState;s.state=p,uo(t,r,s,i),l=t.memoizedState,a!==r||p!==l||di.current||io?("function"==typeof u&&(fo(t,n,u,r),l=t.memoizedState),(a=io||mo(t,n,a,r,p,l,c))?(d||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||("function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"==typeof s.componentDidMount&&(t.flags|=4)):("function"==typeof s.componentDidMount&&(t.flags|=4),t.memoizedProps=r,t.memoizedState=l),s.props=r,s.state=l,s.context=c,r=a):("function"==typeof s.componentDidMount&&(t.flags|=4),r=!1)}else{s=t.stateNode,so(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:$i(t.type,a),s.props=c,d=t.pendingProps,p=s.context,l="object"==typeof(l=n.contextType)&&null!==l?ro(l):hi(t,l=fi(n)?pi:ui.current);var h=n.getDerivedStateFromProps;(u="function"==typeof h||"function"==typeof s.getSnapshotBeforeUpdate)||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a!==d||p!==l)&&yo(t,s,r,l),io=!1,p=t.memoizedState,s.state=p,uo(t,r,s,i);var f=t.memoizedState;a!==d||p!==f||di.current||io?("function"==typeof h&&(fo(t,n,h,r),f=t.memoizedState),(c=io||mo(t,n,c,r,p,f,l))?(u||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(r,f,l),"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,f,l)),"function"==typeof s.componentDidUpdate&&(t.flags|=4),"function"==typeof s.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&p===e.memoizedState||(t.flags|=256),t.memoizedProps=r,t.memoizedState=f),s.props=r,s.state=f,s.context=l,r=c):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&p===e.memoizedState||(t.flags|=256),r=!1)}return qs(e,t,n,r,o,i)}function qs(e,t,n,r,i,o){Us(e,t);var s=0!=(64&t.flags);if(!r&&!s)return i&&bi(t,n,!1),ta(e,t,o);r=t.stateNode,Rs.current=t;var a=s&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&s?(t.child=So(t,e.child,null,o),t.child=So(t,null,a,o)):Ds(e,t,a,o),t.memoizedState=r.state,i&&bi(t,n,!0),t.child}function Vs(e){var t=e.stateNode;t.pendingContext?mi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&mi(0,t.context,!1),Oo(e,t.containerInfo)}var zs,Ws,Ks,$s,Ys={dehydrated:null,retryLane:0};function Xs(e,t,n){var r,i=t.pendingProps,o=Do.current,s=!1;return(r=0!=(64&t.flags))||(r=(null===e||null!==e.memoizedState)&&0!=(2&o)),r?(s=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===i.fallback||!0===i.unstable_avoidThisFallback||(o|=1),li(Do,1&o),null===e?(void 0!==i.fallback&&Go(t),e=i.children,o=i.fallback,s?(e=Js(t,e,o,n),t.child.memoizedState={baseLanes:n},t.memoizedState=Ys,e):"number"==typeof i.unstable_expectedLoadTime?(e=Js(t,e,o,n),t.child.memoizedState={baseLanes:n},t.memoizedState=Ys,t.lanes=33554432,e):((n=zl({mode:"visible",children:e},t.mode,n,null)).return=t,t.child=n)):(e.memoizedState,s?(i=function(e,t,n,r,i){var o=t.mode,s=e.child;e=s.sibling;var a={mode:"hidden",children:n};return 0==(2&o)&&t.child!==s?((n=t.child).childLanes=0,n.pendingProps=a,null!==(s=n.lastEffect)?(t.firstEffect=n.firstEffect,t.lastEffect=s,s.nextEffect=null):t.firstEffect=t.lastEffect=null):n=Gl(s,a),null!==e?r=Gl(e,r):(r=Vl(r,o,i,null)).flags|=2,r.return=t,n.return=t,n.sibling=r,t.child=n,r}(e,t,i.children,i.fallback,n),s=t.child,o=e.child.memoizedState,s.memoizedState=null===o?{baseLanes:n}:{baseLanes:o.baseLanes|n},s.childLanes=e.childLanes&~n,t.memoizedState=Ys,i):(n=function(e,t,n,r){var i=e.child;return e=i.sibling,n=Gl(i,{mode:"visible",children:n}),0==(2&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=n}(e,t,i.children,n),t.memoizedState=null,n))}function Js(e,t,n,r){var i=e.mode,o=e.child;return t={mode:"hidden",children:t},0==(2&i)&&null!==o?(o.childLanes=0,o.pendingProps=t):o=zl(t,i,0,null),n=Vl(n,i,r,null),o.return=e,n.return=e,o.sibling=n,e.child=o,n}function Qs(e,t){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),to(e.return,t)}function Zs(e,t,n,r,i,o){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,lastEffect:o}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i,s.lastEffect=o)}function ea(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(Ds(e,t,r.children,n),0!=(2&(r=Do.current)))r=1&r|2,t.flags|=64;else{if(null!==e&&0!=(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Qs(e,n);else if(19===e.tag)Qs(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(li(Do,r),0==(2&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===Mo(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Zs(t,!1,i,n,o,t.lastEffect);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Mo(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Zs(t,!0,n,null,o,t.lastEffect);break;case"together":Zs(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function ta(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),La|=t.lanes,0!=(n&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Gl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Gl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}return null}function na(e,t){if(!Fo)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function ra(e,t,n){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return fi(t.type)&&gi(),null;case 3:return No(),ai(di),ai(ui),Ko(),(r=t.stateNode).pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(Vo(t)?t.flags|=4:r.hydrate||(t.flags|=256)),Ws(t),null;case 5:Po(t);var o=Io(jo.current);if(n=t.type,null!==e&&null!=t.stateNode)Ks(e,t,n,r,o),e.ref!==t.ref&&(t.flags|=128);else{if(!r){if(null===t.stateNode)throw Error(s(166));return null}if(e=Io(Co.current),Vo(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[Yr]=t,r[Xr]=a,n){case"dialog":Cr("cancel",r),Cr("close",r);break;case"iframe":case"object":case"embed":Cr("load",r);break;case"video":case"audio":for(e=0;e<wr.length;e++)Cr(wr[e],r);break;case"source":Cr("error",r);break;case"img":case"image":case"link":Cr("error",r),Cr("load",r);break;case"details":Cr("toggle",r);break;case"input":ee(r,a),Cr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},Cr("invalid",r);break;case"textarea":le(r,a),Cr("invalid",r)}for(var c in Se(n,a),e=null,a)a.hasOwnProperty(c)&&(o=a[c],"children"===c?"string"==typeof o?r.textContent!==o&&(e=["children",o]):"number"==typeof o&&r.textContent!==""+o&&(e=["children",""+o]):l.hasOwnProperty(c)&&null!=o&&"onScroll"===c&&Cr("scroll",r));switch(n){case"input":X(r),re(r,a,!0);break;case"textarea":X(r),ue(r);break;case"select":case"option":break;default:"function"==typeof a.onClick&&(r.onclick=Lr)}r=e,t.updateQueue=r,null!==r&&(t.flags|=4)}else{switch(c=9===o.nodeType?o:o.ownerDocument,e===de&&(e=he(n)),e===de?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=c.createElement(n,{is:r.is}):(e=c.createElement(n),"select"===n&&(c=e,r.multiple?c.multiple=!0:r.size&&(c.size=r.size))):e=c.createElementNS(e,n),e[Yr]=t,e[Xr]=r,zs(e,t,!1,!1),t.stateNode=e,c=Te(n,r),n){case"dialog":Cr("cancel",e),Cr("close",e),o=r;break;case"iframe":case"object":case"embed":Cr("load",e),o=r;break;case"video":case"audio":for(o=0;o<wr.length;o++)Cr(wr[o],e);o=r;break;case"source":Cr("error",e),o=r;break;case"img":case"image":case"link":Cr("error",e),Cr("load",e),o=r;break;case"details":Cr("toggle",e),o=r;break;case"input":ee(e,r),o=Z(e,r),Cr("invalid",e);break;case"option":o=oe(e,r);break;case"select":e._wrapperState={wasMultiple:!!r.multiple},o=i({},r,{value:void 0}),Cr("invalid",e);break;case"textarea":le(e,r),o=ae(e,r),Cr("invalid",e);break;default:o=r}Se(n,o);var u=o;for(a in u)if(u.hasOwnProperty(a)){var d=u[a];"style"===a?_e(e,d):"dangerouslySetInnerHTML"===a?null!=(d=d?d.__html:void 0)&&ve(e,d):"children"===a?"string"==typeof d?("textarea"!==n||""!==d)&&ye(e,d):"number"==typeof d&&ye(e,""+d):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(l.hasOwnProperty(a)?null!=d&&"onScroll"===a&&Cr("scroll",e):null!=d&&x(e,a,d,c))}switch(n){case"input":X(e),re(e,r,!1);break;case"textarea":X(e),ue(e);break;case"option":null!=r.value&&e.setAttribute("value",""+$(r.value));break;case"select":e.multiple=!!r.multiple,null!=(a=r.value)?se(e,!!r.multiple,a,!1):null!=r.defaultValue&&se(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof o.onClick&&(e.onclick=Lr)}Ur(n,r)&&(t.flags|=4)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)$s(e,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(s(166));n=Io(jo.current),Io(Co.current),Vo(t)?(r=t.stateNode,n=t.memoizedProps,r[Yr]=t,r.nodeValue!==n&&(t.flags|=4)):((r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[Yr]=t,t.stateNode=r)}return null;case 13:return ai(Do),r=t.memoizedState,0!=(64&t.flags)?(t.lanes=n,t):(r=null!==r,n=!1,null===e?void 0!==t.memoizedProps.fallback&&Vo(t):n=null!==e.memoizedState,r&&!n&&0!=(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!=(1&Do.current)?0===Pa&&(Pa=3):(0!==Pa&&3!==Pa||(Pa=4),null===ja||0==(134217727&La)&&0==(134217727&Ba)||fl(ja,Oa))),(r||n)&&(t.flags|=4),null);case 4:return No(),Ws(t),null===e&&jr(t.stateNode.containerInfo),null;case 10:return eo(t),null;case 17:return fi(t.type)&&gi(),null;case 19:if(ai(Do),null===(r=t.memoizedState))return null;if(a=0!=(64&t.flags),null===(c=r.rendering))if(a)na(r,!1);else{if(0!==Pa||null!==e&&0!=(64&e.flags))for(e=t.child;null!==e;){if(null!==(c=Mo(e))){for(t.flags|=64,na(r,!1),null!==(a=c.updateQueue)&&(t.updateQueue=a,t.flags|=4),null===r.lastEffect&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=n,n=t.child;null!==n;)e=r,(a=n).flags&=2,a.nextEffect=null,a.firstEffect=null,a.lastEffect=null,null===(c=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,e=c.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return li(Do,1&Do.current|2),t.child}e=e.sibling}null!==r.tail&&Ui()>Ga&&(t.flags|=64,a=!0,na(r,!1),t.lanes=33554432)}else{if(!a)if(null!==(e=Mo(c))){if(t.flags|=64,a=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),na(r,!0),null===r.tail&&"hidden"===r.tailMode&&!c.alternate&&!Fo)return null!==(t=t.lastEffect=r.lastEffect)&&(t.nextEffect=null),null}else 2*Ui()-r.renderingStartTime>Ga&&1073741824!==n&&(t.flags|=64,a=!0,na(r,!1),t.lanes=33554432);r.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=r.last)?n.sibling=c:t.child=c,r.last=c)}return null!==r.tail?(n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=Ui(),n.sibling=null,t=Do.current,li(Do,a?1&t|2:1&t),n):null;case 23:case 24:return bl(),null!==e&&null!==e.memoizedState!=(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==r.mode&&(t.flags|=4),null}throw Error(s(156,t.tag))}function ia(e){switch(e.tag){case 1:fi(e.type)&&gi();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(No(),ai(di),ai(ui),Ko(),0!=(64&(t=e.flags)))throw Error(s(285));return e.flags=-4097&t|64,e;case 5:return Po(e),null;case 13:return ai(Do),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return ai(Do),null;case 4:return No(),null;case 10:return eo(e),null;case 23:case 24:return bl(),null;default:return null}}function oa(e,t){try{var n="",r=t;do{n+=W(r),r=r.return}while(r);var i=n}catch(e){i="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:i}}function sa(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}zs=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ws=function(){},Ks=function(e,t,n,r){var o=e.memoizedProps;if(o!==r){e=t.stateNode,Io(Co.current);var s,a=null;switch(n){case"input":o=Z(e,o),r=Z(e,r),a=[];break;case"option":o=oe(e,o),r=oe(e,r),a=[];break;case"select":o=i({},o,{value:void 0}),r=i({},r,{value:void 0}),a=[];break;case"textarea":o=ae(e,o),r=ae(e,r),a=[];break;default:"function"!=typeof o.onClick&&"function"==typeof r.onClick&&(e.onclick=Lr)}for(d in Se(n,r),n=null,o)if(!r.hasOwnProperty(d)&&o.hasOwnProperty(d)&&null!=o[d])if("style"===d){var c=o[d];for(s in c)c.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(l.hasOwnProperty(d)?a||(a=[]):(a=a||[]).push(d,null));for(d in r){var u=r[d];if(c=null!=o?o[d]:void 0,r.hasOwnProperty(d)&&u!==c&&(null!=u||null!=c))if("style"===d)if(c){for(s in c)!c.hasOwnProperty(s)||u&&u.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in u)u.hasOwnProperty(s)&&c[s]!==u[s]&&(n||(n={}),n[s]=u[s])}else n||(a||(a=[]),a.push(d,n)),n=u;else"dangerouslySetInnerHTML"===d?(u=u?u.__html:void 0,c=c?c.__html:void 0,null!=u&&c!==u&&(a=a||[]).push(d,u)):"children"===d?"string"!=typeof u&&"number"!=typeof u||(a=a||[]).push(d,""+u):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(l.hasOwnProperty(d)?(null!=u&&"onScroll"===d&&Cr("scroll",e),a||c===u||(a=[])):"object"==typeof u&&null!==u&&u.$$typeof===D?u.toString():(a=a||[]).push(d,u))}n&&(a=a||[]).push("style",n);var d=a;(t.updateQueue=d)&&(t.flags|=4)}},$s=function(e,t,n,r){n!==r&&(t.flags|=4)};var aa="function"==typeof WeakMap?WeakMap:Map;function la(e,t,n){(n=ao(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Wa||(Wa=!0,Ka=r),sa(e,t)},n}function ca(e,t,n){(n=ao(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var i=t.value;n.payload=function(){return sa(e,t),r(i)}}var o=e.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(n.callback=function(){"function"!=typeof r&&(null===$a?$a=new Set([this]):$a.add(this),sa(e,t));var n=t.stack;this.componentDidCatch(t.value,{componentStack:null!==n?n:""})}),n}var ua="function"==typeof WeakSet?WeakSet:Set;function da(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){Ml(e,t)}else t.current=null}function pa(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.flags&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:$i(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(256&t.flags&&Vr(t.stateNode.containerInfo));case 5:case 6:case 4:case 17:return}throw Error(s(163))}function ha(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3==(3&e.tag)){var r=e.create;e.destroy=r()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var i=e;r=i.next,0!=(4&(i=i.tag))&&0!=(1&i)&&(Rl(n,e),Nl(n,e)),e=r}while(e!==t)}return;case 1:return e=n.stateNode,4&n.flags&&(null===t?e.componentDidMount():(r=n.elementType===n.type?t.memoizedProps:$i(n.type,t.memoizedProps),e.componentDidUpdate(r,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=n.updateQueue)&&po(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}po(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.flags&&Ur(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&_t(n)))));case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(s(163))}function fa(e,t){for(var n=e;;){if(5===n.tag){var r=n.stateNode;if(t)"function"==typeof(r=r.style).setProperty?r.setProperty("display","none","important"):r.display="none";else{r=n.stateNode;var i=n.memoizedProps.style;i=null!=i&&i.hasOwnProperty("display")?i.display:null,r.style.display=Ee("display",i)}}else if(6===n.tag)n.stateNode.nodeValue=t?"":n.memoizedProps;else if((23!==n.tag&&24!==n.tag||null===n.memoizedState||n===e)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function ga(e,t){if(Ei&&"function"==typeof Ei.onCommitFiberUnmount)try{Ei.onCommitFiberUnmount(xi,t)}catch(e){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var n=e=e.next;do{var r=n,i=r.destroy;if(r=r.tag,void 0!==i)if(0!=(4&r))Rl(t,n);else{r=t;try{i()}catch(e){Ml(r,e)}}n=n.next}while(n!==e)}break;case 1:if(da(t),"function"==typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(e){Ml(t,e)}break;case 5:da(t);break;case 4:Ea(e,t)}}function ma(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function va(e){return 5===e.tag||3===e.tag||4===e.tag}function ya(e){e:{for(var t=e.return;null!==t;){if(va(t))break e;t=t.return}throw Error(s(160))}var n=t;switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(s(161))}16&n.flags&&(ye(t,""),n.flags&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||va(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.flags)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.flags)){n=n.stateNode;break e}}r?ba(e,n,t):xa(e,n,t)}function ba(e,t,n){var r=e.tag,i=5===r||6===r;if(i)e=i?e.stateNode:e.stateNode.instance,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Lr));else if(4!==r&&null!==(e=e.child))for(ba(e,t,n),e=e.sibling;null!==e;)ba(e,t,n),e=e.sibling}function xa(e,t,n){var r=e.tag,i=5===r||6===r;if(i)e=i?e.stateNode:e.stateNode.instance,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(xa(e,t,n),e=e.sibling;null!==e;)xa(e,t,n),e=e.sibling}function Ea(e,t){for(var n,r,i=t,o=!1;;){if(!o){o=i.return;e:for(;;){if(null===o)throw Error(s(160));switch(n=o.stateNode,o.tag){case 5:r=!1;break e;case 3:case 4:n=n.containerInfo,r=!0;break e}o=o.return}o=!0}if(5===i.tag||6===i.tag){e:for(var a=e,l=i,c=l;;)if(ga(a,c),null!==c.child&&4!==c.tag)c.child.return=c,c=c.child;else{if(c===l)break e;for(;null===c.sibling;){if(null===c.return||c.return===l)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}r?(a=n,l=i.stateNode,8===a.nodeType?a.parentNode.removeChild(l):a.removeChild(l)):n.removeChild(i.stateNode)}else if(4===i.tag){if(null!==i.child){n=i.stateNode.containerInfo,r=!0,i.child.return=i,i=i.child;continue}}else if(ga(e,i),null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;4===(i=i.return).tag&&(o=!1)}i.sibling.return=i.return,i=i.sibling}}function _a(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{3==(3&r.tag)&&(e=r.destroy,r.destroy=void 0,void 0!==e&&e()),r=r.next}while(r!==n)}return;case 1:return;case 5:if(null!=(n=t.stateNode)){r=t.memoizedProps;var i=null!==e?e.memoizedProps:r;e=t.type;var o=t.updateQueue;if(t.updateQueue=null,null!==o){for(n[Xr]=r,"input"===e&&"radio"===r.type&&null!=r.name&&te(n,r),Te(e,i),t=Te(e,r),i=0;i<o.length;i+=2){var a=o[i],l=o[i+1];"style"===a?_e(n,l):"dangerouslySetInnerHTML"===a?ve(n,l):"children"===a?ye(n,l):x(n,a,l,t)}switch(e){case"input":ne(n,r);break;case"textarea":ce(n,r);break;case"select":e=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(o=r.value)?se(n,!!r.multiple,o,!1):e!==!!r.multiple&&(null!=r.defaultValue?se(n,!!r.multiple,r.defaultValue,!0):se(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(s(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((n=t.stateNode).hydrate&&(n.hydrate=!1,_t(n.containerInfo)));case 12:return;case 13:return null!==t.memoizedState&&(Ha=Ui(),fa(t.child,!0)),void wa(t);case 19:return void wa(t);case 17:return;case 23:case 24:return void fa(t,null!==t.memoizedState)}throw Error(s(163))}function wa(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new ua),t.forEach((function(t){var r=Bl.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function Sa(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&null!==(t=t.memoizedState)&&null===t.dehydrated}var Ta=Math.ceil,ka=E.ReactCurrentDispatcher,Ca=E.ReactCurrentOwner,Aa=0,ja=null,Ia=null,Oa=0,Na=0,Ra=si(0),Pa=0,Da=null,Ma=0,La=0,Ba=0,Fa=0,Ua=null,Ha=0,Ga=1/0;function qa(){Ga=Ui()+500}var Va,za=null,Wa=!1,Ka=null,$a=null,Ya=!1,Xa=null,Ja=90,Qa=[],Za=[],el=null,tl=0,nl=null,rl=-1,il=0,ol=0,sl=null,al=!1;function ll(){return 0!=(48&Aa)?Ui():-1!==rl?rl:rl=Ui()}function cl(e){if(0==(2&(e=e.mode)))return 1;if(0==(4&e))return 99===Hi()?1:2;if(0===il&&(il=Ma),0!==Ki.transition){0!==ol&&(ol=null!==Ua?Ua.pendingLanes:0),e=il;var t=4186112&~ol;return 0==(t&=-t)&&0==(t=(e=4186112&~e)&-e)&&(t=8192),t}return e=Hi(),e=Ut(0!=(4&Aa)&&98===e?12:e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),il)}function ul(e,t,n){if(50<tl)throw tl=0,nl=null,Error(s(185));if(null===(e=dl(e,t)))return null;qt(e,t,n),e===ja&&(Ba|=t,4===Pa&&fl(e,Oa));var r=Hi();1===t?0!=(8&Aa)&&0==(48&Aa)?gl(e):(pl(e,n),0===Aa&&(qa(),zi())):(0==(4&Aa)||98!==r&&99!==r||(null===el?el=new Set([e]):el.add(e)),pl(e,n)),Ua=e}function dl(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function pl(e,t){for(var n=e.callbackNode,r=e.suspendedLanes,i=e.pingedLanes,o=e.expirationTimes,a=e.pendingLanes;0<a;){var l=31-Vt(a),c=1<<l,u=o[l];if(-1===u){if(0==(c&r)||0!=(c&i)){u=t,Lt(c);var d=Mt;o[l]=10<=d?u+250:6<=d?u+5e3:-1}}else u<=t&&(e.expiredLanes|=c);a&=~c}if(r=Bt(e,e===ja?Oa:0),t=Mt,0===r)null!==n&&(n!==Pi&&Si(n),e.callbackNode=null,e.callbackPriority=0);else{if(null!==n){if(e.callbackPriority===t)return;n!==Pi&&Si(n)}15===t?(n=gl.bind(null,e),null===Mi?(Mi=[n],Li=wi(ji,Wi)):Mi.push(n),n=Pi):n=14===t?Vi(99,gl.bind(null,e)):Vi(n=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(s(358,e))}}(t),hl.bind(null,e)),e.callbackPriority=t,e.callbackNode=n}}function hl(e){if(rl=-1,ol=il=0,0!=(48&Aa))throw Error(s(327));var t=e.callbackNode;if(Ol()&&e.callbackNode!==t)return null;var n=Bt(e,e===ja?Oa:0);if(0===n)return null;var r=n,i=Aa;Aa|=16;var o=_l();for(ja===e&&Oa===r||(qa(),xl(e,r));;)try{Tl();break}catch(t){El(e,t)}if(Zi(),ka.current=o,Aa=i,null!==Ia?r=0:(ja=null,Oa=0,r=Pa),0!=(Ma&Ba))xl(e,0);else if(0!==r){if(2===r&&(Aa|=64,e.hydrate&&(e.hydrate=!1,Vr(e.containerInfo)),0!==(n=Ft(e))&&(r=wl(e,n))),1===r)throw t=Da,xl(e,0),fl(e,n),pl(e,Ui()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=n,r){case 0:case 1:throw Error(s(345));case 2:Al(e);break;case 3:if(fl(e,n),(62914560&n)===n&&10<(r=Ha+500-Ui())){if(0!==Bt(e,0))break;if(((i=e.suspendedLanes)&n)!==n){ll(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=Gr(Al.bind(null,e),r);break}Al(e);break;case 4:if(fl(e,n),(4186112&n)===n)break;for(r=e.eventTimes,i=-1;0<n;){var a=31-Vt(n);o=1<<a,(a=r[a])>i&&(i=a),n&=~o}if(n=i,10<(n=(120>(n=Ui()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Ta(n/1960))-n)){e.timeoutHandle=Gr(Al.bind(null,e),n);break}Al(e);break;case 5:Al(e);break;default:throw Error(s(329))}}return pl(e,Ui()),e.callbackNode===t?hl.bind(null,e):null}function fl(e,t){for(t&=~Fa,t&=~Ba,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Vt(t),r=1<<n;e[n]=-1,t&=~r}}function gl(e){if(0!=(48&Aa))throw Error(s(327));if(Ol(),e===ja&&0!=(e.expiredLanes&Oa)){var t=Oa,n=wl(e,t);0!=(Ma&Ba)&&(n=wl(e,t=Bt(e,t)))}else n=wl(e,t=Bt(e,0));if(0!==e.tag&&2===n&&(Aa|=64,e.hydrate&&(e.hydrate=!1,Vr(e.containerInfo)),0!==(t=Ft(e))&&(n=wl(e,t))),1===n)throw n=Da,xl(e,0),fl(e,t),pl(e,Ui()),n;return e.finishedWork=e.current.alternate,e.finishedLanes=t,Al(e),pl(e,Ui()),null}function ml(e,t){var n=Aa;Aa|=1;try{return e(t)}finally{0===(Aa=n)&&(qa(),zi())}}function vl(e,t){var n=Aa;Aa&=-2,Aa|=8;try{return e(t)}finally{0===(Aa=n)&&(qa(),zi())}}function yl(e,t){li(Ra,Na),Na|=t,Ma|=t}function bl(){Na=Ra.current,ai(Ra)}function xl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,qr(n)),null!==Ia)for(n=Ia.return;null!==n;){var r=n;switch(r.tag){case 1:null!=(r=r.type.childContextTypes)&&gi();break;case 3:No(),ai(di),ai(ui),Ko();break;case 5:Po(r);break;case 4:No();break;case 13:case 19:ai(Do);break;case 10:eo(r);break;case 23:case 24:bl()}n=n.return}ja=e,Ia=Gl(e.current,null),Oa=Na=Ma=t,Pa=0,Da=null,Fa=Ba=La=0}function El(e,t){for(;;){var n=Ia;try{if(Zi(),$o.current=js,es){for(var r=Jo.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}es=!1}if(Xo=0,Zo=Qo=Jo=null,ts=!1,Ca.current=null,null===n||null===n.return){Pa=1,Da=t,Ia=null;break}e:{var o=e,s=n.return,a=n,l=t;if(t=Oa,a.flags|=2048,a.firstEffect=a.lastEffect=null,null!==l&&"object"==typeof l&&"function"==typeof l.then){var c=l;if(0==(2&a.mode)){var u=a.alternate;u?(a.updateQueue=u.updateQueue,a.memoizedState=u.memoizedState,a.lanes=u.lanes):(a.updateQueue=null,a.memoizedState=null)}var d=0!=(1&Do.current),p=s;do{var h;if(h=13===p.tag){var f=p.memoizedState;if(null!==f)h=null!==f.dehydrated;else{var g=p.memoizedProps;h=void 0!==g.fallback&&(!0!==g.unstable_avoidThisFallback||!d)}}if(h){var m=p.updateQueue;if(null===m){var v=new Set;v.add(c),p.updateQueue=v}else m.add(c);if(0==(2&p.mode)){if(p.flags|=64,a.flags|=16384,a.flags&=-2981,1===a.tag)if(null===a.alternate)a.tag=17;else{var y=ao(-1,1);y.tag=2,lo(a,y)}a.lanes|=1;break e}l=void 0,a=t;var b=o.pingCache;if(null===b?(b=o.pingCache=new aa,l=new Set,b.set(c,l)):void 0===(l=b.get(c))&&(l=new Set,b.set(c,l)),!l.has(a)){l.add(a);var x=Ll.bind(null,o,c,a);c.then(x,x)}p.flags|=4096,p.lanes=t;break e}p=p.return}while(null!==p);l=Error((K(a.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==Pa&&(Pa=2),l=oa(l,a),p=s;do{switch(p.tag){case 3:o=l,p.flags|=4096,t&=-t,p.lanes|=t,co(p,la(p,o,t));break e;case 1:o=l;var E=p.type,_=p.stateNode;if(0==(64&p.flags)&&("function"==typeof E.getDerivedStateFromError||null!==_&&"function"==typeof _.componentDidCatch&&(null===$a||!$a.has(_)))){p.flags|=4096,t&=-t,p.lanes|=t,co(p,ca(p,o,t));break e}}p=p.return}while(null!==p)}Cl(n)}catch(e){t=e,Ia===n&&null!==n&&(Ia=n=n.return);continue}break}}function _l(){var e=ka.current;return ka.current=js,null===e?js:e}function wl(e,t){var n=Aa;Aa|=16;var r=_l();for(ja===e&&Oa===t||xl(e,t);;)try{Sl();break}catch(t){El(e,t)}if(Zi(),Aa=n,ka.current=r,null!==Ia)throw Error(s(261));return ja=null,Oa=0,Pa}function Sl(){for(;null!==Ia;)kl(Ia)}function Tl(){for(;null!==Ia&&!Ti();)kl(Ia)}function kl(e){var t=Va(e.alternate,e,Na);e.memoizedProps=e.pendingProps,null===t?Cl(e):Ia=t,Ca.current=null}function Cl(e){var t=e;do{var n=t.alternate;if(e=t.return,0==(2048&t.flags)){if(null!==(n=ra(n,t,Na)))return void(Ia=n);if(24!==(n=t).tag&&23!==n.tag||null===n.memoizedState||0!=(1073741824&Na)||0==(4&n.mode)){for(var r=0,i=n.child;null!==i;)r|=i.lanes|i.childLanes,i=i.sibling;n.childLanes=r}null!==e&&0==(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(n=ia(t)))return n.flags&=2047,void(Ia=n);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(Ia=t);Ia=t=e}while(null!==t);0===Pa&&(Pa=5)}function Al(e){var t=Hi();return qi(99,jl.bind(null,e,t)),null}function jl(e,t){do{Ol()}while(null!==Xa);if(0!=(48&Aa))throw Error(s(327));var n=e.finishedWork;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(s(177));e.callbackNode=null;var r=n.lanes|n.childLanes,i=r,o=e.pendingLanes&~i;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=i,e.mutableReadLanes&=i,e.entangledLanes&=i,i=e.entanglements;for(var a=e.eventTimes,l=e.expirationTimes;0<o;){var c=31-Vt(o),u=1<<c;i[c]=0,a[c]=-1,l[c]=-1,o&=~u}if(null!==el&&0==(24&r)&&el.has(e)&&el.delete(e),e===ja&&(Ia=ja=null,Oa=0),1<n.flags?null!==n.lastEffect?(n.lastEffect.nextEffect=n,r=n.firstEffect):r=n:r=n.firstEffect,null!==r){if(i=Aa,Aa|=32,Ca.current=null,Br=Yt,fr(a=hr())){if("selectionStart"in a)l={start:a.selectionStart,end:a.selectionEnd};else e:if(l=(l=a.ownerDocument)&&l.defaultView||window,(u=l.getSelection&&l.getSelection())&&0!==u.rangeCount){l=u.anchorNode,o=u.anchorOffset,c=u.focusNode,u=u.focusOffset;try{l.nodeType,c.nodeType}catch(e){l=null;break e}var d=0,p=-1,h=-1,f=0,g=0,m=a,v=null;t:for(;;){for(var y;m!==l||0!==o&&3!==m.nodeType||(p=d+o),m!==c||0!==u&&3!==m.nodeType||(h=d+u),3===m.nodeType&&(d+=m.nodeValue.length),null!==(y=m.firstChild);)v=m,m=y;for(;;){if(m===a)break t;if(v===l&&++f===o&&(p=d),v===c&&++g===u&&(h=d),null!==(y=m.nextSibling))break;v=(m=v).parentNode}m=y}l=-1===p||-1===h?null:{start:p,end:h}}else l=null;l=l||{start:0,end:0}}else l=null;Fr={focusedElem:a,selectionRange:l},Yt=!1,sl=null,al=!1,za=r;do{try{Il()}catch(e){if(null===za)throw Error(s(330));Ml(za,e),za=za.nextEffect}}while(null!==za);sl=null,za=r;do{try{for(a=e;null!==za;){var b=za.flags;if(16&b&&ye(za.stateNode,""),128&b){var x=za.alternate;if(null!==x){var E=x.ref;null!==E&&("function"==typeof E?E(null):E.current=null)}}switch(1038&b){case 2:ya(za),za.flags&=-3;break;case 6:ya(za),za.flags&=-3,_a(za.alternate,za);break;case 1024:za.flags&=-1025;break;case 1028:za.flags&=-1025,_a(za.alternate,za);break;case 4:_a(za.alternate,za);break;case 8:Ea(a,l=za);var _=l.alternate;ma(l),null!==_&&ma(_)}za=za.nextEffect}}catch(e){if(null===za)throw Error(s(330));Ml(za,e),za=za.nextEffect}}while(null!==za);if(E=Fr,x=hr(),b=E.focusedElem,a=E.selectionRange,x!==b&&b&&b.ownerDocument&&pr(b.ownerDocument.documentElement,b)){null!==a&&fr(b)&&(x=a.start,void 0===(E=a.end)&&(E=x),"selectionStart"in b?(b.selectionStart=x,b.selectionEnd=Math.min(E,b.value.length)):(E=(x=b.ownerDocument||document)&&x.defaultView||window).getSelection&&(E=E.getSelection(),l=b.textContent.length,_=Math.min(a.start,l),a=void 0===a.end?_:Math.min(a.end,l),!E.extend&&_>a&&(l=a,a=_,_=l),l=dr(b,_),o=dr(b,a),l&&o&&(1!==E.rangeCount||E.anchorNode!==l.node||E.anchorOffset!==l.offset||E.focusNode!==o.node||E.focusOffset!==o.offset)&&((x=x.createRange()).setStart(l.node,l.offset),E.removeAllRanges(),_>a?(E.addRange(x),E.extend(o.node,o.offset)):(x.setEnd(o.node,o.offset),E.addRange(x))))),x=[];for(E=b;E=E.parentNode;)1===E.nodeType&&x.push({element:E,left:E.scrollLeft,top:E.scrollTop});for("function"==typeof b.focus&&b.focus(),b=0;b<x.length;b++)(E=x[b]).element.scrollLeft=E.left,E.element.scrollTop=E.top}Yt=!!Br,Fr=Br=null,e.current=n,za=r;do{try{for(b=e;null!==za;){var w=za.flags;if(36&w&&ha(b,za.alternate,za),128&w){x=void 0;var S=za.ref;if(null!==S){var T=za.stateNode;switch(za.tag){case 5:x=T;break;default:x=T}"function"==typeof S?S(x):S.current=x}}za=za.nextEffect}}catch(e){if(null===za)throw Error(s(330));Ml(za,e),za=za.nextEffect}}while(null!==za);za=null,Di(),Aa=i}else e.current=n;if(Ya)Ya=!1,Xa=e,Ja=t;else for(za=r;null!==za;)t=za.nextEffect,za.nextEffect=null,8&za.flags&&((w=za).sibling=null,w.stateNode=null),za=t;if(0===(r=e.pendingLanes)&&($a=null),1===r?e===nl?tl++:(tl=0,nl=e):tl=0,n=n.stateNode,Ei&&"function"==typeof Ei.onCommitFiberRoot)try{Ei.onCommitFiberRoot(xi,n,void 0,64==(64&n.current.flags))}catch(e){}if(pl(e,Ui()),Wa)throw Wa=!1,e=Ka,Ka=null,e;return 0!=(8&Aa)||zi(),null}function Il(){for(;null!==za;){var e=za.alternate;al||null===sl||(0!=(8&za.flags)?et(za,sl)&&(al=!0):13===za.tag&&Sa(e,za)&&et(za,sl)&&(al=!0));var t=za.flags;0!=(256&t)&&pa(e,za),0==(512&t)||Ya||(Ya=!0,Vi(97,(function(){return Ol(),null}))),za=za.nextEffect}}function Ol(){if(90!==Ja){var e=97<Ja?97:Ja;return Ja=90,qi(e,Pl)}return!1}function Nl(e,t){Qa.push(t,e),Ya||(Ya=!0,Vi(97,(function(){return Ol(),null})))}function Rl(e,t){Za.push(t,e),Ya||(Ya=!0,Vi(97,(function(){return Ol(),null})))}function Pl(){if(null===Xa)return!1;var e=Xa;if(Xa=null,0!=(48&Aa))throw Error(s(331));var t=Aa;Aa|=32;var n=Za;Za=[];for(var r=0;r<n.length;r+=2){var i=n[r],o=n[r+1],a=i.destroy;if(i.destroy=void 0,"function"==typeof a)try{a()}catch(e){if(null===o)throw Error(s(330));Ml(o,e)}}for(n=Qa,Qa=[],r=0;r<n.length;r+=2){i=n[r],o=n[r+1];try{var l=i.create;i.destroy=l()}catch(e){if(null===o)throw Error(s(330));Ml(o,e)}}for(l=e.current.firstEffect;null!==l;)e=l.nextEffect,l.nextEffect=null,8&l.flags&&(l.sibling=null,l.stateNode=null),l=e;return Aa=t,zi(),!0}function Dl(e,t,n){lo(e,t=la(e,t=oa(n,t),1)),t=ll(),null!==(e=dl(e,1))&&(qt(e,1,t),pl(e,t))}function Ml(e,t){if(3===e.tag)Dl(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){Dl(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"==typeof n.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===$a||!$a.has(r))){var i=ca(n,e=oa(t,e),1);if(lo(n,i),i=ll(),null!==(n=dl(n,1)))qt(n,1,i),pl(n,i);else if("function"==typeof r.componentDidCatch&&(null===$a||!$a.has(r)))try{r.componentDidCatch(t,e)}catch(e){}break}}n=n.return}}function Ll(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ll(),e.pingedLanes|=e.suspendedLanes&n,ja===e&&(Oa&n)===n&&(4===Pa||3===Pa&&(62914560&Oa)===Oa&&500>Ui()-Ha?xl(e,0):Fa|=n),pl(e,t)}function Bl(e,t){var n=e.stateNode;null!==n&&n.delete(t),0==(t=0)&&(0==(2&(t=e.mode))?t=1:0==(4&t)?t=99===Hi()?1:2:(0===il&&(il=Ma),0===(t=Ht(62914560&~il))&&(t=4194304))),n=ll(),null!==(e=dl(e,t))&&(qt(e,t,n),pl(e,n))}function Fl(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Ul(e,t,n,r){return new Fl(e,t,n,r)}function Hl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Gl(e,t){var n=e.alternate;return null===n?((n=Ul(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function ql(e,t,n,r,i,o){var a=2;if(r=e,"function"==typeof e)Hl(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case S:return Vl(n.children,i,o,t);case M:a=8,i|=16;break;case T:a=8,i|=1;break;case k:return(e=Ul(12,n,t,8|i)).elementType=k,e.type=k,e.lanes=o,e;case I:return(e=Ul(13,n,t,i)).type=I,e.elementType=I,e.lanes=o,e;case O:return(e=Ul(19,n,t,i)).elementType=O,e.lanes=o,e;case L:return zl(n,i,o,t);case B:return(e=Ul(24,n,t,i)).elementType=B,e.lanes=o,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case C:a=10;break e;case A:a=9;break e;case j:a=11;break e;case N:a=14;break e;case R:a=16,r=null;break e;case P:a=22;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Ul(a,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function Vl(e,t,n,r){return(e=Ul(7,e,r,t)).lanes=n,e}function zl(e,t,n,r){return(e=Ul(23,e,r,t)).elementType=L,e.lanes=n,e}function Wl(e,t,n){return(e=Ul(6,e,null,t)).lanes=n,e}function Kl(e,t,n){return(t=Ul(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function $l(e,t,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Gt(0),this.expirationTimes=Gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Gt(0),this.mutableSourceEagerHydrationData=null}function Yl(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function Xl(e,t,n,r){var i=t.current,o=ll(),a=cl(i);e:if(n){t:{if(Xe(n=n._reactInternals)!==n||1!==n.tag)throw Error(s(170));var l=n;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(fi(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(null!==l);throw Error(s(171))}if(1===n.tag){var c=n.type;if(fi(c)){n=vi(n,c,l);break e}}n=l}else n=ci;return null===t.context?t.context=n:t.pendingContext=n,(t=ao(o,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),lo(i,t),ul(i,a,o),a}function Jl(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function Ql(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Zl(e,t){Ql(e,t),(e=e.alternate)&&Ql(e,t)}function ec(e,t,n){var r=null!=n&&null!=n.hydrationOptions&&n.hydrationOptions.mutableSources||null;if(n=new $l(e,t,null!=n&&!0===n.hydrate),t=Ul(3,null,null,2===t?7:1===t?3:0),n.current=t,t.stateNode=n,oo(t),e[Jr]=n.current,jr(8===e.nodeType?e.parentNode:e),r)for(e=0;e<r.length;e++){var i=(t=r[e])._getVersion;i=i(t._source),null==n.mutableSourceEagerHydrationData?n.mutableSourceEagerHydrationData=[t,i]:n.mutableSourceEagerHydrationData.push(t,i)}this._internalRoot=n}function tc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function nc(e,t,n,r,i){var o=n._reactRootContainer;if(o){var s=o._internalRoot;if("function"==typeof i){var a=i;i=function(){var e=Jl(s);a.call(e)}}Xl(t,s,e,i)}else{if(o=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new ec(e,0,t?{hydrate:!0}:void 0)}(n,r),s=o._internalRoot,"function"==typeof i){var l=i;i=function(){var e=Jl(s);l.call(e)}}vl((function(){Xl(t,s,e,i)}))}return Jl(s)}function rc(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!tc(t))throw Error(s(200));return Yl(e,t,null,n)}Va=function(e,t,n){var r=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||di.current)Ps=!0;else{if(0==(n&r)){switch(Ps=!1,t.tag){case 3:Vs(t),zo();break;case 5:Ro(t);break;case 1:fi(t.type)&&yi(t);break;case 4:Oo(t,t.stateNode.containerInfo);break;case 10:r=t.memoizedProps.value;var i=t.type._context;li(Yi,i._currentValue),i._currentValue=r;break;case 13:if(null!==t.memoizedState)return 0!=(n&t.child.childLanes)?Xs(e,t,n):(li(Do,1&Do.current),null!==(t=ta(e,t,n))?t.sibling:null);li(Do,1&Do.current);break;case 19:if(r=0!=(n&t.childLanes),0!=(64&e.flags)){if(r)return ea(e,t,n);t.flags|=64}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),li(Do,Do.current),r)break;return null;case 23:case 24:return t.lanes=0,Fs(e,t,n)}return ta(e,t,n)}Ps=0!=(16384&e.flags)}else Ps=!1;switch(t.lanes=0,t.tag){case 2:if(r=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=hi(t,ui.current),no(t,n),i=is(null,t,r,e,i,n),t.flags|=1,"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,fi(r)){var o=!0;yi(t)}else o=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,oo(t);var a=r.getDerivedStateFromProps;"function"==typeof a&&fo(t,r,a,e),i.updater=go,t.stateNode=i,i._reactInternals=t,bo(t,r,e,n),t=qs(null,t,r,!0,o,n)}else t.tag=0,Ds(null,t,i,n),t=t.child;return t;case 16:i=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=(o=i._init)(i._payload),t.type=i,o=t.tag=function(e){if("function"==typeof e)return Hl(e)?1:0;if(null!=e){if((e=e.$$typeof)===j)return 11;if(e===N)return 14}return 2}(i),e=$i(i,e),o){case 0:t=Hs(null,t,i,e,n);break e;case 1:t=Gs(null,t,i,e,n);break e;case 11:t=Ms(null,t,i,e,n);break e;case 14:t=Ls(null,t,i,$i(i.type,e),r,n);break e}throw Error(s(306,i,""))}return t;case 0:return r=t.type,i=t.pendingProps,Hs(e,t,r,i=t.elementType===r?i:$i(r,i),n);case 1:return r=t.type,i=t.pendingProps,Gs(e,t,r,i=t.elementType===r?i:$i(r,i),n);case 3:if(Vs(t),r=t.updateQueue,null===e||null===r)throw Error(s(282));if(r=t.pendingProps,i=null!==(i=t.memoizedState)?i.element:null,so(e,t),uo(t,r,null,n),(r=t.memoizedState.element)===i)zo(),t=ta(e,t,n);else{if((o=(i=t.stateNode).hydrate)&&(Bo=zr(t.stateNode.containerInfo.firstChild),Lo=t,o=Fo=!0),o){if(null!=(e=i.mutableSourceEagerHydrationData))for(i=0;i<e.length;i+=2)(o=e[i])._workInProgressVersionPrimary=e[i+1],Wo.push(o);for(n=To(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|1024,n=n.sibling}else Ds(e,t,r,n),zo();t=t.child}return t;case 5:return Ro(t),null===e&&Go(t),r=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,a=i.children,Hr(r,i)?a=null:null!==o&&Hr(r,o)&&(t.flags|=16),Us(e,t),Ds(e,t,a,n),t.child;case 6:return null===e&&Go(t),null;case 13:return Xs(e,t,n);case 4:return Oo(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=So(t,null,r,n):Ds(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Ms(e,t,r,i=t.elementType===r?i:$i(r,i),n);case 7:return Ds(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ds(e,t,t.pendingProps.children,n),t.child;case 10:e:{r=t.type._context,i=t.pendingProps,a=t.memoizedProps,o=i.value;var l=t.type._context;if(li(Yi,l._currentValue),l._currentValue=o,null!==a)if(l=a.value,0==(o=ar(l,o)?0:0|("function"==typeof r._calculateChangedBits?r._calculateChangedBits(l,o):1073741823))){if(a.children===i.children&&!di.current){t=ta(e,t,n);break e}}else for(null!==(l=t.child)&&(l.return=t);null!==l;){var c=l.dependencies;if(null!==c){a=l.child;for(var u=c.firstContext;null!==u;){if(u.context===r&&0!=(u.observedBits&o)){1===l.tag&&((u=ao(-1,n&-n)).tag=2,lo(l,u)),l.lanes|=n,null!==(u=l.alternate)&&(u.lanes|=n),to(l.return,n),c.lanes|=n;break}u=u.next}}else a=10===l.tag&&l.type===t.type?null:l.child;if(null!==a)a.return=l;else for(a=l;null!==a;){if(a===t){a=null;break}if(null!==(l=a.sibling)){l.return=a.return,a=l;break}a=a.return}l=a}Ds(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=(o=t.pendingProps).children,no(t,n),r=r(i=ro(i,o.unstable_observedBits)),t.flags|=1,Ds(e,t,r,n),t.child;case 14:return o=$i(i=t.type,t.pendingProps),Ls(e,t,i,o=$i(i.type,o),r,n);case 15:return Bs(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:$i(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,fi(r)?(e=!0,yi(t)):e=!1,no(t,n),vo(t,r,i),bo(t,r,i,n),qs(null,t,r,!0,e,n);case 19:return ea(e,t,n);case 23:case 24:return Fs(e,t,n)}throw Error(s(156,t.tag))},ec.prototype.render=function(e){Xl(e,this._internalRoot,null,null)},ec.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;Xl(null,e,null,(function(){t[Jr]=null}))},tt=function(e){13===e.tag&&(ul(e,4,ll()),Zl(e,4))},nt=function(e){13===e.tag&&(ul(e,67108864,ll()),Zl(e,67108864))},rt=function(e){if(13===e.tag){var t=ll(),n=cl(e);ul(e,n,t),Zl(e,n)}},it=function(e,t){return t()},Ce=function(e,t,n){switch(t){case"input":if(ne(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=ni(r);if(!i)throw Error(s(90));J(r),ne(r,i)}}}break;case"textarea":ce(e,n);break;case"select":null!=(t=n.value)&&se(e,!!n.multiple,t,!1)}},Re=ml,Pe=function(e,t,n,r,i){var o=Aa;Aa|=4;try{return qi(98,e.bind(null,t,n,r,i))}finally{0===(Aa=o)&&(qa(),zi())}},De=function(){0==(49&Aa)&&(function(){if(null!==el){var e=el;el=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,pl(e,Ui())}))}zi()}(),Ol())},Me=function(e,t){var n=Aa;Aa|=2;try{return e(t)}finally{0===(Aa=n)&&(qa(),zi())}};var ic={Events:[ei,ti,ni,Oe,Ne,Ol,{current:!1}]},oc={findFiberByHostInstance:Zr,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},sc={bundleType:oc.bundleType,version:oc.version,rendererPackageName:oc.rendererPackageName,rendererConfig:oc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:E.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ze(e))?null:e.stateNode},findFiberByHostInstance:oc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ac=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ac.isDisabled&&ac.supportsFiber)try{xi=ac.inject(sc),Ei=ac}catch(me){}}n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ic,n.createPortal=rc,n.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(s(188));throw Error(s(268,Object.keys(e)))}return null===(e=Ze(t))?null:e.stateNode},n.flushSync=function(e,t){var n=Aa;if(0!=(48&n))return e(t);Aa|=1;try{if(e)return qi(99,e.bind(null,t))}finally{Aa=n,zi()}},n.hydrate=function(e,t,n){if(!tc(t))throw Error(s(200));return nc(null,e,t,!0,n)},n.render=function(e,t,n){if(!tc(t))throw Error(s(200));return nc(null,e,t,!1,n)},n.unmountComponentAtNode=function(e){if(!tc(e))throw Error(s(40));return!!e._reactRootContainer&&(vl((function(){nc(null,null,e,!1,(function(){e._reactRootContainer=null,e[Jr]=null}))})),!0)},n.unstable_batchedUpdates=ml,n.unstable_createPortal=function(e,t){return rc(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},n.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!tc(n))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return nc(e,t,n,!1,r)},n.version="17.0.2"},{"object-assign":288,react:366,scheduler:424}],309:[function(e,t,n){"use strict";(function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}})(),t.exports=e("./cjs/react-dom.production.min.js")},{"./cjs/react-dom.production.min.js":308}],310:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&Symbol.for,i=r?Symbol.for("react.element"):60103,o=r?Symbol.for("react.portal"):60106,s=r?Symbol.for("react.fragment"):60107,a=r?Symbol.for("react.strict_mode"):60108,l=r?Symbol.for("react.profiler"):60114,c=r?Symbol.for("react.provider"):60109,u=r?Symbol.for("react.context"):60110,d=r?Symbol.for("react.async_mode"):60111,p=r?Symbol.for("react.concurrent_mode"):60111,h=r?Symbol.for("react.forward_ref"):60112,f=r?Symbol.for("react.suspense"):60113,g=r?Symbol.for("react.suspense_list"):60120,m=r?Symbol.for("react.memo"):60115,v=r?Symbol.for("react.lazy"):60116,y=r?Symbol.for("react.block"):60121,b=r?Symbol.for("react.fundamental"):60117,x=r?Symbol.for("react.responder"):60118,E=r?Symbol.for("react.scope"):60119;function _(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case d:case p:case s:case l:case a:case f:return e;default:switch(e=e&&e.$$typeof){case u:case h:case v:case m:case c:return e;default:return t}}case o:return t}}}function w(e){return _(e)===p}n.AsyncMode=d,n.ConcurrentMode=p,n.ContextConsumer=u,n.ContextProvider=c,n.Element=i,n.ForwardRef=h,n.Fragment=s,n.Lazy=v,n.Memo=m,n.Portal=o,n.Profiler=l,n.StrictMode=a,n.Suspense=f,n.isAsyncMode=function(e){return w(e)||_(e)===d},n.isConcurrentMode=w,n.isContextConsumer=function(e){return _(e)===u},n.isContextProvider=function(e){return _(e)===c},n.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===i},n.isForwardRef=function(e){return _(e)===h},n.isFragment=function(e){return _(e)===s},n.isLazy=function(e){return _(e)===v},n.isMemo=function(e){return _(e)===m},n.isPortal=function(e){return _(e)===o},n.isProfiler=function(e){return _(e)===l},n.isStrictMode=function(e){return _(e)===a},n.isSuspense=function(e){return _(e)===f},n.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===s||e===p||e===l||e===a||e===f||e===g||"object"==typeof e&&null!==e&&(e.$$typeof===v||e.$$typeof===m||e.$$typeof===c||e.$$typeof===u||e.$$typeof===h||e.$$typeof===b||e.$$typeof===x||e.$$typeof===E||e.$$typeof===y)},n.typeOf=_},{}],311:[function(e,t,n){"use strict";t.exports=e("./cjs/react-is.production.min.js")},{"./cjs/react-is.production.min.js":310}],312:[function(e,t,n){"use strict";function r(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);null!=e&&this.setState(e)}function i(e){this.setState(function(t){var n=this.constructor.getDerivedStateFromProps(e,t);return null!=n?n:null}.bind(this))}function o(e,t){try{var n=this.props,r=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(n,r)}finally{this.props=n,this.state=r}}Object.defineProperty(n,"__esModule",{value:!0}),r.__suppressDeprecationWarning=!0,i.__suppressDeprecationWarning=!0,o.__suppressDeprecationWarning=!0,n.polyfill=function(e){var t=e.prototype;if(!t||!t.isReactComponent)throw new Error("Can only polyfill class components");if("function"!=typeof e.getDerivedStateFromProps&&"function"!=typeof t.getSnapshotBeforeUpdate)return e;var n=null,s=null,a=null;if("function"==typeof t.componentWillMount?n="componentWillMount":"function"==typeof t.UNSAFE_componentWillMount&&(n="UNSAFE_componentWillMount"),"function"==typeof t.componentWillReceiveProps?s="componentWillReceiveProps":"function"==typeof t.UNSAFE_componentWillReceiveProps&&(s="UNSAFE_componentWillReceiveProps"),"function"==typeof t.componentWillUpdate?a="componentWillUpdate":"function"==typeof t.UNSAFE_componentWillUpdate&&(a="UNSAFE_componentWillUpdate"),null!==n||null!==s||null!==a){var l=e.displayName||e.name,c="function"==typeof e.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n"+l+" uses "+c+" but also contains the following legacy lifecycles:"+(null!==n?"\n  "+n:"")+(null!==s?"\n  "+s:"")+(null!==a?"\n  "+a:"")+"\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://fb.me/react-async-component-lifecycle-hooks")}if("function"==typeof e.getDerivedStateFromProps&&(t.componentWillMount=r,t.componentWillReceiveProps=i),"function"==typeof t.getSnapshotBeforeUpdate){if("function"!=typeof t.componentDidUpdate)throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");t.componentWillUpdate=o;var u=t.componentDidUpdate;t.componentDidUpdate=function(e,t,n){var r=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:n;u.call(this,e,t,r)}}return e}},{}],313:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.bodyOpenClassName=n.portalClassName=void 0;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("react"),s=f(o),a=f(e("react-dom")),l=f(e("prop-types")),c=f(e("./ModalPortal")),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../helpers/ariaAppHider")),d=e("../helpers/safeHTMLElement"),p=f(d),h=e("react-lifecycles-compat");function f(e){return e&&e.__esModule?e:{default:e}}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var v=n.portalClassName="ReactModalPortal",y=n.bodyOpenClassName="ReactModal__Body--open",b=d.canUseDOM&&void 0!==a.default.createPortal,x=function(e){return document.createElement(e)},E=function(){return b?a.default.createPortal:a.default.unstable_renderSubtreeIntoContainer};function _(e){return e()}var w=function(e){function t(){var e,n,i;g(this,t);for(var o=arguments.length,l=Array(o),u=0;u<o;u++)l[u]=arguments[u];return n=i=m(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),i.removePortal=function(){!b&&a.default.unmountComponentAtNode(i.node);var e=_(i.props.parentSelector);e&&e.contains(i.node)?e.removeChild(i.node):console.warn('React-Modal: "parentSelector" prop did not returned any DOM element. Make sure that the parent element is unmounted to avoid any memory leaks.')},i.portalRef=function(e){i.portal=e},i.renderPortal=function(e){var n=E()(i,s.default.createElement(c.default,r({defaultStyles:t.defaultStyles},e)),i.node);i.portalRef(n)},m(i,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),i(t,[{key:"componentDidMount",value:function(){d.canUseDOM&&(b||(this.node=x("div")),this.node.className=this.props.portalClassName,_(this.props.parentSelector).appendChild(this.node),!b&&this.renderPortal(this.props))}},{key:"getSnapshotBeforeUpdate",value:function(e){return{prevParent:_(e.parentSelector),nextParent:_(this.props.parentSelector)}}},{key:"componentDidUpdate",value:function(e,t,n){if(d.canUseDOM){var r=this.props,i=r.isOpen,o=r.portalClassName;e.portalClassName!==o&&(this.node.className=o);var s=n.prevParent,a=n.nextParent;a!==s&&(s.removeChild(this.node),a.appendChild(this.node)),(e.isOpen||i)&&!b&&this.renderPortal(this.props)}}},{key:"componentWillUnmount",value:function(){if(d.canUseDOM&&this.node&&this.portal){var e=this.portal.state,t=Date.now(),n=e.isOpen&&this.props.closeTimeoutMS&&(e.closesAt||t+this.props.closeTimeoutMS);n?(e.beforeClose||this.portal.closeWithTimeout(),setTimeout(this.removePortal,n-t)):this.removePortal()}}},{key:"render",value:function(){return d.canUseDOM&&b?(!this.node&&b&&(this.node=x("div")),E()(s.default.createElement(c.default,r({ref:this.portalRef,defaultStyles:t.defaultStyles},this.props)),this.node)):null}}],[{key:"setAppElement",value:function(e){u.setElement(e)}}]),t}();w.propTypes={isOpen:l.default.bool.isRequired,style:l.default.shape({content:l.default.object,overlay:l.default.object}),portalClassName:l.default.string,bodyOpenClassName:l.default.string,htmlOpenClassName:l.default.string,className:l.default.oneOfType([l.default.string,l.default.shape({base:l.default.string.isRequired,afterOpen:l.default.string.isRequired,beforeClose:l.default.string.isRequired})]),overlayClassName:l.default.oneOfType([l.default.string,l.default.shape({base:l.default.string.isRequired,afterOpen:l.default.string.isRequired,beforeClose:l.default.string.isRequired})]),appElement:l.default.oneOfType([l.default.instanceOf(p.default),l.default.instanceOf(d.SafeHTMLCollection),l.default.instanceOf(d.SafeNodeList),l.default.arrayOf(l.default.instanceOf(p.default))]),onAfterOpen:l.default.func,onRequestClose:l.default.func,closeTimeoutMS:l.default.number,ariaHideApp:l.default.bool,shouldFocusAfterRender:l.default.bool,shouldCloseOnOverlayClick:l.default.bool,shouldReturnFocusAfterClose:l.default.bool,preventScroll:l.default.bool,parentSelector:l.default.func,aria:l.default.object,data:l.default.object,role:l.default.string,contentLabel:l.default.string,shouldCloseOnEsc:l.default.bool,overlayRef:l.default.func,contentRef:l.default.func,id:l.default.string,overlayElement:l.default.func,contentElement:l.default.func},w.defaultProps={isOpen:!1,portalClassName:v,bodyOpenClassName:y,role:"dialog",ariaHideApp:!0,closeTimeoutMS:0,shouldFocusAfterRender:!0,shouldCloseOnEsc:!0,shouldCloseOnOverlayClick:!0,shouldReturnFocusAfterClose:!0,preventScroll:!1,parentSelector:function(){return document.body},overlayElement:function(e,t){return s.default.createElement("div",e,t)},contentElement:function(e,t){return s.default.createElement("div",e,t)}},w.defaultStyles={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.75)"},content:{position:"absolute",top:"40px",left:"40px",right:"40px",bottom:"40px",border:"1px solid #ccc",background:"#fff",overflow:"auto",WebkitOverflowScrolling:"touch",borderRadius:"4px",outline:"none",padding:"20px"}},(0,h.polyfill)(w),n.default=w},{"../helpers/ariaAppHider":315,"../helpers/safeHTMLElement":320,"./ModalPortal":314,"prop-types":305,react:366,"react-dom":309,"react-lifecycles-compat":312}],314:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("react"),a=m(e("prop-types")),l=g(e("../helpers/focusManager")),c=m(e("../helpers/scopeTab")),u=g(e("../helpers/ariaAppHider")),d=g(e("../helpers/classList")),p=e("../helpers/safeHTMLElement"),h=m(p),f=m(e("../helpers/portalOpenInstances"));function g(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function m(e){return e&&e.__esModule?e:{default:e}}e("../helpers/bodyTrap");var v={overlay:"ReactModal__Overlay",content:"ReactModal__Content"},y=0,b=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.setOverlayRef=function(e){n.overlay=e,n.props.overlayRef&&n.props.overlayRef(e)},n.setContentRef=function(e){n.content=e,n.props.contentRef&&n.props.contentRef(e)},n.afterClose=function(){var e=n.props,t=e.appElement,r=e.ariaHideApp,i=e.htmlOpenClassName,o=e.bodyOpenClassName;o&&d.remove(document.body,o),i&&d.remove(document.getElementsByTagName("html")[0],i),r&&y>0&&0==(y-=1)&&u.show(t),n.props.shouldFocusAfterRender&&(n.props.shouldReturnFocusAfterClose?(l.returnFocus(n.props.preventScroll),l.teardownScopedFocus()):l.popWithoutFocus()),n.props.onAfterClose&&n.props.onAfterClose(),f.default.deregister(n)},n.open=function(){n.beforeOpen(),n.state.afterOpen&&n.state.beforeClose?(clearTimeout(n.closeTimer),n.setState({beforeClose:!1})):(n.props.shouldFocusAfterRender&&(l.setupScopedFocus(n.node),l.markForFocusLater()),n.setState({isOpen:!0},(function(){n.openAnimationFrame=requestAnimationFrame((function(){n.setState({afterOpen:!0}),n.props.isOpen&&n.props.onAfterOpen&&n.props.onAfterOpen({overlayEl:n.overlay,contentEl:n.content})}))})))},n.close=function(){n.props.closeTimeoutMS>0?n.closeWithTimeout():n.closeWithoutTimeout()},n.focusContent=function(){return n.content&&!n.contentHasFocus()&&n.content.focus({preventScroll:!0})},n.closeWithTimeout=function(){var e=Date.now()+n.props.closeTimeoutMS;n.setState({beforeClose:!0,closesAt:e},(function(){n.closeTimer=setTimeout(n.closeWithoutTimeout,n.state.closesAt-Date.now())}))},n.closeWithoutTimeout=function(){n.setState({beforeClose:!1,isOpen:!1,afterOpen:!1,closesAt:null},n.afterClose)},n.handleKeyDown=function(e){9===e.keyCode&&(0,c.default)(n.content,e),n.props.shouldCloseOnEsc&&27===e.keyCode&&(e.stopPropagation(),n.requestClose(e))},n.handleOverlayOnClick=function(e){null===n.shouldClose&&(n.shouldClose=!0),n.shouldClose&&n.props.shouldCloseOnOverlayClick&&(n.ownerHandlesClose()?n.requestClose(e):n.focusContent()),n.shouldClose=null},n.handleContentOnMouseUp=function(){n.shouldClose=!1},n.handleOverlayOnMouseDown=function(e){n.props.shouldCloseOnOverlayClick||e.target!=n.overlay||e.preventDefault()},n.handleContentOnClick=function(){n.shouldClose=!1},n.handleContentOnMouseDown=function(){n.shouldClose=!1},n.requestClose=function(e){return n.ownerHandlesClose()&&n.props.onRequestClose(e)},n.ownerHandlesClose=function(){return n.props.onRequestClose},n.shouldBeClosed=function(){return!n.state.isOpen&&!n.state.beforeClose},n.contentHasFocus=function(){return document.activeElement===n.content||n.content.contains(document.activeElement)},n.buildClassName=function(e,t){var r="object"===(void 0===t?"undefined":i(t))?t:{base:v[e],afterOpen:v[e]+"--after-open",beforeClose:v[e]+"--before-close"},o=r.base;return n.state.afterOpen&&(o=o+" "+r.afterOpen),n.state.beforeClose&&(o=o+" "+r.beforeClose),"string"==typeof t&&t?o+" "+t:o},n.attributesFromObject=function(e,t){return Object.keys(t).reduce((function(n,r){return n[e+"-"+r]=t[r],n}),{})},n.state={afterOpen:!1,beforeClose:!1},n.shouldClose=null,n.moveFromContentToOverlay=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),o(t,[{key:"componentDidMount",value:function(){this.props.isOpen&&this.open()}},{key:"componentDidUpdate",value:function(e,t){this.props.isOpen&&!e.isOpen?this.open():!this.props.isOpen&&e.isOpen&&this.close(),this.props.shouldFocusAfterRender&&this.state.isOpen&&!t.isOpen&&this.focusContent()}},{key:"componentWillUnmount",value:function(){this.state.isOpen&&this.afterClose(),clearTimeout(this.closeTimer),cancelAnimationFrame(this.openAnimationFrame)}},{key:"beforeOpen",value:function(){var e=this.props,t=e.appElement,n=e.ariaHideApp,r=e.htmlOpenClassName,i=e.bodyOpenClassName;i&&d.add(document.body,i),r&&d.add(document.getElementsByTagName("html")[0],r),n&&(y+=1,u.hide(t)),f.default.register(this)}},{key:"render",value:function(){var e=this.props,t=e.id,n=e.className,i=e.overlayClassName,o=e.defaultStyles,s=e.children,a=n?{}:o.content,l=i?{}:o.overlay;if(this.shouldBeClosed())return null;var c={ref:this.setOverlayRef,className:this.buildClassName("overlay",i),style:r({},l,this.props.style.overlay),onClick:this.handleOverlayOnClick,onMouseDown:this.handleOverlayOnMouseDown},u=r({id:t,ref:this.setContentRef,style:r({},a,this.props.style.content),className:this.buildClassName("content",n),tabIndex:"-1",onKeyDown:this.handleKeyDown,onMouseDown:this.handleContentOnMouseDown,onMouseUp:this.handleContentOnMouseUp,onClick:this.handleContentOnClick,role:this.props.role,"aria-label":this.props.contentLabel},this.attributesFromObject("aria",r({modal:!0},this.props.aria)),this.attributesFromObject("data",this.props.data||{}),{"data-testid":this.props.testId}),d=this.props.contentElement(u,s);return this.props.overlayElement(c,d)}}]),t}();b.defaultProps={style:{overlay:{},content:{}},defaultStyles:{}},b.propTypes={isOpen:a.default.bool.isRequired,defaultStyles:a.default.shape({content:a.default.object,overlay:a.default.object}),style:a.default.shape({content:a.default.object,overlay:a.default.object}),className:a.default.oneOfType([a.default.string,a.default.object]),overlayClassName:a.default.oneOfType([a.default.string,a.default.object]),bodyOpenClassName:a.default.string,htmlOpenClassName:a.default.string,ariaHideApp:a.default.bool,appElement:a.default.oneOfType([a.default.instanceOf(h.default),a.default.instanceOf(p.SafeHTMLCollection),a.default.instanceOf(p.SafeNodeList),a.default.arrayOf(a.default.instanceOf(h.default))]),onAfterOpen:a.default.func,onAfterClose:a.default.func,onRequestClose:a.default.func,closeTimeoutMS:a.default.number,shouldFocusAfterRender:a.default.bool,shouldCloseOnOverlayClick:a.default.bool,shouldReturnFocusAfterClose:a.default.bool,preventScroll:a.default.bool,role:a.default.string,contentLabel:a.default.string,aria:a.default.object,data:a.default.object,children:a.default.node,shouldCloseOnEsc:a.default.bool,overlayRef:a.default.func,contentRef:a.default.func,id:a.default.string,overlayElement:a.default.func,contentElement:a.default.func,testId:a.default.string},n.default=b,t.exports=n.default},{"../helpers/ariaAppHider":315,"../helpers/bodyTrap":316,"../helpers/classList":317,"../helpers/focusManager":318,"../helpers/portalOpenInstances":319,"../helpers/safeHTMLElement":320,"../helpers/scopeTab":321,"prop-types":305,react:366}],315:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.resetState=function(){a&&(a.removeAttribute?a.removeAttribute("aria-hidden"):null!=a.length?a.forEach((function(e){return e.removeAttribute("aria-hidden")})):document.querySelectorAll(a).forEach((function(e){return e.removeAttribute("aria-hidden")}))),a=null},n.log=function(){},n.assertNodeList=l,n.setElement=function(e){var t=e;if("string"==typeof t&&s.canUseDOM){var n=document.querySelectorAll(t);l(n,t),t=n}return a=t||a},n.validateElement=c,n.hide=function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=c(e)[Symbol.iterator]();!(t=(i=o.next()).done);t=!0)i.value.setAttribute("aria-hidden","true")}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}},n.show=function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=c(e)[Symbol.iterator]();!(t=(i=o.next()).done);t=!0)i.value.removeAttribute("aria-hidden")}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}},n.documentNotReadyOrSSRTesting=function(){a=null};var r,i=e("warning"),o=(r=i)&&r.__esModule?r:{default:r},s=e("./safeHTMLElement");var a=null;function l(e,t){if(!e||!e.length)throw new Error("react-modal: No elements were found for selector "+t+".")}function c(e){var t=e||a;return t?Array.isArray(t)||t instanceof HTMLCollection||t instanceof NodeList?t:[t]:((0,o.default)(!1,["react-modal: App element is not defined.","Please use `Modal.setAppElement(el)` or set `appElement={el}`.","This is needed so screen readers don't see main content","when modal is opened. It is not recommended, but you can opt-out","by setting `ariaHideApp={false}`."].join(" ")),[])}},{"./safeHTMLElement":320,warning:449}],316:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.resetState=function(){for(var e=[s,a],t=0;t<e.length;t++){var n=e[t];n&&n.parentNode&&n.parentNode.removeChild(n)}s=a=null,l=[]},n.log=function(){console.log("bodyTrap ----------"),console.log(l.length);for(var e=[s,a],t=0;t<e.length;t++){var n=e[t]||{};console.log(n.nodeName,n.className,n.id)}console.log("edn bodyTrap ----------")};var r,i=e("./portalOpenInstances"),o=(r=i)&&r.__esModule?r:{default:r};var s=void 0,a=void 0,l=[];function c(){0!==l.length&&l[l.length-1].focusContent()}o.default.subscribe((function(e,t){s||a||((s=document.createElement("div")).setAttribute("data-react-modal-body-trap",""),s.style.position="absolute",s.style.opacity="0",s.setAttribute("tabindex","0"),s.addEventListener("focus",c),(a=s.cloneNode()).addEventListener("focus",c)),(l=t).length>0?(document.body.firstChild!==s&&document.body.insertBefore(s,document.body.firstChild),document.body.lastChild!==a&&document.body.appendChild(a)):(s.parentElement&&s.parentElement.removeChild(s),a.parentElement&&a.parentElement.removeChild(a))}))},{"./portalOpenInstances":319}],317:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.resetState=function(){var e=document.getElementsByTagName("html")[0];for(var t in r)o(e,r[t]);var n=document.body;for(var s in i)o(n,i[s]);r={},i={}},n.log=function(){};var r={},i={};function o(e,t){e.classList.remove(t)}n.add=function(e,t){return function(e,t,n){n.forEach((function(n){(function(e,t){e[t]||(e[t]=0),e[t]+=1})(t,n),e.add(n)}))}(e.classList,"html"==e.nodeName.toLowerCase()?r:i,t.split(" "))},n.remove=function(e,t){return function(e,t,n){n.forEach((function(n){(function(e,t){e[t]&&(e[t]-=1)})(t,n),0===t[n]&&e.remove(n)}))}(e.classList,"html"==e.nodeName.toLowerCase()?r:i,t.split(" "))}},{}],318:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.resetState=function(){s=[]},n.log=function(){},n.handleBlur=c,n.handleFocus=u,n.markForFocusLater=function(){s.push(document.activeElement)},n.returnFocus=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=null;try{return void(0!==s.length&&(t=s.pop()).focus({preventScroll:e}))}catch(e){console.warn(["You tried to return focus to",t,"but it is not in the DOM anymore"].join(" "))}},n.popWithoutFocus=function(){s.length>0&&s.pop()},n.setupScopedFocus=function(e){a=e,window.addEventListener?(window.addEventListener("blur",c,!1),document.addEventListener("focus",u,!0)):(window.attachEvent("onBlur",c),document.attachEvent("onFocus",u))},n.teardownScopedFocus=function(){a=null,window.addEventListener?(window.removeEventListener("blur",c),document.removeEventListener("focus",u)):(window.detachEvent("onBlur",c),document.detachEvent("onFocus",u))};var r,i=e("../helpers/tabbable"),o=(r=i)&&r.__esModule?r:{default:r};var s=[],a=null,l=!1;function c(){l=!0}function u(){if(l){if(l=!1,!a)return;setTimeout((function(){a.contains(document.activeElement)||((0,o.default)(a)[0]||a).focus()}),0)}}},{"../helpers/tabbable":322}],319:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.log=function(){console.log("portalOpenInstances ----------"),console.log(i.openInstances.length),i.openInstances.forEach((function(e){return console.log(e)})),console.log("end portalOpenInstances ----------")},n.resetState=function(){i=new r};var r=function e(){var t=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.register=function(e){-1===t.openInstances.indexOf(e)&&(t.openInstances.push(e),t.emit("register"))},this.deregister=function(e){var n=t.openInstances.indexOf(e);-1!==n&&(t.openInstances.splice(n,1),t.emit("deregister"))},this.subscribe=function(e){t.subscribers.push(e)},this.emit=function(e){t.subscribers.forEach((function(n){return n(e,t.openInstances.slice())}))},this.openInstances=[],this.subscribers=[]},i=new r;n.default=i},{}],320:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.canUseDOM=n.SafeNodeList=n.SafeHTMLCollection=void 0;var r,i=e("exenv");var o=((r=i)&&r.__esModule?r:{default:r}).default,s=o.canUseDOM?window.HTMLElement:{};n.SafeHTMLCollection=o.canUseDOM?window.HTMLCollection:{},n.SafeNodeList=o.canUseDOM?window.NodeList:{},n.canUseDOM=o.canUseDOM;n.default=s},{exenv:242}],321:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){var n=(0,o.default)(e);if(n.length){var r=void 0,i=t.shiftKey,a=n[0],l=n[n.length-1],c=s();if(e===c){if(!i)return;r=l}if(l!==c||i||(r=a),a===c&&i&&(r=l),r)return t.preventDefault(),void r.focus();var u=/(\bChrome\b|\bSafari\b)\//.exec(navigator.userAgent);if(null!=u&&"Chrome"!=u[1]&&null==/\biPod\b|\biPad\b/g.exec(navigator.userAgent)){var d=n.indexOf(c);if(d>-1&&(d+=i?-1:1),void 0===(r=n[d]))return t.preventDefault(),void(r=i?l:a).focus();t.preventDefault(),r.focus()}}else t.preventDefault()};var r,i=e("./tabbable"),o=(r=i)&&r.__esModule?r:{default:r};function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return e.activeElement.shadowRoot?s(e.activeElement.shadowRoot):e.activeElement}t.exports=n.default},{"./tabbable":322}],322:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function e(t){return[].slice.call(t.querySelectorAll("*"),0).reduce((function(t,n){return t.concat(n.shadowRoot?e(n.shadowRoot):[n])}),[]).filter(s)};var r=/input|select|textarea|button|object|iframe/;function i(e){var t=e.offsetWidth<=0&&e.offsetHeight<=0;if(t&&!e.innerHTML)return!0;try{var n=window.getComputedStyle(e);return t?"visible"!==n.getPropertyValue("overflow")||e.scrollWidth<=0&&e.scrollHeight<=0:"none"==n.getPropertyValue("display")}catch(e){return console.warn("Failed to inspect element style"),!1}}function o(e,t){var n=e.nodeName.toLowerCase();return(r.test(n)&&!e.disabled||"a"===n&&e.href||t)&&function(e){for(var t=e,n=e.getRootNode&&e.getRootNode();t&&t!==document.body;){if(n&&t===n&&(t=n.host.parentNode),i(t))return!1;t=t.parentNode}return!0}(e)}function s(e){var t=e.getAttribute("tabindex");null===t&&(t=void 0);var n=isNaN(t);return(n||t>=0)&&o(e,!n)}t.exports=n.default},{}],323:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i=e("./components/Modal"),o=(r=i)&&r.__esModule?r:{default:r};n.default=o.default,t.exports=n.default},{"./components/Modal":313}],324:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault").default;n.__esModule=!0,n.default=n.ReactReduxContext=void 0;var i=r(e("react")).default.createContext(null);n.ReactReduxContext=i;var o=i;n.default=o},{"@babel/runtime/helpers/interopRequireDefault":211,react:366}],325:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault").default,i=e("@babel/runtime/helpers/interopRequireWildcard").default;n.__esModule=!0,n.default=void 0;var o=i(e("react")),s=(r(e("prop-types")),e("./Context")),a=e("../utils/Subscription"),l=e("../utils/useIsomorphicLayoutEffect");var c=function(e){var t=e.store,n=e.context,r=e.children,i=(0,o.useMemo)((function(){var e=(0,a.createSubscription)(t);return{store:t,subscription:e}}),[t]),c=(0,o.useMemo)((function(){return t.getState()}),[t]);(0,l.useIsomorphicLayoutEffect)((function(){var e=i.subscription;return e.onStateChange=e.notifyNestedSubs,e.trySubscribe(),c!==t.getState()&&e.notifyNestedSubs(),function(){e.tryUnsubscribe(),e.onStateChange=null}}),[i,c]);var u=n||s.ReactReduxContext;return o.default.createElement(u.Provider,{value:i},r)};n.default=c},{"../utils/Subscription":340,"../utils/useIsomorphicLayoutEffect":346,"./Context":324,"@babel/runtime/helpers/interopRequireDefault":211,"@babel/runtime/helpers/interopRequireWildcard":212,"prop-types":305,react:366}],326:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault").default,i=e("@babel/runtime/helpers/interopRequireWildcard").default;n.__esModule=!0,n.default=function(e,t){void 0===t&&(t={});var n=t,r=n.getDisplayName,i=void 0===r?function(e){return"ConnectAdvanced("+e+")"}:r,d=n.methodName,_=void 0===d?"connectAdvanced":d,w=n.renderCountProp,S=void 0===w?void 0:w,T=n.shouldHandleStateChanges,k=void 0===T||T,C=n.storeKey,A=void 0===C?"store":C,j=(n.withRef,n.forwardRef),I=void 0!==j&&j,O=n.context,N=void 0===O?p.ReactReduxContext:O,R=(0,s.default)(n,h),P=N;return function(t){var n=t.displayName||t.name||"Component",r=i(n),d=(0,o.default)({},R,{getDisplayName:i,methodName:_,renderCountProp:S,shouldHandleStateChanges:k,storeKey:A,displayName:r,wrappedComponentName:n,WrappedComponent:t}),p=R.pure,h=p?l.useMemo:function(e){return e()};function w(n){var r=(0,l.useMemo)((function(){var e=n.reactReduxForwardedRef,t=(0,s.default)(n,f);return[n.context,e,t]}),[n]),i=r[0],a=r[1],p=r[2],_=(0,l.useMemo)((function(){return i&&i.Consumer&&(0,c.isContextConsumer)(l.default.createElement(i.Consumer,null))?i:P}),[i,P]),w=(0,l.useContext)(_),S=Boolean(n.store)&&Boolean(n.store.getState)&&Boolean(n.store.dispatch);Boolean(w)&&Boolean(w.store);var T=S?n.store:w.store,C=(0,l.useMemo)((function(){return function(t){return e(t.dispatch,d)}(T)}),[T]),A=(0,l.useMemo)((function(){if(!k)return m;var e=(0,u.createSubscription)(T,S?null:w.subscription),t=e.notifyNestedSubs.bind(e);return[e,t]}),[T,S,w]),j=A[0],I=A[1],O=(0,l.useMemo)((function(){return S?w:(0,o.default)({},w,{subscription:j})}),[S,w,j]),N=(0,l.useReducer)(v,g,E),R=N[0][0],D=N[1];if(R&&R.error)throw R.error;var M=(0,l.useRef)(),L=(0,l.useRef)(p),B=(0,l.useRef)(),F=(0,l.useRef)(!1),U=h((function(){return B.current&&p===L.current?B.current:C(T.getState(),p)}),[T,R,p]);y(b,[L,M,F,p,U,B,I]),y(x,[k,T,j,C,L,M,F,B,I,D],[T,j,C]);var H=(0,l.useMemo)((function(){return l.default.createElement(t,(0,o.default)({},U,{ref:a}))}),[a,t,U]);return(0,l.useMemo)((function(){return k?l.default.createElement(_.Provider,{value:O},H):H}),[_,H,O])}var T=p?l.default.memo(w):w;if(T.WrappedComponent=t,T.displayName=w.displayName=r,I){var C=l.default.forwardRef((function(e,t){return l.default.createElement(T,(0,o.default)({},e,{reactReduxForwardedRef:t}))}));return C.displayName=r,C.WrappedComponent=t,(0,a.default)(C,t)}return(0,a.default)(T,t)}};var o=r(e("@babel/runtime/helpers/extends")),s=r(e("@babel/runtime/helpers/objectWithoutPropertiesLoose")),a=r(e("hoist-non-react-statics")),l=i(e("react")),c=e("react-is"),u=e("../utils/Subscription"),d=e("../utils/useIsomorphicLayoutEffect"),p=e("./Context"),h=["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"],f=["reactReduxForwardedRef"],g=[],m=[null,null];function v(e,t){var n=e[1];return[t.payload,n+1]}function y(e,t,n){(0,d.useIsomorphicLayoutEffect)((function(){return e.apply(void 0,t)}),n)}function b(e,t,n,r,i,o,s){e.current=r,t.current=i,n.current=!1,o.current&&(o.current=null,s())}function x(e,t,n,r,i,o,s,a,l,c){if(e){var u=!1,d=null,p=function(){if(!u){var e,n,p=t.getState();try{e=r(p,i.current)}catch(e){n=e,d=e}n||(d=null),e===o.current?s.current||l():(o.current=e,a.current=e,s.current=!0,c({type:"STORE_UPDATED",payload:{error:n}}))}};return n.onStateChange=p,n.trySubscribe(),p(),function(){if(u=!0,n.tryUnsubscribe(),n.onStateChange=null,d)throw d}}}var E=function(){return[null,0]}},{"../utils/Subscription":340,"../utils/useIsomorphicLayoutEffect":346,"./Context":324,"@babel/runtime/helpers/extends":210,"@babel/runtime/helpers/interopRequireDefault":211,"@babel/runtime/helpers/interopRequireWildcard":212,"@babel/runtime/helpers/objectWithoutPropertiesLoose":214,"hoist-non-react-statics":244,react:366,"react-is":350}],327:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault").default;n.__esModule=!0,n.createConnect=g,n.default=void 0;var i=r(e("@babel/runtime/helpers/extends")),o=r(e("@babel/runtime/helpers/objectWithoutPropertiesLoose")),s=r(e("../components/connectAdvanced")),a=r(e("../utils/shallowEqual")),l=r(e("./mapDispatchToProps")),c=r(e("./mapStateToProps")),u=r(e("./mergeProps")),d=r(e("./selectorFactory")),p=["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"];function h(e,t,n){for(var r=t.length-1;r>=0;r--){var i=t[r](e);if(i)return i}return function(t,r){throw new Error("Invalid value of type "+typeof e+" for "+n+" argument when connecting component "+r.wrappedComponentName+".")}}function f(e,t){return e===t}function g(e){var t=void 0===e?{}:e,n=t.connectHOC,r=void 0===n?s.default:n,g=t.mapStateToPropsFactories,m=void 0===g?c.default:g,v=t.mapDispatchToPropsFactories,y=void 0===v?l.default:v,b=t.mergePropsFactories,x=void 0===b?u.default:b,E=t.selectorFactory,_=void 0===E?d.default:E;return function(e,t,n,s){void 0===s&&(s={});var l=s,c=l.pure,u=void 0===c||c,d=l.areStatesEqual,g=void 0===d?f:d,v=l.areOwnPropsEqual,b=void 0===v?a.default:v,E=l.areStatePropsEqual,w=void 0===E?a.default:E,S=l.areMergedPropsEqual,T=void 0===S?a.default:S,k=(0,o.default)(l,p),C=h(e,m,"mapStateToProps"),A=h(t,y,"mapDispatchToProps"),j=h(n,x,"mergeProps");return r(_,(0,i.default)({methodName:"connect",getDisplayName:function(e){return"Connect("+e+")"},shouldHandleStateChanges:Boolean(e),initMapStateToProps:C,initMapDispatchToProps:A,initMergeProps:j,pure:u,areStatesEqual:g,areOwnPropsEqual:b,areStatePropsEqual:w,areMergedPropsEqual:T},k))}}var m=g();n.default=m},{"../components/connectAdvanced":326,"../utils/shallowEqual":345,"./mapDispatchToProps":328,"./mapStateToProps":329,"./mergeProps":330,"./selectorFactory":331,"@babel/runtime/helpers/extends":210,"@babel/runtime/helpers/interopRequireDefault":211,"@babel/runtime/helpers/objectWithoutPropertiesLoose":214}],328:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault").default;n.__esModule=!0,n.default=void 0,n.whenMapDispatchToPropsIsFunction=s,n.whenMapDispatchToPropsIsMissing=a,n.whenMapDispatchToPropsIsObject=l;var i=r(e("../utils/bindActionCreators")),o=e("./wrapMapToProps");function s(e){return"function"==typeof e?(0,o.wrapMapToPropsFunc)(e,"mapDispatchToProps"):void 0}function a(e){return e?void 0:(0,o.wrapMapToPropsConstant)((function(e){return{dispatch:e}}))}function l(e){return e&&"object"==typeof e?(0,o.wrapMapToPropsConstant)((function(t){return(0,i.default)(e,t)})):void 0}var c=[s,a,l];n.default=c},{"../utils/bindActionCreators":342,"./wrapMapToProps":333,"@babel/runtime/helpers/interopRequireDefault":211}],329:[function(e,t,n){"use strict";n.__esModule=!0,n.default=void 0,n.whenMapStateToPropsIsFunction=i,n.whenMapStateToPropsIsMissing=o;var r=e("./wrapMapToProps");function i(e){return"function"==typeof e?(0,r.wrapMapToPropsFunc)(e,"mapStateToProps"):void 0}function o(e){return e?void 0:(0,r.wrapMapToPropsConstant)((function(){return{}}))}var s=[i,o];n.default=s},{"./wrapMapToProps":333}],330:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault").default;n.__esModule=!0,n.default=void 0,n.defaultMergeProps=o,n.whenMergePropsIsFunction=a,n.whenMergePropsIsOmitted=l,n.wrapMergePropsFunc=s;var i=r(e("@babel/runtime/helpers/extends"));r(e("../utils/verifyPlainObject"));function o(e,t,n){return(0,i.default)({},n,e,t)}function s(e){return function(t,n){n.displayName;var r,i=n.pure,o=n.areMergedPropsEqual,s=!1;return function(t,n,a){var l=e(t,n,a);return s?i&&o(l,r)||(r=l):(s=!0,r=l),r}}}function a(e){return"function"==typeof e?s(e):void 0}function l(e){return e?void 0:function(){return o}}var c=[a,l];n.default=c},{"../utils/verifyPlainObject":347,"@babel/runtime/helpers/extends":210,"@babel/runtime/helpers/interopRequireDefault":211}],331:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault").default;n.__esModule=!0,n.default=function(e,t){var n=t.initMapStateToProps,r=t.initMapDispatchToProps,l=t.initMergeProps,c=(0,i.default)(t,o),u=n(e,c),d=r(e,c),p=l(e,c);return(c.pure?a:s)(u,d,p,e,c)},n.impureFinalPropsSelectorFactory=s,n.pureFinalPropsSelectorFactory=a;var i=r(e("@babel/runtime/helpers/objectWithoutPropertiesLoose")),o=(r(e("./verifySubselectors")),["initMapStateToProps","initMapDispatchToProps","initMergeProps"]);function s(e,t,n,r){return function(i,o){return n(e(i,o),t(r,o),o)}}function a(e,t,n,r,i){var o,s,a,l,c,u=i.areStatesEqual,d=i.areOwnPropsEqual,p=i.areStatePropsEqual,h=!1;function f(i,h){var f,g,m=!d(h,s),v=!u(i,o,h,s);return o=i,s=h,m&&v?(a=e(o,s),t.dependsOnOwnProps&&(l=t(r,s)),c=n(a,l,s)):m?(e.dependsOnOwnProps&&(a=e(o,s)),t.dependsOnOwnProps&&(l=t(r,s)),c=n(a,l,s)):v?(f=e(o,s),g=!p(f,a),a=f,g&&(c=n(a,l,s)),c):c}return function(i,u){return h?f(i,u):(a=e(o=i,s=u),l=t(r,s),c=n(a,l,s),h=!0,c)}}},{"./verifySubselectors":332,"@babel/runtime/helpers/interopRequireDefault":211,"@babel/runtime/helpers/objectWithoutPropertiesLoose":214}],332:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault").default;n.__esModule=!0,n.default=function(e,t,n,r){o(e,"mapStateToProps",r),o(t,"mapDispatchToProps",r),o(n,"mergeProps",r)};var i=r(e("../utils/warning"));function o(e,t,n){if(!e)throw new Error("Unexpected value for "+t+" in "+n+".");"mapStateToProps"!==t&&"mapDispatchToProps"!==t||Object.prototype.hasOwnProperty.call(e,"dependsOnOwnProps")||(0,i.default)("The selector for "+t+" of "+n+" did not specify a value for dependsOnOwnProps.")}},{"../utils/warning":348,"@babel/runtime/helpers/interopRequireDefault":211}],333:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault").default;n.__esModule=!0,n.getDependsOnOwnProps=i,n.wrapMapToPropsConstant=function(e){return function(t,n){var r=e(t,n);function i(){return r}return i.dependsOnOwnProps=!1,i}},n.wrapMapToPropsFunc=function(e,t){return function(t,n){n.displayName;var r=function(e,t){return r.dependsOnOwnProps?r.mapToProps(e,t):r.mapToProps(e)};return r.dependsOnOwnProps=!0,r.mapToProps=function(t,n){r.mapToProps=e,r.dependsOnOwnProps=i(e);var o=r(t,n);return"function"==typeof o&&(r.mapToProps=o,r.dependsOnOwnProps=i(o),o=r(t,n)),o},r}};r(e("../utils/verifyPlainObject"));function i(e){return null!==e.dependsOnOwnProps&&void 0!==e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}},{"../utils/verifyPlainObject":347,"@babel/runtime/helpers/interopRequireDefault":211}],334:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault").default;n.__esModule=!0;var i=r(e("./components/Provider"));n.Provider=i.default;var o=r(e("./components/connectAdvanced"));n.connectAdvanced=o.default;var s=e("./components/Context");n.ReactReduxContext=s.ReactReduxContext;var a=r(e("./connect/connect"));n.connect=a.default;var l=e("./hooks/useDispatch");n.useDispatch=l.useDispatch,n.createDispatchHook=l.createDispatchHook;var c=e("./hooks/useSelector");n.useSelector=c.useSelector,n.createSelectorHook=c.createSelectorHook;var u=e("./hooks/useStore");n.useStore=u.useStore,n.createStoreHook=u.createStoreHook;var d=r(e("./utils/shallowEqual"));n.shallowEqual=d.default},{"./components/Context":324,"./components/Provider":325,"./components/connectAdvanced":326,"./connect/connect":327,"./hooks/useDispatch":335,"./hooks/useSelector":337,"./hooks/useStore":338,"./utils/shallowEqual":345,"@babel/runtime/helpers/interopRequireDefault":211}],335:[function(e,t,n){"use strict";n.__esModule=!0,n.createDispatchHook=o,n.useDispatch=void 0;var r=e("../components/Context"),i=e("./useStore");function o(e){void 0===e&&(e=r.ReactReduxContext);var t=e===r.ReactReduxContext?i.useStore:(0,i.createStoreHook)(e);return function(){return t().dispatch}}var s=o();n.useDispatch=s},{"../components/Context":324,"./useStore":338}],336:[function(e,t,n){"use strict";n.__esModule=!0,n.useReduxContext=function(){return(0,r.useContext)(i.ReactReduxContext)};var r=e("react"),i=e("../components/Context")},{"../components/Context":324,react:366}],337:[function(e,t,n){"use strict";n.__esModule=!0,n.createSelectorHook=c,n.useSelector=void 0;var r=e("react"),i=e("./useReduxContext"),o=e("../utils/Subscription"),s=e("../utils/useIsomorphicLayoutEffect"),a=e("../components/Context"),l=function(e,t){return e===t};function c(e){void 0===e&&(e=a.ReactReduxContext);var t=e===a.ReactReduxContext?i.useReduxContext:function(){return(0,r.useContext)(e)};return function(e,n){void 0===n&&(n=l);var i=t(),a=function(e,t,n,i){var a,l=(0,r.useReducer)((function(e){return e+1}),0)[1],c=(0,r.useMemo)((function(){return(0,o.createSubscription)(n,i)}),[n,i]),u=(0,r.useRef)(),d=(0,r.useRef)(),p=(0,r.useRef)(),h=(0,r.useRef)(),f=n.getState();try{if(e!==d.current||f!==p.current||u.current){var g=e(f);a=void 0!==h.current&&t(g,h.current)?h.current:g}else a=h.current}catch(e){throw u.current&&(e.message+="\nThe error may be correlated with this previous error:\n"+u.current.stack+"\n\n"),e}return(0,s.useIsomorphicLayoutEffect)((function(){d.current=e,p.current=f,h.current=a,u.current=void 0})),(0,s.useIsomorphicLayoutEffect)((function(){function e(){try{var e=n.getState();if(e===p.current)return;var r=d.current(e);if(t(r,h.current))return;h.current=r,p.current=e}catch(e){u.current=e}l()}return c.onStateChange=e,c.trySubscribe(),e(),function(){return c.tryUnsubscribe()}}),[n,c]),a}(e,n,i.store,i.subscription);return(0,r.useDebugValue)(a),a}}var u=c();n.useSelector=u},{"../components/Context":324,"../utils/Subscription":340,"../utils/useIsomorphicLayoutEffect":346,"./useReduxContext":336,react:366}],338:[function(e,t,n){"use strict";n.__esModule=!0,n.createStoreHook=s,n.useStore=void 0;var r=e("react"),i=e("../components/Context"),o=e("./useReduxContext");function s(e){void 0===e&&(e=i.ReactReduxContext);var t=e===i.ReactReduxContext?o.useReduxContext:function(){return(0,r.useContext)(e)};return function(){return t().store}}var a=s();n.useStore=a},{"../components/Context":324,"./useReduxContext":336,react:366}],339:[function(e,t,n){"use strict";n.__esModule=!0;var r={batch:!0},i=e("./exports");Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in n&&n[e]===i[e]||(n[e]=i[e]))}));var o=e("./utils/reactBatchedUpdates");n.batch=o.unstable_batchedUpdates,(0,e("./utils/batch").setBatch)(o.unstable_batchedUpdates)},{"./exports":334,"./utils/batch":341,"./utils/reactBatchedUpdates":344}],340:[function(e,t,n){"use strict";n.__esModule=!0,n.createSubscription=function(e,t){var n,o=i;function s(){l.onStateChange&&l.onStateChange()}function a(){n||(n=t?t.addNestedSub(s):e.subscribe(s),o=function(){var e=(0,r.getBatch)(),t=null,n=null;return{clear:function(){t=null,n=null},notify:function(){e((function(){for(var e=t;e;)e.callback(),e=e.next}))},get:function(){for(var e=[],n=t;n;)e.push(n),n=n.next;return e},subscribe:function(e){var r=!0,i=n={callback:e,next:null,prev:n};return i.prev?i.prev.next=i:t=i,function(){r&&null!==t&&(r=!1,i.next?i.next.prev=i.prev:n=i.prev,i.prev?i.prev.next=i.next:t=i.next)}}}}())}var l={addNestedSub:function(e){return a(),o.subscribe(e)},notifyNestedSubs:function(){o.notify()},handleChangeWrapper:s,isSubscribed:function(){return Boolean(n)},trySubscribe:a,tryUnsubscribe:function(){n&&(n(),n=void 0,o.clear(),o=i)},getListeners:function(){return o}};return l};var r=e("./batch");var i={notify:function(){},get:function(){return[]}}},{"./batch":341}],341:[function(e,t,n){"use strict";n.__esModule=!0,n.setBatch=n.getBatch=void 0;var r=function(e){e()};n.setBatch=function(e){return r=e};n.getBatch=function(){return r}},{}],342:[function(e,t,n){"use strict";n.__esModule=!0,n.default=function(e,t){var n={},r=function(r){var i=e[r];"function"==typeof i&&(n[r]=function(){return t(i.apply(void 0,arguments))})};for(var i in e)r(i);return n}},{}],343:[function(e,t,n){"use strict";n.__esModule=!0,n.default=function(e){if("object"!=typeof e||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var n=t;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n}},{}],344:[function(e,t,n){"use strict";n.__esModule=!0,n.unstable_batchedUpdates=void 0;var r=e("react-dom");n.unstable_batchedUpdates=r.unstable_batchedUpdates},{"react-dom":309}],345:[function(e,t,n){"use strict";function r(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}n.__esModule=!0,n.default=function(e,t){if(r(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(var o=0;o<n.length;o++)if(!Object.prototype.hasOwnProperty.call(t,n[o])||!r(e[n[o]],t[n[o]]))return!1;return!0}},{}],346:[function(e,t,n){"use strict";n.__esModule=!0,n.useIsomorphicLayoutEffect=void 0;var r=e("react"),i="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?r.useLayoutEffect:r.useEffect;n.useIsomorphicLayoutEffect=i},{react:366}],347:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault").default;n.__esModule=!0,n.default=function(e,t,n){(0,i.default)(e)||(0,o.default)(n+"() in "+t+" must return a plain object. Instead received "+e+".")};var i=r(e("./isPlainObject")),o=r(e("./warning"))},{"./isPlainObject":343,"./warning":348,"@babel/runtime/helpers/interopRequireDefault":211}],348:[function(e,t,n){"use strict";n.__esModule=!0,n.default=function(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}},{}],349:[function(e,t,n){"use strict";var r=60103,i=60106,o=60107,s=60108,a=60114,l=60109,c=60110,u=60112,d=60113,p=60120,h=60115,f=60116,g=60121,m=60122,v=60117,y=60129,b=60131;if("function"==typeof Symbol&&Symbol.for){var x=Symbol.for;r=x("react.element"),i=x("react.portal"),o=x("react.fragment"),s=x("react.strict_mode"),a=x("react.profiler"),l=x("react.provider"),c=x("react.context"),u=x("react.forward_ref"),d=x("react.suspense"),p=x("react.suspense_list"),h=x("react.memo"),f=x("react.lazy"),g=x("react.block"),m=x("react.server.block"),v=x("react.fundamental"),y=x("react.debug_trace_mode"),b=x("react.legacy_hidden")}function E(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case o:case a:case s:case d:case p:return e;default:switch(e=e&&e.$$typeof){case c:case u:case f:case h:case l:return e;default:return t}}case i:return t}}}var _=l,w=r,S=u,T=o,k=f,C=h,A=i,j=a,I=s,O=d;n.ContextConsumer=c,n.ContextProvider=_,n.Element=w,n.ForwardRef=S,n.Fragment=T,n.Lazy=k,n.Memo=C,n.Portal=A,n.Profiler=j,n.StrictMode=I,n.Suspense=O,n.isAsyncMode=function(){return!1},n.isConcurrentMode=function(){return!1},n.isContextConsumer=function(e){return E(e)===c},n.isContextProvider=function(e){return E(e)===l},n.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===r},n.isForwardRef=function(e){return E(e)===u},n.isFragment=function(e){return E(e)===o},n.isLazy=function(e){return E(e)===f},n.isMemo=function(e){return E(e)===h},n.isPortal=function(e){return E(e)===i},n.isProfiler=function(e){return E(e)===a},n.isStrictMode=function(e){return E(e)===s},n.isSuspense=function(e){return E(e)===d},n.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===o||e===a||e===y||e===s||e===d||e===p||e===b||"object"==typeof e&&null!==e&&(e.$$typeof===f||e.$$typeof===h||e.$$typeof===l||e.$$typeof===c||e.$$typeof===u||e.$$typeof===v||e.$$typeof===g||e[0]===m)},n.typeOf=E},{}],350:[function(e,t,n){"use strict";t.exports=e("./cjs/react-is.production.min.js")},{"./cjs/react-is.production.min.js":349}],351:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={GLOBAL:{HIDE:"__react_tooltip_hide_event",REBUILD:"__react_tooltip_rebuild_event",SHOW:"__react_tooltip_show_event"}}},{}],352:[function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){e.prototype.isCustomEvent=function(e){return this.state.event||!!e.getAttribute("data-event")},e.prototype.customBindListener=function(e){var t=this,n=this.state,r=n.event,o=n.eventOff,a=e.getAttribute("data-event")||r,l=e.getAttribute("data-event-off")||o;a.split(" ").forEach((function(n){e.removeEventListener(n,s.get(e,n));var r=i.bind(t,l);s.set(e,n,r),e.addEventListener(n,r,!1)})),l&&l.split(" ").forEach((function(n){e.removeEventListener(n,t.hideTooltip),e.addEventListener(n,t.hideTooltip,!1)}))},e.prototype.customUnbindListener=function(e){var t=this.state,n=t.event,r=t.eventOff,i=n||e.getAttribute("data-event"),o=r||e.getAttribute("data-event-off");e.removeEventListener(i,s.get(e,n)),o&&e.removeEventListener(o,this.hideTooltip)}};var i=function(e,t){var n=this.state.show,r=this.props.id,i=t.currentTarget.getAttribute("data-iscapture"),s=i&&"true"===i||this.props.isCapture,a=t.currentTarget.getAttribute("currentItem");s||t.stopPropagation(),n&&"true"===a?e||this.hideTooltip(t):(t.currentTarget.setAttribute("currentItem","true"),o(t.currentTarget,this.getTargetArray(r)),this.showTooltip(t))},o=function(e,t){for(var n=0;n<t.length;n++)e!==t[n]?t[n].setAttribute("currentItem","false"):t[n].setAttribute("currentItem","true")},s={id:"9b69f92e-d3fe-498b-b1b4-c5e63a51b0cf",set:function(e,t,n){this.id in e?e[this.id][t]=n:Object.defineProperty(e,this.id,{configurable:!0,value:r({},t,n)})},get:function(e,t){var n=e[this.id];if(void 0!==n)return n[t]}}},{}],353:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){e.prototype.getEffect=function(e){return e.getAttribute("data-effect")||this.props.effect||"float"}}},{}],354:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){e.prototype.isCapture=function(e){return e&&"true"===e.getAttribute("data-iscapture")||this.props.isCapture||!1}}},{}],355:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){e.hide=function(e){s(o.default.GLOBAL.HIDE,{target:e})},e.rebuild=function(){s(o.default.GLOBAL.REBUILD)},e.show=function(e){s(o.default.GLOBAL.SHOW,{target:e})},e.prototype.globalRebuild=function(){this.mount&&(this.unbindListener(),this.bindListener())},e.prototype.globalShow=function(e){if(this.mount){var t={currentTarget:e.detail.target};this.showTooltip(t,!0)}},e.prototype.globalHide=function(e){if(this.mount){var t=!!(e&&e.detail&&e.detail.target);this.hideTooltip({currentTarget:t&&e.detail.target},t)}}};var r,i=e("../constant"),o=(r=i)&&r.__esModule?r:{default:r};var s=function(e,t){var n=void 0;"function"==typeof window.CustomEvent?n=new window.CustomEvent(e,{detail:t}):((n=document.createEvent("Event")).initEvent(e,!1,!0),n.detail=t),window.dispatchEvent(n)}},{"../constant":351}],356:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){e.prototype.bindRemovalTracker=function(){var e=this,t=r();if(null!=t){var n=new t((function(t){for(var n=0;n<t.length;n++)for(var r=t[n],i=0;i<r.removedNodes.length;i++)if(r.removedNodes[i]===e.state.currentTarget)return void e.hideTooltip()}));n.observe(window.document,{childList:!0,subtree:!0}),this.removalTracker=n}},e.prototype.unbindRemovalTracker=function(){this.removalTracker&&(this.removalTracker.disconnect(),this.removalTracker=null)}};var r=function(){return window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver}},{}],357:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){e.prototype.bindWindowEvents=function(e){window.removeEventListener(o.default.GLOBAL.HIDE,this.globalHide),window.addEventListener(o.default.GLOBAL.HIDE,this.globalHide,!1),window.removeEventListener(o.default.GLOBAL.REBUILD,this.globalRebuild),window.addEventListener(o.default.GLOBAL.REBUILD,this.globalRebuild,!1),window.removeEventListener(o.default.GLOBAL.SHOW,this.globalShow),window.addEventListener(o.default.GLOBAL.SHOW,this.globalShow,!1),e&&(window.removeEventListener("resize",this.onWindowResize),window.addEventListener("resize",this.onWindowResize,!1))},e.prototype.unbindWindowEvents=function(){window.removeEventListener(o.default.GLOBAL.HIDE,this.globalHide),window.removeEventListener(o.default.GLOBAL.REBUILD,this.globalRebuild),window.removeEventListener(o.default.GLOBAL.SHOW,this.globalShow),window.removeEventListener("resize",this.onWindowResize)},e.prototype.onWindowResize=function(){this.mount&&this.hideTooltip()}};var r,i=e("../constant"),o=(r=i)&&r.__esModule?r:{default:r}},{"../constant":351}],358:[function(e,t,n){"use strict";var r,i,o,s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=S(e("react")),c=S(e("prop-types")),u=S(e("react-dom")),d=S(e("classnames")),p=S(e("sanitize-html-react")),h=S(e("./decorators/staticMethods")),f=S(e("./decorators/windowListener")),g=S(e("./decorators/customEvent")),m=S(e("./decorators/isCapture")),v=S(e("./decorators/getEffect")),y=S(e("./decorators/trackRemoval")),b=S(e("./utils/getPosition")),x=S(e("./utils/getTipContent")),E=e("./utils/aria"),_=S(e("./utils/nodeListToArray")),w=S(e("./style"));function S(e){return e&&e.__esModule?e:{default:e}}var T=(0,h.default)(r=(0,f.default)(r=(0,g.default)(r=(0,m.default)(r=(0,v.default)(r=(0,y.default)((o=i=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={place:e.place||"top",desiredPlace:e.place||"top",type:"dark",effect:"float",show:!1,border:!1,offset:{},extraClass:"",html:!1,delayHide:0,delayShow:0,event:e.event||null,eventOff:e.eventOff||null,currentEvent:null,currentTarget:null,ariaProps:(0,E.parseAria)(e),isEmptyTip:!1,disable:!1,originTooltip:null,isMultiline:!1},n.bind(["showTooltip","updateTooltip","hideTooltip","getTooltipContent","globalRebuild","globalShow","globalHide","onWindowResize","mouseOnToolTip"]),n.mount=!0,n.delayShowLoop=null,n.delayHideLoop=null,n.delayReshow=null,n.intervalUpdateContent=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.default.Component),a(t,[{key:"bind",value:function(e){var t=this;e.forEach((function(e){t[e]=t[e].bind(t)}))}},{key:"componentDidMount",value:function(){var e=this.props,t=e.insecure,n=e.resizeHide;t&&this.setStyleHeader(),this.bindListener(),this.bindWindowEvents(n)}},{key:"componentWillReceiveProps",value:function(e){var t=this.state.ariaProps,n=(0,E.parseAria)(e);Object.keys(n).some((function(e){return n[e]!==t[e]}))&&this.setState({ariaProps:n})}},{key:"componentWillUnmount",value:function(){this.mount=!1,this.clearTimer(),this.unbindListener(),this.removeScrollListener(),this.unbindWindowEvents()}},{key:"mouseOnToolTip",value:function(){return!(!this.state.show||!this.tooltipRef)&&(this.tooltipRef.matches||(this.tooltipRef.matches=this.tooltipRef.msMatchesSelector),this.tooltipRef.matches(":hover"))}},{key:"getTargetArray",value:function(e){var t=void 0;if(e){var n=e.replace(/\\/g,"\\\\").replace(/"/g,'\\"');t=document.querySelectorAll('[data-tip][data-for="'+n+'"]')}else t=document.querySelectorAll("[data-tip]:not([data-for])");return(0,_.default)(t)}},{key:"bindListener",value:function(){var e=this,t=this.props,n=t.id,r=t.globalEventOff,i=t.isCapture;this.getTargetArray(n).forEach((function(t){var n=e.isCapture(t),r=e.getEffect(t);null===t.getAttribute("currentItem")&&t.setAttribute("currentItem","false"),e.unbindBasicListener(t),e.isCustomEvent(t)?e.customBindListener(t):(t.addEventListener("mouseenter",e.showTooltip,n),"float"===r&&t.addEventListener("mousemove",e.updateTooltip,n),t.addEventListener("mouseleave",e.hideTooltip,n))})),r&&(window.removeEventListener(r,this.hideTooltip),window.addEventListener(r,this.hideTooltip,i)),this.bindRemovalTracker()}},{key:"unbindListener",value:function(){var e=this,t=this.props,n=t.id,r=t.globalEventOff;this.getTargetArray(n).forEach((function(t){e.unbindBasicListener(t),e.isCustomEvent(t)&&e.customUnbindListener(t)})),r&&window.removeEventListener(r,this.hideTooltip),this.unbindRemovalTracker()}},{key:"unbindBasicListener",value:function(e){var t=this.isCapture(e);e.removeEventListener("mouseenter",this.showTooltip,t),e.removeEventListener("mousemove",this.updateTooltip,t),e.removeEventListener("mouseleave",this.hideTooltip,t)}},{key:"getTooltipContent",value:function(){var e=this.props,t=e.getContent,n=e.children,r=void 0;return t&&(r=Array.isArray(t)?t[0]&&t[0](this.state.originTooltip):t(this.state.originTooltip)),(0,x.default)(this.state.originTooltip,n,r,this.state.isMultiline)}},{key:"isEmptyTip",value:function(e){return"string"==typeof e&&""===e||null===e}},{key:"showTooltip",value:function(e,t){if(!t||this.getTargetArray(this.props.id).some((function(t){return t===e.currentTarget}))){var n=this.props,r=n.multiline,i=n.getContent,o=e.currentTarget.getAttribute("data-tip"),s=e.currentTarget.getAttribute("data-multiline")||r||!1,a=e instanceof window.FocusEvent||t,l=!0;e.currentTarget.getAttribute("data-scroll-hide")?l="true"===e.currentTarget.getAttribute("data-scroll-hide"):null!=this.props.scrollHide&&(l=this.props.scrollHide);var c=e.currentTarget.getAttribute("data-place")||this.props.place||"top",d=a?"solid":this.getEffect(e.currentTarget),p=e.currentTarget.getAttribute("data-offset")||this.props.offset||{},h=(0,b.default)(e,e.currentTarget,u.default.findDOMNode(this),c,c,d,p),f=h.isNewState?h.newState.place:c;this.clearTimer();var g=e.currentTarget,m=this.state.show?g.getAttribute("data-delay-update")||this.props.delayUpdate:0,v=this,y=function(){v.setState({originTooltip:o,isMultiline:s,desiredPlace:c,place:f,type:g.getAttribute("data-type")||v.props.type||"dark",effect:d,offset:p,html:g.getAttribute("data-html")?"true"===g.getAttribute("data-html"):v.props.html||!1,delayShow:g.getAttribute("data-delay-show")||v.props.delayShow||0,delayHide:g.getAttribute("data-delay-hide")||v.props.delayHide||0,delayUpdate:g.getAttribute("data-delay-update")||v.props.delayUpdate||0,border:g.getAttribute("data-border")?"true"===g.getAttribute("data-border"):v.props.border||!1,extraClass:g.getAttribute("data-class")||v.props.class||v.props.className||"",disable:g.getAttribute("data-tip-disable")?"true"===g.getAttribute("data-tip-disable"):v.props.disable||!1,currentTarget:g},(function(){l&&v.addScrollListener(v.state.currentTarget),v.updateTooltip(e),i&&Array.isArray(i)&&(v.intervalUpdateContent=setInterval((function(){if(v.mount){var e=v.props.getContent,t=(0,x.default)(o,"",e[0](),s),n=v.isEmptyTip(t);v.setState({isEmptyTip:n}),v.updatePosition()}}),i[1]))}))};m?this.delayReshow=setTimeout(y,m):y()}}},{key:"updateTooltip",value:function(e){var t=this,n=this.state,r=n.delayShow,i=n.disable,o=this.props.afterShow,s=this.getTooltipContent(),a=parseInt(r,10),l=e.currentTarget||e.target;if(!this.mouseOnToolTip()&&!this.isEmptyTip(s)&&!i){var c=function(){if(Array.isArray(s)&&s.length>0||s){var n=!t.state.show;t.setState({currentEvent:e,currentTarget:l,show:!0},(function(){t.updatePosition(),n&&o&&o()}))}};clearTimeout(this.delayShowLoop),r?this.delayShowLoop=setTimeout(c,a):c()}}},{key:"listenForTooltipExit",value:function(){this.state.show&&this.tooltipRef&&this.tooltipRef.addEventListener("mouseleave",this.hideTooltip)}},{key:"removeListenerForTooltipExit",value:function(){this.state.show&&this.tooltipRef&&this.tooltipRef.removeEventListener("mouseleave",this.hideTooltip)}},{key:"hideTooltip",value:function(e,t){var n=this,r=this.state,i=r.delayHide,o=r.disable,s=this.props.afterHide,a=this.getTooltipContent();if(this.mount&&!this.isEmptyTip(a)&&!o){if(t&&(!this.getTargetArray(this.props.id).some((function(t){return t===e.currentTarget}))||!this.state.show))return;var l=function(){var e=n.state.show;n.mouseOnToolTip()?n.listenForTooltipExit():(n.removeListenerForTooltipExit(),n.setState({show:!1},(function(){n.removeScrollListener(),e&&s&&s()})))};this.clearTimer(),i?this.delayHideLoop=setTimeout(l,parseInt(i,10)):l()}}},{key:"addScrollListener",value:function(e){var t=this.isCapture(e);window.addEventListener("scroll",this.hideTooltip,t)}},{key:"removeScrollListener",value:function(){window.removeEventListener("scroll",this.hideTooltip)}},{key:"updatePosition",value:function(){var e=this,t=this.state,n=t.currentEvent,r=t.currentTarget,i=t.place,o=t.desiredPlace,s=t.effect,a=t.offset,l=u.default.findDOMNode(this),c=(0,b.default)(n,r,l,i,o,s,a);if(c.isNewState)return this.setState(c.newState,(function(){e.updatePosition()}));l.style.left=c.position.left+"px",l.style.top=c.position.top+"px"}},{key:"setStyleHeader",value:function(){var e=document.getElementsByTagName("head")[0];if(!e.querySelector('style[id="react-tooltip"]')){var t=document.createElement("style");t.id="react-tooltip",t.innerHTML=w.default,"undefined"!=typeof __webpack_nonce__&&__webpack_nonce__&&t.setAttribute("nonce",__webpack_nonce__),e.insertBefore(t,e.firstChild)}}},{key:"clearTimer",value:function(){clearTimeout(this.delayShowLoop),clearTimeout(this.delayHideLoop),clearTimeout(this.delayReshow),clearInterval(this.intervalUpdateContent)}},{key:"render",value:function(){var e=this,n=this.state,r=n.extraClass,i=n.html,o=n.ariaProps,a=n.disable,c=this.getTooltipContent(),u=this.isEmptyTip(c),h=(0,d.default)("__react_component_tooltip",{show:this.state.show&&!a&&!u},{border:this.state.border},{"place-top":"top"===this.state.place},{"place-bottom":"bottom"===this.state.place},{"place-left":"left"===this.state.place},{"place-right":"right"===this.state.place},{"type-dark":"dark"===this.state.type},{"type-success":"success"===this.state.type},{"type-warning":"warning"===this.state.type},{"type-error":"error"===this.state.type},{"type-info":"info"===this.state.type},{"type-light":"light"===this.state.type},{allow_hover:this.props.delayUpdate}),f=this.props.wrapper;return t.supportedWrappers.indexOf(f)<0&&(f=t.defaultProps.wrapper),i?l.default.createElement(f,s({className:h+" "+r,id:this.props.id,ref:function(t){return e.tooltipRef=t}},o,{"data-id":"tooltip",dangerouslySetInnerHTML:{__html:(0,p.default)(c,this.props.sanitizeHtmlOptions)}})):l.default.createElement(f,s({className:h+" "+r,id:this.props.id},o,{ref:function(t){return e.tooltipRef=t},"data-id":"tooltip"}),c)}}]),t}(),i.propTypes={children:c.default.any,place:c.default.string,type:c.default.string,effect:c.default.string,offset:c.default.object,multiline:c.default.bool,border:c.default.bool,insecure:c.default.bool,class:c.default.string,className:c.default.string,id:c.default.string,html:c.default.bool,delayHide:c.default.number,delayUpdate:c.default.number,delayShow:c.default.number,event:c.default.string,eventOff:c.default.string,watchWindow:c.default.bool,isCapture:c.default.bool,globalEventOff:c.default.string,getContent:c.default.any,afterShow:c.default.func,afterHide:c.default.func,disable:c.default.bool,scrollHide:c.default.bool,resizeHide:c.default.bool,wrapper:c.default.string,sanitizeHtmlOptions:c.default.any},i.defaultProps={insecure:!0,resizeHide:!0,wrapper:"div"},i.supportedWrappers=["div","span"],i.displayName="ReactTooltip",r=o))||r)||r)||r)||r)||r)||r;t.exports=T},{"./decorators/customEvent":352,"./decorators/getEffect":353,"./decorators/isCapture":354,"./decorators/staticMethods":355,"./decorators/trackRemoval":356,"./decorators/windowListener":357,"./style":359,"./utils/aria":360,"./utils/getPosition":361,"./utils/getTipContent":362,"./utils/nodeListToArray":363,classnames:227,"prop-types":305,react:366,"react-dom":309,"sanitize-html-react":387}],359:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default='.__react_component_tooltip{border-radius:3px;display:inline-block;font-size:13px;left:-999em;opacity:0;padding:8px 21px;position:fixed;pointer-events:none;transition:opacity 0.3s ease-out;top:-999em;visibility:hidden;z-index:999}.__react_component_tooltip.allow_hover{pointer-events:auto}.__react_component_tooltip:before,.__react_component_tooltip:after{content:"";width:0;height:0;position:absolute}.__react_component_tooltip.show{opacity:0.9;margin-top:0px;margin-left:0px;visibility:visible}.__react_component_tooltip.type-dark{color:#fff;background-color:#222}.__react_component_tooltip.type-dark.place-top:after{border-top-color:#222;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-dark.place-bottom:after{border-bottom-color:#222;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-dark.place-left:after{border-left-color:#222;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-dark.place-right:after{border-right-color:#222;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-dark.border{border:1px solid #fff}.__react_component_tooltip.type-dark.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-dark.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-dark.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-dark.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-success{color:#fff;background-color:#8DC572}.__react_component_tooltip.type-success.place-top:after{border-top-color:#8DC572;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-success.place-bottom:after{border-bottom-color:#8DC572;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-success.place-left:after{border-left-color:#8DC572;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-success.place-right:after{border-right-color:#8DC572;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-success.border{border:1px solid #fff}.__react_component_tooltip.type-success.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-success.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-success.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-success.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-warning{color:#fff;background-color:#F0AD4E}.__react_component_tooltip.type-warning.place-top:after{border-top-color:#F0AD4E;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-warning.place-bottom:after{border-bottom-color:#F0AD4E;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-warning.place-left:after{border-left-color:#F0AD4E;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-warning.place-right:after{border-right-color:#F0AD4E;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-warning.border{border:1px solid #fff}.__react_component_tooltip.type-warning.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-warning.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-warning.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-warning.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-error{color:#fff;background-color:#BE6464}.__react_component_tooltip.type-error.place-top:after{border-top-color:#BE6464;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-error.place-bottom:after{border-bottom-color:#BE6464;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-error.place-left:after{border-left-color:#BE6464;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-error.place-right:after{border-right-color:#BE6464;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-error.border{border:1px solid #fff}.__react_component_tooltip.type-error.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-error.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-error.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-error.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-info{color:#fff;background-color:#337AB7}.__react_component_tooltip.type-info.place-top:after{border-top-color:#337AB7;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-info.place-bottom:after{border-bottom-color:#337AB7;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-info.place-left:after{border-left-color:#337AB7;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-info.place-right:after{border-right-color:#337AB7;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-info.border{border:1px solid #fff}.__react_component_tooltip.type-info.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-info.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-info.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-info.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-light{color:#222;background-color:#fff}.__react_component_tooltip.type-light.place-top:after{border-top-color:#fff;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-light.place-bottom:after{border-bottom-color:#fff;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-light.place-left:after{border-left-color:#fff;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-light.place-right:after{border-right-color:#fff;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-light.border{border:1px solid #222}.__react_component_tooltip.type-light.border.place-top:before{border-top:8px solid #222}.__react_component_tooltip.type-light.border.place-bottom:before{border-bottom:8px solid #222}.__react_component_tooltip.type-light.border.place-left:before{border-left:8px solid #222}.__react_component_tooltip.type-light.border.place-right:before{border-right:8px solid #222}.__react_component_tooltip.place-top{margin-top:-10px}.__react_component_tooltip.place-top:before{border-left:10px solid transparent;border-right:10px solid transparent;bottom:-8px;left:50%;margin-left:-10px}.__react_component_tooltip.place-top:after{border-left:8px solid transparent;border-right:8px solid transparent;bottom:-6px;left:50%;margin-left:-8px}.__react_component_tooltip.place-bottom{margin-top:10px}.__react_component_tooltip.place-bottom:before{border-left:10px solid transparent;border-right:10px solid transparent;top:-8px;left:50%;margin-left:-10px}.__react_component_tooltip.place-bottom:after{border-left:8px solid transparent;border-right:8px solid transparent;top:-6px;left:50%;margin-left:-8px}.__react_component_tooltip.place-left{margin-left:-10px}.__react_component_tooltip.place-left:before{border-top:6px solid transparent;border-bottom:6px solid transparent;right:-8px;top:50%;margin-top:-5px}.__react_component_tooltip.place-left:after{border-top:5px solid transparent;border-bottom:5px solid transparent;right:-6px;top:50%;margin-top:-4px}.__react_component_tooltip.place-right{margin-left:10px}.__react_component_tooltip.place-right:before{border-top:6px solid transparent;border-bottom:6px solid transparent;left:-8px;top:50%;margin-top:-5px}.__react_component_tooltip.place-right:after{border-top:5px solid transparent;border-bottom:5px solid transparent;left:-6px;top:50%;margin-top:-4px}.__react_component_tooltip .multi-line{display:block;padding:2px 0px;text-align:center}'},{}],360:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.parseAria=function(e){var t={};return Object.keys(e).filter((function(e){return/(^aria-\w+$|^role$)/.test(e)})).forEach((function(n){t[n]=e[n]})),t}},{}],361:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t,n,l,c,u,d){for(var p=r(n),h=p.width,f=p.height,g=r(t),m=g.width,v=g.height,y=i(e,t,u),b=y.mouseX,x=y.mouseY,E=o(u,m,v,h,f),_=s(d),w=_.extraOffset_X,S=_.extraOffset_Y,T=window.innerWidth,k=window.innerHeight,C=a(n),A=C.parentTop,j=C.parentLeft,I=function(e){var t=E[e].l;return b+t+w},O=function(e){var t=E[e].t;return x+t+S},N=function(e){return function(e){return I(e)<0}(e)||function(e){return t=E[e].r,b+t+w>T;var t}(e)||function(e){return O(e)<0}(e)||function(e){return t=E[e].b,x+t+S>k;var t}(e)},R=function(e){return!N(e)},P=["top","bottom","left","right"],D=[],M=0;M<4;M++){var L=P[M];R(L)&&D.push(L)}var B=!1,F=void 0;return R(c)&&c!==l?(B=!0,F=c):D.length>0&&N(c)&&N(l)&&(B=!0,F=D[0]),B?{isNewState:!0,newState:{place:F}}:{isNewState:!1,position:{left:parseInt(I(l)-j,10),top:parseInt(O(l)-A,10)}}};var r=function(e){var t=e.getBoundingClientRect(),n=t.height,r=t.width;return{height:parseInt(n,10),width:parseInt(r,10)}},i=function(e,t,n){var i=t.getBoundingClientRect(),o=i.top,s=i.left,a=r(t),l=a.width,c=a.height;return"float"===n?{mouseX:e.clientX,mouseY:e.clientY}:{mouseX:s+l/2,mouseY:o+c/2}},o=function(e,t,n,r,i){var o=void 0,s=void 0,a=void 0,l=void 0;return"float"===e?(o={l:-r/2,r:r/2,t:-(i+3+2),b:-3},a={l:-r/2,r:r/2,t:15,b:i+3+2+12},l={l:-(r+3+2),r:-3,t:-i/2,b:i/2},s={l:3,r:r+3+2,t:-i/2,b:i/2}):"solid"===e&&(o={l:-r/2,r:r/2,t:-(n/2+i+2),b:-n/2},a={l:-r/2,r:r/2,t:n/2,b:n/2+i+2},l={l:-(r+t/2+2),r:-t/2,t:-i/2,b:i/2},s={l:t/2,r:r+t/2+2,t:-i/2,b:i/2}),{top:o,bottom:a,left:l,right:s}},s=function(e){var t=0,n=0;for(var r in"[object String]"===Object.prototype.toString.apply(e)&&(e=JSON.parse(e.toString().replace(/\'/g,'"'))),e)"top"===r?n-=parseInt(e[r],10):"bottom"===r?n+=parseInt(e[r],10):"left"===r?t-=parseInt(e[r],10):"right"===r&&(t+=parseInt(e[r],10));return{extraOffset_X:t,extraOffset_Y:n}},a=function(e){for(var t=e;t&&"none"===window.getComputedStyle(t).getPropertyValue("transform");)t=t.parentElement;return{parentTop:t&&t.getBoundingClientRect().top||0,parentLeft:t&&t.getBoundingClientRect().left||0}}},{}],362:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t,n,r){if(t)return t;if(null!=n)return n;if(null===n)return null;var i=/<br\s*\/?>/;return r&&"false"!==r&&i.test(e)?e.split(i).map((function(e,t){return o.default.createElement("span",{key:t,className:"multi-line"},e)})):e};var r,i=e("react"),o=(r=i)&&r.__esModule?r:{default:r}},{react:366}],363:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){var t=e.length;return e.hasOwnProperty?Array.prototype.slice.call(e):new Array(t).fill().map((function(t){return e[t]}))}},{}],364:[function(e,t,n){"use strict";e("object-assign");var r=e("react"),i=60103;if(n.Fragment=60107,"function"==typeof Symbol&&Symbol.for){var o=Symbol.for;i=o("react.element"),n.Fragment=o("react.fragment")}var s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a=Object.prototype.hasOwnProperty,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,o={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,r)&&!l.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:u,props:o,_owner:s.current}}n.jsx=c,n.jsxs=c},{"object-assign":288,react:366}],365:[function(e,t,n){"use strict";var r=e("object-assign"),i=60103,o=60106;n.Fragment=60107,n.StrictMode=60108,n.Profiler=60114;var s=60109,a=60110,l=60112;n.Suspense=60113;var c=60115,u=60116;if("function"==typeof Symbol&&Symbol.for){var d=Symbol.for;i=d("react.element"),o=d("react.portal"),n.Fragment=d("react.fragment"),n.StrictMode=d("react.strict_mode"),n.Profiler=d("react.profiler"),s=d("react.provider"),a=d("react.context"),l=d("react.forward_ref"),n.Suspense=d("react.suspense"),c=d("react.memo"),u=d("react.lazy")}var p="function"==typeof Symbol&&Symbol.iterator;function h(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g={};function m(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function v(){}function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}m.prototype.isReactComponent={},m.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(h(85));this.updater.enqueueSetState(this,e,t,"setState")},m.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=m.prototype;var b=y.prototype=new v;b.constructor=y,r(b,m.prototype),b.isPureReactComponent=!0;var x={current:null},E=Object.prototype.hasOwnProperty,_={key:!0,ref:!0,__self:!0,__source:!0};function w(e,t,n){var r,o={},s=null,a=null;if(null!=t)for(r in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)E.call(t,r)&&!_.hasOwnProperty(r)&&(o[r]=t[r]);var l=arguments.length-2;if(1===l)o.children=n;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===o[r]&&(o[r]=l[r]);return{$$typeof:i,type:e,key:s,ref:a,props:o,_owner:x.current}}function S(e){return"object"==typeof e&&null!==e&&e.$$typeof===i}var T=/\/+/g;function k(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function C(e,t,n,r,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case i:case o:l=!0}}if(l)return s=s(l=e),e=""===r?"."+k(l,0):r,Array.isArray(s)?(n="",null!=e&&(n=e.replace(T,"$&/")+"/"),C(s,t,n,"",(function(e){return e}))):null!=s&&(S(s)&&(s=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,n+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(T,"$&/")+"/")+e)),t.push(s)),1;if(l=0,r=""===r?".":r+":",Array.isArray(e))for(var c=0;c<e.length;c++){var u=r+k(a=e[c],c);l+=C(a,t,n,u,s)}else if("function"==typeof(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e)))for(e=u.call(e),c=0;!(a=e.next()).done;)l+=C(a=a.value,t,n,u=r+k(a,c++),s);else if("object"===a)throw t=""+e,Error(h(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return l}function A(e,t,n){if(null==e)return e;var r=[],i=0;return C(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function j(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var I={current:null};function O(){var e=I.current;if(null===e)throw Error(h(321));return e}var N={ReactCurrentDispatcher:I,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:x,IsSomeRendererActing:{current:!1},assign:r};n.Children={map:A,forEach:function(e,t,n){A(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return A(e,(function(){t++})),t},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!S(e))throw Error(h(143));return e}},n.Component=m,n.PureComponent=y,n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=N,n.cloneElement=function(e,t,n){if(null==e)throw Error(h(267,e));var o=r({},e.props),s=e.key,a=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,l=x.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)E.call(t,u)&&!_.hasOwnProperty(u)&&(o[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)o.children=n;else if(1<u){c=Array(u);for(var d=0;d<u;d++)c[d]=arguments[d+2];o.children=c}return{$$typeof:i,type:e.type,key:s,ref:a,props:o,_owner:l}},n.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:a,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},n.createElement=w,n.createFactory=function(e){var t=w.bind(null,e);return t.type=e,t},n.createRef=function(){return{current:null}},n.forwardRef=function(e){return{$$typeof:l,render:e}},n.isValidElement=S,n.lazy=function(e){return{$$typeof:u,_payload:{_status:-1,_result:e},_init:j}},n.memo=function(e,t){return{$$typeof:c,type:e,compare:void 0===t?null:t}},n.useCallback=function(e,t){return O().useCallback(e,t)},n.useContext=function(e,t){return O().useContext(e,t)},n.useDebugValue=function(){},n.useEffect=function(e,t){return O().useEffect(e,t)},n.useImperativeHandle=function(e,t,n){return O().useImperativeHandle(e,t,n)},n.useLayoutEffect=function(e,t){return O().useLayoutEffect(e,t)},n.useMemo=function(e,t){return O().useMemo(e,t)},n.useReducer=function(e,t,n){return O().useReducer(e,t,n)},n.useRef=function(e){return O().useRef(e)},n.useState=function(e){return O().useState(e)},n.version="17.0.2"},{"object-assign":288}],366:[function(e,t,n){"use strict";t.exports=e("./cjs/react.production.min.js")},{"./cjs/react.production.min.js":365}],367:[function(e,t,n){"use strict";t.exports=e("./cjs/react-jsx-runtime.production.min.js")},{"./cjs/react-jsx-runtime.production.min.js":364}],368:[function(e,t,n){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":369}],369:[function(e,t,n){"use strict";var r=e("process-nextick-args"),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=d;var o=Object.create(e("core-util-is"));o.inherits=e("inherits");var s=e("./_stream_readable"),a=e("./_stream_writable");o.inherits(d,s);for(var l=i(a.prototype),c=0;c<l.length;c++){var u=l[c];d.prototype[u]||(d.prototype[u]=a.prototype[u])}function d(e){if(!(this instanceof d))return new d(e);s.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",p)}function p(){this.allowHalfOpen||this._writableState.ended||r.nextTick(h,this)}function h(e){e.end()}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),d.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},{"./_stream_readable":371,"./_stream_writable":373,"core-util-is":228,inherits:247,"process-nextick-args":302}],370:[function(e,t,n){"use strict";t.exports=o;var r=e("./_stream_transform"),i=Object.create(e("core-util-is"));function o(e){if(!(this instanceof o))return new o(e);r.call(this,e)}i.inherits=e("inherits"),i.inherits(o,r),o.prototype._transform=function(e,t,n){n(null,e)}},{"./_stream_transform":372,"core-util-is":228,inherits:247}],371:[function(e,t,n){(function(n,r){(function(){"use strict";var i=e("process-nextick-args");t.exports=b;var o,s=e("isarray");b.ReadableState=y;e("events").EventEmitter;var a=function(e,t){return e.listeners(t).length},l=e("./internal/streams/stream"),c=e("safe-buffer").Buffer,u=(void 0!==r?r:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var d=Object.create(e("core-util-is"));d.inherits=e("inherits");var p=e("util"),h=void 0;h=p&&p.debuglog?p.debuglog("stream"):function(){};var f,g=e("./internal/streams/BufferList"),m=e("./internal/streams/destroy");d.inherits(b,l);var v=["error","close","destroy","pause","resume"];function y(t,n){t=t||{};var r=n instanceof(o=o||e("./_stream_duplex"));this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var i=t.highWaterMark,s=t.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(f||(f=e("string_decoder/").StringDecoder),this.decoder=new f(t.encoding),this.encoding=t.encoding)}function b(t){if(o=o||e("./_stream_duplex"),!(this instanceof b))return new b(t);this._readableState=new y(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),l.call(this)}function x(e,t,n,r,i){var o,s=e._readableState;return null===t?(s.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,S(e)}}(e,s)):(i||(o=function(e,t){var n;return function(e){return c.isBuffer(e)||e instanceof u}(t)||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(s,t)),o?e.emit("error",o):s.objectMode||t&&t.length>0?("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===c.prototype||(t=function(e){return c.from(e)}(t)),r?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):E(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!n?(t=s.decoder.write(t),s.objectMode||0!==t.length?E(e,s,t,!1):k(e,s)):E(e,s,t,!1))):r||(s.reading=!1)),function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(s)}function E(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&S(e)),k(e,t)}Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),b.prototype.destroy=m.destroy,b.prototype._undestroy=m.undestroy,b.prototype._destroy=function(e,t){this.push(null),t(e)},b.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=c.from(e,t),t=""),n=!0),x(this,e,t,!1,n)},b.prototype.unshift=function(e){return x(this,e,null,!0,!1)},b.prototype.isPaused=function(){return!1===this._readableState.flowing},b.prototype.setEncoding=function(t){return f||(f=e("string_decoder/").StringDecoder),this._readableState.decoder=new f(t),this._readableState.encoding=t,this};var _=8388608;function w(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=_?e=_:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function S(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(h("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(T,e):T(e))}function T(e){h("emit readable"),e.emit("readable"),I(e)}function k(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(C,e,t))}function C(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(h("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function A(e){h("readable nexttick read 0"),e.read(0)}function j(e,t){t.reading||(h("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),I(e),t.flowing&&!t.reading&&e.read(0)}function I(e){var t=e._readableState;for(h("flow",t.flowing);t.flowing&&null!==e.read(););}function O(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(s===o.length?i+=o:i+=o.slice(0,e),0==(e-=s)){s===o.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(s));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=c.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,s),0==(e-=s)){s===o.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++i}return t.length-=i,n}(e,t),r}(e,t.buffer,t.decoder),n);var n}function N(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(R,t,e))}function R(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function P(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}b.prototype.read=function(e){h("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return h("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?N(this):S(this),null;if(0===(e=w(e,t))&&t.ended)return 0===t.length&&N(this),null;var r,i=t.needReadable;return h("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&h("length less than watermark",i=!0),t.ended||t.reading?h("reading or ended",i=!1):i&&(h("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=w(n,t))),null===(r=e>0?O(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&N(this)),null!==r&&this.emit("data",r),r},b.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},b.prototype.pipe=function(e,t){var r=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,h("pipe count=%d opts=%j",o.pipesCount,t);var l=t&&!1===t.end||e===n.stdout||e===n.stderr?y:c;function c(){h("onend"),e.end()}o.endEmitted?i.nextTick(l):r.once("end",l),e.on("unpipe",(function t(n,i){h("onunpipe"),n===r&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,h("cleanup"),e.removeListener("close",m),e.removeListener("finish",v),e.removeListener("drain",u),e.removeListener("error",g),e.removeListener("unpipe",t),r.removeListener("end",c),r.removeListener("end",y),r.removeListener("data",f),d=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||u())}));var u=function(e){return function(){var t=e._readableState;h("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,I(e))}}(r);e.on("drain",u);var d=!1,p=!1;function f(t){h("ondata"),p=!1,!1!==e.write(t)||p||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==P(o.pipes,e))&&!d&&(h("false write response, pause",o.awaitDrain),o.awaitDrain++,p=!0),r.pause())}function g(t){h("onerror",t),y(),e.removeListener("error",g),0===a(e,"error")&&e.emit("error",t)}function m(){e.removeListener("finish",v),y()}function v(){h("onfinish"),e.removeListener("close",m),y()}function y(){h("unpipe"),r.unpipe(e)}return r.on("data",f),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?s(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",g),e.once("close",m),e.once("finish",v),e.emit("pipe",r),o.flowing||(h("pipe resume"),r.resume()),e},b.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,{hasUnpiped:!1});return this}var s=P(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},b.prototype.on=function(e,t){var n=l.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&S(this):i.nextTick(A,this))}return n},b.prototype.addListener=b.prototype.on,b.prototype.resume=function(){var e=this._readableState;return e.flowing||(h("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(j,e,t))}(this,e)),this},b.prototype.pause=function(){return h("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(h("pause"),this._readableState.flowing=!1,this.emit("pause")),this},b.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",(function(){if(h("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){h("wrapped data"),n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i||(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<v.length;o++)e.on(v[o],this.emit.bind(this,v[o]));return this._read=function(t){h("wrapped _read",t),r&&(r=!1,e.resume())},this},Object.defineProperty(b.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),b._fromList=O}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":369,"./internal/streams/BufferList":374,"./internal/streams/destroy":375,"./internal/streams/stream":376,_process:303,"core-util-is":228,events:241,inherits:247,isarray:377,"process-nextick-args":302,"safe-buffer":378,"string_decoder/":379,util:225}],372:[function(e,t,n){"use strict";t.exports=s;var r=e("./_stream_duplex"),i=Object.create(e("core-util-is"));function o(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function s(e){if(!(this instanceof s))return new s(e);r.call(this,e),this._transformState={afterTransform:o.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",a)}function a(){var e=this;"function"==typeof this._flush?this._flush((function(t,n){l(e,t,n)})):l(this,null,null)}function l(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=e("inherits"),i.inherits(s,r),s.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},s.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},s.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},s.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},s.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,(function(e){t(e),n.emit("close")}))}},{"./_stream_duplex":369,"core-util-is":228,inherits:247}],373:[function(e,t,n){(function(n,r,i){(function(){"use strict";var o=e("process-nextick-args");function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree.next=e}(t,e)}}t.exports=y;var a,l=!n.browser&&["v0.10","v0.9."].indexOf(n.version.slice(0,5))>-1?i:o.nextTick;y.WritableState=v;var c=Object.create(e("core-util-is"));c.inherits=e("inherits");var u={deprecate:e("util-deprecate")},d=e("./internal/streams/stream"),p=e("safe-buffer").Buffer,h=(void 0!==r?r:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var f,g=e("./internal/streams/destroy");function m(){}function v(t,n){a=a||e("./_stream_duplex"),t=t||{};var r=n instanceof a;this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var i=t.highWaterMark,c=t.writableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(c||0===c)?c:u,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var d=!1===t.decodeStrings;this.decodeStrings=!d,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?(o.nextTick(i,r),o.nextTick(T,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(i(r),e._writableState.errorEmitted=!0,e.emit("error",r),T(e,t))}(e,n,r,t,i);else{var s=w(n);s||n.corked||n.bufferProcessing||!n.bufferedRequest||_(e,n),r?l(E,e,n,s,i):E(e,n,s,i)}}(n,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function y(t){if(a=a||e("./_stream_duplex"),!(f.call(y,this)||this instanceof a))return new y(t);this._writableState=new v(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),d.call(this)}function b(e,t,n,r,i,o){if(!n){var s=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=p.from(t,n)),t}(t,r,i);r!==s&&(n=!0,i="buffer",r=s)}var a=t.objectMode?1:r.length;t.length+=a;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else x(e,t,!1,a,r,i,o);return l}function x(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function E(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),T(e,t)}function _(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var a=0,l=!0;n;)i[a]=n,n.isBuf||(l=!1),n=n.next,a+=1;i.allBuffers=l,x(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,u=n.encoding,d=n.callback;if(x(e,t,!1,t.objectMode?1:c.length,c,u,d),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function w(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function S(e,t){e._final((function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),T(e,t)}))}function T(e,t){var n=w(t);return n&&(function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,o.nextTick(S,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}c.inherits(y,d),v.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(v.prototype,"buffer",{get:u.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(f=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(e){return!!f.call(this,e)||this===y&&e&&e._writableState instanceof v}})):f=function(e){return e instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(e,t,n){var r=this._writableState,i=!1,s=!r.objectMode&&function(e){return p.isBuffer(e)||e instanceof h}(e);return s&&!p.isBuffer(e)&&(e=function(e){return p.from(e)}(e)),"function"==typeof t&&(n=t,t=null),s?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=m),r.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),o.nextTick(t,n)}(this,n):(s||function(e,t,n,r){var i=!0,s=!1;return null===n?s=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),o.nextTick(r,s),i=!1),i}(this,r,e,n))&&(r.pendingcb++,i=b(this,r,s,e,t,n)),i},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||_(this,e))},y.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(y.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),y.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||function(e,t,n){t.ending=!0,T(e,t),n&&(t.finished?o.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),y.prototype.destroy=g.destroy,y.prototype._undestroy=g.undestroy,y.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("timers").setImmediate)},{"./_stream_duplex":369,"./internal/streams/destroy":375,"./internal/streams/stream":376,_process:303,"core-util-is":228,inherits:247,"process-nextick-args":302,"safe-buffer":378,timers:438,"util-deprecate":439}],374:[function(e,t,n){"use strict";var r=e("safe-buffer").Buffer,i=e("util");function o(e,t,n){e.copy(t,n)}t.exports=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);for(var t=r.allocUnsafe(e>>>0),n=this.head,i=0;n;)o(n.data,t,i),i+=n.data.length,n=n.next;return t},e}(),i&&i.inspect&&i.inspect.custom&&(t.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},{"safe-buffer":378,util:225}],375:[function(e,t,n){"use strict";var r=e("process-nextick-args");function i(e,t){e.emit("error",t)}t.exports={destroy:function(e,t){var n=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,r.nextTick(i,this,e)):r.nextTick(i,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?n._writableState?n._writableState.errorEmitted||(n._writableState.errorEmitted=!0,r.nextTick(i,n,e)):r.nextTick(i,n,e):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":302}],376:[function(e,t,n){t.exports=e("events").EventEmitter},{events:241}],377:[function(e,t,n){var r={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},{}],378:[function(e,t,n){var r=e("buffer"),i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=r:(o(r,n),n.Buffer=s),o(i,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},{buffer:226}],379:[function(e,t,n){"use strict";var r=e("safe-buffer").Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=u,this.end=d,t=3;break;default:return this.write=p,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function u(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function p(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}n.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},o.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=s(t[r]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--r<n||-2===i?0:(i=s(t[r]))>=0?(i>0&&(e.lastNeed=i-2),i):--r<n||-2===i?0:(i=s(t[r]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":378}],380:[function(e,t,n){t.exports=e("./readable").PassThrough},{"./readable":381}],381:[function(e,t,n){(n=t.exports=e("./lib/_stream_readable.js")).Stream=n,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":369,"./lib/_stream_passthrough.js":370,"./lib/_stream_readable.js":371,"./lib/_stream_transform.js":372,"./lib/_stream_writable.js":373}],382:[function(e,t,n){t.exports=e("./readable").Transform},{"./readable":381}],383:[function(e,t,n){t.exports=e("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":373}],384:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@babel/runtime/helpers/objectSpread2");var i,o=(i=r)&&"object"==typeof i&&"default"in i?i:{default:i};function s(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var a="function"==typeof Symbol&&Symbol.observable||"@@observable",l=function(){return Math.random().toString(36).substring(7).split("").join(".")},c={INIT:"@@redux/INIT"+l(),REPLACE:"@@redux/REPLACE"+l(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+l()}};function u(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function d(e,t,n){var r;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error(s(0));if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error(s(1));return n(d)(e,t)}if("function"!=typeof e)throw new Error(s(2));var i=e,o=t,l=[],p=l,h=!1;function f(){p===l&&(p=l.slice())}function g(){if(h)throw new Error(s(3));return o}function m(e){if("function"!=typeof e)throw new Error(s(4));if(h)throw new Error(s(5));var t=!0;return f(),p.push(e),function(){if(t){if(h)throw new Error(s(6));t=!1,f();var n=p.indexOf(e);p.splice(n,1),l=null}}}function v(e){if(!u(e))throw new Error(s(7));if(void 0===e.type)throw new Error(s(8));if(h)throw new Error(s(9));try{h=!0,o=i(o,e)}finally{h=!1}for(var t=l=p,n=0;n<t.length;n++)(0,t[n])();return e}return v({type:c.INIT}),(r={dispatch:v,subscribe:m,getState:g,replaceReducer:function(e){if("function"!=typeof e)throw new Error(s(10));i=e,v({type:c.REPLACE})}})[a]=function(){var e,t=m;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(s(11));function n(){e.next&&e.next(g())}return n(),{unsubscribe:t(n)}}})[a]=function(){return this},e},r}var p=d;function h(e,t){return function(){return t(e.apply(this,arguments))}}function f(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}n.__DO_NOT_USE__ActionTypes=c,n.applyMiddleware=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){var n=e.apply(void 0,arguments),r=function(){throw new Error(s(15))},i={getState:n.getState,dispatch:function(){return r.apply(void 0,arguments)}},a=t.map((function(e){return e(i)}));return r=f.apply(void 0,a)(n.dispatch),o.default(o.default({},n),{},{dispatch:r})}}},n.bindActionCreators=function(e,t){if("function"==typeof e)return h(e,t);if("object"!=typeof e||null===e)throw new Error(s(16));var n={};for(var r in e){var i=e[r];"function"==typeof i&&(n[r]=h(i,t))}return n},n.combineReducers=function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var i=t[r];"function"==typeof e[i]&&(n[i]=e[i])}var o,a=Object.keys(n);try{!function(e){Object.keys(e).forEach((function(t){var n=e[t];if(void 0===n(void 0,{type:c.INIT}))throw new Error(s(12));if(void 0===n(void 0,{type:c.PROBE_UNKNOWN_ACTION()}))throw new Error(s(13))}))}(n)}catch(e){o=e}return function(e,t){if(void 0===e&&(e={}),o)throw o;for(var r=!1,i={},l=0;l<a.length;l++){var c=a[l],u=n[c],d=e[c],p=u(d,t);if(void 0===p)throw t&&t.type,new Error(s(14));i[c]=p,r=r||p!==d}return(r=r||a.length!==Object.keys(e).length)?i:e}},n.compose=f,n.createStore=d,n.legacy_createStore=p},{"@babel/runtime/helpers/objectSpread2":213}],385:[function(e,t,n){t.exports=function(e){return e.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")}},{}],386:[function(e,t,n){var r=e("buffer"),i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=r:(o(r,n),n.Buffer=s),s.prototype=Object.create(i.prototype),o(i,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},{buffer:226}],387:[function(e,t,n){var r=e("htmlparser2"),i=e("xtend"),o=e("regexp-quote");function s(e,t){e&&Object.keys(e).forEach((function(n){t(e[n],n)}))}function a(e,t){return{}.hasOwnProperty.call(e,t)}function l(e,t,n){var u="";function d(e,t){var n=this;this.tag=e,this.attribs=t||{},this.tagPosition=u.length,this.text="",this.updateParentNodeText=function(){b.length&&(b[b.length-1].text+=n.text)}}t?(t=i(l.defaults,t)).parser?t.parser=i(c,t.parser):t.parser=c:(t=l.defaults).parser=c;var p,h,f=t.nonTextTags||["script","style","textarea"];t.allowedAttributes&&(p={},h={},s(t.allowedAttributes,(function(e,t){p[t]=[];var n=[];e.forEach((function(e){e.indexOf("*")>=0?n.push(o(e).replace(/\\\*/g,".*")):p[t].push(e)})),h[t]=new RegExp("^("+n.join("|")+")$")})));var g={};s(t.allowedClasses,(function(e,t){p&&(a(p,t)||(p[t]=[]),p[t].push("class")),g[t]=e}));var m,v={};s(t.transformTags,(function(e,t){var n;"function"==typeof e?n=e:"string"==typeof e&&(n=l.simpleTransform(e)),"*"===t?m=n:v[t]=n}));var y=0,b=[],x={},E={},_=!1,w=0,S=new r.Parser({onopentag:function(e,n){if(_)w++;else{var r=new d(e,n);b.push(r);var i,o=!1,l=!!r.text;a(v,e)&&(i=v[e](e,n),r.attribs=n=i.attribs,void 0!==i.text&&(r.innerText=i.text),e!==i.tagName&&(r.name=e=i.tagName,E[y]=i.tagName)),m&&(i=m(e,n),r.attribs=n=i.attribs,e!==i.tagName&&(r.name=e=i.tagName,E[y]=i.tagName)),t.allowedTags&&-1===t.allowedTags.indexOf(e)&&(o=!0,-1!==f.indexOf(e)&&(_=!0,w=1),x[y]=!0),y++,o||(u+="<"+e,(!p||a(p,e)||p["*"])&&s(n,(function(n,i){if(!p||a(p,e)&&-1!==p[e].indexOf(i)||p["*"]&&-1!==p["*"].indexOf(i)||a(h,e)&&h[e].test(i)||h["*"]&&h["*"].test(i)){if(("href"===i||"src"===i)&&function(e,n){var r=(n=(n=n.replace(/[\x00-\x20]+/g,"")).replace(/<\!\-\-.*?\-\-\>/g,"")).match(/^([a-zA-Z]+)\:/);if(!r)return!1;var i=r[1].toLowerCase();return a(t.allowedSchemesByTag,e)?-1===t.allowedSchemesByTag[e].indexOf(i):!t.allowedSchemes||-1===t.allowedSchemes.indexOf(i)}(e,n))return void delete r.attribs[i];if("class"===i&&!(n=function(e,t){return t?(e=e.split(/\s+/)).filter((function(e){return-1!==t.indexOf(e)})).join(" "):e}(n,g[e])).length)return void delete r.attribs[i];u+=" "+i,n.length&&(u+='="'+n+'"')}else delete r.attribs[i]})),-1!==t.selfClosing.indexOf(e)?u+=" />":(u+=">",!r.innerText||l||t.textFilter||(u+=r.innerText)))}},ontext:function(e){if(!_){var n,r=b[b.length-1];r&&(n=r.tag,e=void 0!==r.innerText?r.innerText:e),"script"===n||"style"===n?u+=e:t.textFilter?u+=t.textFilter(e):u+=e,b.length&&(b[b.length-1].text+=e)}},onclosetag:function(e){if(_){if(--w)return;_=!1}var n=b.pop();if(n){if(_=!1,x[--y])return delete x[y],void n.updateParentNodeText();E[y]&&(e=E[y],delete E[y]),t.exclusiveFilter&&t.exclusiveFilter(n)?u=u.substr(0,n.tagPosition):(n.updateParentNodeText(),-1===t.selfClosing.indexOf(e)&&(u+="</"+e+">"))}}},t.parser);return S.write(e),S.end(),u}t.exports=l;var c={decodeEntities:!0};l.defaults={allowedTags:["h3","h4","h5","h6","blockquote","p","a","ul","ol","nl","li","b","i","strong","em","strike","code","hr","br","div","table","thead","caption","tbody","tr","th","td","pre"],allowedAttributes:{a:["href","name","target"],img:["src"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto"],allowedSchemesByTag:{}},l.simpleTransform=function(e,t,n){return n=void 0===n||n,t=t||{},function(r,i){var o;if(n)for(o in t)i[o]=t[o];else i=t;return{tagName:e,attribs:i}}}},{htmlparser2:422,"regexp-quote":385,xtend:450}],388:[function(e,t,n){t.exports={elementNames:{altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",fedropshadow:"feDropShadow",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient",textpath:"textPath"},attributeNames:{definitionurl:"definitionURL",attributename:"attributeName",attributetype:"attributeType",basefrequency:"baseFrequency",baseprofile:"baseProfile",calcmode:"calcMode",clippathunits:"clipPathUnits",diffuseconstant:"diffuseConstant",edgemode:"edgeMode",filterunits:"filterUnits",glyphref:"glyphRef",gradienttransform:"gradientTransform",gradientunits:"gradientUnits",kernelmatrix:"kernelMatrix",kernelunitlength:"kernelUnitLength",keypoints:"keyPoints",keysplines:"keySplines",keytimes:"keyTimes",lengthadjust:"lengthAdjust",limitingconeangle:"limitingConeAngle",markerheight:"markerHeight",markerunits:"markerUnits",markerwidth:"markerWidth",maskcontentunits:"maskContentUnits",maskunits:"maskUnits",numoctaves:"numOctaves",pathlength:"pathLength",patterncontentunits:"patternContentUnits",patterntransform:"patternTransform",patternunits:"patternUnits",pointsatx:"pointsAtX",pointsaty:"pointsAtY",pointsatz:"pointsAtZ",preservealpha:"preserveAlpha",preserveaspectratio:"preserveAspectRatio",primitiveunits:"primitiveUnits",refx:"refX",refy:"refY",repeatcount:"repeatCount",repeatdur:"repeatDur",requiredextensions:"requiredExtensions",requiredfeatures:"requiredFeatures",specularconstant:"specularConstant",specularexponent:"specularExponent",spreadmethod:"spreadMethod",startoffset:"startOffset",stddeviation:"stdDeviation",stitchtiles:"stitchTiles",surfacescale:"surfaceScale",systemlanguage:"systemLanguage",tablevalues:"tableValues",targetx:"targetX",targety:"targetY",textlength:"textLength",viewbox:"viewBox",viewtarget:"viewTarget",xchannelselector:"xChannelSelector",ychannelselector:"yChannelSelector",zoomandpan:"zoomAndPan"}}},{}],389:[function(e,t,n){var r=e("domelementtype"),i=e("entities"),o=e("./foreignNames.json");o.elementNames.__proto__=null,o.attributeNames.__proto__=null;var s={__proto__:null,style:!0,script:!0,xmp:!0,iframe:!0,noembed:!0,noframes:!0,plaintext:!0,noscript:!0};var a={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},l=t.exports=function(e,t){Array.isArray(e)||e.cheerio||(e=[e]),t=t||{};for(var n="",i=0;i<e.length;i++){var o=e[i];"root"===o.type?n+=l(o.children,t):r.isTag(o)?n+=u(o,t):o.type===r.Directive?n+=d(o):o.type===r.Comment?n+=f(o):o.type===r.CDATA?n+=h(o):n+=p(o,t)}return n},c=["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"];function u(e,t){"foreign"===t.xmlMode&&(e.name=o.elementNames[e.name]||e.name,e.parent&&c.indexOf(e.parent.name)>=0&&(t=Object.assign({},t,{xmlMode:!1}))),!t.xmlMode&&["svg","math"].indexOf(e.name)>=0&&(t=Object.assign({},t,{xmlMode:"foreign"}));var n="<"+e.name,r=function(e,t){if(e){var n,r="";for(var s in e)n=e[s],r&&(r+=" "),"foreign"===t.xmlMode&&(s=o.attributeNames[s]||s),r+=s,(null!==n&&""!==n||t.xmlMode)&&(r+='="'+(t.decodeEntities?i.encodeXML(n):n.replace(/\"/g,"&quot;"))+'"');return r}}(e.attribs,t);return r&&(n+=" "+r),!t.xmlMode||e.children&&0!==e.children.length?(n+=">",e.children&&(n+=l(e.children,t)),a[e.name]&&!t.xmlMode||(n+="</"+e.name+">")):n+="/>",n}function d(e){return"<"+e.data+">"}function p(e,t){var n=e.data||"";return!t.decodeEntities||e.parent&&e.parent.name in s||(n=i.encodeXML(n)),n}function h(e){return"<![CDATA["+e.children[0].data+"]]>"}function f(e){return"\x3c!--"+e.data+"--\x3e"}},{"./foreignNames.json":388,domelementtype:390,entities:394}],390:[function(e,t,n){"use strict";var r,i;Object.defineProperty(n,"__esModule",{value:!0}),n.Doctype=n.CDATA=n.Tag=n.Style=n.Script=n.Comment=n.Directive=n.Text=n.Root=n.isTag=n.ElementType=void 0,(i=r=n.ElementType||(n.ElementType={})).Root="root",i.Text="text",i.Directive="directive",i.Comment="comment",i.Script="script",i.Style="style",i.Tag="tag",i.CDATA="cdata",i.Doctype="doctype",n.isTag=function(e){return e.type===r.Tag||e.type===r.Script||e.type===r.Style},n.Root=r.Root,n.Text=r.Text,n.Directive=r.Directive,n.Comment=r.Comment,n.Script=r.Script,n.Style=r.Style,n.Tag=r.Tag,n.CDATA=r.CDATA,n.Doctype=r.Doctype},{}],391:[function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.decodeHTML=n.decodeHTMLStrict=n.decodeXML=void 0;var i=r(e("./maps/entities.json")),o=r(e("./maps/legacy.json")),s=r(e("./maps/xml.json")),a=r(e("./decode_codepoint")),l=/&(?:[a-zA-Z0-9]+|#[xX][\da-fA-F]+|#\d+);/g;function c(e){var t=d(e);return function(e){return String(e).replace(l,t)}}n.decodeXML=c(s.default),n.decodeHTMLStrict=c(i.default);var u=function(e,t){return e<t?1:-1};function d(e){return function(t){if("#"===t.charAt(1)){var n=t.charAt(2);return"X"===n||"x"===n?a.default(parseInt(t.substr(3),16)):a.default(parseInt(t.substr(2),10))}return e[t.slice(1,-1)]||t}}n.decodeHTML=function(){for(var e=Object.keys(o.default).sort(u),t=Object.keys(i.default).sort(u),n=0,r=0;n<t.length;n++)e[r]===t[n]?(t[n]+=";?",r++):t[n]+=";";var s=new RegExp("&(?:"+t.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),a=d(i.default);function l(e){return";"!==e.substr(-1)&&(e+=";"),a(e)}return function(e){return String(e).replace(s,l)}}()},{"./decode_codepoint":392,"./maps/entities.json":396,"./maps/legacy.json":397,"./maps/xml.json":398}],392:[function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("./maps/decode.json")),o=String.fromCodePoint||function(e){var t="";return e>65535&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e),t+String.fromCharCode(e)};n.default=function(e){return e>=55296&&e<=57343||e>1114111?"":(e in i.default&&(e=i.default[e]),o(e))}},{"./maps/decode.json":395}],393:[function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.escapeUTF8=n.escape=n.encodeNonAsciiHTML=n.encodeHTML=n.encodeXML=void 0;var i=u(r(e("./maps/xml.json")).default),o=d(i);n.encodeXML=m(i);var s,a,l=u(r(e("./maps/entities.json")).default),c=d(l);function u(e){return Object.keys(e).sort().reduce((function(t,n){return t[e[n]]="&"+n+";",t}),{})}function d(e){for(var t=[],n=[],r=0,i=Object.keys(e);r<i.length;r++){var o=i[r];1===o.length?t.push("\\"+o):n.push(o)}t.sort();for(var s=0;s<t.length-1;s++){for(var a=s;a<t.length-1&&t[a].charCodeAt(1)+1===t[a+1].charCodeAt(1);)a+=1;var l=1+a-s;l<3||t.splice(s,l,t[s]+"-"+t[a])}return n.unshift("["+t.join("")+"]"),new RegExp(n.join("|"),"g")}n.encodeHTML=(s=l,a=c,function(e){return e.replace(a,(function(e){return s[e]})).replace(p,f)}),n.encodeNonAsciiHTML=m(l);var p=/(?:[\x80-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g,h=null!=String.prototype.codePointAt?function(e){return e.codePointAt(0)}:function(e){return 1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)-56320+65536};function f(e){return"&#x"+(e.length>1?h(e):e.charCodeAt(0)).toString(16).toUpperCase()+";"}var g=new RegExp(o.source+"|"+p.source,"g");function m(e){return function(t){return t.replace(g,(function(t){return e[t]||f(t)}))}}n.escape=function(e){return e.replace(g,f)},n.escapeUTF8=function(e){return e.replace(o,f)}},{"./maps/entities.json":396,"./maps/xml.json":398}],394:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.decodeXMLStrict=n.decodeHTML5Strict=n.decodeHTML4Strict=n.decodeHTML5=n.decodeHTML4=n.decodeHTMLStrict=n.decodeHTML=n.decodeXML=n.encodeHTML5=n.encodeHTML4=n.escapeUTF8=n.escape=n.encodeNonAsciiHTML=n.encodeHTML=n.encodeXML=n.encode=n.decodeStrict=n.decode=void 0;var r=e("./decode"),i=e("./encode");n.decode=function(e,t){return(!t||t<=0?r.decodeXML:r.decodeHTML)(e)},n.decodeStrict=function(e,t){return(!t||t<=0?r.decodeXML:r.decodeHTMLStrict)(e)},n.encode=function(e,t){return(!t||t<=0?i.encodeXML:i.encodeHTML)(e)};var o=e("./encode");Object.defineProperty(n,"encodeXML",{enumerable:!0,get:function(){return o.encodeXML}}),Object.defineProperty(n,"encodeHTML",{enumerable:!0,get:function(){return o.encodeHTML}}),Object.defineProperty(n,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return o.encodeNonAsciiHTML}}),Object.defineProperty(n,"escape",{enumerable:!0,get:function(){return o.escape}}),Object.defineProperty(n,"escapeUTF8",{enumerable:!0,get:function(){return o.escapeUTF8}}),Object.defineProperty(n,"encodeHTML4",{enumerable:!0,get:function(){return o.encodeHTML}}),Object.defineProperty(n,"encodeHTML5",{enumerable:!0,get:function(){return o.encodeHTML}});var s=e("./decode");Object.defineProperty(n,"decodeXML",{enumerable:!0,get:function(){return s.decodeXML}}),Object.defineProperty(n,"decodeHTML",{enumerable:!0,get:function(){return s.decodeHTML}}),Object.defineProperty(n,"decodeHTMLStrict",{enumerable:!0,get:function(){return s.decodeHTMLStrict}}),Object.defineProperty(n,"decodeHTML4",{enumerable:!0,get:function(){return s.decodeHTML}}),Object.defineProperty(n,"decodeHTML5",{enumerable:!0,get:function(){return s.decodeHTML}}),Object.defineProperty(n,"decodeHTML4Strict",{enumerable:!0,get:function(){return s.decodeHTMLStrict}}),Object.defineProperty(n,"decodeHTML5Strict",{enumerable:!0,get:function(){return s.decodeHTMLStrict}}),Object.defineProperty(n,"decodeXMLStrict",{enumerable:!0,get:function(){return s.decodeXML}})},{"./decode":391,"./encode":393}],395:[function(e,t,n){t.exports={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376}},{}],396:[function(e,t,n){t.exports={Aacute:"",aacute:"",Abreve:"",abreve:"",ac:"",acd:"",acE:"",Acirc:"",acirc:"",acute:"",Acy:"",acy:"",AElig:"",aelig:"",af:"",Afr:"",afr:"",Agrave:"",agrave:"",alefsym:"",aleph:"",Alpha:"",alpha:"",Amacr:"",amacr:"",amalg:"",amp:"&",AMP:"&",andand:"",And:"",and:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angmsd:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"",angzarr:"",Aogon:"",aogon:"",Aopf:"",aopf:"",apacir:"",ap:"",apE:"",ape:"",apid:"",apos:"'",ApplyFunction:"",approx:"",approxeq:"",Aring:"",aring:"",Ascr:"",ascr:"",Assign:"",ast:"*",asymp:"",asympeq:"",Atilde:"",atilde:"",Auml:"",auml:"",awconint:"",awint:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",Backslash:"",Barv:"",barvee:"",barwed:"",Barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",Bcy:"",bcy:"",bdquo:"",becaus:"",because:"",Because:"",bemptyv:"",bepsi:"",bernou:"",Bernoullis:"",Beta:"",beta:"",beth:"",between:"",Bfr:"",bfr:"",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bNot:"",bnot:"",Bopf:"",bopf:"",bot:"",bottom:"",bowtie:"",boxbox:"",boxdl:"",boxdL:"",boxDl:"",boxDL:"",boxdr:"",boxdR:"",boxDr:"",boxDR:"",boxh:"",boxH:"",boxhd:"",boxHd:"",boxhD:"",boxHD:"",boxhu:"",boxHu:"",boxhU:"",boxHU:"",boxminus:"",boxplus:"",boxtimes:"",boxul:"",boxuL:"",boxUl:"",boxUL:"",boxur:"",boxuR:"",boxUr:"",boxUR:"",boxv:"",boxV:"",boxvh:"",boxvH:"",boxVh:"",boxVH:"",boxvl:"",boxvL:"",boxVl:"",boxVL:"",boxvr:"",boxvR:"",boxVr:"",boxVR:"",bprime:"",breve:"",Breve:"",brvbar:"",bscr:"",Bscr:"",bsemi:"",bsim:"",bsime:"",bsolb:"",bsol:"\\",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",Bumpeq:"",bumpeq:"",Cacute:"",cacute:"",capand:"",capbrcup:"",capcap:"",cap:"",Cap:"",capcup:"",capdot:"",CapitalDifferentialD:"",caps:"",caret:"",caron:"",Cayleys:"",ccaps:"",Ccaron:"",ccaron:"",Ccedil:"",ccedil:"",Ccirc:"",ccirc:"",Cconint:"",ccups:"",ccupssm:"",Cdot:"",cdot:"",cedil:"",Cedilla:"",cemptyv:"",cent:"",centerdot:"",CenterDot:"",cfr:"",Cfr:"",CHcy:"",chcy:"",check:"",checkmark:"",Chi:"",chi:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledast:"",circledcirc:"",circleddash:"",CircleDot:"",circledR:"",circledS:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",cir:"",cirE:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",clubs:"",clubsuit:"",colon:":",Colon:"",Colone:"",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",Congruent:"",conint:"",Conint:"",ContourIntegral:"",copf:"",Copf:"",coprod:"",Coproduct:"",copy:"",COPY:"",copysr:"",CounterClockwiseContourIntegral:"",crarr:"",cross:"",Cross:"",Cscr:"",cscr:"",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",cupbrcap:"",cupcap:"",CupCap:"",cup:"",Cup:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",dagger:"",Dagger:"",daleth:"",darr:"",Darr:"",dArr:"",dash:"",Dashv:"",dashv:"",dbkarow:"",dblac:"",Dcaron:"",dcaron:"",Dcy:"",dcy:"",ddagger:"",ddarr:"",DD:"",dd:"",DDotrahd:"",ddotseq:"",deg:"",Del:"",Delta:"",delta:"",demptyv:"",dfisht:"",Dfr:"",dfr:"",dHar:"",dharl:"",dharr:"",DiacriticalAcute:"",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",diam:"",diamond:"",Diamond:"",diamondsuit:"",diams:"",die:"",DifferentialD:"",digamma:"",disin:"",div:"",divide:"",divideontimes:"",divonx:"",DJcy:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",Dopf:"",dopf:"",Dot:"",dot:"",DotDot:"",doteq:"",doteqdot:"",DotEqual:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",DoubleContourIntegral:"",DoubleDot:"",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrowBar:"",downarrow:"",DownArrow:"",Downarrow:"",DownArrowUpArrow:"",DownBreve:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVectorBar:"",DownLeftVector:"",DownRightTeeVector:"",DownRightVectorBar:"",DownRightVector:"",DownTeeArrow:"",DownTee:"",drbkarow:"",drcorn:"",drcrop:"",Dscr:"",dscr:"",DScy:"",dscy:"",dsol:"",Dstrok:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",DZcy:"",dzcy:"",dzigrarr:"",Eacute:"",eacute:"",easter:"",Ecaron:"",ecaron:"",Ecirc:"",ecirc:"",ecir:"",ecolon:"",Ecy:"",ecy:"",eDDot:"",Edot:"",edot:"",eDot:"",ee:"",efDot:"",Efr:"",efr:"",eg:"",Egrave:"",egrave:"",egs:"",egsdot:"",el:"",Element:"",elinters:"",ell:"",els:"",elsdot:"",Emacr:"",emacr:"",empty:"",emptyset:"",EmptySmallSquare:"",emptyv:"",EmptyVerySmallSquare:"",emsp13:"",emsp14:"",emsp:"",ENG:"",eng:"",ensp:"",Eogon:"",eogon:"",Eopf:"",eopf:"",epar:"",eparsl:"",eplus:"",epsi:"",Epsilon:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",Equal:"",equals:"=",EqualTilde:"",equest:"",Equilibrium:"",equiv:"",equivDD:"",eqvparsl:"",erarr:"",erDot:"",escr:"",Escr:"",esdot:"",Esim:"",esim:"",Eta:"",eta:"",ETH:"",eth:"",Euml:"",euml:"",euro:"",excl:"!",exist:"",Exists:"",expectation:"",exponentiale:"",ExponentialE:"",fallingdotseq:"",Fcy:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",Ffr:"",ffr:"",filig:"",FilledSmallSquare:"",FilledVerySmallSquare:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",Fopf:"",fopf:"",forall:"",ForAll:"",fork:"",forkv:"",Fouriertrf:"",fpartint:"",frac12:"",frac13:"",frac14:"",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",fscr:"",Fscr:"",gacute:"",Gamma:"",gamma:"",Gammad:"",gammad:"",gap:"",Gbreve:"",gbreve:"",Gcedil:"",Gcirc:"",gcirc:"",Gcy:"",gcy:"",Gdot:"",gdot:"",ge:"",gE:"",gEl:"",gel:"",geq:"",geqq:"",geqslant:"",gescc:"",ges:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",Gfr:"",gfr:"",gg:"",Gg:"",ggg:"",gimel:"",GJcy:"",gjcy:"",gla:"",gl:"",glE:"",glj:"",gnap:"",gnapprox:"",gne:"",gnE:"",gneq:"",gneqq:"",gnsim:"",Gopf:"",gopf:"",grave:"`",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"",gscr:"",gsim:"",gsime:"",gsiml:"",gtcc:"",gtcir:"",gt:">",GT:">",Gt:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",Hacek:"",hairsp:"",half:"",hamilt:"",HARDcy:"",hardcy:"",harrcir:"",harr:"",hArr:"",harrw:"",Hat:"^",hbar:"",Hcirc:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",hfr:"",Hfr:"",HilbertSpace:"",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",hopf:"",Hopf:"",horbar:"",HorizontalLine:"",hscr:"",Hscr:"",hslash:"",Hstrok:"",hstrok:"",HumpDownHump:"",HumpEqual:"",hybull:"",hyphen:"",Iacute:"",iacute:"",ic:"",Icirc:"",icirc:"",Icy:"",icy:"",Idot:"",IEcy:"",iecy:"",iexcl:"",iff:"",ifr:"",Ifr:"",Igrave:"",igrave:"",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",IJlig:"",ijlig:"",Imacr:"",imacr:"",image:"",ImaginaryI:"",imagline:"",imagpart:"",imath:"",Im:"",imof:"",imped:"",Implies:"",incare:"",in:"",infin:"",infintie:"",inodot:"",intcal:"",int:"",Int:"",integers:"",Integral:"",intercal:"",Intersection:"",intlarhk:"",intprod:"",InvisibleComma:"",InvisibleTimes:"",IOcy:"",iocy:"",Iogon:"",iogon:"",Iopf:"",iopf:"",Iota:"",iota:"",iprod:"",iquest:"",iscr:"",Iscr:"",isin:"",isindot:"",isinE:"",isins:"",isinsv:"",isinv:"",it:"",Itilde:"",itilde:"",Iukcy:"",iukcy:"",Iuml:"",iuml:"",Jcirc:"",jcirc:"",Jcy:"",jcy:"",Jfr:"",jfr:"",jmath:"",Jopf:"",jopf:"",Jscr:"",jscr:"",Jsercy:"",jsercy:"",Jukcy:"",jukcy:"",Kappa:"",kappa:"",kappav:"",Kcedil:"",kcedil:"",Kcy:"",kcy:"",Kfr:"",kfr:"",kgreen:"",KHcy:"",khcy:"",KJcy:"",kjcy:"",Kopf:"",kopf:"",Kscr:"",kscr:"",lAarr:"",Lacute:"",lacute:"",laemptyv:"",lagran:"",Lambda:"",lambda:"",lang:"",Lang:"",langd:"",langle:"",lap:"",Laplacetrf:"",laquo:"",larrb:"",larrbfs:"",larr:"",Larr:"",lArr:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",latail:"",lAtail:"",lat:"",late:"",lates:"",lbarr:"",lBarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",Lcaron:"",lcaron:"",Lcedil:"",lcedil:"",lceil:"",lcub:"{",Lcy:"",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",le:"",lE:"",LeftAngleBracket:"",LeftArrowBar:"",leftarrow:"",LeftArrow:"",Leftarrow:"",LeftArrowRightArrow:"",leftarrowtail:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVectorBar:"",LeftDownVector:"",LeftFloor:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",leftrightarrow:"",LeftRightArrow:"",Leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",LeftRightVector:"",LeftTeeArrow:"",LeftTee:"",LeftTeeVector:"",leftthreetimes:"",LeftTriangleBar:"",LeftTriangle:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVectorBar:"",LeftUpVector:"",LeftVectorBar:"",LeftVector:"",lEg:"",leg:"",leq:"",leqq:"",leqslant:"",lescc:"",les:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",lessgtr:"",LessLess:"",lesssim:"",LessSlantEqual:"",LessTilde:"",lfisht:"",lfloor:"",Lfr:"",lfr:"",lg:"",lgE:"",lHar:"",lhard:"",lharu:"",lharul:"",lhblk:"",LJcy:"",ljcy:"",llarr:"",ll:"",Ll:"",llcorner:"",Lleftarrow:"",llhard:"",lltri:"",Lmidot:"",lmidot:"",lmoustache:"",lmoust:"",lnap:"",lnapprox:"",lne:"",lnE:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",longleftarrow:"",LongLeftArrow:"",Longleftarrow:"",longleftrightarrow:"",LongLeftRightArrow:"",Longleftrightarrow:"",longmapsto:"",longrightarrow:"",LongRightArrow:"",Longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",Lopf:"",lopf:"",loplus:"",lotimes:"",lowast:"",lowbar:"_",LowerLeftArrow:"",LowerRightArrow:"",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",lscr:"",Lscr:"",lsh:"",Lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",Lstrok:"",lstrok:"",ltcc:"",ltcir:"",lt:"<",LT:"<",Lt:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltri:"",ltrie:"",ltrif:"",ltrPar:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",macr:"",male:"",malt:"",maltese:"",Map:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",Mcy:"",mcy:"",mdash:"",mDDot:"",measuredangle:"",MediumSpace:"",Mellintrf:"",Mfr:"",mfr:"",mho:"",micro:"",midast:"*",midcir:"",mid:"",middot:"",minusb:"",minus:"",minusd:"",minusdu:"",MinusPlus:"",mlcp:"",mldr:"",mnplus:"",models:"",Mopf:"",mopf:"",mp:"",mscr:"",Mscr:"",mstpos:"",Mu:"",mu:"",multimap:"",mumap:"",nabla:"",Nacute:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natural:"",naturals:"",natur:"",nbsp:"",nbump:"",nbumpe:"",ncap:"",Ncaron:"",ncaron:"",Ncedil:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",Ncy:"",ncy:"",ndash:"",nearhk:"",nearr:"",neArr:"",nearrow:"",ne:"",nedot:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",nequiv:"",nesear:"",nesim:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:"\n",nexist:"",nexists:"",Nfr:"",nfr:"",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",nGg:"",ngsim:"",nGt:"",ngt:"",ngtr:"",nGtv:"",nharr:"",nhArr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",NJcy:"",njcy:"",nlarr:"",nlArr:"",nldr:"",nlE:"",nle:"",nleftarrow:"",nLeftarrow:"",nleftrightarrow:"",nLeftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nLl:"",nlsim:"",nLt:"",nlt:"",nltri:"",nltrie:"",nLtv:"",nmid:"",NoBreak:"",NonBreakingSpace:"",nopf:"",Nopf:"",Not:"",not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",notin:"",notindot:"",notinE:"",notinva:"",notinvb:"",notinvc:"",NotLeftTriangleBar:"",NotLeftTriangle:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",notni:"",notniva:"",notnivb:"",notnivc:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangleBar:"",NotRightTriangle:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",nparallel:"",npar:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",nprec:"",npreceq:"",npre:"",nrarrc:"",nrarr:"",nrArr:"",nrarrw:"",nrightarrow:"",nRightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",Nscr:"",nscr:"",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",Ntilde:"",ntilde:"",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",Nu:"",nu:"",num:"#",numero:"",numsp:"",nvap:"",nvdash:"",nvDash:"",nVdash:"",nVDash:"",nvge:"",nvgt:">",nvHarr:"",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwarhk:"",nwarr:"",nwArr:"",nwarrow:"",nwnear:"",Oacute:"",oacute:"",oast:"",Ocirc:"",ocirc:"",ocir:"",Ocy:"",ocy:"",odash:"",Odblac:"",odblac:"",odiv:"",odot:"",odsold:"",OElig:"",oelig:"",ofcir:"",Ofr:"",ofr:"",ogon:"",Ograve:"",ograve:"",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",Omacr:"",omacr:"",Omega:"",omega:"",Omicron:"",omicron:"",omid:"",ominus:"",Oopf:"",oopf:"",opar:"",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",operp:"",oplus:"",orarr:"",Or:"",or:"",ord:"",order:"",orderof:"",ordf:"",ordm:"",origof:"",oror:"",orslope:"",orv:"",oS:"",Oscr:"",oscr:"",Oslash:"",oslash:"",osol:"",Otilde:"",otilde:"",otimesas:"",Otimes:"",otimes:"",Ouml:"",ouml:"",ovbar:"",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",para:"",parallel:"",par:"",parsim:"",parsl:"",part:"",PartialD:"",Pcy:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",Pfr:"",pfr:"",Phi:"",phi:"",phiv:"",phmmat:"",phone:"",Pi:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plusacir:"",plusb:"",pluscir:"",plus:"+",plusdo:"",plusdu:"",pluse:"",PlusMinus:"",plusmn:"",plussim:"",plustwo:"",pm:"",Poincareplane:"",pointint:"",popf:"",Popf:"",pound:"",prap:"",Pr:"",pr:"",prcue:"",precapprox:"",prec:"",preccurlyeq:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",pre:"",prE:"",precsim:"",prime:"",Prime:"",primes:"",prnap:"",prnE:"",prnsim:"",prod:"",Product:"",profalar:"",profline:"",profsurf:"",prop:"",Proportional:"",Proportion:"",propto:"",prsim:"",prurel:"",Pscr:"",pscr:"",Psi:"",psi:"",puncsp:"",Qfr:"",qfr:"",qint:"",qopf:"",Qopf:"",qprime:"",Qscr:"",qscr:"",quaternions:"",quatint:"",quest:"?",questeq:"",quot:'"',QUOT:'"',rAarr:"",race:"",Racute:"",racute:"",radic:"",raemptyv:"",rang:"",Rang:"",rangd:"",range:"",rangle:"",raquo:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarr:"",Rarr:"",rArr:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",Rarrtl:"",rarrtl:"",rarrw:"",ratail:"",rAtail:"",ratio:"",rationals:"",rbarr:"",rBarr:"",RBarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",Rcaron:"",rcaron:"",Rcedil:"",rcedil:"",rceil:"",rcub:"}",Rcy:"",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",real:"",realine:"",realpart:"",reals:"",Re:"",rect:"",reg:"",REG:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",rfisht:"",rfloor:"",rfr:"",Rfr:"",rHar:"",rhard:"",rharu:"",rharul:"",Rho:"",rho:"",rhov:"",RightAngleBracket:"",RightArrowBar:"",rightarrow:"",RightArrow:"",Rightarrow:"",RightArrowLeftArrow:"",rightarrowtail:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVectorBar:"",RightDownVector:"",RightFloor:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",RightTeeArrow:"",RightTee:"",RightTeeVector:"",rightthreetimes:"",RightTriangleBar:"",RightTriangle:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVectorBar:"",RightUpVector:"",RightVectorBar:"",RightVector:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoustache:"",rmoust:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",ropf:"",Ropf:"",roplus:"",rotimes:"",RoundImplies:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",Rrightarrow:"",rsaquo:"",rscr:"",Rscr:"",rsh:"",Rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",RuleDelayed:"",ruluhar:"",rx:"",Sacute:"",sacute:"",sbquo:"",scap:"",Scaron:"",scaron:"",Sc:"",sc:"",sccue:"",sce:"",scE:"",Scedil:"",scedil:"",Scirc:"",scirc:"",scnap:"",scnE:"",scnsim:"",scpolint:"",scsim:"",Scy:"",scy:"",sdotb:"",sdot:"",sdote:"",searhk:"",searr:"",seArr:"",searrow:"",sect:"",semi:";",seswar:"",setminus:"",setmn:"",sext:"",Sfr:"",sfr:"",sfrown:"",sharp:"",SHCHcy:"",shchcy:"",SHcy:"",shcy:"",ShortDownArrow:"",ShortLeftArrow:"",shortmid:"",shortparallel:"",ShortRightArrow:"",ShortUpArrow:"",shy:"",Sigma:"",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",SmallCircle:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",SOFTcy:"",softcy:"",solbar:"",solb:"",sol:"/",Sopf:"",sopf:"",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",Sqrt:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",square:"",Square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",squarf:"",squ:"",squf:"",srarr:"",Sscr:"",sscr:"",ssetmn:"",ssmile:"",sstarf:"",Star:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"",sub:"",Sub:"",subdot:"",subE:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",subset:"",Subset:"",subseteq:"",subseteqq:"",SubsetEqual:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succapprox:"",succ:"",succcurlyeq:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",SuchThat:"",sum:"",Sum:"",sung:"",sup1:"",sup2:"",sup3:"",sup:"",Sup:"",supdot:"",supdsub:"",supE:"",supe:"",supedot:"",Superset:"",SupersetEqual:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",supset:"",Supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swarhk:"",swarr:"",swArr:"",swarrow:"",swnwar:"",szlig:"",Tab:"\t",target:"",Tau:"",tau:"",tbrk:"",Tcaron:"",tcaron:"",Tcedil:"",tcedil:"",Tcy:"",tcy:"",tdot:"",telrec:"",Tfr:"",tfr:"",there4:"",therefore:"",Therefore:"",Theta:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",ThickSpace:"",ThinSpace:"",thinsp:"",thkap:"",thksim:"",THORN:"",thorn:"",tilde:"",Tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",timesbar:"",timesb:"",times:"",timesd:"",tint:"",toea:"",topbot:"",topcir:"",top:"",Topf:"",topf:"",topfork:"",tosa:"",tprime:"",trade:"",TRADE:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",TripleDot:"",triplus:"",trisb:"",tritime:"",trpezium:"",Tscr:"",tscr:"",TScy:"",tscy:"",TSHcy:"",tshcy:"",Tstrok:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",Uacute:"",uacute:"",uarr:"",Uarr:"",uArr:"",Uarrocir:"",Ubrcy:"",ubrcy:"",Ubreve:"",ubreve:"",Ucirc:"",ucirc:"",Ucy:"",ucy:"",udarr:"",Udblac:"",udblac:"",udhar:"",ufisht:"",Ufr:"",ufr:"",Ugrave:"",ugrave:"",uHar:"",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",Umacr:"",umacr:"",uml:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",uogon:"",Uopf:"",uopf:"",UpArrowBar:"",uparrow:"",UpArrow:"",Uparrow:"",UpArrowDownArrow:"",updownarrow:"",UpDownArrow:"",Updownarrow:"",UpEquilibrium:"",upharpoonleft:"",upharpoonright:"",uplus:"",UpperLeftArrow:"",UpperRightArrow:"",upsi:"",Upsi:"",upsih:"",Upsilon:"",upsilon:"",UpTeeArrow:"",UpTee:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",Uring:"",uring:"",urtri:"",Uscr:"",uscr:"",utdot:"",Utilde:"",utilde:"",utri:"",utrif:"",uuarr:"",Uuml:"",uuml:"",uwangle:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",varr:"",vArr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",vBar:"",Vbar:"",vBarv:"",Vcy:"",vcy:"",vdash:"",vDash:"",Vdash:"",VDash:"",Vdashl:"",veebar:"",vee:"",Vee:"",veeeq:"",vellip:"",verbar:"|",Verbar:"",vert:"|",Vert:"",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"",vfr:"",vltri:"",vnsub:"",vnsup:"",Vopf:"",vopf:"",vprop:"",vrtri:"",Vscr:"",vscr:"",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",Vvdash:"",vzigzag:"",Wcirc:"",wcirc:"",wedbar:"",wedge:"",Wedge:"",wedgeq:"",weierp:"",Wfr:"",wfr:"",Wopf:"",wopf:"",wp:"",wr:"",wreath:"",Wscr:"",wscr:"",xcap:"",xcirc:"",xcup:"",xdtri:"",Xfr:"",xfr:"",xharr:"",xhArr:"",Xi:"",xi:"",xlarr:"",xlArr:"",xmap:"",xnis:"",xodot:"",Xopf:"",xopf:"",xoplus:"",xotime:"",xrarr:"",xrArr:"",Xscr:"",xscr:"",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",Yacute:"",yacute:"",YAcy:"",yacy:"",Ycirc:"",ycirc:"",Ycy:"",ycy:"",yen:"",Yfr:"",yfr:"",YIcy:"",yicy:"",Yopf:"",yopf:"",Yscr:"",yscr:"",YUcy:"",yucy:"",yuml:"",Yuml:"",Zacute:"",zacute:"",Zcaron:"",zcaron:"",Zcy:"",zcy:"",Zdot:"",zdot:"",zeetrf:"",ZeroWidthSpace:"",Zeta:"",zeta:"",zfr:"",Zfr:"",ZHcy:"",zhcy:"",zigrarr:"",zopf:"",Zopf:"",Zscr:"",zscr:"",zwj:"",zwnj:""}},{}],397:[function(e,t,n){t.exports={Aacute:"",aacute:"",Acirc:"",acirc:"",acute:"",AElig:"",aelig:"",Agrave:"",agrave:"",amp:"&",AMP:"&",Aring:"",aring:"",Atilde:"",atilde:"",Auml:"",auml:"",brvbar:"",Ccedil:"",ccedil:"",cedil:"",cent:"",copy:"",COPY:"",curren:"",deg:"",divide:"",Eacute:"",eacute:"",Ecirc:"",ecirc:"",Egrave:"",egrave:"",ETH:"",eth:"",Euml:"",euml:"",frac12:"",frac14:"",frac34:"",gt:">",GT:">",Iacute:"",iacute:"",Icirc:"",icirc:"",iexcl:"",Igrave:"",igrave:"",iquest:"",Iuml:"",iuml:"",laquo:"",lt:"<",LT:"<",macr:"",micro:"",middot:"",nbsp:"",not:"",Ntilde:"",ntilde:"",Oacute:"",oacute:"",Ocirc:"",ocirc:"",Ograve:"",ograve:"",ordf:"",ordm:"",Oslash:"",oslash:"",Otilde:"",otilde:"",Ouml:"",ouml:"",para:"",plusmn:"",pound:"",quot:'"',QUOT:'"',raquo:"",reg:"",REG:"",sect:"",shy:"",sup1:"",sup2:"",sup3:"",szlig:"",THORN:"",thorn:"",times:"",Uacute:"",uacute:"",Ucirc:"",ucirc:"",Ugrave:"",ugrave:"",uml:"",Uuml:"",uuml:"",Yacute:"",yacute:"",yen:"",yuml:""}},{}],398:[function(e,t,n){t.exports={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}},{}],399:[function(e,t,n){t.exports={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag",CDATA:"cdata",Doctype:"doctype",isTag:function(e){return"tag"===e.type||"script"===e.type||"style"===e.type}}},{}],400:[function(e,t,n){var r=e("domelementtype"),i=/\s+/g,o=e("./lib/node"),s=e("./lib/element");function a(e,t,n){"object"==typeof e?(n=t,t=e,e=null):"function"==typeof t&&(n=t,t=l),this._callback=e,this._options=t||l,this._elementCB=n,this.dom=[],this._done=!1,this._tagStack=[],this._parser=this._parser||null}var l={normalizeWhitespace:!1,withStartIndices:!1,withEndIndices:!1};a.prototype.onparserinit=function(e){this._parser=e},a.prototype.onreset=function(){a.call(this,this._callback,this._options,this._elementCB)},a.prototype.onend=function(){this._done||(this._done=!0,this._parser=null,this._handleCallback(null))},a.prototype._handleCallback=a.prototype.onerror=function(e){if("function"==typeof this._callback)this._callback(e,this.dom);else if(e)throw e},a.prototype.onclosetag=function(){var e=this._tagStack.pop();this._options.withEndIndices&&e&&(e.endIndex=this._parser.endIndex),this._elementCB&&this._elementCB(e)},a.prototype._createDomElement=function(e){if(!this._options.withDomLvl1)return e;var t;for(var n in t="tag"===e.type?Object.create(s):Object.create(o),e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},a.prototype._addDomElement=function(e){var t=this._tagStack[this._tagStack.length-1],n=t?t.children:this.dom,r=n[n.length-1];e.next=null,this._options.withStartIndices&&(e.startIndex=this._parser.startIndex),this._options.withEndIndices&&(e.endIndex=this._parser.endIndex),r?(e.prev=r,r.next=e):e.prev=null,n.push(e),e.parent=t||null},a.prototype.onopentag=function(e,t){var n={type:"script"===e?r.Script:"style"===e?r.Style:r.Tag,name:e,attribs:t,children:[]},i=this._createDomElement(n);this._addDomElement(i),this._tagStack.push(i)},a.prototype.ontext=function(e){var t,n=this._options.normalizeWhitespace||this._options.ignoreWhitespace;if(!this._tagStack.length&&this.dom.length&&(t=this.dom[this.dom.length-1]).type===r.Text)n?t.data=(t.data+e).replace(i," "):t.data+=e;else if(this._tagStack.length&&(t=this._tagStack[this._tagStack.length-1])&&(t=t.children[t.children.length-1])&&t.type===r.Text)n?t.data=(t.data+e).replace(i," "):t.data+=e;else{n&&(e=e.replace(i," "));var o=this._createDomElement({data:e,type:r.Text});this._addDomElement(o)}},a.prototype.oncomment=function(e){var t=this._tagStack[this._tagStack.length-1];if(t&&t.type===r.Comment)t.data+=e;else{var n={data:e,type:r.Comment},i=this._createDomElement(n);this._addDomElement(i),this._tagStack.push(i)}},a.prototype.oncdatastart=function(){var e={children:[{data:"",type:r.Text}],type:r.CDATA},t=this._createDomElement(e);this._addDomElement(t),this._tagStack.push(t)},a.prototype.oncommentend=a.prototype.oncdataend=function(){this._tagStack.pop()},a.prototype.onprocessinginstruction=function(e,t){var n=this._createDomElement({name:e,data:t,type:r.Directive});this._addDomElement(n)},t.exports=a},{"./lib/element":401,"./lib/node":402,domelementtype:399}],401:[function(e,t,n){var r=e("./node"),i=t.exports=Object.create(r),o={tagName:"name"};Object.keys(o).forEach((function(e){var t=o[e];Object.defineProperty(i,e,{get:function(){return this[t]||null},set:function(e){return this[t]=e,e}})}))},{"./node":402}],402:[function(e,t,n){var r=t.exports={get firstChild(){var e=this.children;return e&&e[0]||null},get lastChild(){var e=this.children;return e&&e[e.length-1]||null},get nodeType(){return o[this.type]||o.element}},i={tagName:"name",childNodes:"children",parentNode:"parent",previousSibling:"prev",nextSibling:"next",nodeValue:"data"},o={element:1,text:3,cdata:4,comment:8};Object.keys(i).forEach((function(e){var t=i[e];Object.defineProperty(r,e,{get:function(){return this[t]||null},set:function(e){return this[t]=e,e}})}))},{}],403:[function(e,t,n){var r=t.exports;[e("./lib/stringify"),e("./lib/traversal"),e("./lib/manipulation"),e("./lib/querying"),e("./lib/legacy"),e("./lib/helpers")].forEach((function(e){Object.keys(e).forEach((function(t){r[t]=e[t].bind(r)}))}))},{"./lib/helpers":404,"./lib/legacy":405,"./lib/manipulation":406,"./lib/querying":407,"./lib/stringify":408,"./lib/traversal":409}],404:[function(e,t,n){n.removeSubsets=function(e){for(var t,n,r,i=e.length;--i>-1;){for(t=n=e[i],e[i]=null,r=!0;n;){if(e.indexOf(n)>-1){r=!1,e.splice(i,1);break}n=n.parent}r&&(e[i]=t)}return e};var r=1,i=2,o=4,s=8,a=16,l=n.compareDocumentPosition=function(e,t){var n,l,c,u,d,p,h=[],f=[];if(e===t)return 0;for(n=e;n;)h.unshift(n),n=n.parent;for(n=t;n;)f.unshift(n),n=n.parent;for(p=0;h[p]===f[p];)p++;return 0===p?r:(c=(l=h[p-1]).children,u=h[p],d=f[p],c.indexOf(u)>c.indexOf(d)?l===t?o|a:o:l===e?i|s:i)};n.uniqueSort=function(e){var t,n,r=e.length;for(e=e.slice();--r>-1;)t=e[r],(n=e.indexOf(t))>-1&&n<r&&e.splice(r,1);return e.sort((function(e,t){var n=l(e,t);return n&i?-1:n&o?1:0})),e}},{}],405:[function(e,t,n){var r=e("domelementtype"),i=n.isTag=r.isTag;n.testElement=function(e,t){for(var n in e)if(e.hasOwnProperty(n))if("tag_name"===n){if(!i(t)||!e.tag_name(t.name))return!1}else if("tag_type"===n){if(!e.tag_type(t.type))return!1}else if("tag_contains"===n){if(i(t)||!e.tag_contains(t.data))return!1}else if(!t.attribs||!e[n](t.attribs[n]))return!1;return!0};var o={tag_name:function(e){return"function"==typeof e?function(t){return i(t)&&e(t.name)}:"*"===e?i:function(t){return i(t)&&t.name===e}},tag_type:function(e){return"function"==typeof e?function(t){return e(t.type)}:function(t){return t.type===e}},tag_contains:function(e){return"function"==typeof e?function(t){return!i(t)&&e(t.data)}:function(t){return!i(t)&&t.data===e}}};function s(e,t){return"function"==typeof t?function(n){return n.attribs&&t(n.attribs[e])}:function(n){return n.attribs&&n.attribs[e]===t}}function a(e,t){return function(n){return e(n)||t(n)}}n.getElements=function(e,t,n,r){var i=Object.keys(e).map((function(t){var n=e[t];return t in o?o[t](n):s(t,n)}));return 0===i.length?[]:this.filter(i.reduce(a),t,n,r)},n.getElementById=function(e,t,n){return Array.isArray(t)||(t=[t]),this.findOne(s("id",e),t,!1!==n)},n.getElementsByTagName=function(e,t,n,r){return this.filter(o.tag_name(e),t,n,r)},n.getElementsByTagType=function(e,t,n,r){return this.filter(o.tag_type(e),t,n,r)}},{domelementtype:399}],406:[function(e,t,n){n.removeElement=function(e){if(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent){var t=e.parent.children;t.splice(t.lastIndexOf(e),1)}},n.replaceElement=function(e,t){var n=t.prev=e.prev;n&&(n.next=t);var r=t.next=e.next;r&&(r.prev=t);var i=t.parent=e.parent;if(i){var o=i.children;o[o.lastIndexOf(e)]=t}},n.appendChild=function(e,t){if(t.parent=e,1!==e.children.push(t)){var n=e.children[e.children.length-2];n.next=t,t.prev=n,t.next=null}},n.append=function(e,t){var n=e.parent,r=e.next;if(t.next=r,t.prev=e,e.next=t,t.parent=n,r){if(r.prev=t,n){var i=n.children;i.splice(i.lastIndexOf(r),0,t)}}else n&&n.children.push(t)},n.prepend=function(e,t){var n=e.parent;if(n){var r=n.children;r.splice(r.lastIndexOf(e),0,t)}e.prev&&(e.prev.next=t),t.parent=n,t.prev=e.prev,t.next=e,e.prev=t}},{}],407:[function(e,t,n){var r=e("domelementtype").isTag;function i(e,t,n,r){for(var o,s=[],a=0,l=t.length;a<l&&!(e(t[a])&&(s.push(t[a]),--r<=0))&&(o=t[a].children,!(n&&o&&o.length>0&&(o=i(e,o,n,r),s=s.concat(o),(r-=o.length)<=0)));a++);return s}t.exports={filter:function(e,t,n,r){return Array.isArray(t)||(t=[t]),"number"==typeof r&&isFinite(r)||(r=1/0),i(e,t,!1!==n,r)},find:i,findOneChild:function(e,t){for(var n=0,r=t.length;n<r;n++)if(e(t[n]))return t[n];return null},findOne:function e(t,n){for(var i=null,o=0,s=n.length;o<s&&!i;o++)r(n[o])&&(t(n[o])?i=n[o]:n[o].children.length>0&&(i=e(t,n[o].children)));return i},existsOne:function e(t,n){for(var i=0,o=n.length;i<o;i++)if(r(n[i])&&(t(n[i])||n[i].children.length>0&&e(t,n[i].children)))return!0;return!1},findAll:function(e,t){for(var n=[],i=t.slice();i.length;){var o=i.shift();r(o)&&(o.children&&o.children.length>0&&i.unshift.apply(i,o.children),e(o)&&n.push(o))}return n}}},{domelementtype:399}],408:[function(e,t,n){var r=e("domelementtype"),i=e("dom-serializer"),o=r.isTag;t.exports={getInnerHTML:function(e,t){return e.children?e.children.map((function(e){return i(e,t)})).join(""):""},getOuterHTML:i,getText:function e(t){return Array.isArray(t)?t.map(e).join(""):o(t)?"br"===t.name?"\n":e(t.children):t.type===r.CDATA?e(t.children):t.type===r.Text?t.data:""}}},{"dom-serializer":389,domelementtype:399}],409:[function(e,t,n){var r=n.getChildren=function(e){return e.children},i=n.getParent=function(e){return e.parent};n.getSiblings=function(e){var t=i(e);return t?r(t):[e]},n.getAttributeValue=function(e,t){return e.attribs&&e.attribs[t]},n.hasAttrib=function(e,t){return!!e.attribs&&hasOwnProperty.call(e.attribs,t)},n.getName=function(e){return e.name}},{}],410:[function(e,t,n){var r=e("../maps/decode.json");t.exports=function(e){if(e>=55296&&e<=57343||e>1114111)return"";e in r&&(e=r[e]);var t="";return e>65535&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e),t+String.fromCharCode(e)}},{"../maps/decode.json":411}],411:[function(e,t,n){t.exports={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376}},{}],412:[function(e,t,n){t.exports={Aacute:"",aacute:"",Abreve:"",abreve:"",ac:"",acd:"",acE:"",Acirc:"",acirc:"",acute:"",Acy:"",acy:"",AElig:"",aelig:"",af:"",Afr:"",afr:"",Agrave:"",agrave:"",alefsym:"",aleph:"",Alpha:"",alpha:"",Amacr:"",amacr:"",amalg:"",amp:"&",AMP:"&",andand:"",And:"",and:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angmsd:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"",angzarr:"",Aogon:"",aogon:"",Aopf:"",aopf:"",apacir:"",ap:"",apE:"",ape:"",apid:"",apos:"'",ApplyFunction:"",approx:"",approxeq:"",Aring:"",aring:"",Ascr:"",ascr:"",Assign:"",ast:"*",asymp:"",asympeq:"",Atilde:"",atilde:"",Auml:"",auml:"",awconint:"",awint:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",Backslash:"",Barv:"",barvee:"",barwed:"",Barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",Bcy:"",bcy:"",bdquo:"",becaus:"",because:"",Because:"",bemptyv:"",bepsi:"",bernou:"",Bernoullis:"",Beta:"",beta:"",beth:"",between:"",Bfr:"",bfr:"",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bNot:"",bnot:"",Bopf:"",bopf:"",bot:"",bottom:"",bowtie:"",boxbox:"",boxdl:"",boxdL:"",boxDl:"",boxDL:"",boxdr:"",boxdR:"",boxDr:"",boxDR:"",boxh:"",boxH:"",boxhd:"",boxHd:"",boxhD:"",boxHD:"",boxhu:"",boxHu:"",boxhU:"",boxHU:"",boxminus:"",boxplus:"",boxtimes:"",boxul:"",boxuL:"",boxUl:"",boxUL:"",boxur:"",boxuR:"",boxUr:"",boxUR:"",boxv:"",boxV:"",boxvh:"",boxvH:"",boxVh:"",boxVH:"",boxvl:"",boxvL:"",boxVl:"",boxVL:"",boxvr:"",boxvR:"",boxVr:"",boxVR:"",bprime:"",breve:"",Breve:"",brvbar:"",bscr:"",Bscr:"",bsemi:"",bsim:"",bsime:"",bsolb:"",bsol:"\\",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",Bumpeq:"",bumpeq:"",Cacute:"",cacute:"",capand:"",capbrcup:"",capcap:"",cap:"",Cap:"",capcup:"",capdot:"",CapitalDifferentialD:"",caps:"",caret:"",caron:"",Cayleys:"",ccaps:"",Ccaron:"",ccaron:"",Ccedil:"",ccedil:"",Ccirc:"",ccirc:"",Cconint:"",ccups:"",ccupssm:"",Cdot:"",cdot:"",cedil:"",Cedilla:"",cemptyv:"",cent:"",centerdot:"",CenterDot:"",cfr:"",Cfr:"",CHcy:"",chcy:"",check:"",checkmark:"",Chi:"",chi:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledast:"",circledcirc:"",circleddash:"",CircleDot:"",circledR:"",circledS:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",cir:"",cirE:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",clubs:"",clubsuit:"",colon:":",Colon:"",Colone:"",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",Congruent:"",conint:"",Conint:"",ContourIntegral:"",copf:"",Copf:"",coprod:"",Coproduct:"",copy:"",COPY:"",copysr:"",CounterClockwiseContourIntegral:"",crarr:"",cross:"",Cross:"",Cscr:"",cscr:"",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",cupbrcap:"",cupcap:"",CupCap:"",cup:"",Cup:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",dagger:"",Dagger:"",daleth:"",darr:"",Darr:"",dArr:"",dash:"",Dashv:"",dashv:"",dbkarow:"",dblac:"",Dcaron:"",dcaron:"",Dcy:"",dcy:"",ddagger:"",ddarr:"",DD:"",dd:"",DDotrahd:"",ddotseq:"",deg:"",Del:"",Delta:"",delta:"",demptyv:"",dfisht:"",Dfr:"",dfr:"",dHar:"",dharl:"",dharr:"",DiacriticalAcute:"",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",diam:"",diamond:"",Diamond:"",diamondsuit:"",diams:"",die:"",DifferentialD:"",digamma:"",disin:"",div:"",divide:"",divideontimes:"",divonx:"",DJcy:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",Dopf:"",dopf:"",Dot:"",dot:"",DotDot:"",doteq:"",doteqdot:"",DotEqual:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",DoubleContourIntegral:"",DoubleDot:"",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrowBar:"",downarrow:"",DownArrow:"",Downarrow:"",DownArrowUpArrow:"",DownBreve:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVectorBar:"",DownLeftVector:"",DownRightTeeVector:"",DownRightVectorBar:"",DownRightVector:"",DownTeeArrow:"",DownTee:"",drbkarow:"",drcorn:"",drcrop:"",Dscr:"",dscr:"",DScy:"",dscy:"",dsol:"",Dstrok:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",DZcy:"",dzcy:"",dzigrarr:"",Eacute:"",eacute:"",easter:"",Ecaron:"",ecaron:"",Ecirc:"",ecirc:"",ecir:"",ecolon:"",Ecy:"",ecy:"",eDDot:"",Edot:"",edot:"",eDot:"",ee:"",efDot:"",Efr:"",efr:"",eg:"",Egrave:"",egrave:"",egs:"",egsdot:"",el:"",Element:"",elinters:"",ell:"",els:"",elsdot:"",Emacr:"",emacr:"",empty:"",emptyset:"",EmptySmallSquare:"",emptyv:"",EmptyVerySmallSquare:"",emsp13:"",emsp14:"",emsp:"",ENG:"",eng:"",ensp:"",Eogon:"",eogon:"",Eopf:"",eopf:"",epar:"",eparsl:"",eplus:"",epsi:"",Epsilon:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",Equal:"",equals:"=",EqualTilde:"",equest:"",Equilibrium:"",equiv:"",equivDD:"",eqvparsl:"",erarr:"",erDot:"",escr:"",Escr:"",esdot:"",Esim:"",esim:"",Eta:"",eta:"",ETH:"",eth:"",Euml:"",euml:"",euro:"",excl:"!",exist:"",Exists:"",expectation:"",exponentiale:"",ExponentialE:"",fallingdotseq:"",Fcy:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",Ffr:"",ffr:"",filig:"",FilledSmallSquare:"",FilledVerySmallSquare:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",Fopf:"",fopf:"",forall:"",ForAll:"",fork:"",forkv:"",Fouriertrf:"",fpartint:"",frac12:"",frac13:"",frac14:"",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",fscr:"",Fscr:"",gacute:"",Gamma:"",gamma:"",Gammad:"",gammad:"",gap:"",Gbreve:"",gbreve:"",Gcedil:"",Gcirc:"",gcirc:"",Gcy:"",gcy:"",Gdot:"",gdot:"",ge:"",gE:"",gEl:"",gel:"",geq:"",geqq:"",geqslant:"",gescc:"",ges:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",Gfr:"",gfr:"",gg:"",Gg:"",ggg:"",gimel:"",GJcy:"",gjcy:"",gla:"",gl:"",glE:"",glj:"",gnap:"",gnapprox:"",gne:"",gnE:"",gneq:"",gneqq:"",gnsim:"",Gopf:"",gopf:"",grave:"`",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"",gscr:"",gsim:"",gsime:"",gsiml:"",gtcc:"",gtcir:"",gt:">",GT:">",Gt:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",Hacek:"",hairsp:"",half:"",hamilt:"",HARDcy:"",hardcy:"",harrcir:"",harr:"",hArr:"",harrw:"",Hat:"^",hbar:"",Hcirc:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",hfr:"",Hfr:"",HilbertSpace:"",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",hopf:"",Hopf:"",horbar:"",HorizontalLine:"",hscr:"",Hscr:"",hslash:"",Hstrok:"",hstrok:"",HumpDownHump:"",HumpEqual:"",hybull:"",hyphen:"",Iacute:"",iacute:"",ic:"",Icirc:"",icirc:"",Icy:"",icy:"",Idot:"",IEcy:"",iecy:"",iexcl:"",iff:"",ifr:"",Ifr:"",Igrave:"",igrave:"",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",IJlig:"",ijlig:"",Imacr:"",imacr:"",image:"",ImaginaryI:"",imagline:"",imagpart:"",imath:"",Im:"",imof:"",imped:"",Implies:"",incare:"",in:"",infin:"",infintie:"",inodot:"",intcal:"",int:"",Int:"",integers:"",Integral:"",intercal:"",Intersection:"",intlarhk:"",intprod:"",InvisibleComma:"",InvisibleTimes:"",IOcy:"",iocy:"",Iogon:"",iogon:"",Iopf:"",iopf:"",Iota:"",iota:"",iprod:"",iquest:"",iscr:"",Iscr:"",isin:"",isindot:"",isinE:"",isins:"",isinsv:"",isinv:"",it:"",Itilde:"",itilde:"",Iukcy:"",iukcy:"",Iuml:"",iuml:"",Jcirc:"",jcirc:"",Jcy:"",jcy:"",Jfr:"",jfr:"",jmath:"",Jopf:"",jopf:"",Jscr:"",jscr:"",Jsercy:"",jsercy:"",Jukcy:"",jukcy:"",Kappa:"",kappa:"",kappav:"",Kcedil:"",kcedil:"",Kcy:"",kcy:"",Kfr:"",kfr:"",kgreen:"",KHcy:"",khcy:"",KJcy:"",kjcy:"",Kopf:"",kopf:"",Kscr:"",kscr:"",lAarr:"",Lacute:"",lacute:"",laemptyv:"",lagran:"",Lambda:"",lambda:"",lang:"",Lang:"",langd:"",langle:"",lap:"",Laplacetrf:"",laquo:"",larrb:"",larrbfs:"",larr:"",Larr:"",lArr:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",latail:"",lAtail:"",lat:"",late:"",lates:"",lbarr:"",lBarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",Lcaron:"",lcaron:"",Lcedil:"",lcedil:"",lceil:"",lcub:"{",Lcy:"",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",le:"",lE:"",LeftAngleBracket:"",LeftArrowBar:"",leftarrow:"",LeftArrow:"",Leftarrow:"",LeftArrowRightArrow:"",leftarrowtail:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVectorBar:"",LeftDownVector:"",LeftFloor:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",leftrightarrow:"",LeftRightArrow:"",Leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",LeftRightVector:"",LeftTeeArrow:"",LeftTee:"",LeftTeeVector:"",leftthreetimes:"",LeftTriangleBar:"",LeftTriangle:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVectorBar:"",LeftUpVector:"",LeftVectorBar:"",LeftVector:"",lEg:"",leg:"",leq:"",leqq:"",leqslant:"",lescc:"",les:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",lessgtr:"",LessLess:"",lesssim:"",LessSlantEqual:"",LessTilde:"",lfisht:"",lfloor:"",Lfr:"",lfr:"",lg:"",lgE:"",lHar:"",lhard:"",lharu:"",lharul:"",lhblk:"",LJcy:"",ljcy:"",llarr:"",ll:"",Ll:"",llcorner:"",Lleftarrow:"",llhard:"",lltri:"",Lmidot:"",lmidot:"",lmoustache:"",lmoust:"",lnap:"",lnapprox:"",lne:"",lnE:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",longleftarrow:"",LongLeftArrow:"",Longleftarrow:"",longleftrightarrow:"",LongLeftRightArrow:"",Longleftrightarrow:"",longmapsto:"",longrightarrow:"",LongRightArrow:"",Longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",Lopf:"",lopf:"",loplus:"",lotimes:"",lowast:"",lowbar:"_",LowerLeftArrow:"",LowerRightArrow:"",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",lscr:"",Lscr:"",lsh:"",Lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",Lstrok:"",lstrok:"",ltcc:"",ltcir:"",lt:"<",LT:"<",Lt:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltri:"",ltrie:"",ltrif:"",ltrPar:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",macr:"",male:"",malt:"",maltese:"",Map:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",Mcy:"",mcy:"",mdash:"",mDDot:"",measuredangle:"",MediumSpace:"",Mellintrf:"",Mfr:"",mfr:"",mho:"",micro:"",midast:"*",midcir:"",mid:"",middot:"",minusb:"",minus:"",minusd:"",minusdu:"",MinusPlus:"",mlcp:"",mldr:"",mnplus:"",models:"",Mopf:"",mopf:"",mp:"",mscr:"",Mscr:"",mstpos:"",Mu:"",mu:"",multimap:"",mumap:"",nabla:"",Nacute:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natural:"",naturals:"",natur:"",nbsp:"",nbump:"",nbumpe:"",ncap:"",Ncaron:"",ncaron:"",Ncedil:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",Ncy:"",ncy:"",ndash:"",nearhk:"",nearr:"",neArr:"",nearrow:"",ne:"",nedot:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",nequiv:"",nesear:"",nesim:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:"\n",nexist:"",nexists:"",Nfr:"",nfr:"",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",nGg:"",ngsim:"",nGt:"",ngt:"",ngtr:"",nGtv:"",nharr:"",nhArr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",NJcy:"",njcy:"",nlarr:"",nlArr:"",nldr:"",nlE:"",nle:"",nleftarrow:"",nLeftarrow:"",nleftrightarrow:"",nLeftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nLl:"",nlsim:"",nLt:"",nlt:"",nltri:"",nltrie:"",nLtv:"",nmid:"",NoBreak:"",NonBreakingSpace:"",nopf:"",Nopf:"",Not:"",not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",notin:"",notindot:"",notinE:"",notinva:"",notinvb:"",notinvc:"",NotLeftTriangleBar:"",NotLeftTriangle:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",notni:"",notniva:"",notnivb:"",notnivc:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangleBar:"",NotRightTriangle:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",nparallel:"",npar:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",nprec:"",npreceq:"",npre:"",nrarrc:"",nrarr:"",nrArr:"",nrarrw:"",nrightarrow:"",nRightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",Nscr:"",nscr:"",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",Ntilde:"",ntilde:"",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",Nu:"",nu:"",num:"#",numero:"",numsp:"",nvap:"",nvdash:"",nvDash:"",nVdash:"",nVDash:"",nvge:"",nvgt:">",nvHarr:"",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwarhk:"",nwarr:"",nwArr:"",nwarrow:"",nwnear:"",Oacute:"",oacute:"",oast:"",Ocirc:"",ocirc:"",ocir:"",Ocy:"",ocy:"",odash:"",Odblac:"",odblac:"",odiv:"",odot:"",odsold:"",OElig:"",oelig:"",ofcir:"",Ofr:"",ofr:"",ogon:"",Ograve:"",ograve:"",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",Omacr:"",omacr:"",Omega:"",omega:"",Omicron:"",omicron:"",omid:"",ominus:"",Oopf:"",oopf:"",opar:"",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",operp:"",oplus:"",orarr:"",Or:"",or:"",ord:"",order:"",orderof:"",ordf:"",ordm:"",origof:"",oror:"",orslope:"",orv:"",oS:"",Oscr:"",oscr:"",Oslash:"",oslash:"",osol:"",Otilde:"",otilde:"",otimesas:"",Otimes:"",otimes:"",Ouml:"",ouml:"",ovbar:"",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",para:"",parallel:"",par:"",parsim:"",parsl:"",part:"",PartialD:"",Pcy:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",Pfr:"",pfr:"",Phi:"",phi:"",phiv:"",phmmat:"",phone:"",Pi:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plusacir:"",plusb:"",pluscir:"",plus:"+",plusdo:"",plusdu:"",pluse:"",PlusMinus:"",plusmn:"",plussim:"",plustwo:"",pm:"",Poincareplane:"",pointint:"",popf:"",Popf:"",pound:"",prap:"",Pr:"",pr:"",prcue:"",precapprox:"",prec:"",preccurlyeq:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",pre:"",prE:"",precsim:"",prime:"",Prime:"",primes:"",prnap:"",prnE:"",prnsim:"",prod:"",Product:"",profalar:"",profline:"",profsurf:"",prop:"",Proportional:"",Proportion:"",propto:"",prsim:"",prurel:"",Pscr:"",pscr:"",Psi:"",psi:"",puncsp:"",Qfr:"",qfr:"",qint:"",qopf:"",Qopf:"",qprime:"",Qscr:"",qscr:"",quaternions:"",quatint:"",quest:"?",questeq:"",quot:'"',QUOT:'"',rAarr:"",race:"",Racute:"",racute:"",radic:"",raemptyv:"",rang:"",Rang:"",rangd:"",range:"",rangle:"",raquo:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarr:"",Rarr:"",rArr:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",Rarrtl:"",rarrtl:"",rarrw:"",ratail:"",rAtail:"",ratio:"",rationals:"",rbarr:"",rBarr:"",RBarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",Rcaron:"",rcaron:"",Rcedil:"",rcedil:"",rceil:"",rcub:"}",Rcy:"",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",real:"",realine:"",realpart:"",reals:"",Re:"",rect:"",reg:"",REG:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",rfisht:"",rfloor:"",rfr:"",Rfr:"",rHar:"",rhard:"",rharu:"",rharul:"",Rho:"",rho:"",rhov:"",RightAngleBracket:"",RightArrowBar:"",rightarrow:"",RightArrow:"",Rightarrow:"",RightArrowLeftArrow:"",rightarrowtail:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVectorBar:"",RightDownVector:"",RightFloor:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",RightTeeArrow:"",RightTee:"",RightTeeVector:"",rightthreetimes:"",RightTriangleBar:"",RightTriangle:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVectorBar:"",RightUpVector:"",RightVectorBar:"",RightVector:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoustache:"",rmoust:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",ropf:"",Ropf:"",roplus:"",rotimes:"",RoundImplies:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",Rrightarrow:"",rsaquo:"",rscr:"",Rscr:"",rsh:"",Rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",RuleDelayed:"",ruluhar:"",rx:"",Sacute:"",sacute:"",sbquo:"",scap:"",Scaron:"",scaron:"",Sc:"",sc:"",sccue:"",sce:"",scE:"",Scedil:"",scedil:"",Scirc:"",scirc:"",scnap:"",scnE:"",scnsim:"",scpolint:"",scsim:"",Scy:"",scy:"",sdotb:"",sdot:"",sdote:"",searhk:"",searr:"",seArr:"",searrow:"",sect:"",semi:";",seswar:"",setminus:"",setmn:"",sext:"",Sfr:"",sfr:"",sfrown:"",sharp:"",SHCHcy:"",shchcy:"",SHcy:"",shcy:"",ShortDownArrow:"",ShortLeftArrow:"",shortmid:"",shortparallel:"",ShortRightArrow:"",ShortUpArrow:"",shy:"",Sigma:"",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",SmallCircle:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",SOFTcy:"",softcy:"",solbar:"",solb:"",sol:"/",Sopf:"",sopf:"",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",Sqrt:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",square:"",Square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",squarf:"",squ:"",squf:"",srarr:"",Sscr:"",sscr:"",ssetmn:"",ssmile:"",sstarf:"",Star:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"",sub:"",Sub:"",subdot:"",subE:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",subset:"",Subset:"",subseteq:"",subseteqq:"",SubsetEqual:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succapprox:"",succ:"",succcurlyeq:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",SuchThat:"",sum:"",Sum:"",sung:"",sup1:"",sup2:"",sup3:"",sup:"",Sup:"",supdot:"",supdsub:"",supE:"",supe:"",supedot:"",Superset:"",SupersetEqual:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",supset:"",Supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swarhk:"",swarr:"",swArr:"",swarrow:"",swnwar:"",szlig:"",Tab:"\t",target:"",Tau:"",tau:"",tbrk:"",Tcaron:"",tcaron:"",Tcedil:"",tcedil:"",Tcy:"",tcy:"",tdot:"",telrec:"",Tfr:"",tfr:"",there4:"",therefore:"",Therefore:"",Theta:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",ThickSpace:"",ThinSpace:"",thinsp:"",thkap:"",thksim:"",THORN:"",thorn:"",tilde:"",Tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",timesbar:"",timesb:"",times:"",timesd:"",tint:"",toea:"",topbot:"",topcir:"",top:"",Topf:"",topf:"",topfork:"",tosa:"",tprime:"",trade:"",TRADE:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",TripleDot:"",triplus:"",trisb:"",tritime:"",trpezium:"",Tscr:"",tscr:"",TScy:"",tscy:"",TSHcy:"",tshcy:"",Tstrok:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",Uacute:"",uacute:"",uarr:"",Uarr:"",uArr:"",Uarrocir:"",Ubrcy:"",ubrcy:"",Ubreve:"",ubreve:"",Ucirc:"",ucirc:"",Ucy:"",ucy:"",udarr:"",Udblac:"",udblac:"",udhar:"",ufisht:"",Ufr:"",ufr:"",Ugrave:"",ugrave:"",uHar:"",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",Umacr:"",umacr:"",uml:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",uogon:"",Uopf:"",uopf:"",UpArrowBar:"",uparrow:"",UpArrow:"",Uparrow:"",UpArrowDownArrow:"",updownarrow:"",UpDownArrow:"",Updownarrow:"",UpEquilibrium:"",upharpoonleft:"",upharpoonright:"",uplus:"",UpperLeftArrow:"",UpperRightArrow:"",upsi:"",Upsi:"",upsih:"",Upsilon:"",upsilon:"",UpTeeArrow:"",UpTee:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",Uring:"",uring:"",urtri:"",Uscr:"",uscr:"",utdot:"",Utilde:"",utilde:"",utri:"",utrif:"",uuarr:"",Uuml:"",uuml:"",uwangle:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",varr:"",vArr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",vBar:"",Vbar:"",vBarv:"",Vcy:"",vcy:"",vdash:"",vDash:"",Vdash:"",VDash:"",Vdashl:"",veebar:"",vee:"",Vee:"",veeeq:"",vellip:"",verbar:"|",Verbar:"",vert:"|",Vert:"",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"",vfr:"",vltri:"",vnsub:"",vnsup:"",Vopf:"",vopf:"",vprop:"",vrtri:"",Vscr:"",vscr:"",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",Vvdash:"",vzigzag:"",Wcirc:"",wcirc:"",wedbar:"",wedge:"",Wedge:"",wedgeq:"",weierp:"",Wfr:"",wfr:"",Wopf:"",wopf:"",wp:"",wr:"",wreath:"",Wscr:"",wscr:"",xcap:"",xcirc:"",xcup:"",xdtri:"",Xfr:"",xfr:"",xharr:"",xhArr:"",Xi:"",xi:"",xlarr:"",xlArr:"",xmap:"",xnis:"",xodot:"",Xopf:"",xopf:"",xoplus:"",xotime:"",xrarr:"",xrArr:"",Xscr:"",xscr:"",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",Yacute:"",yacute:"",YAcy:"",yacy:"",Ycirc:"",ycirc:"",Ycy:"",ycy:"",yen:"",Yfr:"",yfr:"",YIcy:"",yicy:"",Yopf:"",yopf:"",Yscr:"",yscr:"",YUcy:"",yucy:"",yuml:"",Yuml:"",Zacute:"",zacute:"",Zcaron:"",zcaron:"",Zcy:"",zcy:"",Zdot:"",zdot:"",zeetrf:"",ZeroWidthSpace:"",Zeta:"",zeta:"",zfr:"",Zfr:"",ZHcy:"",zhcy:"",zigrarr:"",zopf:"",Zopf:"",Zscr:"",zscr:"",zwj:"",zwnj:""}},{}],413:[function(e,t,n){t.exports={Aacute:"",aacute:"",Acirc:"",acirc:"",acute:"",AElig:"",aelig:"",Agrave:"",agrave:"",amp:"&",AMP:"&",Aring:"",aring:"",Atilde:"",atilde:"",Auml:"",auml:"",brvbar:"",Ccedil:"",ccedil:"",cedil:"",cent:"",copy:"",COPY:"",curren:"",deg:"",divide:"",Eacute:"",eacute:"",Ecirc:"",ecirc:"",Egrave:"",egrave:"",ETH:"",eth:"",Euml:"",euml:"",frac12:"",frac14:"",frac34:"",gt:">",GT:">",Iacute:"",iacute:"",Icirc:"",icirc:"",iexcl:"",Igrave:"",igrave:"",iquest:"",Iuml:"",iuml:"",laquo:"",lt:"<",LT:"<",macr:"",micro:"",middot:"",nbsp:"",not:"",Ntilde:"",ntilde:"",Oacute:"",oacute:"",Ocirc:"",ocirc:"",Ograve:"",ograve:"",ordf:"",ordm:"",Oslash:"",oslash:"",Otilde:"",otilde:"",Ouml:"",ouml:"",para:"",plusmn:"",pound:"",quot:'"',QUOT:'"',raquo:"",reg:"",REG:"",sect:"",shy:"",sup1:"",sup2:"",sup3:"",szlig:"",THORN:"",thorn:"",times:"",Uacute:"",uacute:"",Ucirc:"",ucirc:"",Ugrave:"",ugrave:"",uml:"",Uuml:"",uuml:"",Yacute:"",yacute:"",yen:"",yuml:""}},{}],414:[function(e,t,n){arguments[4][398][0].apply(n,arguments)},{dup:398}],415:[function(e,t,n){function r(e){this._cbs=e||{},this.events=[]}t.exports=r;var i=e("./").EVENTS;Object.keys(i).forEach((function(e){if(0===i[e])e="on"+e,r.prototype[e]=function(){this.events.push([e]),this._cbs[e]&&this._cbs[e]()};else if(1===i[e])e="on"+e,r.prototype[e]=function(t){this.events.push([e,t]),this._cbs[e]&&this._cbs[e](t)};else{if(2!==i[e])throw Error("wrong number of arguments");e="on"+e,r.prototype[e]=function(t,n){this.events.push([e,t,n]),this._cbs[e]&&this._cbs[e](t,n)}}})),r.prototype.onreset=function(){this.events=[],this._cbs.onreset&&this._cbs.onreset()},r.prototype.restart=function(){this._cbs.onreset&&this._cbs.onreset();for(var e=0,t=this.events.length;e<t;e++)if(this._cbs[this.events[e][0]]){var n=this.events[e].length;1===n?this._cbs[this.events[e][0]]():2===n?this._cbs[this.events[e][0]](this.events[e][1]):this._cbs[this.events[e][0]](this.events[e][1],this.events[e][2])}}},{"./":422}],416:[function(e,t,n){var r=e("domhandler"),i=e("domutils");function o(e,t){this.init(e,t)}function s(e,t){return i.getElementsByTagName(e,t,!0)}function a(e,t){return i.getElementsByTagName(e,t,!0,1)[0]}function l(e,t,n){return i.getText(i.getElementsByTagName(e,t,n,1)).trim()}function c(e,t,n,r,i){var o=l(n,r,i);o&&(e[t]=o)}e("inherits")(o,r),o.prototype.init=r;var u=function(e){return"rss"===e||"feed"===e||"rdf:RDF"===e};o.prototype.onend=function(){var e,t,n={},i=a(u,this.dom);i&&("feed"===i.name?(t=i.children,n.type="atom",c(n,"id","id",t),c(n,"title","title",t),(e=a("link",t))&&(e=e.attribs)&&(e=e.href)&&(n.link=e),c(n,"description","subtitle",t),(e=l("updated",t))&&(n.updated=new Date(e)),c(n,"author","email",t,!0),n.items=s("entry",t).map((function(e){var t,n={};return c(n,"id","id",e=e.children),c(n,"title","title",e),(t=a("link",e))&&(t=t.attribs)&&(t=t.href)&&(n.link=t),(t=l("summary",e)||l("content",e))&&(n.description=t),(t=l("updated",e))&&(n.pubDate=new Date(t)),n}))):(t=a("channel",i.children).children,n.type=i.name.substr(0,3),n.id="",c(n,"title","title",t),c(n,"link","link",t),c(n,"description","description",t),(e=l("lastBuildDate",t))&&(n.updated=new Date(e)),c(n,"author","managingEditor",t,!0),n.items=s("item",i.children).map((function(e){var t,n={};return c(n,"id","guid",e=e.children),c(n,"title","title",e),c(n,"link","link",e),c(n,"description","description",e),(t=l("pubDate",e))&&(n.pubDate=new Date(t)),n})))),this.dom=n,r.prototype._handleCallback.call(this,i?null:Error("couldn't find root of feed"))},t.exports=o},{domhandler:400,domutils:403,inherits:247}],417:[function(e,t,n){var r=e("./Tokenizer.js"),i={input:!0,option:!0,optgroup:!0,select:!0,button:!0,datalist:!0,textarea:!0},o={tr:{tr:!0,th:!0,td:!0},th:{th:!0},td:{thead:!0,th:!0,td:!0},body:{head:!0,link:!0,script:!0},li:{li:!0},p:{p:!0},h1:{p:!0},h2:{p:!0},h3:{p:!0},h4:{p:!0},h5:{p:!0},h6:{p:!0},select:i,input:i,output:i,button:i,datalist:i,textarea:i,option:{option:!0},optgroup:{optgroup:!0}},s={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},a={__proto__:null,math:!0,svg:!0},l={__proto__:null,mi:!0,mo:!0,mn:!0,ms:!0,mtext:!0,"annotation-xml":!0,foreignObject:!0,desc:!0,title:!0},c=/\s|\//;function u(e,t){this._options=t||{},this._cbs=e||{},this._tagname="",this._attribname="",this._attribvalue="",this._attribs=null,this._stack=[],this._foreignContext=[],this.startIndex=0,this.endIndex=null,this._lowerCaseTagNames="lowerCaseTags"in this._options?!!this._options.lowerCaseTags:!this._options.xmlMode,this._lowerCaseAttributeNames="lowerCaseAttributeNames"in this._options?!!this._options.lowerCaseAttributeNames:!this._options.xmlMode,this._options.Tokenizer&&(r=this._options.Tokenizer),this._tokenizer=new r(this._options,this),this._cbs.onparserinit&&this._cbs.onparserinit(this)}e("inherits")(u,e("events").EventEmitter),u.prototype._updatePosition=function(e){null===this.endIndex?this._tokenizer._sectionStart<=e?this.startIndex=0:this.startIndex=this._tokenizer._sectionStart-e:this.startIndex=this.endIndex+1,this.endIndex=this._tokenizer.getAbsoluteIndex()},u.prototype.ontext=function(e){this._updatePosition(1),this.endIndex--,this._cbs.ontext&&this._cbs.ontext(e)},u.prototype.onopentagname=function(e){if(this._lowerCaseTagNames&&(e=e.toLowerCase()),this._tagname=e,!this._options.xmlMode&&e in o)for(var t;(t=this._stack[this._stack.length-1])in o[e];this.onclosetag(t));!this._options.xmlMode&&e in s||(this._stack.push(e),e in a?this._foreignContext.push(!0):e in l&&this._foreignContext.push(!1)),this._cbs.onopentagname&&this._cbs.onopentagname(e),this._cbs.onopentag&&(this._attribs={})},u.prototype.onopentagend=function(){this._updatePosition(1),this._attribs&&(this._cbs.onopentag&&this._cbs.onopentag(this._tagname,this._attribs),this._attribs=null),!this._options.xmlMode&&this._cbs.onclosetag&&this._tagname in s&&this._cbs.onclosetag(this._tagname),this._tagname=""},u.prototype.onclosetag=function(e){if(this._updatePosition(1),this._lowerCaseTagNames&&(e=e.toLowerCase()),(e in a||e in l)&&this._foreignContext.pop(),!this._stack.length||e in s&&!this._options.xmlMode)this._options.xmlMode||"br"!==e&&"p"!==e||(this.onopentagname(e),this._closeCurrentTag());else{var t=this._stack.lastIndexOf(e);if(-1!==t)if(this._cbs.onclosetag)for(t=this._stack.length-t;t--;)this._cbs.onclosetag(this._stack.pop());else this._stack.length=t;else"p"!==e||this._options.xmlMode||(this.onopentagname(e),this._closeCurrentTag())}},u.prototype.onselfclosingtag=function(){this._options.xmlMode||this._options.recognizeSelfClosing||this._foreignContext[this._foreignContext.length-1]?this._closeCurrentTag():this.onopentagend()},u.prototype._closeCurrentTag=function(){var e=this._tagname;this.onopentagend(),this._stack[this._stack.length-1]===e&&(this._cbs.onclosetag&&this._cbs.onclosetag(e),this._stack.pop())},u.prototype.onattribname=function(e){this._lowerCaseAttributeNames&&(e=e.toLowerCase()),this._attribname=e},u.prototype.onattribdata=function(e){this._attribvalue+=e},u.prototype.onattribend=function(){this._cbs.onattribute&&this._cbs.onattribute(this._attribname,this._attribvalue),this._attribs&&!Object.prototype.hasOwnProperty.call(this._attribs,this._attribname)&&(this._attribs[this._attribname]=this._attribvalue),this._attribname="",this._attribvalue=""},u.prototype._getInstructionName=function(e){var t=e.search(c),n=t<0?e:e.substr(0,t);return this._lowerCaseTagNames&&(n=n.toLowerCase()),n},u.prototype.ondeclaration=function(e){if(this._cbs.onprocessinginstruction){var t=this._getInstructionName(e);this._cbs.onprocessinginstruction("!"+t,"!"+e)}},u.prototype.onprocessinginstruction=function(e){if(this._cbs.onprocessinginstruction){var t=this._getInstructionName(e);this._cbs.onprocessinginstruction("?"+t,"?"+e)}},u.prototype.oncomment=function(e){this._updatePosition(4),this._cbs.oncomment&&this._cbs.oncomment(e),this._cbs.oncommentend&&this._cbs.oncommentend()},u.prototype.oncdata=function(e){this._updatePosition(1),this._options.xmlMode||this._options.recognizeCDATA?(this._cbs.oncdatastart&&this._cbs.oncdatastart(),this._cbs.ontext&&this._cbs.ontext(e),this._cbs.oncdataend&&this._cbs.oncdataend()):this.oncomment("[CDATA["+e+"]]")},u.prototype.onerror=function(e){this._cbs.onerror&&this._cbs.onerror(e)},u.prototype.onend=function(){if(this._cbs.onclosetag)for(var e=this._stack.length;e>0;this._cbs.onclosetag(this._stack[--e]));this._cbs.onend&&this._cbs.onend()},u.prototype.reset=function(){this._cbs.onreset&&this._cbs.onreset(),this._tokenizer.reset(),this._tagname="",this._attribname="",this._attribs=null,this._stack=[],this._cbs.onparserinit&&this._cbs.onparserinit(this)},u.prototype.parseComplete=function(e){this.reset(),this.end(e)},u.prototype.write=function(e){this._tokenizer.write(e)},u.prototype.end=function(e){this._tokenizer.end(e)},u.prototype.pause=function(){this._tokenizer.pause()},u.prototype.resume=function(){this._tokenizer.resume()},u.prototype.parseChunk=u.prototype.write,u.prototype.done=u.prototype.end,t.exports=u},{"./Tokenizer.js":420,events:241,inherits:247}],418:[function(e,t,n){function r(e){this._cbs=e||{}}t.exports=r;var i=e("./").EVENTS;Object.keys(i).forEach((function(e){if(0===i[e])e="on"+e,r.prototype[e]=function(){this._cbs[e]&&this._cbs[e]()};else if(1===i[e])e="on"+e,r.prototype[e]=function(t){this._cbs[e]&&this._cbs[e](t)};else{if(2!==i[e])throw Error("wrong number of arguments");e="on"+e,r.prototype[e]=function(t,n){this._cbs[e]&&this._cbs[e](t,n)}}}))},{"./":422}],419:[function(e,t,n){t.exports=i;var r=e("./WritableStream.js");function i(e){r.call(this,new o(this),e)}function o(e){this.scope=e}e("inherits")(i,r),i.prototype.readable=!0;var s=e("../").EVENTS;Object.keys(s).forEach((function(e){if(0===s[e])o.prototype["on"+e]=function(){this.scope.emit(e)};else if(1===s[e])o.prototype["on"+e]=function(t){this.scope.emit(e,t)};else{if(2!==s[e])throw Error("wrong number of arguments!");o.prototype["on"+e]=function(t,n){this.scope.emit(e,t,n)}}}))},{"../":422,"./WritableStream.js":421,inherits:247}],420:[function(e,t,n){t.exports=me;var r=e("entities/lib/decode_codepoint.js"),i=e("entities/maps/entities.json"),o=e("entities/maps/legacy.json"),s=e("entities/maps/xml.json"),a=0,l=a++,c=a++,u=a++,d=a++,p=a++,h=a++,f=a++,g=a++,m=a++,v=a++,y=a++,b=a++,x=a++,E=a++,_=a++,w=a++,S=a++,T=a++,k=a++,C=a++,A=a++,j=a++,I=a++,O=a++,N=a++,R=a++,P=a++,D=a++,M=a++,L=a++,B=a++,F=a++,U=a++,H=a++,G=a++,q=a++,V=a++,z=a++,W=a++,K=a++,$=a++,Y=a++,X=a++,J=a++,Q=a++,Z=a++,ee=a++,te=a++,ne=a++,re=a++,ie=a++,oe=a++,se=a++,ae=a++,le=a++,ce=0,ue=ce++,de=ce++,pe=ce++;function he(e){return" "===e||"\n"===e||"\t"===e||"\f"===e||"\r"===e}function fe(e,t,n){var r=e.toLowerCase();return e===r?function(e){e===r?this._state=t:(this._state=n,this._index--)}:function(i){i===r||i===e?this._state=t:(this._state=n,this._index--)}}function ge(e,t){var n=e.toLowerCase();return function(r){r===n||r===e?this._state=t:(this._state=u,this._index--)}}function me(e,t){this._state=l,this._buffer="",this._sectionStart=0,this._index=0,this._bufferOffset=0,this._baseState=l,this._special=ue,this._cbs=t,this._running=!0,this._ended=!1,this._xmlMode=!(!e||!e.xmlMode),this._decodeEntities=!(!e||!e.decodeEntities)}me.prototype._stateText=function(e){"<"===e?(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._state=c,this._sectionStart=this._index):this._decodeEntities&&this._special===ue&&"&"===e&&(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._baseState=l,this._state=ie,this._sectionStart=this._index)},me.prototype._stateBeforeTagName=function(e){"/"===e?this._state=p:"<"===e?(this._cbs.ontext(this._getSection()),this._sectionStart=this._index):">"===e||this._special!==ue||he(e)?this._state=l:"!"===e?(this._state=_,this._sectionStart=this._index+1):"?"===e?(this._state=S,this._sectionStart=this._index+1):(this._state=this._xmlMode||"s"!==e&&"S"!==e?u:B,this._sectionStart=this._index)},me.prototype._stateInTagName=function(e){("/"===e||">"===e||he(e))&&(this._emitToken("onopentagname"),this._state=g,this._index--)},me.prototype._stateBeforeCloseingTagName=function(e){he(e)||(">"===e?this._state=l:this._special!==ue?"s"===e||"S"===e?this._state=F:(this._state=l,this._index--):(this._state=h,this._sectionStart=this._index))},me.prototype._stateInCloseingTagName=function(e){(">"===e||he(e))&&(this._emitToken("onclosetag"),this._state=f,this._index--)},me.prototype._stateAfterCloseingTagName=function(e){">"===e&&(this._state=l,this._sectionStart=this._index+1)},me.prototype._stateBeforeAttributeName=function(e){">"===e?(this._cbs.onopentagend(),this._state=l,this._sectionStart=this._index+1):"/"===e?this._state=d:he(e)||(this._state=m,this._sectionStart=this._index)},me.prototype._stateInSelfClosingTag=function(e){">"===e?(this._cbs.onselfclosingtag(),this._state=l,this._sectionStart=this._index+1):he(e)||(this._state=g,this._index--)},me.prototype._stateInAttributeName=function(e){("="===e||"/"===e||">"===e||he(e))&&(this._cbs.onattribname(this._getSection()),this._sectionStart=-1,this._state=v,this._index--)},me.prototype._stateAfterAttributeName=function(e){"="===e?this._state=y:"/"===e||">"===e?(this._cbs.onattribend(),this._state=g,this._index--):he(e)||(this._cbs.onattribend(),this._state=m,this._sectionStart=this._index)},me.prototype._stateBeforeAttributeValue=function(e){'"'===e?(this._state=b,this._sectionStart=this._index+1):"'"===e?(this._state=x,this._sectionStart=this._index+1):he(e)||(this._state=E,this._sectionStart=this._index,this._index--)},me.prototype._stateInAttributeValueDoubleQuotes=function(e){'"'===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=g):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=ie,this._sectionStart=this._index)},me.prototype._stateInAttributeValueSingleQuotes=function(e){"'"===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=g):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=ie,this._sectionStart=this._index)},me.prototype._stateInAttributeValueNoQuotes=function(e){he(e)||">"===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=g,this._index--):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=ie,this._sectionStart=this._index)},me.prototype._stateBeforeDeclaration=function(e){this._state="["===e?j:"-"===e?T:w},me.prototype._stateInDeclaration=function(e){">"===e&&(this._cbs.ondeclaration(this._getSection()),this._state=l,this._sectionStart=this._index+1)},me.prototype._stateInProcessingInstruction=function(e){">"===e&&(this._cbs.onprocessinginstruction(this._getSection()),this._state=l,this._sectionStart=this._index+1)},me.prototype._stateBeforeComment=function(e){"-"===e?(this._state=k,this._sectionStart=this._index+1):this._state=w},me.prototype._stateInComment=function(e){"-"===e&&(this._state=C)},me.prototype._stateAfterComment1=function(e){this._state="-"===e?A:k},me.prototype._stateAfterComment2=function(e){">"===e?(this._cbs.oncomment(this._buffer.substring(this._sectionStart,this._index-2)),this._state=l,this._sectionStart=this._index+1):"-"!==e&&(this._state=k)},me.prototype._stateBeforeCdata1=fe("C",I,w),me.prototype._stateBeforeCdata2=fe("D",O,w),me.prototype._stateBeforeCdata3=fe("A",N,w),me.prototype._stateBeforeCdata4=fe("T",R,w),me.prototype._stateBeforeCdata5=fe("A",P,w),me.prototype._stateBeforeCdata6=function(e){"["===e?(this._state=D,this._sectionStart=this._index+1):(this._state=w,this._index--)},me.prototype._stateInCdata=function(e){"]"===e&&(this._state=M)},me.prototype._stateAfterCdata1=function(e){this._state="]"===e?L:D},me.prototype._stateAfterCdata2=function(e){">"===e?(this._cbs.oncdata(this._buffer.substring(this._sectionStart,this._index-2)),this._state=l,this._sectionStart=this._index+1):"]"!==e&&(this._state=D)},me.prototype._stateBeforeSpecial=function(e){"c"===e||"C"===e?this._state=U:"t"===e||"T"===e?this._state=X:(this._state=u,this._index--)},me.prototype._stateBeforeSpecialEnd=function(e){this._special!==de||"c"!==e&&"C"!==e?this._special!==pe||"t"!==e&&"T"!==e?this._state=l:this._state=ee:this._state=z},me.prototype._stateBeforeScript1=ge("R",H),me.prototype._stateBeforeScript2=ge("I",G),me.prototype._stateBeforeScript3=ge("P",q),me.prototype._stateBeforeScript4=ge("T",V),me.prototype._stateBeforeScript5=function(e){("/"===e||">"===e||he(e))&&(this._special=de),this._state=u,this._index--},me.prototype._stateAfterScript1=fe("R",W,l),me.prototype._stateAfterScript2=fe("I",K,l),me.prototype._stateAfterScript3=fe("P",$,l),me.prototype._stateAfterScript4=fe("T",Y,l),me.prototype._stateAfterScript5=function(e){">"===e||he(e)?(this._special=ue,this._state=h,this._sectionStart=this._index-6,this._index--):this._state=l},me.prototype._stateBeforeStyle1=ge("Y",J),me.prototype._stateBeforeStyle2=ge("L",Q),me.prototype._stateBeforeStyle3=ge("E",Z),me.prototype._stateBeforeStyle4=function(e){("/"===e||">"===e||he(e))&&(this._special=pe),this._state=u,this._index--},me.prototype._stateAfterStyle1=fe("Y",te,l),me.prototype._stateAfterStyle2=fe("L",ne,l),me.prototype._stateAfterStyle3=fe("E",re,l),me.prototype._stateAfterStyle4=function(e){">"===e||he(e)?(this._special=ue,this._state=h,this._sectionStart=this._index-5,this._index--):this._state=l},me.prototype._stateBeforeEntity=fe("#",oe,se),me.prototype._stateBeforeNumericEntity=fe("X",le,ae),me.prototype._parseNamedEntityStrict=function(){if(this._sectionStart+1<this._index){var e=this._buffer.substring(this._sectionStart+1,this._index),t=this._xmlMode?s:i;t.hasOwnProperty(e)&&(this._emitPartial(t[e]),this._sectionStart=this._index+1)}},me.prototype._parseLegacyEntity=function(){var e=this._sectionStart+1,t=this._index-e;for(t>6&&(t=6);t>=2;){var n=this._buffer.substr(e,t);if(o.hasOwnProperty(n))return this._emitPartial(o[n]),void(this._sectionStart+=t+1);t--}},me.prototype._stateInNamedEntity=function(e){";"===e?(this._parseNamedEntityStrict(),this._sectionStart+1<this._index&&!this._xmlMode&&this._parseLegacyEntity(),this._state=this._baseState):(e<"a"||e>"z")&&(e<"A"||e>"Z")&&(e<"0"||e>"9")&&(this._xmlMode||this._sectionStart+1===this._index||(this._baseState!==l?"="!==e&&this._parseNamedEntityStrict():this._parseLegacyEntity()),this._state=this._baseState,this._index--)},me.prototype._decodeNumericEntity=function(e,t){var n=this._sectionStart+e;if(n!==this._index){var i=this._buffer.substring(n,this._index),o=parseInt(i,t);this._emitPartial(r(o)),this._sectionStart=this._index}else this._sectionStart--;this._state=this._baseState},me.prototype._stateInNumericEntity=function(e){";"===e?(this._decodeNumericEntity(2,10),this._sectionStart++):(e<"0"||e>"9")&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(2,10),this._index--)},me.prototype._stateInHexEntity=function(e){";"===e?(this._decodeNumericEntity(3,16),this._sectionStart++):(e<"a"||e>"f")&&(e<"A"||e>"F")&&(e<"0"||e>"9")&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(3,16),this._index--)},me.prototype._cleanup=function(){this._sectionStart<0?(this._buffer="",this._bufferOffset+=this._index,this._index=0):this._running&&(this._state===l?(this._sectionStart!==this._index&&this._cbs.ontext(this._buffer.substr(this._sectionStart)),this._buffer="",this._bufferOffset+=this._index,this._index=0):this._sectionStart===this._index?(this._buffer="",this._bufferOffset+=this._index,this._index=0):(this._buffer=this._buffer.substr(this._sectionStart),this._index-=this._sectionStart,this._bufferOffset+=this._sectionStart),this._sectionStart=0)},me.prototype.write=function(e){this._ended&&this._cbs.onerror(Error(".write() after done!")),this._buffer+=e,this._parse()},me.prototype._parse=function(){for(;this._index<this._buffer.length&&this._running;){var e=this._buffer.charAt(this._index);this._state===l?this._stateText(e):this._state===c?this._stateBeforeTagName(e):this._state===u?this._stateInTagName(e):this._state===p?this._stateBeforeCloseingTagName(e):this._state===h?this._stateInCloseingTagName(e):this._state===f?this._stateAfterCloseingTagName(e):this._state===d?this._stateInSelfClosingTag(e):this._state===g?this._stateBeforeAttributeName(e):this._state===m?this._stateInAttributeName(e):this._state===v?this._stateAfterAttributeName(e):this._state===y?this._stateBeforeAttributeValue(e):this._state===b?this._stateInAttributeValueDoubleQuotes(e):this._state===x?this._stateInAttributeValueSingleQuotes(e):this._state===E?this._stateInAttributeValueNoQuotes(e):this._state===_?this._stateBeforeDeclaration(e):this._state===w?this._stateInDeclaration(e):this._state===S?this._stateInProcessingInstruction(e):this._state===T?this._stateBeforeComment(e):this._state===k?this._stateInComment(e):this._state===C?this._stateAfterComment1(e):this._state===A?this._stateAfterComment2(e):this._state===j?this._stateBeforeCdata1(e):this._state===I?this._stateBeforeCdata2(e):this._state===O?this._stateBeforeCdata3(e):this._state===N?this._stateBeforeCdata4(e):this._state===R?this._stateBeforeCdata5(e):this._state===P?this._stateBeforeCdata6(e):this._state===D?this._stateInCdata(e):this._state===M?this._stateAfterCdata1(e):this._state===L?this._stateAfterCdata2(e):this._state===B?this._stateBeforeSpecial(e):this._state===F?this._stateBeforeSpecialEnd(e):this._state===U?this._stateBeforeScript1(e):this._state===H?this._stateBeforeScript2(e):this._state===G?this._stateBeforeScript3(e):this._state===q?this._stateBeforeScript4(e):this._state===V?this._stateBeforeScript5(e):this._state===z?this._stateAfterScript1(e):this._state===W?this._stateAfterScript2(e):this._state===K?this._stateAfterScript3(e):this._state===$?this._stateAfterScript4(e):this._state===Y?this._stateAfterScript5(e):this._state===X?this._stateBeforeStyle1(e):this._state===J?this._stateBeforeStyle2(e):this._state===Q?this._stateBeforeStyle3(e):this._state===Z?this._stateBeforeStyle4(e):this._state===ee?this._stateAfterStyle1(e):this._state===te?this._stateAfterStyle2(e):this._state===ne?this._stateAfterStyle3(e):this._state===re?this._stateAfterStyle4(e):this._state===ie?this._stateBeforeEntity(e):this._state===oe?this._stateBeforeNumericEntity(e):this._state===se?this._stateInNamedEntity(e):this._state===ae?this._stateInNumericEntity(e):this._state===le?this._stateInHexEntity(e):this._cbs.onerror(Error("unknown _state"),this._state),this._index++}this._cleanup()},me.prototype.pause=function(){this._running=!1},me.prototype.resume=function(){this._running=!0,this._index<this._buffer.length&&this._parse(),this._ended&&this._finish()},me.prototype.end=function(e){this._ended&&this._cbs.onerror(Error(".end() after done!")),e&&this.write(e),this._ended=!0,this._running&&this._finish()},me.prototype._finish=function(){this._sectionStart<this._index&&this._handleTrailingData(),this._cbs.onend()},me.prototype._handleTrailingData=function(){var e=this._buffer.substr(this._sectionStart);this._state===D||this._state===M||this._state===L?this._cbs.oncdata(e):this._state===k||this._state===C||this._state===A?this._cbs.oncomment(e):this._state!==se||this._xmlMode?this._state!==ae||this._xmlMode?this._state!==le||this._xmlMode?this._state!==u&&this._state!==g&&this._state!==y&&this._state!==v&&this._state!==m&&this._state!==x&&this._state!==b&&this._state!==E&&this._state!==h&&this._cbs.ontext(e):(this._decodeNumericEntity(3,16),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._decodeNumericEntity(2,10),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._parseLegacyEntity(),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData()))},me.prototype.reset=function(){me.call(this,{xmlMode:this._xmlMode,decodeEntities:this._decodeEntities},this._cbs)},me.prototype.getAbsoluteIndex=function(){return this._bufferOffset+this._index},me.prototype._getSection=function(){return this._buffer.substring(this._sectionStart,this._index)},me.prototype._emitToken=function(e){this._cbs[e](this._getSection()),this._sectionStart=-1},me.prototype._emitPartial=function(e){this._baseState!==l?this._cbs.onattribdata(e):this._cbs.ontext(e)}},{"entities/lib/decode_codepoint.js":410,"entities/maps/entities.json":412,"entities/maps/legacy.json":413,"entities/maps/xml.json":414}],421:[function(e,t,n){t.exports=a;var r=e("./Parser.js"),i=e("readable-stream").Writable,o=e("string_decoder").StringDecoder,s=e("buffer").Buffer;function a(e,t){var n=this._parser=new r(e,t),s=this._decoder=new o;i.call(this,{decodeStrings:!1}),this.once("finish",(function(){n.end(s.end())}))}e("inherits")(a,i),a.prototype._write=function(e,t,n){e instanceof s&&(e=this._decoder.write(e)),this._parser.write(e),n()}},{"./Parser.js":417,buffer:226,inherits:247,"readable-stream":225,string_decoder:428}],422:[function(e,t,n){var r=e("./Parser.js"),i=e("domhandler");function o(e,n){return delete t.exports[e],t.exports[e]=n,n}t.exports={Parser:r,Tokenizer:e("./Tokenizer.js"),ElementType:e("domelementtype"),DomHandler:i,get FeedHandler(){return o("FeedHandler",e("./FeedHandler.js"))},get Stream(){return o("Stream",e("./Stream.js"))},get WritableStream(){return o("WritableStream",e("./WritableStream.js"))},get ProxyHandler(){return o("ProxyHandler",e("./ProxyHandler.js"))},get DomUtils(){return o("DomUtils",e("domutils"))},get CollectingHandler(){return o("CollectingHandler",e("./CollectingHandler.js"))},DefaultHandler:i,get RssHandler(){return o("RssHandler",this.FeedHandler)},parseDOM:function(e,t){var n=new i(t);return new r(n,t).end(e),n.dom},parseFeed:function(e,n){var i=new t.exports.FeedHandler(n);return new r(i,n).end(e),i.dom},createDomStream:function(e,t,n){var o=new i(e,t,n);return new r(o,t)},EVENTS:{attribute:2,cdatastart:0,cdataend:0,text:1,processinginstruction:2,comment:1,commentend:0,closetag:1,opentag:2,opentagname:1,error:1,end:0}}},{"./CollectingHandler.js":415,"./FeedHandler.js":416,"./Parser.js":417,"./ProxyHandler.js":418,"./Stream.js":419,"./Tokenizer.js":420,"./WritableStream.js":421,domelementtype:399,domhandler:400,domutils:403}],423:[function(e,t,n){"use strict";var r,i,o,s;if("object"==typeof performance&&"function"==typeof performance.now){var a=performance;n.unstable_now=function(){return a.now()}}else{var l=Date,c=l.now();n.unstable_now=function(){return l.now()-c}}if("undefined"==typeof window||"function"!=typeof MessageChannel){var u=null,d=null,p=function(){if(null!==u)try{var e=n.unstable_now();u(!0,e),u=null}catch(e){throw setTimeout(p,0),e}};r=function(e){null!==u?setTimeout(r,0,e):(u=e,setTimeout(p,0))},i=function(e,t){d=setTimeout(e,t)},o=function(){clearTimeout(d)},n.unstable_shouldYield=function(){return!1},s=n.unstable_forceFrameRate=function(){}}else{var h=window.setTimeout,f=window.clearTimeout;if("undefined"!=typeof console){var g=window.cancelAnimationFrame;"function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!=typeof g&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var m=!1,v=null,y=-1,b=5,x=0;n.unstable_shouldYield=function(){return n.unstable_now()>=x},s=function(){},n.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):b=0<e?Math.floor(1e3/e):5};var E=new MessageChannel,_=E.port2;E.port1.onmessage=function(){if(null!==v){var e=n.unstable_now();x=e+b;try{v(!0,e)?_.postMessage(null):(m=!1,v=null)}catch(e){throw _.postMessage(null),e}}else m=!1},r=function(e){v=e,m||(m=!0,_.postMessage(null))},i=function(e,t){y=h((function(){e(n.unstable_now())}),t)},o=function(){f(y),y=-1}}function w(e,t){var n=e.length;e.push(t);e:for(;;){var r=n-1>>>1,i=e[r];if(!(void 0!==i&&0<k(i,t)))break e;e[r]=t,e[n]=i,n=r}}function S(e){return void 0===(e=e[0])?null:e}function T(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length;r<i;){var o=2*(r+1)-1,s=e[o],a=o+1,l=e[a];if(void 0!==s&&0>k(s,n))void 0!==l&&0>k(l,s)?(e[r]=l,e[a]=n,r=a):(e[r]=s,e[o]=n,r=o);else{if(!(void 0!==l&&0>k(l,n)))break e;e[r]=l,e[a]=n,r=a}}}return t}return null}function k(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var C=[],A=[],j=1,I=null,O=3,N=!1,R=!1,P=!1;function D(e){for(var t=S(A);null!==t;){if(null===t.callback)T(A);else{if(!(t.startTime<=e))break;T(A),t.sortIndex=t.expirationTime,w(C,t)}t=S(A)}}function M(e){if(P=!1,D(e),!R)if(null!==S(C))R=!0,r(L);else{var t=S(A);null!==t&&i(M,t.startTime-e)}}function L(e,t){R=!1,P&&(P=!1,o()),N=!0;var r=O;try{for(D(t),I=S(C);null!==I&&(!(I.expirationTime>t)||e&&!n.unstable_shouldYield());){var s=I.callback;if("function"==typeof s){I.callback=null,O=I.priorityLevel;var a=s(I.expirationTime<=t);t=n.unstable_now(),"function"==typeof a?I.callback=a:I===S(C)&&T(C),D(t)}else T(C);I=S(C)}if(null!==I)var l=!0;else{var c=S(A);null!==c&&i(M,c.startTime-t),l=!1}return l}finally{I=null,O=r,N=!1}}var B=s;n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(e){e.callback=null},n.unstable_continueExecution=function(){R||N||(R=!0,r(L))},n.unstable_getCurrentPriorityLevel=function(){return O},n.unstable_getFirstCallbackNode=function(){return S(C)},n.unstable_next=function(e){switch(O){case 1:case 2:case 3:var t=3;break;default:t=O}var n=O;O=t;try{return e()}finally{O=n}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=B,n.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=O;O=e;try{return t()}finally{O=n}},n.unstable_scheduleCallback=function(e,t,s){var a=n.unstable_now();switch(s="object"==typeof s&&null!==s&&"number"==typeof(s=s.delay)&&0<s?a+s:a,e){case 1:var l=-1;break;case 2:l=250;break;case 5:l=1073741823;break;case 4:l=1e4;break;default:l=5e3}return e={id:j++,callback:t,priorityLevel:e,startTime:s,expirationTime:l=s+l,sortIndex:-1},s>a?(e.sortIndex=s,w(A,e),null===S(C)&&e===S(A)&&(P?o():P=!0,i(M,s-a))):(e.sortIndex=l,w(C,e),R||N||(R=!0,r(L))),e},n.unstable_wrapCallback=function(e){var t=O;return function(){var n=O;O=t;try{return e.apply(this,arguments)}finally{O=n}}}},{}],424:[function(e,t,n){"use strict";t.exports=e("./cjs/scheduler.production.min.js")},{"./cjs/scheduler.production.min.js":423}],425:[function(e,t,n){!function(e){Date.now=Date.now||function(){return(new Date).getTime()};var t={extend:function(){arguments[0]=arguments[0]||{};for(var e=1;e<arguments.length;e++)for(var n in arguments[e])arguments[e].hasOwnProperty(n)&&("object"==typeof arguments[e][n]?arguments[e][n]instanceof Array?arguments[0][n]=arguments[e][n]:arguments[0][n]=t.extend(arguments[0][n],arguments[e][n]):arguments[0][n]=arguments[e][n]);return arguments[0]},binarySearch:function(e,t){for(var n=0,r=e.length;n<r;){var i=n+r>>1;t<e[i][0]?r=i:n=i+1}return n}};function n(e){this.options=t.extend({},n.defaultOptions,e),this.disabled=!1,this.clear()}function r(e){this.options=t.extend({},r.defaultChartOptions,e),this.seriesSet=[],this.currentValueRange=1,this.currentVisMinValue=0,this.lastRenderTimeMillis=0,this.lastChartTimestamp=0,this.mousemove=this.mousemove.bind(this),this.mouseout=this.mouseout.bind(this)}n.defaultOptions={resetBoundsInterval:3e3,resetBounds:!0},n.prototype.clear=function(){this.data=[],this.maxValue=Number.NaN,this.minValue=Number.NaN},n.prototype.resetBounds=function(){if(this.data.length){this.maxValue=this.data[0][1],this.minValue=this.data[0][1];for(var e=1;e<this.data.length;e++){var t=this.data[e][1];t>this.maxValue&&(this.maxValue=t),t<this.minValue&&(this.minValue=t)}}else this.maxValue=Number.NaN,this.minValue=Number.NaN},n.prototype.append=function(e,t,n){for(var r=this.data.length-1;r>=0&&this.data[r][0]>e;)r--;-1===r?this.data.splice(0,0,[e,t]):this.data.length>0&&this.data[r][0]===e?n?(this.data[r][1]+=t,t=this.data[r][1]):this.data[r][1]=t:r<this.data.length-1?this.data.splice(r+1,0,[e,t]):this.data.push([e,t]),this.maxValue=isNaN(this.maxValue)?t:Math.max(this.maxValue,t),this.minValue=isNaN(this.minValue)?t:Math.min(this.minValue,t)},n.prototype.dropOldData=function(e,t){for(var n=0;this.data.length-n>=t&&this.data[n+1][0]<e;)n++;0!==n&&this.data.splice(0,n)},r.tooltipFormatter=function(e,t){for(var n=[(this.options.timestampFormatter||r.timeFormatter)(new Date(e))],i=0;i<t.length;++i)n.push('<span style="color:'+t[i].series.options.strokeStyle+'">'+this.options.yMaxFormatter(t[i].value,this.options.labels.precision)+"</span>");return n.join("<br>")},r.defaultChartOptions={millisPerPixel:20,enableDpiScaling:!0,yMinFormatter:function(e,t){return parseFloat(e).toFixed(t)},yMaxFormatter:function(e,t){return parseFloat(e).toFixed(t)},yIntermediateFormatter:function(e,t){return parseFloat(e).toFixed(t)},maxValueScale:1,minValueScale:1,interpolation:"bezier",scaleSmoothing:.125,maxDataSetLength:2,scrollBackwards:!1,displayDataFromPercentile:1,grid:{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:1,sharpLines:!1,millisPerLine:1e3,verticalSections:2,borderVisible:!0},labels:{fillStyle:"#ffffff",disabled:!1,fontSize:10,fontFamily:"monospace",precision:2,showIntermediateLabels:!1,intermediateLabelSameAxis:!0},horizontalLines:[],tooltip:!1,tooltipLine:{lineWidth:1,strokeStyle:"#BBBBBB"},tooltipFormatter:r.tooltipFormatter,nonRealtimeData:!1,responsive:!1,limitFPS:0},r.AnimateCompatibility={requestAnimationFrame:function(e,t){return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout((function(){e(Date.now())}),16)}).call(window,e,t)},cancelAnimationFrame:function(e){return(window.cancelAnimationFrame||function(e){clearTimeout(e)}).call(window,e)}},r.defaultSeriesPresentationOptions={lineWidth:1,strokeStyle:"#ffffff"},r.prototype.addTimeSeries=function(e,n){this.seriesSet.push({timeSeries:e,options:t.extend({},r.defaultSeriesPresentationOptions,n)}),e.options.resetBounds&&e.options.resetBoundsInterval>0&&(e.resetBoundsTimerId=setInterval((function(){e.resetBounds()}),e.options.resetBoundsInterval))},r.prototype.removeTimeSeries=function(e){for(var t=this.seriesSet.length,n=0;n<t;n++)if(this.seriesSet[n].timeSeries===e){this.seriesSet.splice(n,1);break}e.resetBoundsTimerId&&clearInterval(e.resetBoundsTimerId)},r.prototype.getTimeSeriesOptions=function(e){for(var t=this.seriesSet.length,n=0;n<t;n++)if(this.seriesSet[n].timeSeries===e)return this.seriesSet[n].options},r.prototype.bringToFront=function(e){for(var t=this.seriesSet.length,n=0;n<t;n++)if(this.seriesSet[n].timeSeries===e){var r=this.seriesSet.splice(n,1);this.seriesSet.push(r[0]);break}},r.prototype.streamTo=function(e,t){this.canvas=e,this.delay=t,this.start()},r.prototype.getTooltipEl=function(){return this.tooltipEl||(this.tooltipEl=document.createElement("div"),this.tooltipEl.className="smoothie-chart-tooltip",this.tooltipEl.style.position="absolute",this.tooltipEl.style.display="none",document.body.appendChild(this.tooltipEl)),this.tooltipEl},r.prototype.updateTooltip=function(){var e=this.getTooltipEl();if(this.mouseover&&this.options.tooltip){for(var n=this.lastChartTimestamp,r=this.options.scrollBackwards?n-this.mouseX*this.options.millisPerPixel:n-(this.canvas.offsetWidth-this.mouseX)*this.options.millisPerPixel,i=[],o=0;o<this.seriesSet.length;o++){var s=this.seriesSet[o].timeSeries;if(!s.disabled){var a=t.binarySearch(s.data,r);a>0&&a<s.data.length&&i.push({series:this.seriesSet[o],index:a,value:s.data[a][1]})}}i.length?(e.innerHTML=this.options.tooltipFormatter.call(this,r,i),e.style.display="block"):e.style.display="none"}else e.style.display="none"},r.prototype.mousemove=function(e){this.mouseover=!0,this.mouseX=e.offsetX,this.mouseY=e.offsetY,this.mousePageX=e.pageX,this.mousePageY=e.pageY;var t=this.getTooltipEl();t.style.top=Math.round(this.mousePageY)+"px",t.style.left=Math.round(this.mousePageX)+"px",this.updateTooltip()},r.prototype.mouseout=function(){this.mouseover=!1,this.mouseX=this.mouseY=-1,this.tooltipEl&&(this.tooltipEl.style.display="none")},r.prototype.resize=function(){var e,t,n=this.options.enableDpiScaling&&window?window.devicePixelRatio:1;this.options.responsive?(e=this.canvas.offsetWidth,t=this.canvas.offsetHeight,e!==this.lastWidth&&(this.lastWidth=e,this.canvas.setAttribute("width",Math.floor(e*n).toString()),this.canvas.getContext("2d").scale(n,n)),t!==this.lastHeight&&(this.lastHeight=t,this.canvas.setAttribute("height",Math.floor(t*n).toString()),this.canvas.getContext("2d").scale(n,n))):1!==n&&(e=parseInt(this.canvas.getAttribute("width")),t=parseInt(this.canvas.getAttribute("height")),this.originalWidth&&Math.floor(this.originalWidth*n)===e||(this.originalWidth=e,this.canvas.setAttribute("width",Math.floor(e*n).toString()),this.canvas.style.width=e+"px",this.canvas.getContext("2d").scale(n,n)),this.originalHeight&&Math.floor(this.originalHeight*n)===t||(this.originalHeight=t,this.canvas.setAttribute("height",Math.floor(t*n).toString()),this.canvas.style.height=t+"px",this.canvas.getContext("2d").scale(n,n)))},r.prototype.start=function(){if(!this.frame){this.canvas.addEventListener("mousemove",this.mousemove),this.canvas.addEventListener("mouseout",this.mouseout);var e=function(){this.frame=r.AnimateCompatibility.requestAnimationFrame(function(){if(this.options.nonRealtimeData){var t=new Date(0),n=this.seriesSet.reduce(function(e,t){var n=t.timeSeries.data,r=Math.round(this.options.displayDataFromPercentile*n.length)-1;if(r=(r=r>=0?r:0)<=n.length-1?r:n.length-1,n&&n.length>0){var i=n[r][0];e=e>i?e:i}return e}.bind(this),t);this.render(this.canvas,n>t?n:null)}else this.render();e()}.bind(this))}.bind(this);e()}},r.prototype.stop=function(){this.frame&&(r.AnimateCompatibility.cancelAnimationFrame(this.frame),delete this.frame,this.canvas.removeEventListener("mousemove",this.mousemove),this.canvas.removeEventListener("mouseout",this.mouseout))},r.prototype.updateValueRange=function(){for(var e=this.options,t=Number.NaN,n=Number.NaN,r=0;r<this.seriesSet.length;r++){var i=this.seriesSet[r].timeSeries;i.disabled||(isNaN(i.maxValue)||(t=isNaN(t)?i.maxValue:Math.max(t,i.maxValue)),isNaN(i.minValue)||(n=isNaN(n)?i.minValue:Math.min(n,i.minValue)))}if(null!=e.maxValue?t=e.maxValue:t*=e.maxValueScale,null!=e.minValue?n=e.minValue:n-=Math.abs(n*e.minValueScale-n),this.options.yRangeFunction){var o=this.options.yRangeFunction({min:n,max:t});n=o.min,t=o.max}if(!isNaN(t)&&!isNaN(n)){var s=t-n-this.currentValueRange,a=n-this.currentVisMinValue;this.isAnimatingScale=Math.abs(s)>.1||Math.abs(a)>.1,this.currentValueRange+=e.scaleSmoothing*s,this.currentVisMinValue+=e.scaleSmoothing*a}this.valueRange={min:n,max:t}},r.prototype.render=function(e,t){var n=Date.now();if(!(this.options.limitFPS>0&&n-this.lastRenderTimeMillis<1e3/this.options.limitFPS)){if(!this.isAnimatingScale){var r=Math.min(1e3/6,this.options.millisPerPixel);if(n-this.lastRenderTimeMillis<r)return}this.resize(),this.updateTooltip(),this.lastRenderTimeMillis=n,e=e||this.canvas,t=t||n-(this.delay||0),t-=t%this.options.millisPerPixel,this.lastChartTimestamp=t;var i=e.getContext("2d"),o=this.options,s={top:0,left:0,width:e.clientWidth,height:e.clientHeight},a=t-s.width*o.millisPerPixel,l=function(e){var t=e-this.currentVisMinValue;return 0===this.currentValueRange?s.height:s.height-Math.round(t/this.currentValueRange*s.height)}.bind(this),c=function(e){return o.scrollBackwards?Math.round((t-e)/o.millisPerPixel):Math.round(s.width-(t-e)/o.millisPerPixel)};if(this.updateValueRange(),i.font=o.labels.fontSize+"px "+o.labels.fontFamily,i.save(),i.translate(s.left,s.top),i.beginPath(),i.rect(0,0,s.width,s.height),i.clip(),i.save(),i.fillStyle=o.grid.fillStyle,i.clearRect(0,0,s.width,s.height),i.fillRect(0,0,s.width,s.height),i.restore(),i.save(),i.lineWidth=o.grid.lineWidth,i.strokeStyle=o.grid.strokeStyle,o.grid.millisPerLine>0){i.beginPath();for(var u=t-t%o.grid.millisPerLine;u>=a;u-=o.grid.millisPerLine){var d=c(u);o.grid.sharpLines&&(d-=.5),i.moveTo(d,0),i.lineTo(d,s.height)}i.stroke(),i.closePath()}for(var p=1;p<o.grid.verticalSections;p++){var h=Math.round(p*s.height/o.grid.verticalSections);o.grid.sharpLines&&(h-=.5),i.beginPath(),i.moveTo(0,h),i.lineTo(s.width,h),i.stroke(),i.closePath()}if(o.grid.borderVisible&&(i.beginPath(),i.strokeRect(0,0,s.width,s.height),i.closePath()),i.restore(),o.horizontalLines&&o.horizontalLines.length)for(var f=0;f<o.horizontalLines.length;f++){var g=o.horizontalLines[f],m=Math.round(l(g.value))-.5;i.strokeStyle=g.color||"#ffffff",i.lineWidth=g.lineWidth||1,i.beginPath(),i.moveTo(0,m),i.lineTo(s.width,m),i.stroke(),i.closePath()}for(var v=0;v<this.seriesSet.length;v++){i.save();var y=this.seriesSet[v].timeSeries;if(!y.disabled){var b=y.data,x=this.seriesSet[v].options;y.dropOldData(a,o.maxDataSetLength),i.lineWidth=x.lineWidth,i.strokeStyle=x.strokeStyle,i.beginPath();for(var E=0,_=0,w=0,S=0;S<b.length&&1!==b.length;S++){var T=c(b[S][0]),k=l(b[S][1]);if(0===S)E=T,i.moveTo(T,k);else switch(o.interpolation){case"linear":case"line":i.lineTo(T,k);break;case"bezier":default:i.bezierCurveTo(Math.round((_+T)/2),w,Math.round(_+T)/2,k,T,k);break;case"step":i.lineTo(T,w),i.lineTo(T,k)}_=T,w=k}b.length>1&&(x.fillStyle&&(i.lineTo(s.width+x.lineWidth+1,w),i.lineTo(s.width+x.lineWidth+1,s.height+x.lineWidth+1),i.lineTo(E,s.height+x.lineWidth),i.fillStyle=x.fillStyle,i.fill()),x.strokeStyle&&"none"!==x.strokeStyle&&i.stroke(),i.closePath()),i.restore()}}if(o.tooltip&&this.mouseX>=0&&(i.lineWidth=o.tooltipLine.lineWidth,i.strokeStyle=o.tooltipLine.strokeStyle,i.beginPath(),i.moveTo(this.mouseX,0),i.lineTo(this.mouseX,s.height),i.closePath(),i.stroke(),this.updateTooltip()),!o.labels.disabled&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)){var C=o.yMaxFormatter(this.valueRange.max,o.labels.precision),A=o.yMinFormatter(this.valueRange.min,o.labels.precision),j=o.scrollBackwards?0:s.width-i.measureText(C).width-2,I=o.scrollBackwards?0:s.width-i.measureText(A).width-2;i.fillStyle=o.labels.fillStyle,i.fillText(C,j,o.labels.fontSize),i.fillText(A,I,s.height-2)}if(o.labels.showIntermediateLabels&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)&&o.grid.verticalSections>0){var O=(this.valueRange.max-this.valueRange.min)/o.grid.verticalSections,N=s.height/o.grid.verticalSections;for(p=1;p<o.grid.verticalSections;p++){h=s.height-Math.round(p*N),o.grid.sharpLines&&(h-=.5);var R=o.yIntermediateFormatter(this.valueRange.min+p*O,o.labels.precision);intermediateLabelPos=o.labels.intermediateLabelSameAxis?o.scrollBackwards?0:s.width-i.measureText(R).width-2:o.scrollBackwards?s.width-i.measureText(R).width-2:0,i.fillText(R,intermediateLabelPos,h-o.grid.lineWidth)}}if(o.timestampFormatter&&o.grid.millisPerLine>0){var P=o.scrollBackwards?i.measureText(A).width:s.width-i.measureText(A).width+4;for(u=t-t%o.grid.millisPerLine;u>=a;u-=o.grid.millisPerLine)if(d=c(u),!o.scrollBackwards&&d<P||o.scrollBackwards&&d>P){var D=new Date(u),M=o.timestampFormatter(D),L=i.measureText(M).width;P=o.scrollBackwards?d+L+2:d-L-2,i.fillStyle=o.labels.fillStyle,o.scrollBackwards?i.fillText(M,d,s.height-2):i.fillText(M,d-L,s.height-2)}}i.restore()}},r.timeFormatter=function(e){function t(e){return(e<10?"0":"")+e}return t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())},e.TimeSeries=n,e.SmoothieChart=r}(void 0===n?this:n)},{}],426:[function(e,t,n){!function(e){if("object"==typeof n)t.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var r;try{r=window}catch(e){r=self}r.SparkMD5=e()}}((function(e){"use strict";var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(e,t){var n=e[0],r=e[1],i=e[2],o=e[3];r=((r+=((i=((i+=((o=((o+=((n=((n+=(r&i|~r&o)+t[0]-680876936|0)<<7|n>>>25)+r|0)&r|~n&i)+t[1]-389564586|0)<<12|o>>>20)+n|0)&n|~o&r)+t[2]+606105819|0)<<17|i>>>15)+o|0)&o|~i&n)+t[3]-1044525330|0)<<22|r>>>10)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r&i|~r&o)+t[4]-176418897|0)<<7|n>>>25)+r|0)&r|~n&i)+t[5]+1200080426|0)<<12|o>>>20)+n|0)&n|~o&r)+t[6]-1473231341|0)<<17|i>>>15)+o|0)&o|~i&n)+t[7]-45705983|0)<<22|r>>>10)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r&i|~r&o)+t[8]+1770035416|0)<<7|n>>>25)+r|0)&r|~n&i)+t[9]-1958414417|0)<<12|o>>>20)+n|0)&n|~o&r)+t[10]-42063|0)<<17|i>>>15)+o|0)&o|~i&n)+t[11]-1990404162|0)<<22|r>>>10)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r&i|~r&o)+t[12]+1804603682|0)<<7|n>>>25)+r|0)&r|~n&i)+t[13]-40341101|0)<<12|o>>>20)+n|0)&n|~o&r)+t[14]-1502002290|0)<<17|i>>>15)+o|0)&o|~i&n)+t[15]+1236535329|0)<<22|r>>>10)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r&o|i&~o)+t[1]-165796510|0)<<5|n>>>27)+r|0)&i|r&~i)+t[6]-1069501632|0)<<9|o>>>23)+n|0)&r|n&~r)+t[11]+643717713|0)<<14|i>>>18)+o|0)&n|o&~n)+t[0]-373897302|0)<<20|r>>>12)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r&o|i&~o)+t[5]-701558691|0)<<5|n>>>27)+r|0)&i|r&~i)+t[10]+38016083|0)<<9|o>>>23)+n|0)&r|n&~r)+t[15]-660478335|0)<<14|i>>>18)+o|0)&n|o&~n)+t[4]-405537848|0)<<20|r>>>12)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r&o|i&~o)+t[9]+568446438|0)<<5|n>>>27)+r|0)&i|r&~i)+t[14]-1019803690|0)<<9|o>>>23)+n|0)&r|n&~r)+t[3]-187363961|0)<<14|i>>>18)+o|0)&n|o&~n)+t[8]+1163531501|0)<<20|r>>>12)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r&o|i&~o)+t[13]-1444681467|0)<<5|n>>>27)+r|0)&i|r&~i)+t[2]-51403784|0)<<9|o>>>23)+n|0)&r|n&~r)+t[7]+1735328473|0)<<14|i>>>18)+o|0)&n|o&~n)+t[12]-1926607734|0)<<20|r>>>12)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r^i^o)+t[5]-378558|0)<<4|n>>>28)+r|0)^r^i)+t[8]-2022574463|0)<<11|o>>>21)+n|0)^n^r)+t[11]+1839030562|0)<<16|i>>>16)+o|0)^o^n)+t[14]-35309556|0)<<23|r>>>9)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r^i^o)+t[1]-1530992060|0)<<4|n>>>28)+r|0)^r^i)+t[4]+1272893353|0)<<11|o>>>21)+n|0)^n^r)+t[7]-155497632|0)<<16|i>>>16)+o|0)^o^n)+t[10]-1094730640|0)<<23|r>>>9)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r^i^o)+t[13]+681279174|0)<<4|n>>>28)+r|0)^r^i)+t[0]-358537222|0)<<11|o>>>21)+n|0)^n^r)+t[3]-722521979|0)<<16|i>>>16)+o|0)^o^n)+t[6]+76029189|0)<<23|r>>>9)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r^i^o)+t[9]-640364487|0)<<4|n>>>28)+r|0)^r^i)+t[12]-421815835|0)<<11|o>>>21)+n|0)^n^r)+t[15]+530742520|0)<<16|i>>>16)+o|0)^o^n)+t[2]-995338651|0)<<23|r>>>9)+i|0,r=((r+=((o=((o+=(r^((n=((n+=(i^(r|~o))+t[0]-198630844|0)<<6|n>>>26)+r|0)|~i))+t[7]+1126891415|0)<<10|o>>>22)+n|0)^((i=((i+=(n^(o|~r))+t[14]-1416354905|0)<<15|i>>>17)+o|0)|~n))+t[5]-57434055|0)<<21|r>>>11)+i|0,r=((r+=((o=((o+=(r^((n=((n+=(i^(r|~o))+t[12]+1700485571|0)<<6|n>>>26)+r|0)|~i))+t[3]-1894986606|0)<<10|o>>>22)+n|0)^((i=((i+=(n^(o|~r))+t[10]-1051523|0)<<15|i>>>17)+o|0)|~n))+t[1]-2054922799|0)<<21|r>>>11)+i|0,r=((r+=((o=((o+=(r^((n=((n+=(i^(r|~o))+t[8]+1873313359|0)<<6|n>>>26)+r|0)|~i))+t[15]-30611744|0)<<10|o>>>22)+n|0)^((i=((i+=(n^(o|~r))+t[6]-1560198380|0)<<15|i>>>17)+o|0)|~n))+t[13]+1309151649|0)<<21|r>>>11)+i|0,r=((r+=((o=((o+=(r^((n=((n+=(i^(r|~o))+t[4]-145523070|0)<<6|n>>>26)+r|0)|~i))+t[11]-1120210379|0)<<10|o>>>22)+n|0)^((i=((i+=(n^(o|~r))+t[2]+718787259|0)<<15|i>>>17)+o|0)|~n))+t[9]-343485551|0)<<21|r>>>11)+i|0,e[0]=n+e[0]|0,e[1]=r+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}function r(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function i(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n}function o(e){var t,i,o,s,a,l,c=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)n(u,r(e.substring(t-64,t)));for(i=(e=e.substring(t-64)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<i;t+=1)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(n(u,o),t=0;t<16;t+=1)o[t]=0;return s=(s=8*c).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),l=parseInt(s[1],16)||0,o[14]=a,o[15]=l,n(u,o),u}function s(e){var n,r="";for(n=0;n<4;n+=1)r+=t[e>>8*n+4&15]+t[e>>8*n&15];return r}function a(e){var t;for(t=0;t<e.length;t+=1)e[t]=s(e[t]);return e.join("")}function l(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function c(e){var t,n=[],r=e.length;for(t=0;t<r-1;t+=2)n.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,n)}function u(){this.reset()}return a(o("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(n,r){var i,o,s,a,l=this.byteLength,c=t(n,l),u=l;return r!==e&&(u=t(r,l)),c>u?new ArrayBuffer(0):(i=u-c,o=new ArrayBuffer(i),s=new Uint8Array(o),a=new Uint8Array(this,c,i),s.set(a),o)}}(),u.prototype.append=function(e){return this.appendBinary(l(e)),this},u.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,i=this._buff.length;for(t=64;t<=i;t+=64)n(this._hash,r(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},u.prototype.end=function(e){var t,n,r=this._buff,i=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=r.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),n=a(this._hash),e&&(n=c(n)),this.reset(),n},u.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},u.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},u.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},u.prototype._finish=function(e,t){var r,i,o,s=t;if(e[s>>2]|=128<<(s%4<<3),s>55)for(n(this._hash,e),s=0;s<16;s+=1)e[s]=0;r=(r=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(r[2],16),o=parseInt(r[1],16)||0,e[14]=i,e[15]=o,n(this._hash,e)},u.hash=function(e,t){return u.hashBinary(l(e),t)},u.hashBinary=function(e,t){var n=a(o(e));return t?c(n):n},u.ArrayBuffer=function(){this.reset()},u.ArrayBuffer.prototype.append=function(e){var t,r,o,s,a=(r=this._buff.buffer,o=e,!0,(s=new Uint8Array(r.byteLength+o.byteLength)).set(new Uint8Array(r)),s.set(new Uint8Array(o),r.byteLength),s),l=a.length;for(this._length+=e.byteLength,t=64;t<=l;t+=64)n(this._hash,i(a.subarray(t-64,t)));return this._buff=t-64<l?new Uint8Array(a.buffer.slice(t-64)):new Uint8Array(0),this},u.ArrayBuffer.prototype.end=function(e){var t,n,r=this._buff,i=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=r[t]<<(t%4<<3);return this._finish(o,i),n=a(this._hash),e&&(n=c(n)),this.reset(),n},u.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.ArrayBuffer.prototype.getState=function(){var e,t=u.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},u.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var n,r=e.length,i=new ArrayBuffer(r),o=new Uint8Array(i);for(n=0;n<r;n+=1)o[n]=e.charCodeAt(n);return o}(e.buff),u.prototype.setState.call(this,e)},u.ArrayBuffer.prototype.destroy=u.prototype.destroy,u.ArrayBuffer.prototype._finish=u.prototype._finish,u.ArrayBuffer.hash=function(e,t){var r=a(function(e){var t,r,o,s,a,l,c=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)n(u,i(e.subarray(t-64,t)));for(r=(e=t-64<c?e.subarray(t-64):new Uint8Array(0)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)o[t>>2]|=e[t]<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(n(u,o),t=0;t<16;t+=1)o[t]=0;return s=(s=8*c).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),l=parseInt(s[1],16)||0,o[14]=a,o[15]=l,n(u,o),u}(new Uint8Array(e)));return t?c(r):r},u}))},{}],427:[function(e,t,n){t.exports=i;var r=e("events").EventEmitter;function i(){r.call(this)}e("inherits")(i,r),i.Readable=e("readable-stream/readable.js"),i.Writable=e("readable-stream/writable.js"),i.Duplex=e("readable-stream/duplex.js"),i.Transform=e("readable-stream/transform.js"),i.PassThrough=e("readable-stream/passthrough.js"),i.Stream=i,i.prototype.pipe=function(e,t){var n=this;function i(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function o(){n.readable&&n.resume&&n.resume()}n.on("data",i),e.on("drain",o),e._isStdio||t&&!1===t.end||(n.on("end",a),n.on("close",l));var s=!1;function a(){s||(s=!0,e.end())}function l(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(u(),0===r.listenerCount(this,"error"))throw e}function u(){n.removeListener("data",i),e.removeListener("drain",o),n.removeListener("end",a),n.removeListener("close",l),n.removeListener("error",c),e.removeListener("error",c),n.removeListener("end",u),n.removeListener("close",u),e.removeListener("close",u)}return n.on("error",c),e.on("error",c),n.on("end",u),n.on("close",u),e.on("close",u),e.emit("pipe",n),e}},{events:241,inherits:247,"readable-stream/duplex.js":368,"readable-stream/passthrough.js":380,"readable-stream/readable.js":381,"readable-stream/transform.js":382,"readable-stream/writable.js":383}],428:[function(e,t,n){"use strict";var r=e("safe-buffer").Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=u,this.end=d,t=3;break;default:return this.write=p,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function u(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function p(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}n.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},o.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=s(t[r]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--r<n||-2===i?0:(i=s(t[r]))>=0?(i>0&&(e.lastNeed=i-2),i):--r<n||-2===i?0:(i=s(t[r]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":386}],429:[function(e,t,n){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var i=r(e("ltgt")),o=r(e("events")),s=r(e("level-codec")),a=r(e("readable-stream")),l=r(e("inherits"));function c(e){return function(e){return"function"==typeof e}(e.prefix)?e.prefix():e}function u(){Error.call(this)}l(u,Error),u.prototype.name="NotFoundError";var d=o.EventEmitter,p=new u,h=function(e,t,n,r){var i=new d;function o(e){var t,n={};if(r)for(t in r)void 0!==r[t]&&(n[t]=r[t]);if(e)for(t in e)void 0!==e[t]&&(n[t]=e[t]);return n}return i.sublevels={},i.options=r,i.version="6.5.4",i.methods={},t=t||[],i.put=function(n,r,s,a){"function"==typeof s&&(a=s,s={}),e.apply([{key:n,value:r,prefix:t.slice(),type:"put"}],o(s),(function(e){if(e)return a(e);i.emit("put",n,r),a(null)}))},i.prefix=function(){return t.slice()},i.batch=function(n,r,s){"function"==typeof r&&(s=r,r={}),n=n.map((function(e){return{key:e.key,value:e.value,prefix:e.prefix||t,keyEncoding:e.keyEncoding,valueEncoding:e.valueEncoding,type:e.type}})),e.apply(n,o(r),(function(e){if(e)return s(e);i.emit("batch",n),s(null)}))},i.get=function(n,r,i){"function"==typeof r&&(i=r,r={}),e.get(n,t,o(r),(function(e,t){e?i(p):i(null,t)}))},i.sublevel=function(r,s){return i.sublevels[r]=i.sublevels[r]||h(e,t.concat(r),n,o(s))},i.readStream=i.createReadStream=function(r){var i;(r=o(r)).prefix=t;var s=e.iterator(r);return(i=n(r,e.createDecoder(r))).setIterator(s),i},i.close=function(t){e.close(t)},i.isOpen=e.isOpen,i.isClosed=e.isClosed,i},f=a.Readable;function g(e,t){if(!(this instanceof g))return new g(e,t);f.call(this,{objectMode:!0,highWaterMark:e.highWaterMark}),this._waiting=!1,this._options=e,this._makeData=t}l(g,f),g.prototype.setIterator=function(e){return this._iterator=e,this._destroyed?e.end((function(){})):this._waiting?(this._waiting=!1,this._read()):this},g.prototype._read=function(){var e=this;if(!e._destroyed)return e._iterator?void e._iterator.next((function(t,n,r){if(t||void 0===n&&void 0===r)return t||e._destroyed||e.push(null),e._cleanup(t);r=e._makeData(n,r),e._destroyed||e.push(r)})):this._waiting=!0},g.prototype._cleanup=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;e&&"iterator has ended"!==e.message&&t.emit("error",e),t._iterator?t._iterator.end((function(){t._iterator=null,t.emit("close")})):t.emit("close")}},g.prototype.destroy=function(){this._cleanup()};var m={encode:function(e){return""+e[0]+""+e[1]},decode:function(e){var t=e.toString(),n=t.indexOf("",1);return[t.substring(1,n),t.substring(n+1)]},lowerBound:"\0",upperBound:""},v=new s;t.exports=function(e){return h(function(e,t,n){function r(e,r,i,o){return t.encode([e,n.encodeKey(r,i,o)])}function o(e,t){return t&&t.options&&(e.keyEncoding=e.keyEncoding||t.options.keyEncoding,e.valueEncoding=e.valueEncoding||t.options.valueEncoding),e}return e.open((function(){})),{apply:function(t,i,s){i=i||{};for(var a=[],l=-1,u=t.length;++l<u;){var d=t[l];o(d,d.prefix),d.prefix=c(d.prefix),a.push({key:r(d.prefix,d.key,i,d),value:"del"!==d.type&&n.encodeValue(d.value,i,d),type:d.type})}e.db.batch(a,i,s)},get:function(t,i,o,s){return o.asBuffer=n.valueAsBuffer(o),e.db.get(r(i,t,o),o,(function(e,t){e?s(e):s(null,n.decodeValue(t,o))}))},createDecoder:function(e){return function(r,i){return{key:n.decodeKey(t.decode(r)[1],e),value:n.decodeValue(i,e)}}},isClosed:function(){return e.isClosed()},close:function(t){return e.close(t)},iterator:function(o){var s,a=function(e){var t={};for(var n in e)t[n]=e[n];return t}(o||{}),l=o.prefix||[];return i.toLtgt(o,a,(function(e){return r(l,e,a,{})}),t.lowerBound,t.upperBound),a.prefix=null,a.keyAsBuffer=a.valueAsBuffer=!1,"number"!=typeof a.limit&&(a.limit=-1),a.keyAsBuffer=t.buffer,a.valueAsBuffer=n.valueAsBuffer(a),s=e.db.iterator(a),{next:function(e){return s.next(e)},end:function(e){s.end(e)}}}}}(e,m,v),[],g,e.options)}},{events:241,inherits:247,"level-codec":249,ltgt:272,"readable-stream":436}],430:[function(e,t,n){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],431:[function(e,t,n){(function(n){(function(){t.exports=a;var r=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t},i=e("core-util-is");i.inherits=e("inherits");var o=e("./_stream_readable"),s=e("./_stream_writable");function a(e){if(!(this instanceof a))return new a(e);o.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",l)}function l(){this.allowHalfOpen||this._writableState.ended||n.nextTick(this.end.bind(this))}i.inherits(a,o),function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}(r(s.prototype),(function(e){a.prototype[e]||(a.prototype[e]=s.prototype[e])}))}).call(this)}).call(this,e("_process"))},{"./_stream_readable":433,"./_stream_writable":435,_process:303,"core-util-is":228,inherits:247}],432:[function(e,t,n){t.exports=o;var r=e("./_stream_transform"),i=e("core-util-is");function o(e){if(!(this instanceof o))return new o(e);r.call(this,e)}i.inherits=e("inherits"),i.inherits(o,r),o.prototype._transform=function(e,t,n){n(null,e)}},{"./_stream_transform":434,"core-util-is":228,inherits:247}],433:[function(e,t,n){(function(n){(function(){t.exports=u;var r=e("isarray"),i=e("buffer").Buffer;u.ReadableState=c;var o=e("events").EventEmitter;o.listenerCount||(o.listenerCount=function(e,t){return e.listeners(t).length});var s,a=e("stream"),l=e("core-util-is");function c(t,n){var r=(t=t||{}).highWaterMark;this.highWaterMark=r||0===r?r:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!t.objectMode,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(s||(s=e("string_decoder/").StringDecoder),this.decoder=new s(t.encoding),this.encoding=t.encoding)}function u(e){if(!(this instanceof u))return new u(e);this._readableState=new c(e,this),this.readable=!0,a.call(this)}function d(e,t,r,o,s){var a=function(e,t){var n=null;return i.isBuffer(t)||"string"==typeof t||null==t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(t,r);if(a)e.emit("error",a);else if(null==r)t.reading=!1,t.ended||function(e,t){if(t.decoder&&!t.ended){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.length>0?f(e):x(e)}(e,t);else if(t.objectMode||r&&r.length>0)if(t.ended&&!s){var l=new Error("stream.push() after EOF");e.emit("error",l)}else t.endEmitted&&s?(l=new Error("stream.unshift() after end event"),e.emit("error",l)):(!t.decoder||s||o||(r=t.decoder.write(r)),t.length+=t.objectMode?1:r.length,s?t.buffer.unshift(r):(t.reading=!1,t.buffer.push(r)),t.needReadable&&f(e),function(e,t){t.readingMore||(t.readingMore=!0,n.nextTick((function(){!function(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}(e,t)})))}(e,t));else s||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}l.inherits=e("inherits"),l.inherits(u,a),u.prototype.push=function(e,t){var n=this._readableState;return"string"!=typeof e||n.objectMode||(t=t||n.defaultEncoding)!==n.encoding&&(e=new i(e,t),t=""),d(this,n,e,t,!1)},u.prototype.unshift=function(e){return d(this,this._readableState,e,"",!0)},u.prototype.setEncoding=function(t){s||(s=e("string_decoder/").StringDecoder),this._readableState.decoder=new s(t),this._readableState.encoding=t};var p=8388608;function h(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=function(e){if(e>=p)e=p;else{e--;for(var t=1;t<32;t<<=1)e|=e>>t;e++}return e}(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function f(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,t.sync?n.nextTick((function(){g(e)})):g(e))}function g(e){e.emit("readable")}function m(e){var t,n=e._readableState;function r(e,r,i){!1===e.write(t)&&n.awaitDrain++}for(n.awaitDrain=0;n.pipesCount&&null!==(t=e.read());)if(1===n.pipesCount?r(n.pipes):E(n.pipes,r),e.emit("data",t),n.awaitDrain>0)return;if(0===n.pipesCount)return n.flowing=!1,void(o.listenerCount(e,"data")>0&&y(e));n.ranOut=!0}function v(){this._readableState.ranOut&&(this._readableState.ranOut=!1,m(this))}function y(e,t){if(e._readableState.flowing)throw new Error("Cannot switch to old mode now.");var r=t||!1,i=!1;e.readable=!0,e.pipe=a.prototype.pipe,e.on=e.addListener=a.prototype.on,e.on("readable",(function(){var t;for(i=!0;!r&&null!==(t=e.read());)e.emit("data",t);null===t&&(i=!1,e._readableState.needReadable=!0)})),e.pause=function(){r=!0,this.emit("pause")},e.resume=function(){r=!1,i?n.nextTick((function(){e.emit("readable")})):this.read(0),this.emit("resume")},e.emit("readable")}function b(e,t){var n,r=t.buffer,o=t.length,s=!!t.decoder,a=!!t.objectMode;if(0===r.length)return null;if(0===o)n=null;else if(a)n=r.shift();else if(!e||e>=o)n=s?r.join(""):i.concat(r,o),r.length=0;else if(e<r[0].length)n=(d=r[0]).slice(0,e),r[0]=d.slice(e);else if(e===r[0].length)n=r.shift();else{n=s?"":new i(e);for(var l=0,c=0,u=r.length;c<u&&l<e;c++){var d=r[0],p=Math.min(e-l,d.length);s?n+=d.slice(0,p):d.copy(n,l,0,p),p<d.length?r[0]=d.slice(p):r.shift(),l+=p}}return n}function x(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");!t.endEmitted&&t.calledRead&&(t.ended=!0,n.nextTick((function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))})))}function E(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}u.prototype.read=function(e){var t=this._readableState;t.calledRead=!0;var n,r=e;if(("number"!=typeof e||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f(this),null;if(0===(e=h(e,t))&&t.ended)return n=null,t.length>0&&t.decoder&&(n=b(e,t),t.length-=n.length),0===t.length&&x(this),n;var i=t.needReadable;return t.length-e<=t.highWaterMark&&(i=!0),(t.ended||t.reading)&&(i=!1),i&&(t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),i&&!t.reading&&(e=h(r,t)),null===(n=e>0?b(e,t):null)&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),t.ended&&!t.endEmitted&&0===t.length&&x(this),n},u.prototype._read=function(e){this.emit("error",new Error("not implemented"))},u.prototype.pipe=function(e,t){var i=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=e;break;case 1:s.pipes=[s.pipes,e];break;default:s.pipes.push(e)}s.pipesCount+=1;var a=t&&!1===t.end||e===n.stdout||e===n.stderr?d:c;function l(e){e===i&&d()}function c(){e.end()}s.endEmitted?n.nextTick(a):i.once("end",a),e.on("unpipe",l);var u=function(e){return function(){var t=e._readableState;t.awaitDrain--,0===t.awaitDrain&&m(e)}}(i);function d(){e.removeListener("close",h),e.removeListener("finish",f),e.removeListener("drain",u),e.removeListener("error",p),e.removeListener("unpipe",l),i.removeListener("end",c),i.removeListener("end",d),e._writableState&&!e._writableState.needDrain||u()}function p(t){g(),e.removeListener("error",p),0===o.listenerCount(e,"error")&&e.emit("error",t)}function h(){e.removeListener("finish",f),g()}function f(){e.removeListener("close",h),g()}function g(){i.unpipe(e)}return e.on("drain",u),e._events&&e._events.error?r(e._events.error)?e._events.error.unshift(p):e._events.error=[p,e._events.error]:e.on("error",p),e.once("close",h),e.once("finish",f),e.emit("pipe",i),s.flowing||(this.on("readable",v),s.flowing=!0,n.nextTick((function(){m(i)}))),e},u.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,this.removeListener("readable",v),t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,this.removeListener("readable",v),t.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}return-1===(i=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}(t.pipes,e))||(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},u.prototype.on=function(e,t){var n=a.prototype.on.call(this,e,t);if("data"!==e||this._readableState.flowing||y(this),"readable"===e&&this.readable){var r=this._readableState;r.readableListening||(r.readableListening=!0,r.emittedReadable=!1,r.needReadable=!0,r.reading?r.length&&f(this):this.read(0))}return n},u.prototype.addListener=u.prototype.on,u.prototype.resume=function(){y(this),this.read(0),this.emit("resume")},u.prototype.pause=function(){y(this,!0),this.emit("pause")},u.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;for(var i in e.on("end",(function(){if(t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)})),e.on("data",(function(i){t.decoder&&(i=t.decoder.write(i)),t.objectMode&&null==i||(t.objectMode||i&&i.length)&&(r.push(i)||(n=!0,e.pause()))})),e)"function"==typeof e[i]&&void 0===this[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));return E(["error","close","destroy","pause","resume"],(function(t){e.on(t,r.emit.bind(r,t))})),r._read=function(t){n&&(n=!1,e.resume())},r},u._fromList=b}).call(this)}).call(this,e("_process"))},{_process:303,buffer:226,"core-util-is":228,events:241,inherits:247,isarray:430,stream:427,"string_decoder/":437}],434:[function(e,t,n){t.exports=s;var r=e("./_stream_duplex"),i=e("core-util-is");function o(e,t){this.afterTransform=function(e,n){return function(e,t,n){var r=e._transformState;r.transforming=!1;var i=r.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!=n&&e.push(n),i&&i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}(t,e,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function s(e){if(!(this instanceof s))return new s(e);r.call(this,e),this._transformState=new o(e,this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",(function(){"function"==typeof this._flush?this._flush((function(e){a(t,e)})):a(t)}))}function a(e,t){if(t)return e.emit("error",t);var n=e._writableState,r=(e._readableState,e._transformState);if(n.length)throw new Error("calling transform done when ws.length != 0");if(r.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}i.inherits=e("inherits"),i.inherits(s,r),s.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},s.prototype._transform=function(e,t,n){throw new Error("not implemented")},s.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},s.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":431,"core-util-is":228,inherits:247}],435:[function(e,t,n){(function(n){(function(){t.exports=l;var r=e("buffer").Buffer;l.WritableState=a;var i=e("core-util-is");i.inherits=e("inherits");var o=e("stream");function s(e,t,n){this.chunk=e,this.encoding=t,this.callback=n}function a(e,t){var r=(e=e||{}).highWaterMark;this.highWaterMark=r||0===r?r:16384,this.objectMode=!!e.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var i=!1===e.decodeStrings;this.decodeStrings=!i,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,i=r.sync,o=r.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,i,o){r?n.nextTick((function(){o(i)})):o(i),e._writableState.errorEmitted=!0,e.emit("error",i)}(e,0,i,t,o);else{var s=p(e,r);s||r.bufferProcessing||!r.buffer.length||function(e,t){t.bufferProcessing=!0;for(var n=0;n<t.buffer.length;n++){var r=t.buffer[n],i=r.chunk,o=r.encoding,s=r.callback;if(u(e,t,t.objectMode?1:i.length,i,o,s),t.writing){n++;break}}t.bufferProcessing=!1,n<t.buffer.length?t.buffer=t.buffer.slice(n):t.buffer.length=0}(e,r),i?n.nextTick((function(){d(e,r,s,o)})):d(e,r,s,o)}}(t,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.errorEmitted=!1}function l(t){var n=e("./_stream_duplex");if(!(this instanceof l||this instanceof n))return new l(t);this._writableState=new a(t,this),this.writable=!0,o.call(this)}function c(e,t,n,i,o){n=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=new r(t,n)),t}(t,n,i),r.isBuffer(n)&&(i="buffer");var a=t.objectMode?1:n.length;t.length+=a;var l=t.length<t.highWaterMark;return l||(t.needDrain=!0),t.writing?t.buffer.push(new s(n,i,o)):u(e,t,a,n,i,o),l}function u(e,t,n,r,i,o){t.writelen=n,t.writecb=o,t.writing=!0,t.sync=!0,e._write(r,i,t.onwrite),t.sync=!1}function d(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),r(),n&&h(e,t)}function p(e,t){return t.ending&&0===t.length&&!t.finished&&!t.writing}function h(e,t){var n=p(0,t);return n&&(t.finished=!0,e.emit("finish")),n}i.inherits(l,o),l.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},l.prototype.write=function(e,t,i){var o=this._writableState,s=!1;return"function"==typeof t&&(i=t,t=null),r.isBuffer(e)?t="buffer":t||(t=o.defaultEncoding),"function"!=typeof i&&(i=function(){}),o.ended?function(e,t,r){var i=new Error("write after end");e.emit("error",i),n.nextTick((function(){r(i)}))}(this,0,i):function(e,t,i,o){var s=!0;if(!r.isBuffer(i)&&"string"!=typeof i&&null!=i&&!t.objectMode){var a=new TypeError("Invalid non-string/buffer chunk");e.emit("error",a),n.nextTick((function(){o(a)})),s=!1}return s}(this,o,e,i)&&(s=c(this,o,e,t,i)),s},l.prototype._write=function(e,t,n){n(new Error("not implemented"))},l.prototype.end=function(e,t,r){var i=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),i.ending||i.finished||function(e,t,r){t.ending=!0,h(e,t),r&&(t.finished?n.nextTick(r):e.once("finish",r)),t.ended=!0}(this,i,r)}}).call(this)}).call(this,e("_process"))},{"./_stream_duplex":431,_process:303,buffer:226,"core-util-is":228,inherits:247,stream:427}],436:[function(e,t,n){var r=e("stream");(n=t.exports=e("./lib/_stream_readable.js")).Stream=r,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":431,"./lib/_stream_passthrough.js":432,"./lib/_stream_readable.js":433,"./lib/_stream_transform.js":434,"./lib/_stream_writable.js":435,stream:427}],437:[function(e,t,n){var r=e("buffer").Buffer,i=r.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};var o=n.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!i(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=a;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=l;break;default:return void(this.write=s)}this.charBuffer=new r(6),this.charReceived=0,this.charLength=0};function s(e){return e.toString(this.encoding)}function a(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function l(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}o.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";if(e=e.slice(n,e.length),!((r=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&r<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var r,i=e.length;if(this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),i=(t+=e.toString(this.encoding,0,i)).length-1,(r=t.charCodeAt(i))>=55296&&r<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,i)}return t},o.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},o.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,r=this.charBuffer,i=this.encoding;t+=r.slice(0,n).toString(i)}return t}},{buffer:226}],438:[function(e,t,n){(function(t,r){(function(){var i=e("process/browser.js").nextTick,o=Function.prototype.apply,s=Array.prototype.slice,a={},l=0;function c(e,t){this._id=e,this._clearFn=t}n.setTimeout=function(){return new c(o.call(setTimeout,window,arguments),clearTimeout)},n.setInterval=function(){return new c(o.call(setInterval,window,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(e){e.close()},c.prototype.unref=c.prototype.ref=function(){},c.prototype.close=function(){this._clearFn.call(window,this._id)},n.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},n.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},n._unrefActive=n.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n.setImmediate="function"==typeof t?t:function(e){var t=l++,r=!(arguments.length<2)&&s.call(arguments,1);return a[t]=!0,i((function(){a[t]&&(r?e.apply(null,r):e.call(null),n.clearImmediate(t))})),t},n.clearImmediate="function"==typeof r?r:function(e){delete a[e]}}).call(this)}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":303,timers:438}],439:[function(e,t,n){(function(e){(function(){function n(t){try{if(!e.localStorage)return!1}catch(t){return!1}var n=e.localStorage[t];return null!=n&&"true"===String(n).toLowerCase()}t.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],440:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],441:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],442:[function(e,t,n){(function(t,r){(function(){var i=/%[sdj%]/g;n.format=function(e){if(!v(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(a(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,o=r.length,s=String(e).replace(i,(function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),l=r[n];n<o;l=r[++n])g(l)||!x(l)?s+=" "+l:s+=" "+a(l);return s},n.deprecate=function(e,i){if(y(r.process))return function(){return n.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),o=!0}return e.apply(this,arguments)}};var o,s={};function a(e,t){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),f(t)?r.showHidden=t:t&&n._extend(r,t),y(r.showHidden)&&(r.showHidden=!1),y(r.depth)&&(r.depth=2),y(r.colors)&&(r.colors=!1),y(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=l),u(r,e,r.depth)}function l(e,t){var n=a.styles[t];return n?"["+a.colors[n][0]+"m"+e+"["+a.colors[n][1]+"m":e}function c(e,t){return e}function u(e,t,r){if(e.customInspect&&t&&w(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r,e);return v(i)||(i=u(e,i,r)),i}var o=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(v(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return m(t)?e.stylize(""+t,"number"):f(t)?e.stylize(""+t,"boolean"):g(t)?e.stylize("null","null"):void 0}(e,t);if(o)return o;var s=Object.keys(t),a=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),_(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return d(t);if(0===s.length){if(w(t)){var l=t.name?": "+t.name:"";return e.stylize("[Function"+l+"]","special")}if(b(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(E(t))return e.stylize(Date.prototype.toString.call(t),"date");if(_(t))return d(t)}var c,x="",S=!1,T=["{","}"];return h(t)&&(S=!0,T=["[","]"]),w(t)&&(x=" [Function"+(t.name?": "+t.name:"")+"]"),b(t)&&(x=" "+RegExp.prototype.toString.call(t)),E(t)&&(x=" "+Date.prototype.toUTCString.call(t)),_(t)&&(x=" "+d(t)),0!==s.length||S&&0!=t.length?r<0?b(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),c=S?function(e,t,n,r,i){for(var o=[],s=0,a=t.length;s<a;++s)A(t,String(s))?o.push(p(e,t,n,r,String(s),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(p(e,t,n,r,i,!0))})),o}(e,t,r,a,s):s.map((function(n){return p(e,t,r,a,n,S)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(c,x,T)):T[0]+x+T[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,n,r,i,o){var s,a,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(a=e.stylize("[Setter]","special")),A(r,i)||(s="["+i+"]"),a||(e.seen.indexOf(l.value)<0?(a=g(n)?u(e,l.value,null):u(e,l.value,n-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),y(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function h(e){return Array.isArray(e)}function f(e){return"boolean"==typeof e}function g(e){return null===e}function m(e){return"number"==typeof e}function v(e){return"string"==typeof e}function y(e){return void 0===e}function b(e){return x(e)&&"[object RegExp]"===S(e)}function x(e){return"object"==typeof e&&null!==e}function E(e){return x(e)&&"[object Date]"===S(e)}function _(e){return x(e)&&("[object Error]"===S(e)||e instanceof Error)}function w(e){return"function"==typeof e}function S(e){return Object.prototype.toString.call(e)}function T(e){return e<10?"0"+e.toString(10):e.toString(10)}n.debuglog=function(e){if(y(o)&&(o=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!s[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var r=t.pid;s[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,r,t)}}else s[e]=function(){};return s[e]},n.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=h,n.isBoolean=f,n.isNull=g,n.isNullOrUndefined=function(e){return null==e},n.isNumber=m,n.isString=v,n.isSymbol=function(e){return"symbol"==typeof e},n.isUndefined=y,n.isRegExp=b,n.isObject=x,n.isDate=E,n.isError=_,n.isFunction=w,n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},n.isBuffer=e("./support/isBuffer");var k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function C(){var e=new Date,t=[T(e.getHours()),T(e.getMinutes()),T(e.getSeconds())].join(":");return[e.getDate(),k[e.getMonth()],t].join(" ")}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.log=function(){console.log("%s - %s",C(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!x(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":441,_process:303,inherits:440}],443:[function(e,t,n){var r=e("./v1"),i=e("./v4"),o=i;o.v1=r,o.v4=i,t.exports=o},{"./v1":446,"./v4":447}],444:[function(e,t,n){for(var r=[],i=0;i<256;++i)r[i]=(i+256).toString(16).substr(1);t.exports=function(e,t){var n=t||0,i=r;return[i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]]].join("")}},{}],445:[function(e,t,n){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var i=new Uint8Array(16);t.exports=function(){return r(i),i}}else{var o=new Array(16);t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},{}],446:[function(e,t,n){var r,i,o=e("./lib/rng"),s=e("./lib/bytesToUuid"),a=0,l=0;t.exports=function(e,t,n){var c=t&&n||0,u=t||[],d=(e=e||{}).node||r,p=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==p){var h=o();null==d&&(d=r=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==p&&(p=i=16383&(h[6]<<8|h[7]))}var f=void 0!==e.msecs?e.msecs:(new Date).getTime(),g=void 0!==e.nsecs?e.nsecs:l+1,m=f-a+(g-l)/1e4;if(m<0&&void 0===e.clockseq&&(p=p+1&16383),(m<0||f>a)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=f,l=g,i=p;var v=(1e4*(268435455&(f+=122192928e5))+g)%4294967296;u[c++]=v>>>24&255,u[c++]=v>>>16&255,u[c++]=v>>>8&255,u[c++]=255&v;var y=f/4294967296*1e4&268435455;u[c++]=y>>>8&255,u[c++]=255&y,u[c++]=y>>>24&15|16,u[c++]=y>>>16&255,u[c++]=p>>>8|128,u[c++]=255&p;for(var b=0;b<6;++b)u[c+b]=d[b];return t||s(u)}},{"./lib/bytesToUuid":444,"./lib/rng":445}],447:[function(e,t,n){var r=e("./lib/rng"),i=e("./lib/bytesToUuid");t.exports=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||r)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[o+a]=s[a];return t||i(s)}},{"./lib/bytesToUuid":444,"./lib/rng":445}],448:[function(e,t,n){"use strict";function r(e,t,n){var r=n[n.length-1];e===r.element&&(n.pop(),r=n[n.length-1]);var i=r.element,o=r.index;Array.isArray(i)?i.push(e):o===t.length-2?i[t.pop()]=e:t.push(e)}n.stringify=function(e){var t=[];t.push({obj:e});for(var n,r,i,o,s,a,l,c,u,d,p="";n=t.pop();)if(r=n.obj,p+=n.prefix||"",i=n.val||"")p+=i;else if("object"!=typeof r)p+=void 0===r?null:JSON.stringify(r);else if(null===r)p+="null";else if(Array.isArray(r)){for(t.push({val:"]"}),o=r.length-1;o>=0;o--)s=0===o?"":",",t.push({obj:r[o],prefix:s});t.push({val:"["})}else{for(l in a=[],r)r.hasOwnProperty(l)&&a.push(l);for(t.push({val:"}"}),o=a.length-1;o>=0;o--)u=r[c=a[o]],d=o>0?",":"",d+=JSON.stringify(c)+":",t.push({obj:u,prefix:d});t.push({val:"{"})}return p},n.parse=function(e){for(var t,n,i,o,s,a,l,c,u,d=[],p=[],h=0;;)if("}"!==(t=e[h++])&&"]"!==t&&void 0!==t)switch(t){case" ":case"\t":case"\n":case":":case",":break;case"n":h+=3,r(null,d,p);break;case"t":h+=3,r(!0,d,p);break;case"f":h+=4,r(!1,d,p);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(n="",h--;;){if(i=e[h++],!/[\d\.\-e\+]/.test(i)){h--;break}n+=i}r(parseFloat(n),d,p);break;case'"':for(o="",s=void 0,a=0;'"'!==(l=e[h++])||"\\"===s&&a%2==1;)o+=l,"\\"===(s=l)?a++:a=0;r(JSON.parse('"'+o+'"'),d,p);break;case"[":c={element:[],index:d.length},d.push(c.element),p.push(c);break;case"{":u={element:{},index:d.length},d.push(u.element),p.push(u);break;default:throw new Error("unexpectedly reached end of input: "+t)}else{if(1===d.length)return d.pop();r(d.pop(),d,p)}}},{}],449:[function(e,t,n){"use strict";var r=function(){};t.exports=r},{}],450:[function(e,t,n){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var i in n)r.call(n,i)&&(e[i]=n[i])}return e};var r=Object.prototype.hasOwnProperty},{}]},{},[44]);